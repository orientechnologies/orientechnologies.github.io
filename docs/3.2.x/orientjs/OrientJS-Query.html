<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Queries - OrientDB</title>


        <!-- Custom HTML head -->

        <meta name="description" content="OrientDB documentation">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">OrientDB</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="queries-in-orientjs"><a class="header" href="#queries-in-orientjs">Queries in OrientJS</a></h1>
<p>Where the features described in previous chapters operate through their own API's, OrientJS handles queries as a series of methods tied to the <a href="OrientJS-Database.html">Database API</a>.  Once you've initialized the variable for your database, (here called <code>db</code>), you can execute queries through it to get data from OrientDB.</p>
<p>There are two methods available in issuing queries to the database.  You can query it directly in SQL.  Alternatively, you can use the Query Builder methods to construct your query in Node.js.</p>
<h2 id="working-with-queries"><a class="header" href="#working-with-queries">Working with Queries</a></h2>
<p>When querying the database directly, you prepare a string containing OrientDB <a href="../sql/README.html">SQL</a>, the pass it to either the <code>db.query()</code> or <code>db.exec()</code> methods.  For instance, going back to the baseball database, say that you want a list of players with a batting average of at least .300 that played for the Red Sox.</p>
<pre><code class="language-js">db.query(
   'SELECT name, ba FROM Player '
   + 'WHERE ba &gt;= 0.3 AND team = "Red Sox"'
).then(function(hitters){
   console.log(hitters)
});
</code></pre>
<h3 id="using-parameters"><a class="header" href="#using-parameters">Using Parameters</a></h3>
<p>In the event that you want to query other teams and batting averages, such as the case where you want your application to serve a website, you can use previously defined variables, (here, <code>targetBA</code> and <code>targetTeam</code>), to set these parameters.  You can also add a limit to minimize the amount of data your application needs to parse.</p>
<blockquote>
<p>Do not enclose param placeholders in single/double quotes in query string. Query parameters are properly encoded by their type. Given example below, the executed query will be <code>SELECT name, ba FROM Player WHERE ba &gt;= 0.3 AND team = "Red Sox" LIMIT 20</code></p>
</blockquote>
<pre><code class="language-js">var targetBA = 0.3;
var targetTeam = 'Red Sox';

db.query(
   'SELECT name, ba FROM Player '
   + 'WHERE ba &gt;= :ba AND team = :team',
   {params:{
            ba: targetBA,
            team: targetTeam
           },
    limit: 20
   }
).then(function(hitters){
   console.log(hitters)
});
</code></pre>
<h3 id="using-fetching-strategies"><a class="header" href="#using-fetching-strategies">Using Fetching Strategies</a></h3>
<p>While the <code>query()</code> method supports most OrientDB SQL statements, there are some limitations in regards to <a href="../java/Fetching-Strategies.html">Fetching Strategies</a>.</p>
<p>The <code>query()</code> method does not support Fetching Strategies directly.For instance, say that you want to query the player records in your baseball database with baseball card images.  From the OrientDB Console, you might issue this command:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT name, OUT("hasCard") AS cards
          FROM Player FETCHPLAN *:1</code>
</pre>
<p>This would return a result-set with the player's name in one colmn and an array from the <code>Card</code> class with all properties on that class, (as expected).  If instead, you passed this query in OrientJS through the <code>query()</code> method, you would meet with different results:</p>
<pre><code class="language-js">db.query(
   'SELECT name, OUT("hasCard") AS cards '
   + 'FROM Player FETCHPLAN *:1')
   .then(function(results){
   console.log(results)
})
</code></pre>
<p>Using this code, instead of fetching and unpacking the relationship connecting the <code>Player</code> and <code>Card</code> class, the <code>card</code> column would only contain an array of Record ID's, ignoring the Fetch Plan.  The reason is that it expects to parse Fetch Plans as part of a parameter option, rather than with the query itself.  To use Fetching Strategies with OrientJS, pass it as a parameter:</p>
<pre><code class="language-js">var results = db.query(
   'SELECT name, OUT("hasCard") AS cards '
   + 'FROM Player',
   {fetchPlan: 'hasCard:1'})
    .then(function(results){
   console.log(results)
})
</code></pre>
<h2 id="query-builder"><a class="header" href="#query-builder">Query Builder</a></h2>
<p>Rather than writing out query strings in SQL, you can alternatively use the OrientJS Query Builder to construct queries using a series of methods connected through the Database API.</p>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="OrientJS-Query-Create.html"><strong><code>create()</code></strong></a></td><td>Creates vertices and edges.</td></tr>
<tr><td><a href="OrientJS-Query-Delete.html"><strong><code>delete()</code></strong></a></td><td>Removes vertices, edges, and records.</td></tr>
<tr><td><a href="OrientJS-Query-Fetch.html"><strong><code>fetch()</code></strong></a></td><td>Defines a <a href="../java/Fetching-Strategies.html">Fetching Strategy</a>.</td></tr>
<tr><td><a href="OrientJS-Query-Insert.html"><strong><code>insert()</code></strong></a></td><td>Adds records.</td></tr>
<tr><td><a href="OrientJS-Query-Live-Query.html"><strong><code>liveQuery()</code></strong></a></td><td>Executes a Live Query.</td></tr>
<tr><td><a href="OrientJS-Query-Select.html"><strong><code>select()</code></strong></a></td><td>Fetches records by query.</td></tr>
<tr><td><a href="OrientJS-Query-Transform.html"><strong><code>transform()</code></strong></a></td><td>Modifies records in transit.</td></tr>
<tr><td><a href="OrientJS-Query-Traverse.html"><strong><code>traverse()</code></strong></a></td><td>Fetches records by traversal.</td></tr>
<tr><td><a href="OrientJS-Query-Update.html"><strong><code>update()</code></strong></a></td><td>Modifies records on database.</td></tr>
</tbody></table>
</div>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../orientjs/OrientJS-Functions.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../orientjs/OrientJS-Query-Create.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../orientjs/OrientJS-Functions.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../orientjs/OrientJS-Query-Create.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>


        
        <img referrerpolicy="unsafe-url" src="https://tglman.org/OrientDB/matomo.php?idsite=7&amp;rec=1" style="border:0" alt="" />


        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
