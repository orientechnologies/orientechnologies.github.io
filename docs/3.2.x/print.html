<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>OrientDB</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="OrientDB documentation">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">OrientDB</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="orientdb-manual---version-3244"><a class="header" href="#orientdb-manual---version-3244">OrientDB Manual - version 3.2.44</a></h1>
<p><img src="_cover_small.png" alt="image" /></p>
<p>Welcome to <strong>OrientDB</strong> - the first Multi-Model Open Source NoSQL DBMS that brings together the power of graphs and the flexibility of documents into one scalable high-performance operational database.</p>
<h1 id="orientdb-v-3244-is-our-latest-ga"><a class="header" href="#orientdb-v-3244-is-our-latest-ga">OrientDB v 3.2.44 is our latest GA</a></h1>
<h2 id="quick-navigation"><a class="header" href="#quick-navigation">Quick Navigation</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Getting Started</th><th>Main Topics</th><th>Developers</th></tr></thead><tbody>
<tr><td><a href="introduction/README.html">Introduction to OrientDB</a></td><td><a href="datamodeling/Concepts.html">Basic Concepts</a></td><td><a href="sql/README.html">SQL</a></td></tr>
<tr><td><a href="gettingstarted/Tutorial-Installation.html">Installation</a></td><td><a href="general/Types.html">Supported Data Types</a></td><td><a href="gremlin/Gremlin.html">Gremlin</a></td></tr>
<tr><td><a href="gettingstarted/Tutorial-Working-with-graphs.html">First Steps</a></td><td><a href="general/Inheritance.html">Inheritance</a></td><td><a href="misc/OrientDB-REST.html">HTTP API</a></td></tr>
<tr><td><a href="misc/Troubleshooting.html">Troubleshooting</a></td><td><a href="security/Security.html">Security</a></td><td><a href="java/Java-API.html">Java API</a></td></tr>
<tr><td><a href="ee/Enterprise-Edition.html">Enterprise Edition</a></td><td><a href="indexing/Indexes.html">Indexes</a></td><td><a href="orientjs/OrientJS.html">NodeJS</a></td></tr>
<tr><td><a href="security/OrientDB-Security-Guide.html">Security Guide</a></td><td><a href="internals/Transactions.html">ACID Transactions</a></td><td><a href="https://github.com/orientechnologies/PhpOrient">PHP</a></td></tr>
<tr><td></td><td><a href="admin/Functions.html">Functions</a></td><td><a href="https://github.com/orientechnologies/pyorient">Python</a></td></tr>
<tr><td></td><td><a href="internals/Caching.html">Caching Levels</a></td><td><a href="https://github.com/orientechnologies/OrientDB-NET.binary">.NET</a></td></tr>
<tr><td></td><td><a href="legacy/Use-Cases.html">Common Use Cases</a></td><td><a href="apis-and-drivers/README.html">Other Drivers</a></td></tr>
<tr><td></td><td></td><td><a href="internals/Network-Binary-Protocol.html">Network Binary Protocol</a></td></tr>
<tr><td></td><td></td><td><a href="http://orientdb.dev/javadocs/3.2.x/">Javadocs</a></td></tr>
</tbody></table>
</div>
<h3 id="operations"><a class="header" href="#operations">Operations</a></h3>
<ul>
<li><a href="gettingstarted/Tutorial-Installation.html">Installation</a></li>
<li><a href="plugins/Plugins.html">3rd party Plugins</a></li>
<li><a href="release/Upgrade.html">Upgrade</a></li>
<li><a href="admin/Configuration.html">Configuration</a></li>
<li><a href="distributed/Distributed-Architecture.html">Distributed Architecture</a> (replication, sharding and high-availability)</li>
<li><a href="tuning/Performance-Tuning.html">Performance Tuning</a></li>
<li><a href="etl/ETL-Introduction.html">ETL to Import any kind of data into OrientDB</a></li>
<li><a href="admin/Import-From-RDBMS.html">Import from Relational DB</a></li>
<li><a href="admin/Backup-and-Restore.html">Backup and Restore</a></li>
<li><a href="admin/Export-and-Import.html">Export and Import</a></li>
</ul>
<h3 id="quick-references"><a class="header" href="#quick-references">Quick References</a></h3>
<ul>
<li><a href="console/README.html">Console</a></li>
<li><a href="studio/README.html">Studio</a> web tool</li>
<li><a href="internals/DB-Server.html">OrientDB Server</a></li>
<li><a href="internals/Network-Binary-Protocol.html">Network-Binary-Protocol</a></li>
<li><a href="plugins/Gephi.html">Gephi Graph Analysis Visual tool</a></li>
<li><a href="plugins/Rexster.html">Rexster Support and configuration</a></li>
</ul>
<h3 id="resources"><a class="header" href="#resources">Resources</a></h3>
<ul>
<li><a href="https://github.com/orientechnology/orientdb/discussion">User Group</a> - Have question, troubles, problems?</li>
<li><a href="https://orientdb.dev/support">Professional Support</a></li>
<li><a href="misc/Contribute-to-OrientDB.html">Contribute</a> - Contribute to the project.</li>
</ul>
<h2 id="questions-or-need-help"><a class="header" href="#questions-or-need-help">Questions or Need Help?</a></h2>
<p>Check out our <a href="misc/Get-in-Touch.html">Get in Touch</a> page for different ways of getting in touch with us.</p>
<h2 id="past-releases"><a class="header" href="#past-releases">Past Releases</a></h2>
<ul>
<li><a href="/docs/3.1.x/">v3.1.x</a></li>
</ul>
<blockquote>
<p>Every effort has been made to ensure the accuracy of this manual. However, OrientDB, LTD. makes no warranties with respect to this documentation and disclaims any implied warranties of merchantability and fitness for a particular purpose. The information in this document is subject to change without notice.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>This Chapter provides an introduction to OrientDB.</p>
<ul>
<li><a href="introduction/../misc/About-This-Manual.html">About This Manual</a></li>
<li><a href="introduction/../misc/Overview.html">Overview of OrientDB</a></li>
<li><a href="introduction/../release/3.2/README.html">Release 3.2</a>
<ul>
<li><a href="introduction/../release/3.2/What-is-new-in-OrientDB-3.2.html">What's new in OrientDB 3.2?</a></li>
<li><a href="introduction/../release/3.2/Available-Packages.html">Available Packages</a></li>
<li><a href="introduction/../release/3.2/SQL-Changes.html">SQL Changes</a></li>
<li><a href="introduction/../release/3.2/API-Changes.html">API Changes</a></li>
<li><a href="introduction/../release/3.2/Known-issues.html">Known Issues</a>
:   * <a href="introduction/../release/3.2/Upgrading-to-OrientDB-3.2.html">Upgrading to OrientDB 3.2</a></li>
</ul>
</li>
<li><a href="introduction/../misc/Report-an-issue.html">How to Report Bugs or Problems</a></li>
<li><a href="introduction/../misc/Get-in-Touch.html">How to Get in Touch with OrientDB</a></li>
<li><a href="introduction/../misc/Contribute-to-OrientDB.html">How to Contribute to OrientDB</a></li>
<li><a href="introduction/../misc/Roadmap.html">OrientDB Roadmap</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="about-this-manual"><a class="header" href="#about-this-manual">About this Manual</a></h1>
<p>This Manual documents version 3.2 of the OrientDB Server and the OrientDB suite of products.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="overview"><a class="header" href="#overview">Overview</a></h1>
<p>OrientDB is the first Multi-Model Open Source NoSQL DBMS that combines the power of graphs and the flexibility of documents into one scalable, high-performance operational database.</p>
<p>Gone are the days where your database only supports a single data model. As a direct response to polyglot persistence, multi-model databases acknowledge the need for multiple data models, combining them to reduce operational complexity and maintain data consistency. Though graph databases have grown in popularity, most NoSQL products are still used to provide scalability to applications sitting on a relational DBMS. Advanced 2nd generation NoSQL products like OrientDB are the future: providing more functionality and flexibility, while being powerful enough to replace your operational DBMS.</p>
<h2 id="speed"><a class="header" href="#speed">Speed</a></h2>
<p>OrientDB was engineered from the ground up with performance as a key specification. It’s fast on both read and write operations.
Stores up to 120,000 records per second</p>
<ul>
<li>No more Joins: relationships are physical links to the records.</li>
<li>Better RAM use.</li>
<li>Traverses parts of or entire trees and graphs of records in milliseconds.</li>
<li>Traversing speed is not affected by the database size.</li>
</ul>
<h2 id="enterprise"><a class="header" href="#enterprise">Enterprise</a></h2>
<p>While most NoSQL DBMSs are used as secondary databases, OrientDB is powerful and flexible enough to be used as an operational DBMS.
OrientDB Enterprise Edition gives you all the features of our community edition plus:</p>
<ul>
<li>Incremental backups</li>
<li>Unmatched security</li>
<li>Query Profiler</li>
<li>Distributed Clustering configuration</li>
<li>Metrics Recording</li>
<li>Live Monitor with configurable alerts</li>
</ul>
<h2 id="zero-configuration-multi-master-architecture"><a class="header" href="#zero-configuration-multi-master-architecture">Zero Configuration Multi-Master Architecture</a></h2>
<p>With a master-slave architecture, the master often becomes the bottleneck. With OrientDB, throughput is not limited by a single server. Global throughput is the sum of the throughput of all the servers.</p>
<ul>
<li>Multi-Master</li>
<li>Elastic Linear Scalability</li>
<li>Restore the database content using WAL</li>
</ul>
<p>With a zero-config multi-master architecture, OrientDB is perfect for the Cloud. Hundreds of servers can share the workload, scaling horizontally across distributed modern data centers.</p>
<h2 id="flexibility"><a class="header" href="#flexibility">Flexibility</a></h2>
<p>Replacing your DBMS, once it no longer meets requirements, can be a huge cost in time and resources. Is your database powerful, scalable and flexible enough to grow with you? Using OrientDB also reduces the need to support multiple products to achieve your goals.</p>
<h2 id="get-started-in-minutes"><a class="header" href="#get-started-in-minutes">Get Started in Minutes</a></h2>
<p>OrientDB is written entirely in Java and can run on any platform without configuration and installation. It's a drop-in replacement for the most common existing graph databases in deployment today.</p>
<ul>
<li>Multiple Programming Language Bindings</li>
<li>Extended SQL with graph functionality</li>
<li>Tinkerpop API</li>
</ul>
<p>Coming from the relational world? Import your data using OrientDB Teleporter and get started in an instant</p>
<p>Coming From Neo4j? Our Neo4j Importer lets you get started with your own graph data</p>
<h2 id="low-tco"><a class="header" href="#low-tco">Low TCO</a></h2>
<p>There is absolutely no cost associated with using OrientDB Community Edition.</p>
<ul>
<li>OrientDB Community is free for commercial use.</li>
<li>Comes with an Apache 2 Open Source License.</li>
<li>Eliminates the need for multiple products and multiple licenses.</li>
</ul>
<p>OrientDB Ltd, the company behind OrientDB, offers optional services such as Developer and Production Support, consultancy and Training with transparent pricing far below our competitors to ensure you’re maximizing OrientDB’s capabilities for your particular use case. OrientDB Enterprise Edition is included with the purchase of any of these services.</p>
<h1 id="open-source"><a class="header" href="#open-source">Open Source</a></h1>
<p>Which is more likely to have better quality? A DBMS created and tested by a handful of developers or one tested by over 100,000 developers globally? When code is public, everyone can scrutinize, test, report and resolve issues. All things Open Source move faster compared to the proprietary world. In fact, the most popular databases ranked by DB-Engines are now Open Source.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="editions"><a class="header" href="#editions">Editions</a></h1>
<p>OrientDB is available in two editions:</p>
<ul>
<li>
<p><strong>Community Edition</strong> is released as an open source project under the <a href="http://www.apache.org/licenses/LICENSE-2.0.html">Apache 2 license</a>. This license allows unrestricted free usage for both open source and commercial projects.</p>
</li>
<li>
<p><strong>Enterprise Edition</strong>  used to be the commercial software built on top of the Community Edition, now it is Free Open Source as well. Enterprise is developed by the same team that developed the OrientDB engine. It serves as an extension of the Community Edition, providing Enterprise features, such as:</p>
<ul>
<li>Non-Stop Backup and Restore</li>
<li>Scheduled FULL and Incremental Backups</li>
<li>Query Profiler</li>
<li>Distributed Clustering configuration</li>
<li>Metrics Recording</li>
<li>Live Monitoring with configurable Alerts</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-32"><a class="header" href="#release-32">Release 3.2</a></h1>
<p>This Section documents what is new and what has changed in OrientDB 3.2.</p>
<ul>
<li><a href="release/3.2/What-is-new-in-OrientDB-3.2.html">What's new in OrientDB 3.2?</a></li>
<li><a href="release/3.2/Available-Packages.html">Available Packages</a></li>
<li><a href="release/3.2/SQL-Changes.html">SQL Changes</a></li>
<li><a href="release/3.2/API-Changes.html">API Changes</a></li>
<li><a href="release/3.2/Known-issues.html">Known Issues</a></li>
<li><a href="release/3.2/Upgrading-to-OrientDB-3.2.html">Upgrading to OrientDB 3.2</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h2 id="whats-new-in-orientdb-32"><a class="header" href="#whats-new-in-orientdb-32">What's new in OrientDB 3.2?</a></h2>
<h2 id="security"><a class="header" href="#security">Security</a></h2>
<p>With the OrientDB 3.2 multimodel API some important changes were implemented on Database creation.
The most important one is that basic database users (admin, reader, writer) are no longer created by default.
This is the consequence of some considerations about Security: having default passwords (eg. admin/admin) is a bad practice
and exposes OrientDB installations to possible attacks.</p>
<p>Of course it's possible to explicitly trigger user creation and to provide a custom password, instead of using a default admin user.</p>
<pre><code class="language-java">final OrientDB orientdb = ...;

orientdb.execute("create database test plocal users ( admin identified by 'adminpwd' role admin)");
final ODatabaseSession session = orientdb.open("test","admin", "adminpwd");
</code></pre>
<p>the roles <code>admin</code>, <code>writer</code>, <code>reader</code> are still created by default.</p>
<blockquote>
<p>It is highly recommended to take a stronger password than <code>adminpwd</code> in our example.</p>
</blockquote>
<p>If the creation of default users is enabled and you try to create a user called <code>admin</code>, the creation of that user will fail.
The creation of default users can be disabled setting <code>CREATE_DEFAULT_USERS</code> to <code>false</code> as in:</p>
<pre><code class="language-java">new OrientDB("...",
             OrientDBConfig.builder()
                .addConfig(OGlobalConfiguration.CREATE_DEFAULT_USERS, false)
                .build());
</code></pre>
<p>The creation of multiple admin users like <code>admin</code>, <code>reader</code>, and <code>writer</code> can be done by comma-separating</p>
<pre><code class="language-java">final OrientDB orientdb = ...;

orientdb.execute("create database test plocal users ( 
            admin identified by 'adminpwd' role admin, 
            reader identified by by 'adminpwd' role reader, 
            writer identified by by 'adminpwd' role writer)");
final ODatabaseSession session = orientdb.open("test","admin", "adminpwd");
</code></pre>
<p>From Studio, there is a new option that allows you to define the default admin password on the Database Create dialog.</p>
<p>The old defaults can be restored (for backward compatibility) by setting <code>-Dsecurity.createDefaultUsers=true</code> at startup</p>
<blockquote>
<p>Deprecated APIs like <code>ODatabaseDocumentTx</code> are not affected from that change.</p>
</blockquote>
<h2 id="server-level-commands"><a class="header" href="#server-level-commands">Server-Level Commands</a></h2>
<p>In OrientDB v 3.2 we added some infrastructure to run commands at server level.
See <a href="release/3.2/SQL-Changes.html">SQL Changes</a> and <a href="release/3.2/../../serverlevel/README.html">Server-Level Commands</a>)</p>
<h2 id="distributed-enhancements-and-stabilization"><a class="header" href="#distributed-enhancements-and-stabilization">Distributed enhancements and stabilization</a></h2>
<p>In v 3.1.x, OrientDB clustering had a limitation related to indexing: UNIQUE indexes needed full agreement between the nodes (N ack out of N nodes) to perform a transaction.
In v 3.2 we removed this limitation, now transactions that involve UNIQUE indexes have the same quorum as any other transaction (typically N/2 + 1).
Hazelcast was updated to latest version.</p>
<h2 id="console-enhancements"><a class="header" href="#console-enhancements">Console enhancements</a></h2>
<p>In previous versions there are some slight differences in the console when using a remote server or an embedded environment.
In v 3.2 the CLI interface was refactored to unify the management of embedded and remote environments</p>
<p>see</p>
<ul>
<li><a href="release/3.2/../../console/Console-Command-Connect-Env.html">Connect Env</a></li>
<li><a href="release/3.2/../../console/Console-Command-Open.html">Open</a></li>
</ul>
<h2 id="graalvm-support"><a class="header" href="#graalvm-support">GraalVM support</a></h2>
<p>After Nashorn was deprecated and then removed from the JVM (see <a href="http://openjdk.java.net/jeps/335">JSR 335</a>), OrientDB needs an alternative for scripting.
In v 3.2 we introduce support for <a href="https://www.graalvm.org/">GraalVM</a> as a replacement for scripting capabilities</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="available-packages"><a class="header" href="#available-packages">Available Packages</a></h1>
<p>Starting from OrientDB 3.0, for each <a href="release/3.2/../../misc/Editions.html">OrientDB Editions</a>, different packages are available for download. Please use the package that best fits your needs.</p>
<h2 id="community-edition"><a class="header" href="#community-edition">Community Edition</a></h2>
<p>The following are the packages available for OrientDB Community Edition:</p>
<ul>
<li><strong>CE</strong> (<a href="https://repo1.maven.org/maven2/com/orientechnologies/orientdb-community/3.2.44/orientdb-community-3.2.43.tar.gz">orientdb-community-3.2.44.tar.gz</a>)
<ul>
<li>OrientDB Community Edition without Gremlin/TinkerPop support</li>
</ul>
</li>
<li><strong>CE-TP2</strong> (<a href="https://repo1.maven.org/maven2/com/orientechnologies/orientdb-community-tp2/3.2.44/orientdb-community-tp2-3.2.43.tar.gz">orientdb-community-tp2-3.2.44.tar.gz</a>)
<ul>
<li>OrientDB Community Edition that includes support for Gremlin/TinkerPop 2.6</li>
</ul>
</li>
<li><strong>CE-TP3</strong> (<a href="https://repo1.maven.org/maven2/com/orientechnologies/orientdb-tp3/3.2.44/orientdb-tp3-3.2.43.tar.gz">orientdb-community-tp3-3.2.44.tar.gz</a>)
<ul>
<li>OrientDB Community Edition that includes support for Gremlin/TinkerPop 3.x</li>
</ul>
</li>
</ul>
<h2 id="enterprise-edition"><a class="header" href="#enterprise-edition">Enterprise Edition</a></h2>
<ul>
<li><strong>Agent</strong> (<a href="https://repo1.maven.org/maven2/com/orientechnologies/agent/3.2.44/agent-3.2.43.jar">agent-3.2.44.tar.gz</a>)
<ul>
<li>OrientDB Enterprise Agent</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h2 id="sql-changes"><a class="header" href="#sql-changes">SQL Changes</a></h2>
<h3 id="server-level-commands-1"><a class="header" href="#server-level-commands-1">Server-level Commands</a></h3>
<p>In previous versions, you can run scripts (eg. SQL) on a single database connection, and the scripts are executed on the database itself. In OrientDB v 3.2 we extended the usage of scripts to the Server level.</p>
<p>This adds a lot of new potential for both infrastructure management and querying.</p>
<p>For now, we implemented some basic Server-level commands, like <code>CREATE/DROP DATABASE</code> and <code>CREATE SYSTEM USER</code>, but the infrastructure allows for potential future extensions to all the aspects of the server and data management.</p>
<p>Server-level commands can be executed via native API, via REST or via CLI</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="api-changes"><a class="header" href="#api-changes">API Changes</a></h2>
<div style="break-before: page; page-break-before: always;"></div><h2 id="known-issues"><a class="header" href="#known-issues">Known Issues</a></h2>
<div style="break-before: page; page-break-before: always;"></div><h1 id="upgrading-to-orientdb-32"><a class="header" href="#upgrading-to-orientdb-32">Upgrading to OrientDB 3.2</a></h1>
<h2 id="binary-formats"><a class="header" href="#binary-formats">Binary formats</a></h2>
<p>When upgrading OrientDB to a newer major/minor version, we recommend to perform an export and import of the databases.
Anyway, OrientDB guarantees binary format compatibility, so export/import is not striclty needed.</p>
<h2 id="general-information"><a class="header" href="#general-information">General information</a></h2>
<p>Developing OrientDB 3.2 we put a lot of attention on maintaining backward compatibility with v 3.0 and 3.1.</p>
<p>Here is a list of the things you should know when migrating to v 3.2</p>
<h2 id="database-creation"><a class="header" href="#database-creation">Database Creation</a></h2>
<p>In OrientDB v 3.2, the creation of a new database does not automatically provide default users (admin, reader, writer). This choice is due to Security considerations: default users come with default passwords, that are a possible weakness in the server security if not promptly changed.</p>
<p>A new database API is provided to create custom users at DB creation time:</p>
<pre><code>Orientdb orientdb = ...;

orientdb.execute("CREATE DATABASE foo plocal users(admin identified by 'adminpwd' role admin")
</code></pre>
<p>The old behaviour (ie. creating default users with default password) can be restored by setting the Global Configuraion option called <code>security.createDefaultUsers</code>:</p>
<p>eg.</p>
<pre><code>./server.sh -Dsecurity.createDefaultUsers=true
</code></pre>
<h2 id="console"><a class="header" href="#console">Console</a></h2>
<p>The console was adapted to include support to <a href="release/3.2/../../serverlevel/README.html">Server-Level commands</a> and to allow the creation of databases without default users (see above).
The old <code>create database</code> command had a complex behaviour: it created a DB with default users and then <em>connected</em> to that database using <code>admin</code> user and the default password. This is not possible anymore by default (default <code>admin</code> user does not exist anymore), so <code>create database</code> no longer connects to the DB.</p>
<p>The new console interaction pattern involves connecting to the server/environment (see <a href="release/3.2/../../console/Console-Command-Connect-Env.html">CONNECT ENV</a>) and then execute server-level commands on it.</p>
<p><code>CREATE DATABASE</code> command was enhanced to accept default user names and password (see <a href="release/3.2/../../console/Console-Command-Create-Database.html">CREATE DATABASE</a>)</p>
<p>A new <code>OPEN &lt;database&gt;</code> command was added to connect to an existing database in current server/environment (see <a href="release/3.2/../../console/Console-Command-Open.html">OPEN</a>)</p>
<p>A backward compatibility option is provided to allow execution of old console scripts; it can be enabled setting the console configuration as follows (this can just be added as the first row of the script):</p>
<pre><code>orientdb&gt; SET compatibilityLevel=0;
</code></pre>
<h1 id="release-notes"><a class="header" href="#release-notes">Release notes</a></h1>
<p>General information on how to upgrade OrientDB can be found in the <a href="release/3.2/../Upgrade.html">Upgrade</a> Chapter.</p>
<p>You may also be interested in checking the <a href="release/3.2/../Release-Notes.html">Release Notes</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="report-an-issue"><a class="header" href="#report-an-issue">Report an Issue</a></h1>
<p>Very often when a new issue is open it lacks some fundamental information. This slows down the entire process because the first question from the OrientDB team is always "What release of OrientDB are you using?" and every time a Ferret dies in the world.</p>
<p>So please add more information about your issue:</p>
<ol>
<li>OrientDB <strong>release</strong>? (If you're using a SNAPSHOT please attach also the build number found in "build.number" file)</li>
<li>What <strong>steps</strong> will reproduce the problem?</li>
<li></li>
<li></li>
<li></li>
<li><strong>Settings</strong>. If you're using custom settings please provide them below (to dump all the settings run the application using the JVM argument -Denvironment.dumpCfgAtStartup=true)</li>
<li>What is the <strong>expected behavior</strong> or output? What do you get or see instead?</li>
<li>If you're describing a performance or memory problem the <strong>profiler</strong> dump can be very useful (to dump it run the application using the JVM arguments -Dprofiler.autoDump.reset=true -Dprofiler.autoDump.interval=10 -Dprofiler.enabled=true)</li>
</ol>
<p>Now you're ready to create a new one: https://github.com/orientechnologies/orientdb/issues/new</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="how-to-get-in-touch-with-orientdb"><a class="header" href="#how-to-get-in-touch-with-orientdb">How to Get in Touch with OrientDB</a></h1>
<p>We want to make it super-easy for OrientDB users and contributors to talk to us and connect with each other, to share ideas, solve problems and help make OrientDB awesome. Here are the main channels we're running currently, we'd love to hear from you on one of them:</p>
<h2 id="discussions"><a class="header" href="#discussions">Discussions</a></h2>
<p><a href="https://github.com/orientechnologies/orientdb/discussions">OrientDB GitHub Discussions</a></p>
<p>The <a href="https://github.com/orientechnologies/orientdb/discussions">Discussions Group</a> (aka Community Group) is a good first stop for a general inquiry about OrientDB or a specific support issue (e.g. trouble setting OrientDB up). It's also a good forum for discussions about the roadmap or potential new functionality.</p>
<h2 id="stackoverflow"><a class="header" href="#stackoverflow">StackOverflow</a></h2>
<p><a href="http://stackoverflow.com/questions/tagged/orientdb">StackOverflow OrientDB tag</a></p>
<p>Feel free to ask your questions on StackOverflow under "orientdb" and "orient-db" tags.</p>
<h2 id="mastodon"><a class="header" href="#mastodon">Mastodon</a></h2>
<p><a href="https://fosstodon.org/@orientdb">@orientdb@fosstodon.org</a></p>
<p>Follow and chat to us on Mastodon.</p>
<h2 id="bluesky"><a class="header" href="#bluesky">Bluesky</a></h2>
<p><a href="https://bsky.app/profile/orientdb.bsky.social">@orientdb.bsky.social</a></p>
<p>Follow and chat to us on Bluesky.</p>
<h2 id="matrix"><a class="header" href="#matrix">Matrix</a></h2>
<p><a href="https://matrix.to/#orientdb:matrix.org">#orientdb:matrix.org</a></p>
<p>Join the matrix channel and chat with us.</p>
<h2 id="github"><a class="header" href="#github">GitHub</a></h2>
<p><a href="https://github.com/orientechnologies/orientdb/issues?state=open">OrientDB issues</a></p>
<p>If you spot a bug, then please raise an issue in our main GitHub project orientechnologies/orientdb. Likewise if you have developed a cool new feature or improvement in your OrientDB fork, then send us a pull request against the "develop" branch!</p>
<p>If you want to brainstorm a potential new feature, then the OrientDB Discussions Group (see above) is probably a better place to start.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="how-to-contribute-to-orientdb"><a class="header" href="#how-to-contribute-to-orientdb">How to Contribute to OrientDB</a></h1>
<p>In order to contribute issues and pull requests, please sign OrientDB's <a href="https://www.clahub.com/agreements/orientechnologies/orientdb">Contributor License Agreement</a>. The purpose of this agreement is to protect users of this codebase by ensuring that all code is free to use under the stipulations of the <a href="http://www.apache.org/licenses/LICENSE-2.0.html">Apache2 license</a>.</p>
<h2 id="pushing-into-main-repository"><a class="header" href="#pushing-into-main-repository">Pushing into main repository</a></h2>
<p>OrientDB uses different branches to support the development and release process.
The <code>develop</code> branch contains code under development for which there's not a stable release yet.
When a stable version is released, a branch for the hotfix is created.
Each stable release is merged on master branch and tagged there.
At the time of writing these notes, the state of branches is:</p>
<ul>
<li>develop: work in progress for next 2.2.x release (2.2.0-SNAPSHOT)</li>
<li>2.1.x: hot fix for next 2.1.x stable release (2.1.10-SNAPSHOT)</li>
<li>2.0.x: hot fix for next 2.0.x stable release (2.0.17-SNAPSHOT)</li>
<li>last tag on master is 2.1.9</li>
</ul>
<p>If you'd like to contribute to OrientDB with a patch follow the following steps:</p>
<ul>
<li>fork the repository interested in your change. The main one is https://github.com/orientechnologies/orientdb, while some other components reside in other projects under <a href="https://github.com/orientechnologies/">Orient Technologies</a> umbrella.</li>
<li>clone the forked repository</li>
<li>select the branch, e.g the develop branch:</li>
<li><code>git checkout develop</code></li>
<li>apply your changes with your favourite editor or IDE</li>
<li>test that Test Suite hasn't been broken by running:</li>
<li><code>mvn clean test</code></li>
<li>if all the tests pass, then do a <strong>Pull Request</strong> (PR) against the branch (e.g.: <strong>"develop"</strong>) on GitHub repository and write a comment about the change. Please don't send PR to "master" because we use that branch only for releasing</li>
</ul>
<h2 id="documentation"><a class="header" href="#documentation">Documentation</a></h2>
<p>If you want to contribute to the OrientDB documentation, the right repository is: https://github.com/orientechnologies/orientdb-docs. Every 24-48 hours all the contributions are reviewed and published on the public <a href="http://orientdb.dev/docs/last/">documentation</a>.</p>
<h2 id="code-formatting"><a class="header" href="#code-formatting">Code formatting</a></h2>
<h3 id="v-31-and-following"><a class="header" href="#v-31-and-following">v 3.1 and following</a></h3>
<p>Since v 3.1, OrientDB uses Google code formatter.</p>
<p>In IntelliJ Idea, you can use this plugin https://plugins.jetbrains.com/plugin/8527-google-java-format</p>
<p>From Maven, you can run <code>mvn com.coveo:fmt-maven-plugin:format</code> for automatic code format.</p>
<h3 id="v-30-and-previous-releases"><a class="header" href="#v-30-and-previous-releases">v 3.0 and previous releases</a></h3>
<p>For previous versions (until 3.0) you can use eclipse java formatter config file, that you can find here: <a href="https://github.com/orientechnologies/orientdb/blob/master/_base/ide/eclipse-formatter.xml">_base/ide/eclipse-formatter.xml</a>.</p>
<p>If you use IntelliJ IDEA you can install <a href="http://plugins.jetbrains.com/plugin/?id=6546">this</a> plugin and use formatter profile mentioned above.</p>
<h2 id="debugging"><a class="header" href="#debugging">Debugging</a></h2>
<h3 id="run-orientdb-as-standalone-server"><a class="header" href="#run-orientdb-as-standalone-server">Run OrientDB as standalone server</a></h3>
<p>The settings to run OrientDB Server as stand-alone (where the OrientDB's home is <code>/repositories/orientdb/releases/orientdb-community-2.2-SNAPSHOT</code>) are:</p>
<p>Main Class: <code>com.orientechnologies.orient.server.OServerMain</code>
VM parameters:</p>
<pre><code>-server
-DORIENTDB_HOME=/repositories/orientdb/releases/orientdb-community-2.2-SNAPSHOT
-Dorientdb.www.path=src/site
-Djava.util.logging.config.file=${ORIENTDB_HOME}/config/orientdb-server-log.properties
-Dorientdb.config.file=${ORIENTDB_HOME}/config/orientdb-server-config.xml
-Drhino.opt.level=9
</code></pre>
<p>Use classpath of module: <code>orientdb-graphdb</code></p>
<h3 id="run-orientdb-distributed"><a class="header" href="#run-orientdb-distributed">Run OrientDB distributed</a></h3>
<p>The settings to run OrientDB Server as distributed (where the OrientDB's home is <code>/repositories/orientdb/releases/orientdb-community-2.2-SNAPSHOT</code>) are:</p>
<p>Main Class: <code>com.orientechnologies.orient.server.OServerMain</code>
VM parameters:</p>
<pre><code>-server
-DORIENTDB_HOME=/repositories/orientdb/releases/orientdb-community-2.2-SNAPSHOT
-Dorientdb.www.path=src/site
-Djava.util.logging.config.file=${ORIENTDB_HOME}/config/orientdb-server-log.properties
-Dorientdb.config.file=${ORIENTDB_HOME}/config/orientdb-server-config.xml
-Drhino.opt.level=9
-Ddistributed=true
</code></pre>
<p>Use classpath of module: <code>orientdb-distributed</code></p>
<p>In order to debug OrientDB in distributed mode, changed the scope to "runtime" in file distributed/pom.xml:</p>
<pre><code class="language-xml">&lt;groupId&gt;com.orientechnologies&lt;/groupId&gt;
&lt;artifactId&gt;orientdb-graphdb&lt;/artifactId&gt;
&lt;version&gt;${project.version}&lt;/version&gt;
&lt;scope&gt;runtime&lt;/scope&gt;
</code></pre>
<p>In this way IDE like IntelliJ can start the server correctly that requires graphdb dependency.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-roadmap"><a class="header" href="#orientdb-roadmap">OrientDB Roadmap</a></h1>
<p>This page contains the roadmap with the main enhancements for the OrientDB product.</p>
<h3 id="terms"><a class="header" href="#terms">Terms</a></h3>
<ul>
<li><strong>RC</strong>: <a href="https://en.wikipedia.org/wiki/Software_release_life_cycle#Release_candidate">Release Candidate</a>, is a beta version with potential to be a final product, which is ready to release unless significant bugs emerge. In this stage of product stabilization, all product features have been designed, coded and tested through one or more beta cycles with no known showstopper-class bug. A release is called code complete when the development team agrees that no entirely new source code will be added to this release. There could still be source code changes to fix defects, changes to documentation and data files, and peripheral code for test cases or utilities. Beta testers, if privately selected, will often be credited for using the release candidate as though it were a finished product. Beta testing is conducted in a client's or customer's location and to test the software from a user's perspective.</li>
<li><strong>GA</strong>: <a href="https://en.wikipedia.org/wiki/Software_release_life_cycle#General_availability_.28GA.29">General Availability</a>, is the stage where the software has "gone live" for usage in production. Users in production are suggested to plan a migration for the current GA evaluating pros and cons of the upgrade.</li>
</ul>
<h2 id="release-30"><a class="header" href="#release-30">Release 3.0</a></h2>
<pre><code>- Development started on.: June 2016
- Expected first M1......: January 2017
- Expected first M2......: February 2017
- Expected first RC......: March 2017
- Expected final GA......: March/April 2017
</code></pre>
<h3 id="status"><a class="header" href="#status">Status</a></h3>
<p>Last update: December 14, 2016</p>
<p>For a more detailed an updated view, look at the <a href="https://github.com/orientechnologies/orientdb/issues/6005">Roadmap 3.0 issue</a>.</p>
<div class="table-wrapper"><table><thead><tr><th>Module</th><th>Feature</th><th>Status</th></tr></thead><tbody>
<tr><td>Core</td><td><a href="https://github.com/orientechnologies/orientdb/issues/2989">Multi-Threads WAL</a></td><td>30%</td></tr>
<tr><td>Core</td><td><a href="https://github.com/orientechnologies/orientdb/issues/5277">WAL Compaction</a></td><td>30%</td></tr>
<tr><td>Core</td><td><a href="https://github.com/orientechnologies/orientdb/issues/4568">Index rebuild avoid using WAL</a></td><td>0%</td></tr>
<tr><td>Core</td><td><a href="https://github.com/orientechnologies/orientdb/issues/3742">Compression of used space on serialization</a></td><td>3%</td></tr>
<tr><td>Core</td><td>Improved DISKCACHE algorithm</td><td>60%</td></tr>
<tr><td>Core</td><td>Index per cluster</td><td>0%</td></tr>
<tr><td>Core</td><td><a href="https://github.com/orientechnologies/orientdb/issues/4491">New data structure to manage edges</a></td><td>0%</td></tr>
<tr><td>SQL</td><td>Distributed SQL Executor</td><td>70%</td></tr>
<tr><td>SQL</td><td>Multi-line queries in batch scripts</td><td>100%</td></tr>
<tr><td>Java API</td><td>New factories</td><td>100%</td></tr>
<tr><td>Java API</td><td><a href="https://github.com/orientechnologies/orientdb/issues/4814">Improve SQL UPDATE syntax</a></td><td>100%</td></tr>
<tr><td>Java API</td><td><a href="https://github.com/orientechnologies/orientdb/issues/2441">Support for TinkerPop 3</a></td><td>70%</td></tr>
<tr><td>Remote protocol</td><td>Support for server-side transactions</td><td>10%</td></tr>
<tr><td>Remote protocol</td><td>Support for server-side cursors</td><td>90%</td></tr>
<tr><td>Remote protocol</td><td><a href="https://github.com/orientechnologies/orientdb/issues/3496">Push messages on schema change</a></td><td>0%</td></tr>
<tr><td>Remote protocol</td><td><a href="https://github.com/orientechnologies/orientdb/issues/3496">Push messages on record change</a></td><td>0%</td></tr>
<tr><td>Distributed</td><td>Auto-Sharding</td><td>10%</td></tr>
<tr><td>Distributed</td><td>Optimized network protocol to send only the delta between updates</td><td>50%</td></tr>
</tbody></table>
</div>
<h2 id="release-31"><a class="header" href="#release-31">Release 3.1</a></h2>
<pre><code>- Development started on.: -
- Expected first RC......: TBD
- Expected final GA......: TBD
</code></pre>
<h3 id="status-1"><a class="header" href="#status-1">Status</a></h3>
<p>Last update: April 12, 2015</p>
<div class="table-wrapper"><table><thead><tr><th>Module</th><th>Feature</th><th>Status</th></tr></thead><tbody>
<tr><td>Core</td><td><a href="https://github.com/orientechnologies/orientdb/issues/1677">Parallel Transactions</a></td><td>0%</td></tr>
<tr><td>Core</td><td>Indexing of embedded properties</td><td>0%</td></tr>
<tr><td>Core</td><td>Override of properties</td><td>0%</td></tr>
<tr><td>Core</td><td>Enhance isolation level also for remote commands</td><td>0%</td></tr>
<tr><td>Distributed</td><td>Optimized replication for cross Data Center</td><td>0%</td></tr>
<tr><td>Distributed</td><td>Replication of in-memory databases</td><td>0%</td></tr>
<tr><td>Lucene</td><td>Faceted search</td><td>20%</td></tr>
<tr><td>Java API</td><td><a href="https://github.com/orientechnologies/orientdb/issues/4813">ODocument.update()</a></td><td>0%</td></tr>
<tr><td>SQL</td><td><a href="https://github.com/orientechnologies/orientdb/issues/4474">shortestPaths() function</a></td><td>0%</td></tr>
<tr><td>SQL</td><td>New functions (strings, maths)</td><td>40%</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-in-five-minutes"><a class="header" href="#orientdb-in-five-minutes">OrientDB in Five Minutes</a></h1>
<p>Learn OrientDB basics in just five minutes, in your favorite programming language:</p>
<ul>
<li><a href="fiveminute/java.html">Java</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-for-java-developers-in-five-minutes"><a class="header" href="#orientdb-for-java-developers-in-five-minutes">OrientDB for Java Developers in Five Minutes</a></h1>
<p>If you are a Java Developer and it's the first time you approach OrientDB, then you are in the right place!</p>
<p>Ready? Let's start!</p>
<h2 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h2>
<p>To run OrientDB you will need a Java SDK installed on your machine. OrientDB runs with Java from Version 8 to 11.</p>
<h2 id="step-15---download-and-install"><a class="header" href="#step-15---download-and-install">Step 1/5 - Download and Install</a></h2>
<p>Download OrientDB from the following URL:</p>
<p><a href="https://orientdb.org/download">https://orientdb.org/download</a></p>
<p>Unzip it on your FileSystem and open a shell in the directory.</p>
<p>Now type</p>
<pre><code class="language-sh">cd orientdb-3.2.0
cd bin
</code></pre>
<p>(change the first <code>cd</code> with the exact version you downloaded)</p>
<p>and then, if you are on Linux/OSX, you can start the server with</p>
<pre><code class="language-sh">./server.sh
</code></pre>
<p>if you are on Windows, start the server with</p>
<pre><code class="language-sh">server.bat
</code></pre>
<p>You will see OrientDB starting</p>
<pre><code>          .`        `                                 
          ,      `:.                                  
         `,`    ,:`                                   
         .,.   :,,                                    
         .,,  ,,,                                     
    .    .,.:::::   `  `                                :::::::::     :::::::::   
    ,`   .::,,,,::.,,,,,,`;;                      .:    ::::::::::    :::    :::  
    `,.  ::,,,,,,,:.,,.`  `                       .:    :::      :::  :::     ::: 
     ,,:,:,,,,,,,,::.   `        `         ``     .:    :::      :::  :::     ::: 
      ,,:.,,,,,,,,,: `::, ,,   ::,::`   : :,::`  ::::   :::      :::  :::    :::  
       ,:,,,,,,,,,,::,:   ,,  :.    :   ::    :   .:    :::      :::  :::::::     
        :,,,,,,,,,,:,::   ,,  :      :  :     :   .:    :::      :::  :::::::::   
  `     :,,,,,,,,,,:,::,  ,, .::::::::  :     :   .:    :::      :::  :::     ::: 
  `,...,,:,,,,,,,,,: .:,. ,, ,,         :     :   .:    :::      :::  :::     ::: 
    .,,,,::,,,,,,,:  `: , ,,  :     `   :     :   .:    :::      :::  :::     ::: 
      ...,::,,,,::.. `:  .,,  :,    :   :     :   .:    :::::::::::   :::     ::: 
           ,::::,,,. `:   ,,   :::::    :     :   .:    :::::::::     ::::::::::  
           ,,:` `,,.                                  
          ,,,    .,`                                  
         ,,.     `,                                          GRAPH DATABASE  
       ``        `.                                                          
                 ``                                          orientdb.com
                 `                                    

2017-08-14 14:11:12:824 INFO  Loading configuration from: /Users/luigidellaquila/temp/orient/orientdb-community-3.0.0m2/config/orientdb-server-config.xml... [OServerConfigurationLoaderXml]
2017-08-14 14:11:12:932 INFO  OrientDB Server v3.0.0 (build 4abea780acc12595bad8cbdcc61ff96980725c3b) is starting up... [OServer]
2017-08-14 14:11:12:951 INFO  OrientDB auto-config DISKCACHE=12.373MB (heap=1.963MB direct=524.288MB os=16.384MB) [orientechnologies]
2017-08-14 14:11:12:994 INFO  Databases directory: /Users/luigidellaquila/temp/orient/orientdb-community-3.0.0m2/databases [OServer]
2017-08-14 14:11:13:017 INFO  Creating the system database 'OSystem' for current server [OSystemDatabase]
2017-08-14 14:11:14:457 INFO  Listening binary connections on 0.0.0.0:2424 (protocol v.37, socket=default) [OServerNetworkListener]
2017-08-14 14:11:14:459 INFO  Listening http connections on 0.0.0.0:2480 (protocol v.10, socket=default) [OServerNetworkListener]

+---------------------------------------------------------------+
|                WARNING: FIRST RUN CONFIGURATION               |
+---------------------------------------------------------------+
| This is the first time the server is running. Please type a   |
| password of your choice for the 'root' user or leave it blank |
| to auto-generate it.                                          |
|                                                               |
| To avoid this message set the environment variable or JVM     |
| setting ORIENTDB_ROOT_PASSWORD to the root password to use.   |
+---------------------------------------------------------------+

Root password [BLANK=auto generate it]: *
</code></pre>
<p>The first time you start the server, you will be asked to enter a root password (twice). You can choose the password you prefer,
just make sure to remember it, you will need it alter.</p>
<p>Now you are ready for the <a href="fiveminute/java-1.html">Next Step - Create a Database &gt;&gt;&gt;</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-for-java-developers-in-five-minutes-1"><a class="header" href="#orientdb-for-java-developers-in-five-minutes-1">OrientDB for Java Developers in Five Minutes</a></h1>
<p>In the <a href="fiveminute/java.html">Previous Step</a> you installed and started OrientDB on your machine, now it's time to create a database</p>
<h2 id="step-25---create-a-db"><a class="header" href="#step-25---create-a-db">Step 2/5 - Create a DB</a></h2>
<p>Open your favourite browser (modern browser, no IE please!) and enter the following URL:</p>
<p>http://localhost:2480/studio/index.html</p>
<p>You will see this page:</p>
<ul>
<li>Click on "NEW DB"</li>
</ul>
<p><img src="fiveminute/images/studio-login.png" alt="StudioLogin" /></p>
<ul>
<li>enter "test" as database name</li>
<li>enter the root password</li>
</ul>
<p><img src="fiveminute/images/studio-create-database-3.2.png" alt="StudioCreateDb" /></p>
<ul>
<li>Then click on "CREATE DATABASE"</li>
</ul>
<blockquote>
<p>IMPORTANT: In v 3.2 new databases are created without default db users (admin/reader/writer) to avoid possible vulnerabilities due to default passwords. In this dialog you can select "Create Admin user" and enter a custom admin password for this user.</p>
</blockquote>
<p><strong>Good job! You just created your first database!</strong></p>
<p>Now, to make sure that everything is OK, try to enter the following query</p>
<pre><code class="language-sql">SELECT * FROM OUser
</code></pre>
<p>and click the green "RUN" button. You should see the three default users that OrientDB creates for you: admin, reader and writer</p>
<p><img src="fiveminute/images/studio-browser-2.png" alt="StudioBrowser" /></p>
<p>Now you are ready for the <a href="fiveminute/java-2.html">Next Step - Create your Java Application &gt;&gt;&gt;</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-for-java-developers-in-five-minutes-2"><a class="header" href="#orientdb-for-java-developers-in-five-minutes-2">OrientDB for Java Developers in Five Minutes</a></h1>
<p>In the <a href="fiveminute/java-1.html">previous step</a> you created your first database, now it's time to create a Java application that can connect to the DB,
query and manipulate it.</p>
<p>From now on, for this tutorial we will use IntelliJ Idea, but you can use any IDE that supports Java 8 and Maven.</p>
<h2 id="step-35---create-a-maven-project"><a class="header" href="#step-35---create-a-maven-project">Step 3/5 - Create a Maven project</a></h2>
<p>Open IntelliJ Idea and:</p>
<ul>
<li>choose the menu <strong>File</strong> -&gt; <strong>new</strong> -&gt; <strong>Project...</strong></li>
</ul>
<p><img src="fiveminute/images/idea-new.png" alt="IdeaNew" /></p>
<ul>
<li>from the left menu, choose <strong>Maven</strong></li>
<li>make sure that <strong>Project SDK</strong> is greater or equal to 1.8</li>
<li>click <strong>Next</strong></li>
</ul>
<p><img src="fiveminute/images/idea-new-maven.png" alt="IdeaNew" /></p>
<ul>
<li>choose your <strong>GroupId</strong> and <strong>ArtifactId</strong> (we will use "test" "test", as this is what we are doing  ;-) )</li>
<li>click <strong>Next</strong> twice</li>
</ul>
<p><img src="fiveminute/images/idea-new-maven2.png" alt="IdeaNew" /></p>
<p>Now open <strong>pom.xml</strong> file and add the following dependency:</p>
<pre><code class="language-xml">    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.orientechnologies&lt;/groupId&gt;
            &lt;artifactId&gt;orientdb-client&lt;/artifactId&gt;
            &lt;version&gt;3.0.0&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
</code></pre>
<blockquote>
<blockquote>
<p>IMPORTANT: make sure you are using the same client version as the server you are using.</p>
</blockquote>
</blockquote>
<p>and enable Java 8 as target compiler</p>
<pre><code class="language-xml">    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;source&gt;1.8&lt;/source&gt;
                    &lt;target&gt;1.8&lt;/target&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
</code></pre>
<p>Click on "automatically import dependencies" if needed</p>
<p><img src="fiveminute/images/idea-pom.png" alt="IdeaNew" /></p>
<p>Now you are ready for the <a href="fiveminute/java-3.html">Next Step - Open a DB Connection and Create the DB Schema &gt;&gt;&gt;</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-for-java-developers-in-five-minutes-3"><a class="header" href="#orientdb-for-java-developers-in-five-minutes-3">OrientDB for Java Developers in Five Minutes</a></h1>
<p>In the <a href="fiveminute/java-2.html">previous step</a> you created your Java application scaffolding in IntelliJ Idea, now it's time to create a Java class that connects to the database and does basic operations</p>
<p>We will write a very simple application with two classes:</p>
<ul>
<li><strong>Person</strong>: a vertex type containing information about people</li>
<li><strong>FriendOf</strong>: an edge class that connects people together</li>
</ul>
<h2 id="step-45---connect-to-the-db-and-create-a-basic-schema"><a class="header" href="#step-45---connect-to-the-db-and-create-a-basic-schema">Step 4/5 - Connect to the DB and create a basic schema</a></h2>
<p>Let's create a simple Java class</p>
<ul>
<li>Open the folder <strong>src</strong> -&gt; <strong>main</strong> -&gt; <strong>java</strong></li>
<li>Right-click on the <strong>java</strong> folder and choose <strong>New</strong> -&gt; <strong>Java Class</strong></li>
</ul>
<p><img src="fiveminute/images/idea-new-class.png" alt="NewClass" /></p>
<ul>
<li>Give the class the name you prefer and click <strong>OK</strong></li>
<li>create a <em>main</em> method</li>
</ul>
<h4 id="connecting-to-the-db"><a class="header" href="#connecting-to-the-db">Connecting to the DB</a></h4>
<p>Now it's time to connect to OrientDB</p>
<ul>
<li>Create an OrientDB object to manage the remote server</li>
<li>Also invoke a <code>close()</code> at the end of the method (so that you don't forget it later)</li>
</ul>
<pre><code class="language-java">    OrientDB orient = new OrientDB("remote:localhost", OrientDBConfig.defaultConfig());

    //let's do something with this server!
    
    orient.close();
</code></pre>
<p>The first argument of <code>OrientDB()</code> constructor is the URL of the remote database. It's made of two parts:</p>
<ul>
<li><code>remote</code>: specifies that we are connecting to a remote (stand-alone) server</li>
<li><code>localhost</code>: the address of the host where OrientDB is running (it can be a URL or an IP, in this case orientdb is running on the local machine)</li>
</ul>
<p><img src="fiveminute/images/idea-main.png" alt="NewClass" /></p>
<p>Until now, we just established a connection with the server, but not with the database itself (we created a db named <em>test</em>, do you remember?).</p>
<p>Now it's time to open a database session (and remember to close it at the end!):</p>
<pre><code class="language-java">    OrientDB orient = new OrientDB("remote:localhost", OrientDBConfig.defaultConfig());
    ODatabaseSession db = orient.open("test", "admin", "admin");
    
    //let's do something with this session!
    
    db.close();    
    orient.close();
</code></pre>
<p>Here we are actually connecting to the database. The three parameters are:</p>
<ul>
<li><code>test</code>: the database name (we created it a couple of steps before)</li>
<li><code>admin</code> (the first one): the username used to connect</li>
<li><code>admin</code> (the second one): the password for the connection</li>
</ul>
<p>By default, when you create a new database, OrientDB creates three users for you: <code>admin</code>, <code>reader</code>, <code>writer</code>; the passwords
for these users are the same as the user names, eg. the password for <code>admin</code> is <code>admin</code>. You can change it later of course, and you can
define more users if needed.</p>
<h4 id="creating-the-schema"><a class="header" href="#creating-the-schema">Creating the schema</a></h4>
<p>Now it's time to create a schema for our db. Do you remember? We are creating a graph of people who are friends, so we need a <code>Person</code>
vertex class and a <code>FriendOf</code> edge class.</p>
<p>Let's also add a little check to make sure that the classes do not already exist</p>
<pre><code class="language-java">    if (db.getClass("Person") == null) {
      db.createVertexClass("Person");
    }
    if (db.getClass("FriendOf") == null) {
      db.createEdgeClass("FriendOf");
    }
</code></pre>
<p>And this is the final version of our class</p>
<p><img src="fiveminute/images/idea-main2.png" alt="NewClass" /></p>
<p>This is the full source code:</p>
<pre><code class="language-java">import com.orientechnologies.orient.core.db.ODatabaseSession;
import com.orientechnologies.orient.core.db.OrientDB;
import com.orientechnologies.orient.core.db.OrientDBConfig;

public class Main {

  public static void main(String[] args) {

    OrientDB orient = new OrientDB("remote:localhost", OrientDBConfig.defaultConfig());
    ODatabaseSession db = orient.open("test", "admin", "admin");

    if (db.getClass("Person") == null) {
      db.createVertexClass("Person");
    }
    if (db.getClass("FriendOf") == null) {
      db.createEdgeClass("FriendOf");
    }

    db.close();
    orient.close();

  }

}
</code></pre>
<p>Now just run it and then open OrientDB Studio again:</p>
<ul>
<li>go back to the browser (OrientDB Studio)</li>
<li>click on the <strong>SCHEMA</strong> tab</li>
</ul>
<p>you will see the two newly created classes: <code>Person</code> and <code>FriendOf</code></p>
<p><img src="fiveminute/images/studio-schema.png" alt="NewClass" /></p>
<p>Just to make it a bit more realistic, let's also create some basic schema for our <code>Person</code> class.</p>
<p>We will just add a <code>name</code> to the Person and we will create an index on it.</p>
<pre><code class="language-java">    OClass person = db.getClass("Person");

    if (person == null) {
      person = db.createVertexClass("Person");
    }
    
    if (person.getProperty("name") == null) {
      person.createProperty("name", OType.STRING);
      
      //                     index name                index type          property name
      person.createIndex("Person_name_index", OClass.INDEX_TYPE.NOTUNIQUE, "name");
    }

</code></pre>
<p>And this is the final result:</p>
<pre><code class="language-java">import com.orientechnologies.orient.core.db.ODatabaseSession;
import com.orientechnologies.orient.core.db.OrientDB;
import com.orientechnologies.orient.core.db.OrientDBConfig;
import com.orientechnologies.orient.core.metadata.schema.OClass;
import com.orientechnologies.orient.core.metadata.schema.OType;

public class Main {

  public static void main(String[] args) {

    OrientDB orient = new OrientDB("remote:localhost", OrientDBConfig.defaultConfig());
    ODatabaseSession db = orient.open("test", "admin", "admin");

    OClass person = db.getClass("Person");

    if (person == null) {
      person = db.createVertexClass("Person");
    }
    
    if (person.getProperty("name") == null) {
      person.createProperty("name", OType.STRING);
      person.createIndex("Person_name_index", OClass.INDEX_TYPE.NOTUNIQUE, "name");
    }

    if (db.getClass("FriendOf") == null) {
      db.createEdgeClass("FriendOf");
    }

    db.close();
    orient.close();

  }
}
</code></pre>
<p>Now you are ready for the <a href="fiveminute/java-4.html">Next Step - Create your First Graph and Run Queries &gt;&gt;&gt;</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-for-java-developers-in-five-minutes-4"><a class="header" href="#orientdb-for-java-developers-in-five-minutes-4">OrientDB for Java Developers in Five Minutes</a></h1>
<p>In the <a href="fiveminute/java-3.html">previous step</a> you established a DB connection from Java, then you created the DB schema (two classes and an index)</p>
<p>Now it's time to insert and query some data</p>
<h2 id="step-55---create-and-query-a-graph"><a class="header" href="#step-55---create-and-query-a-graph">Step 5/5 - Create and Query a Graph</a></h2>
<p>First of all, let's create three vertices: Alice, Bob and Jim</p>
<h4 id="creating-vertices"><a class="header" href="#creating-vertices">Creating vertices</a></h4>
<p>We are good Java developers, aren't we? Let's encapsulate a single vertex creation in a method:</p>
<pre><code class="language-java">  private static OVertex createPerson(ODatabaseSession db, String name, String surname) {
    OVertex result = db.newVertex("Person");
    result.setProperty("name", name);
    result.setProperty("surname", surname);
    result.save();
    return result;
  }
</code></pre>
<p><em>Wow, we never mentioned that people have a <code>surname</code>!!! In the previous section we just defined the schema for <code>name</code> property...</em></p>
<p>OrientDB can work <em>schemaful</em> (with all the property names and types defined), <em>schemaless</em> (schema-free, no schema defined) or <em>schema-mixed</em> like in this case, where we define a part of the schema (ie. the <code>name</code>) but we leave the developer the ability to add new properties at run time, without having to deal with further schema definitions.</p>
<p>Now let's create the three vertices:</p>
<pre><code class="language-java">  private static void createPeople(ODatabaseSession db){
    OVertex alice = createPerson(db, "Alice", "Foo");
    OVertex bob = createPerson(db, "Bob", "Bar");
    OVertex jim = createPerson(db, "Jim", "Baz");
  }
</code></pre>
<h4 id="creating-edges"><a class="header" href="#creating-edges">Creating edges</a></h4>
<p>Suppose that Alice is a friend of Bob and that Bob is a friend of Jim:</p>
<pre><code>Alice --FriendOf--&gt; Bob --FriendOf--&gt; Jim
</code></pre>
<p>Let's create the edges in the database:</p>
<pre><code class="language-java">    OEdge edge1 = alice.addEdge(bob, "FriendOf");
    edge1.save();
    OEdge edge2 = bob.addEdge(jim, "FriendOf");
    edge2.save();
</code></pre>
<p>Please consider that edges are plain documents, so you can get/set properties on them exactly like for vertices.</p>
<h4 id="executing-queries"><a class="header" href="#executing-queries">Executing queries</a></h4>
<p>Last step of this journey: let's write and execute a simple query that finds friends of friends (FoaF) of a person.
We will use a <a href="fiveminute/../sql/SQL-Query.html">SELECT</a> for this.</p>
<pre><code class="language-java">  private static void executeAQuery(ODatabaseSession db) {
    String query = "SELECT expand(out('FriendOf').out('FriendOf')) from Person where name = ?";
    OResultSet rs = db.query(query, "Alice");

    while (rs.hasNext()) {
      OResult item = rs.next();
      System.out.println("friend: " + item.getProperty("name"));
    }

    rs.close(); //REMEMBER TO ALWAYS CLOSE THE RESULT SET!!!
  }
</code></pre>
<p>or, if you prefer Java Streams API:</p>
<pre><code class="language-java">  private static void executeAQuery(ODatabaseSession db) {
    String query = "SELECT expand(out('FriendOf').out('FriendOf')) from Person where name = ?";
    OResultSet rs = db.query(query, "Alice");
    rs.stream().forEach(x -&gt; System.out.println("friend: " + x.getProperty("name")));
    rs.close();
  }
</code></pre>
<p>Let's try a more complex query, let's find all the people that are friends of both Alice and Jim.
We will use a <a href="fiveminute/../sql/SQL-Match.html">MATCH</a> for this.</p>
<pre><code class="language-java">  private static void executeAnotherQuery(ODatabaseSession db) {
    String query =
        " MATCH                                           " +
        "   {class:Person, as:a, where: (name = :name1)}, " +
        "   {class:Person, as:b, where: (name = :name2)}, " +
        "   {as:a} -FriendOf-&gt; {as:x} -FriendOf-&gt; {as:b}  " +
        " RETURN x.name as friend                         ";

    Map&lt;String, Object&gt; params = new HashMap&lt;String, Object&gt;();
    params.put("name1", "Alice");
    params.put("name2", "Jim");

    OResultSet rs = db.query(query, params);

    while (rs.hasNext()) {
      OResult item = rs.next();
      System.out.println("friend: " + item.getProperty("name"));
    }

    rs.close();
  }
</code></pre>
<h3 id="good-job-this-is-your-first-orientdb-java-program"><a class="header" href="#good-job-this-is-your-first-orientdb-java-program">Good job!!! This is your first OrientDB Java program!</a></h3>
<p>Here is the full source code of the main class:</p>
<pre><code class="language-java">import com.orientechnologies.orient.core.db.ODatabaseSession;
import com.orientechnologies.orient.core.db.OrientDB;
import com.orientechnologies.orient.core.db.OrientDBConfig;
import com.orientechnologies.orient.core.metadata.schema.OClass;
import com.orientechnologies.orient.core.metadata.schema.OType;
import com.orientechnologies.orient.core.record.OEdge;
import com.orientechnologies.orient.core.record.OVertex;
import com.orientechnologies.orient.core.sql.executor.OResult;
import com.orientechnologies.orient.core.sql.executor.OResultSet;

import java.util.HashMap;
import java.util.Map;

public class Main {

  public static void main(String[] args) {

    OrientDB orient = new OrientDB("remote:localhost", OrientDBConfig.defaultConfig());
    ODatabaseSession db = orient.open("test", "admin", "admin");

    createSchema(db);

    createPeople(db);

    executeAQuery(db);

    executeAnotherQuery(db);

    db.close();
    orient.close();

  }

  private static void createSchema(ODatabaseSession db) {
    OClass person = db.getClass("Person");

    if (person == null) {
      person = db.createVertexClass("Person");
    }

    if (person.getProperty("name") == null) {
      person.createProperty("name", OType.STRING);
      person.createIndex("Person_name_index", OClass.INDEX_TYPE.NOTUNIQUE, "name");
    }

    if (db.getClass("FriendOf") == null) {
      db.createEdgeClass("FriendOf");
    }

  }

  private static void createPeople(ODatabaseSession db) {
    OVertex alice = createPerson(db, "Alice", "Foo");
    OVertex bob = createPerson(db, "Bob", "Bar");
    OVertex jim = createPerson(db, "Jim", "Baz");

    OEdge edge1 = alice.addEdge(bob, "FriendOf");
    edge1.save();
    OEdge edge2 = bob.addEdge(jim, "FriendOf");
    edge2.save();
  }

  private static OVertex createPerson(ODatabaseSession db, String name, String surname) {
    OVertex result = db.newVertex("Person");
    result.setProperty("name", name);
    result.setProperty("surname", surname);
    result.save();
    return result;
  }

  private static void executeAQuery(ODatabaseSession db) {
    String query = "SELECT expand(out('FriendOf').out('FriendOf')) from Person where name = ?";
    OResultSet rs = db.query(query, "Alice");

    while (rs.hasNext()) {
      OResult item = rs.next();
      System.out.println("friend: " + item.getProperty("name"));
    }

    rs.close(); //REMEMBER TO ALWAYS CLOSE THE RESULT SET!!!
  }

  private static void executeAnotherQuery(ODatabaseSession db) {
    String query =
        " MATCH                                           " +
        "   {class:Person, as:a, where: (name = :name1)}, " +
        "   {class:Person, as:b, where: (name = :name2)}, " +
        "   {as:a} -FriendOf-&gt; {as:x} -FriendOf-&gt; {as:b}  " +
        " RETURN x.name as friend                         ";

    Map&lt;String, Object&gt; params = new HashMap&lt;String, Object&gt;();
    params.put("name1", "Alice");
    params.put("name2", "Jim");

    OResultSet rs = db.query(query, params);

    while (rs.hasNext()) {
      OResult item = rs.next();
      System.out.println("friend: " + item.getProperty("friend"));
    }

    rs.close();
  }

}
</code></pre>
<h2 id="next-steps"><a class="header" href="#next-steps">Next steps:</a></h2>
<p>You may be interested in:</p>
<ul>
<li><a href="fiveminute/../java/Java-MultiModel-API.html">More details about the Java Multi-Model API</a></li>
<li><a href="fiveminute/../sql/README.html">Full SQL Syntax</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="getting-started"><a class="header" href="#getting-started">Getting Started</a></h1>
<p>Over the past few years, there has been an explosion of many NoSQL database solutions and products. The meaning of the word "NoSQL" is not a campaign against the SQL language. In fact, OrientDB allows for SQL syntax! NoSQL is probably best described by the following:</p>
<blockquote>
<p>NoSQL, meaning "not only SQL", is a movement encouraging developers and business people to open their minds and consider new possibilities beyond the classic relational approach to data persistence.</p>
</blockquote>
<p>Alternatives to relational database management systems have existed for many years, but they have been relegated primarily to niche use cases such as telecommunications, medicine, CAD and others. Interest in NoSQL alternatives like OrientDB is increasing dramatically. Not surprisingly, many of the largest web companies like Google, Amazon, Facebook, Foursquare and Twitter are using NoSQL based solutions in their production environments.</p>
<p>What motivates companies to leave the comfort of a well established relational database world? It is basically the great need to better solve today's data problems. Specifically, there are a few key areas:</p>
<ul>
<li>Performance</li>
<li>Scalability (often huge)</li>
<li>Smaller footprint</li>
<li>Developer productivity and friendliness</li>
<li>Schema flexibility</li>
</ul>
<p>Most of these areas also happen to be the requirements of modern web applications. A few years ago, developers designed systems that could handle hundreds of concurrent users. Today it is not uncommon to have a potential target of thousands or millions of users connected and served at the same time.</p>
<p>Changing technology requirements have been taken into account on the application front by creating frameworks, introducing standards and leveraging best practices. However, in the database world, the situation has remained more or less the same for over 30 years. From the 1970s until recently, relational DBMSs have played the dominant role. Programming languages and methodologies have evolved, but the concept of data persistence and the DBMS have remained unchanged for the most part: it is all still tables, records and joins.</p>
<h2 id="nosql-models"><a class="header" href="#nosql-models">NoSQL Models</a></h2>
<p>NoSQL-based solutions in general provide a powerful, scalable, and flexible way to solve data needs and use cases, which have previously been managed by relational databases. To summarize the NoSQL options, we'll examine the most common models or categories:</p>
<ul>
<li>
<p><strong>Key / Value databases</strong>: where the data model is reduced to a simple hash table, which consists of key / value pairs. It is often easily distributed across multiple servers. The most recognized products of this group include Redis, Dynamo, and Riak.</p>
</li>
<li>
<p><strong>Column-oriented databases</strong>: where the data is stored in sections of columns offering more flexibility and easy aggregation. Facebook's Cassandra, Google's BigTable, and Amazon's SimpleDB are some examples of column-oriented databases.</p>
</li>
<li>
<p><strong>Document databases</strong>: where the data model consists of document collections, in which each individual document can have multiple fields without necessarily having a defined schema. The best known products of this group are MongoDB and CouchDB.</p>
</li>
<li>
<p><strong>Graph databases</strong>: where the domain model consists of vertices interconnected by edges creating rich graph structures. The best known products of this group are OrientDB, Neo4j and Titan.</p>
</li>
</ul>
<blockquote>
<p>OrientDB is a document-graph database, meaning it has full native graph capabilities coupled with features normally only found in document databases.</p>
</blockquote>
<p>Each of these categories or models has its own peculiarities, strengths and limitations. There is no single category or model, which is better than the others. However, certain types of databases are better at solving specific problems. This leads to the motto of NoSQL: choose the best tool for your specific use case.</p>
<p>The goal of Orient Technologies in building OrientDB was to create a robust, highly scalable  database that can perform optimally in the widest possible set of use cases. Our product is designed to be a fantastic "go to" solution for practically all of your data persistence needs. In the following parts of this tutorial, we will look closely at <strong>OrientDB</strong>, one of the best open-source, multi-model, next generation NoSQL products on the market today.</p>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-12-10 SAM -->
<h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<p>For a complete installation guide, see <a href="gettingstarted/../admin/installation/README.html">OrientDB Server Administration - Installation</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="running-the-orientdb-server"><a class="header" href="#running-the-orientdb-server">Running the OrientDB Server</a></h1>
<p>When you finish installing OrientDB, whether you build it from source or download the binary package, you are ready to launch the database server.  You can either start it through the system daemon or through the provided server script.  This article only covers the latter.</p>
<blockquote>
<p><strong>Note</strong>: If you would like to run OrientDB as a service on your system, there are some additional steps that you need to take.  This provides alternate methods for starting the server and allows you to launch it as a daemon when your system boots.<br />
Note that you need to start the OrientDB server once manually via server.sh|bat in %ORIENTDB_HOME%\bin once, before starting the service.</p>
</blockquote>
<p>For more information on this process see:</p>
<blockquote>
<ul>
<li><a href="gettingstarted/../admin/Unix-Service.html">Install OrientDB as a Service on Unix, Linux and Mac OS X</a></li>
<li><a href="gettingstarted/../admin/Windows-Service.html">Install OrientDB as a Service on Microsoft Windows</a></li>
</ul>
</blockquote>
<h2 id="starting-the-database-server"><a class="header" href="#starting-the-database-server">Starting the Database Server</a></h2>
<p>While you can run the database server as system daemon, you also have the option of starting it directly.  In the OrientDB installation directory, (that is <code>$ORIENTDB_HOME</code>), under <code>bin</code>, there is a file named <code>server.sh</code> on Unix-based systems and <code>server.bat</code> on Windows.  Executing this file starts the server.</p>
<p>To launch the OrientDB database server, run the following commands:</p>
<pre>
$ <code class="lang-sh userinput">cd $ORIENTDB_HOME/bin</code>
$ <code class="lang-sh userinput">./server.sh</code>

            .
           .`        `
        ,      `:.
          `,`    ,:`
          .,.   :,,
          .,,  ,,,
     .    .,.:::::  ````
     ,`   .::,,,,::.,,,,,,`;;                      .:
     `,.  ::,,,,,,,:.,,.`  `                       .:
      ,,:,:,,,,,,,,::.   `        `         ``     .:
       ,,:.,,,,,,,,,: `::, ,,   ::,::`   : :,::`  ::::
        ,:,,,,,,,,,,::,:   ,,  :.    :   ::    :   .:
         :,,,,,,,,,,:,::   ,,  :      :  :     :   .:
   `     :,,,,,,,,,,:,::,  ,, .::::::::  :     :   .:
   `,...,,:,,,,,,,,,: .:,. ,, ,,         :     :   .:
     .,,,,::,,,,,,,:  `: , ,,  :     `   :     :   .:
       ...,::,,,,::.. `:  .,,  :,    :   :     :   .:
            ,::::,,,. `:   ,,   :::::    :     :   .:
            ,,:` `,,.
           ,,,    .,`
          ,,.     `,                      S E R V E R
        ``        `.
                  ``
                  `

2012-12-28 01:25:46:319 INFO Loading configuration from: config/orientdb-server-config.xml... [OServerConfigurationLoaderXml]
2012-12-28 01:25:46:625 INFO OrientDB Server v1.6 is starting up... [OServer]
2012-12-28 01:25:47:142 INFO -> Loaded memory database 'temp' [OServer]
2012-12-28 01:25:47:289 INFO Listening binary connections on 0.0.0.0:2424 [OServerNetworkListener]
2012-12-28 01:25:47:290 INFO Listening http connections on 0.0.0.0:2480 [OServerNetworkListener]
2012-12-28 01:25:47:317 INFO OrientDB Server v1.6 is active. [OServer]
</pre>
<p>The database server is now running.  It is accessible on your system through ports <code>2424</code> and <code>2480</code>.
At the first startup the server will ask for the root user password. The password is stored in the config file.</p>
<h3 id="stop-the-server"><a class="header" href="#stop-the-server">Stop the Server</a></h3>
<p>On the console where the server is running a simple CTRL+c will shutdown the server.</p>
<p>The shutdown.sh (shutdown.bat) script could be used to stop the server:</p>
<pre>
$ <code class="lang-sh userinput">cd $ORIENTDB_HOME/bin</code>
$ <code class="lang-sh userinput">./shutdown.sh -p ROOT_PASSWORD</code>
</pre>
<p>On *<strong>nix</strong> systems a simple call to shutdown.sh will stop the server running on localhost:</p>
<pre>
$ <code class="lang-sh userinput">cd $ORIENTDB_HOME/bin</code>
$ <code class="lang-sh userinput">./shutdown.sh</code>
</pre>
<p>It is possible to stop servers running on remote hosts or even on different ports on localhost:</p>
<pre>
$ <code class="lang-sh userinput">cd $ORIENTDB_HOME/bin</code>
$ <code class="lang-sh userinput">./shutdown.sh -h odb1.mydomain.com -P 2424-2430 -u root -p ROOT_PASSWORD</code>
</pre>
<p>List of params</p>
<ul>
<li>-h | --host <strong>HOSTNAME or IP ADDRESS</strong> : the host or ip where OrientDB is running, default to <strong>localhost</strong></li>
<li>-P | --ports <strong>PORT or PORT RANGE</strong> : single port value or range of ports; default to <strong>2424-2430</strong></li>
<li>-u | --user <strong>ROOT USERNAME</strong> : root's username; default to  <strong>root</strong></li>
<li>-p | --password <strong>ROOT PASSWORD</strong> : root's user password; <strong>mandatory</strong></li>
</ul>
<blockquote>
<p><strong>NOTE</strong>: On Windows systems password is always <strong>mandatory</strong> because the script isn't able to discover the pid of the OrientDB's process.</p>
</blockquote>
<h3 id="server-log-messages"><a class="header" href="#server-log-messages">Server Log Messages</a></h3>
<p>Following the masthead, the database server begins to print log messages to standard output.  This provides you with a guide to what OrientDB does as it starts up on your system.</p>
<ol>
<li>
<p>The database server loads its configuration file from the file <code>$ORIENTDB_HOME/config/orientdb-server-config.xml</code>.</p>
<blockquote>
<p>For more information on this step, see <a href="gettingstarted/../internals/DB-Server.html">OrientDB Server</a>.</p>
</blockquote>
</li>
<li>
<p>The database server loads the <code>temp</code> database into memory.  You can use this database for storing temporary data.</p>
</li>
<li>
<p>The database server begins listening for binary connections on port <code>2424</code> for all configured networks, (<code>0.0.0.0</code>).</p>
</li>
<li>
<p>The database server begins listening for HTTP connections on port <code>2480</code> for all configured networks, (<code>0.0.0.0</code>).</p>
</li>
</ol>
<h2 id="accessing-the-database-server"><a class="header" href="#accessing-the-database-server">Accessing the Database Server</a></h2>
<p>By default, OrientDB listens on two different ports for external connections.</p>
<ul>
<li>
<p><strong>Binary</strong>: OrientDB listens on port <code>2424</code> for binary connections from the console and for clients and drivers that support the <a href="gettingstarted/../internals/Network-Binary-Protocol.html">Network Binary Protocol</a>.</p>
</li>
<li>
<p><strong>HTTP</strong>: OrientDB listens on port <code>2480</code> for HTTP connections from <a href="http://www.orientechnologies.com/docs/last/orientdb-studio.wiki/Home-page.html">OrientDB Studio Web Tool</a> and clients and drivers that support the <a href="gettingstarted/../misc/OrientDB-REST.html">HTTP/REST protocol</a>, or similar tools, such as <a href="http://en.wikipedia.org/wiki/cURL">cURL</a>.</p>
</li>
</ul>
<p>If you would like the database server to listen at different ports or IP address, you can define these values in the configuration file <code>config/orientdb-server-config.xml</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-11-26 SAM -->
<h1 id="running-the-orientdb-console"><a class="header" href="#running-the-orientdb-console">Running the OrientDB Console</a></h1>
<p>Once the server is running there are various methods you can use to connect to your database server to an individual databases.  Two such methods are the <a href="gettingstarted/../internals/Network-Binary-Protocol.html">Network Binary</a> and <a href="gettingstarted/../misc/OrientDB-REST.html">HTTP/REST</a> protocols.  In addition to these OrientDB provides a command-line interface for connecting to and working with the database server.</p>
<p><img src="gettingstarted/../images/runConsole-connectToDatabase.png" alt="consoleOverview" /></p>
<h2 id="starting-the-orientdb-console"><a class="header" href="#starting-the-orientdb-console">Starting the OrientDB Console</a></h2>
<p>In the OrientDB installation directory (that is, <code>$ORIENTDB_HOME</code>, where you installed the database) under <code>bin</code>, there is a file called <code>console.sh</code> for Unix-based systems or <code>console.bat</code> for Windows users.</p>
<p>To launch the OrientDB console, run the following command after you start the database server:</p>
<pre>
$ <code class="lang-sh userinput">cd $ORIENTDB_HOME/bin</code>
$ <code class="lang-sh userinput">./console.sh</code>

OrientDB console v.X.X.X (build 0) www.orientdb.com
Type 'HELP' to display all the commands supported.
Installing extensions for GREMLIN language v.X.X.X

orientdb>
</pre>
<p>The OrientDB console is now running.  From this prompt you can connect to and manage any remote or local databases available to you.</p>
<h2 id="using-the-help-command"><a class="header" href="#using-the-help-command">Using the <code>HELP</code> Command</a></h2>
<p>In the event that you are unfamiliar with OrientDB and the available commands, or if you need help at any time, you can use the <code>HELP</code> command, or type <code>?</code> into the console prompt.</p>
<pre>
orientdb> <code class="lang-sql userinput">HELP</code>

AVAILABLE COMMANDS:
 * alter class &lt;command-text&gt;   Alter a class in the database schema
 * alter cluster &lt;command-text&gt; Alter class in the database schema
 ...                            ...
 * help                         Print this help
 * exit                         Close the console
</pre>
<p>For each console command available to you, <code>HELP</code> documents its basic use and what it does.  If you know the particular command and need details on its use, you can provide arguments to <code>HELP</code> for further clarification.</p>
<pre>
orientdb> <code class="lang-sql userinput">HELP SELECT</code>

COMMAND: SELECT
- Execute a query against the database and display the results.
SYNTAX: select &lt;query-text&gt;
WHERE:
- &lt;query-text&gt;: The query to execute
</pre>
<h2 id="connecting-to-server-instances"><a class="header" href="#connecting-to-server-instances">Connecting to Server Instances</a></h2>
<p>There are some console commands, such as <code>LIST DATABASES</code> or <code>CREATE DATABASE</code>, which you can only run while connected to a server instance.  For other commands, however, you must also connect to a database, before they run without error.</p>
<blockquote>
<p>Before you can connect to a fresh server instance and fully control it, you need to know the <a href="gettingstarted/../security/Server-Security.html">root password</a> for the database.</p>
</blockquote>
<p>With the required credentials, you can connect to the database server instance on your system, or establish a remote connection to one running on a different machine.</p>
<pre>
orientdb> <code class="lang-sql userinput">CONNECT remote:localhost root my_root_password</code>

Connecting to remote Server instance [remote:localhost] with user 'root'...OK
</pre>
<p>Once you have established a connection to the database server, you can begin to execute commands on that server, such as <code>LIST DATABASES</code> and <code>CREATE DATABASE</code>.</p>
<pre>
orientdb> <code class="lang-sql userinput">LIST DATABASES</code>

Found 1 databases:
* GratefulDeadConcerts (plocal)
 </pre>
<p>To connect to this database or to a different one, use the <code>CONNECT</code> command from the console and specify the server URL, username, and password.  By default, each database has an <code>admin</code> user with a password of <code>admin</code>.</p>
<blockquote>
<p><strong>Warning</strong>: Always <a href="gettingstarted/../security/Database-Security.html#users">change the default password</a> on production databases.</p>
</blockquote>
<p>The above <code>LIST DATABASES</code> command shows a <code>GratefulDeadConcerts</code> installed on the local server.  To connect to this database, run the following command:</p>
<pre>
orientdb> <code class="lang-sql userinput">CONNECT remote:localhost/GratefulDeadConcerts admin admin</code>

Connecting to database [remote:localhost/GratefulDeadConcerts] with user 'admin'...OK
</pre>
<p>The <code>CONNECT</code> command takes a specific syntax for its URL.  That is, <code>remote:localhost/GratefulDeadConcerts</code> in the example.  It has three parts:</p>
<ul>
<li>
<p><strong>Protocol</strong>: The first part of the database address is the protocol the console should use in the connection.  In the example, this is <code>remote</code>, indicating that it should use the TCP/IP protocol.</p>
</li>
<li>
<p><strong>Address</strong>: The second part of the database address is hostname or IP address of the database server that you want the console to connect to.  In the example, this is <code>localhost</code>, since the connection is made to a server instance running on the local file system.</p>
</li>
<li>
<p><strong>Database</strong>: The third part of the address is the name of the database that you want to use.  In the case of the example, this is <code>GratefulDeadConcerts</code>.</p>
</li>
</ul>
<p>For more detailed information about the commands, see <a href="gettingstarted/../console/Console-Commands.html">Console Commands</a>.</p>
<blockquote>
<p><strong>Note</strong>: The OrientDB distribution comes with the bundled database <code>GratefulDeadConcerts</code> which represents the Graph of the <a href="http://en.wikipedia.org/wiki/Grateful_Dead">Grateful Dead's</a> concerts. This database can be used by anyone to start exploring the features and characteristics of OrientDB.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="run-the-studio"><a class="header" href="#run-the-studio">Run the Studio</a></h1>
<p>If you're more comfortable interacting with database systems through a graphical interface then you can accomplish the most common database tasks with OrientDB Studio, the web interface.
<img src="gettingstarted//images/runStudio.png" alt="ConnectToStudio" /></p>
<h2 id="connecting-to-studio"><a class="header" href="#connecting-to-studio">Connecting to Studio</a></h2>
<p>By default, there are no additional steps that you need to take to start OrientDB Studio. When you launch the Server, whether through the start-up script <code>server.sh</code> or as a system daemon, the Studio web interface opens automatically with it.</p>
<pre>
$ <code class="lang-sh userinput">firefox http://localhost:2480</code>
</pre>
<p><img src="gettingstarted/../images/studio/studio-login.png" alt="Home Page" /></p>
<p>From here you can create a new database, connect to or drop an existing database, import a public database and navigate to the Server management interface.</p>
<blockquote>
<p>For more information on the OrientDB Studio, see <a href="gettingstarted/../studio/README.html">Studio</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="documents-vertices-and-edges"><a class="header" href="#documents-vertices-and-edges">Documents, Vertices and Edges</a></h1>
<p>###TODO</p>
<div style="break-before: page; page-break-before: always;"></div><!-- Last updated 2016-08-18 Matt -->
<!-- length of non-skewed text code in my browser -Matt !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->
<h1 id="classes"><a class="header" href="#classes">Classes</a></h1>
<p>Here we will learn about how classes structure data in OrientDB. A class in OrientDB is similar to a table in a relational database with some key differences. In this section you will learn how to see all of the classes in your database and how to create classes of your own. You'll also learn how to provide schema on top of classes by defining constraints for a class's properties. Finally you'll learn how to access the records stored within your classes.</p>
<p>The <a href="gettingstarted/../datamodeling/Concepts.html#class">Class</a> is a concept drawn from the <a href="http://en.wikipedia.org/wiki/Class_in_object-oriented_programming">Object-oriented programming</a> paradigm. In OrientDB a class is a data model that allows you to define certain rules for records that belong together. For example, a class 'Person' can store information about people. You can structure your class such that a record in the class must have certain properties (i.e. Name, Birthdate, Favorite Number, etc...).</p>
<p><img src="gettingstarted/../images/PersonClass.png" alt="PersonClass" /></p>
<p>In the traditional document database model classes are comparable to collections, while in the Relational database model (R-DBMS) they are comparable to tables. Classes are not tables though. Classes provide efficient means for storage of schema-less data. We'll see more about schema-less, schema-full, and schema-mixed data models later (See 'Adding Properties to a Class' below).</p>
<p>Like many database management systems, OrientDB uses the <a href="gettingstarted/../datamodeling/Concepts.html#record">Record</a> as an element of storage.  There are many types of records, but with the Document Database API records always use the <a href="gettingstarted/../datamodeling/Concepts.html#document">Document</a> type.  A document is formed by a set of key/value pairs. A document can belong to a class.</p>
<p>In the example above, there are two documents. One document contains information for Sarah and another for Abdul. The keys 15:0 and 15:1 refer to each document respectively.</p>
<p>To list all the configured classes on your system, use the <a href="gettingstarted/../console/Console-Command-Classes.html"><code>LIST CLASSES</code></a> command in the console:</p>
<pre>
orientdb> <code class="lang-sql userinput">LIST CLASSES</code>
orientdb {db=playingwithClasses}> LIST CLASSES

CLASSES
+----+-----------+-------------+-----------------+-----+
|#   |NAME       |SUPER-CLASSES|CLUSTERS         |COUNT|
+----+-----------+-------------+-----------------+-----+
|0   |_studio    |             |_studio(13)      |    1|
|1   |Blue       |[Color]      |blue(19)         |    0|
|2   |Color      |[V]          |-                |    0|
|3   |E          |             |e(11),e_1(12)    |    0|
|4   |OFunction  |             |ofunction(6)     |    0|
|5   |OIdentity  |             |-                |    0|
|6   |ORestricted|             |-                |    0|
|7   |ORole      |[OIdentity]  |orole(4)         |    3|
|8   |OSchedule  |             |oschedule(8)     |    0|
|9   |OSequence  |             |osequence(7)     |    0|
|10  |OTriggered |             |-                |    0|
|11  |OUser      |[OIdentity]  |ouser(5)         |    3|
|12  |Person     |[V]          |person(15)       |    0|
|13  |Red        |[Color]      |red(17),red_1(18)|    0|
|14  |V          |             |v(9),v_1(10)     |    0|
+----+-----------+-------------+-----------------+-----+
|    |TOTAL      |             |                 |    7|
+----+-----------+-------------+-----------------+-----+
</pre>
<blockquote>
<p>If you are using studio, then you can see the same information by clicking on the 'schema' tab.</p>
</blockquote>
<p>Here we can see that there are 14 classes in the database. Class 12 refers to person. There is also a class Color which is the super-class of Red and Blue. Color and Person both have super-classes called V. The class V is important for using OrientDB’s graph model. We'll see more about Superclasses and V later in the tutorial. Let's move on now to working with classes.</p>
<h2 id="working-with-classes"><a class="header" href="#working-with-classes">Working with Classes</a></h2>
<p>In order to start using classes with your own applications, you need to understand how to create and configure a class for use.  The class in OrientDB is similar to the table in relational databases, but unlike tables, classes can be schema-less, schema-full or mixed. A class can inherit properties from other classes thereby creating trees of classes (though the super-class relationship).</p>
<p>Each class has its own cluster or clusters, (created by default, if none are defined). For now we should know that a cluster is a place where a group of records are stored. We'll soon see how <a href="gettingstarted/Tutorial-Clusters.html"><code>clustering</code></a> improves performance of querying the database.</p>
<blockquote>
<p>For more information on classes in OrientDB, see <a href="gettingstarted/../datamodeling/Concepts.html#class">Class</a>.</p>
</blockquote>
<p>To create a new class, use the <a href="gettingstarted/../sql/SQL-Create-Class.html"><code>CREATE CLASS</code></a> command:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE CLASS Student</code>

Class created successfully. Total classes in database now: 15
</pre>
<p>This creates a class called <code>Student</code>.  Given that no cluster was defined in the <a href="gettingstarted/../sql/SQL-Create-Class.html"><code>CREATE CLASS</code></a> command, OrientDB creates a default cluster called <code>student</code>, to contain records assigned to this class. For the moment, the class has no records or properties tied to it.  It is now displayed in the <a href="gettingstarted/../console/Console-Command-Classes.html"><code>CLASSES</code></a> listing and in the schema manager of Studio.</p>
<h3 id="adding-properties-to-a-class"><a class="header" href="#adding-properties-to-a-class">Adding Properties to a Class</a></h3>
<p>As mentioned above, OrientDB allows you to work in a schema-less mode.  That is, it allows you to create classes without defining their properties. However, properties are mandatory if you would like to define indexes or constraints for a class. Let's follow OrientDB's comparison to relational databases again... If classes in OrientDB are similar to tables, then properties are the columns on those tables.</p>
<p>To create new properties on <code>Student</code>, use the <a href="gettingstarted/../sql/SQL-Create-Property.html"><code>CREATE PROPERTY</code></a> command in the console or in the browse window of studio:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE PROPERTY Student.name STRING</code>

Property created successfully with id=1


orientdb> <code class="lang-sql userinput">CREATE PROPERTY Student.surname STRING</code>

Property created successfully with id=2


orientdb> <code class="lang-sql userinput">CREATE PROPERTY Student.birthDate DATE</code>

Property created successfully with id=3
</pre>
<p>These commands create three new properties on the <code>Student</code> class. The properties provide you with areas to define an individual student's name, surname, and date of birth.</p>
<h3 id="displaying-class-information"><a class="header" href="#displaying-class-information">Displaying Class Information</a></h3>
<p>Occasionally you may need to reference a particular class to see what clusters it belongs to, or any properties configured for the class's use.  Use the <a href="gettingstarted/../console/Console-Command-Info-Class.html"><code>INFO CLASS</code></a> command to display information about the current configuration and properties of a class.</p>
<p>To display information on the class <code>Student</code>, use the <a href="gettingstarted/../console/Console-Command-Info-Class.html"><code>INFO CLASS</code></a> command:</p>
<pre>
orientdb> <code class="lang-sql userinput">INFO CLASS Student</code>

Class................: Student
Default cluster......: student (id=96)
Supported cluster ids: [96]
Properties:
-----------+--------+--------------+-----------+----------+----------+-----+-----+
 NAME      | TYPE   | LINKED TYPE/ | MANDATORY | READONLY | NOT NULL | MIN | MAX |
           |        | CLASS        |           |          |          |     |     |
-----------+--------+--------------+-----------+----------+----------+-----+-----+
 birthDate | DATE   | null         | false     | false    | false    |     |     |
 name      | STRING | null         | false     | false    | false    |     |     |
 surname   | STRING | null         | false     | false    | false    |     |     |
-----------+--------+--------------+-----------+----------+----------+-----+-----+

</pre>
<h3 id="adding-constraints-to-properties"><a class="header" href="#adding-constraints-to-properties">Adding Constraints to Properties</a></h3>
<p>Constraints create limits on the data values assigned to properties.  For instance, the type, the minimum or maximum size of, whether or not a value is mandatory or if null values are permitted to the property.</p>
<p>Constraints create limits on the data values assigned to properties.  For instance, if 'MANDATORY' is set to true for name in student, then every record in the student class must have a name. If we set 'MIN' to three, then every name must also be at least three characters long.</p>
<blockquote>
<p>The only two properties required when using the 'create a property' command for a class are 'NAME' and 'TYPE'.</p>
</blockquote>
<p>To add a constraint to an existing property, use the <a href="gettingstarted/../sql/SQL-Alter-Property.html"><code>ALTER PROPERTY</code></a> command:</p>
<pre>
orientdb> <code class="lang-sql userinput">ALTER PROPERTY Student.name MIN 3</code>

Property updated successfully
</pre>
<p>This command adds a constraint to <code>Student</code> on the <code>name</code> property. After running this command, Student will allow any record to be stored unless the record has a property called 'Name'. If the records has such a property then 'Student' will reject the record if the value in 'Name' is less then three characters.</p>
<p>By setting property, 'MANDATORY', to true for Student's Name we can also guarantee that every record added to student has a name.</p>
<pre>
orientdb> <code class="lang-sql userinput">ALTER PROPERTY Student.name MANDATORY true</code>
</pre>
<p>There are many ways to use constraints on properties. They can allow you to build a data-model that tells a story about your own use case. Constraints can also help ensure that you're database communicates with other components of a larger application by only allowing storage of values that another application is able to recognize.</p>
<h2 id="viewing-records-in-a-class"><a class="header" href="#viewing-records-in-a-class">Viewing Records in a Class</a></h2>
<p>Classes contain and define records in OrientDB.  You can view all records that belong to a class using the <a href="gettingstarted/../console/Console-Command-Browse-Class.html"><code>BROWSE CLASS</code></a> command. You can also see data belonging to a particular record with the <a href="gettingstarted/../console/Console-Command-Display-Record.html"><code>DISPLAY RECORD</code></a> command.</p>
<blockquote>
<p>Note: you cannot display a record unless you have recently received a query result with records to browse (select statement, 'browse class x', etc...).</p>
</blockquote>
<p>Earlier we created a <code>Student</code> class and defined some schema for records belonging to that class, but we didn't create any records or add any data. Thus, running 'BROWSE CLASS' on the <code>Student</code> class returns no results. Luckily OrientDB has a few preconfigured classes and records that we can query.</p>
<p>Let's take the class OUser for example.</p>
<pre>
orientdb> <code class="lang-sql userinput">INFO CLASS OUser</code>

CLASS 'OUser'

Super classes........: [OIdentity]
Default cluster......: ouser (id=5)
Supported cluster ids: [5]
Cluster selection....: round-robin
Oversize.............: 0.0

PROPERTIES
----------+---------+--------------+-----------+----------+----------+-----+-----+
 NAME     | TYPE    | LINKED TYPE/ | MANDATORY | READONLY | NOT NULL | MIN | MAX |
          |         | CLASS        |           |          |          |     |     |
----------+---------+--------------+-----------+----------+----------+-----+-----+
 password | STRING  | null         | true      | false    | true     |     |     |
 roles    | LINKSET | ORole        | false     | false    | false    |     |     |
 name     | STRING  | null         | true      | false    | true     |     |     |
 status   | STRING  | null         | true      | false    | true     |     |     |
----------+---------+--------------+-----------+----------+----------+-----+-----+

INDEXES (1 altogether)
-------------------------------+----------------+
 NAME                          | PROPERTIES     |
-------------------------------+----------------+
 OUser.name                    | name           |
-------------------------------+----------------+

</pre>
<p>The <code>OUser</code> class defines the users on your database.</p>
<p>To see records assigned to the <code>OUser</code> class, run the <a href="gettingstarted/../console/Console-Command-Browse-Class.html"><code>BROWSE CLASS</code></a> command:</p>
<pre>
orientdb> <code class="lang-sql userinput">BROWSE CLASS OUser</code>

---+------+-------+--------+-----------------------------------+--------+-------+
 # | @RID | @Class| name   | password                          | status | roles |
---+------+-------+--------+-----------------------------------+--------+-------+
 0 | #5:0 | OUser | admin  | {SHA-256}8C6976E5B5410415BDE90... | ACTIVE | [1]   |
 1 | #5:1 | OUser | reader | {SHA-256}3D0941964AA3EBDCB00EF... | ACTIVE | [1]   |
 2 | #5:2 | OUser | writer | {SHA-256}B93006774CBDD4B299389... | ACTIVE | [1]   |
---+------+-------+--------+-----------------------------------+--------+-------+
</pre>
<div class="table-wrapper"><table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td><img src="gettingstarted/../images/warning.png" alt="" /></td><td>In the example, you are listing all of the users of the database.  While this is fine for your initial setup and as an example, it is not particularly secure. To further improve security in production environments, see <a href="gettingstarted/../security/Security.html">Security</a>.</td></tr>
</tbody></table>
</div>
<p>When you run <a href="gettingstarted/../console/Console-Command-Browse-Class.html"><code>BROWSE CLASS</code></a>, the first column in the output provides the identifier number, which you can use to display detailed information on that particular record.</p>
<p>To show the first record browsed from the <code>OUser</code> class, run the <a href="gettingstarted/../console/Console-Command-Display-Record.html"><code>DISPLAY RECORD</code></a> command:</p>
<pre>
orientdb> <code class="lang-sql userinput">DISPLAY RECORD 0</code>

DOCUMENT @class:OUser @rid:#5:0 @version:1
----------+--------------------------------------------+
     Name | Value                                      |
----------+--------------------------------------------+
     name | admin                                      |
 password | {SHA-256}8C6976E5B5410415BDE908BD4DEE15... |
   status | ACTIVE                                     |
    roles | [#4:0=#4:0]                                |
----------+--------------------------------------------+

</pre>
<p>Bear in mind that this command references the last call of <a href="gettingstarted/../console/Console-Command-Browse-Class.html"><code>BROWSE CLASS</code></a>.  You can continue to display other records, but you cannot display records from another class until you browse that particular class.</p>
<h2 id="class-review"><a class="header" href="#class-review">Class Review</a></h2>
<p>Here are some key things to remember about classes:</p>
<ol>
<li>
<p>A class in OrientDB is similar to a table in a relational database with some key differences. Among those differences we see tables are schema-full, and classes can be schema-full, schema-less, or mixed.</p>
</li>
<li>
<p>You can see all of the classes in your database by running 'LIST CLASSES' in console or by visiting the 'Schema Manager' in Studio.</p>
</li>
<li>
<p>You can create a class by running the 'create class <class-name>' command in console, or by running the same command in the 'Browse' window of studio.</p>
</li>
<li>
<p>You can use the commands, 'Create property <property-name> [constraints]' and 'Create property <property-name> [constraints]' to give schema to a class.</p>
</li>
<li>
<p>To see properties and constraints associated with a class you can run 'info class <class-name>'.</p>
</li>
<li>
<p>To see information about a the records within a class run 'Browse class <class-name>'.</p>
</li>
<li>
<p>To see information about a specific record of a class use the command 'Display record <record-number>'. Note: You must have recently queried a class for it's records before using this command. '<record-number>' references the number in the left-most column of the previous query's result.</p>
</li>
</ol>
<p>Congratulations! You are now familiar with classes in OrientDB. If you're ready to explore clusters then let's move on to the <a href="gettingstarted/Tutorial-Clusters.html"><code>clustering</code></a> section of this tutorial.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="demo-database"><a class="header" href="#demo-database">Demo Database</a></h1>
<p>Starting with OrientDB v.3.0 a new demo database (<code>demodb</code>)  is included.</p>
<p>This Section introduces the <code>demodb</code> database and its Data Model, and includes some queries that is possible to execute on it.</p>
<p>Some screenshots on "portions" of the <code>demodb</code> graph are included as well.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-1"><a class="header" href="#introduction-1">Introduction</a></h1>
<p>The demo database can help you understand better OrientDB features and capabilities and replaces the old demo database <code>GratefulDeadConcerts</code> included in version 2.2 and previous ones.</p>
<p><strong>Note:</strong> Random-generated data is used in the <code>demodb</code>, including data used for <em>Emails</em>, <em>Names</em>, <em>Surnames</em>, <em>Phone Numbers</em> and <em>Reviews</em>.</p>
<h2 id="version"><a class="header" href="#version">Version</a></h2>
<p><code>demodb</code> has a version that, in general, is not linked to the Server version you are running. You can check the version of the <code>demodb</code> included in your distribution by executing the following SQL query:</p>
<pre><code class="language-sql">SELECT `Version` FROM `DBInfo`;
</code></pre>
<p>Current version is 0.76.</p>
<h2 id="location"><a class="header" href="#location">Location</a></h2>
<p>The demo database is located in the <code>databases</code> directory under your <code>$ORIENTDB_HOME</code> (e.g. <code>D:\orientdb\orientdb-community-3.0.0\databases\demodb</code>.</p>
<h2 id="connecting-to-the-demo-database"><a class="header" href="#connecting-to-the-demo-database">Connecting to the Demo Database</a></h2>
<p>It is possible to connect to <code>demodb</code> using the three standard OrientDB Users:</p>
<ul>
<li><code>reader</code> / <code>reader</code></li>
<li><code>writer</code> / <code>writer</code></li>
<li><code>admin</code> / <code>admin</code></li>
</ul>
<h2 id="using-the-demo-database-with-orientdb-22x"><a class="header" href="#using-the-demo-database-with-orientdb-22x">Using the Demo Database with OrientDB 2.2.x</a></h2>
<p>The demo database can be easily loaded into OrientDB 2.2.x using the Studio's <em>"Import a public database"</em> feature.</p>
<p>Alternatively, it is possible to import it via an SQL script that includes the set of instructions needed to recreate the data model as well as all the records (vertices, edges, and documents).</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="data-model"><a class="header" href="#data-model">Data Model</a></h1>
<p><code>demodb</code> is the database of an hypothetical Travel Agency that runs a public social platform as well.</p>
<p>Users (that are stored in the database in the class <em>Profiles</em>) can freely register to the social platform and start making friends (friendship is expressed via the <em>HasFriend</em> edge).</p>
<p>Some of the users can become customers. When this happens the application in use at the Social Travel Agency creates a vertex in the <em>Customers</em> class and links it to the associated profile via an <em>HasProfile</em> edge.</p>
<p>When customers are created, they are automatically linked to a country as well, via an <em>IsFromCountry</em> edge. Countries are stored in the <em>Countries</em> vertex class.</p>
<p>Orders made by customers are stored in the vertex class <em>Orders</em>. Each customer can make one or more orders, and the <em>HasCustomer</em> edge is used to connect orders to customers.</p>
<p>When customers start visiting <em>Attractions</em> (like <em>Castles</em>, <em>Monuments</em>, <em>Theatres</em> or <em>Archaeological Sites</em>) or using <em>Services</em> (like <em>Hotels</em> or <em>Restaurants</em>) edges are created to link that specific customer with that specific attraction or service (<em>HasVisited</em>, <em>HasStayed</em>, and <em>HasEaten</em> edges are used).</p>
<p>The Social Travel Agency also stores some reviews in the vertex class <em>Reviews</em>. Reviews are linked to customers via the <em>MadeReview</em> edge, and to an attraction or service via the <em>HasReview</em> edge.</p>
<p>Data model of <code>demodb</code> v.0.76 is reported in the image below:</p>
<p><img src="gettingstarted/demodb/../../images/demo-dbs/social-travel-agency/DataModel.png" alt="" /></p>
<h2 id="inheritance"><a class="header" href="#inheritance">Inheritance</a></h2>
<p>Inheritance in the Vertex and Edge classes of <code>demodb</code> v.0.76 is reported in the image below:</p>
<p><img src="gettingstarted/demodb/../../images/demo-dbs/social-travel-agency/Inheritance.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="queries"><a class="header" href="#queries">Queries</a></h1>
<p>This Section includes several query examples that you can execute from the <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>'s <em>Browse Tab</em>, or from its <em>Graph Editor</em>. You may also execute these queries directly from the <a href="gettingstarted/demodb/queries/../../../console/README.html">Console</a>, or your application through an <a href="gettingstarted/demodb/queries/../../../apis-and-drivers/README.html">API or Driver</a>.</p>
<p>{% include "../include-demodb-version-warning.md" %}</p>
<p>The following table can help you navigate through all examples:</p>
<div class="table-wrapper"><table><thead><tr><th>Category</th><th>Question</th><th>Link</th></tr></thead><tbody>
<tr><td><strong>Profiles</strong></td><td>Find the 'year of birth' of the Profiles, and how many Profiles were born in the same year</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Profiles.html#example-1">Link</a></td></tr>
<tr><td></td><td>Find the top 3 Profiles that have the highest number of Friends</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Profiles.html#example-2">Link</a></td></tr>
<tr><td><strong>Friendship</strong></td><td>Find Santo's Friends</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Friendship.html#example-1">Link</a></td></tr>
<tr><td></td><td>Find Santo's Friends who are also Customers</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Friendship.html#example-2">Link</a></td></tr>
<tr><td></td><td>Find Santo's Friends who are also Customers, and the Countries they are from</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Friendship.html#example-3">Link</a></td></tr>
<tr><td></td><td>Find Santo's Friends who are also Customers, and the Orders they have placed</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Friendship.html#example-4">Link</a></td></tr>
<tr><td></td><td>Among Santo's Friends, find the top 3 Customers that placed the highest number of Orders</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Friendship.html#example-5">Link</a></td></tr>
<tr><td></td><td>Among Santo's Friends, find the top 3 Customers that visited the highest number of Places</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Friendship.html#example-6">Link</a></td></tr>
<tr><td></td><td>Find all the Friends of Customer identified with OrderedId 1 that are not Customers (so that a product can be proposed)</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Friendship.html#example-7">Link</a></td></tr>
<tr><td><strong>Customers</strong></td><td>Find everything that is connected (1st degree) to Customer with OrderedId 1</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Customers.html#example-1">Link</a></td></tr>
<tr><td></td><td>Find all Locations connected to Customer with OrderedId 1</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Customers.html#example-2">Link</a></td></tr>
<tr><td></td><td>Find all Locations connected to Customer with OrderedId 1, and their Reviews (if any)</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Customers.html#example-3">Link</a></td></tr>
<tr><td></td><td>Find the other Customers that visited the Locations visited by Customer with OrderedId 1</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Customers.html#example-4">Link</a></td></tr>
<tr><td></td><td>Find all the places where Customer with OrderedId 2 has stayed</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Customers.html#example-5">Link</a></td></tr>
<tr><td></td><td>Find all places where Customer with Id 1 has eaten</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Customers.html#example-6">Link</a></td></tr>
<tr><td></td><td>Find the 3 Customers who made more reviews</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Customers.html#example-7">Link</a></td></tr>
<tr><td></td><td>Find all Orders placed by Customer with OrderedId 2</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Customers.html#example-8">Link</a></td></tr>
<tr><td></td><td>Calculate the total revenues from Orders associated with Customer with OrderedId 2</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Customers.html#example-9">Link</a></td></tr>
<tr><td></td><td>Find the 3 Customers who placed most Orders</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Customers.html#example-10">Link</a></td></tr>
<tr><td></td><td>Find the top 3 Countries from where Customers are from</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Customers.html#example-11">Link</a></td></tr>
<tr><td><strong>Countries</strong></td><td>Find the top 3 Countries from where Customers are from</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Countries.html#example-1">Link</a></td></tr>
<tr><td></td><td>Find Santo's Friends who are also Customers, and the Countries they are from</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Countries.html#example-2">Link</a></td></tr>
<tr><td><strong>Orders</strong></td><td>Calculate the total revenues from Orders, and the min, max and average Order amount</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Orders.html#example-1">Link</a></td></tr>
<tr><td></td><td>Find the year of the Orders, and how many Orders have been placed in the same year</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Orders.html#example-2">Link</a></td></tr>
<tr><td></td><td>Find the 3 Customers who placed most Orders</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Orders.html#example-3">Link</a></td></tr>
<tr><td></td><td>Find the top 3 Customers in terms of spending</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Orders.html#example-4">Link</a></td></tr>
<tr><td></td><td>Find all Orders placed by Customer with Id 2</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Orders.html#example-5">Link</a></td></tr>
<tr><td></td><td>Calculate the total revenues from Orders associated with Customer with Id 2</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Orders.html#example-6">Link</a></td></tr>
<tr><td><strong>Attractions</strong></td><td>Find all Attractions connected with Customer with OrderedId 1</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Attractions.html#example-1">Link</a></td></tr>
<tr><td><strong>Services</strong></td><td>Find all Services connected with Customer with OrderedId 1</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Services.html#example-1">Link</a></td></tr>
<tr><td></td><td>Find the 3 Hotels that have been booked most times</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Services.html#example-2">Link</a></td></tr>
<tr><td></td><td>Find the 3 Hotels that have most reviews</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Services.html#example-3">Link</a></td></tr>
<tr><td></td><td>Find the top 3 nationality of the tourists that have eaten at Restaurant with Id 26</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Services.html#example-4">Link</a></td></tr>
<tr><td><strong>Locations</strong></td><td>Find all Locations visited by Santo</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Locations.html#example-1">Link</a></td></tr>
<tr><td></td><td>Find all Locations connected to Customer with OrderedId 1</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Locations.html#example-2">Link</a></td></tr>
<tr><td></td><td>Find all Locations connected to Customer with OrderedId 1, and their Reviews (if any)</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Locations.html#example-3">Link</a></td></tr>
<tr><td></td><td>Find all Locations visited by Customer with OrderedId 2</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Locations.html#example-4">Link</a></td></tr>
<tr><td></td><td>Find all Locations visited by Santo's friends</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Locations.html#example-5">Link</a></td></tr>
<tr><td><strong>Reviews</strong></td><td>Find number of Reviews per star</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Reviews.html#example-1">Link</a></td></tr>
<tr><td></td><td>Find all reviewed Services</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Reviews.html#example-2">Link</a></td></tr>
<tr><td></td><td>Find all reviewed Services and the Customer who made the review</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Reviews.html#example-3">Link</a></td></tr>
<tr><td></td><td>Find the numbers of reviews per Service</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Reviews.html#example-4">Link</a></td></tr>
<tr><td></td><td>Find the 3 Hotels that have most reviews</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Reviews.html#example-5">Link</a></td></tr>
<tr><td></td><td>Find the 3 Customers who made more reviews</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Reviews.html#example-6">Link</a></td></tr>
<tr><td><strong>Recommendations</strong></td><td>Recommend some friends to Profile 'Isabella Gomez' (friends of friends)</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Recommendations.html#example-1">Link</a></td></tr>
<tr><td></td><td>Recommend some Hotels to Customer with OrderedId 1</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Recommendations.html#example-2">Link</a></td></tr>
<tr><td><strong>Business Opportunities</strong></td><td>Find all the Friends of Customer identified with OrderedId 1 that are not Customers (so that a product can be proposed)</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Business-Opportunities.html#example-1">Link</a></td></tr>
<tr><td></td><td>Find all the Customer Friends that are not Customers (so that a product can be proposed)</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Business-Opportunities.html#example-2">Link</a></td></tr>
<tr><td><strong>Polymorphism</strong></td><td>Find all Locations (Services + Attractions) connected with Customer with OrderedId 1</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Polymorphism.html#example-1">Link</a></td></tr>
<tr><td></td><td>Find the 3 Services (Hotels + Restaurants) that have most reviews</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Polymorphism.html#example-2">Link</a></td></tr>
<tr><td><strong>Shortest Paths</strong></td><td>Find the shortest path between the Profile 'Santo' and the Country 'United States'</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Shortest-Paths.html#example-1">Link</a></td></tr>
<tr><td></td><td>Find the shortest path between the Profile 'Santo' and the Restaurant 'Malga Granezza'</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Shortest-Paths.html#example-2">Link</a></td></tr>
<tr><td><strong>Traverses</strong></td><td>Traverse everything from Profile 'Santo' up to depth three</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Traverses.html#example-1">Link</a></td></tr>
<tr><td></td><td>Traverse everything from Country 'Italy' up to depth three</td><td><a href="gettingstarted/demodb/queries/DemoDB-Queries-Traverses.html#example-2">Link</a></td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="profiles"><a class="header" href="#profiles">Profiles</a></h1>
<h2 id="example-1"><a class="header" href="#example-1">Example 1</a></h2>
<p>Find the 'year of birth' of the Profiles, and how many Profiles were born in the same year:</p>
<pre><code class="language-sql">SELECT 
  count(*) as NumberOfProfiles, 
  Birthday.format('yyyy') AS YearOfBirth 
FROM Profiles 
GROUP BY YearOfBirth 
ORDER BY NumberOfProfiles DESC
</code></pre>
<p>In the <em>Browse Tab</em> of <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using the query above, this is the obtained list of records (only few records are shown in the image below):</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_8_browse.png" alt="" /></p>
<p><em>Note</em>: in v. 2.x the corresponding query is:</p>
<pre><code class="language-sql">SELECT 
  count(*) as NumberOfProfiles, 
  YearOfBirth 
FROM (
  SELECT  
    Birthday.format('yyyy') AS YearOfBirth
  FROM Profiles)
GROUP BY YearOfBirth
ORDER BY NumberOfProfiles DESC
</code></pre>
<h2 id="example-2"><a class="header" href="#example-2">Example 2</a></h2>
<p>Find the top 3 Profiles that have the highest number of Friends:</p>
<pre><code class="language-sql">SELECT 
  @rid as Profile_RID, 
  Name, 
  Surname, 
  both('HasFriend').size() AS FriendsNumber 
FROM `Profiles` 
ORDER BY FriendsNumber DESC 
LIMIT 3
</code></pre>
<p>In the <em>Browse Tab</em> of <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using the query above, this is the obtained list of records:</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_12_browse.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="friendship"><a class="header" href="#friendship">Friendship</a></h1>
<h2 id="example-1-1"><a class="header" href="#example-1-1">Example 1</a></h2>
<p>Find Santo's Friends:</p>
<pre><code class="language-sql">MATCH {Class: Profiles, as: profile, where: (Name='Santo' AND Surname='OrientDB')}-HasFriend-{Class: Profiles, as: friend} 
RETURN $pathelements
</code></pre>
<p>In the <em>Graph Editor</em> included in <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using <em>'RETURN $pathelements'</em> as <code>RETURN</code> clause, this is the obtained graph:</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_1_graph.png" alt="" /></p>
<p>In the <em>Browse Tab</em> of <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using <em>'RETURN friend.@Rid as Friend_RID, friend.Name as Friend_Name, friend.Surname as Friend_Surname'</em> as <code>RETURN</code> clause, this is the obtained list of records (only few records are shown in the image below):</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_1_browse.png" alt="" /></p>
<p>If you would like only to count them, you can execute a query like the following:</p>
<pre><code class="language-sql">SELECT COUNT(*) 
FROM (
  MATCH {Class: Profiles, as: profile, where: (Name='Santo' AND Surname='OrientDB')}-HasFriend-{Class: Profiles, as: friend} 
  RETURN friend
)
</code></pre>
<p>or</p>
<pre><code class="language-sql">SELECT 
  both('HasFriend').size() AS FriendsNumber 
FROM `Profiles` 
WHERE Name='Santo' AND Surname='OrientDB'
</code></pre>
<h2 id="example-2-1"><a class="header" href="#example-2-1">Example 2</a></h2>
<p>Find Santo's Friends who are also Customers:</p>
<pre><code class="language-sql">MATCH {Class: Profiles, as: profile, where: (Name='Santo' AND Surname='OrientDB')}-HasFriend-{Class: Profiles, as: friend}&lt;-HasProfile-{class: Customers, as: customer}
RETURN $pathelements
</code></pre>
<p>In the <em>Graph Editor</em> included in <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using <em>'RETURN $pathelements'</em> as <code>RETURN</code> clause, this is the obtained graph:</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_2_graph.png" alt="" /></p>
<p>In the <em>Browse Tab</em> of <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using <em>'RETURN friend.@Rid as Friend_RID, friend.Name as Friend_Name, friend.Surname as Friend_Surname, customer.@Rid as Customer_RID, customer.OrderedId as Customer_OrderedId'</em> as <code>RETURN</code> clause, this is the obtained list of records (only few records are shown in the image below):</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_2_browse.png" alt="" /></p>
<h2 id="example-3"><a class="header" href="#example-3">Example 3</a></h2>
<p>{% include "./include-file-5.md" %}</p>
<h2 id="example-4"><a class="header" href="#example-4">Example 4</a></h2>
<p>Find Santo's Friends who are also Customers, and the Orders they have placed:</p>
<pre><code class="language-sql">MATCH {Class: Profiles, as: profile, where: (Name='Santo' AND Surname='OrientDB')}-HasFriend-{Class: Profiles, as: friend}&lt;-HasProfile-{class: Customers, as: customer}&lt;-HasCustomer-{Class: Orders, as: order} 
RETURN $pathelements
</code></pre>
<p>In the <em>Graph Editor</em> included in <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using <em>'RETURN $pathelements'</em> as <code>RETURN</code> clause, this is the obtained graph:</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_4_graph.png" alt="" /></p>
<p>In the <em>Browse Tab</em> of <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using <em>'RETURN friend.@Rid as Friend_RID, friend.Name as Friend_Name, friend.Surname as Friend_Surname, customer.@Rid as Customer_RID, customer.OrderedId as Customer_OrderedId, order.Id as OrderId'</em> as <code>RETURN</code> clause, this is the obtained list of records (only few records are shown in the image below):</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_4_browse.png" alt="" /></p>
<h2 id="example-5"><a class="header" href="#example-5">Example 5</a></h2>
<p>Among Santo's Friends, find the top 3 Customers that placed the highest number of Orders:</p>
<pre><code class="language-sql">SELECT 
  OrderedId as Customer_OrderedId, 
  in('HasCustomer').size() as NumberOfOrders, 
  out('HasProfile').Name as Friend_Name, 
  out('HasProfile').Surname as Friend_Surname 
FROM (
  SELECT expand(customer) 
  FROM (
    MATCH {Class: Profiles, as: profile, where: (Name='Santo' AND Surname='OrientDB')}-HasFriend-{Class: Profiles, as: friend}&lt;-HasProfile-{class: Customers, as: customer} 
    RETURN customer
  )
) 
ORDER BY NumberOfOrders DESC 
LIMIT 3
</code></pre>
<p>In the <em>Browse Tab</em> of <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using the query above, this is the obtained list of records:</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_5_browse.png" alt="" /></p>
<h2 id="example-6"><a class="header" href="#example-6">Example 6</a></h2>
<p>Among Santo's Friends, find the top 3 Customers that visited the highest number of Places:</p>
<pre><code class="language-sql">SELECT 
  OrderedId as Customer_OrderedId, 
  out('HasVisited').size() as NumberOfVisits, 
  out('HasProfile').Name as Friend_Name, 
  out('HasProfile').Surname as Friend_Surname 
FROM (
  SELECT expand(customer) 
  FROM (
    MATCH {Class: Profiles, as: profile, where: (Name='Santo' AND Surname='OrientDB')}-HasFriend-{Class: Profiles, as: friend}&lt;-HasProfile-{class: Customers, as: customer} 
    RETURN customer
  )
) 
ORDER BY NumberOfVisits DESC 
LIMIT 3
</code></pre>
<p>In the <em>Browse Tab</em> of <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using the query above, this is the obtained list of records:</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_6_browse.png" alt="" /></p>
<p>You may find in a similar way the top 3 Customers, among Santo's Friends, that have stayed at the highest number of Hotels, or have eaten at the highest number of Restaurants. Just use <code>out("HasStayed").size()</code> or <code>out("HasEaten").size()</code> instead of <code>out("HasVisited").size()</code> (you may also consider to modify the alias, from <code>NumberOfVisits</code> to <code>NumberOfHotels</code> and <code>NumberOfRestaurants</code>, so that it is more coherent to these cases).</p>
<h2 id="example-7"><a class="header" href="#example-7">Example 7</a></h2>
<p>{% include "./include-file-1.md" %}</p>
<p>or, without restricting to a specific customer:</p>
<p>Find all the Customer Friends that are not Customers (so that a product can be proposed):</p>
<p>In the <em>Graph Editor</em> included in <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using the query below, this is the obtained graph:</p>
<pre><code class="language-sql">SELECT * 
FROM (
  SELECT expand(customerFriend) 
  FROM (
    MATCH {Class:Customers, as: customer}-HasProfile-{Class:Profiles, as: profile}-HasFriend-{Class:Profiles, as: customerFriend} 
    RETURN customerFriend
  )
) 
WHERE in('HasProfile').size()=0
</code></pre>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_14_graph.png" alt="" /></p>
<p>In the <em>Browse Tab</em> of <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using the query below, this is the obtained list of records (only few records are shown in the image below):</p>
<pre><code class="language-sql">SELECT 
  @Rid as Friend_RID, 
  Name as Friend_Name, 
  Surname as Friend_Surname 
FROM (
  SELECT expand(customerFriend) 
  FROM (
    MATCH {Class:Customers, as: customer}-HasProfile-{Class:Profiles, as: profile}-HasFriend-{Class:Profiles, as: customerFriend}     
    RETURN customerFriend
  )
) 
WHERE in('HasProfile').size()=0
</code></pre>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_14_browse.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="customers"><a class="header" href="#customers">Customers</a></h1>
<h2 id="example-1-2"><a class="header" href="#example-1-2">Example 1</a></h2>
<p>Find everything that is connected (1st degree) to Customer with OrderedId 1:</p>
<pre><code class="language-sql">MATCH {class: Customers, as: c, where: (OrderedId=1)}--{as: n} 
RETURN $pathelements
</code></pre>
<p>In the <em>Graph Editor</em> included in <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using <em>'RETURN $pathelements'</em> as <code>RETURN</code> clause, this is the obtained graph:</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_37_graph.png" alt="" /></p>
<h2 id="example-2-2"><a class="header" href="#example-2-2">Example 2</a></h2>
<p>{% include "./include-file-7.md" %}</p>
<h2 id="example-3-1"><a class="header" href="#example-3-1">Example 3</a></h2>
<p>{% include "./include-file-8.md" %}</p>
<h2 id="example-4-1"><a class="header" href="#example-4-1">Example 4</a></h2>
<p>Find the other Customers that visited the Locations visited by Customer with OrderedId 1:</p>
<pre><code class="language-sql">MATCH {class: Customers, as: customer, where: (OrderedId=1)}--{class: Locations, as: loc}--{class: Customers, as: otherCustomers, where: (OrderedId&lt;&gt;1)} 
RETURN $pathelements
</code></pre>
<p>In the <em>Graph Editor</em> included in <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using <em>'RETURN $pathelements'</em> as <code>RETURN</code> clause, this is the obtained graph:</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_40_graph.png" alt="" /></p>
<p>If we want to return also also their Profile names, surnames and emails:</p>
<pre><code class="language-sql">MATCH {class: Customers, as: customer, where: (OrderedId=1)}--{class: Locations, as: loc}--{class: Customers, as: otherCustomers, where: (OrderedId&lt;&gt;1)}-HasProfile-&gt;{class: Profiles, as: profile} 
RETURN otherCustomers.OrderedId, profile.Name, profile.Surname, profile.Email
ORDER BY `otherCustomers.OrderedId` ASC
</code></pre>
<p>In the <em>Browse Tab</em> of <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using <em>'RETURN otherCustomers.OrderedId, profile.Name, profile.Surname, profile.Email'</em> as <code>RETURN</code> clause, this is the obtained list of records (only few records are shown in the image below):</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_40_browse.png" alt="" /></p>
<h2 id="example-5-1"><a class="header" href="#example-5-1">Example 5</a></h2>
<p>Find all the places where Customer with OrderedId 2 has stayed:</p>
<pre><code class="language-sql">MATCH {as: n}&lt;-HasStayed-{class: Customers, as: c, where: (OrderedId=2)} 
RETURN $pathelements
</code></pre>
<p>In the <em>Graph Editor</em> included in <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using <em>'RETURN $pathelements'</em> as <code>RETURN</code> clause, this is the obtained graph:</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_41_graph.png" alt="" /></p>
<h2 id="example-6-1"><a class="header" href="#example-6-1">Example 6</a></h2>
<p>Find all places where Customer with OrderedId 1 has eaten:</p>
<pre><code class="language-sql">MATCH {as: n}&lt;-HasEaten-{class: Customers, as: c, where: (OrderedId=1)} 
RETURN $pathelements
</code></pre>
<p>In the <em>Graph Editor</em> included in <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using <em>'RETURN $pathelements'</em> as <code>RETURN</code> clause, this is the obtained graph:</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_42_graph.png" alt="" /></p>
<h2 id="example-7-1"><a class="header" href="#example-7-1">Example 7</a></h2>
<p>{% include "./include-file-3.md" %}</p>
<h2 id="example-8"><a class="header" href="#example-8">Example 8</a></h2>
<p>{% include "./include-file-9.md" %}</p>
<h2 id="example-9"><a class="header" href="#example-9">Example 9</a></h2>
<p>{% include "./include-file-10.md" %}</p>
<h2 id="example-10"><a class="header" href="#example-10">Example 10</a></h2>
<p>{% include "./include-file-4.md" %}</p>
<h2 id="example-11"><a class="header" href="#example-11">Example 11</a></h2>
<p>{% include "./include-file-6.md" %}</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="countries"><a class="header" href="#countries">Countries</a></h1>
<h2 id="example-1-3"><a class="header" href="#example-1-3">Example 1</a></h2>
<p>{% include "./include-file-6.md" %}</p>
<h2 id="example-2-3"><a class="header" href="#example-2-3">Example 2</a></h2>
<p>{% include "./include-file-5.md" %}</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orders"><a class="header" href="#orders">Orders</a></h1>
<h2 id="example-1-4"><a class="header" href="#example-1-4">Example 1</a></h2>
<p>Calculate the total revenues from Orders, and the min, max and average Order amount:</p>
<pre><code class="language-sql">SELECT 
  count(*) as OrdersNumber, 
  sum(Amount) AS TotalRevenuesFromOrders, 
  min(Amount) as MinAmount,
  (sum(Amount)/count(*)) as AverageAmount,
  max(Amount) as MaxAmount
FROM Orders
</code></pre>
<p>In the <em>Browse Tab</em> of <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using the query above, this is the visualized result:</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_9_browse.png" alt="" /></p>
<h2 id="example-2-4"><a class="header" href="#example-2-4">Example 2</a></h2>
<p>Find the year of the Orders, and how many Orders have been placed in the same year:</p>
<pre><code class="language-sql">SELECT 
  count(*) as OrdersCount, 
  OrderDate.format('yyyy') AS OrderYear 
FROM Orders 
GROUP BY OrderYear 
ORDER BY OrdersCount DESC
</code></pre>
<p>In the <em>Browse Tab</em> of <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using the query above, this is the visualized result:</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_11_browse.png" alt="" /></p>
<h2 id="example-3-2"><a class="header" href="#example-3-2">Example 3</a></h2>
<p>{% include "./include-file-4.md" %}</p>
<h2 id="example-4-2"><a class="header" href="#example-4-2">Example 4</a></h2>
<p>Find the top 3 Customers in terms of spending:</p>
<pre><code class="language-sql">SELECT 
  customer.OrderedId as customerOrderedId, 
  SUM(order.Amount) as totalAmount 
FROM (
  MATCH {Class: Customers, as: customer}&lt;-HasCustomer-{class: Orders, as: order} 
  RETURN customer, order
) 
GROUP BY customerOrderedId 
ORDER BY totalAmount DESC 
LIMIT 3
</code></pre>
<p>In the <em>Browse Tab</em> of <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using the query above, this is the visualized result:</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_36_browse.png" alt="" /></p>
<h2 id="example-5-2"><a class="header" href="#example-5-2">Example 5</a></h2>
<p>{% include "./include-file-9.md" %}</p>
<h2 id="example-6-2"><a class="header" href="#example-6-2">Example 6</a></h2>
<p>{% include "./include-file-10.md" %}</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="attractions"><a class="header" href="#attractions">Attractions</a></h1>
<h2 id="example-1-5"><a class="header" href="#example-1-5">Example 1</a></h2>
<p>Find all Attractions connected with Customer with OrderedId 1:</p>
<pre><code class="language-sql">MATCH {class: Customers, as: customer, where: (OrderedId=1)}--{Class: Attractions, as: attraction}
RETURN $pathelements
</code></pre>
<p>In the <em>Graph Editor</em> included in <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using <em>'RETURN $pathelements'</em> as <code>RETURN</code> clause, this is the obtained graph:</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_15_graph.png" alt="" /></p>
<p>In the <em>Browse Tab</em> of <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using <em>'RETURN attraction.@Rid as Attraction_RID, attraction.Name as Attraction_Name, attraction.Type as Attraction_Type'</em> as <code>RETURN</code> clause, this is the obtained list of records (only few records are shown in the image below):</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_15_browse.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="services"><a class="header" href="#services">Services</a></h1>
<h2 id="example-1-6"><a class="header" href="#example-1-6">Example 1</a></h2>
<p>Find all Services connected with Customer with OrderedId 1:</p>
<pre><code class="language-sql">MATCH {class: Customers, as: customer, where: (OrderedId=1)}--{Class: Services, as: service}
RETURN $pathelements
</code></pre>
<p>In the <em>Graph Editor</em> included in <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using <em>'RETURN $pathelements'</em> as <code>RETURN</code> clause, this is the obtained graph:</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_16_graph.png" alt="" /></p>
<p>In the <em>Browse Tab</em> of <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using <em>'RETURN service.@Rid as Service_RID, service.Name as Service_Name, service.Type as Service_Type'</em> as <code>RETURN</code> clause, this is the obtained list of records (only few records are shown in the image below):</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_16_browse.png" alt="" /></p>
<h2 id="example-2-5"><a class="header" href="#example-2-5">Example 2</a></h2>
<p>Find the 3 Hotels that have been booked most times:</p>
<pre><code class="language-sql">SELECT 
  Name, Type, in("HasStayed").size() AS NumberOfBookings 
FROM Hotels 
ORDER BY NumberOfBookings DESC 
LIMIT 3
</code></pre>
<p>In the <em>Browse Tab</em> of <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using the query below, this is the obtained list of records:</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_21_browse.png" alt="" /></p>
<p>In a similar way:</p>
<p>Find the 3 Restaurants that have been used most times:</p>
<pre><code class="language-sql">SELECT 
  Name, Type, in("HasEaten").size() AS VisitsNumber 
FROM Restaurants 
ORDER BY VisitsNumber DESC 
LIMIT 3
</code></pre>
<p>In the <em>Browse Tab</em> of <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using the query below, this is the obtained list of records:</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_22_browse.png" alt="" /></p>
<h2 id="example-3-3"><a class="header" href="#example-3-3">Example 3</a></h2>
<p>Find the 3 Hotels that have most reviews:</p>
<pre><code class="language-sql">SELECT 
  Name, Type, out("HasReview").size() AS ReviewNumbers 
FROM `Hotels` 
ORDER BY ReviewNumbers DESC 
LIMIT 3
</code></pre>
<p>In the <em>Browse Tab</em> of <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using the query below, this is the obtained list of records:</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_23_browse.png" alt="" /></p>
<p>In a similar way:</p>
<p>Find the 3 Restaurants that have most reviews :</p>
<pre><code class="language-sql">SELECT 
  Name, Type, out("HasReview").size() AS ReviewNumbers 
FROM `Restaurants` 
ORDER BY ReviewNumbers DESC 
LIMIT 3
</code></pre>
<p>In the <em>Browse Tab</em> of <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using the query below, this is the obtained list of records:</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_24_browse.png" alt="" /></p>
<h2 id="example-4-3"><a class="header" href="#example-4-3">Example 4</a></h2>
<p>Find the top 3 nationality of the tourists that have eaten at Restaurant with Id 26:</p>
<pre><code class="language-sql">SELECT 
  Name, 
  count(*) as CountryCount 
FROM (
  SELECT 
    expand(out('IsFromCountry')) AS countries 
  FROM (
    SELECT 
      expand(in("HasEaten")) AS customers 
    FROM Restaurants 
    WHERE Id='26' 
    UNWIND customers) 
  UNWIND countries) 
GROUP BY Name 
ORDER BY CountryCount DESC 
LIMIT 3
</code></pre>
<p>In the <em>Browse Tab</em> of <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using the query below, this is the obtained list of records:</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_25_browse.png" alt="" /></p>
<p>In a similar way:</p>
<p>Find the top 3 nationality of the tourists that stayed at Hotel with Id 627:</p>
<pre><code class="language-sql">SELECT 
  Name, count(*) as CountryCount 
FROM (
  SELECT 
    expand(out('IsFromCountry')) AS countries 
  FROM (
    SELECT 
      expand(in("HasStayed")) AS customers 
    FROM Hotels 
    WHERE Id='627' 
    UNWIND customers) 
  UNWIND countries) 
GROUP BY Name 
ORDER BY CountryCount DESC 
LIMIT 3
</code></pre>
<p>In the <em>Browse Tab</em> of <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using the query below, this is the obtained list of records:</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_26_browse.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="locations"><a class="header" href="#locations">Locations</a></h1>
<h2 id="example-1-7"><a class="header" href="#example-1-7">Example 1</a></h2>
<p>Find all Locations visited by Santo:</p>
<pre><code class="language-sql">MATCH {Class: Profiles, as: profile, where: (Name='Santo' AND Surname='OrientDB')}&lt;-HasProfile-{Class: Customers, as: customer}-HasVisited-&gt;{class: Locations, as: location} 
RETURN $pathelements
</code></pre>
<p>In the <em>Graph Editor</em> included in <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using the query above, this is the obtained graph:</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_35_graph.png" alt="" /></p>
<h2 id="example-2-6"><a class="header" href="#example-2-6">Example 2</a></h2>
<p>{% include "./include-file-7.md" %}</p>
<h2 id="example-3-4"><a class="header" href="#example-3-4">Example 3</a></h2>
<p>{% include "./include-file-8.md" %}</p>
<h2 id="example-4-4"><a class="header" href="#example-4-4">Example 4</a></h2>
<p>Find all Locations visited by Customer with OrderedId 2:</p>
<pre><code class="language-sql">MATCH {Class: Locations, as: location}&lt;-HasVisited-{class: Customers, as: customer, where: (OrderedId=2)}
RETURN $pathelements
</code></pre>
<p>In the <em>Graph Editor</em> included in <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using <em>'RETURN $pathelements'</em> as <code>RETURN</code> clause, this is the obtained graph:</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_18_graph.png" alt="" /></p>
<p>In the <em>Browse Tab</em> of <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using <em>'RETURN location.@Rid as Location_RID, location.Name as Location_Name, location.Type as Location_Type'</em> as <code>RETURN</code> clause, this is the obtained list of records (only few records are shown in the image below):</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_18_browse.png" alt="" /></p>
<h2 id="example-5-3"><a class="header" href="#example-5-3">Example 5</a></h2>
<p>Find all Locations visited by Santo's friends:</p>
<pre><code class="language-sql">MATCH {Class: Profiles, as: profile, where: (Name='Santo' and Surname='OrientDB')}-HasFriend-&gt;{Class: Profiles, as: friend}&lt;-HasProfile-{Class: Customers, as: customer}-HasVisited-&gt;{Class: Locations, as: location} 
RETURN $pathelements
</code></pre>
<p>In the <em>Graph Editor</em> included in <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using <em>'RETURN $pathelements'</em> as <code>RETURN</code> clause, this is the obtained graph:</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_27_graph.png" alt="" /></p>
<p>In the <em>Browse Tab</em> of <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using <em>'location.@Rid as Location_RID, location.Name as Location_Name, location.Type as Location_Type, friend.Name as Friend_Name, friend.Surname as Friend_Surname'</em> as <code>RETURN</code> clause, this is the obtained list of records (only few records are shown in the image below):</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_27_browse.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="reviews"><a class="header" href="#reviews">Reviews</a></h1>
<h2 id="example-1-8"><a class="header" href="#example-1-8">Example 1</a></h2>
<p>Find number of Reviews per star:</p>
<pre><code class="language-sql">SELECT 
  Stars, count(*) as Count 
FROM HasReview 
GROUP BY Stars 
ORDER BY Count DESC
</code></pre>
<p>In the <em>Browse Tab</em> of <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using the query above, this is the obtained list of records:</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_33_browse.png" alt="" /></p>
<h2 id="example-2-7"><a class="header" href="#example-2-7">Example 2</a></h2>
<p>Find all reviewed Services:</p>
<pre><code class="language-sql">MATCH {class: Services, as: s}-HasReview-&gt;{class: Reviews, as: r} 
RETURN $pathelements
</code></pre>
<p>In the <em>Graph Editor</em> included in <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using the query above, this is the obtained graph:</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_45_graph.png" alt="" /></p>
<h2 id="example-3-5"><a class="header" href="#example-3-5">Example 3</a></h2>
<p>Find all reviewed Services and the Customer who made the review:</p>
<pre><code class="language-sql">MATCH {class: Services, as: s}-HasReview-&gt;{class: Reviews, as: r}&lt;-MadeReview-{class: Customers, as: c} 
RETURN $pathelements 
</code></pre>
<p>In the <em>Graph Editor</em> included in <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using the query above, this is the obtained graph:</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_46_graph.png" alt="" /></p>
<h2 id="example-4-5"><a class="header" href="#example-4-5">Example 4</a></h2>
<p>Find the numbers of reviews per Service:</p>
<pre><code class="language-sql">SELECT 
  @rid as Service_RID,
  Name as Service_Name,
  Type as Service_Type,
  out("HasReview").size() AS ReviewNumbers 
FROM `Services` 
ORDER BY ReviewNumbers DESC
</code></pre>
<p>In the <em>Browse Tab</em> of <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using the query above, this is the obtained list of records:</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_34_browse.png" alt="" /></p>
<h2 id="example-5-4"><a class="header" href="#example-5-4">Example 5</a></h2>
<p>{% include "./include-file-2.md" %}</p>
<h2 id="example-6-3"><a class="header" href="#example-6-3">Example 6</a></h2>
<p>{% include "./include-file-3.md" %}</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="recommendations"><a class="header" href="#recommendations">Recommendations</a></h1>
<h2 id="example-1-9"><a class="header" href="#example-1-9">Example 1</a></h2>
<p>Recommend some friends to Profile 'Isabella Gomez' (friends of friends):</p>
<pre><code class="language-sql">MATCH 
  {class: Profiles, as: profile, where: (Name = 'Isabella' AND Surname='Gomez')}-HasFriend-{as: friend},
  {as: friend}-HasFriend-{as: friendOfFriend, where: ($matched.profile not in $currentMatch.both('HasFriend') and $matched.profile != $currentMatch)} 
RETURN DISTINCT friendOfFriend.Name
</code></pre>
<p>In the <em>Browse Tab</em> of <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using the query above, this is the obtained list of records (only few records are shown in the image below):</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_recommendation_1_browse.png" alt="" /></p>
<h2 id="example-2-8"><a class="header" href="#example-2-8">Example 2</a></h2>
<p>Recommend some Hotels to Customer with OrderedId 1:</p>
<pre><code class="language-sql">MATCH 
  {Class: Customers, as: customer, where: (OrderedId=1)}-HasProfile-&gt;{class: Profiles, as: profile},
  {as: profile}-HasFriend-&gt;{class: Profiles, as: friend},
  {as: friend}&lt;-HasProfile-{Class: Customers, as: customerFriend},
  {as: customerFriend}-HasStayed-&gt;{Class: Hotels, as: hotel},
  {as: customerFriend}-MadeReview-&gt;{Class: Reviews, as: review},
  {as: hotel}-HasReview-&gt;{as: review}
RETURN $pathelements
</code></pre>
<p>In the <em>Graph Editor</em> included in <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using <em>'RETURN $pathelements'</em> as <code>RETURN</code> clause, this is the obtained graph:</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_recommendation_2_graph.png" alt="" /></p>
<p>To filter additionally, and suggest only the 4 and 5-rated hotels, it is possible to add a filter condition on the 'HasReview' edge (property 'Stars'):</p>
<pre><code class="language-sql">MATCH
  {Class: Customers, as: customer, where: (OrderedId=1)}-HasProfile-&gt;{class: Profiles, as: profile},
  {as: profile}-HasFriend-&gt;{class: Profiles, as: friend},
  {as: friend}&lt;-HasProfile-{Class: Customers, as: customerFriend},
  {as: customerFriend}-HasStayed-&gt;{Class: Hotels, as: hotel},
  {as: customerFriend}-MadeReview-&gt;{Class: Reviews, as: review},
  {as: hotel}.outE('HasReview'){as: ReviewStars, where: (Stars&gt;3)}.inV(){as: review}
RETURN $pathelements
</code></pre>
<p>In the <em>Graph Editor</em> included in <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using <em>'RETURN $pathelements'</em> as <code>RETURN</code> clause, this is the obtained graph:</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_recommendation_3_graph.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="business-opportunities"><a class="header" href="#business-opportunities">Business Opportunities</a></h1>
<h2 id="example-1-10"><a class="header" href="#example-1-10">Example 1</a></h2>
<p>{% include "./include-file-1.md" %}</p>
<h2 id="example-2-9"><a class="header" href="#example-2-9">Example 2</a></h2>
<p>Find all the Customer Friends that are not Customers (so that a product can be proposed).</p>
<p>In the <em>Graph Editor</em> included in <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using the query below, this is the obtained graph:</p>
<pre><code class="language-sql">SELECT DISTINCT * FROM (
  SELECT expand(customerFriend) 
  FROM ( 
    MATCH 
      {Class:Customers, as: customer}-HasProfile-{Class:Profiles, as: profile}-HasFriend-{Class:Profiles, as: customerFriend} 
    RETURN customerFriend
  )
) 
WHERE in('HasProfile').size()=0
</code></pre>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_14_graph.png" alt="" /></p>
<p>In the <em>Browse Tab</em> of <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using the query below, this is the obtained list of records (only few records are shown in the image below):</p>
<pre><code class="language-sql">SELECT DISTINCT @Rid as Friend_RID, Name as Friend_Name, Surname as Friend_Surname 
FROM (
  SELECT expand(customerFriend) 
  FROM (
    MATCH 
      {Class:Customers, as: customer}-HasProfile-{Class:Profiles, as: profile}-HasFriend-{Class:Profiles, as: customerFriend} 
    RETURN customerFriend
  )
) 
WHERE in('HasProfile').size()=0
ORDER BY Friend_RID
</code></pre>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_14_browse.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="polymorphism"><a class="header" href="#polymorphism">Polymorphism</a></h1>
<h2 id="example-1-11"><a class="header" href="#example-1-11">Example 1</a></h2>
<p>Find all Locations (Services + Attractions) connected with Customer with OrderedId 1:</p>
<pre><code class="lang-sql">MATCH {class: Customers, as: customer, where: (OrderedId=1)}--{Class: Locations, as: location} 
RETURN $pathelements
</code></pre>
<p>In the <em>Graph Editor</em> included in <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using <em>'RETURN $pathelements'</em> as <code>RETURN</code> clause, this is the obtained graph:</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_17_graph.png" alt="" /></p>
<p>In the <em>Browse Tab</em> of <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, using <em>'RETURN location.@Rid as Location_RID, location.Name as Location_Name, location.Type as Location_Type'</em> as <code>RETURN</code> clause, this is the obtained list of records (only few records are shown in the image below):</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/query_17_browse.png" alt="" /></p>
<h2 id="example-2-10"><a class="header" href="#example-2-10">Example 2</a></h2>
<p>{% include "./include-file-2.md" %}</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="shortest-paths"><a class="header" href="#shortest-paths">Shortest Paths</a></h1>
<h2 id="example-1-12"><a class="header" href="#example-1-12">Example 1</a></h2>
<p>Find the shortest path between the Profile 'Santo' and the Country 'United States':</p>
<pre><code class="language-sql">SELECT expand(path) FROM (
  SELECT shortestPath($from, $to) AS path 
  LET 
    $from = (SELECT FROM Profiles WHERE Name='Santo' and Surname='OrientDB'), 
    $to = (SELECT FROM Countries WHERE Name='United States') 
  UNWIND path
)
</code></pre>
<p>In the <em>Graph Editor</em> included in <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, this is the obtained graph:</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/shortestpath_1_graph.png" alt="" /></p>
<p>In the <em>Browse Tab</em> of <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, this is the obtained list of records:</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/shortestpath_1_browse.png" alt="" /></p>
<h2 id="example-2-11"><a class="header" href="#example-2-11">Example 2</a></h2>
<p>Find the shortest path between the Profile 'Santo' and the Restaurant 'Malga Granezza':</p>
<pre><code class="language-sql">SELECT expand(path) FROM (
  SELECT shortestPath($from, $to) AS path 
  LET 
    $from = (SELECT FROM Profiles WHERE Name='Santo' and Surname='OrientDB'), 
    $to = (SELECT FROM Restaurants WHERE Name='Malga Granezza') 
  UNWIND path
)
</code></pre>
<p>In the <em>Graph Editor</em> included in <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, this is the obtained graph:</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/shortestpath_2_graph.png" alt="" /></p>
<p>In the <em>Browse Tab</em> of <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, this is the obtained list of records:</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/shortestpath_2_browse.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="traverses"><a class="header" href="#traverses">Traverses</a></h1>
<h2 id="example-1-13"><a class="header" href="#example-1-13">Example 1</a></h2>
<p>Traverse everything from Profile 'Santo' up to depth three:</p>
<pre><code class="language-sql">TRAVERSE * FROM (
  SELECT FROM Profiles WHERE Name='Santo' and Surname='OrientDB'
) MAXDEPTH 3
</code></pre>
<p>In the <em>Graph Editor</em> included in <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, this is the obtained graph:</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/traverse_1_graph.png" alt="" /></p>
<p>In the <em>Browse Tab</em> of <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, this is the obtained list of records (only few records are shown in the image below):</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/traverse_1_browse.png" alt="" /></p>
<h2 id="example-2-12"><a class="header" href="#example-2-12">Example 2</a></h2>
<p>Traverse everything from Country 'Italy' up to depth three:</p>
<pre><code class="language-sql">TRAVERSE * FROM (
  SELECT FROM Countries WHERE Name='Italy'
) MAXDEPTH 3
</code></pre>
<p>In the <em>Graph Editor</em> included in <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, this is the obtained graph:</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/traverse_2_graph.png" alt="" /></p>
<p>In the <em>Browse Tab</em> of <a href="gettingstarted/demodb/queries/../../../studio/README.html">Studio</a>, this is the obtained list of records (only few records are shown in the image below):</p>
<p><img src="gettingstarted/demodb/queries/../../../images/demo-dbs/social-travel-agency/traverse_2_browse.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="graph-portions"><a class="header" href="#graph-portions">Graph Portions</a></h1>
<p>This Section includes some screen-shots on "portions" of the <code>demodb</code> graph.</p>
<p>{% include "./include-demodb-version-warning.md" %}</p>
<h2 id="profiles-1"><a class="header" href="#profiles-1">Profiles</a></h2>
<p>The graph below includes vertices in the <em>Profiles</em> class.</p>
<p>Some profiles have no friends, and ten profile "communities" are easily identifiable (a "community" is a group of highly connected profiles):</p>
<p><img src="gettingstarted/demodb/../../images/demo-dbs/social-travel-agency/profiles.png" alt="" /></p>
<h2 id="customers-friends"><a class="header" href="#customers-friends">Customers' Friends</a></h2>
<p>The graph below shows the relationships between all customers and their friends.</p>
<p>All customer vertices are connected to their corresponding profiles in the social platform. The profiles may have friends, or not.</p>
<p><img src="gettingstarted/demodb/../../images/demo-dbs/social-travel-agency/customers_friends.png" alt="" /></p>
<h2 id="customer-country-relationship"><a class="header" href="#customer-country-relationship">Customer-Country Relationship</a></h2>
<p>The graph below shows the relationships between all customers and their countries of origin:</p>
<p><img src="gettingstarted/demodb/../../images/demo-dbs/social-travel-agency/customers_countries.png" alt="" /></p>
<h2 id="customer-restaurant-relationship"><a class="header" href="#customer-restaurant-relationship">Customer-Restaurant Relationship</a></h2>
<p>Relationships between customers and restaurants are reported in the graph below:</p>
<p><img src="gettingstarted/demodb/../../images/demo-dbs/social-travel-agency/customers_restaurants.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql"><a class="header" href="#sql">SQL</a></h1>
<p>Most NoSQL products employ a custom query language.  In this, OrientDB differs by focusing on standards in query languages.  That is, instead of inventing "Yet Another Query Language," it begins with the widely used and well-understood language of SQL.  It then extends SQL to support more complex graphing concepts, such as Trees and Graphs.</p>
<p>Why SQL?  Because SQL is ubiquitous in the database development world. It is familiar and more readable and concise than its competitors, such as Map Reduce scripts or JSON based querying.</p>
<h2 id="select"><a class="header" href="#select"><code>SELECT</code></a></h2>
<p>The <a href="gettingstarted/../sql/SQL-Query.html"><code>SELECT</code></a> statement queries the database and returns results that match the given parameters.  For instance, earlier in <a href="gettingstarted/Tutorial-Introduction-to-the-NoSQL-world.html">Getting Started</a>, two queries were presented that gave the same results: <code>BROWSE CLUSTER ouser</code> and <code>BROWSE CLASS OUser</code>. Here is a third option, available through a <a href="gettingstarted/../sql/SQL-Query.html"><code>SELECT</code></a> statement.</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM OUser</code>
</pre>
<p>Notice that the query has no projections. This means that you do not need to enter a character to indicate that the query should return the entire record, such as the asterisk in the Relational model, (that is, <code>SELECT * FROM OUser</code>).</p>
<p>Additionally, OUser is a class. By default, OrientDB executes queries against classes. Targets can also be:</p>
<ul>
<li>
<p><strong>Clusters</strong>  To execute against a cluster, rather than a class, prefix <code>CLUSTER</code> to the target name.</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM CLUSTER:Ouser</code>
</pre>
</li>
<li>
<p><strong>Record ID</strong> To execute against one or more <a href="gettingstarted/../datamodeling/Concepts.html#record-id">Record ID's</a>, use the identifier(s) as your target.  For example.</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM #10:3</code>
orientdb> <code class="lang-sql userinput">SELECT FROM [#10:1, #10:30, #10:5]</code>
</pre>
</li>
<li>
<p><strong>Indexes</strong> To execute a query against an index, prefix <code>INDEX</code> to the target name.</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT VALUE FROM INDEX:dictionary WHERE key='Jay'</code>
</pre>
</li>
</ul>
<h3 id="where"><a class="header" href="#where"><code>WHERE</code></a></h3>
<p>Much like the standard implementation of SQL, OrientDB supports <a href="gettingstarted/../sql/SQL-Where.html"><code>WHERE</code></a> conditions to filter the returning records too.  For example,</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM OUser WHERE name LIKE 'l%'</code>
</pre>
<p>This returns all <code>OUser</code> records where the name begins with <code>l</code>.  For more information on supported operators and functions, see <a href="gettingstarted/../sql/SQL-Where.html"><code>WHERE</code></a>.</p>
<h3 id="order-by"><a class="header" href="#order-by"><code>ORDER BY</code></a></h3>
<p>In addition to <a href="gettingstarted/../sql/SQL-Where.html"><code>WHERE</code></a>, OrientDB also supports <code>ORDER BY</code> clauses. This allows you to order the results returned by the query according to one or more fields, in either ascending or descending order.</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM Employee WHERE city='Rome' ORDER BY surname ASC, name ASC</code>
</pre>
<p>The example queries the <code>Employee</code> class, it returns a listing of all employees in that class who live in Rome and it orders the results by surname and name, in ascending order.</p>
<h3 id="group-by"><a class="header" href="#group-by"><code>GROUP BY</code></a></h3>
<p>In the event that you need results of the query grouped together according to the values of certain fields, you can manage this using the <code>GROUP BY</code> clause.</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT SUM(salary) FROM Employee WHERE age < 40 GROUP BY job</code>
</pre>
<p>In the example, you query the <code>Employee</code> class for the sum of the salaries of all employees under the age of forty, grouped by their job types.</p>
<h3 id="limit"><a class="header" href="#limit"><code>LIMIT</code></a></h3>
<p>In the event that your query returns too many results, making it difficult to read or manage, you can use the <code>LIMIT</code> clause to reduce it to the top most of the return values.</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM Employee WHERE gender='male' LIMIT 20</code>
</pre>
<p>In the example, you query the <code>Employee</code> class for a list of male employees.  Given that there are likely to be a number of these, you limit the return to the first twenty entries.</p>
<h3 id="skip"><a class="header" href="#skip"><code>SKIP</code></a></h3>
<p>When using the <code>LIMIT</code> clause with queries, you can only view the topmost of the return results. In the event that you would like to view certain results further down the list, for instance the values from twenty to forty, you can paginate your results using the <code>SKIP</code> keyword in the <code>LIMIT</code> clause.</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM Employee WHERE gender='male' LIMIT 20</code>
orientdb> <code class="lang-sql userinput">SELECT FROM Employee WHERE gender='male' SKIP 20 LIMIT 20</code>
orientdb> <code class="lang-sql userinput">SELECT FROM Employee WHERE gender='male' SKIP 40 LIMIT 20</code>
</pre>
<p>The first query returns the first twenty results, the second returns the next twenty results, the third up to sixty.  You can use these queries to manage pages at the application layer.</p>
<h2 id="insert"><a class="header" href="#insert"><code>INSERT</code></a></h2>
<p>The <a href="gettingstarted/../sql/SQL-Insert.html"><code>INSERT</code></a> statement adds new data to a class and cluster.  OrientDB supports three forms of syntax used to insert new data into your database.</p>
<ul>
<li>
<p>The standard ANSI-92 syntax:</p>
<pre>
orientdb> <code class="lang-sql userinput">INSERT INTO	Employee(name, surname, gender)
        VALUES('Jay', 'Miner', 'M')</code>
</pre>
</li>
<li>
<p>The simplified ANSI-92 syntax:</p>
<pre>
orientdb> <code class="lang-sql userinput">INSERT INTO Employee SET name='Jay', surname='Miner', gender='M'</code>
</pre>
</li>
<li>
<p>The JSON syntax:</p>
<pre>
orientdb> <code class="lang-sql userinput">INSERT INTO Employee CONTENT</code> <code class="lang-json userinput">{name : 'Jay', surname : 'Miner',
        gender : 'M'}</code>
</pre>
</li>
</ul>
<p>Each of these queries adds Jay Miner to the <code>Employee</code> class. You can choose whichever syntax that works best with your application.</p>
<h2 id="update"><a class="header" href="#update"><code>UPDATE</code></a></h2>
<p>The <a href="gettingstarted/../sql/SQL-Update.html"><code>UPDATE</code></a> statement changes the values of existing data in a class and cluster.  In OrientDB there are two forms of syntax used to update data on your database.</p>
<ul>
<li>
<p>The standard ANSI-92 syntax:</p>
<pre>
orientdb> <code class="lang-sql userinput">UPDATE Employee SET local=TRUE WHERE city='London'</code>
</pre>
</li>
<li>
<p>The JSON syntax, used with the <code>MERGE</code> keyword, which merges the changes with the current record:</p>
<pre>
orientdb> <code class="lang-sql userinput">UPDATE Employee MERGE { local : TRUE } WHERE city='London'</code>
</pre>
</li>
</ul>
<p>Each of these statements updates the <code>Employee</code> class, changing the <code>local</code> property to <code>TRUE</code> when the employee is based in London.</p>
<h2 id="delete"><a class="header" href="#delete"><code>DELETE</code></a></h2>
<p>The <a href="gettingstarted/../sql/SQL-Delete.html"><code>DELETE</code></a> statement removes existing values from your class and cluster.  OrientDB supports the standard ANSI-92 compliant syntax for these statements:</p>
<pre>
orientdb> <code class="lang-sql userinput">DELETE FROM Employee WHERE city <> 'London'
</pre>
<p>Here, entries are removed from the <code>Employee</code> class where the employee in question is not based in London.</p>
<p><strong>See also:</strong></p>
<ul>
<li><a href="gettingstarted/../sql/README.html">The SQL Reference</a></li>
<li><a href="gettingstarted/../console/Console-Commands.html">The Console Command Reference</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="users-roles-and-security"><a class="header" href="#users-roles-and-security">Users, Roles and Security</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="distributed-architecture"><a class="header" href="#distributed-architecture">Distributed Architecture</a></h1>
<div style="break-before: page; page-break-before: always;"></div><hr />
<h2>search:
keywords: ['tutorials']</h2>
<h1 id="tutorials"><a class="header" href="#tutorials">Tutorials</a></h1>
<p>This Section includes all the Tutorials available in this Manual.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="working-with-graphs"><a class="header" href="#working-with-graphs">Working with Graphs</a></h1>
<p>In graph databases, the database system graphs data into network-like structures consisting of vertices and edges. In the OrientDB <a href="gettingstarted/../datamodeling/Tutorial-Document-and-graph-model.html#the-graph-model">Graph model</a>, the database represents data through the concept of a property graph, which defines a vertex as an entity linked with other vertices and an edge, as an entity that links two vertices.</p>
<p>OrientDB ships with a generic vertex persistent class, called <code>V</code>, as well as a class for edges, called <code>E</code>. As an example, you can create a new vertex using the <a href="gettingstarted/../sql/SQL-Insert.html"><code>INSERT</code></a> command with <code>V</code>.</p>
<pre>
orientdb> <code class="lang-sql userinput">INSERT INTO V SET name='Jay'</code>

Created record with RID #9:0
</pre>
<p>In effect, the Graph model database works on top of the underlying document model. But, in order to simplify this process, OrientDB introduces a new set of commands for managing graphs from the console. Instead of <a href="gettingstarted/../sql/SQL-Insert.html"><code>INSERT</code></a>, use <a href="gettingstarted/../sql/SQL-Create-Vertex.html"><code>CREATE VERTEX</code></a></p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE VERTEX V SET name='Jay'</code>

Created vertex with RID #9:1
</pre>
<p>By using the graph commands over the standard SQL syntax, OrientDB ensures that your graphs remain consistent. For more information on the particular commands, see the following pages:</p>
<ul>
<li><a href="gettingstarted/../sql/SQL-Create-Vertex.html">CREATE VERTEX</a></li>
<li><a href="gettingstarted/../sql/SQL-Delete-Vertex.html">DELETE VERTEX</a></li>
<li><a href="gettingstarted/../sql/SQL-Create-Edge.html">CREATE EDGE</a></li>
<li><a href="gettingstarted/../sql/SQL-Update-Edge.html">UPDATE EDGE</a></li>
<li><a href="gettingstarted/../sql/SQL-Delete-Edge.html">DELETE EDGE</a></li>
</ul>
<h2 id="use-case-social-network-for-restaurant-patrons"><a class="header" href="#use-case-social-network-for-restaurant-patrons">Use Case: Social Network for Restaurant Patrons</a></h2>
<p>While you have the option of working with vertexes and edges in your database as they are, you can also extend the standard <code>V</code> and <code>E</code> classes to suit the particular needs of your application. The advantages of this approach are,</p>
<ul>
<li>It grants better understanding about the meaning of these entities.</li>
<li>It allows for optional constraints at the class level.</li>
<li>It improves performance through better partitioning of entities.</li>
<li>It allows for object-oriented inheritance among the graph elements.</li>
</ul>
<p>For example, consider a social network based on restaurants. You need to start with a class for individual customers and another for the restaurants they patronize. Create these classes to extend the <code>V</code> class.</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE CLASS Person EXTENDS V</code>

orientdb> <code class="lang-sql userinput">CREATE CLASS Restaurant EXTENDS V</code>
</pre>
<p>Doing this creates the schema for your social network. Now that the schema is ready, populate the graph with data.</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE VERTEX Person SET name='Luca'</code>

Created record with RID #11:0


orientdb> <code class="lang-sql userinput">CREATE VERTEX Person SET name='Bill'</code>

Created record with RID #11:1


orientdb> <code class="lang-sql userinput">CREATE VERTEX Person SET name='Jay'</code>

Created record with RID #11:2


orientdb> <code class="lang-sql userinput">CREATE VERTEX Restaurant SET name='Dante', type='Pizza'</code>

Created record with RID #12:0


orientdb> <code class="lang-sql userinput">CREATE VERTEX Restaurant SET name='Charlie', type='French'</code>

Created record with RID #12:1
</pre>
<p>This adds three vertices to the <code>Person</code> class, representing individual users in the social network. It also adds two vertices to the <code>Restaurant</code> class, representing the restaurants that they patronize.</p>
<h4 id="creating-edges-1"><a class="header" href="#creating-edges-1">Creating Edges</a></h4>
<p>For the moment, these vertices are independent of one another, tied together only by the classes to which they belong. That is, they are not yet connected by edges. Before you can make these connections, you first need to create a class that extends <code>E</code>.</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE CLASS Eat EXTENDS E</code>
</pre>
<p>This creates the class <code>Eat</code>, which extends the class <code>E</code>. <code>Eat</code> represents the relationship between the vertex <code>Person</code> and the vertex <code>Restaurant</code>.</p>
<p>When you create the edge from this class, note that the orientation of the vertices is important, because it gives the relationship its meaning. For instance, creating an edge in the opposite direction, (from <code>Restaurant</code> to <code>Person</code>), would call for a separate class, such as <code>Attendee</code>.</p>
<p>The user Luca eats at the pizza joint Dante. Create an edge that represents this connection:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE EDGE Eat FROM ( SELECT FROM Person WHERE name='Luca' )
          TO ( SELECT FROM Restaurant WHERE name='Dante' )</code>
</pre>
<h4 id="creating-edges-from-record-id"><a class="header" href="#creating-edges-from-record-id">Creating Edges from Record ID</a></h4>
<p>In the event that you know the <a href="gettingstarted/../datamodeling/Concepts.html#record-id">Record ID</a> of the vertices, you can connect them directly with a shorter and faster command. For example, the person Bill also eats at the restaurant Dante and the person Jay eats at the restaurant Charlie. Create edges in the class <code>Eat</code> to represent these connections.</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE EDGE Eat FROM #11:1 TO #12:0</code>

orientdb> <code class="lang-sql userinput">CREATE EDGE Eat FROM #11:2 TO #12:1</code>
</pre>
<h4 id="querying-graphs"><a class="header" href="#querying-graphs">Querying Graphs</a></h4>
<p>In the above example you created and populated a small graph of a social network of individual users and the restaurants at which they eat. You can now begin to experiment with queries on a graph database.</p>
<p>To cross edges, you can use special graph functions, such as:</p>
<ul>
<li><code>OUT()</code> To retrieve the adjacent outgoing vertices</li>
<li><code>IN()</code> To retrieve the adjacent incoming vertices</li>
<li><code>BOTH()</code> To retrieve the adjacent incoming and outgoing vertices</li>
</ul>
<p>For example, to know all of the people who eat in the restaurant Dante, which has a Record ID of <code>#12:0</code>, you can access the record for that restaurant and traverse the incoming edges to discover which entries in the <code>Person</code> class connect to it.</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT IN() FROM Restaurant WHERE name='Dante'</code>

-------+----------------+
 @RID  | in             |
-------+----------------+
 #-2:1 | [#11:0, #11:1] |
-------+----------------+
</pre>
<p>This query displays the record ID's from the <code>Person</code> class that connect to the restaurant Dante. In cases such as this, you can use the <code>EXPAND()</code> special function to transform the vertex collection in the result-set by expanding it.</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT EXPAND( IN() ) FROM Restaurant WHERE name='Dante'</code>

-------+-------------+-------------+---------+
 @RID  | @CLASS      | Name        | out_Eat |
-------+-------------+-------------+---------+
 #11:0 | Person      | Luca        | #12:0   |
 #11:1 | Person      | Bill        | #12:0   |
-------+-------------+-------------+---------+
</pre>
<h4 id="creating-edge-to-connect-users"><a class="header" href="#creating-edge-to-connect-users">Creating Edge to Connect Users</a></h4>
<p>Your application at this point shows connections between individual users and the restaurants they patronize. While this is interesting, it does not yet function as a social network. To do so, you need to establish edges that connect the users to one another.</p>
<p>To begin, as before, create a new class that extends <code>E</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE CLASS Friend EXTENDS E</code>
</pre>
<p>The users Luca and Jay are friends. They have Record ID's of <code>#11:0</code> and <code>#11:2</code>. Create an edge that connects them.</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE EDGE Friend FROM #11:0 TO #11:2</code>
</pre>
<p>In the <code>Friend</code> relationship, orientation is not important. That is, if Luca is a friend of Jay's then Jay is a friend of Luca's. Therefore, you should use the <code>BOTH()</code> function.</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT EXPAND( BOTH( 'Friend' ) ) FROM Person WHERE name = 'Luca'</code>

-------+-------------+-------------+---------+-----------+
 @RID  | @CLASS      | Name        | out_Eat | in_Friend |
-------+-------------+-------------+---------+-----------+
 #11:2 | Person      | Jay         | #12:1   | #11:0     |
-------+-------------+-------------+---------+-----------+
</pre>
<p>Here, the <code>BOTH()</code> function takes the edge class <code>Friend</code> as an argument, crossing only relationships of the Friend kind, (that is, it skips the <code>Eat</code> class, at this time). Note in the result-set that the relationship with Luca, with a Record ID of <code>#11:0</code> in the <code>in_</code> field.</p>
<p>You can also now view all the restaurants patronized by friends of Luca.</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT EXPAND( BOTH('Friend').out('Eat') ) FROM Person
          WHERE name='Luca'</code>

-------+-------------+-------------+-------------+--------+
 @RID  | @CLASS      | Name        | Type        | in_Eat |
-------+-------------+-------------+-------------+--------+
 #12:1 | Restaurant  | Charlie     | French      | #11:2  |
-------+-------------+-------------+-------------+--------+
</pre>
<h2 id="lightweight-edges"><a class="header" href="#lightweight-edges">Lightweight Edges</a></h2>
<p>In version 1.4.x, OrientDB begins to manage some edges as Lightweight Edges. Lightweight Edges do not have Record ID's, but are physically stored as links within vertices. Note that OrientDB only uses a Lightweight Edge only when the edge has no properties, otherwise it uses the standard Edge.</p>
<p>From the logic point of view, Lightweight Edges are Edges in all effects, so that all graph functions work with them. This is to improve performance and reduce disk space.</p>
<p>Because Lightweight Edges don't exist as separate records in the database, some queries won't work as expected. For instance,</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM E</code>
</pre>
<p>For most cases, an edge is used connecting vertices, so this query would not cause any problems in particular. But, it would not return Lightweight Edges in the result-set. In the event that you need to query edges directly, including those with no properties, disable the Lightweight Edge feature.</p>
<p>To disable the Lightweight Edge feature, execute the following command.</p>
<pre>
orientdb> <code class="lang-sql userinput">ALTER DATABASE CUSTOM useLightweightEdges=FALSE
</pre>
<p>You only need to execute this command once. OrientDB now generates new edges as the standard Edge, rather than the Lightweight Edge. Note that this does not affect existing edges.</p>
<p>For troubleshooting information on Lightweight Edges, see <a href="gettingstarted/../misc/Troubleshooting.html#why-cant-i-see-all-the-edges">Why I can't see all the edges</a>. For more information in the Graph model in OrientDB, see <a href="gettingstarted/../java/Graph-Database-Tinkerpop.html">Graph API</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-11-26 SAM -->
<h1 id="using-schema-with-graphs"><a class="header" href="#using-schema-with-graphs">Using Schema with Graphs</a></h1>
<p>OrientDB, through the Graph API, offers a number of features above and beyond the traditional Graph Databases given that it supports concepts drawn from both the Document Database and the Object Oriented worlds. For instance, consider the power of graphs, when used in conjunction with schemas and constraints.</p>
<h2 id="use-case-car-database"><a class="header" href="#use-case-car-database">Use Case: Car Database</a></h2>
<p>For this example, consider a graph database that maps the relationship between individual users and their cars.  First, create the graph schema for the <code>Person</code> and <code>Car</code> vertex classes, as well as the <code>Owns</code> edge class to connect the two:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE CLASS Person EXTENDS V</code>

orientdb> <code class="lang-sql userinput">CREATE CLASS Car EXTENDS V</code>

orientdb> <code class="lang-sql userinput">CREATE CLASS Owns EXTENDS E</code>
</pre>
<p>These commands lay out the schema for your graph database.  That is, they define two vertex classes and an edge class to indicate the relationship between the two.  With that, you can begin to populate the database with vertices and edges.</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE VERTEX Person SET name = 'Luca'</code>

Created vertex 'Person#11:0{name:Luca} v1' in 0,012000 sec(s).


orientdb> <code class="lang-sql userinput">CREATE VERTEX Car SET name = 'Ferrari Modena'</code>

Created vertex 'Car#12:0{name:Ferrari Modena} v1' in 0,001000 sec(s).


orientdb> <code class="lang-sql userinput">CREATE EDGE Owns FROM ( SELECT FROM Person ) TO ( SELECT FROM Car )</code>

Created edge '[e[#11:0->#12:0][#11:0-Owns->#12:0]]' in 0,005000 sec(s).
</pre>
<h3 id="querying-the-car-database"><a class="header" href="#querying-the-car-database">Querying the Car Database</a></h3>
<p>In the above section, you create a car database and populated it with vertices and edges to map out the relationship between drivers and their cars.  Now you can begin to query this database, showing what those connections are.  For example, what is Luca's car?  You can find out by traversing from the vertex Luca to the outgoing vertices following the <code>Owns</code> relationship.</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT name FROM ( SELECT EXPAND( OUT('Owns') ) FROM Person
          WHERE name='Luca' )</code>

----+-------+-----------------+
 #  | @RID  | name            |
----+-------+-----------------+
 0  | #-2:1 | Ferrari Modena  |
----+-------+-----------------+
</pre>
<p>As you can see, the query returns that Luca owns a Ferrari Modena.  Now consider expanding your database to track where each person lives.</p>
<h3 id="adding-a-location-vertex"><a class="header" href="#adding-a-location-vertex">Adding a Location Vertex</a></h3>
<p>Consider a situation, in which you might want to keep track of the countries in which each person lives. In practice, there are a number of reasons why you might want to do this, for instance, for the purposes of promotional material or in a larger database to analyze the connections to see how residence affects car ownership.</p>
<p>To begin, create a vertex class for the country, in which the person lives and an edge class that connects the individual to the place.</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE CLASS Country EXTENDS V</code>

orientdb> <code class="lang-sql userinput">CREATE CLASS Lives EXTENDS E</code>

</pre>
<p>This creates the schema for the feature you're adding to the cars database.  The vertex class <code>Country</code> recording countries in which people live and the edge class <code>Lives</code> to connect individuals in the vertex class <code>Person</code> to entries in <code>Country</code>.</p>
<p>With the schema laid out, create a vertex for the United Kingdom and connect it to the person Luca.</p>
<pre>

orientdb> <code class="lang-sql userinput">CREATE VERTEX Country SET name='UK'</code>

Created vertex 'Country#14:0{name:UK} v1' in 0,004000 sec(s).


orientdb> <code class="lang-sql userinput">CREATE EDGE Lives FROM ( SELECT FROM Person ) TO ( SELECT FROM Country</code>

Created edge '[e[#11:0->#14:0][#11:0-Lives->#14:0]]' in 0,006000 sec(s).
</pre>
<p>The second command creates an edge connecting the person Luca to the country United Kingdom.  Now that your cars database is defined and populated, you can query it, such as a search that shows the countries where there are users that own a Ferrari.</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT name FROM ( SELECT EXPAND( IN('Owns').OUT('Lives') )
          FROM Car WHERE name LIKE '%Ferrari%' )</code>

---+-------+--------+
 # | @RID  | name   |
---+-------+--------+
 0 | #-2:1 | UK     |
---+-------+--------+
</pre>
<h3 id="using-in-and-out-constraints-on-edges"><a class="header" href="#using-in-and-out-constraints-on-edges">Using <code>in</code> and <code>out</code> Constraints on Edges</a></h3>
<p>In the above sections, you modeled the graph using a schema without any constraints, but you might find it useful to use some.  For instance, it would be good to require that an <code>Owns</code> relationship only exist between the vertex <code>Person</code> and the vertex <code>Car</code>.</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE PROPERTY Owns.out LINK Person</code>

orientdb> <code class="lang-sql userinput">CREATE PROPERTY Owns.in LINK Car</code>
</pre>
<p>These commands link outgoing vertices of the <code>Person</code> class to incoming vertices of the <code>Car</code> class.  That is, it configures your database so that a user can own a car, but a car cannot own a user.</p>
<h3 id="using-mandatory-constraints-on-edges"><a class="header" href="#using-mandatory-constraints-on-edges">Using <code>MANDATORY</code> Constraints on Edges</a></h3>
<p>By default, when OrientDB creates an edge that lacks properties, it creates it as a Lightweight Edge.  That is, it creates an edge that has no physical record in the database.  Using the <code>MANDATORY</code> setting, you can stop this behavior, forcing it to create the standard Edge, without outright disabling Lightweight Edges.</p>
<pre>
orientdb> <code class="lang-sql userinput">ALTER PROPERTY Owns.out MANDATORY TRUE</code>
orientdb> <code class="lang-sql userinput">ALTER PROPERTY Owns.in MANDATORY TRUE</code>
</pre>
<h3 id="using-unique-with-edges"><a class="header" href="#using-unique-with-edges">Using <code>UNIQUE</code> with Edges</a></h3>
<p>For the sake of simplicity, consider a case where you want to limit the way people are connected to cars to where the user can only match to the car once.  That is, if Luca owns a Ferrari Modena, you might prefer not to have a double entry for that car in the event that he buys a new one a few years later.  This is particularly important given that our database covers make and model, but not year.</p>
<p>To manage this, you need to define a <code>UNIQUE</code> index against both the out and in properties.</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE INDEX UniqueOwns ON Owns(out,in) UNIQUE</code>

Created index successfully with 0 entries in 0,023000 sec(s).
</pre>
<p>The index returns tells us that no entries are indexed.  You have already created the <code>Owns</code> relationship between Luca and the Ferrari Modena.  In that case, however, OrientDB had created a Lightweight Edge before you set the rule to force the creation of documents for <code>Owns</code> instances.  To fix this, you need to drop and recreate the edge.</p>
<pre>
orientdb> <code class="lang-sql userinput">DELETE EDGE FROM #11:0 TO #12:0</code>
orientdb> <code class="lang-sql userinput">CREATE EDGE Owns FROM ( SELECT FROM Person ) TO ( SELECT FROM Car )</code>
</pre>
<p>To confirm that this was successful, run a query to check that a record was created:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM Owns</code>

---+-------+-------+--------+
 # | @RID  | out   | in     |
---+-------+-------+--------+
 0 | #13:0 | #11:0 | #12:0  |
---+-------+-------+--------+
</pre>
<p>This shows that a record was indeed created.  To confirm that the constraints work, attempt to create an edge in <code>Owns</code> that connects Luca to the United Kingdom.</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE EDGE Owns FROM ( SELECT FROM Person ) TO ( SELECT FROM Country )</code>

Error: com.orientechnologies.orient.core.exception.OCommandExecutionException:
Error on execution of command: sql.create edge Owns from (select from Person)...
Error: com.orientechnologies.orient.core.exception.OValidationException: The
field 'Owns.in' has been declared as LINK of type 'Car' but the value is the
document #14:0 of class 'Country'
</pre>
<p>This shows that the constraints effectively blocked the creation, generating a set of errors to explain why it was blocked.</p>
<p>You now have a typed graph with constraints.  For more information, see <a href="gettingstarted/../java/Graph-Schema.html">Graph Schema</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="setting-up-a-distributed-graph-database"><a class="header" href="#setting-up-a-distributed-graph-database">Setting up a Distributed Graph Database</a></h1>
<p>In addition to the standard deployment architecture, where it runs as a single, standalone database instance, you can also deploy OrientDB using <a href="gettingstarted/tutorials/../Distributed-Architecture.html">Distributed Architecture</a>.  In this environment, it shares the database across multiple server instances.</p>
<h2 id="launching-distributed-server-cluster"><a class="header" href="#launching-distributed-server-cluster">Launching Distributed Server Cluster</a></h2>
<p>There are two ways to share a database across multiple server nodes:</p>
<ul>
<li>
<p>Prior to startup, copy the specific database directory, under <code>$ORIENTDB_HOME/database</code> to all servers.</p>
</li>
<li>
<p>Keep the database on the first running server node, then start every other server node.  Under the default configurations, OrientDB automatically shares the database with the new servers that join.</p>
</li>
</ul>
<p>This tutorial assumes that you want to start a distributed database using the second method.</p>
<p><em>NOTE: When you run in distributed mode, OrientDB needs more RAM. The minimum is 2GB of heap, but we suggest to use at least 4GB of heap memory. To change the heap modify the Java memory settings in the file <code>bin/dserver.sh</code> (or dserver.bat on Windows).</em></p>
<h3 id="starting-the-first-server-node"><a class="header" href="#starting-the-first-server-node">Starting the First Server Node</a></h3>
<p>Unlike the standard standalone deployment of OrientDB, there is a different script that you need to use when launching a distributed server instance.  Instead of <code>server.sh</code>, you use <code>dserver.sh</code>.  In the case of Windows, use <code>dserver.bat</code>.  Whichever you need, you can find it in the <code>bin</code> of your installation directory.</p>
<pre>
$ <code class="lang-sh userinput">./bin/dserver.sh</code>
</pre>
<p>Bear in mind that OrientDB uses the same <code>orientdb-server-config.xml</code> configuration file, regardless of whether it's running as a server or distributed server.  For more information, see <a href="gettingstarted/tutorials/../../distributed/Distributed-Configuration.html">Distributed Configuration</a>.</p>
<p>The first time you start OrientDB as a distributed server, it generates the following output:</p>
<pre><code>+---------------------------------------------------------------+
|         WARNING: FIRST DISTRIBUTED RUN CONFIGURATION          |
+---------------------------------------------------------------+
| This is the first time that the server is running as          |
| distributed. Please type the name you want to assign to the   |
| current server node.                                          |
|                                                               |
| To avoid this message set the environment variable or JVM     |
| setting ORIENTDB_NODE_NAME to the server node name to use.    |
+---------------------------------------------------------------+

Node name [BLANK=auto generate it]:
</code></pre>
<p>You need to give the node a name here.  OrientDB stores it in the <code>nodeName</code> parameter of <code>OHazelcastPlugin</code>.  It adds the variable to your <code>orientdb-server-config.xml</code> configuration file.</p>
<h4 id="distributed-startup-process"><a class="header" href="#distributed-startup-process">Distributed Startup Process</a></h4>
<p>When OrientDB starts as a distributed server instance, it loads all databases in the <code>database</code> directory and configures them to run in distributed mode.  For this reason, the first load, OrientDB copies the default distributed configuration, (that is, the <code>default-distributed-db-config.json</code> configuration file), into each database's directory, renaming it <code>distributed-config.json</code>.  On subsequent starts, each database uses this file instead of the default configuration file.  Since the shape of the cluster changes every time nodes join or leave, the configuration is kept up to date by each distributed server instance.</p>
<p>For more information on working with the <code>default-distributed-db-config.json</code> configuration file, see <a href="gettingstarted/tutorials/../../distributed/Distributed-Configuration.html">Distributed Configuration</a>.</p>
<h3 id="starting-additional-server-nodes"><a class="header" href="#starting-additional-server-nodes">Starting Additional Server Nodes</a></h3>
<p>When you have the first server node running, you can begin to start the other server nodes.  Each server requires the same Hazelcast credentials in order to join the same cluster.  You can define these in the <code>hazelcast.xml</code> configuration file.</p>
<p>The fastest way to initialize multiple server nodes is to copy the OrientDB installation directory from the first node to each of the subsequent nodes.  For instance,</p>
<pre>
$ <code class="lang-sh userinput">scp user@ip_address $ORIENTDB_HOME</code>
</pre>
<p>This copies both the databases and their configuration files onto the new distributed server node.</p>
<blockquote>
<p>Bear in mind, if you run multiple server instances on the same host, such as when testing, you need to change the port entry in the <code>hazelcast.xml</code> configuration file.</p>
</blockquote>
<p>For the other server nodes in the cluster, use the same <code>dserver.sh</code> command as you used in starting the first node.  When the other server nodes come online, they begin to establish network connectivity with each other.  Monitoring the logs, you can see where they establish connections from messages such as this:</p>
<pre>
WARN [node1384014656983] added new node id=Member [192.168.1.179]:2435 name=null
     [OHazelcastPlugin]
INFO [192.168.1.179]:2434 [orientdb] Re-partitioning cluster data... Migration
	 queue size: 135 [PartitionService]
INFO [192.168.1.179]:2434 [orientdb] All migration tasks has been completed,
	 queues are empty. [PartitionService]
INFO [node1384014656983] added node configuration id=Member [192.168.1.179]:2435
     name=node1384015873680, now 2 nodes are configured [OHazelcastPlugin]
INFO [node1384014656983] update configuration db=GratefulDeadConcerts
     from=node1384015873680 [OHazelcastPlugin]
INFO updated distributed configuration for database: GratefulDeadConcerts:
----------
<code class="lang-json">{
   "replication": true,
   "autoDeploy": true,
   "hotAlignment": true,
   "resyncEvery": 15,
   "clusters": {
      "internal": {
         "replication": false
      },
      "index": {
         "replication": false
      },
      "*": {
         "replication": true,
         "readQuorum": 1,
         "writeQuorum": 2,
         "failureAvailableNodesLessQuorum": false,
         "readYourWrites": true,
		 "partitioning":{
            "strategy": "round-robin",
            "default":0,
            "partitions": ["<NEW_NODE>","node1383734730415","node1384015873680"]("<NEW_NODE>","node1383734730415","node1384015873680".md)
         }
      }
   },
   "version": 1
}</code>
---------- [OHazelcastPlugin]
WARN [node1383734730415]->[node1384015873680] deploying database
     GratefulDeadConcerts...[ODeployDatabaseTask]
WARN [node1383734730415]->[node1384015873680] sending the compressed database
     GratefulDeadConcerts over the network, total 339,66Kb [ODeployDatabaseTask]
</pre>
<p>In the example, two server nodes were started on the same machine.  It has an IP address of 10.37.129.2, but is using OrientDB on two different ports: 2434 and 2435, where the current is called <code>this</code>.  The remainder of the log is relative to the distribution of the database to the second server.</p>
<p>On the second server node output, OrientDB dumps messages like this:</p>
<pre><code>WARN [node1384015873680]&lt;-[node1383734730415] installing database
     GratefulDeadConcerts in databases/GratefulDeadConcerts... [OHazelcastPlugin]
WARN [node1384015873680] installed database GratefulDeadConcerts in
     databases/GratefulDeadConcerts, setting it online... [OHazelcastPlugin]
WARN [node1384015873680] database GratefulDeadConcerts is online [OHazelcastPlugin]
WARN [node1384015873680] updated node status to 'ONLINE' [OHazelcastPlugin]
INFO OrientDB Server v1.6.1-SNAPSHOT is active. [OServer]
</code></pre>
<p>What these messages mean is that the database <code>GratefulDeadConcerts</code> was correctly installed from the first node, that is <code>node1383734730415</code> through the network.</p>
<h2 id="migrating-from-standalone-server-to-a-cluster"><a class="header" href="#migrating-from-standalone-server-to-a-cluster">Migrating from standalone server to a cluster</a></h2>
<p>If you have a standalone instance of OrientDB and you want to move to a cluster you should follow these steps:</p>
<ul>
<li>Install OrientDB on all the servers of the cluster and configure it (according to the sections above)</li>
<li>Stop the standalone server</li>
<li>Copy the specific database directories under <code>$ORIENTDB_HOME/database</code> to all the servers of the cluster</li>
<li>Start all the servers in the cluster using the script <code>dserver.sh</code> (or  <code>dserver.bat</code> if on Windows)</li>
</ul>
<p>If the standalone server will be part of the cluster, you can use the existing installation of OrientDB; you don't need to copy the database directories since they're already in place and you just have to start it before all the other servers with <code>dserver.sh</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="working-with-distributed-graphs"><a class="header" href="#working-with-distributed-graphs">Working with Distributed Graphs</a></h1>
<p>When OrientDB joins a distributed cluster, all clients connecting to the server node are constantly notified about this state.  This ensures that, in the event that server node fails, the clients can switch transparently to the next available server.</p>
<p>You can check this through the console.  When OrientDB runs in a distributed configuration, the current cluster shape is visible through the <a href="gettingstarted/tutorials/../../console/Console-Command-Info.html"><code>INFO</code></a> command.</p>
<pre>
$ <code class="lang-sh userinput">$ORIENTDB_HOME/bin/console.sh</code>

OrientDB console v.1.6 www.orientechnologies.com
Type 'help' to display all the commands supported.
Installing extensions for GREMLIN language v.2.5.0-SNAPSHOT


orientdb> <code class="lang-sql userinput">CONNECT remote:localhost/GratefulDeadConcerts admin admin</code>

Connecting to database [remote:localhost/GratefulDeadConcerts] with user 'admin'...OK


orientdb> <code class="lang-sql userinput">INFO</code>

Current database: GratefulDeadConcerts (url=remote:localhost/GratefulDeadConcerts)
</pre>
<p>For reference purposes, the server nodes in the example have the following configurations.  As you can see, it is a two node cluster running a single server host.  The first node listens on port <code>2481</code> while the second on port <code>2480</code>.</p>
<pre><code class="language-csv">+---------+------+-----------------------------------------+-----+---------+--------------+--------------+-----------------------+
|Name     |Status|Databases                                |Conns|StartedOn|Binary        |HTTP          |UsedMemory             |
+---------+------+-----------------------------------------+-----+---------+--------------+--------------+-----------------------+
|europe-0 |ONLINE|distributed-node-deadlock=ONLINE (MASTER)|5    |16:53:59 |127.0.0.1:2424|127.0.0.1:2480|269.32MB/3.56GB (7.40%)|
|europe-1 |ONLINE|distributed-node-deadlock=ONLINE (MASTER)|4    |16:54:03 |127.0.0.1:2425|127.0.0.1:2481|268.89MB/3.56GB (7.38%)|
+---------+------+-----------------------------------------+-----+---------+--------------+--------------+-----------------------+
</code></pre>
<h2 id="testing-distributed-architecture"><a class="header" href="#testing-distributed-architecture">Testing Distributed Architecture</a></h2>
<p>Once you have a distributed database up and running, you can begin to test its operations on a running environment.  For example, begin by creating a vertex, setting the <code>node</code> property to <code>1</code>.</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE VERTEX V SET node = 1</code>

Created vertex 'V#9:815{node:1} v1' in 0,013000 sec(s).
</pre>
<p>From another console, connect to the second node and execute the following command:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM V WHERE node = 1</code>

----+--------+-------+
 #  | @RID   | node  |
----+--------+-------+
 0  | #9:815 | 1     |
----+--------+-------+
1 item(s) found. Query executed in 0.19 sec(s).
</pre>
<p>This shows that the vertex created on the first node has successfully replicated to the second node.</p>
<h2 id="logs-in-distributed-architecture"><a class="header" href="#logs-in-distributed-architecture">Logs in Distributed Architecture</a></h2>
<p>From time to time server nodes go down.  This does not necessarily relate to problems in OrientDB, (for instance, it could originate from limitations in system resources).</p>
<p>To test this out, kill the first node.  For example, assuming the first node has a process identifier, (that is, a PID), of <code>1254</code> on your system, run the following command:</p>
<pre>
$ <code class="lang-sh userinput">kill -9 1254</code>
</pre>
<p>This command kills the process on PID <code>1254</code>.  Now, check the log messages for the second node:</p>
<pre>
$ <code class="lang-sh userinput">less orientdb.log</code>

INFO [127.0.0.1]:2435 [orientdb] Removing Member [127.0.0.1]:2434
     [ClusterService]
INFO [127.0.0.1]:2435 [orientdb]
<code class="lang-json">Members [1] {
	Member [127.0.0.1]:2435 this
}</code>
 [ClusterService]
WARN [europe-0] node removed id=Member [127.0.0.1]:2434
     name=europe-1 [OHazelcastPlugin]
INFO [127.0.0.1]:2435 [orientdb] Partition balance is ok, no need to
     re-partition cluster data...  [PartitionService]
</pre>
<p>What the logs show you is that the second node is now aware that it cannot reach the first node.  You can further test this by running the console connected to the first node..</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM V LIMIT 2</code>

WARN Caught I/O errors from /127.0.0.1:2425 (local
     socket=0.0.0.0/0.0.0.0:51512), trying to reconnect (error:
	 java.io.IOException: Stream closed) [OStorageRemote]
WARN Connection re-acquired transparently after 30ms and 1 retries: no errors
     will be thrown at application level [OStorageRemote]
---+------+----------------+--------+--------------+------+-----------------+-----
 # | @RID | name        | song_type | performances | type | out_followed_by | ...
---+------+----------------+--------+--------------+------+-----------------+-----
 1 | #9:1 | HEY BO DIDDLEY | cover  | 5            | song | [5]             | ...
 2 | #9:2 | IM A MAN       | cover  | 1            | song | [2]             | ...
---+------+----------------+--------+--------------+------+-----------------+-----
</pre>
<p>This shows that the console auto-switched to the next available node.  That is, it switched to the second node upon noticing that the first was no longer functional.  The warnings reports show what happened in a transparent way, so that the application doesn't need to manage the issue.</p>
<p>From the console connected to the second node, create a new vertex.</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE VERTEX V SET node=2</code>

Created vertex 'V#9:816{node:2} v1' in 0,014000 sec(s).
</pre>
<p>Given that the first node remains nonfunctional, OrientDB journals the operation.  Once the first node comes back online, the second node synchronizes the changes into it.</p>
<p>Restart the first node and check that it successfully auto-realigns.  Reconnect the console to the first node and run the following command:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM V WHERE node=2</code>

---+--------+-------+
 # | @RID   | node  |
---+--------+-------+
 0 | #9:816 | 2     |
---+--------+-------+
1 item(s) found. Query executed in 0.209 sec(s).
</pre>
<p>This shows that the first node has realigned itself with the second node.</p>
<p>This process is repeatable with N server nodes, where every server is a master.  There is no limit to the number of running servers.  With many servers spread across a slow network, you can tune the network timeouts to be more permissive and let a large, distributed cluster of servers work properly.</p>
<p>For more information, <a href="gettingstarted/tutorials/../../distributed/Distributed-Architecture.html">Distributed Architecture</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-11-26 SAM -->
<h1 id="time-series-use-case"><a class="header" href="#time-series-use-case">Time Series Use Case</a></h1>
<p>Managing records related to historical information is pretty common. When you have millions of records, indexes start show their limitations, because the cost to find the records is O(logN). This is also the main reason why Relational DBMS are so slow with huge databases.</p>
<p>So when you have millions of record the best way to scale up linearly is avoid using indexes at all or as much as you can. But how can you retrieve records in a short time without indexes? Should OrientDB scan the entire database at every query? No. You should use the Graph properties of OrientDB. Let's look at a simple example, where the domain are logs.</p>
<p>A typical log record has some information about the event and a date. Below is the Log record to use in our example. We're going to use the JSON format to simplify reading:</p>
<pre><code class="language-json">{
  "date" : 12293289328932,
  "priority" : "critical",
  "note" : "System reboot"
}
</code></pre>
<p>Now let's create a tree (that is a directed, non cyclic graph) to group the Log records based on the granularity we need. Example:</p>
<pre><code>Year -&gt; month (map) -&gt; Month -&gt; day (map) -&gt; Day -&gt; hour  (map) -&gt; Hour
</code></pre>
<p>Where Year, Month, Day and Hour are vertex classes. Each Vertex links the other Vertices of smaller type. The links should be handled using a Map to make easier the writing of queries.</p>
<p>Create the classes:</p>
<pre><code class="language-sql">CREATE CLASS Year
CREATE CLASS Month
CREATE CLASS Day
CREATE CLASS Hour

CREATE PROPERTY Year.month LINKMAP Month
CREATE PROPERTY Month.day LINKMAP Day
CREATE PROPERTY Day.hour LINKMAP Hour
</code></pre>
<p>Example to retrieve the vertex relative to the date March 2012, 20th at 10am (2012/03/20 10:00:00):</p>
<pre><code class="language-sql">SELECT month[3].day[20].hour[10].logs FROM Year WHERE year = "2012"
</code></pre>
<p>If you need more granularity than the Hour you can go ahead until the Time unit you need:</p>
<pre><code>Hour -&gt; minute (map) -&gt; Minute -&gt; second (map) -&gt; Second
</code></pre>
<p>Now connect the record to the right Calendar vertex. If the usual way to retrieve Log records is by hour you could link the Log records in the Hour. Example:</p>
<pre><code>Year -&gt; month (map) -&gt; Month -&gt; day (map) -&gt; Day -&gt; hour  (map) -&gt; Hour -&gt; log (set) -&gt; Log
</code></pre>
<p>The "log" property connects the Time Unit to the Log records. So to retrieve all the log of March 2012, 20th at 10am:</p>
<pre><code class="language-sql">SELECT expand( month[3].day[20].hour[10].logs ) FROM Year WHERE year = "2012"
</code></pre>
<p>That could be used as starting point to retrieve only a sub-set of logs that satisfy certain rules. Example:</p>
<pre><code class="language-sql">SELECT FROM (
  SELECT expand( month[3].day[20].hour[10].logs ) FROM Year WHERE year = "2012"
) WHERE priority = 'critical'
</code></pre>
<p>That retrieves all the CRITICAL logs of March 2012, 20th at 10am.</p>
<h1 id="join-multiple-hours"><a class="header" href="#join-multiple-hours">Join multiple hours</a></h1>
<p>If you need multiple hours/days/months as result set you can use the UNION function to create a unique result set:</p>
<pre><code class="language-sql">SELECT expand( records ) from (
  SELECT union( month[3].day[20].hour[10].logs, month[3].day[20].hour[11].logs ) AS records
  FROM Year WHERE year = "2012"
)
</code></pre>
<p>In this example we create a union between the 10th and 11th hours. But what about extracting all the hours of a day without writing a huge query? The shortest way is using the Traverse. Below the Traverse to get all the hours of one day:</p>
<pre><code class="language-sql">TRAVERSE hour FROM (
  SELECT expand( month[3].day[20] ) FROM Year WHERE year = "2012"
)
</code></pre>
<p>So putting all together this query will extract all the logs of all the hours in a day:</p>
<pre><code class="language-sql">SELECT expand( logs ) FROM (
  SELECT union( logs ) AS logs FROM (
    TRAVERSE hour FROM (
     SELECT expand( month[3].day[20] ) FROM Year WHERE year = "2012"
    )
  )
)
</code></pre>
<h1 id="aggregate"><a class="header" href="#aggregate">Aggregate</a></h1>
<p>Once you built up a Calendar in form of a Graph you can use it to store aggregated values and link them to the right Time Unit. Example: store all the winning ticket of Online Games. The record structure in our example is:</p>
<pre><code class="language-json">{
  "date" : 12293289328932,
  "win" : 10.34,
  "machine" : "AKDJKD7673JJSH",
}
</code></pre>
<p>You can link this record to the closest Time Unit like in the example above, but you could sum all the records in the same Day and link it to the Day vertex. Example:</p>
<p>Create a new class to store the aggregated daily records:</p>
<pre><code class="language-sql">CREATE CLASS DailyLog
</code></pre>
<p>Create the new record from an aggregation of the hour:</p>
<pre><code class="language-sql">INSERT INTO DailyLog
SET win = (
  SELECT SUM(win) AS win FROM Hour WHERE date BETWEEN '2012-03-20 10:00:00' AND '2012-03-20 11:00:00'
)
</code></pre>
<p>Link it in the Calendar graph assuming the previous command returned #23:45 as the RecordId of the brand new DailyLog record:</p>
<pre><code class="language-sql">UPDATE (
  SELECT expand( month[3].day[20] ) FROM Year WHERE year = "2012"
) ADD logs = #23:45
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-11-26 SAM -->
<h1 id="chat-use-case"><a class="header" href="#chat-use-case">Chat Use Case</a></h1>
<p>OrientDB allows modeling of rich and complex domains. If you want to develop a chat based application, you can use whatever you want to create the relationships between User and Room.</p>
<p>We suggest avoiding using Edges or Vertices connected with edges for messages. The best way is using the document API by creating one class per chat room, with no index, to have super fast access to last X messages. In facts, OrientDB stores new records in append only, and the @rid is auto generated as incrementing.</p>
<p>The 2 most common use cases in a chat are:</p>
<ul>
<li>writing a message in a chat room</li>
<li>load last page of messages in a chat room</li>
</ul>
<h2 id="create-the-initial-schema"><a class="header" href="#create-the-initial-schema">Create the initial schema</a></h2>
<p>In order to work with the chat rooms, the rule of the thumb is creating a base abstract class ("ChatRoom") and then let to the concrete classes to represent individual ChatRooms.</p>
<h3 id="create-the-base-chatroom-class"><a class="header" href="#create-the-base-chatroom-class">Create the base ChatRoom class</a></h3>
<pre><code class="language-sql">create class ChatRoom
alter class ChatRoom abstract true
create property ChatRoom.date datetime
create property ChatRoom.text string
create property ChatRoom.user LINK OUser
</code></pre>
<h3 id="create-a-new-chatroom"><a class="header" href="#create-a-new-chatroom">Create a new ChatRoom</a></h3>
<pre><code class="language-sql">create class ItalianRestaurant extends ChatRoom
</code></pre>
<p>Class "ItalianRestaurant" will extend all the properties from ChatRoom.</p>
<p>Why creating a base class? Because you could always execute polymorphic queries that are cross-chatrooms, like get all the message from user "Luca":</p>
<pre><code class="language-sql">select from ChatRoom where user.name = 'Luca'
</code></pre>
<h2 id="create-a-new-message-in-the-chat-room"><a class="header" href="#create-a-new-message-in-the-chat-room">Create a new message in the Chat Room</a></h2>
<p>To create a new message in the chat room you can use this code:</p>
<pre><code class="language-java">public ODocument addMessage(String chatRoom, String message, OUser user) {
  ODocument msg = new ODocument(chatRoom);
  msg.field( "date", new Date() );
  msg.field( "text", message );
  msg.field( "user", user );
  msg.save();
  return msg;
}
</code></pre>
<p>Example:</p>
<pre><code class="language-java">addMessage("ItalianRestaurant", "Have you ever been at Ponza island?", database.getUser());
</code></pre>
<h2 id="retrieve-last-messages"><a class="header" href="#retrieve-last-messages">Retrieve last messages</a></h2>
<p>You can easily fetch pages of messages ordered by date in descending order, by using the OrientDB's <code>@rid</code>. Example:</p>
<pre><code class="language-sql">select from ItalianRestaurant order by @rid desc skip 0 limit 50
</code></pre>
<p>You could write a generic method to access to a page of messages, like this:</p>
<pre><code class="language-java">public Iterable&lt;ODocument&gt; loadMessages(String chatRoom, fromLast, pageSize) {
  return graph.getRawGraph().command("select from " + chatRoom + " order by @rid desc skip " + fromLast + " limit " + pageSize).execute();
}
</code></pre>
<p>Loading the 2nd (last) page from chat "ItalianRestaurant", would become this query (with pageSize = 50):</p>
<pre><code class="language-sql">select from ItalianRestaurant order by @rid desc skip 50 limit 50
</code></pre>
<p>This is super fast and O(1) even with million of messages.</p>
<h2 id="limitations"><a class="header" href="#limitations">Limitations</a></h2>
<p>Since OrientDB can handle only 32k clusters, you could have maximum 32k chat rooms. Unless you want to rewrite the entire <a href="https://freenode.net/index.shtml">FreeNode</a>, 32k chat rooms will be more than enough for most of the cases.</p>
<p>However, if you need more than 32k chat rooms, the suggested solution is still using this approach, but with multiple databases (even on the same server, because one OrientDB Server instance can handle thousands of databases concurrently).</p>
<p>In this case you could use one database to handle all the metadata, like the following classes:</p>
<ul>
<li><strong>ChatRoom</strong>, containing all the chatrooms, and the database where are stored. Example: <code>{ "@class": "ChatRoom", "description": "OrientDB public channel", "databaseName", "db1", "clusterName": "orientdb" }</code></li>
<li><strong>User</strong>, containing all the information about accounts with the edges to the ChatRoom vertices where they are subscribed</li>
</ul>
<p>OrientDB cannot handle cross-database links, so when you want to know the message's author, you have to look up into the "Metadata" database by @RID (that is O(1)).</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="key-value-use-case"><a class="header" href="#key-value-use-case">Key Value Use Case</a></h1>
<p>OrientDB can also be used as a Key Value DBMS by using the super fast <a href="gettingstarted/../indexing/Indexes.html">Indexes</a>. You can have as many <a href="gettingstarted/../indexing/Indexes.html">Indexes</a> as you need.</p>
<h1 id="http"><a class="header" href="#http">HTTP</a></h1>
<p>OrientDB RESTful HTTP protocol allows to talk with a OrientDB Server instance using the <a href="gettingstarted/../misc/OrientDB-REST.html">HTTP protocol</a> and JSON. OrientDB supports also a highly optimized Binary protocol for superior performances.</p>
<h2 id="operations-1"><a class="header" href="#operations-1">Operations</a></h2>
<p>To interact against OrientDB indexes use the four methods of the HTTP protocol in REST fashion:</p>
<ul>
<li><strong>PUT</strong>, to create or modify an entry in the database</li>
<li><strong>GET</strong>, to retrieve an entry from the database. It's idempotent that means no changes to the database happen. Remember that in IE6 the URL can be maximum of 2,083 characters. Other browsers supports longer URLs, but if you want to stay compatible with all limit to 2,083 characters</li>
<li><strong>DELETE</strong>, to delete an entry from the database</li>
</ul>
<h2 id="create-an-entry"><a class="header" href="#create-an-entry">Create an entry</a></h2>
<p>To create a new entry in the database use the <a href="gettingstarted/../misc/OrientDB-REST.html#put---index">Index-PUT API</a>.</p>
<p>Syntax: <code>http://&lt;server&gt;:[&lt;port&gt;]/index/&lt;index-name&gt;/&lt;key&gt;</code></p>
<p>Example:</p>
<p>HTTP PUT: <code>http://localhost:2480/index/customers/jay</code></p>
<pre><code class="language-json">{
  "name" : "Jay",
  "surname" : "Miner"
}
</code></pre>
<p>HTTP Response 204 is returned.</p>
<h2 id="retrieve-an-entry"><a class="header" href="#retrieve-an-entry">Retrieve an entry</a></h2>
<p>To retrieve an entry from the database use the <a href="gettingstarted/../misc/OrientDB-REST.html#put---index">Index-GET API</a>.</p>
<p>Syntax: <code>http://&lt;server&gt;:[&lt;port&gt;]/index/&lt;index-name&gt;/&lt;key&gt;</code></p>
<p>Example:</p>
<p>HTTP GET: <code>http://localhost:2480/index/customers/jay</code></p>
<p>HTTP Response 200 is returned with this JSON as payload:</p>
<pre><code class="language-json">{
  "name" : "Jay",
  "surname" : "Miner"
}
</code></pre>
<h2 id="remove-an-entry"><a class="header" href="#remove-an-entry">Remove an entry</a></h2>
<p>To remove an entry from the database use the <a href="gettingstarted/../misc/OrientDB-REST.html#put---index">Index-DELETE API</a>.</p>
<p>Syntax: <code>http://&lt;server&gt;:[&lt;port&gt;]/index/&lt;index-name&gt;/&lt;key&gt;</code></p>
<p>Example:</p>
<p>HTTP DELETE: <code>http://localhost:2480/index/customers/jay</code></p>
<p>HTTP Response 200 is returned</p>
<h1 id="step-by-step-tutorial"><a class="header" href="#step-by-step-tutorial">Step-by-Step tutorial</a></h1>
<p>Before to start assure you've a OrientDB server up and running. In this example we'll use curl considering the connection to localhost to the default HTTP post 2480. The default "admin" user is used.</p>
<h2 id="create-a-new-index"><a class="header" href="#create-a-new-index">Create a new index</a></h2>
<p>To use OrientDB as a Key/Value store we need a brand new manual index, let's call it "mainbucket". We're going to create it as UNIQUE because keys cannot be duplicated. If you can have multiple keys consider:</p>
<ul>
<li>creating the index as NOTUNIQUE</li>
<li>leave it as UNIQUE but as value handle array of documents</li>
</ul>
<p>Create the new manual unique index "mainbucket":</p>
<pre><code class="language-sh">&gt; curl --basic -u admin:admin localhost:2480/command/demo/sql -d "create index mainbucket UNIQUE STRING"
</code></pre>
<p>Response:</p>
<pre><code class="language-json">{ "result" : [ 
    { "@type" : "d" , "@version" : 0, "value" : 0, "@fieldTypes" : "value=l" }
  ]
}
</code></pre>
<h2 id="store-the-first-entry"><a class="header" href="#store-the-first-entry">Store the first entry</a></h2>
<p>Below we're going to insert the first entry by using the HTTP PUT method passing "jay" as key in the URL and as value the entire document in form of JSON:</p>
<pre><code class="language-sh">&gt; curl --basic -u admin:admin -X PUT localhost:2480/index/demo/mainbucket/jay -d "{'@class': 'V', 'name':'Jay','surname':'Miner'}"
</code></pre>
<p>Response:</p>
<pre><code>Key 'jay' correctly inserted into the index mainbucket.
</code></pre>
<h2 id="retrieve-the-entry-just-inserted"><a class="header" href="#retrieve-the-entry-just-inserted">Retrieve the entry just inserted</a></h2>
<p>Below we're going to retrieve the entry we just entered by using the HTTP GET method passing "jay" as key in the URL:</p>
<pre><code>&gt; curl --basic -u admin:admin localhost:2480/index/demo/mainbucket/jay
</code></pre>
<p>Response:</p>
<pre><code class="language-json">[{
  "@type" : "d" , "@rid" : "#3:477" , "@version" : 0,
  "name" : "Jay",
  "surname" : "Miner"
}]
</code></pre>
<p>Note that an array is always returned in case multiple records are associated to the same key (if NOTUNIQUE index is used). Look also at the document has been created with <a href="gettingstarted/../datamodeling/Concepts.html#record-id">RID</a> #3:477. You can load it directly if you know the <a href="gettingstarted/../datamodeling/Concepts.html#record-id">RID</a>. Remember to remove the # character. Example:</p>
<pre><code class="language-sh">&gt; curl --basic -u admin:admin localhost:2480/document/demo/3:477
</code></pre>
<p>Response:</p>
<pre><code class="language-json">{
  "@type" : "d" , "@rid" : "#3:477" , "@version" : 0,
  "name" : "Jay",
  "surname" : "Miner"
}
</code></pre>
<h2 id="drop-an-index"><a class="header" href="#drop-an-index">Drop an index</a></h2>
<p>Once finished drop the index "mainbucket" created for the example:</p>
<pre><code class="language-sh">&gt; curl --basic -u admin:admin localhost:2480/command/demo/sql -d "drop index mainbucket"
```json
Response:
```json   
{ "result" : [ 
    { "@type" : "d" , "@version" : 0, "value" : 0, "@fieldTypes" : "value=l" }
  ]
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-11-26 SAM -->
<h1 id="distributed-queues-use-case"><a class="header" href="#distributed-queues-use-case">Distributed queues use case</a></h1>
<p>Implementing a persistent, distributed and transactional queue system using OrientDB is possible and easy. Besides the fact you don't need a specific API accomplish a queue, there are multiple approaches you can follow depending by your needs. The easiest way is using OrientDB SQL, so this works with any driver.</p>
<p>Create the queue class first:</p>
<pre><code class="language-sql">create class queue
</code></pre>
<p>You could have one class per queue. Example of push operation:</p>
<pre><code class="language-sql">insert into queue set text = "this is the first message", date = date()
</code></pre>
<p>Since OrientDB by default keeps the order of creation of records, a simple delete from the queue class with limit = 1 gives to you the perfect pop:</p>
<pre><code class="language-sql">delete from queue return before limit 1
</code></pre>
<p>The "return before" allows you to have the deleted record content. If you need to peek the queue, you can just use the select:</p>
<pre><code class="language-sql">select from queue limit 1
</code></pre>
<p>That's it. Your queue will be persistent, if you want transactional and running in cluster distributed.</p>
<div style="break-before: page; page-break-before: always;"></div><p>#Import Tutorials</p>
<p>This section includes some import-to-OrientDB tutorials.</p>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-12-11 SAM -->
<h1 id="tutorial-importing-the-open-beer-database-into-orientdb"><a class="header" href="#tutorial-importing-the-open-beer-database-into-orientdb">Tutorial: Importing the Open Beer Database into OrientDB</a></h1>
<p><img src="gettingstarted/tutorials/../../images/beers.jpg" alt="" /></p>
<p>In this tutorial we will use the OrientDB's <a href="gettingstarted/tutorials/../../etl/ETL-Introduction.html">ETL</a> module to import, as a graph, the <a href="https://openbeerdb.com/">Open Beer Database</a>.</p>
<p><em>Note</em>: You can access directly the converted database, result of this ETL tutorial, in the following ways:</p>
<ul>
<li>
<p><strong>Studio</strong>: in the login page press the "Cloud" button, put server's credential and press the download button from the "OpenBeer" row;</p>
</li>
<li>
<p><strong>Direct Download</strong>: download the database from http://orientdb.com/public-databases/OpenBeer.zip and unzip it in a OpenBeer folder inside OrientDB's server "databases" directory.</p>
</li>
</ul>
<h2 id="the-open-beer-database"><a class="header" href="#the-open-beer-database">The Open Beer Database</a></h2>
<p>The Open Beer Database can be downloaded in CSV format from <a href="https://openbeerdb.com/">https://openbeerdb.com/</a>. The following image shows its <em>relational</em> model:</p>
<p><img src="gettingstarted/tutorials/../../images/etl/openbeerdb/Beer_Data_Model-Relational.png" alt="" /></p>
<h2 id="preliminary-steps"><a class="header" href="#preliminary-steps">Preliminary Steps</a></h2>
<p>First, please create a new folder somewhere in your hard drive, and move into it. For this test we will assume <code>/temp/openbeer</code>:</p>
<pre><code class="language-sh">$ mkdir /temp/openbeer
$ cd /temp/openbeer
</code></pre>
<h3 id="download-the-open-beer-database-in-csv-format"><a class="header" href="#download-the-open-beer-database-in-csv-format">Download the Open Beer Database in CSV format</a></h3>
<p>Download the Open Beer Database in CSV format and extract the archive:</p>
<pre><code class="language-sh">$ curl http://openbeerdb.com/files/openbeerdb_csv.zip &gt; openbeerdb_csv.zip
$ unzip openbeerdb_csv.zip
</code></pre>
<p>The archive consists of the following files:</p>
<ul>
<li><code>beers.csv:</code> contains the beer records</li>
<li><code>breweries.csv:</code> contains the breweries records</li>
<li><code>breweries_geocode.csv</code>: contains the geocodes of the breweries. This file is not used in this Tutorial</li>
<li><code>categories.csv</code>: contains the beer categories</li>
<li><code>styles.csv</code>: contains the beer styles</li>
</ul>
<h3 id="install-orientdb"><a class="header" href="#install-orientdb">Install OrientDB</a></h3>
<p>Download and install OrientDB:</p>
<pre><code class="lang-sh">$ wget https://repo1.maven.org/maven2/com/orientechnologies/orientdb-community/3.2.44/orientdb-community-3.2.43.tar.gz -O orientdb-community-3.2.44.tar.gz
$ tar xvf orientdb-community-3.2.44.tar.gz</code></pre>
<p>For more information on how to install OrientDB, please refer to the <a href="gettingstarted/tutorials/../Tutorial-Installation.html">Installation</a> section.</p>
<h3 id="graph-data-model"><a class="header" href="#graph-data-model">Graph Data Model</a></h3>
<p>Before starting the ETL process it's important to understand how the Open Beer Database can be modeled as a graph.</p>
<p>The relational model of the Open Beer Database can be easily converted to a <em>graph</em> model, as shown below:</p>
<p><img src="gettingstarted/tutorials//images/etl/openbeerdb/Beer_Data_Model-Graph.png" alt="" /></p>
<p>The model above consists of the following nodes (or vertices) and relationships (or edges):</p>
<ul>
<li><strong>Nodes</strong>: Beer, Category, Style, Brewery;</li>
<li><strong>Relationships</strong>: HasCategory, HasStyle, HasBrewery.</li>
</ul>
<p>For more informations on the Graph Model in OrientDB, please refer to the <a href="gettingstarted/tutorials/../../datamodeling/Tutorial-Document-and-graph-model.html#the-graph-model">Graph Model</a> section.</p>
<h2 id="etl-process"><a class="header" href="#etl-process">ETL Process</a></h2>
<p>The ETL module for OrientDB provides support for moving data to and from OrientDB databases using Extract, Transform and Load processes.</p>
<p>The ETL module consists of a script, <code>oetl.sh</code>, that takes in input a single JSON configuration file.</p>
<p>For more information on the ETL module, please refer to the <a href="gettingstarted/tutorials/../../etl/ETL-Introduction.html">ETL</a> section.</p>
<blockquote>
<p><em>IMPORTANT</em>: If you use ETL in PLOCAL, make sure you do not have a running server on the same folder, you will an error otherwise: <code>Database is locked by another process, please shutdown process and try again</code></p>
</blockquote>
<h3 id="import-beer-categories"><a class="header" href="#import-beer-categories">Import Beer Categories</a></h3>
<p>The following are the first two lines of the <code>categories.csv</code> file:</p>
<pre><code class="language-csv">"id","cat_name","last_mod"
"1","British Ale","2010-10-24 13:50:10"
</code></pre>
<p>In order to import this file in OrientDB, we have to create the following file as <code>categories.json</code>:</p>
<pre><code class="language-json">{
  "source": { "file": { "path": "/temp/openbeer/openbeerdb_csv/categories.csv" } },
  "extractor": { "csv": {} },
  "transformers": [
    { "vertex": { "class": "Category" } }
  ],
  "loader": {
    "orientdb": {
       "dbURL": "plocal:../databases/openbeerdb",
       "dbType": "graph",
       "classes": [
         {"name": "Category", "extends": "V"}
       ], "indexes": [
         {"class":"Category", "fields":["id:integer"], "type":"UNIQUE" }
       ]
    }
  }
}
</code></pre>
<p>To import it into OrientDB, please move into the "bin" directory of the OrientDB distribution:</p>
<pre><code>$ cd orientdb-community-2.2.8/bin
</code></pre>
<p>and run OrientDB ETL:</p>
<pre><code>$ ./oetl.sh /temp/openbeer/categories.json

OrientDB etl v.2.0.9 (build @BUILD@) www.orientechnologies.com
BEGIN ETL PROCESSOR
END ETL PROCESSOR
+ extracted 12 rows (0 rows/sec) - 12 rows -&gt; loaded 11 vertices (0 vertices/sec) Total time: 77ms [0 warnings, 0 errors]
</code></pre>
<h3 id="import-beer-styles"><a class="header" href="#import-beer-styles">Import Beer Styles</a></h3>
<p>Now let's import the Beer Styles. These are the first two lines of the <code>styles.csv</code> file:</p>
<pre><code class="language-csv">"id","cat_id","style_name","last_mod"
"1","1","Classic English-Style Pale Ale","2010-10-24 13:53:31"
</code></pre>
<p>In this case we will correlate the Style with the Category created earlier.</p>
<p>This is the <code>styles.json</code> to use with OrientDB ETL for the next step:</p>
<pre><code class="language-json">{
  "source": { "file": { "path": "/temp/openbeer/openbeerdb_csv/styles.csv" } },
  "extractor": { "csv": {} },
  "transformers": [
    { "vertex": { "class": "Style" } },
    { "edge": { "class": "HasCategory",  "joinFieldName": "cat_id", "lookup": "Category.id" } }
  ],
  "loader": {
    "orientdb": {
       "dbURL": "plocal:../databases/openbeerdb",
       "dbType": "graph",
       "classes": [
         {"name": "Style", "extends": "V"},
         {"name": "HasCategory", "extends": "E"}
       ], "indexes": [
         {"class":"Style", "fields":["id:integer"], "type":"UNIQUE" }
       ]
    }
  }
}
</code></pre>
<p>Now, to import the styles, please execute the following command:</p>
<pre><code>$ ./oetl.sh /temp/openbeer/styles.json

OrientDB etl v.2.0.9 (build @BUILD@) www.orientechnologies.com
BEGIN ETL PROCESSOR
END ETL PROCESSOR
+ extracted 142 rows (0 rows/sec) - 142 rows -&gt; loaded 141 vertices (0 vertices/sec) Total time: 498ms [0 warnings, 0 errors]
</code></pre>
<h3 id="import-breweries"><a class="header" href="#import-breweries">Import Breweries</a></h3>
<p>Now it's time for the Breweries. These are the first two lines of the <code>breweries.csv</code> file:</p>
<pre><code class="language-csv">"id","name","address1","address2","city","state","code","country","phone","website","filepath","descript","last_mod"
"1","(512) Brewing Company","407 Radam, F200",,"Austin","Texas","78745","United States","512.707.2337","http://512brewing.com/",,"(512) Brewing Company is a microbrewery located in the heart of Austin that brews for the community using as many local, domestic and organic ingredients as possible.","2010-07-22 20:00:20"
</code></pre>
<p>Breweries have no outgoing relations with other entities, so this is a plain import similar to the one we did for the categories.</p>
<p>This is the <code>breweries.json</code> to use with OrientDB ETL for the next step:</p>
<pre><code class="language-json">{
  "source": { "file": { "path": "/temp/openbeer/openbeerdb_csv/breweries.csv" } },
  "extractor": { "csv": {} },
  "transformers": [
    { "vertex": { "class": "Brewery" } }
  ],
  "loader": {
    "orientdb": {
       "dbURL": "plocal:../databases/openbeerdb",
       "dbType": "graph",
       "classes": [
         {"name": "Brewery", "extends": "V"}
       ], "indexes": [
         {"class":"Brewery", "fields":["id:integer"], "type":"UNIQUE" }
       ]
    }
  }
}
</code></pre>
<p>Run the import for breweries:</p>
<pre><code>$ ./oetl.sh /temp/openbeer/breweries.json

OrientDB etl v.2.0.9 (build @BUILD@) www.orientechnologies.com
BEGIN ETL PROCESSOR
END ETL PROCESSOR
+ extracted 1.395 rows (0 rows/sec) - 1.395 rows -&gt; loaded 1.394 vertices (0 vertices/sec) Total time: 830ms [0 warnings, 0 errors]
</code></pre>
<h3 id="import-beers"><a class="header" href="#import-beers">Import Beers</a></h3>
<p>Now it's time for the last and most important file: the Beers! These are the first two lines of the <code>beers.csv</code> file:</p>
<pre><code class="language-csv">"id","brewery_id","name","cat_id","style_id","abv","ibu","srm","upc","filepath","descript","last_mod",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
"1","812","Hocus Pocus","11","116","4.5","0","0","0",,"Our take on a classic summer ale.  A toast to weeds, rays, and summer haze.  A light, crisp ale for mowing lawns, hitting lazy fly balls, and communing with nature, Hocus Pocus is offered up as a summer sacrifice to clodless days.
</code></pre>
<p>As you can see each beer is connected to other entities through the following fields:</p>
<ul>
<li><code>brewery_id</code> -&gt; <strong>Brewery</strong></li>
<li><code>cat_id</code> -&gt; <strong>Category</strong></li>
<li><code>style_id</code> -&gt; <strong>Style</strong></li>
</ul>
<p>This is the <code>beers.json</code> to use with OrientDB ETL for the next step:</p>
<pre><code class="language-json">{
  "config" : { "haltOnError": false },
  "source": { "file": { "path": "/temp/openbeer/openbeerdb_csv/beers.csv" } },
  "extractor": { "csv": { "columns": ["id","brewery_id","name","cat_id","style_id","abv","ibu","srm","upc","filepath","descript","last_mod"],
                                "columnsOnFirstLine": true } },
  "transformers": [
    { "vertex": { "class": "Beer" } },
    { "edge": { "class": "HasCategory",  "joinFieldName": "cat_id", "lookup": "Category.id" } },
    { "edge": { "class": "HasBrewery",  "joinFieldName": "brewery_id", "lookup": "Brewery.id" } },
    { "edge": { "class": "HasStyle",  "joinFieldName": "style_id", "lookup": "Style.id" } }
  ],
  "loader": {
    "orientdb": {
       "dbURL": "plocal:../databases/openbeerdb",
       "dbType": "graph",
       "classes": [
         {"name": "Beer", "extends": "V"},
         {"name": "HasCategory", "extends": "E"},
         {"name": "HasStyle", "extends": "E"},
         {"name": "HasBrewery", "extends": "E"}
       ], "indexes": [
         {"class":"Beer", "fields":["id:integer"], "type":"UNIQUE" }
       ]
    }
  }
}
</code></pre>
<p>Run the final import for beers:</p>
<pre><code>$ ./oetl.sh /temp/openbeer/beers.json

OrientDB etl v.2.0.9 (build @BUILD@) www.orientechnologies.com
BEGIN ETL PROCESSOR
...
+ extracted 5.862 rows (1.041 rows/sec) - 5.862 rows -&gt; loaded 4.332 vertices (929 vertices/sec) Total time: 10801ms [0 warnings, 27 errors]
END ETL PROCESSOR
</code></pre>
<p><em>Note</em>: the 27 errors are due to the 27 wrong content lines that have no id.</p>
<h2 id="some-queries-and-visualizations"><a class="header" href="#some-queries-and-visualizations">Some Queries and Visualizations</a></h2>
<p>Now that the database has been imported we can execute some queries and create some visualizations.</p>
<p>The following are some ways we can use to access the newly imported <code>OpenBeer</code> database:</p>
<ul>
<li><a href="gettingstarted/tutorials/../../console/README.html">Console</a></li>
<li><a href="gettingstarted/tutorials/../../gremlin/Gremlin.html">Gremlin Console</a></li>
<li><a href="gettingstarted/tutorials/../../studio/README.html">Studio</a></li>
<li><a href="gettingstarted/tutorials/../../apis-and-drivers/README.html">APIs &amp; Drivers</a></li>
<li>some external tools, like <a href="gettingstarted/tutorials/../../plugins/Gephi.html">Gephi</a></li>
<li>some external visualization libraries for graph rendering</li>
</ul>
<p>If we want to query all <em>Category</em> vertices we can execute the following query:</p>
<pre><code>SELECT * FROM Category
</code></pre>
<p>The following is the visualization we can create using the Studio's <a href="gettingstarted/tutorials/../../studio/working-with-data/graph-editor/README.html">Graph Editor</a>:</p>
<p><img src="gettingstarted/tutorials/../../images/etl/openbeerdb/studio_graph_beer_class_category.png" alt="" /></p>
<p>If we want to find all nodes directly connected to a specific beer (e.g. the beer <em>Petrus Dubbel Bruin Ale</em>) with either an incoming or outgoing relationship, we can use a query like the following:</p>
<pre><code>SELECT EXPAND( BOTH() ) FROM Beer WHERE name = 'Petrus Dubbel Bruin Ale'
</code></pre>
<p>Alternatively, we can use the <a href="gettingstarted/tutorials/../../sql/SQL-Match.html">MATCH</a> syntax:</p>
<pre><code>MATCH {class: Beer, where: (name = 'Petrus Dubbel Bruin Ale')}--{as: n} RETURN $pathelements
</code></pre>
<p>If we execute the first query in the <a href="gettingstarted/tutorials/../../studio/working-with-data/browse/README.html">Browse</a> tab of Studio we get the following result, from where we can see that there are three nodes connected to this beer, having <em>@rid</em> <em>11:4</em>, <em>14:262</em> and <em>12:59</em>:</p>
<p><img src="gettingstarted/tutorials/../../images/etl/openbeerdb/studio_browse_expand_beer.png" alt="" /></p>
<p>We can send the result of this <code>SELECT</code> query to the <a href="gettingstarted/tutorials/../../studio/working-with-data/graph-editor/README.html">Graph Editor</a> by clicking the icon "<em>Send to Graph</em>", or create a new visualization directly from the <em>Graph Editor</em>.</p>
<p>The following is the visualization of the <code>MATCH</code> query above, executed directly on the <em>Graph Editor</em>:</p>
<p><img src="gettingstarted/tutorials/../../images/etl/openbeerdb/studio_graph_specific_beer.png" alt="" /></p>
<p>The same resultset can be visualized using an external graph library. For instance, the following graph has been obtained using the library <a href="http://visjs.org">vis.js</a> where the input <em>visjs</em> dataset has been created with a java program created using the OrientDB's Java <a href="gettingstarted/tutorials/../../java/Graph-Database-Tinkerpop.html">Graph API</a>:</p>
<p><img src="gettingstarted/tutorials//images/etl/openbeerdb/library_visjs_expand_beer.png" alt="" /></p>
<p>We can also query bigger portions of the graph. For example, to query all beer <em>Category</em> nodes and for each of them all the connected <em>Style</em> nodes, we can use a <a href="gettingstarted/tutorials/../../sql/SQL-Match.html">MATCH</a> query like the following:</p>
<pre><code>MATCH 
{class: Category, as: category}-HasCategory-{class: Style, as: style}
RETURN $elements
</code></pre>
<p>The following is the visualization of the <code>MATCH</code> query above in the <a href="gettingstarted/tutorials/../../studio/working-with-data/graph-editor/README.html">Graph Editor</a>:</p>
<p><img src="gettingstarted/tutorials/../../images/etl/openbeerdb/studio_graph_class_category_and_style.png" alt="" /></p>
<p>while the following is a visualization created for the same recordset using the library <a href="http://visjs.org">vis.js</a>:</p>
<p><img src="gettingstarted/tutorials/../../images/etl/openbeerdb/library_visjs_class_category_and_style.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tutorial-importing-the-northwind-database-from-neo4j"><a class="header" href="#tutorial-importing-the-northwind-database-from-neo4j">Tutorial: Importing the <em>northwind</em> Database from Neo4j</a></h1>
<p>In this tutorial we will use the <a href="gettingstarted/tutorials/../../neo4j-to-orientdb-importer/README.html"><em>Neo4j to OrientDB Importer</em></a> to import the Neo4j <em>northwind</em> example database into OrientDB.</p>
<p>For general information on the possible Neo4j to OrientDB migration strategies, please refer to the <a href="gettingstarted/tutorials/../../admin/Import-from-Neo4j-into-OrientDB.html">Import from Neo4j</a> section.</p>
<blockquote>
<p>Neo4j and Cypher are registered trademark of Neo Technology, Inc.</p>
</blockquote>
<h2 id="preparing-for-the-migration"><a class="header" href="#preparing-for-the-migration">Preparing for the migration</a></h2>
<p>Please download and install OrientDB:</p>
<pre><code class="lang-sh">$ wget https://repo1.maven.org/maven2/com/orientechnologies/orientdb-community-tp2/3.2.44/orientdb-community-tp2-3.2.43.tar.gz -O orientdb-community-tp2-3.2.44.tar.gz
$ tar xvf orientdb-community-tp2-3.2.44.tar.gz</code></pre>
<p>Download and install the <em>Neo4j to OrientDB Importer</em>:</p>
<pre><code class="lang-sh">$ wget http://central.maven.org/maven2/com/orientechnologies/orientdb-neo4j-importer/3.2.44/orientdb-neo4j-importer-3.2.44.tar.gz
$ tar xfv orientdb-neo4j-importer-3.2.44.tar.gz -C orientdb-community-3.2.44 --strip-components=1 </code></pre>
<p>For further information on the OrientDB's installation, please refer to this <a href="gettingstarted/tutorials/../Tutorial-Installation.html">section</a>.</p>
<p>For further information on the <em>Neo4j to OrientDB Importer</em> installation, please refer to this <a href="gettingstarted/tutorials/../../neo4j-to-orientdb-importer/README.html#installation">section</a>.</p>
<h2 id="starting-the-migration"><a class="header" href="#starting-the-migration">Starting the migration</a></h2>
<p>Assuming that:</p>
<ul>
<li>
<p><code>/home/santo/neo4j/neo4j-community-3.0.7/lib</code> is the full path to the directory that includes the Neo4j's libraries</p>
</li>
<li>
<p><code>/home/santo/data/graph.db_northwind</code> is the full path to the directory that contains the Neo4j's <em>northwind</em> database</p>
</li>
<li>
<p><code>/home/santo/orientdb/orientdb-community-2.2.12/databases/northwind_import</code> is the full path to the directory where you would like to migrate the <em>northwind</em> database</p>
</li>
<li>
<p>that no Neo4j and OrientDB servers are running on those directories</p>
</li>
</ul>
<p>you can import the <em>northwind</em> database with a command similar to the following:</p>
<pre><code class="language-sh">./orientdb-neo4j-importer.sh \
  -neo4jlibdir /home/santo/neo4j/neo4j-community-3.0.7/lib \
  -neo4jdbdir /home/santo/neo4j/data/graph.db_northwind \
  -odbdir /home/santo/orientdb/orientdb-community-2.2.12/databases/northwind_import
</code></pre>
<p>For further information on how to use the <em>Neo4j to OrientDB Importer</em>, please refer to this <a href="gettingstarted/tutorials/../../neo4j-to-orientdb-importer/README.html#usage">section</a>.</p>
<h2 id="migration-output"><a class="header" href="#migration-output">Migration output</a></h2>
<p>The following is the output that is written by the <em>Neo4j to OrientDB Importer</em> during the <code>northwind</code> database migration:</p>
<pre><code>Neo4j to OrientDB Importer v.2.2.12-SNAPSHOT - Copyrights (c) 2016 OrientDB LTD

WARNING: 'o' option not found. Defaulting to 'false'.

Please make sure that there are no running servers on:
  '/home/santo/neo4j/data/graph.db_northwind' (Neo4j)
and:
  '/home/santo/orientdb/orientdb-community-2.2.12/databases/northwind_import' (OrientDB)

Initializing Neo4j...Done

Initializing OrientDB...Done

Importing Neo4j database:
  '/home/santo/neo4j/data/graph.db_northwind'
into OrientDB database:
  '/home/santo/orientdb/orientdb-community-2.2.12/databases/northwind_import'

Getting all Nodes from Neo4j and creating corresponding Vertices in OrientDB...
  1035 OrientDB Vertices have been created (100% done)
Done

Creating internal Indices on property 'Neo4jNodeID' on all OrientDB Vertices Classes...
  5 OrientDB Indices have been created (100% done)
Done

Getting all Relationships from Neo4j and creating corresponding Edges in OrientDB...
  3139 OrientDB Edges have been created (100% done)
Done

Getting Constraints from Neo4j and creating corresponding ones in OrientDB...
  0 OrientDB Indices have been created
Done

Getting Indices from Neo4j and creating corresponding ones in OrientDB...
  5 OrientDB Indices have been created (100% done)
Done

Import completed!

Shutting down OrientDB...Done
Shutting down Neo4j...Done

===============
Import Summary:
===============

- Found Neo4j Nodes                                                        : 1035
-- With at least one Label                                                 :  1035
--- With multiple Labels                                                   :   0
-- Without Labels                                                          :  0
- Imported OrientDB Vertices                                               : 1035 (100%)

- Found Neo4j Relationships                                                : 3139
- Imported OrientDB Edges                                                  : 3139 (100%)

- Found Neo4j Constraints                                                  : 0
- Imported OrientDB Constraints (Indices created)                          : 0

- Found Neo4j (non-constraint) Indices                                     : 5
- Imported OrientDB Indices                                                : 5 (100%)

- Additional created Indices (on vertex properties 'Neo4jNodeID')          : 5

- Total Import time:                                                       : 29 seconds
-- Initialization time                                                     :  7 seconds
-- Time to Import Nodes                                                    :  6 seconds (181.67 nodes/sec)
-- Time to Import Relationships                                            :  7 seconds (459.79 rels/sec)
-- Time to Import Constraints and Indices                                  :  4 seconds (1.21 indices/sec)
-- Time to create internal Indices (on vertex properties 'Neo4jNodeID')    :  4 seconds (1.22 indices/sec)
</code></pre>
<h2 id="connecting-to-the-newly-imported-database"><a class="header" href="#connecting-to-the-newly-imported-database">Connecting to the newly imported Database</a></h2>
<p>General information on how to connect to a newly imported database can be found in <a href="gettingstarted/tutorials/../../neo4j-to-orientdb-importer/README.html#connecting-to-the-newly-imported-database">this</a> section.</p>
<p>The following is a partial visualization of the <em>northwind</em> database done with the Graph Editor included in the OrientDB's <a href="gettingstarted/tutorials/../../studio/README.html">Studio</a> tool:</p>
<p><img src="gettingstarted/tutorials/../../images/import_from_neo4j/northwind/northwind_graph_editor.PNG" alt="" /></p>
<p>As you can see from the <em>Limit</em> field, the visualization is limited to 200 vertices.</p>
<p>The following, instead, is the graph returned by the following <a href="gettingstarted/tutorials/../../sql/SQL-Match.html"><code>MATCH</code></a> query (the query returns all nodes connected to the Order with <code>orderID</code> 10344):</p>
<pre><code class="language-sql">MATCH {class: Order, where: (orderID = 10344)}--{as: n} RETURN $pathelements
</code></pre>
<p><img src="gettingstarted/tutorials/../../images/import_from_neo4j/northwind/northwind_match_query.PNG" alt="" /></p>
<p>From Studio's <a href="gettingstarted/tutorials/../../studio/working-with-schemas/README.html">Schema Manager</a>, you can check all imported Vertex Classes (node Labels in Neo4j), Edge Classes (Relationship Types in Neo4j), and Indexes:</p>
<p><img src="gettingstarted/tutorials//images/import_from_neo4j/northwind/northwind_schema_manager.PNG" alt="" /></p>
<p><code>V</code> and <code>E</code> are special classes: they include all Vertices and all Edges.</p>
<div style="break-before: page; page-break-before: always;"></div><div class="table-wrapper"><table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td><img src="gettingstarted/tutorials/../../images/warning.png" alt="" /></td><td>This is a legacy strategy to migrate from Neo4j. The new strategy is to migrate using the <a href="gettingstarted/tutorials/../../neo4j-to-orientdb-importer/README.html">Neo4j to OrientDB Importer</a>.</td></tr>
</tbody></table>
</div>
<h1 id="tutorial-importing-the-movie-database-from-neo4j"><a class="header" href="#tutorial-importing-the-movie-database-from-neo4j">Tutorial: Importing the <em>movie</em> Database from Neo4j</a></h1>
<p>In this tutorial we will follow the steps described in the <a href="gettingstarted/tutorials/../../admin/Import-from-Neo4j-using-GraphML.html">Import from Neo4j using GraphML</a> section to import the Neo4j's <em>movie</em> example database into OrientDB.</p>
<p>We will also provide some examples of queries using the OrientDB's <a href="gettingstarted/tutorials/../../sql/SQL-Match.html">MATCH</a> syntax, making a comparison with the corresponding Neo4j's Cypher query language.</p>
<p>For general information on the possible Neo4j to OrientDB migration strategies, please refer to the <a href="gettingstarted/tutorials/../../admin/Import-from-Neo4j-into-OrientDB.html">Import from Neo4j</a> section.</p>
<blockquote>
<p>Neo4j and Cypher are registered trademark of Neo Technology, Inc.</p>
</blockquote>
<h2 id="exporting-from-neo4j"><a class="header" href="#exporting-from-neo4j">Exporting from Neo4j</a></h2>
<p>Assuming you have already downloaded and unpacked the <a href="https://github.com/jexp/neo4j-shell-tools">Neo4j Shell Tools</a>, and restarted the Neo4j Server, as described in the Section <a href="gettingstarted/tutorials/../../admin/Import-from-Neo4j-using-GraphML.html#exporting-graphml">Exporting GraphML</a>, you can export the <em>movie</em> database using <code>neo4j-shell</code> with a command like the following one:</p>
<pre><code class="language-sh">D:\neo4j\neo4j-community-3.0.6\bin&gt;neo4j-shell.bat

Welcome to the Neo4j Shell! Enter 'help' for a list of commands
NOTE: Remote Neo4j graph database service 'shell' at port 1337

neo4j-sh (?)$ export-graphml -t -o d:/movie.graphml
Wrote to GraphML-file d:/movies.graphml 0. 100%: nodes = 171 rels = 253 properties = 564 time 270 ms total 270 ms
</code></pre>
<p>In the example above the exported <em>movie</em> graph is stored under <code>D:\movie.graphml</code>.</p>
<h2 id="importing-into-orientdb"><a class="header" href="#importing-into-orientdb">Importing into OrientDB</a></h2>
<p>In this tutorial we will import in OrientDB the file <code>movie.graphml</code> using the OrientDB's <a href="gettingstarted/tutorials/../../console/README.html">Console</a>. For other GraphML import methods, please refer to the section <a href="gettingstarted/tutorials/../../admin/Import-from-Neo4j-using-GraphML.html#importing-graphml">Importing GraphML</a>.</p>
<p>The OrientDB's Console output generated during the import process is similar to the following (note that first we create a <em>movie</em> database using the command <code>CREATE DATABASE</code>, and then we do the actual import using the command <code>IMPORT DATABASE</code>):</p>
<pre><code class="language-sh">D:\orientdb\orientdb-enterprise-2.2.8\bin&gt;console.bat

OrientDB console v.2.2.8-SNAPSHOT (build 2.2.x@r39259e190e16045fe1425b1c0485f8562fca055b; 2016-08-23 14:38:49+0000) www.orientdb.com
Type 'help' to display all the supported commands.
Installing extensions for GREMLIN language v.2.6.0

orientdb&gt; CREATE DATABASE PLOCAL:D:/orientdb/orientdb-enterprise-2.2.8/databases/movie

Creating database [PLOCAL:D:/orientdb/orientdb-enterprise-2.2.8/databases/movie] using the storage type [PLOCAL]...
Database created successfully.

Current database is: PLOCAL:D:/orientdb/orientdb-enterprise-2.2.8/databases/movie
orientdb {db=movie}&gt; IMPORT DATABASE D:/movie.graphml

Importing GRAPHML database from D:/movie.graphml with options ()...
Done: imported 171 vertices and 253 edges
orientdb {db=movie}&gt;
</code></pre>
<p>As you can see from the output above, as a result of the import 171 vertices and 253 edges have been created in OrientDB. This is exactly the same number of nodes and relationships exported from Neo4j.</p>
<p>For more tips and tricks related to the import process, please refer to <a href="gettingstarted/tutorials/../../admin/Import-from-Neo4j-using-GraphML.html#import-tips-and-tricks">this</a> section.</p>
<h2 id="query-comparison"><a class="header" href="#query-comparison">Query Comparison</a></h2>
<p>Once the <em>movie</em> database has been imported into OrientDB, you may use several ways to access its data.</p>
<p>The <code>MATCH</code> <a href="gettingstarted/tutorials/../../sql/SQL-Match.html">syntax</a> and the tool <a href="gettingstarted/tutorials/../../studio/README.html">Studio</a> can be used, for instance, in a similar way to the Neo4j's Cypher and Browser.</p>
<p>The following sections include a comparison of the Neo4j's Cypher and OrientDB's <code>MATCH</code> syntax for some queries that you can execute against the <em>movie</em> database.</p>
<h3 id="find-the-actor-named-tom-hanks"><a class="header" href="#find-the-actor-named-tom-hanks">Find the actor named "Tom Hanks"</a></h3>
<p>Neo4j's Cypher:</p>
<pre><code>MATCH (tom:Person {name: "Tom Hanks"}) 
RETURN tom
</code></pre>
<p>OrientDB's MATCH:</p>
<pre><code>MATCH {class: Person, as: tom, where: (name = 'Tom Hanks')} 
RETURN $pathElements
</code></pre>
<h3 id="find-the-movie-with-title-cloud-atlas"><a class="header" href="#find-the-movie-with-title-cloud-atlas">Find the movie with title "Cloud Atlas"</a></h3>
<p>Neo4j's Cypher:</p>
<pre><code>MATCH (cloudAtlas:Movie {title: "Cloud Atlas"}) 
RETURN cloudAtlas
</code></pre>
<p>OrientDB's MATCH:</p>
<pre><code>MATCH {class: Movie, as: cloudAtlas, where: (title = 'Cloud Atlas')} 
RETURN $pathElements
</code></pre>
<h3 id="find-10-people"><a class="header" href="#find-10-people">Find 10 people</a></h3>
<p>Neo4j's Cypher:</p>
<pre><code>MATCH (people:Person) 
RETURN people.name 
LIMIT 10
</code></pre>
<p>OrientDB's MATCH:</p>
<pre><code>MATCH {class: Person, as: people} 
RETURN people.name
LIMIT 10
</code></pre>
<h3 id="find-the-movies-released-in-the-1990s"><a class="header" href="#find-the-movies-released-in-the-1990s">Find the movies released in the 1990s</a></h3>
<p>Neo4j's Cypher:</p>
<pre><code>MATCH (nineties:Movie) 
WHERE nineties.released &gt; 1990 AND nineties.released &lt; 2000 
RETURN nineties.title
</code></pre>
<p>OrientDB's MATCH:</p>
<pre><code>MATCH {class: Movie, as: nineties, WHERE: (released &gt; 1990 AND released &lt; 2000 )} 
RETURN nineties.title
</code></pre>
<h3 id="list-all-tom-hanks-movies"><a class="header" href="#list-all-tom-hanks-movies">List all Tom Hanks movies</a></h3>
<p>Neo4j's Cypher:</p>
<pre><code>MATCH (tom:Person {name: "Tom Hanks"})-[:ACTED_IN]-&gt;(tomHanksMovies) 
RETURN tom, tomHanksMovies
</code></pre>
<p>OrientDB's MATCH:</p>
<pre><code>MATCH {class: Person, as: tom, where: (name = 'Tom Hanks')}-ACTED_IN-&gt;{as: tomHanksMovies}
RETURN $pathElements
</code></pre>
<h3 id="find-out-who-directed-cloud-atlas"><a class="header" href="#find-out-who-directed-cloud-atlas">Find out who directed "Cloud Atlas"</a></h3>
<p>Neo4j's Cypher:</p>
<pre><code>MATCH (cloudAtlas {title: "Cloud Atlas"})&lt;-[:DIRECTED]-(directors)
RETURN directors.name
</code></pre>
<p>OrientDB's MATCH:</p>
<pre><code>MATCH {class: Movie, as: cloudAtlas, where: (title = 'Cloud Atlas')}&lt;-DIRECTED-{as: directors}
RETURN directors.name
</code></pre>
<h3 id="find-tom-hanks-co-actors"><a class="header" href="#find-tom-hanks-co-actors">Find Tom Hanks' co-actors</a></h3>
<p>Neo4j's Cypher:</p>
<pre><code>MATCH (tom:Person {name:"Tom Hanks"})-[:ACTED_IN]-&gt;(m)&lt;-[:ACTED_IN]-(coActors) 
RETURN DISTINCT coActors.name
</code></pre>
<p>OrientDB's MATCH:</p>
<pre><code>MATCH {class: Person, as: tom, where: (name = 'Tom Hanks')}-ACTED_IN-&gt;{as: m}&lt;-ACTED_IN-{class: Person,as: coActors}
RETURN coActors.name
</code></pre>
<h3 id="find-how-people-are-related-to-cloud-atlas"><a class="header" href="#find-how-people-are-related-to-cloud-atlas">Find how people are related to "Cloud Atlas"</a></h3>
<p>Neo4j's Cypher:</p>
<pre><code>MATCH (people:Person)-[relatedTo]-(:Movie {title: "Cloud Atlas"}) 
RETURN people.name, Type(relatedTo), relatedTo
</code></pre>
<p>OrientDB's MATCH:</p>
<pre><code>MATCH {class: Person, as: people}--{as: m, where: (title = 'Cloud Atlas')}
RETURN $pathElements
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="general-information-1"><a class="header" href="#general-information-1">General Information</a></h1>
<p>This Chapter includes some General Information on OrientDB.</p>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-11-26 SAM -->
<h1 id="supported-data-types"><a class="header" href="#supported-data-types">Supported Data Types</a></h1>
<p>OrientDB supports several data types natively. Below is the complete table.</p>
<div class="table-wrapper"><table><thead><tr><th>#id</th><th>Type</th><th>SQL type</th><th>Description</th><th>Java type</th><th>Minimum<br>Maximum</th><th>Auto-conversion from/to</th></tr></thead><tbody>
<tr><td>0</td><td>Boolean</td><td>BOOLEAN</td><td>Handles only the values <em>True</em> or <em>False</em></td><td><code>java.lang.Boolean</code> or <code>boolean</code></td><td>0<br>1</td><td>String</td></tr>
<tr><td>1</td><td>Integer</td><td>INTEGER</td><td>32-bit signed Integers</td><td><code>java.lang.Integer</code> or <code>int</code></td><td>-2,147,483,648<br>+2,147,483,647</td><td>Any Number, String</td></tr>
<tr><td>2</td><td>Short</td><td>SHORT</td><td>Small 16-bit signed integers</td><td><code>java.lang.Short</code> or <code>short</code></td><td>-32,768<br>32,767</td><td>Any Number, String</td></tr>
<tr><td>3</td><td>Long</td><td>LONG</td><td>Big 64-bit signed integers</td><td><code>java.lang.Long</code> or <code>long</code></td><td>-2<sup>63</sup><br>+2<sup>63</sup>-1</td><td>Any Number, String</td></tr>
<tr><td>4</td><td>Float</td><td>FLOAT</td><td>Decimal numbers</td><td><code>java.lang.Float</code> or <code>float</code></td><td>2<sup>-149</sup><br>(2-2<sup>-23</sup>)*2<sup>127</sup></td><td>Any Number, String</td></tr>
<tr><td>5</td><td>Double</td><td>DOUBLE</td><td>Decimal numbers with high precision</td><td><code>java.lang.Double</code> or <code>double</code></td><td>2<sup>-1074</sup><br>(2-2<sup>-52</sup>)*2<sup>1023</sup></td><td>Any Number, String</td></tr>
<tr><td>6</td><td>Datetime</td><td>DATETIME</td><td>Any date with the precision up to milliseconds. To know more about it, look at <a href="general/Managing-Dates.html">Managing Dates</a></td><td><code>java.util.Date</code></td><td>-<br>1002020303</td><td>Date, Long, String</td></tr>
<tr><td>7</td><td>String</td><td>STRING</td><td>Any string as alphanumeric sequence of chars</td><td><code>java.lang.String</code></td><td>-<br>-</td><td>-</td></tr>
<tr><td>8</td><td>Binary</td><td>BINARY</td><td>Can contain any value as byte array</td><td><code>byte[]</code></td><td>0<br>2,147,483,647</td><td>String</td></tr>
<tr><td>9</td><td>Embedded</td><td>EMBEDDED</td><td>The Record is contained inside the owner. The contained Record has no <a href="general/../datamodeling/Concepts.html#record-id">Record ID</a></td><td><code>ORecord</code></td><td>-<br>-</td><td>ORecord</td></tr>
<tr><td>10</td><td>Embedded list</td><td>EMBEDDEDLIST</td><td>The Records are contained inside the owner. The contained records have no <a href="general/../datamodeling/Concepts.html#record-id">Record ID's</a> and are reachable only by navigating the owner record</td><td><code>List&lt;Object&gt;</code></td><td>0<br>41,000,000 items</td><td>String</td></tr>
<tr><td>11</td><td>Embedded set</td><td>EMBEDDEDSET</td><td>The Records are contained inside the owner. The contained Records have no <a href="general/../datamodeling/Concepts.html#record-id">Record ID</a> and are reachable only by navigating the owner record</td><td><code>Set&lt;Object&gt;</code></td><td>0<br>41,000,000 items</td><td>String</td></tr>
<tr><td>12</td><td>Embedded map</td><td>EMBEDDEDMAP</td><td>The Records are contained inside the owner as values of the entries, while the keys can only be Strings. The contained ords e no <a href="general/../datamodeling/Concepts.html#record-id">Record ID</a>s and are reachable only by navigating the owner Record</td><td><code>Map&lt;String, ORecord&gt;</code></td><td>0<br>41,000,000 items</td><td><code>Collection&lt;? extends ORecord&lt;?&gt;&gt;</code>, <code>String</code></td></tr>
<tr><td>13</td><td>Link</td><td>LINK</td><td>Link to another Record. It's a common <a href="general/../datamodeling/Concepts.html#11-and-1n-referenced-relationships">one-to-one relationship</a></td><td><code>ORID</code>, <code>&lt;? extends ORecord&gt;</code></td><td>1:-1<br>32767:2^63-1</td><td>String</td></tr>
<tr><td>14</td><td>Link list</td><td>LINKLIST</td><td>Links to other Records. It's a common <a href="general/../datamodeling/Concepts.html#1n-and-nn-embedded-relationships">one-to-many relationship</a> where only the <a href="general/../datamodeling/Concepts.html#record-id">Record ID</a>s are stored</td><td><code>List&lt;? extends ORecord</code></td><td>0<br>41,000,000 items</td><td>String</td></tr>
<tr><td>15</td><td>Link set</td><td>LINKSET</td><td>Links to other Records. It's a common <a href="general/../datamodeling/Concepts.html#1n-and-nn-embedded-relationships">one-to-many relationship</a></td><td><code>Set&lt;? extends ORecord&gt;</code></td><td>0<br>41,000,000 items</td><td><code>Collection&lt;? extends ORecord&gt;</code>, <code>String</code></td></tr>
<tr><td>16</td><td>Link map</td><td>LINKMAP</td><td>Links to other Records as value of the entries, while keys can only be Strings. It's a common <a href="general/../datamodeling/Concepts.html#1n-and-nn-embedded-relationships">One-to-Many Relationship</a>. Only the <a href="general/../datamodeling/Concepts.html#record-id">Record ID</a>s are stored</td><td><code>Map&lt;String,<br>    ? extends Record&gt;</code></td><td>0<br>41,000,000 items</td><td>String</td></tr>
<tr><td>17</td><td>Byte</td><td>BYTE</td><td>Single byte. Useful to store small 8-bit signed integers</td><td><code>java.lang.Byte</code> or <code>byte</code></td><td>-128<br>+127</td><td>Any Number, String</td></tr>
<tr><td>18</td><td>Transient</td><td>TRANSIENT</td><td>Any value not stored on database</td><td></td><td></td><td></td></tr>
<tr><td>19</td><td>Date</td><td>DATE</td><td>Any date as year, month and day. To know more about it, look at <a href="general/Managing-Dates.html">Managing Dates</a></td><td><code>java.util.Date</code></td><td>-<bonetomanyr>-</td><td>Date, Long, String</td></tr>
<tr><td>20</td><td>Custom</td><td>CUSTOM</td><td>used to store a custom type providing the marshall and unmarshall methods</td><td><code>OSerializableStream</code></td><td>0<br>X</td><td>-</td></tr>
<tr><td>21</td><td>Decimal</td><td>DECIMAL</td><td>Decimal numbers without rounding</td><td><code>java.math.BigDecimal</code></td><td>?<br>?</td><td>Any Number, String</td></tr>
<tr><td>22</td><td>LinkBag</td><td>LINKBAG</td><td>List of <a href="general/../datamodeling/Concepts.html#record-id">Record ID</a>s as spec <a href="general/../internals/RidBag.html">RidBag</a></td><td><code>ORidBag</code></td><td>?<br>?</td><td>-</td></tr>
<tr><td>23</td><td>Any</td><td>ANY</td><td>Not determinated type, used to specify Collections of mixed type, and null</td><td>-</td><td>-</td><td>-</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="schema"><a class="header" href="#schema">Schema</a></h1>
<p>While OrientDb can work in a schema-less mode, you may find it necessary at times to enforce a schema on your data model.  OrientDB supports both schema-full and schema-hybrid solutions.</p>
<p>In the case of schema-hybrid mode, you only set constraints for certain fields and leave the user to add custom fields to the record.  This mode occurs at a class level, meaning that you can have an <code>Employee</code> class as schema-full and an <code>EmployeeInformation</code> class as schema-less.</p>
<ul>
<li><strong>Schema-full</strong> Enables strict-mode at a class-level and sets all fields as mandatory.</li>
<li><strong>Schema-less</strong> Enables classes with no properties.  Default is non-strict-mode, meaning that records can have arbitrary fields.</li>
<li><strong>Schema-hybrid</strong> Enables classes with some fields, but allows records to define custom fields.  This is also sometimes called schema-mixed.</li>
</ul>
<blockquote>
<p><strong>NOTE</strong> Changes to the schema are not transactional.  You must execute these commands outside of a transaction.</p>
</blockquote>
<p>You can access the schema through <a href="general/../sql/SQL-Metadata.html#querying-the-schema">SQL</a> or through the Java API.  Examples here use the latter.  To access the schema API in Java, you need the Schema instance of the database you want to use.  For example,</p>
<pre><code class="language-java">OSchema schema = database.getMetadata().getSchema();
</code></pre>
<h2 id="class"><a class="header" href="#class">Class</a></h2>
<p>OrientDB draws from the Object Oriented programming paradigm in the concept of the Class.  A class is a type of record.  In comparison to Relational database systems, it is most similar in conception to the table.</p>
<p>Classes can be schema-less, schema-full or schema-hybrid.  They can inherit from other classes, shaping a tree of classes.  In other words, a sub-class extends the parent class, inheriting all attributes.</p>
<p>Each class has its own clusters.  By default, these clusters are logical, but they can also be physical.  A given class must have at least one cluster defined as its default, but it can support multiple clusters.  OrientDB writes new records into the default cluster, but always reads from all defined clusters.</p>
<p>When you create a new class, OrientDB creates a default physical cluster that uses the same name as the class, but in lowercase.</p>
<h3 id="creating-persistent-classes"><a class="header" href="#creating-persistent-classes">Creating Persistent Classes</a></h3>
<p>Classes contain one or more properties.  This mode is similar to the classical model of the Relational database, where you must define tables before you can begin to store records.</p>
<p>To create a persistent class in Java, use the <code>createClass()</code> method:</p>
<pre><code class="language-java">OClass account = database.getMetadata().getSchema().createClass("Account");
</code></pre>
<p>This method creates the class <code>Account</code> on the database.  It simultaneously creates the physical cluster <code>account</code>, to provide storage for records in the class <code>Account</code>.</p>
<h3 id="getting-persistent-classes"><a class="header" href="#getting-persistent-classes">Getting Persistent Classes</a></h3>
<p>With the new persistent class created, you may also need to get its contents.</p>
<p>To retrieve a persistent class in Java, use the <code>getClass()</code> method:</p>
<pre><code class="language-java">OClass account = database.getMetadata().getSchema().getClass("Account");
</code></pre>
<p>This method retrieves from the database the persistent class <code>Account</code>.  If the query finds that the <code>Account</code> class does not exist, it returns <code>NULL</code>.</p>
<h3 id="dropping-persistent-classes"><a class="header" href="#dropping-persistent-classes">Dropping Persistent Classes</a></h3>
<p>In the event that you no longer want the class, you can drop, or delete, it from the database.</p>
<p>To drop a persistent class in Java, use the <a href="general/../java/ref/OSchema/dropClass.html"><code>OSchema.dropClass()</code></a> method:</p>
<pre><code class="language-java">database.getMetadata().getSchema().dropClass("Account");
</code></pre>
<p>This method drops the class <code>Account</code> from your database.  It does not delete records that belong to this class unless you explicitly ask it to do so:</p>
<pre><code class="language-java">database.command(new OCommandSQL("DELETE FROM Account")).execute();
database.getMetadata().getSchema().dropClass("Account");
</code></pre>
<h3 id="constraints"><a class="header" href="#constraints">Constraints</a></h3>
<p>Working in schema-full mode requires that you set the strict mode at the class-level, by defining the <code>setStrictMode()</code> method to <code>TRUE</code>.  In this case, records of that class cannot have undefined properties.</p>
<h2 id="properties"><a class="header" href="#properties">Properties</a></h2>
<p>In OrientDB, a property is a field assigned to a class.  For the purposes of this tutorial, consider Property and Field as synonymous.</p>
<h3 id="creating-class-properties"><a class="header" href="#creating-class-properties">Creating Class Properties</a></h3>
<p>After you create a class, you can define fields for that class.  To define a field, use the <code>createProperty()</code> method.</p>
<pre><code class="language-java">OClass account = database.getMetadata().getSchema().createClass("Account");
account.createProperty("id", OType.Integer);
account.createProperty("birthDate", OType.Date);
</code></pre>
<p>These lines create a class <code>Account</code>, then defines two properties <code>id</code> and <code>birthDate</code>.  Bear in mind that each field must belong to one of the <a href="general/Types.html">supported types</a>.  Here these are the integer and date types.</p>
<h3 id="dropping-class-properties"><a class="header" href="#dropping-class-properties">Dropping Class Properties</a></h3>
<p>In the event that you would like to remove properties from a class you can do so using the <a href="general/../java/ref/OClass/dropProperty.html"><code>dropProperty()</code></a> method under <a href="general/../java/ref/OClass.html"><code>OClass</code></a>.</p>
<pre><code class="language-java">database.getMetadata().getSchema().getClass("Account").dropProperty("name");
</code></pre>
<p>When you drop a property from a class, it does not remove records from that class unless you explicitly ask for it, using the <a href="general/../sql/SQL-Update.html"><code>UPDATE... REMOVE</code></a> statements.  For instance,</p>
<pre><code class="language-java">database.getMetadata().getSchema().getClass("Account").dropProperty("name");
database.command(new OCommandSQL("UPDATE Account REMOVE name")).execute();
</code></pre>
<p>The first method drops the property from the class.  The second updates the database to remove the property.</p>
<h2 id="relationships"><a class="header" href="#relationships">Relationships</a></h2>
<p>OrientDB supports two types of relationships: referenced and embedded.</p>
<h3 id="referenced-relationships"><a class="header" href="#referenced-relationships">Referenced Relationships</a></h3>
<p>In the case of referenced relationships, OrientDB uses a direct link to the referenced record or records.  This allows the database to avoid the costly <code>JOIN</code> operations used by Relational databases.</p>
<pre><code>                  customer
  Record A     -------------&gt;    Record B
CLASS=Invoice                 CLASS=Customer
  RID=5:23                       RID=10:2
</code></pre>
<p>In the example, Record A contains the reference to Record B in the property <code>customer</code>.  Both records are accessible by any other records since each has a <a href="general/../datamodeling/Concepts.html#record-id">Record ID</a>.</p>
<h4 id="11-and-n1-reference-relationships"><a class="header" href="#11-and-n1-reference-relationships">1:1 and <em>n</em>:1 Reference Relationships</a></h4>
<p>In one to one and many to one relationships, the reference relationship is expressed using the <code>LINK</code> type.  For instance.</p>
<pre><code class="language-java">OClass customer= database.getMetadata().getSchema().createClass("Customer");
customer.createProperty("name", OType.STRING);

OClass invoice = database.getMetadata().getSchema().createClass("Invoice");
invoice.createProperty("id", OType.INTEGER);
invoice.createProperty("date", OType.DATE);
invoice.createProperty("customer", OType.LINK, customer);
</code></pre>
<p>Here, records of the class <code>Invoice</code> link to a record of the class <code>Customer</code>, through the field <code>customer</code>.</p>
<h4 id="1n-and-nn-reference-relationships"><a class="header" href="#1n-and-nn-reference-relationships">1:<em>n</em> and <em>n</em>:<em>n</em> Reference Relationships.</a></h4>
<p>In one to many and many to many relationships, OrientDB expresses the referenced relationship using collections of links.</p>
<ul>
<li><code>LINKLIST</code> An ordered list of links.</li>
<li><code>LINKSET</code> An unordered set of links, that does not accept duplicates.</li>
<li><code>LINKMAP</code> An ordered map of links, with a string key.  It does not accept duplicate keys.</li>
</ul>
<p>For example,</p>
<pre><code class="language-java">OClass orderItem = db.getMetadata().getSchema().createClass("OrderItem");
orderItem.createProperty("id", OType.INTEGER);
orderItem.createProperty("animal", OType.LINK, animal);

OClass order = db.getMetadata().getSchema().createClass("Order");
order.createProperty("id", OType.INTEGER);
order.createProperty("date", OType.DATE);
order.createProperty("items", OType.LINKLIST, orderItem);
</code></pre>
<p>Here, you have two classes: <code>Order</code> and <code>OrderItem</code> and a 1:<em>n</em> referenced relationship is created between them.</p>
<h3 id="embedded-relationships"><a class="header" href="#embedded-relationships">Embedded Relationships</a></h3>
<p>In the case of embedded relationships, OrientDB contains the relationship within the record.  Embedded relationships are stronger than referenced relationships, but the embedded record does not have its own <a href="general/../datamodeling/Concepts.html#record-id">Record ID</a>.  Because of this, you cannot reference them directly through other records.  The relationship is only accessible through the container record.  If the container record is deleted, then the embedded record is also deleted.</p>
<pre><code>                  address
  Record A     &lt;&gt;----------&gt;   Record B
CLASS=Account               CLASS=Address
  RID=5:23                     NO RID!
</code></pre>
<p>Here, Record A contains the entirety of Record B in the property <code>address</code>.  You can only reach Record B by traversing the container, Record A.</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM Account WHERE Address.city = 'Rome'</code>
</pre>
<h4 id="11-and-n1-embedded-relationships"><a class="header" href="#11-and-n1-embedded-relationships">1:1 and <em>n</em>:1 Embedded Relationships</a></h4>
<p>For one to one and many to one embedded relationships, OrientDB uses links of the <code>EMBEDDED</code> type.  For example,</p>
<pre><code class="language-java">OClass address = database.getMetadata().getSchema().createClass("Address");

OClass account = database.getMetadata().getSchema().createClass("Account");
account.createProperty("id", OType.INTEGER);
account.createProperty("birthDate", OType.DATE);
account.createProperty("address", OType.EMBEDDED, address);
</code></pre>
<p>Here, records of the class <code>Account</code> embed records for the class <code>Address</code>.</p>
<h4 id="1n-and-nn-embedded-relationships"><a class="header" href="#1n-and-nn-embedded-relationships">1:<em>n</em> and <em>n</em>:<em>n</em> Embedded Relationships</a></h4>
<p>In the case of one to many and many to many relationships, OrientDB sues a collection embedded link types:</p>
<ul>
<li><code>EMBEDDEDLIST</code> An ordered list of records.</li>
<li><code>EMBEDDEDSET</code> An unordered set of records.  It doesn't accept duplicates.</li>
<li><code>EMBEDDEDMAP</code> An ordered map of records as key-value pairs.  It doesn't accept duplicate keys.</li>
</ul>
<p>For example,</p>
<pre><code class="language-java">OClass orderItem = db.getMetadata().getSchema().createClass("OrderItem");
orderItem.createProperty("id", OType.INTEGER);
orderItem.createProperty("animal", OType.LINK, animal);

OClass order = db.getMetadata().getSchema().createClass("Order");
order.createProperty("id", OType.INTEGER);
order.createProperty("date", OType.DATE);
order.createProperty("items", OType.EMBEDDEDLIST, orderItem);
</code></pre>
<p>This establishes a one to many relationship between the classes <code>Order</code> and <code>OrderItem</code>.</p>
<h2 id="constraints-1"><a class="header" href="#constraints-1">Constraints</a></h2>
<p>OrientDB supports a number of constraints for each field.  For more information on setting constraints, see the <a href="general/../sql/SQL-Alter-Property.html"><code>ALTER PROPERTY</code></a> command.</p>
<ul>
<li><strong>Minimum Value</strong>: <code>setMin()</code> The field accepts a string, because it works also for date ranges.</li>
<li><strong>Maximum Value</strong>: <code>setMax()</code> The field accepts a string, because it works also for date rangers.</li>
<li><strong>Mandatory</strong>: <code>setMandatory()</code> This field is required.</li>
<li><strong>Read Only</strong>: <code>setReadonly()</code> This field cannot update after being created.</li>
<li><strong>Not Null</strong>: <code>setNotNull()</code> This field cannot be null.</li>
<li><strong>Unique</strong>: This field doesn't allow duplicates or speedup searches.</li>
<li><strong>Regex</strong>: This field must satisfy <a href="http://en.wikipedia.org/wiki/Regular_expression">Regular Expressions</a></li>
</ul>
<p>For example,</p>
<pre><code class="language-java">profile.createProperty("nick", OType.STRING).setMin("3").setMax("30").setMandatory(true).setNotNull(true);
profile.createIndex("nickIdx", OClass.INDEX_TYPE.UNIQUE, "nick"); // Creates unique constraint

profile.createProperty("name", OType.STRING).setMin("3").setMax("30");
profile.createProperty("surname", OType.STRING).setMin("3").setMax("30");
profile.createProperty("registeredOn", OType.DATE).setMin("2010-01-01 00:00:00");
profile.createProperty("lastAccessOn", OType.DATE).setMin("2010-01-01 00:00:00");
</code></pre>
<h3 id="indices-as-constraints"><a class="header" href="#indices-as-constraints">Indices as Constraints</a></h3>
<p>To define a property value as unique, use the <code>UNIQUE</code> index constraint.  For example,</p>
<pre><code class="language-java">profile.createIndex("EmployeeId", OClass.INDEX_TYPE.UNIQUE, "id");
</code></pre>
<p>You can also constrain a group of properties as unique by creating a composite index made from multiple fields.  For instance,</p>
<pre><code class="language-java">profile.createIndex("compositeIdx", OClass.INDEX_TYPE.NOTUNIQUE, "name", "surname");
</code></pre>
<p>For more information about indexes look at <a href="general/../indexing/Indexes.html">Index guide</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="inheritance-1"><a class="header" href="#inheritance-1">Inheritance</a></h1>
<p>Unlike many Object-relational mapping tools, OrientDB does not split documents between different classes.  Each document resides in one or a number of clusters associated with its specific class.  When you execute a query against a class that has subclasses, OrientDB searches the clusters of the target class and all subclasses.</p>
<h2 id="declaring-inheritance-in-schema"><a class="header" href="#declaring-inheritance-in-schema">Declaring Inheritance in Schema</a></h2>
<p>In developing your application, bear in mind that OrientDB needs to know the class inheritance relationship.  This is an abstract concept that applies to both  <a href="general/../java/Object-DB-Interface.html#inheritance">POJO's</a> and  <a href="general/../java/Document-Database.html">Documents</a>.</p>
<p>For example,</p>
<pre><code class="language-java">OClass account = database.getMetadata().getSchema().createClass("Account");
OClass company = database.getMetadata().getSchema().createClass("Company").setSuperClass(account);
</code></pre>
<h2 id="using-polymorphic-queries"><a class="header" href="#using-polymorphic-queries">Using Polymorphic Queries</a></h2>
<p>By default, OrientDB treats all queries as polymorphic. Using the example above, you can run the following query from the console:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM Account WHERE name.toUpperCase() = 'GOOGLE'</code>
</pre>
<p>This query returns all instances of the classes <code>Account</code> and <code>Company</code> that have a property name that matches <code>Google</code>.</p>
<h2 id="how-inheritance-works"><a class="header" href="#how-inheritance-works">How Inheritance Works</a></h2>
<p>Consider an example, where you have three classes, listed here with the cluster identifier in the parentheses.</p>
<pre><code>Account(10) &lt;|--- Company (13) &lt;|--- OrientTechnologiesGroup (27)
</code></pre>
<p>By default, OrientDB creates a separate cluster for each class.  It indicates this cluster by the <code>defaultClusterId</code> property in the class <code>OClass</code> and indicates the cluster used by default when not specified.  However, the class <code>OClass</code> has a property <code>clusterIds</code>, (as <code>int[]</code>), that contains all the clusters able to contain the records of that class.  <code>clusterIds</code> and <code>defaultClusterId</code> are the same by default.</p>
<p>When you execute a query against a class, OrientDB limits the result-sets to only the records of the clusters contained in the <code>clusterIds</code> property.  For example,</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM Account WHERE name.toUpperCase() = 'GOOGLE'</code>
</pre>
<p>This query returns all the records with the name property set to <code>GOOGLE</code> from all three classes, given that the base class <code>Account</code> was specified.  For the class <code>Account</code>, OrientDB searches inside the clusters <code>10</code>, <code>13</code> and <code>27</code>, following the inheritance specified in the schema.</p>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-11-26 SAM -->
<h1 id="concurrency"><a class="header" href="#concurrency">Concurrency</a></h1>
<p>OrientDB uses an optimistic approach to concurrency.  Optimistic Concurrency Control, or <a href="http://en.wikipedia.org/wiki/Optimistic_concurrency_control">OCC</a> assumes that multiple transactions can compete frequently without interfering with each other. It's very important that you don't share instances of databases, graphs, records, documents, vertices and edges between threads because they are non thread-safe. For more information look at <a href="general/../java/Java-Multi-Threading.html">Multi-Threading</a>.</p>
<h2 id="how-does-it-work"><a class="header" href="#how-does-it-work">How does it work?</a></h2>
<p>Consider the following scenario, where 2 clients, A and B, want to update the amount of a bank account:</p>
<pre><code>       Client A                               Client B
       
           |                                     |
          (t1)                                   |
   Read record #13:22                            |
     amount is 100                              (t2)
           |                             Read record #13:22                   
          (t3)                             amount is 100
  Update record #13:22                           |
set amount = amount + 10                        (t4)
           |                            Update record #13:22
           |                           set amount = amount + 10
           |                                     |
</code></pre>
<p>Client A (t1) and B (t2) read the record #13:22 and both receive the last amount as USD 100. Client A updates the amount by adding USD 10 (t3), then the Client B is trying to do the same thing: updates the amount by adding USD 10. Here is the problem: Client B is doing an operation based on current information: the amount was USD 100. But at the moment of update, such information is changed (by Client A on t3), so the amount is USD 110 in the database. Should the update succeed by setting the new amount to USD 120?</p>
<p>In some cases this could be totally fine, in others not. It depends by the use case. For example, in your application there could be a logic where you are donating USD 10 to all the accounts where the amount is &lt;=100. The owner of the account behind the record #13:22 is more lucky than the others, because it receives the donation even if it has USD 110 at that moment.</p>
<p>For this reason in OrientDB when this situation happens a <code>OConcurrentModificationException</code> exception is thrown, so the application can manage it properly. Usually the 3 most common strategies to handle this exceptions are:</p>
<ol>
<li><strong>Retry</strong> doing the same operation by reloading the record #13:22 first with the updated amount</li>
<li><strong>Ignore</strong> the change, because the basic condition is changed</li>
<li><strong>Propagate the exception to the user</strong>, so he can decide what to do in this case</li>
</ol>
<h2 id="optimistic-concurrency-in-orientdb"><a class="header" href="#optimistic-concurrency-in-orientdb">Optimistic Concurrency in OrientDB</a></h2>
<p>Optimistic concurrency control is used in environments with low data contention.  That is, where conflicts are rare and transactions can complete without the expense of managing locks and without having transactions wait for locks to clear. This means a reduced throughput over other concurrency control methods.</p>
<p>OrientDB uses OCC for both <a href="general/Concurrency.html#atomic-operations">Atomic Operations</a> and <a href="general/Concurrency.html#transactions">Transactions</a>.</p>
<h3 id="atomic-operations"><a class="header" href="#atomic-operations">Atomic Operations</a></h3>
<p>OrientDB supports Multi-Version Concurrency Control, or <a href="http://en.wikipedia.org/wiki/Multiversion_concurrency_control">MVCC</a>, with atomic operations. This allows it to avoid locking server side resources. At the same time, it checks the version in the database. If the version is equal to the record version contained in the operation, the operation is successful. If the version found is higher than the record version contained in the operation, then another thread or user has already updated the same record.  In this case, OrientDB generates an <code>OConcurrentModificationException</code> exception.</p>
<p>Given that behavior of this kind is normal on systems that use optimistic concurrency control, developers need to write concurrency-proof code.  Under this design, the application retries transactions <em>x</em> times before reporting the error.  It does this by catching the exception, reloading the affected records and attempting to update them again.  For example, consider the code for saving a document,</p>
<pre><code class="language-java">int maxRetries = 10;
List&lt;ODocument&gt; result = db.query("SELECT FROM Client WHERE id = '39w39D32d2d'");
ODocument address = result.get(0);

for (int retry = 0; retry &lt; maxRetries; ++retry) {
     try {
          // LOOKUP FOR THE INVOICE VERTEX
          address.field( "street", street );
          address.field( "zip", zip );
          address.field( "city", cityName );
          address.field( "country", countryName );

          address.save();

          // EXIT FROM RETRY LOOP
          break;
	 }
	 catch( ONeedRetryException e ) {
          // IF SOMEONE UPDATES THE ADDRESS DOCUMENT
          // AT THE SAME TIME, RETRY IT.
     }
}
</code></pre>
<h3 id="transactions"><a class="header" href="#transactions">Transactions</a></h3>
<p>OrientDB supports optimistic transactions. The database does not use locks when transactions are running, but when the transaction commits, each record (document or graph element) version is checked to see if there have been updates from another client. For this reason, you need to code your applications to be concurrency-proof.</p>
<p>Optimistic concurrency requires that you retire the transaction in the event of conflicts.  For example, consider a case where you want to connect a new vertex to an existing vertex:</p>
<pre><code class="language-java">int maxRetries = 10;
for (int retry = 0; retry &lt; maxRetries; ++retry) {
     try {
          // LOOKUP FOR THE INVOICE VERTEX
          Vertex invoice = graph.getVertices("invoiceId", 2323);
		  
          // CREATE A NEW ITEM
          Vertex invoiceItem = graph.addVertex("class:InvoiceItem");
          invoiceItem.field("price", 1000);
		  
          // ADD IT TO THE INVOICE
          invoice.addEdge(invoiceItem);

          graph.commit();

          // EXIT FROM RETRY LOOP
          break;
     }
	 catch( OConcurrentModificationException e ) {
          // SOMEONE HAS UPDATED THE INVOICE VERTEX
		  // AT THE SAME TIME, RETRY IT
     }
}
</code></pre>
<h4 id="concurrency-level"><a class="header" href="#concurrency-level">Concurrency Level</a></h4>
<p>Before v2.2.4, transactions acquire an exclusive lock on the storage, so no matter if you have 1 or 100 cores, the execution was always serialized. With 2.2.4 and further, transactions are executed in parallel only if they involve different <a href="general/../datamodeling/Concepts.html#cluster">clusters</a> and indexes.</p>
<p>In order to use the transaction parallelism, the domain has to be slightly changed by using the OrientDB inheritance by creating a base class and multiple sub-classes, one per core. Example of creating the class Log with 4 sub-classes (4 cores) and the indexed property 'id':</p>
<pre><code class="language-sql">CREATE CLASS Log ABSTRACT

CREATE CLASS Log_1 EXTENDS Log
CREATE PROPERTY Log_1.id STRING
CREATE INDEX Log1Id ON Log_1(id) UNIQUE_HASHINDEX

CREATE CLASS Log_2 EXTENDS Log
CREATE PROPERTY Log_2.id STRING
CREATE INDEX Log1Id ON Log_2(id) UNIQUE_HASHINDEX

CREATE CLASS Log_3 EXTENDS Log
CREATE PROPERTY Log_3.id STRING
CREATE INDEX Log1Id ON Log_3(id) UNIQUE_HASHINDEX

CREATE CLASS Log_4 EXTENDS Log
CREATE PROPERTY Log_4.id STRING
CREATE INDEX Log1Id ON Log_4(id) UNIQUE_HASHINDEX
</code></pre>
<p>After creating multiple sub-classes, you should bind your threads/client (it depends, respectively, if you are working in embedded mode or client/server) to a different sub-class. For example with 4 cores, you have 4 sub-classes (like above) and this could be the binding for the class "Log":</p>
<ul>
<li>Thread/Client 1 -&gt; Class <strong>Log_1</strong></li>
<li>Thread/Client 2 -&gt; Class <strong>Log_2</strong></li>
<li>Thread/Client 3 -&gt; Class <strong>Log_3</strong></li>
<li>Thread/Client 4 -&gt; Class <strong>Log_4</strong></li>
</ul>
<p>If you are working with graphs, it's a good practice to apply the same rule to both vertex and edge classes. In this example we have 4 cores, so 4 clusters per vertex class and 4 clusters per edge class:</p>
<ul>
<li>Thread/Client 1 -&gt; Classes <strong>User_1</strong> and <strong>City_1</strong> for vertices and Class <strong>Born_1</strong> for edges</li>
<li>Thread/Client 2 -&gt; Classes <strong>User_2</strong> and <strong>City_2</strong> for vertices and Class <strong>Born_2</strong> for edges</li>
<li>Thread/Client 3 -&gt; Classes <strong>User_3</strong> and <strong>City_3</strong> for vertices and Class <strong>Born_3</strong> for edges</li>
<li>Thread/Client 4 -&gt; Classes <strong>User_4</strong> and <strong>City_4</strong> for vertices and Class <strong>Born_4</strong> for edges</li>
</ul>
<p>Now look at these 2 SQL scripts:</p>
<p>Client 1:</p>
<pre><code class="language-sql">BEGIN
LET v1 = CREATE VERTEX User_1 SET name = 'Luca'
LET v2 = CREATE VERTEX City_1 SET name = 'Rome'
CREATE EDGE Born_1 FROM $v1 TO $v2
COMMIT RETRY 10
</code></pre>
<p>Client 2:</p>
<pre><code class="language-sql">BEGIN
LET v1 = CREATE VERTEX User_2 SET name = 'Luca'
LET v2 = CREATE VERTEX City_2 SET name = 'Rome'
CREATE EDGE Born_2 FROM $v1 TO $v2
COMMIT RETRY 10
</code></pre>
<p>In this case the two transactions go in parallel with no conflict, because they work on different classes and indexes.</p>
<p>Thanks to the OrientDB polymorphism, sub-classes are <code>instance of</code> the abstract class, so you can still execute queries by using the base class as target and OrientDB will consider all the sub-classes, so your model remains clean at application level. Example:</p>
<pre><code class="language-sql">SELECT * FROM User WHERE name = 'Luca'
</code></pre>
<p>But if you already know that Luca if exists is in the 2nd partition of the User class (User_2 sub class), you can also execute:</p>
<pre><code class="language-sql">SELECT * FROM User_2 WHERE name = 'Luca'
</code></pre>
<p>When it's possible to pre-determine there the record is saved, using the sub-class as target has better performance.</p>
<h2 id="concurrency-when-adding-edges"><a class="header" href="#concurrency-when-adding-edges">Concurrency when Adding Edges</a></h2>
<p>Consider the case where multiple clients attempt to add edges on the same vertex.  OrientDB could throw the <code>OConcurrentModificationException</code> exception.  This occurs because collections of edges are kept on vertices,  meaning that, every time OrientDB adds or removes an edge, both vertices update and their versions increment.  You can avoid this issue by using <a href="general/../internals/RidBag.html">RIDBAG Bonsai structure</a>, which are never embedded, so the edge never updates the vertices.</p>
<p>To use this configuration at run-time, before launching OrientDB, use this code:</p>
<pre><code class="language-java">OGlobalConfiguration.RID_BAG_EMBEDDED_TO_SBTREEBONSAI_THRESHOLD.setValue(-1);
</code></pre>
<p>Alternatively, you can set a parameter for the Java virtual-machine on startup, or even at run-time, before OrientDB is used:</p>
<pre>
$ <code class="lang-sql userinput">java -DridBag.embeddedToSbtreeBonsaiThreshold=-1</code>
</pre>
<div class="table-wrapper"><table><thead><tr><th><img src="general/../images/warning.png" alt="NOTE" /></th><th style="text-align: left">While running in distributed mode SBTrees are not supported. If using a distributed database then you must set <pre>ridBag.embeddedToSbtreeBonsaiThreshold = Integer.MAX_VALUE</pre>  to avoid replication errors.</th></tr></thead><tbody>
</tbody></table>
</div>
<h2 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h2>
<h3 id="reduce-transaction-size"><a class="header" href="#reduce-transaction-size">Reduce Transaction Size</a></h3>
<p>On occasion, OrientDB throws the <code>OConcurrentModificationException</code> exception even when you concurrently update the first element. In particularly large transactions, where you have thousands of records involved in a transaction, one changed record is enough to roll the entire process back with an <code>OConcurrentModificationException</code> exception.</p>
<p>To avoid issues of this kind, if you plan to update many elements in the same transaction with high-concurrency on the same vertices, a best practice is to reduce the transaction size.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="indexes"><a class="header" href="#indexes">Indexes</a></h1>
<p>OrientDB supports five index algorithms:</p>
<ul>
<li><a href="indexing/SB-Tree-index.html"><strong>SB-Tree Index</strong></a> Provides a good mix of features available from other index types, good for general use.  It is durable, transactional and supports range queries.  It is the default index type.</li>
<li><a href="indexing/Hash-Index.html"><strong>Hash Index</strong></a> Provides fast lookup and is very light on disk usage.  It is durable and transactional, but does not support range queries.  It works like a HashMap, which makes it faster on punctual lookups and it consumes less resources than other index types.</li>
<li><a href="indexing/Auto-Sharding-Index.html"><strong>Auto Sharding Index</strong></a> Provides an implementation of a <a href="https://en.wikipedia.org/wiki/Distributed_hash_table">DHT</a>.  It is durable and transactional, but does not support range queries.  (Since v2.2)</li>
<li><a href="indexing/Full-Text-Index.html"><strong>Lucene Full Text Index</strong></a> Provides good full-text indexes, but cannot be used to index other types.  It is durable, transactional and supports range queries.</li>
<li><a href="indexing/Spatial-Index.html"><strong>Lucene Spatial Index</strong></a> Provides good spatial indexes, but cannot be used to index other types.  It is durable, transactional and supports range queries.</li>
</ul>
<h2 id="understanding-indexes"><a class="header" href="#understanding-indexes">Understanding Indexes</a></h2>
<p>OrientDB can handle indexes in the same manner as classes, using the SQL language and prefixing the name with <code>index:</code> followed by the index name.  An index is like a class with two properties:</p>
<ul>
<li><code>key</code> The index key.</li>
<li><code>rid</code> The <a href="indexing/../datamodeling/Concepts.html#record-id">Record ID</a>, which points to the record associated with the key.</li>
</ul>
<h3 id="index-target"><a class="header" href="#index-target">Index Target</a></h3>
<p>OrientDB can use two methods to update indexes:</p>
<ul>
<li>
<p><strong>Automatic</strong> Where the index is bound to schema properties.  (For example, <code>User.id</code>.)  If you have a schema-less database and you want to create an automatic index, then you need to create the class and the property before using the index.</p>
</li>
<li>
<p><strong>Manual</strong> Where the index is handled by the application developer, using the Java API and SQL commands (see below).  You can use them as Persistent Maps, where the entry's value are the records pointed to by the index.</p>
</li>
</ul>
<p>You can rebuild automatic indexes using the <a href="indexing/../sql/SQL-Rebuild-Index.html"><code>REBUILD INDEX</code></a> command.</p>
<h3 id="index-types"><a class="header" href="#index-types">Index Types</a></h3>
<p>When you create an index, you create it as one of several available algorithm types.  Once you create an index, you cannot change its type.  OrientDB supports four index algorithms and several types within each.  You also have the option of using any third-party index algorithms available
through plugins.</p>
<ul>
<li><strong>SB-Tree Algorithm</strong>
<ul>
<li><code>UNIQUE</code> These indexes do not allow duplicate keys.  For composite indexes, this refers to the uniqueness of the composite keys.</li>
<li><code>NOTUNIQUE</code> These indexes allow duplicate keys.</li>
<li><code>FULLTEXT</code> These indexes are based on any single word of text.  You can use them in queries through the <code>CONTAINSTEXT</code> operator.</li>
<li><code>DICTIONARY</code> These indexes are similar to those that use <code>UNIQUE</code>, but in the case of duplicate keys, they replaces the existing record with the new record.</li>
</ul>
</li>
<li><strong>HashIndex Algorithm</strong>
<ul>
<li><code>UNIQUE_HASH_INDEX</code> These indexes do not allow duplicate keys.  For composite indexes, this refers to the uniqueness of the composite keys.  Available since version 1.5.x.</li>
<li><code>NOTUNIQUE_HASH_INDEX</code> These indexes allow duplicate keys.  Available since version 1.5.x.</li>
<li><code>FULLTEXT_HASH_INDEX</code> These indexes are based on any single word of text.  You can use them in queries through the <code>CONTAINSTEXT</code> operator.  Available since version 1.5.x.</li>
<li><code>DICTIONARY_HASH_INDEX</code> These indexes are similar to those that use <code>UNIQUE_HASH_INDEX</code>, but in cases of duplicate keys, they replaces the existing record with the new record.  Available since version 1.5.x.</li>
</ul>
</li>
<li><strong>HashIndex Algorithm</strong> (Since v2.2)
<ul>
<li><code>UNIQUE_HASH_INDEX</code> These indexes do not allow duplicate keys.  For composite indexes, this refers to the uniqueness of the composite keys.</li>
<li><code>NOTUNIQUE_HASH_INDEX</code> These indexes allow duplicate keys.</li>
</ul>
</li>
<li>
<ul>
<li><strong>Lucene Engine</strong></li>
<li><code>FULLTEXT</code> These indexes use the Lucene engine to index string content.  You can use them in queries with the <code>LUCENE</code> operator.</li>
<li><code>SPATIAL</code> These indexes use the Lucene engine to index geospatial coordinates.</li>
</ul>
</li>
</ul>
<p>Every database has a default manual index type <code>DICTIONARY</code>, which uses strings as keys.  You may find this useful in handling the root records of trees and graphs, and handling singleton records in configurations.</p>
<h3 id="indexes-and-null-values"><a class="header" href="#indexes-and-null-values">Indexes and Null Values</a></h3>
<p>Starting from v2.2, Indexes do not ignore NULL values, but they are indexes as any other values. This means that if you have a UNIQUE index, you cannot have multiple NULL keys. This applies only to the new indexes, opening a database with indexes previously created, will all ignore NULL by default.</p>
<p>To create an index that expressly ignore nulls (like the default with v2.1 and earlier), look at the following examples by using SQL or Java API.</p>
<p>SQL:</p>
<pre>
orientdb> <code class='lang-sql userinput'>CREATE INDEX addresses ON Employee (address) NOTUNIQUE METADATA {ignoreNullValues: true}
</code>
</pre>
<p>And Java API:</p>
<pre><code>schema.getClass("Employee").getProperty("address").createIndex(OClass.INDEX_TYPE.NOTUNIQUE, new ODocument().field("ignoreNullValues",true));
</code></pre>
<h3 id="indexes-and-composite-keys"><a class="header" href="#indexes-and-composite-keys">Indexes and Composite Keys</a></h3>
<p>Operations that work with indexes also work with indexes formed from composite keys.  By its nature, a composite key is  a collection of values, so, syntactically, it is a collection.</p>
<p>For example, consider a case where you have a class <code>Book</code>, indexed by three fields: <code>author</code>, <code>title</code> and <code>publicationYear</code>.  You might use the following query to look up an individual book:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM INDEX:books WHERE key = ["Donald Knuth", "The Art of Computer
          Programming", 1968]</code>
</pre>
<p>Alternatively, you can look for books over a range of years with the field <code>publicationYear</code>:</p>
<pre>
orientdb> <code class='lang-sql userinput'>SELECT FROM INDEX:books WHERE key BETWEEN ["Donald Knuth", "The Art of 
          Computer Programming", 1960] AND ["Donald Knuth", "The Art of Computer 
          Programming", 2000]</code>
</pre>
<h4 id="partial-match-searches"><a class="header" href="#partial-match-searches">Partial Match Searches</a></h4>
<p>Occasionally, you may need to search an index record by several fields of its composite key.  In these partial match searches, the remaining fields with undefined values can match any value in the result.</p>
<p>Only use composite indexes for partial match searches when the declared fields in the composite index are used from left to right.  For instance, from the example above searching only <code>title</code> wouldn't work with a composite index, since <code>title</code> is the second value.  But, you could use it when searching <code>author</code> and <code>title</code>.</p>
<p>For example, consider a case where you don't care when the books in your database were published.  This allows you to use a somewhat different query, to return all books with the same author and title, but from any publication year.</p>
<pre>
orientdb> <code class='lang-sql userinput'>SELECT FROM INDEX:books WHERE key = ["Donald Knuth", "The Art of Computer 
          Programming"]</code>
</pre>
<p>In the event that you also don't know the title of the work you want, you can further reduce it to only search all books with the same author.</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM INDEX:books WHERE key = ["Donald Knuth"]</code>
</pre>
<p>Or, the equal,</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM INDEX:books WHERE key = "Donald Knuth"</code>
</pre>
<h3 id="range-queries"><a class="header" href="#range-queries">Range Queries</a></h3>
<p>Not all the indexes support range queries (check above). In the case of range queries, the field subject to the range must be the last one, (that is, the one on the far right).  For example,</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM INDEX:books WHERE key BETWEEN ["Donald Knuth", "The Art of 
          Computer Programming", 1900] AND ["Donald Knuth", "The Art of Computer 
          Programming", 2014]</code>
</pre>
<h2 id="operations-against-indexes"><a class="header" href="#operations-against-indexes">Operations against Indexes</a></h2>
<p>Once you have a good understanding of the theoretical side of what indexes are and some of basic concepts that go into their use, it's time to consider the practical aspects of creating and using indexes with your application.</p>
<h3 id="creating-indexes"><a class="header" href="#creating-indexes">Creating Indexes</a></h3>
<p>When you have created the relevant classes that you want to index, create the index.  To create an automatic index, bound to a schema property, use the <code>ON</code> section or use the name in the <code>&lt;class&gt;.&lt;property&gt;</code> notation.</p>
<p><strong>Syntax:</strong></p>
<pre><code class="language-sql">CREATE INDEX &lt;name&gt; [ON &lt;class-name&gt; (prop-names)] &lt;type&gt; [&lt;key-type&gt;]
                    [METADATA {&lt;metadata&gt;}]
</code></pre>
<ul>
<li>
<p><code>&lt;name&gt;</code> Provides the logical name for the index.  You can also use the <code>&lt;class.property&gt;</code> notation to create an automatic index bound to a schema property.  In this case, for <code>&lt;class&gt;</code> use the class of the schema and <code>&lt;property&gt;</code> the property created in the class.</p>
<p>Bear in mind that this means case index names cannot contain the period (<code>.</code>) symbol, as OrientDB would interpret the text after as a property.</p>
</li>
<li>
<p><code>&lt;class-name&gt;</code> Provides the name of the class that you are creating the automatic index to index.  This class must already exist in the database.</p>
</li>
<li>
<p><code>&lt;prop-names&gt;</code> Provides a comma-separated list of properties, which you want the automatic index to index.  These properties must already exist in the schema.</p>
<p>If the property belongs to one of the Map types, (such as <code>LINKMAP</code>, or <code>EMBEDDEDMAP</code>), you can specify the keys or values to use in generating indexes.  You can do this with the <code>BY KEY</code> or <code>BY VALUE</code> expressions, if nothing is specified, these keys are used during index creation.</p>
</li>
<li>
<p><code>&lt;type&gt;</code> Provides the algorithm and type of index that you want to create.  For information on the supported index types, see <a href="indexing/Indexes.html#index-types">Index Types</a>.</p>
</li>
<li>
<p><code>&lt;key-type&gt;</code> Provides the optional key type.  With automatic indexes, the key type OrientDB automatically determines the key type by reading the target schema property where the index is created.  With manual indexes, if not specified, OrientDB automatically determines the key type at run-time, during the first insertion by reading the type of the class.</p>
</li>
<li>
<p><code>&lt;metadata&gt;</code> Provides a JSON representation</p>
</li>
</ul>
<p><strong>Examples:</strong></p>
<ul>
<li>
<p>Creating custom indexes, deprecated since 3.0:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE INDEX mostRecentRecords UNIQUE date</code>
</pre>
</li>
<li>
<p>Creating another index for the property <code>id</code> of the class <code>User</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE PROPERTY User.id BINARY</code>
orientdb> <code class="lang-sql userinput">CREATE INDEX indexForId ON User (id) UNIQUE</code>
</pre>
</li>
<li>
<p>Creating indexes for property <code>thumbs</code> on class <code>Movie</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE INDEX thumbsAuthor ON Movie (thumbs) UNIQUE</code>
orientdb> <code class="lang-sql userinput">CREATE INDEX thumbsAuthor ON Movie (thumbs BY KEY) UNIQUE</code>
orientdb> <code class="lang-sql userinput">CREATE INDEX thumbsValue on Movie (thumbs BY VALUE) UNIQUE</code>
</pre>
</li>
<li>
<p>Creating composite indexes:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE PROPERTY Book.author STRING</code>
orientdb> <code class="lang-sql userinput">CREATE PROPERTY Book.title STRING</code>
orientdb> <code class="lang-sql userinput">CREATE PROPERTY Book.publicationYears EMBEDDEDLIST INTEGER</code>
orientdb> <code class="lang-sql userinput">CREATE INDEX books ON Book (author, title, publicationYears) UNIQUE
</pre>
</li>
</ul>
<p>For more information on creating indexes, see the <a href="indexing/../sql/SQL-Create-Index.html"><code>CREATE INDEX</code></a> command.</p>
<h3 id="dropping-indexes"><a class="header" href="#dropping-indexes">Dropping Indexes</a></h3>
<p>In the event that you have an index that you no longer want to use, you can drop it from the database.  This operation does not remove linked records.</p>
<p><strong>Syntax:</strong></p>
<pre><code class="language-sql">DROP INDEX &lt;name&gt;
</code></pre>
<ul>
<li><code>&lt;name&gt;</code> provides the name of the index you want to drop.</li>
</ul>
<p>For more information on dropping indexes, see the <a href="indexing/../sql/SQL-Drop-Index.html"><code>DROP INDEX</code></a> command.</p>
<h3 id="querying-indexes"><a class="header" href="#querying-indexes">Querying Indexes</a></h3>
<p>When you have an index created and in use, you can query records in the index using the <a href="indexing/../sql/SQL-Query.html"><code>SELECT</code></a> command.</p>
<p><strong>Syntax:</strong></p>
<pre><code class="language-sql">SELECT FROM INDEX:&lt;index-name&gt; WHERE key = &lt;key&gt;
</code></pre>
<p><strong>Example:</strong></p>
<ul>
<li>
<p>Selecting from the index <code>dictionary</code> where the key matches to <code>Luke</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM INDEX:dictionary WHERE key='Luke'</code>
</pre>
</li>
</ul>
<h3 id="case-insensitive-matching-with-indexes"><a class="header" href="#case-insensitive-matching-with-indexes">Case-insensitive Matching with Indexes</a></h3>
<p>In the event that you would like the index to use case-insensitive matching, set the <code>COLLATE</code> attribute of the indexed properties to <code>ci</code>.  For instance,</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE INDEX OUser.name ON OUser (name COLLATE ci) UNIQUE</code>
</pre>
<h3 id="inserting-index-entries"><a class="header" href="#inserting-index-entries">Inserting Index Entries</a></h3>
<p>You can insert new entries into the index using the <code>key</code> and <code>rid</code> pairings.</p>
<p><strong>Syntax:</strong></p>
<pre><code class="language-sql">INSERT INTO INDEX:&lt;index-name&gt; (key,rid) VALUES (&lt;key&gt;,&lt;rid&gt;)
</code></pre>
<p><strong>Example:</strong></p>
<ul>
<li>
<p>Inserting the key <code>Luke</code> and Record ID <code>#10:4</code> into the index <code>dictionary</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">INSERT INTO INDEX:dictionary (key, rid) VALUES ('Luke', #10:4)</code>
</pre>
</li>
</ul>
<h3 id="querying-index-ranges"><a class="header" href="#querying-index-ranges">Querying Index Ranges</a></h3>
<p>In addition to querying single results from the index, you can also query a range of results between minimum and maximum values.  Bear in mind that not all index types support this operation.</p>
<p><strong>Syntax:</strong></p>
<pre><code class="language-sql">SELECT FROM INDEX:&lt;index-name&gt; WHERE key BETWEEN &lt;min&gt; AND &lt;max&gt;
</code></pre>
<p><strong>Example:</strong></p>
<ul>
<li>
<p>Querying from the index <code>coordinates</code> and range between <code>10.3</code> and <code>10.7</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM INDEX:coordinates WHERE key BETWEEN 10.3 AND 10.7</code>
</pre>
</li>
</ul>
<h3 id="removing-index-entries"><a class="header" href="#removing-index-entries">Removing Index Entries</a></h3>
<p>You can delete entries by passing the <code>key</code> and <code>rid</code> values.  This operation returns <code>TRUE</code> if the removal was successful and <code>FALSE</code> if the entry wasn't found.</p>
<p><strong>Syntax:</strong></p>
<pre><code class="language-sql">DELETE FROM INDEX:&lt;index-name&gt; WHERE key = &lt;key&gt; AND rid = &lt;rid&gt;
</code></pre>
<p><strong>Example:</strong></p>
<ul>
<li>
<p>Removing an entry from the index <code>dictionary</code>:</p>
<pre>
orientdb> <code class='lang-sql userinput'>DELETE FROM INDEX:dictionary WHERE key = 'Luke' AND rid = #10:4</code>
</pre>
</li>
</ul>
<h3 id="removing-index-entries-by-key"><a class="header" href="#removing-index-entries-by-key">Removing Index Entries by Key</a></h3>
<p>You can delete all entries from the index through the requested key.</p>
<p><strong>Syntax:</strong></p>
<pre><code class="language-sql">DELETE FROM INDEX:&lt;index-name&gt; WHERE key = &lt;key&gt;
</code></pre>
<p><strong>Example:</strong></p>
<ul>
<li>
<p>Delete entries from the index <code>addressbook</code> whee the key matches to <code>Luke</code>:</p>
<pre>
orientdb> <code class='lang-sql userinput'>DELETE FROM INDEX:addressbook WHERE key = 'Luke'</code>
</pre>
</li>
</ul>
<h3 id="removing-index-entries-by-rid"><a class="header" href="#removing-index-entries-by-rid">Removing Index Entries by RID</a></h3>
<p>You can remove all index entries to a particular record by its record ID.</p>
<p><strong>Syntax:</strong></p>
<pre><code class="language-sql">DELETE FROM INDEX:&lt;index-name&gt; WHERE rid = &lt;rid&gt;
</code></pre>
<p><strong>Example:</strong></p>
<ul>
<li>
<p>Removing entries from index <code>dictionary</code> tied to the record ID <code>#10:4</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">DELETE FROM INDEX:dictionary WHERE rid = #10:4
</pre>
</li>
</ul>
<h3 id="counting-index-entries"><a class="header" href="#counting-index-entries">Counting Index Entries</a></h3>
<p>To see the number of entries in a given index, you can use the <code>COUNT()</code> function.</p>
<p><strong>Syntax:</strong></p>
<pre><code class="language-sql">SELECT COUNT(*) AS size FROM INDEX:&lt;index-name&gt;
</code></pre>
<p><strong>Example:</strong></p>
<ul>
<li>
<p>Counting the entries on the index <code>dictionary</code>:</p>
<pre>
orientdb> <code class='lang-sql userinput'>SELECT COUNT(*) AS size FROM INDEX:dictionary</code>
</pre>
</li>
</ul>
<h3 id="querying-keys-from-indexes"><a class="header" href="#querying-keys-from-indexes">Querying Keys from Indexes</a></h3>
<p>You can query all keys in an index using the <a href="indexing/../sql/SQL-Query.html"><code>SELECT</code></a> command.</p>
<p><strong>Syntax:</strong></p>
<pre><code class="language-sql">SELECT key FROM INDEX:&lt;index-name&gt;
</code></pre>
<p><strong>Example:</strong></p>
<ul>
<li>
<p>Querying the keys in the index <code>dictionary</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT key FROM INDEX:dictionary</code>
</pre>
</li>
</ul>
<h3 id="querying-index-entries"><a class="header" href="#querying-index-entries">Querying Index Entries</a></h3>
<p>You can query for all entries on an index as <code>key</code> and <code>rid</code> pairs.</p>
<p><strong>Syntax:</strong></p>
<pre><code class="language-sql">SELECT key, value FROM INDEX:&lt;index-name&gt;
</code></pre>
<p><strong>Example:</strong></p>
<ul>
<li>
<p>Querying the <code>key</code>/<code>rid</code> pairs from the index <code>dictionary</code>:</p>
<pre>
orientdb> <code class='lang-sql userinput'>SELECT key, value FROM INDEX:dictionary</code>
</pre>
</li>
</ul>
<h3 id="clearing-indexes"><a class="header" href="#clearing-indexes">Clearing Indexes</a></h3>
<p>Remove all entries from an index.  After running this command, the index is empty.</p>
<p><strong>Syntax:</strong></p>
<pre><code class="language-sql">DELETE FROM INDEX:&lt;index-name&gt;
</code></pre>
<p><strong>Example:</strong></p>
<ul>
<li>
<p>Removing all entries from the index <code>dictionary</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">DELETE FROM INDEX:dictionary</code>
</pre>
</li>
</ul>
<h2 id="query-the-available-indexes"><a class="header" href="#query-the-available-indexes">Query the available indexes</a></h2>
<p>To access to the indexes, you can use <a href="indexing/../sql/SQL-Metadata.html#querying-the-available-indexes">SQL</a>.</p>
<h2 id="create-your-index-engine"><a class="header" href="#create-your-index-engine">Create your index engine</a></h2>
<p>Here you can find a guide how to create a <a href="indexing/../internals/Custom-Index-Engine.html">custom index engine</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sb-tree-index-algorithm"><a class="header" href="#sb-tree-index-algorithm">SB-Tree Index Algorithm</a></h1>
<p>This indexing algorithm provides a good mix of features, similar to the features available from other index types.  It is good for general use and is durable, transactional and supports range queries. There are four index types that utilize the SB-Tree index algorithm:</p>
<ul>
<li><code>UNIQUE</code> Does not allow duplicate keys, fails when it encounters duplicates.</li>
<li><code>NOTUNIQUE</code> Does allow duplicate keys.</li>
<li><code>FULLTEXT</code> Indexes to any single word of text.</li>
<li><code>DICTIONARY</code> Does not allow duplicate keys, overwrites when it encounters duplicates.</li>
</ul>
<blockquote>
<p>For more information on <code>FULLTEXT_HASH_INDEX</code>, see <a href="indexing/FullTextIndex.html">FullText Index</a>.</p>
</blockquote>
<p>The SB-Tree index algorithm is based on the <a href="https://en.wikipedia.org/wiki/B-tree">B-Tree index</a> algorithm.  It has been adapted with several optimizations, which relate to data insertion and range queries.  As is the case with all other tree-based indexes, SB-Tree index algorithm experiences <code>log(N)</code> complexity, but the base to this logarithm is about 500.</p>
<blockquote>
<p><strong>NOTE</strong>: There is an issue in the replacement of indexes based on B-Tree with those based on COLA Tree to avoid slowdowns introduced by random I/O operations.  For more information see <a href="https://github.com/orientechnologies/orientdb/issues/1756">Issue #1756</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hash-index-algorithm"><a class="header" href="#hash-index-algorithm">Hash Index Algorithm</a></h1>
<p>This indexing algorithm provides a fast lookup and is very light on disk usage.  It is durable and transactional, but does not support range queries. It is similar to a HashMap, which makes it faster on punctual lookups and it consumes less resources than other index types. The Hash index algorithm supports four index types, which have been available since version 1.5.x:</p>
<ul>
<li><code>UNIQUE_HASH_INDEX</code> Does not allow duplicate keys, it fails when it encounters duplicates.</li>
<li><code>NOTUNIQUE_HASH_INDEX</code> Does allow duplicate keys.</li>
<li><code>FULLTEXT_HASH_INDEX</code> Indexes to any single word.</li>
<li><code>DICTIONARY</code> Does not allow duplicate keys, it overwrites when it encounters duplicates.</li>
</ul>
<blockquote>
<p>For more information on <code>FULLTEXT_HASH_INDEX</code>, see <a href="indexing/FullTextIndex.html">FullText Index</a>.</p>
</blockquote>
<p>Hash indexes are able to perform index read operations in one I/O operation and write operations in a maximum of three I/O operations. The Hash Index algorithm is based on the <a href="http://en.wikipedia.org/wiki/Extendible_hashing">Extendible Hashing</a> algorithm.  Despite not providing support for range queries, it is noticeably faster than <a href="indexing/SB-Tree-index.html">SB-Tree Index Algorithms</a>, (about twice as fast when querying through ten million records).</p>
<blockquote>
<p><strong>NOTE</strong>:  There is an issue relating to the enhancement of Hash indexes to avoid slowdowns introduced by random I/O operations using LSM Tree approaches.  For more information, see <a href="https://github.com/orientechnologies/orientdb/issues/1757">Issue #1757</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="auto-sharding-index-algorithm"><a class="header" href="#auto-sharding-index-algorithm">Auto Sharding Index Algorithm</a></h1>
<p>(Since v2.2)</p>
<p>This indexing algorithm is based on the <a href="https://en.wikipedia.org/wiki/Distributed_hash_table">DHT concept</a>, where they keys are stored on different partition, based on the <a href="https://en.wikipedia.org/wiki/MurmurHash">Murmur3</a> hash function.</p>
<p>Auto Sharding Index supports the following index types:</p>
<ul>
<li><code>UNIQUE_HASH_INDEX</code> Does not allow duplicate keys, it fails when it encounters duplicates.</li>
<li><code>NOTUNIQUE_HASH_INDEX</code> Does allow duplicate keys.</li>
</ul>
<p>Under the hood, this index creates multiple <a href="indexing/Hash-Index.html">Hash Indexes</a>, one per cluster. So if you have 8 clusters for the class "Employee", this index will create, at the beginning, 8 <a href="indexing/Hash-Index.html">Hash Indexes</a>.</p>
<p>Since this index is based on the <a href="indexing/Hash-Index.html">Hash Index</a>, it's able to perform index read operations in one I/O operation and write operations in a maximum of three I/O operations. The Hash Index algorithm is based on the <a href="http://en.wikipedia.org/wiki/Extendible_hashing">Extendible Hashing</a> algorithm.  Despite not providing support for range queries, it is noticeably faster than <a href="indexing/SB-Tree-index.html">SB-Tree Index Algorithms</a>, (about twice as fast when querying through ten million records).</p>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<p>Create an index by passing "AUTOSHARDING" as index engine:</p>
<pre><code class="language-java">final OClass cls = db.createClass("Log");
cls.createProperty("key", OType.LONG);
cls.createIndex("idx_LogKey", OClass.INDEX_TYPE.UNIQUE.toString(),
    (OProgressListener) null, (ODocument) null, "AUTOSHARDING", new String[] { "key" });
</code></pre>
<h2 id="performance"><a class="header" href="#performance">Performance</a></h2>
<p>On multi-core hw, using this index instead of <a href="indexing/Hash-Index.html">Hash Index</a> gives about +50% more throughput on insertion on a 8 cores machine.</p>
<h2 id="distributed"><a class="header" href="#distributed">Distributed</a></h2>
<p>The fully distributed version of this index will be supported in v3.0. In v2.2 each node has own copy of the index with all the partitions.</p>
<h2 id="internals"><a class="header" href="#internals">Internals</a></h2>
<p>This is the algorithm for the <code>put(key,value)</code>:</p>
<pre><code>int partition = Murmur3_hash(key) % partitions;
getSubIndex(partition).put(key,value);
</code></pre>
<p>This is for the <code>value = get(key)</code>:</p>
<pre><code>int partition = Murmur3_hash(key) % partitions;
return getSubIndex(partition).get(key);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="fulltext-indexes"><a class="header" href="#fulltext-indexes">FullText Indexes</a></h1>
<p>The SB-Tree index algorithm provides support for FullText indexes.  These indexes allow you to index text as a single word and its radix.  FullText indexes are like having a search engine on your database.</p>
<blockquote>
<p><strong>NOTE</strong>: Bear in mind that there is a difference between <code>FULLTEXT</code> without the <code>LUCENE</code> operator, which uses a FullText index with the SB-Tree index algorithm and <code>FULLTEXT</code> with the <code>LUCENE</code> operator, which uses a FullText index through the Lucene Engine.</p>
<p>For more information on the latter, see <a href="indexing/Full-Text-Index.html">Lucene FullText Index</a>.</p>
</blockquote>
<h2 id="creating-fulltext-indexes"><a class="header" href="#creating-fulltext-indexes">Creating FullText Indexes</a></h2>
<p>If you want to create an index using the FullText SB-Tree index algorithm, you can do so using the <a href="indexing/../sql/SQL-Create-Index.html"><code>CREATE INDEX</code></a> command.</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE INDEX City.name ON City(name) FULLTEXT</code>
</pre>
<p>This creates a FullText index on the property <code>name</code> of the class <code>City</code>, using the default configuration.</p>
<h3 id="fulltext-index-parameters"><a class="header" href="#fulltext-index-parameters">FullText Index Parameters</a></h3>
<p>In the event that the default FullText Index configuration is not sufficient to your needs, there are a number of parameters available to fine tune how it generates the index.</p>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Default</th><th>Description</th></tr></thead><tbody>
<tr><td><code>indexRadix</code></td><td><code>TRUE</code></td><td>Word prefixes will be also index</td></tr>
<tr><td><code>ignoreChars</code></td><td><code>"</code></td><td>Chars to skip when indexing</td></tr>
<tr><td><code>separatorChars</code></td><td><code> \r\n\t:;,.&amp;#124;+*/\=!?[](.md)</code></td><td></td></tr>
<tr><td><code>minWordLength</code></td><td><code>3</code></td><td>Minimum word length to index</td></tr>
<tr><td><code>stopWords</code></td><td><code>the in a at as and or for his her him this that what which while up with be was were is</code></td><td>Stop words excluded from indexing</td></tr>
</tbody></table>
</div>
<p>To configure a FullText Index, from version 1.7 on, you can do so through the OrientDB console or the Java API.  When configuring the index from the console, use the <a href="indexing/../sql/SQL-Create-Index.html"><code>CREATE INDEX</code></a> command with the <code>METADATA</code> operator.</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE INDEX City.name ON City(name) FULLTEXT METADATA 
          {"indexRadix": true, "ignoreChars": "&", "separatorChars": " |()", 
          "minWordLength": 4, "stopWords": ["the", "of"]}</code>
</pre>
<p>Alternatively, you can configure the index in Java.</p>
<pre><code class="language-java">OClass city = db.getClass("City");
ODocument metadata = new ODocument();
metadata.field("indexRadix", true);
metadata.field("stopWords", Arrays.asList(new String[] { "the", "in", "a", "at" }));
metadata.field("separatorChars", " :;?[](.md)");
metadata.field("ignoreChars", "$&amp;");
metadata.field("minWordLength", 5);
city.createIndex("City.name", "FULLTEXT", null, metadata, null, new String[] { "name" });
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="lucene-fulltext-index"><a class="header" href="#lucene-fulltext-index">Lucene FullText Index</a></h1>
<p>In addition to the standard FullText Index, which uses the SB-Tree index algorithm, you can also create FullText indexes using the <a href="http://lucene.apache.org/">Lucene Engine</a> .
Apache LuceneTM is a high-performance, full-featured text search engine library written entirely in Java.
Check the <a href="http://lucene.apache.org/core/6_6_0/index.html">Lucene documentation</a> for a full overview of its capabilities.</p>
<h2 id="how-lucenes-works"><a class="header" href="#how-lucenes-works">How Lucene's works?</a></h2>
<p>Let's look at a sample corpus of five documents:</p>
<ul>
<li>My sister is coming for the holidays.</li>
<li>The holidays are a chance for family meeting.</li>
<li>Who did your sister meet?</li>
<li>It takes an hour to make fudge.</li>
<li>My sister makes awesome fudge.</li>
</ul>
<p>What does Lucene do? Lucene is a full text search library.
Search has two principal stages: indexing and retrieval.</p>
<p>During indexing, each document is broken into words, and the list of documents containing each word is stored in a list called the <em>postings list</em>.
The posting list for the word <em>my</em> is:</p>
<p><em>my</em> --&gt; 1,5</p>
<p>Posting list for others terms:</p>
<p><em>fudge</em> --&gt; 4,5</p>
<p><em>sister</em> --&gt; 1,2,3,5</p>
<p><em>fudge</em> --&gt; 4,5</p>
<p>The index consists of all the posting lists for the words in the corpus.
Indexing must be done before retrieval, and we can only retrieve documents that were indexed.</p>
<p>Retrieval is the process starting with a query and ending with a ranked list of documents.
Say the query is "my fudge".
In order to find matches for the query, we break it into the individual words, and go to the posting lists.
The full list of documents containing the keywords is [1,4,5].
Note that the query is broken into words (terms) and each term is matched with the terms in the index.
Lucene's default operator is <em>OR</em>, so it retrieves the documents tha contain <em>my</em> <em>OR</em> <em>fudge</em>.
If we want to retrieve documents that contain both <em>my</em> and <em>fudge</em>, rewrite the query: "+my +fudge".</p>
<p>Lucene doesn't work as a LIKE operator on steroids, it works on single terms. Terms are produced analyzing the provided text, so the right analyzer should be configured.
On the other side, it offers a complete query language, well documented <a href="https://lucene.apache.org/core/6_6_0/queryparser/org/apache/lucene/queryparser/classic/QueryParser.html">here</a>:</p>
<h2 id="index-creation"><a class="header" href="#index-creation">Index creation</a></h2>
<p>To create an index based on Lucene</p>
<pre><code class="lang-sql userinput">CREATE INDEX <name> ON <class-name> (prop-names) FULLTEXT ENGINE LUCENE [{json metadata}]</code></pre>
<p>The following SQL statement will create a FullText index on the property <code>name</code> for the class <code>City</code>, using the Lucene Engine.</p>
<pre><code class="lang-sql userinput">CREATE INDEX City.name ON City(name) FULLTEXT ENGINE LUCENE</code>
</pre>
<p>Indexes can also be created on <em>n</em>-properties.  For example, create an index on the properties <code>name</code> and <code>description</code> on the class <code>City</code>.</p>
<pre><code class="lang-sql userinput">CREATE INDEX City.name_description ON City(name, description)
          FULLTEXT ENGINE LUCENE</code></pre>
<p>When multiple properties should be indexed, define a <em>single multi-field index</em> over the class.
A single multi-field index needs less resources, such as file handlers.
Moreover, it is easy to write better Lucene queries.
The default analyzer used by OrientDB when a Lucene index is created is the <a href="https://lucene.apache.org/core/6_6_0/core/org/apache/lucene/analysis/standard/StandardAnalyzer.html">StandardAnalyzer</a>.
The StandardAnalyzer usually works fine with western languages, but Lucene offers analyzer for different languages and use cases.</p>
<h2 id="two-minutes-tutorial"><a class="header" href="#two-minutes-tutorial">Two minutes tutorial</a></h2>
<p>Open studio or console and create a sample dataset:</p>
<pre><code class="lang-sql userinput">CREATE CLASS Item;
CREATE PROPERTY Item.text STRING;
CREATE INDEX Item.text ON Item(text) FULLTEXT ENGINE LUCENE;
INSERT INTO Item (text) VALUES ('My sister is coming for the holidays.');
INSERT INTO Item (text) VALUES ('The holidays are a chance for family meeting.');
INSERT INTO Item (text) VALUES ('Who did your sister meet?');
INSERT INTO Item (text) VALUES ('It takes an hour to make fudge.');
INSERT INTO Item (text) VALUES ('My sister makes awesome fudge.');
</code></pre>
<p>Search all documents that contain <em>sister</em>:</p>
<pre><code class="lang-sql userinput">SELECT FROM Item WHERE SEARCH_CLASS("sister") = true</code></pre>
<p>Search all documents that contain <em>sister</em> <em>AND</em> <em>coming</em>:</p>
<pre><code class="lang-sql userinput">SELECT FROM Item WHERE SEARCH_CLASS("+sister +coming") = true</code></pre>
<p>Search all documents that contain <em>sister</em> but <em>NOT</em> <em>coming</em>:</p>
<pre><code class="lang-sql userinput">SELECT FROM Item WHERE SEARCH_CLASS("+sister -coming") = true</code></pre>
<p>Search all documents that contain the phrase <em>sister meet</em>:</p>
<pre><code class="lang-sql userinput">SELECT FROM Item WHERE SEARCH_CLASS(' "sister meet" ') = true</code></pre>
<p>Search all documents that contain terms starting with <em>meet</em>:</p>
<pre><code class="lang-sql userinput">SELECT FROM Item WHERE SEARCH_CLASS('meet*') = true</code></pre>
<p>To better understand how the query parser work, read carefully the official documentation and play with the above documents.</p>
<h2 id="customize-analyzers"><a class="header" href="#customize-analyzers">Customize Analyzers</a></h2>
<p>In addition to the StandardAnalyzer, full text indexes can be configured to use different analyzer by the <code>METADATA</code> operator through <a href="indexing/../sql/SQL-Create-Index.html"><code>CREATE INDEX</code></a>.</p>
<p>Configure the index on <code>City.name</code> to use the <code>EnglishAnalyzer</code>:</p>
<pre><code class="lang-sql userinput">CREATE INDEX City.name ON City(name)
            FULLTEXT ENGINE LUCENE METADATA {
                "analyzer": "org.apache.lucene.analysis.en.EnglishAnalyzer"
            }</code></pre>
<p>Configure the index on <code>City.name</code> to use different analyzers for indexing and querying.</p>
<pre><code class="lang-sql userinput">CREATE INDEX City.name ON City(name)
            FULLTEXT ENGINE LUCENE METADATA {
                "index": "org.apache.lucene.analysis.en.EnglishAnalyzer",
                "query": "org.apache.lucene.analysis.standard.StandardAnalyzer"
          }</code></pre>
<p><code>EnglishAnalyzer</code> will be used to analyze text while indexing and the <code>StandardAnalyzer</code> will be used to analyze query text.</p>
<p>A very detailed configuration, on multi-field index configuration, could be:</p>
<pre><code class="lang-sql userinput">CREATE INDEX Song.fulltext ON Song(name, lyrics, title, author, description)
            FULLTEXT ENGINE LUCENE METADATA {
                "default": "org.apache.lucene.analysis.standard.StandardAnalyzer",
                "index": "org.apache.lucene.analysis.core.KeywordAnalyzer",
                "query": "org.apache.lucene.analysis.standard.StandardAnalyzer",
                "name_index": "org.apache.lucene.analysis.standard.StandardAnalyzer",
                "name_query": "org.apache.lucene.analysis.core.KeywordAnalyzer",
                "lyrics_index": "org.apache.lucene.analysis.en.EnglishAnalyzer",
                "title_index": "org.apache.lucene.analysis.en.EnglishAnalyzer",
                "title_query": "org.apache.lucene.analysis.en.EnglishAnalyzer",
                "author_query": "org.apache.lucene.analysis.core.KeywordAnalyzer",
                "description_index": "org.apache.lucene.analysis.standard.StandardAnalyzer",
                "description_index_stopwords": [
                  "the",
                  "is"
                ]
            }</code></pre>
<p>With this configuration, the underlying Lucene index will works in different way on each field:</p>
<ul>
<li><em>name</em>: indexed with StandardAnalyzer, searched with KeywordAnalyzer (it's a strange choice, but possible)</li>
<li><em>lyrics</em>: indexed with EnglishAnalyzer, searched with default query analyzer StandardAnalyzer</li>
<li><em>title</em>:  indexed and searched with EnglishAnalyzer</li>
<li><em>author</em>: indexed and searched with KeywordAnalyzer</li>
<li><em>description</em>: indexed with StandardAnalyzer with a given set of stop-words that overrides the internal set</li>
</ul>
<p>Analysis is the foundation of Lucene. By default the StandardAnalyzer removes english stop-words and punctuation and lowercase the generated terms:</p>
<p><em>The holidays are a chance for family meeting!</em></p>
<p>Would produce</p>
<ul>
<li><em>holidays</em></li>
<li><em>are</em></li>
<li><em>chance</em></li>
<li><em>for</em></li>
<li><em>family</em></li>
<li><em>meeting</em></li>
</ul>
<p>Each analyzer has its set of stop-words and tokenize the text in a different way.
Read the full (documentation)[http://lucene.apache.org/core/6_6_0/].</p>
<h2 id="query-parser"><a class="header" href="#query-parser">Query parser</a></h2>
<p>It is possible to configure some behavior of the Lucene <a href="https://lucene.apache.org/core/6_6_0/queryparser/org/apache/lucene/queryparser/classic/QueryParser.html">query parser</a>
Query parser's behavior can be configured at index creation time and overridden at runtime.</p>
<h3 id="allow-leading-wildcard"><a class="header" href="#allow-leading-wildcard">Allow Leading Wildcard</a></h3>
<p>Lucene by default doesn't support leading wildcard: <a href="https://wiki.apache.org/lucene-java/LuceneFAQ#What_wildcard_search_support_is_available_from_Lucene.3F">Lucene wildcard support</a></p>
<p>It is possible to override this behavior with a dedicated flag on meta-data:</p>
<pre><code class="language-json">{
  "allowLeadingWildcard": true
}
</code></pre>
<pre><code class="lang-sql userinput">CREATE INDEX City.name ON City(name)
            FULLTEXT ENGINE LUCENE METADATA {
                "allowLeadingWildcard": true
            }</code></pre>
<p>Use this flag carefully, as stated in the Lucene FAQ:</p>
<blockquote>
<p>Note that this can be an expensive operation: it requires scanning the list of tokens in the index in its entirety to look for those that match the pattern.</p>
</blockquote>
<h3 id="disable-lower-case-on-terms"><a class="header" href="#disable-lower-case-on-terms">Disable lower case on terms</a></h3>
<p>Lucene's QueryParser applies a lower case filter on expanded queries by default. It is possible to override this behavior with a dedicated flag on meta-data:</p>
<pre><code class="language-json">{
  "lowercaseExpandedTerms": false
}
</code></pre>
<p>It is useful when used in pair with keyword analyzer:</p>
<pre><code class="lang-sql userinput">CREATE INDEX City.name ON City(name)
            FULLTEXT ENGINE LUCENE METADATA {
              "lowercaseExpandedTerms": false,
              "default" : "org.apache.lucene.analysis.core.KeywordAnalyzer"
            }</code></pre>
<p>With <em>lowercaseExpandedTerms</em> set to false, these two queries will return different results:</p>
<pre><code class="lang-sql userinput">SELECT from Person WHERE SEARCH_CLASS("NAME") = true

SELECT from Person WHERE WHERE SEARCH_CLASS("name") = true
</code></pre>
<h2 id="querying-lucene-fulltext-indexes"><a class="header" href="#querying-lucene-fulltext-indexes">Querying Lucene FullText Indexes</a></h2>
<p>OrientDB 3.0.x introduced search functions: <em>SEARCH_CLASS</em>, <em>SEARCH_FIELDS</em>, <em>SEARCH_INDEX</em>, <em>SEARCH_MORE</em>
Every function accepts as last, optional, parameter a JSON with additional configuration.</p>
<h3 id="search_class"><a class="header" href="#search_class">SEARCH_CLASS</a></h3>
<p>The best way to use the search capabilities of OrientDB is to define a single multi-fields index and use the <em>SEARCH_CLASS</em> function.
In case more than one full-text index are defined over a class, an error is raised in case of <em>SEARCH_CLASS</em> invocation.</p>
<p>Suppose to have this index</p>
<pre><code class="lang-sql userinput">CREATE INDEX City.fulltext ON City(name, description) FULLTEXT ENGINE LUCENE </code></pre>
<p>A query that retrieve cities with the name starting with cas and description containing the word beautiful:</p>
<pre><code class="lang-sql userinput">SELECT FROM City WHERE SEARCH_CLASS("+name:cas*  +description:beautiful") = true</code></pre>
<p>The function accepts metadata JSON as second parameter:</p>
<pre><code class="lang-sql userinput">SELECT FROM City WHERE SEARCH_CLASS("+name:cas*  +description:beautiful", {
    "allowLeadingWildcard": true ,
    "lowercaseExpandedTerms": false,
    "boost": {
        "name": 2
    },
    "highlight": {
        "fields": ["name"],
        "start": "<em>",
        "end": "</em>"
    }
}) = true
</code></pre>
<p>The query shows query parser's configuration overrides, boost of field <em>name</em> with highlight. Highlight and boost will be explained later.</p>
<h3 id="search_more"><a class="header" href="#search_more">SEARCH_MORE</a></h3>
<p>OrientDB exposes the Lucene's <em>more like this</em> capability with a dedicated function.</p>
<p>The first parameter is the array of RID of elements to be used to calculate similarity, the second parameter the usual metadata JSON used to tune the query behaviour.</p>
<pre><code class="lang-sql userinput">SELECT FROM City WHERE SEARCH_MORE([#25:2, #25:3],{'minTermFreq':1, 'minDocFreq':1} ) = true</code></pre>
<p>It is possible to use a query to gather RID of documents to be used to calculate similarity:</p>
<pre><code class="lang-sql userinput">SELECT FROM City
    let $a=(SELECT @rid FROM City WHERE name = 'Rome')
    WHERE SEARCH_MORE( $a, { 'minTermFreq':1, 'minDocFreq':1} ) = true</code></pre>
<p>Lucene's MLT has a lot of parameter, and all these are exposed through the metadata JSON: http://lucene.apache.org/core/6_6_0/queries/org/apache/lucene/queries/mlt/MoreLikeThis.html</p>
<ul>
<li><em>fieldNames</em>: array of field's names to be used to extract content</li>
<li><em>maxQueryTerms</em></li>
<li><em>minDocFreq</em></li>
<li><em>maxDocFreq</em></li>
<li><em>minTermFreq</em></li>
<li><em>boost</em></li>
<li><em>boostFactor</em></li>
<li><em>maxWordLen</em></li>
<li><em>minWordLen</em></li>
<li><em>maxNumTokensParsed</em></li>
<li><em>stopWords</em></li>
</ul>
<h3 id="query-parsers-runtime-configuration"><a class="header" href="#query-parsers-runtime-configuration">Query parser's runtime configuration</a></h3>
<p>It is possible to override the query parser's  configuration given at creation index time at runtime passing a json:</p>
<pre><code class="lang-sql userinput">SELECT from Person WHERE SEARCH_CLASS("bob",{
        "allowLeadingWildcard": true ,
        "lowercaseExpandedTerms": false
    } ) = true</code></pre>
<p>The same can be done for query analyzer, overriding the configuration given at index creation's time:</p>
<pre><code class="lang-sql userinput">SELECT from Person WHERE SEARCH_CLASS("bob",{
        "customAnalysis": true ,
        "query": "org.apache.lucene.analysis.standard.StandardAnalyzer",
        "name_query": "org.apache.lucene.analysis.en.EnglishAnalyzer"
    } ) = true
</code></pre>
<p>The <em>customAnalysis</em> flag is mandatory to enable the runtime configuration of query analyzers.
The runtime configuration is <em>per query</em> and it isn't stored nor reused for a subsequent query.
The custom configuration can be used with all the functions.</p>
<h3 id="search_index"><a class="header" href="#search_index">SEARCH_INDEX</a></h3>
<p>The <em>SEARCH_INDEX</em> function allows to execute the query on a single index. It is useful if more than one index are defined over a class.</p>
<pre><code class="lang-sql userinput">SELECT FROM City WHERE SEARCH_INDEX("City.name", "cas*") = true</code></pre>
<p>The function accepts a JSON as third parameter, as for <em>SEARCH_CLASS</em>.</p>
<h3 id="search_fields"><a class="header" href="#search_fields">SEARCH_FIELDS</a></h3>
<p>The <em>SEARCH_FIELDS</em> function allows to execute query over the index that is defined over one or more fields:</p>
<pre><code class="lang-sql userinput">SELECT FROM City WHERE SEARCH_FIELDS(["name", "description"], "name:cas* description:beautiful") = true</code></pre>
<p>The function accepts a JSON as third parameter, as for <em>SEARCH_CLASS</em>.</p>
<h3 id="numeric-and-date-range-queries"><a class="header" href="#numeric-and-date-range-queries">Numeric and date range queries</a></h3>
<p>If the index is defined over a numeric field (INTEGER, LONG, DOUBLE) or a date field (DATE, DATETIME), the engine supports <a href="http://lucene.apache.org/core/6_6_0/queryparser/org/apache/lucene/queryparser/classic/package-summary.html#Range_Searches">range queries</a>
Suppose to have a <code>City</code> class with a multi-field Lucene index defined:</p>
<pre><code class="lang-sql userinput">CREATE CLASS CITY EXTENDS V
CREATE PROPERTY CITY.name STRING
CREATE PROPERTY CITY.size INTEGER
CREATE INDEX City.name ON City(name,size) FULLTEXT ENGINE LUCENE
</code></pre>
<p>Then query using ranges:</p>
<pre><code class="lang-sql userinput">SELECT FROM City WHERE SEARCH_CLASS('name:cas* AND size:[15000 TO 20000]') = true</code></pre>
<p>Ranges can be applied to DATE/DATETIME field as well. Create a Lucene index over a property:</p>
<pre><code class="lang-sql userinput">CREATE CLASS Article EXTENDS V
CREATE PROPERTY Article.createdAt DATETIME
CREATE INDEX Article.createdAt  ON Article(createdAt) FULLTEXT ENGINE LUCENE
</code></pre>
<p>Then query to retrieve articles published only in a given time range:</p>
<pre><code class="lang-sql userinput">SELECT FROM Article WHERE SEARCH_CLASS('[201612221000 TO 201612221100]') =true</code></pre>
<h3 id="retrieve-the-score"><a class="header" href="#retrieve-the-score">Retrieve the Score</a></h3>
<p>When the lucene index is used in a query, the results set carries a context variable for each record representing the score.
To display the score add <code>$score</code> in projections.</p>
<pre>
<code class="lang-sql userinput">SELECT *,$score FROM V WHERE name LUCENE "test*"</code>
</pre>
<h3 id="highlighting"><a class="header" href="#highlighting">Highlighting</a></h3>
<p>OrientDB uses the Lucene's highlighter. Highlighting can be configured using the metadata JSON. The highlighted content of a field is returned in a dedicated field suffixed with <em>_hl</em>:</p>
<pre>
<code class="lang-sql userinput">SELECT name, $name_hl, description, $description_hl FROM City
WHERE SEARCH_CLASS("+name:cas*  +description:beautiful", {
    "highlight": {
        "fields": ["name", "description"],
        "start": "<em>",
        "end": "</em>"
    }
}) = true</code>
</pre>
<p>Parameters</p>
<ul>
<li><em>fields</em>: array of field names to be highlighted</li>
<li><em>start</em>: start delimiter for highlighted text (default &lt;B&gt;)</li>
<li><em>end</em>: end delimiter for highlighted text (default &lt;/B&gt;)</li>
<li><em>maxNumFragments</em>: maximum number of text's fragments to highlight</li>
</ul>
<h3 id="sorting"><a class="header" href="#sorting">Sorting</a></h3>
<p>Sorting uses <a href="https://lucene.apache.org/core/6_5_0/core/org/apache/lucene/document/SortedDocValuesField.html">SortedDocValuesField</a> which for too large string can cause <code>DocValuesField  is too large, must be &lt;= 32766</code> exception.</p>
<p>In order to disable sorting add the configuration on the metadata ad index creation (From OrientDB 3.0.24).</p>
<p>For all fields:</p>
<pre><code class="lang-sql userinput">CREATE INDEX City.name ON City(name)
            FULLTEXT ENGINE LUCENE METADATA {
                "*_index_sorted": false
            }</code></pre>
<p>For single field:</p>
<pre><code class="lang-sql userinput">CREATE INDEX City.name ON City(name)
            FULLTEXT ENGINE LUCENE METADATA {
                "name_index_sorted": false
            }</code></pre>
<p>Documents retrieved by a search call are ordered by their score. It is possible to configure the way the document are sorted.
Read carefully the official documentation about sorting : https://lucene.apache.org/core/6_6_1/core/org/apache/lucene/search/Sort.html</p>
<pre>
<code class="lang-sql userinput">SELECT name, description, size FROM City
WHERE SEARCH_CLASS("+name:cas*  +description:beautiful", {
    "sort": [ { 'field': 'size', reverse:true, type:'INT' }]
}) = true</code>
</pre>
<p>Sort over multiple fields is possible:</p>
<pre>
<code class="lang-sql userinput">SELECT name, description, size FROM City
WHERE SEARCH_CLASS("+name:cas*  +description:beautiful", {
    "sort": [
        { 'field': 'size', reverse:true, type:'INT' },
        { 'field': 'name', reverse:false, type:'STRING' },
        { reverse:false, type:'DOC' },
        ]
}) = true</code>
</pre>
<p>Sort configuration:</p>
<ul>
<li><em>field</em>: is the field name. Could be absent only if the sort type is DOC or INDEX</li>
<li><em>reverse</em>: if set to true, will sort for the given field in reverse order</li>
<li><em>type</em>: look to https://lucene.apache.org/core/6_6_1/core/org/apache/lucene/search/SortField.Type.html</li>
</ul>
<p><em>CUSTOM</em> type is not supported</p>
<h3 id="cross-class-search-enterprise-edition"><a class="header" href="#cross-class-search-enterprise-edition">Cross class search (Enterprise Edition)</a></h3>
<p>Bundled with the enterprise edition there's the <em>SEARCH_CROSS</em> function that is able to search over all the Lucene indexes defined on a database</p>
<p>Suppose to define two indexes:</p>
<pre><code class="lang-sql userinput">CREATE INDEX Song.title ON Song (title,author) FULLTEXT ENGINE LUCENE METADATA
CREATE INDEX Author.name on Author(name,score) FULLTEXT ENGINE LUCENE METADATA
</code></pre>
<p>Searching for a term on each class implies a lot of different queries to be aggregated.</p>
<p>The <em>SEARCH_CLASS</em> function automatically performs the given query on each full-text index configured inside the database.</p>
<pre><code class="lang-sql userinput">SELECT  EXPAND(SEARCH_CROSS('beautiful'))</code></pre>
<p>The query will be execute over all the indexes configured on each field.
It is possible to search over a given field of a certain class, just qualify the field names with their class name:</p>
<pre><code class="lang-sql userinput">SELECT  EXPAND(SEARCH_CROSS('Song.title:beautiful  Author.name:bob'))</code></pre>
<p>Another way is to use the metadata field <em>_CLASS</em> present in every index:</p>
<pre><code class="lang-sql userinput">SELECT expand(SEARCH_CROSS('(+_CLASS:Song +title:beautiful) (+_CLASS:Author +name:bob)') )</code></pre>
<p>All the options of a Lucene's query are allowed: inline boosting, phrase queries, proximity etc.</p>
<p>The function accepts a metadata JSON as second parameter:</p>
<pre><code class="lang-sql userinput">SELECT  EXPAND(SEARCH_CROSS('Author.name:bob Song.title:*tain', {"
   "allowLeadingWildcard" : true,
   "boost": {
        "Author.name": 2.0
        }
   }
)</code></pre>
<p>Highlight isn't supported yet.</p>
<h2 id="lucene-writer-fine-tuning-expert"><a class="header" href="#lucene-writer-fine-tuning-expert">Lucene Writer fine tuning (expert)</a></h2>
<p>It is possible to fine tune the behaviour of the underlying Lucene's IndexWriter</p>
<pre><code class="lang-sql userinput">CREATE INDEX City.name ON City(name)
    FULLTEXT ENGINE LUCENE METADATA {
        "directory_type": "nio",
        "use_compound_file": false,
        "ram_buffer_MB": "16",
        "max_buffered_docs": "-1",
        "max_buffered_delete_terms": "-1",
        "ram_per_thread_MB": "1024",
        "default": "org.apache.lucene.analysis.standard.StandardAnalyzer"
    }</code></pre>
<ul>
<li><em>directory_type</em>: configure the access type to the Lucene's index
<ul>
<li><em>nio</em> (<em>default)</em>: the index is opened with <em>NIOFSDirectory</em></li>
<li><em>mmap</em>:  the index is opened with <em>MMapDirectory</em></li>
<li><em>ram</em>: index will be created in memory with <em>RAMDirectory</em></li>
</ul>
</li>
<li><em>use_compound_file</em>: default is false</li>
<li><em>ram_buffer_MB</em>: size of the document's buffer in MB, default value is 16 MB (which means flush when buffered docs consume approximately 16 MB RAM)</li>
<li><em>max_buffered_docs</em>: size of the document's buffer in number of docs, disabled by default (because IndexWriter flushes by RAM usage by default)</li>
<li><em>max_buffered_delete_terms</em>: disabled by default (because IndexWriter flushes by RAM usage by default).</li>
<li><em>ram_per_thread_MB</em>: default value is 1945</li>
</ul>
<p>For a detailed explanation of config parameters and IndexWriter behaviour</p>
<ul>
<li>indexWriterConfig : https://lucene.apache.org/core/6_6_0/core/org/apache/lucene/index/IndexWriterConfig.html</li>
<li>indexWriter: https://lucene.apache.org/core/6_6_0/core/org/apache/lucene/index/IndexWriter.html</li>
</ul>
<h2 id="index-lifecycle"><a class="header" href="#index-lifecycle">Index lifecycle</a></h2>
<p>Lucene indexes are lazy. If the index is in idle mode, no reads and no writes, it will be closed.
Intervals are fully configurable.</p>
<ul>
<li><em>flushIndexInterval</em>: flushing index interval in milliseconds, default to 20000 (10s)</li>
<li><em>closeAfterInterval</em>: closing index interval in milliseconds, default to 120000 (12m)</li>
<li><em>firstFlushAfter</em>: first flush time in milliseconds, default to 10000 (10s)</li>
</ul>
<p>To configure the index lifecycle, just pass the parameters in the JSON of metadata:</p>
<pre><code class="lang-sql userinput">CREATE INDEX City.name ON City(name) FULLTEXT ENGINE LUCENE METADATA
{
  "flushIndexInterval": 200000,
  "closeAfterInterval": 200000,
  "firstFlushAfter": 20000
}
</code></pre>
<h2 id="create-index-using-the-java-api"><a class="header" href="#create-index-using-the-java-api">Create index using the Java API</a></h2>
<p>The FullText Index with the Lucene Engine is configurable through the Java API.</p>
<pre><code class="lang-java">OSchema schema = databaseDocumentTx.getMetadata().getSchema();
    OClass oClass = schema.createClass("Foo");
    oClass.createProperty("name", OType.STRING);
    oClass.createIndex("City.name", "FULLTEXT", null, null, "LUCENE", new String[] { "name"});
</code></pre>
<h3 id="the-lucene-operator-deprecated"><a class="header" href="#the-lucene-operator-deprecated">The LUCENE operator (deprecated)</a></h3>
<p><em>NOTE</em>: <em>LUCENE</em> operator is translated to <em>SEARCH_FIELDS</em> function, but it doesn't support the metadata JSON</p>
<p>You can query the Lucene FullText Index using the custom operator <code>LUCENE</code> with the <a href="http://lucene.apache.org/core/6_3_0/queryparser/org/apache/lucene/queryparser/classic/package-summary.html#package_description">Query Parser Syntax</a> from the Lucene Engine.</p>
<pre>
<code class='lang-sql userinput'>SELECT FROM V WHERE name LUCENE "test*"</code>
</pre>
<p>This query searches for <code>test</code>, <code>tests</code>, <code>tester</code>, and so on from the property <code>name</code> of the class <code>V</code>.
The query can use proximity operator <em>~</em>, the required (<em>+</em>) and prohibit (<em>-</em>) operators, phrase queries, regexp queries:</p>
<pre>
<code class='lang-sql userinput'>SELECT FROM Article WHERE content LUCENE "(+graph -rdbms) AND +cloud"</code>
</pre>
<h3 id="working-with-multiple-fields-deprecated"><a class="header" href="#working-with-multiple-fields-deprecated">Working with multiple fields (deprecated)</a></h3>
<p><em>NOTE</em>: define a single Lucene index on the class and use <em>SEARCH_CLASS</em> function</p>
<p>In addition to the standard Lucene query above, you can also query multiple fields.  For example,</p>
<pre>
<code class="lang-sql userinput">SELECT FROM Class WHERE [prop1, prop2] LUCENE "query"</code>
</pre>
<p>In this case, if the word <code>query</code> is a plain string, the engine parses the query using <a href="http://lucene.apache.org/core/6_3_0/queryparser/org/apache/lucene/queryparser/classic/MultiFieldQueryParser.html">MultiFieldQueryParser</a> on each indexed field.</p>
<p>To execute a more complex query on each field, surround your query with parentheses, which causes the query to address specific fields.</p>
<pre>
<code class="lang-sql userinput">SELECT FROM Article WHERE [content, author] LUCENE "(content:graph AND author:john)"</code>
</pre>
<p>Here, the engine parses the query using the <a href="http://lucene.apache.org/core/6_3_0/queryparser/org/apache/lucene/queryparser/classic/QueryParser.html">QueryParser</a></p>
<h2 id="creating-a-manual-lucene-index-deprecated"><a class="header" href="#creating-a-manual-lucene-index-deprecated">Creating a Manual Lucene Index (deprecated)</a></h2>
<p><em>NOTE</em>: avoid manual Lucene index</p>
<p>The Lucene Engine supports index creation without the need for a class.</p>
<p><strong>Syntax</strong>:</p>
<pre>
<code class="lang-sql userinput">CREATE INDEX <name> FULLTEXT ENGINE LUCENE  [<key-type>] [METADATA {<metadata>}]
</code>
</pre>
<p>For example, create a manual index using the <a href="indexing/../sql/SQL-Create-Index.html"><code>CREATE INDEX</code></a> command:</p>
<pre>
<code class="lang-sql userinput">CREATE INDEX Manual FULLTEXT ENGINE LUCENE STRING, STRING</code>
</pre>
<p>Once you have created the index <code>Manual</code>, you can insert values in index using the <a href="indexing/../sql/SQL-Insert.html"><code>INSERT INTO INDEX:...</code></a> command.</p>
<pre>
<code class="lang-sql userinput">INSERT INTO INDEX:Manual (key, rid) VALUES(['Enrico', 'Rome'], #5:0)</code>
</pre>
<p>You can then query the index through <a href="indexing/../sql/SQL-Query.html"><code>SELECT...FROM INDEX:</code></a>:</p>
<pre>
<code class="lang-sql userinput">SELECT FROM INDEX:Manual WHERE key LUCENE "Enrico"</code>
</pre>
<p>Manual indexes could be created programmatically using the Java API</p>
<pre><code class="lang-java">ODocument meta = new ODocument().field("analyzer", StandardAnalyzer.class.getName());
OIndex<?> index = databaseDocumentTx.getMetadata().getIndexManager()
     .createIndex("apiManual", OClass.INDEX_TYPE.FULLTEXT.toString(),
         new OSimpleKeyIndexDefinition(1, OType.STRING, OType.STRING), null, null, meta, OLuceneIndexFactory.LUCENE_ALGORITHM);

</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="lucene-spatial"><a class="header" href="#lucene-spatial">Lucene Spatial</a></h1>
<p>(Versions 2.2 and after only, otherwise look at <a href="indexing/Spatial-Index.html#legacy">Legacy</a> section)</p>
<p>Since v 3.0, this module is provided in-bundle with the main distribution (Community and Enterprise Editions).</p>
<h2 id="install"><a class="header" href="#install">Install</a></h2>
<p>In versions prior to v 3.0 the spatial plugin was a separate component and needed to be installed manually.
This is not the case in v 3.0, where the spatial plugin is included in the main distribution, so there is no need to install it.</p>
<h2 id="geometry-data"><a class="header" href="#geometry-data">Geometry Data</a></h2>
<p>OrientDB supports the following Geometry objects :</p>
<ul>
<li>Point (<strong>OPoint</strong>)</li>
<li>Line (<strong>OLine</strong>)</li>
<li>Polygon (<strong>OPolygon)</strong></li>
<li>MultiPoint (<strong>OMultiPoint</strong>)</li>
<li>MultiLine (<strong>OMultiline</strong>)</li>
<li>MultiPolygon (<strong>OMultiPolygon</strong>)</li>
<li>Geometry Collections</li>
</ul>
<p>OrientDB stores those objects like embedded documents with special classes.
The module creates abstract classes that represent each Geometry object type, and those classes
can be embedded in user defined classes to provide geospatial information.</p>
<p>Each spatial classes (Geometry Collection excluded) comes with field coordinates that will be used to store the geometry structure.
The "coordinates" field of a geometry object is composed of one position (Point), an array of positions (LineString or MultiPoint), an array of arrays of positions (Polygons, MultiLineStrings) or a multidimensional array of positions (MultiPolygon).</p>
<h3 id="geometry-data-example"><a class="header" href="#geometry-data-example">Geometry data Example</a></h3>
<p>Restaurants Domain</p>
<pre><code class="language-SQL">CREATE class Restaurant
CREATE PROPERTY Restaurant.name STRING
CREATE PROPERTY Restaurant.location EMBEDDED OPoint
</code></pre>
<p>To insert restaurants with location</p>
<p>From SQL</p>
<pre><code class="language-SQL">INSERT INTO  Restaurant SET name = 'Dar Poeta', location = {"@class": "OPoint","coordinates" : [12.4684635,41.8914114]}
</code></pre>
<p>or as an alternative, if you use <a href="https://it.wikipedia.org/wiki/Well-Known_Text">WKT</a> format you can use the function <code>ST_GeomFromText</code> to create the OrientDB geometry object.</p>
<pre><code class="language-SQL">INSERT INTO  Restaurant SET name = 'Dar Poeta', location = St_GeomFromText("POINT (12.4684635 41.8914114)")
</code></pre>
<p>From JAVA</p>
<pre><code class="language-JAVA">ODocument location = new ODocument("OPoint");
location.field("coordinates", Arrays.asList(12.4684635, 41.8914114));

ODocument doc = new ODocument("Restaurant");
doc.field("name","Dar Poeta");
doc.field("location",location);

doc.save();
</code></pre>
<p>A spatial index on the <em>location</em> field s defined by</p>
<pre><code class="language-SQL">CREATE INDEX Restaurant.location ON Restaurant(location) SPATIAL ENGINE LUCENE"
</code></pre>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<p>OrientDB follows The Open Geospatial Consortium <a href="http://www.opengeospatial.org/standards/sfs">OGC</a> for extending SQL to support spatial data.
OrientDB implements a subset of SQL-MM functions with ST prefix (Spatial Type)</p>
<h3 id="st_astext"><a class="header" href="#st_astext">ST_AsText</a></h3>
<p>Syntax : ST_AsText(geom)</p>
<p>Example</p>
<pre><code class="language-SQL">SELECT ST_AsText({"@class": "OPoint","coordinates" : [12.4684635,41.8914114]})

Result
----------
POINT (12.4684635 41.8914114)
</code></pre>
<h3 id="st_geomfromtext"><a class="header" href="#st_geomfromtext">ST_GeomFromText</a></h3>
<p>Syntax : ST_GeomFromText(text)</p>
<p>Example</p>
<pre><code class="language-SQL">select ST_GeomFromText("POINT (12.4684635 41.8914114)")

Result
----------------------------------------------------------------------------------
{"@type":"d","@version":0,"@class":"OPoint","coordinates":[12.4684635,41.8914114]}

</code></pre>
<h3 id="st_asgeojson"><a class="header" href="#st_asgeojson">ST_AsGeoJSON</a></h3>
<p>Syntax : ST_AsGeoJSON(geom)</p>
<p>Example</p>
<pre><code class="language-SQL">select ST_AsGeoJSON(ST_GeomFromText("POINT (12.4684635 41.8914114)"))

Result
----------
{"type":"Point","coordinates":[12.468464,41.891411]}
</code></pre>
<h3 id="st_geomfromgeojson"><a class="header" href="#st_geomfromgeojson">ST_GeomFromGeoJSON</a></h3>
<p>Syntax : ST_GeomFromGeoJSON(getJsonText)</p>
<p>Example</p>
<pre><code class="language-SQL">select ST_GeomFromGeoJSON('{"type":"Point","coordinates":[12.4684635,41.8914114]}')

Result
----------------------------------------------------------------------------------
{"@type":"d","@version":0,"@class":"OPoint","coordinates":[12.4684635,41.8914114]}



### ST_Equals

Returns true if geom1 is spatially equal to geom2

Syntax : ST_Equals(geom1,geom2)

Example
```SQL

SELECT ST_Equals(ST_GeomFromText('LINESTRING(0 0, 10 10)'), ST_GeomFromText('LINESTRING(0 0, 5 5, 10 10)'))

Result
-----------
true
</code></pre>
<h3 id="st_within"><a class="header" href="#st_within">ST_Within</a></h3>
<p>Returns true if geom1 is inside geom2</p>
<p>Syntax : ST_Within(geom1,geom2)</p>
<p>This function will use an index if available.</p>
<p>Example</p>
<pre><code class="language-SQL">select * from City where  ST_WITHIN(location,'POLYGON ((12.314015 41.8262816, 12.314015 41.963125, 12.6605063 41.963125, 12.6605063 41.8262816, 12.314015 41.8262816))') = true
</code></pre>
<h3 id="st_dwithin"><a class="header" href="#st_dwithin">ST_DWithin</a></h3>
<p>Returns true if the geometries are within the specified distance of one another</p>
<p>Syntax : ST_DWithin(geom1,geom2,distance)</p>
<p>Example</p>
<pre><code class="language-SQL">SELECT ST_DWithin(ST_GeomFromText('POLYGON((0 0, 10 0, 10 5, 0 5, 0 0))'), ST_GeomFromText('POLYGON((12 0, 14 0, 14 6, 12 6, 12 0))'), 2.0d) as distance
</code></pre>
<pre><code class="language-SQL">SELECT from Polygon where ST_DWithin(geometry, ST_GeomFromText('POLYGON((12 0, 14 0, 14 6, 12 6, 12 0))'), 2.0) = true
</code></pre>
<h3 id="st_contains"><a class="header" href="#st_contains">ST_Contains</a></h3>
<p>Returns true if geom1 contains geom2</p>
<p>Syntax : ST_Contains(geom1,geom2)</p>
<p>This function will use an index if available.</p>
<p>Example</p>
<pre><code class="language-SQL">SELECT ST_Contains(ST_Buffer(ST_GeomFromText('POINT(0 0)'),10),ST_GeomFromText('POINT(0 0)'))

Result
----------
true
</code></pre>
<pre><code class="language-SQL">SELECT ST_Contains(ST_Buffer(ST_GeomFromText('POINT(0 0)'),10),ST_Buffer(ST_GeomFromText('POINT(0 0)'),20))

Result
----------
false
</code></pre>
<h3 id="st_disjoint"><a class="header" href="#st_disjoint">ST_Disjoint</a></h3>
<p>Returns true if geom1 does not spatially intersects geom2</p>
<p>Syntax: St_Disjoint(geom1,geom2)</p>
<p>This function does not use indexes</p>
<p>Example</p>
<pre><code class="language-SQL">SELECT ST_Disjoint(ST_GeomFromText('POINT(0 0)'), ST_GeomFromText('LINESTRING ( 2 0, 0 2 )'));

Result
-----------------
true
</code></pre>
<pre><code class="language-SQL">SELECT ST_Disjoint(ST_GeomFromText('POINT(0 0)'), ST_GeomFromText('LINESTRING ( 0 0, 0 2 )'));

Result
-----------------
false
</code></pre>
<h3 id="st_intersects"><a class="header" href="#st_intersects">ST_Intersects</a></h3>
<p>Returns true if geom1 spatially intersects geom2</p>
<p>Syntax: ST_Intersects(geom1,geom2)</p>
<p>Example</p>
<pre><code class="language-SQL">SELECT ST_Intersects(ST_GeomFromText('POINT(0 0)'), ST_GeomFromText('LINESTRING ( 2 0, 0 2 )'));

Result
-------------
false
</code></pre>
<pre><code class="language-SQL">SELECT ST_Intersects(ST_GeomFromText('POINT(0 0)'), ST_GeomFromText('LINESTRING ( 0 0, 0 2 )'));

Result
-------------
true
</code></pre>
<h3 id="st_asbinary"><a class="header" href="#st_asbinary">ST_AsBinary</a></h3>
<p>Returns the Well-Known Binary (WKB) representation of the geometry</p>
<p>Syntax :  ST_AsBinary(geometry)</p>
<p>Example</p>
<pre><code class="language-SQL">SELECT ST_AsBinary(ST_GeomFromText('POINT(0 0)'))
</code></pre>
<h3 id="st_envelope"><a class="header" href="#st_envelope">ST_Envelope</a></h3>
<p>Returns a geometry representing the bounding box of the supplied geometry</p>
<p>Syntax : ST_Envelope(geometry)</p>
<p>Example</p>
<pre><code class="language-SQL">SELECT ST_AsText(ST_Envelope(ST_GeomFromText('POINT(1 3)')));

Result
----------
POINT (1 3)
</code></pre>
<pre><code class="language-SQL">SELECT ST_AsText(ST_Envelope(ST_GeomFromText('LINESTRING(0 0, 1 3)')))

Result
-----------------------------------
POLYGON ((0 0, 0 3, 1 3, 1 0, 0 0))
</code></pre>
<h3 id="st_buffer"><a class="header" href="#st_buffer">ST_Buffer</a></h3>
<p>Returns a geometry that represents all points whose distance from this Geometry is less than or equal to distance.</p>
<p>Syntax:  ST_Buffer(geometry,distance [,config])</p>
<p>where config is an additional parameter (JSON) that can be use to set:</p>
<p>quadSegs: int  -&gt;  number of segments used to approximate a quarter circle (defaults to 8).</p>
<pre><code class="language-JSON">{ 
  quadSegs : 1
}
</code></pre>
<p>endCap : round|flat|square -&gt;  endcap style (defaults to "round").</p>
<pre><code class="language-JSON">{
  endCap : 'square'
}
</code></pre>
<p>join : round|mitre|bevel  -&gt; join style (defaults to "round")</p>
<pre><code class="language-JSON">{ 
  join : 'bevel'
}
</code></pre>
<p>mitre : double  -&gt; mitre ratio limit (only affects mitered join style).</p>
<pre><code class="language-JSON">{ 
  join : 'mitre', 
  mitre : 5.0
}
</code></pre>
<p>Example</p>
<pre><code class="language-SQL">SELECT ST_AsText(ST_Buffer(ST_GeomFromText('POINT(100 90)'),50))
</code></pre>
<pre><code class="language-SQL">SELECT ST_AsText(ST_Buffer(ST_GeomFromText('POINT(100 90)'), 50, { quadSegs : 2 }));
</code></pre>
<h2 id="operators"><a class="header" href="#operators">Operators</a></h2>
<h3 id="a--b"><a class="header" href="#a--b">A &amp;&amp; B</a></h3>
<p>Overlaps operator. Returns true if bounding box of A overlaps bounding box of B.
This operator will use an index if available.</p>
<p>Example</p>
<pre><code class="language-SQL">CREATE CLASS TestLineString
CREATE PROPERTY TestLineString.location EMBEDDED OLineString
INSERT INTO TestLineSTring SET name = 'Test1' , location = St_GeomFromText("LINESTRING(0 0, 3 3)")
INSERT INTO TestLineSTring SET name = 'Test2' , location = St_GeomFromText("LINESTRING(0 1, 0 5)")
SELECT FROM TestLineString WHERE location &amp;&amp; "LINESTRING(1 2, 4 6)"
</code></pre>
<h2 id="spatial-indexes"><a class="header" href="#spatial-indexes">Spatial Indexes</a></h2>
<p>To speed up spatial search and match condition, spatial operators and functions can use a spatial index if defined to avoid sequential full scan of every records.</p>
<p>The current spatial index implementation is built upon lucene-spatial.</p>
<p>The syntax for creating a spatial index on a geometry field is :</p>
<pre><code class="language-SQL">CREATE INDEX &lt;name&gt; ON &lt;class-name&gt; (geometry-field) SPATIAL ENGINE LUCENE
</code></pre>
<h2 id="legacy"><a class="header" href="#legacy">Legacy</a></h2>
<p>Before v2.2, OrientDB was able to only index Points. Other Shapes like rectangles and polygons are managed starting from v2.2 (look above). This is the legacy section for databases created before v2.2.</p>
<h3 id="how-to-create-a-spatial-index"><a class="header" href="#how-to-create-a-spatial-index">How to create a Spatial Index</a></h3>
<p>The index can be created on a class that has two fields declared as <code>DOUBLE</code> (<code>latitude</code>,<code>longitude</code>) that are the coordinates of the Point.</p>
<p>For example we have a class <code>Place</code> with 2 double fields <code>latitude</code> and <code>longitude</code>.  To create the spatial index on <code>Place</code> use this syntax.</p>
<pre><code class="language-sql">CREATE INDEX Place.l_lon ON Place(latitude,longitude) SPATIAL ENGINE LUCENE
</code></pre>
<p>The Index can also be created with the Java Api. Example:</p>
<pre><code class="language-java">OSchema schema = databaseDocumentTx.getMetadata().getSchema();
OClass oClass = schema.createClass("Place");
oClass.createProperty("latitude", OType.DOUBLE);
oClass.createProperty("longitude", OType.DOUBLE);
oClass.createProperty("name", OType.STRING);
oClass.createIndex("Place.latitude_longitude", "SPATIAL", null, null, "LUCENE", new String[] { "latitude", "longitude" });
</code></pre>
<h3 id="how-to-query-the-spatial-index"><a class="header" href="#how-to-query-the-spatial-index">How to query the Spatial Index</a></h3>
<p>Two custom operators has been added to query the Spatial Index:</p>
<ol>
<li><code>NEAR</code>: to find all Points near a given location (<code>latitude</code>, <code>longitude</code>)</li>
<li><code>WITHIN</code>: to find all Points that are within a given Shape</li>
</ol>
<h4 id="near-operator"><a class="header" href="#near-operator">NEAR operator</a></h4>
<p>Finds all Points near a given location (<code>latitude</code>, <code>longitude</code>).</p>
<h5 id="syntax"><a class="header" href="#syntax">Syntax</a></h5>
<pre><code class="language-sql">SELECT FROM Class WHERE [&lt;lat-field&gt;,&lt;long-field&gt;] NEAR [lat,lon]
</code></pre>
<p>To specify <code>maxDistance</code> we have to pass a special variable in the context:</p>
<pre><code class="language-sql">SELECT FROM Class WHERE [&lt;lat-field&gt;,&lt;long-field&gt;,$spatial] NEAR [lat,lon,{"maxDistance": distance}]
</code></pre>
<p>The <code>maxDistance</code> field has to be in kilometers, not radians. Results are sorted from nearest to farthest.</p>
<p>To know the exact distance between your Point and the Points matched, use the special variable in the context
$distance.</p>
<pre><code class="language-sql">SELECT *, $distance FROM Class WHERE [&lt;lat-field&gt;,&lt;long-field&gt;,$spatial] NEAR [lat,lon,{"maxDistance": distance}]
</code></pre>
<h5 id="examples"><a class="header" href="#examples">Examples</a></h5>
<p>Let's take the example we have written before. We have a Spatial Index on Class <code>Place</code> on properties <code>latitude</code> and <code>longitude</code>.</p>
<p>Example: How to find the nearest Place of a given point:</p>
<pre><code class="language-sql">SELECT *,$distance FROM Place WHERE [latitude,longitude,$spatial] NEAR [51.507222,-0.1275,{"maxDistance":1}]
</code></pre>
<h4 id="within-operator"><a class="header" href="#within-operator">WITHIN operator</a></h4>
<p>Finds all Points that are within a given Shape.</p>
<div class="table-wrapper"><table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td><img src="indexing/../images/warning.png" alt="" /></td><td>The current release supports only <strong>Bounding Box</strong> shape</td></tr>
</tbody></table>
</div>
<h5 id="syntax-1"><a class="header" href="#syntax-1">Syntax</a></h5>
<pre><code class="language-sql">SELECT FROM Class WHERE [&lt;lat field&gt;,&lt;long field&gt;] WITHIN [ [ &lt;lat1&gt;, &lt;lon1&gt; ] , [ &lt;lat2&gt;, &lt;lon2&gt; ] ... ]
</code></pre>
<h5 id="examples-1"><a class="header" href="#examples-1">Examples</a></h5>
<p>Example with previous configuration:</p>
<pre><code class="language-sql">SELECT * FROM Places WHERE [latitude,longitude] WITHIN [[51.507222,-0.1275],[55.507222,-0.1275]]
</code></pre>
<p>This query will return all Places within the given Bounding Box.</p>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-11-26 SAM -->
<h1 id="managing-dates"><a class="header" href="#managing-dates">Managing Dates</a></h1>
<p>OrientDB treats dates as first class citizens. Internally, it saves dates in the <a href="https://en.wikipedia.org/wiki/Unix_time">Unix time</a> format.  Meaning, it stores dates as a <code>long</code> variable, which contains the count in milliseconds since the Unix Epoch, (that is, 1 January 1970).</p>
<h2 id="date-and-datetime-formats"><a class="header" href="#date-and-datetime-formats">Date and Datetime Formats</a></h2>
<p>In order to make the internal count from the Unix Epoch into something human readable, OrientDB formats the count into date and datetime formats.  By default, these formats are:</p>
<ul>
<li>Date Format: <code>yyyy-MM-dd</code></li>
<li>Datetime Format: <code>yyyy-MM-dd HH:mm:ss</code></li>
</ul>
<p>In the event that these default formats are not sufficient for the needs of your application, you can customize them through <a href="general/../sql/SQL-Alter-Database.html"><code>ALTER DATABASE...DATEFORMAT</code></a> and <a href="general/../sql/SQL-Alter-Database.html"><code>DATETIMEFORMAT</code></a> commands.  For instance,</p>
<pre>
orientdb> <code class="lang-sql userinput">ALTER DATABASE DATEFORMAT "dd MMMM yyyy"</code>
</pre>
<p>This command updates the current database to use the English format for dates.  That is, 14 Febr 2015.</p>
<h2 id="sql-functions-and-methods"><a class="header" href="#sql-functions-and-methods">SQL Functions and Methods</a></h2>
<p>To simplify the management of dates, OrientDB SQL automatically parses dates to and from strings and longs.  These functions and methods provide you with more control to manage dates:</p>
<div class="table-wrapper"><table><thead><tr><th>SQL</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="general/../sql/SQL-Functions.html#date"><code>DATE()</code></a></td><td>Function converts dates to and from strings and dates, also uses custom formats.</td></tr>
<tr><td><a href="general/../sql/SQL-Functions.html#sysdate"><code>SYSDATE()</code></a></td><td>Function returns the current date.</td></tr>
<tr><td><a href="general/../sql/SQL-Methods.html#format"><code>.format()</code></a></td><td>Method returns the date in different formats.</td></tr>
<tr><td><a href="general/../sql/SQL-Methods.html#asdate"><code>.asDate()</code></a></td><td>Method converts any type into a date.</td></tr>
<tr><td><a href="general/../sql/SQL-Methods.html#asdatetime"><code>.asDatetime()</code></a></td><td>Method converts any type into datetime.</td></tr>
<tr><td><a href="general/../sql/SQL-Methods.html#aslong"><code>.asLong()</code></a></td><td>Method converts any date into long format, (that is, Unix time).</td></tr>
</tbody></table>
</div>
<p>For example, consider a case where you need to extract only the years for date entries and to arrange them in order.  You can use the <a href="general/../sql/SQL-Methods.html#format"><code>.format()</code></a> method to extract dates into different formats.</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT @RID, id, date.format('yyyy') AS year FROM Order</code>

--------+----+------+
 @RID   | id | year |
--------+----+------+
 #31:10 | 92 | 2015 |
 #31:10 | 44 | 2014 |
 #31:10 | 32 | 2014 |
 #31:10 | 21 | 2013 |
--------+----+------+
</pre>
<p>In addition to this, you can also group the results. For instance, extracting the number of orders grouped by year.</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT date.format('yyyy') AS Year, COUNT(*) AS Total 
          FROM Order ORDER BY Year</code>

------+--------+
 Year |  Total |
------+--------+
 2015 |      1 |
 2014 |      2 |
 2013 |      1 |
------+--------+
</pre>
<h2 id="dates-before-1970"><a class="header" href="#dates-before-1970">Dates before 1970</a></h2>
<p>While you may find the default system for managing dates in OrientDB sufficient for your needs, there are some cases where it may not prove so.  For instance, consider a database of archaeological finds, a number of which date to periods not only before 1970 but possibly even before the Common Era.  You can manage this by defining an era or epoch variable in your dates.</p>
<p>For example, consider an instance where you want to add a record noting the date for the foundation of Rome, which is traditionally referred to as April 21, 753 BC.  To enter dates before the Common Era, first run the [<code>ALTER DATABASE DATETIMEFORMAT</code>] command to add the <code>GG</code> variable to use in referencing the epoch.</p>
<pre>
orientdb> <code class="lang-sql userinput">ALTER DATABASE DATETIMEFORMAT "yyyy-MM-dd HH:mm:ss GG"</code>
</pre>
<p>Once you've run this command, you can create a record that references date and datetime by epoch.</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE VERTEX V SET city = "Rome", date = DATE("0753-04-21 00:00:00 BC")</code>
orientdb> <code class="lang-sql userinput">SELECT @RID, city, date FROM V</code>

-------+------+------------------------+
 @RID  | city | date                   |
-------+------+------------------------+
 #9:10 | Rome | 0753-04-21 00:00:00 BC |
-------+------+------------------------+
</pre>
<h3 id="using-format-on-insertion"><a class="header" href="#using-format-on-insertion">Using <code>.format()</code> on Insertion</a></h3>
<p>In addition to the above method, instead of changing the date and datetime formats for the database, you can format the results as you insert the date.</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE VERTEX V SET city = "Rome", date = DATE("yyyy-MM-dd HH:mm:ss GG")</code>
orientdb> <code class="lang-sql userinput">SELECT @RID, city, date FROM V</code>

------+------+------------------------+
 @RID | city | date                   |
------+------+------------------------+
 #9:4 | Rome | 0753-04-21 00:00:00 BC |
------+------+------------------------+
</pre>
<p>Here, you again create a vertex for the traditional date of the foundation of Rome.  However, instead of altering the database, you format the date field in <a href="general/../sql/SQL-Create-Vertex.html"><code>CREATE VERTEX</code></a> command.</p>
<h3 id="viewing-unix-time"><a class="header" href="#viewing-unix-time">Viewing Unix Time</a></h3>
<p>In addition to the formatted date and datetime, you can also view the underlying count from the Unix Epoch, using the <a href="general/../sql/SQL-Methods.html#aslong"><code>asLong()</code></a> method for records.  For example,</p>
<pre>
orientdb> <code class='lang-sql userinput'>SELECT @RID, city, date.asLong() FROM #9:4</code>

------+------+------------------------+
 @RID | city | date                   |
------+------+------------------------+
 #9:4 | Rome | -85889120400000        |
------+------+------------------------+
</pre>
<p>Meaning that, OrientDB represents the date of April 21, 753 BC, as -85889120400000 in Unix time.  You can also work with dates directly as longs.</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE VERTEX V SET city = "Rome", date = DATE(-85889120400000)</code>
orientdb> <code class="lang-sql userinput">SELECT @RID, city, date FROM V</code>

-------+------+------------------------+
 @RID  | city | date                   |
-------+------+------------------------+
 #9:11 | Rome | 0753-04-21 00:00:00 BC |
-------+------+------------------------+
</pre>
<h3 id="use-iso-8601-dates"><a class="header" href="#use-iso-8601-dates">Use ISO 8601 Dates</a></h3>
<p>According to ISO 8601, Combined date and time in UTC: 2014-12-20T00:00:00. To use this standard change the datetimeformat in the database:</p>
<pre><code class="language-sql">ALTER DATABASE DATETIMEFORMAT "yyyy-MM-dd'T'HH:mm:ss.SSS'Z'"
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="transactions-1"><a class="header" href="#transactions-1">Transactions</a></h1>
<p>A transaction comprises a unit of work performed within a database management system (or similar system) against a database, and treated in a coherent and reliable way independent of other transactions. Transactions in a database environment have two main purposes:</p>
<ul>
<li>to provide reliable units of work that allow correct recovery from failures and keep a database consistent even in cases of system failure, when execution stops (completely or partially) and many operations upon a database remain uncompleted, with unclear status</li>
<li>to provide isolation between programs accessing a database concurrently. If this isolation is not provided, the program's outcome are possibly erroneous.</li>
</ul>
<p>A database transaction, by definition, must be <a href="internals/Transactions.html#atomicity">atomic</a>, <a href="internals/Transactions.html#consistency">consistent</a>, <a href="internals/Transactions.html#isolation">isolated</a> and <a href="internals/Transactions.html#durability">durable</a>. Database practitioners often refer to these properties of database transactions using the acronym <a href="internals/Transactions.html#acid-properties">ACID</a>.
--- <a href="http://en.wikipedia.org/wiki/Database_transaction">Wikipedia</a></p>
<p>OrientDB is an <a href="internals/Transactions.html#acid-properties">ACID</a> compliant DBMS.</p>
<blockquote>
<p><strong>NOTE</strong>: OrientDB keeps the transaction on client RAM, so the transaction size is affected by the available RAM (Heap memory) on JVM. For transactions involving many records, consider to split it in multiple transactions.</p>
</blockquote>
<h2 id="acid-properties"><a class="header" href="#acid-properties">ACID properties</a></h2>
<h3 id="atomicity"><a class="header" href="#atomicity">Atomicity</a></h3>
<p>"Atomicity requires that each transaction is 'all or nothing': if one part of the transaction fails, the entire transaction fails, and the database state is left unchanged. An atomic system must guarantee atomicity in each and every situation, including power failures, errors, and crashes. To the outside world, a committed transaction appears (by its effects on the database) to be indivisible ("atomic"), and an aborted transaction does not happen." - <a href="http://en.wikipedia.org/wiki/ACID">WikiPedia</a></p>
<h3 id="consistency"><a class="header" href="#consistency">Consistency</a></h3>
<p>"The consistency property ensures that any transaction will bring the database from one valid state to another. Any data written to the database must be valid according to all defined rules, including but not limited to constraints, cascades, triggers, and any combination thereof. This does not guarantee correctness of the transaction in all ways the application programmer might have wanted (that is the responsibility of application-level code) but merely that any programming errors do not violate any defined rules." - <a href="http://en.wikipedia.org/wiki/ACID">WikiPedia</a></p>
<p>OrientDB uses the MVCC to assure consistency. The difference between the management of MVCC on transactional and not-transactional cases is that with transactional, the exception rollbacks the entire transaction before to be caught by the application.</p>
<p>Look at this example:</p>
<div class="table-wrapper"><table><thead><tr><th>Sequence</th><th>Client/Thread 1</th><th>Client/Thread 2</th><th>Version of record X</th></tr></thead><tbody>
<tr><td>1</td><td>Begin of Transaction</td><td></td><td></td></tr>
<tr><td>2</td><td>read(x)</td><td></td><td>10</td></tr>
<tr><td>3</td><td></td><td>Begin of Transaction</td><td></td></tr>
<tr><td>4</td><td></td><td>read(x)</td><td>10</td></tr>
<tr><td>5</td><td></td><td>write(x)</td><td>10</td></tr>
<tr><td>6</td><td></td><td>commit</td><td>10 -&gt; 11</td></tr>
<tr><td>7</td><td>write(x)</td><td></td><td>10</td></tr>
<tr><td>8</td><td>commit</td><td></td><td>10 -&gt; 11 = Error, in database x already is at 11</td></tr>
</tbody></table>
</div>
<h3 id="isolation"><a class="header" href="#isolation">Isolation</a></h3>
<p>"The isolation property ensures that the concurrent execution of transactions results in a system state that would be obtained if transactions were executed serially, i.e. one after the other. Providing isolation is the main goal of concurrency control. Depending on concurrency control method, the effects of an incomplete transaction might not even be visible to another transaction." - <a href="http://en.wikipedia.org/wiki/ACID">WikiPedia</a></p>
<p>OrientDB has different levels of isolation based on settings and configuration:</p>
<ul>
<li><code>READ COMMITTED</code>, the default and the only one available with <code>remote</code> protocol</li>
<li><code>REPEATABLE READS</code>, allowed only with <code>plocal</code> and <code>memory</code> protocols. This mode consumes more memory than <code>READ COMMITTED</code>, because any read, query, etc. keep the records in memory to assure the same copy on further access</li>
</ul>
<p>To change default Isolation Level, use the Java API:</p>
<pre><code class="language-java">db.begin()
db.getTransaction().setIsolationLevel(OTransaction.ISOLATION_LEVEL.REPEATABLE_READ);
</code></pre>
<p>Using <code>remote</code> access all the commands are executed on the server, so out of transaction scope. Look below for more information.</p>
<p>Look at this examples:</p>
<p>|Sequence| Client/Thread 1 | Client/Thread 2 |
|-----|-----|-------|------|
|1| Begin of Transaction |  |
|2| read(x) |  |
|3|  | Begin of Transaction |
|4|  | read(x) |
|5|  |  write(x) |
|6|  |  commit |
|7| read(x)  |  |
|8| commit |  |</p>
<p>At operation 7 the client 1 continues to read the same version of x read in operation 2.</p>
<p>|Sequence| Client/Thread 1 | Client/Thread 2 |
|-----|-----|-------|------|
|1| Begin of Transaction |  |
|2| read(x) |  |
|3|  | Begin of Transaction |
|4|  | read(y) |
|5|  |  write(y) |
|6|  |  commit |
|7| read(y)  |  |
|8| commit |  |</p>
<p>At operation 7 the client 1 reads the version of y which was written at operation 6 by client 2. This is because it never reads y before.</p>
<p><strong>Breaking of ACID properties when using remote protocol and Commands (SQL, Gremlin, JS, etc)</strong></p>
<p>Transactions are client-side only until the commit. This means that if you're using the "remote" protocol the server can't see local changes.</p>
<p><img src="http://www.orientdb.org/images/transaction-remote.png" alt="Transaction in Remote context" /></p>
<p>In this scenario you can have different isolation levels with commands. This issue will be solved with OrientDB v3.0 where the transaction will be flushed to the server before to execute the command.</p>
<h3 id="durability"><a class="header" href="#durability">Durability</a></h3>
<p>"Durability means that once a transaction has been committed, it will remain so, even in the event of power loss, crashes, or errors. In a relational database, for instance, once a group of SQL statements execute, the results need to be stored permanently (even if the database crashes immediately thereafter). To defend against power loss, transactions (or their effects) must be recorded in a non-volatile memory." - <a href="http://en.wikipedia.org/wiki/ACID">WikiPedia</a></p>
<h4 id="fail-over"><a class="header" href="#fail-over">Fail-over</a></h4>
<p>An OrientDB instance can fail for several reasons:</p>
<ul>
<li>HW problems, such as loss of power or disk error</li>
<li>SW problems, such as a Operating System crash</li>
<li>Application problem, such as a bug that crashes your application that is  connected to the Orient engine.</li>
</ul>
<p>You can use the OrientDB engine directly in the same process of your application. This gives superior performance due to the lack of inter-process communication. In this case, should your application crash (for any reason), the OrientDB Engine also crashes.</p>
<p>If you're using an OrientDB Server connected remotely, if your application crashes the engine continue to work, but any pending transaction owned by the client will be rolled back.</p>
<h4 id="auto-recovery"><a class="header" href="#auto-recovery">Auto-recovery</a></h4>
<p>At start-up the OrientDB Engine checks to if it is restarting from a crash. In this case, the auto-recovery phase starts which rolls back all pending transactions.</p>
<p>OrientDB has different levels of durability based on storage type, configuration and settings.</p>
<h2 id="transaction-types"><a class="header" href="#transaction-types">Transaction types</a></h2>
<h3 id="no-transaction"><a class="header" href="#no-transaction">No Transaction</a></h3>
<p>Default mode. Each operation is executed instantly.</p>
<p>Calls to <code>begin()</code>,  <code>commit()</code> and  <code>rollback()</code> have no effect.</p>
<h3 id="optimistic-transaction"><a class="header" href="#optimistic-transaction">Optimistic Transaction</a></h3>
<p>This mode uses the well known <a href="http://en.wikipedia.org/wiki/Multiversion_concurrency_control">Multi Version Control System (MVCC)</a> by allowing multiple reads and writes on the same records. The integrity check is made on commit. If the record has been saved by another transaction in the interim, then an OConcurrentModificationException will be thrown. The application can choose either to repeat the transaction or abort it.</p>
<blockquote>
<p><strong>NOTE</strong>: OrientDB keeps the transaction on client RAM, so the transaction size is affected by the available RAM (Heap) memory on JVM. For transactions involving many records, consider to split it in multiple transactions.</p>
</blockquote>
<p>With <a href="internals/../java/Graph-Database-Tinkerpop.html#transactions">Graph API</a> transaction begins automatically, with Document API is explicit by using the <code>begin()</code> method. With Graphs you can change the <a href="internals/../java/Graph-Consistency.html">consistency level</a>.</p>
<p>Example with Document API:</p>
<pre><code class="language-java">db.open("remote:localhost:7777/petshop");

try{
  db.begin(TXTYPE.OPTIMISTIC);
  ...
  // WRITE HERE YOUR TRANSACTION LOGIC
  ...
  db.commit();
}catch( Exception e ){
  db.rollback();
} finally{
  db.close();
}
</code></pre>
<p>In Optimistic transaction new records take temporary <a href="internals/../datamodeling/Concepts.html#record-id">Record ID</a>s to avoid to ask to the server a new <a href="internals/../datamodeling/Concepts.html#record-id">Record ID</a> every time. Temporary <a href="internals/../datamodeling/Concepts.html#record-id">Record ID</a>s have Cluster Id -1 and Cluster Position &lt; -1. When a new transaction begun the counter is reset to -1:-2. So if you create 3 new records you'll have:</p>
<ul>
<li>-1:-2</li>
<li>-1:-3</li>
<li>-1:-4</li>
</ul>
<p>At commit time, these temporary records <a href="internals/../datamodeling/Concepts.html#record-id">Record ID</a>s will be converted in the final ones.</p>
<h3 id="pessimistic-transaction"><a class="header" href="#pessimistic-transaction">Pessimistic Transaction</a></h3>
<p>This mode is not yet supported by the engine.</p>
<h2 id="nested-transactions-and-propagation"><a class="header" href="#nested-transactions-and-propagation">Nested transactions and propagation</a></h2>
<p>OrientDB doesn't support nested transaction. If further <code>begin()</code> are called after a transaction is already begun, then the current transaction keeps track of call stack to let to the final commit() call to effectively commit the transaction. Look at <a href="internals/../java/Transaction-propagation.html">Transaction Propagation</a> more information.</p>
<h2 id="record-ids"><a class="header" href="#record-ids">Record IDs</a></h2>
<p>OrientDB uses temporary <a href="internals/../datamodeling/Concepts.html#record-id">Record ID's</a> with transaction as scope that will be transformed to finals once the transactions is successfully committed to the database. This avoid to ask for a free slot every time a client creates a record.</p>
<h2 id="tuning"><a class="header" href="#tuning">Tuning</a></h2>
<p>In some situations transactions can improve performance, typically in the client/server scenario. If you use an Optimistic Transaction, the OrientDB engine optimizes the network transfer between the client and server, saving both CPU and bandwidth.</p>
<p>For further information look at <a href="internals/../tuning/Performance-Tuning.html#wise-use-of-transactions">Transaction tuning</a> to know more.</p>
<h2 id="distributed-environment"><a class="header" href="#distributed-environment">Distributed environment</a></h2>
<p>Transactions can be committed across a distributed architecture. Look at <a href="internals/../distributed/Distributed-Architecture.html#distributed-transactions">Distributed Transactions</a> for more information.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="embed-the-server"><a class="header" href="#embed-the-server">Embed the Server</a></h1>
<p>Embedding an OrientDB Server inside a Java application has several advantages and interesting features:</p>
<ul>
<li>Java application that runs embedded with the server can bypass the remote connection and use the database directly with <a href="internals/../datamodeling/Concepts.html#database-url">local mode</a>. local and remote connections against the same database can work in concurrency: OrientDB will synchronize the access.</li>
<li>You can use the <a href="internals/../console/README.html">Console</a> to control it</li>
<li>You can use the <a href="internals/../studio/README.html">OrientDB Studio</a></li>
<li>You can replicate the database across distributed standalone or embedded servers</li>
</ul>
<p>To embed an OrientDB Server inside a Java application you have to create the <a href="internals/../java/ref/OServer.html"><code>OServer</code></a> object and use a valid configuration for it.</p>
<h2 id="requirements"><a class="header" href="#requirements">Requirements</a></h2>
<p>In order to embed the server you need to include the following jar files in the classpath:</p>
<ul>
<li><code>orientdb-client-**.jar</code></li>
<li><code>orientdb-core-**.jar</code></li>
<li><code>orientdb-server-**.jar</code></li>
<li><code>orientdb-tools-**.jar</code></li>
<li><code>concurrentlinkedhashmap-lru-**.jar</code></li>
<li><code>jna-**.jar</code></li>
<li><code>lz4-java-**.jar</code></li>
</ul>
<p>Starting from version 2.2, please set the <code>MaxDirectMemorySize</code> parameter. Setting this parameter is required. You can set it to a very high value, e.g. 512g (JVM setting):</p>
<pre><code>-XX:MaxDirectMemorySize=512g
</code></pre>
<p>Setting <code>MaxDirectMemorySize</code> to a very high value should not concern you as it does not mean that OrientDB will consume all 512GB of memory. The size of direct memory consumed by OrientDB is limited by the size of the disk cache (variable <a href="internals/../admin/Configuration.html"><code>storage.diskCache.bufferSize</code></a>).</p>
<p>When you start the Server using the provided <code>server.sh</code> or <code>server.bat</code> scripts, <code>MaxDirectMemorySize</code> is set already by those scripts. But when you embed the Server it is required that you set <code>MaxDirectMemorySize</code> manually.</p>
<p>Note: if you are using a pom file, you may set <code>MaxDirectMemorySize</code> inside your pom in the following way:</p>
<pre><code>&lt;properties&gt;
   &lt;argLine&gt;-XX:MaxDirectMemorySize=512g&lt;/argLine&gt;
&lt;/properties&gt;
</code></pre>
<p>If you start an embedded Server without setting this variable you will get a WARNING message similar to the following:</p>
<pre><code>MaxDirectMemorySize JVM option is not set or has invalid value, that may cause out of memory errors
</code></pre>
<h2 id="include-the-commands-you-need"><a class="header" href="#include-the-commands-you-need">Include the commands you need</a></h2>
<p>Even if most of the HTTP commands are auto registered assure to have all the commands you need. For example the static content must be registered. This is fundamental if you want to use OrientDB as Web Server providing static content like the Studio app:</p>
<pre><code class="language-xml">&lt;listener protocol="http" port-range="2480-2490" ip-address="0.0.0.0"&gt;
  &lt;commands&gt;
    &lt;command implementation="com.orientechnologies.orient.server.network.protocol.http.command.get.OServerCommandGetStaticContent" pattern="GET|www GET|studio/ GET| GET|*.htm GET|*.html GET|*.xml GET|*.jpeg GET|*.jpg GET|*.png GET|*.gif GET|*.js GET|*.css GET|*.swf GET|*.ico GET|*.txt GET|*.otf GET|*.pjs GET|*.svg"&gt;
      &lt;parameters&gt;
        &lt;entry value="Cache-Control: no-cache, no-store, max-age=0, must-revalidate\r\nPragma: no-cache" name="http.cache:*.htm *.html"/&gt;
        &lt;entry value="Cache-Control: max-age=120" name="http.cache:default"/&gt;
      &lt;/parameters&gt;
    &lt;/command&gt;
  &lt;/commands&gt;
&lt;/listener&gt;
</code></pre>
<h2 id="use-an-embedded-configuration"><a class="header" href="#use-an-embedded-configuration">Use an embedded configuration</a></h2>
<pre><code class="language-java">import com.orientechnologies.orient.server.OServerMain;

public class OrientDBEmbeddable {

 public static void main(String[] args) throws Exception {
  OServer server = OServerMain.create();
  server.startup(
   "&lt;?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?&gt;"
   + "&lt;orient-server&gt;"
   + "&lt;network&gt;"
   + "&lt;protocols&gt;"
   + "&lt;protocol name=\"binary\" implementation=\"com.orientechnologies.orient.server.network.protocol.binary.ONetworkProtocolBinary\"/&gt;"
   + "&lt;protocol name=\"http\" implementation=\"com.orientechnologies.orient.server.network.protocol.http.ONetworkProtocolHttpDb\"/&gt;"
   + "&lt;/protocols&gt;"
   + "&lt;listeners&gt;"
   + "&lt;listener ip-address=\"0.0.0.0\" port-range=\"2424-2430\" protocol=\"binary\"/&gt;"
   + "&lt;listener ip-address=\"0.0.0.0\" port-range=\"2480-2490\" protocol=\"http\"/&gt;"
   + "&lt;/listeners&gt;"
   + "&lt;/network&gt;"
   + "&lt;users&gt;"
   + "&lt;user name=\"root\" password=\"ThisIsA_TEST\" resources=\"*\"/&gt;"
   + "&lt;/users&gt;"
   + "&lt;properties&gt;"
   + "&lt;entry name=\"orientdb.www.path\" value=\"C:/work/dev/orientechnologies/orientdb/releases/1.0rc1-SNAPSHOT/www/\"/&gt;"
   + "&lt;entry name=\"orientdb.config.file\" value=\"C:/work/dev/orientechnologies/orientdb/releases/1.0rc1-SNAPSHOT/config/orientdb-server-config.xml\"/&gt;"
   + "&lt;entry name=\"server.cache.staticResources\" value=\"false\"/&gt;"
   + "&lt;entry name=\"log.console.level\" value=\"info\"/&gt;"
   + "&lt;entry name=\"log.file.level\" value=\"fine\"/&gt;"
   //The following is required to eliminate an error or warning "Error on resolving property: ORIENTDB_HOME"
   + "&lt;entry name=\"plugin.dynamic\" value=\"false\"/&gt;"
   + "&lt;/properties&gt;" + "&lt;/orient-server&gt;");
  server.activate();
  }
}
</code></pre>
<p>Once the embedded server is running, clients can connect using the remote connection method.  For example in the console, you can connect with:</p>
<pre><code>connect remote:localhost:{port}/{db} {user} {password}
where:
  port     : the port that the binary server listens on
             (first free port from 2424-2430 according to the configuration above)
  db       : the database name to connect to (defaults to "db" and can be set using &lt;entry name="server.database.path" value="db"/&gt; in the configuration
  user     : the user to connect with (this is NOT the same as root user in the configuration)
  password : the user to connect with (this is NOT the same as root password in the configuration)
</code></pre>
<h2 id="use-custom-file-for-configuration"><a class="header" href="#use-custom-file-for-configuration">Use custom file for configuration</a></h2>
<p>Use a regular <code>File</code>:</p>
<pre><code class="language-java">public class OrientDBEmbeddable {
  public static void main(String[] args) throws Exception {
      OServer server = OServerMain.create();
      server.startup(new File("/usr/local/temp/db.config"));
      server.activate();
  }
}
</code></pre>
<h2 id="use-a-stream-for-configuration"><a class="header" href="#use-a-stream-for-configuration">Use a stream for configuration</a></h2>
<p>Use an <code>InputStream</code> from the class loader:</p>
<pre><code class="language-java">public class OrientDBEmbeddable {
  public static void main(String[] args) throws Exception {
      OServer server = OServerMain.create();
      server.startup(getClass().getResourceAsStream("db.config"));
      server.activate();
  }
}
</code></pre>
<h2 id="use-a-oserverconfiguration-object-for-configuration"><a class="header" href="#use-a-oserverconfiguration-object-for-configuration">Use a OServerConfiguration object for configuration</a></h2>
<p>Or an <code>InputStream</code> from the class loader:</p>
<pre><code class="language-java">public class OrientDBEmbeddable {
  public static void main(String[] args) throws Exception {
      OServer server = OServerMain.create();
      OServerConfiguration cfg = new OServerConfiguration();
      // FILL THE OServerConfiguration OBJECT
      server.startup(cfg);
      server.activate();
  }
}
</code></pre>
<h2 id="shutdown"><a class="header" href="#shutdown">Shutdown</a></h2>
<p>OrientDB Server creates some threads internally as non-daemon, so they run even if the main application exits. Use the <a href="internals/../java/ref/OServer/shutdown.html"><code>OServer.shutdown()</code></a> method to shutdown the server in soft way:</p>
<pre><code class="language-java">import com.orientechnologies.orient.server.OServerMain;

public class OrientDBEmbeddable {

  public static void main(String[] args) throws Exception {
    OServer server = OServerMain.create();
    server.startup(new File("/usr/local/temp/db.config"));
    server.activate();
    ...
    server.shutdown();
  }
}
</code></pre>
<h2 id="setting-orientdb_home"><a class="header" href="#setting-orientdb_home">Setting ORIENTDB_HOME</a></h2>
<p>Some functionality will not work properly if the system property 'ORIENTDB_HOME' is not set. You can set it programmatically like this:</p>
<pre><code class="language-java">import com.orientechnologies.orient.server.OServerMain;

public class OrientDBEmbeddable {

  public static void main(String[] args) throws Exception {
    String orientdbHome = new File("").getAbsolutePath(); //Set OrientDB home to current directory
    System.setProperty("ORIENTDB_HOME", orientdbHome);

    OServer server = OServerMain.create();
    server.startup(cfg);
    server.activate();
  }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-plugins"><a class="header" href="#orientdb-plugins">OrientDB Plugins</a></h1>
<p>The OrientDB Server is a customizable platform to build powerful server component and applications.</p>
<p>Since the OrientDB server contains an integrated Web Server what about creating server side applications without the need to have a J2EE and Servlet container? By extending the server you can benefit of the best performance because you don't have many layers but the database and the application reside on the same JVM without the cost of the network and serialization of requests.</p>
<p>Furthermore you can package your application together with the OrientDB server to distribute just a ZIP file containing the entire Application, Web server and Database.</p>
<p>To customize the OrientDB server you have two powerful tools:</p>
<ul>
<li><a href="plugins/Extend-Server.html#handlers-server-plugins">Handlers</a></li>
<li><a href="plugins/Extend-Server.html#custom-commands">Custom commands</a></li>
</ul>
<p>To debug the server while you develop new feature follow <a href="plugins/Extend-Server.html#debug-the-server">Debug the server</a>.</p>
<h1 id="handlers-server-plugins"><a class="header" href="#handlers-server-plugins">Handlers (Server Plugins)</a></h1>
<p><strong>Handlers</strong> are plug-ins and starts when OrientDB starts.</p>
<p>To create a new handler create the class and register it in the OrientDB server configuration.</p>
<h2 id="create-the-handler-class"><a class="header" href="#create-the-handler-class">Create the Handler class</a></h2>
<p>A Handler must implements the OServerPlugin interface or extends the OServerPluginAbstract abstract class.</p>
<p>Below an example of a handler that print every 5 seconds a message if the "log" parameters has been configured to be "true":</p>
<pre><code class="language-java">package orientdb.test;

public class PrinterHandler extends OServerPluginAbstract {
  private boolean	log = false;

  public void config(OServer oServer, OServerParameterConfiguration[] iParams) {
    for (OServerParameterConfiguration p : iParams) {
      if (p.name.equalsIgnoreCase("log"))
        log = true;
    }

    Orient.getTimer().schedule( new TimerTask() {
      public void run() {
        if( log )
          System.out.println("It's the PrinterHandler!");
      }
    }, 5000, 5000);
  }

  public String getName() {
    return "PrinterHandler";
  }
}
</code></pre>
<h2 id="register-the-handler"><a class="header" href="#register-the-handler">Register the handler</a></h2>
<p>Once created, register it to the server configuration in <strong>orientdb-server-config.xml</strong> file:</p>
<pre><code class="language-xml">&lt;orient-server&gt;
  &lt;handlers&gt;
    &lt;handler class="orientdb.test.PrinterHandler"&gt;
      &lt;parameters&gt;
        &lt;parameter name="log" value="true"/&gt;
      &lt;/parameters&gt;
    &lt;/handler&gt;
  &lt;/handlers&gt;
  ...
</code></pre>
<p>Note that you can specify arbitrary parameters in form of name and value. Those parameters can be read by the <strong>config()</strong> method. In this example a parameter "log" is read. Look upon to the example of handler to know how to read parameters specified in configuration.</p>
<h2 id="steps-to-register-a-function-as-a-plugin-in-orientdb"><a class="header" href="#steps-to-register-a-function-as-a-plugin-in-orientdb">Steps to register a function as a Plugin in OrientDB</a></h2>
<p>In this case we'll create a plugin that only registers one function in OrientDB: <strong>pow</strong> (returns the value of the first argument raised to the power of the second argument). We'll also support <a href="http://en.wikipedia.org/wiki/Modular_exponentiation">Modular exponentiation</a>.</p>
<p>The syntax will be <code>pow(&lt;base&gt;, &lt;power&gt; [, &lt;mod&gt;])</code>.</p>
<ul>
<li>you should have a directory structure like this</li>
</ul>
<pre><code class="language-bash">    .
    ├─ src
    |   └─ main
    |       ├─ assembly
    |       |   └─ assembly.xml 
    |       ├─ java
    |       |   └─ com
    |       |       └─ app
    |       |           └─ OPowPlugin.java
    |       └─ resources
    |           └─ plugin.json 
    |
    └─ pom.xml 
</code></pre>
<h5 id="opowpluginjava"><a class="header" href="#opowpluginjava">OPowPlugin.java</a></h5>
<pre><code class="language-java">package com.app;

import com.orientechnologies.common.log.OLogManager;
import com.orientechnologies.orient.core.command.OCommandContext;
import com.orientechnologies.orient.core.db.record.OIdentifiable;
import com.orientechnologies.orient.core.sql.OSQLEngine;
import com.orientechnologies.orient.core.sql.functions.OSQLFunctionAbstract;
import com.orientechnologies.orient.server.OServer;
import com.orientechnologies.orient.server.config.OServerParameterConfiguration;
import com.orientechnologies.orient.server.plugin.OServerPluginAbstract;
import java.util.ArrayList;
import java.util.List;

public class OPowPlugin extends OServerPluginAbstract {

    public OPowPlugin() {
    }

    public String getName() {
        return "pow-plugin";
    }

    public void startup() {
        super.startup();
        OSQLEngine.getInstance().registerFunction("pow", new OSQLFunctionAbstract("pow", 2, 3) {

            public String getSyntax() {
                return "pow(&lt;base&gt;, &lt;power&gt; [, &lt;mod&gt;])";
            }

            public Object execute(Object iThis, OIdentifiable iCurrentRecord, Object iCurrentResult, final Object[] iParams, OCommandContext iContext) {
                if (iParams[0] == null || iParams[1] == null) {
                    return null;
                }
                if (!(iParams[0] instanceof Number) || !(iParams[1] instanceof Number)) {
                    return null;
                }

                final long base = ((Number) iParams[0]).longValue();
                final long power = ((Number) iParams[1]).longValue();

                if (iParams.length == 3) { // modular exponentiation
                    if (iParams[2] == null) {
                        return null;
                    }
                    if (!(iParams[2] instanceof Number)) {
                        return null;
                    }

                    final long mod = ((Number) iParams[2]).longValue();
                    if (power &lt; 0) {
                        OLogManager.instance().warn(this, "negative numbers as exponent are not supported");
                    }
                    return modPow(base, power, mod);
                }

                return power &gt; 0 ? pow(base, power) : 1D / pow(base, -power);
            }
        });
        OLogManager.instance().info(this, "pow function registered");
    }

    private double pow(long base, long power) {
        double r = 1;
        List&lt;Boolean&gt; bits = bits(power);
        for (int i = bits.size() - 1; i &gt;= 0; i--) {
            r *= r;
            if (bits.get(i)) {
                r *= base;
            }
        }

        return r;
    }

    private double modPow(long base, long power, long mod) {
        double r = 1;
        List&lt;Boolean&gt; bits = bits(power);
        for (int i = bits.size() - 1; i &gt;= 0; i--) {
            r = (r * r) % mod;
            if (bits.get(i)) {
                r = (r * base) % mod;
            }
        }

        return r;
    }

    private List&lt;Boolean&gt; bits(long n) {
        List&lt;Boolean&gt; bits = new ArrayList();
        while (n &gt; 0) {
            bits.add(n % 2 == 1);
            n /= 2;
        }

        return bits;
    }

    public void config(OServer oServer, OServerParameterConfiguration[] iParams) {

    }

    public void shutdown() {
        super.shutdown();
    }
}
</code></pre>
<h5 id="pomxml"><a class="header" href="#pomxml">pom.xml</a></h5>
<pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;com.app&lt;/groupId&gt;
    &lt;artifactId&gt;pow-plugin&lt;/artifactId&gt;
    &lt;version&gt;2.0.7&lt;/version&gt;
    &lt;packaging&gt;jar&lt;/packaging&gt;

    &lt;name&gt;pow-plugin&lt;/name&gt;

    &lt;properties&gt;
        &lt;orientdb.version&gt;2.0.7&lt;/orientdb.version&gt;
    &lt;/properties&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;
                &lt;version&gt;2.4&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;descriptors&gt;
                        &lt;descriptor&gt;src/main/assembly/assembly.xml&lt;/descriptor&gt;
                    &lt;/descriptors&gt;
                &lt;/configuration&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;id&gt;make-assembly&lt;/id&gt;
                        &lt;!-- this is used for inheritance merges --&gt;
                        &lt;phase&gt;package&lt;/phase&gt;
                        &lt;!-- bind to the packaging phase --&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;single&lt;/goal&gt;
                        &lt;/goals&gt;
                        &lt;configuration&gt;&lt;/configuration&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
                &lt;version&gt;3.1&lt;/version&gt;
                &lt;configuration&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
    
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.orientechnologies&lt;/groupId&gt;
            &lt;artifactId&gt;orientdb-core&lt;/artifactId&gt;
            &lt;version&gt;${orientdb.version}&lt;/version&gt;
            &lt;scope&gt;compile&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.orientechnologies&lt;/groupId&gt;
            &lt;artifactId&gt;orientdb-server&lt;/artifactId&gt;
            &lt;version&gt;${orientdb.version}&lt;/version&gt;
            &lt;scope&gt;compile&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/project&gt;
</code></pre>
<h5 id="assemblyxml"><a class="header" href="#assemblyxml">assembly.xml</a></h5>
<pre><code class="language-xml">&lt;assembly&gt;
    &lt;id&gt;dist&lt;/id&gt;
    &lt;formats&gt;
        &lt;format&gt;jar&lt;/format&gt;
    &lt;/formats&gt;
    &lt;includeBaseDirectory&gt;false&lt;/includeBaseDirectory&gt;
    &lt;dependencySets&gt;
        &lt;dependencySet&gt;
            &lt;outputDirectory/&gt;
            &lt;unpack&gt;true&lt;/unpack&gt;
            &lt;includes&gt;
                &lt;include&gt;${groupId}:${artifactId}&lt;/include&gt;
            &lt;/includes&gt;
        &lt;/dependencySet&gt;
    &lt;/dependencySets&gt;
&lt;/assembly&gt;
</code></pre>
<h5 id="pluginjson"><a class="header" href="#pluginjson">plugin.json</a></h5>
<pre><code class="language-json">{
	"name" : "pow-plugin",
	"version" : "2.0.7",
	"javaClass": "com.app.OPowPlugin",
	"parameters" : {},
	"description" : "The Pow Plugin",
	"copyrights" : "No copyrights"
}
</code></pre>
<ul>
<li>Build the project and then:</li>
</ul>
<pre><code class="language-bash">cp target/pow-plugin-2.0.7-dist.jar $ORIENTDB_HOME/plugins/
</code></pre>
<p>You should see the following in OrientDB server log:</p>
<pre><code class="language-bash">INFO  Installing dynamic plugin 'pow-plugin-2.0.7-dist.jar'... [OServerPluginManager]
INFO  pow function registered [OPowPlugin]
</code></pre>
<p>And now you can:</p>
<pre><code class="language-bash">orientdb {db=Pow}&gt; select pow(2,10)     

----+------+------
#   |@CLASS|pow   
----+------+------
0   |null  |1024.0
----+------+------

orientdb {db=Pow}&gt; select pow(2,10,5)

----+------+----
#   |@CLASS|pow 
----+------+----
0   |null  |4.0 
----+------+----

</code></pre>
<p>This small project is available <a href="https://www.dropbox.com/s/3o448vbyh5dwx38/pow-plugin.tar.gz?dl=0">here</a>.</p>
<h2 id="creating-a-distributed-change-manager"><a class="header" href="#creating-a-distributed-change-manager">Creating a distributed change manager</a></h2>
<p>As more complete example let's create a distributed record manager by installing hooks to all the server's databases and push these changes to the remote client caches.</p>
<pre><code class="language-java">public class DistributedRecordHook extends OServerHandlerAbstract implements ORecordHook {
  private boolean log = false;

  public void config(OServer oServer, OServerParameterConfiguration[] iParams) {
    for (OServerParameterConfiguration p : iParams) {
      if (p.name.equalsIgnoreCase("log"))
        log = true;
    }
  }

  public void onAfterClientRequest(final OClientConnection iConnection, final byte iRequestType) {
    if (iRequestType == OChannelBinaryProtocol.REQUEST_DB_OPEN)
      iConnection.database.registerHook(this);
    else if (iRequestType == OChannelBinaryProtocol.REQUEST_DB_CLOSE)
      iConnection.database.unregisterHook(this);
  }

  public boolean onTrigger(TYPE iType, ORecord&lt;?&gt; iRecord) {
    try {
      if (log)
        System.out.println("Broadcasting record: " + iRecord + "...");

      OClientConnectionManager.instance().broadcastRecord2Clients((ORecordInternal&lt;?&gt;) iRecord, null);
    } catch (Exception e) {
      e.printStackTrace();
    }
    return false;
  }

  public String getName() {
    return "DistributedRecordHook";
  }
}
</code></pre>
<h1 id="custom-commands"><a class="header" href="#custom-commands">Custom commands</a></h1>
<p>Custom commands are useful when you want to add behavior or business logic at the server side.</p>
<p>A Server command is a class that implements the <a href="https://github.com/orientechnologies/orientdb/blob/2.2.x/server/src/main/java/com/orientechnologies/orient/server/network/protocol/http/command/OServerCommand.java">OServerCommand</a> interface or extends one of the following abstract classes:</p>
<ul>
<li><a href="https://github.com/orientechnologies/orientdb/blob/2.2.x/server/src/main/java/com/orientechnologies/orient/server/network/protocol/http/command/OServerCommandAuthenticatedDbAbstract.java">OServerCommandAuthenticatedDbAbstract</a> if the command requires an authentication at the database</li>
<li><a href="https://github.com/orientechnologies/orientdb/blob/2.2.x/server/src/main/java/com/orientechnologies/orient/server/network/protocol/http/command/OServerCommandAuthenticatedServerAbstract.java">OServerCommandAuthenticatedServerAbstract</a> if the command requires an authentication at the server</li>
</ul>
<h2 id="the-hello-world-web"><a class="header" href="#the-hello-world-web">The Hello World Web</a></h2>
<p>To learn how to create a custom command, let's begin with a command that just returns "Hello world!".</p>
<p>OrientDB follows the convention that the command name is:</p>
<p><strong><code>OServerCommand&lt;method&gt;&lt;name&gt;</code></strong>
Where:</p>
<ul>
<li><strong>method</strong> is the HTTP method and can be: GET, POST, PUT, DELETE</li>
<li><strong>name</strong> is the command name</li>
</ul>
<p>In our case the class name will be "OServerCommandGetHello". We want that the use must be authenticated against the database to execute it as any user.</p>
<p>Furthermore we'd like to receive via configuration if we must display the text in Italic or not, so for this purpose we'll declare a parameter named "italic" of type boolean (true or false).</p>
<pre><code class="language-java">package org.example;

public class OServerCommandGetHello extends OServerCommandAuthenticatedDbAbstract {
  // DECLARE THE PARAMETERS
  private boolean italic = false;

  public OServerCommandGetHello(final OServerCommandConfiguration iConfiguration) {
    // PARSE PARAMETERS ON STARTUP
    for (OServerEntryConfiguration par : iConfiguration.parameters) {
      if (par.name.equals("italic")) {
        italic = Boolean.parseBoolean(par.value);
      }
    }
  }

  public boolean execute(final OHttpRequest iRequest, OHttpResponse iResponse) throws Exception {
    // CHECK THE SYNTAX. 3 IS THE NUMBER OF MANDATORY PARAMETERS
    String[] urlParts = checkSyntax(iRequest.url, 3, "Syntax error: hello/&lt;database&gt;/&lt;name&gt;");

    // TELLS TO THE SERVER WHAT I'M DOING (IT'S FOR THE PROFILER)
    iRequest.data.commandInfo = "Salutation";
    iRequest.data.commandDetail = "This is just a test";

    // GET THE PARAMETERS
    String name = urlParts[2];

    // CREATE THE RESULT
    String result = "Hello " + name;
    if (italic) {
      result = "&lt;i&gt;" + result + "&lt;/i&gt;";
    }

    // SEND BACK THE RESPONSE AS TEXT
    iResponse.send(OHttpUtils.STATUS_OK_CODE, "OK", null, result, OHttpUtils.CONTENT_TEXT_PLAIN);

    // RETURN ALWAYS FALSE, UNLESS YOU WANT TO EXECUTE COMMANDS IN CHAIN
    return false;
  }

  public String[] getNames() {
    return new String[]{"GET|hello/*","POST|hello/*"};
  }
}
</code></pre>
<p>Once created the command you need to register them through the <strong>orientdb-server-config.xml</strong> file. Put a new tag <code>&lt;command&gt;</code> under the tag <code>commands</code> of <code>&lt;listener&gt;</code> with attribute <code>protocol="http"</code>:</p>
<pre><code class="language-java">  ...
  &lt;listener protocol="http" port-range="2480-2490" ip-address="0.0.0.0"&gt;
    &lt;commands&gt;
      &lt;command implementation="org.example.OServerCommandGetHello" pattern="GET|hello/*"&gt;
        &lt;parameters&gt;
          &lt;entry name="italic" value="true"/&gt;
        &lt;/parameters&gt;
      &lt;/command&gt;
    &lt;/commands&gt;
  &lt;/listener&gt;
</code></pre>
<p>Where:</p>
<ul>
<li><strong>implementation</strong> is the full class name of the command</li>
<li><strong>pattern</strong> is how the command is called in the format: <code>&lt;HTTP-method&gt;|&lt;name&gt;</code>. In this case it's executed on HTTP GET with the URL: <code>/&lt;name&gt;</code></li>
<li><strong>parameters</strong> specify parameters to pass to the command on startup</li>
<li><strong>entry</strong> is the parameter pair name/value</li>
</ul>
<p>To test it open a browser at this address:</p>
<pre><code class="language-java">http://localhost:2480/hello/&lt;your-db-name&gt;/Luca
</code></pre>
<p>You will see:</p>
<pre><code class="language-java">Hello Luca
</code></pre>
<h2 id="complete-example"><a class="header" href="#complete-example">Complete example</a></h2>
<p>Below a more complex example taken by official distribution. It is the command that executes queries via HTTP. Note how to get a database instance to execute operation against the database:</p>
<pre><code class="language-java">public class OServerCommandGetQuery extends OServerCommandAuthenticatedDbAbstract {
  private static final String[] NAMES = { "GET|query/*" };

  public boolean execute(OHttpRequest iRequest, OHttpResponse iResponse) throws Exception {
    String[] urlParts = checkSyntax(
        iRequest.url,
        4,
        "Syntax error: query/&lt;database&gt;/sql/&lt;query-text&gt;[/&lt;limit&gt;][/&lt;fetchPlan&gt;].&lt;br/&gt;Limit is optional and is setted to 20 by default. Set expressly to 0 to have no limits.");

    int limit = urlParts.length &gt; 4 ? Integer.parseInt(urlParts[4]) : 20;
    String fetchPlan = urlParts.length &gt; 5 ? urlParts[5] : null;
    String text = urlParts[3];

    iRequest.data.commandInfo = "Query";
    iRequest.data.commandDetail = text;

    ODatabaseDocumentTx db = null;

    List&lt;OIdentifiable&gt; response;

    try {
      db = getProfiledDatabaseInstance(iRequest);
      response = (List&lt;OIdentifiable&gt;) db.command(new OSQLSynchQuery&lt;OIdentifiable&gt;(text, limit).setFetchPlan(fetchPlan)).execute();

    } finally {
      if (db != null) {
        db.close();
      }
    }

    iResponse.writeRecords(response, fetchPlan);
    return false;
  }

  public String[] getNames() {
    return NAMES;
  }
}
</code></pre>
<h1 id="include-jars-in-the-classpath"><a class="header" href="#include-jars-in-the-classpath">Include JARS in the classpath</a></h1>
<p>If your extensions need additional libraries put the additional jar files under the <strong><code>/lib</code></strong> folder of the server installation.</p>
<h1 id="debug-the-server"><a class="header" href="#debug-the-server">Debug the server</a></h1>
<p>To debug your plugin you can start your server in debug mode.</p>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Value</th></tr></thead><tbody>
<tr><td>Main class</td><td><code>com.orientechnologies.orient.server.OServerMain</code></td></tr>
<tr><td>JVM parameters</td><td><code>-server -DORIENTDB_HOME=/opt/orientdb -Dorientdb.www.path=src/site -Djava.util.logging.config.file=${ORIENTDB_HOME}/config/orientdb-server-log.properties -Dorientdb.config.file=${ORIENTDB_HOME}/config/orientdb-server-config.xml</code></td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="automatic-backup-server-plugin"><a class="header" href="#automatic-backup-server-plugin">Automatic Backup Server Plugin</a></h1>
<p>Using this server plugin, OrientDB executes regular backups on the databases.  It implements the Java class:</p>
<pre><code class="language-java">com.orientechnologies.orient.server.handler.OAutomaticBackup
</code></pre>
<h2 id="plugin-configuration"><a class="header" href="#plugin-configuration">Plugin Configuration</a></h2>
<p>Beginning with version 2.2, OrientDB manages the server plugin configuration from a separate JSON.  You can update this file manually or through OrientDB Studio.</p>
<p>To enable automatic backups, use the following <code>&lt;handler&gt;</code> section in the <code>config/orientdb-server-config.xml</code> configuration file:</p>
<pre><code class="language-xml">&lt;!-- AUTOMATIC BACKUP, TO TURN ON SET THE 'ENABLED' PARAMETER TO 'true' --&gt;
&lt;handler class="com.orientechnologies.orient.server.handler.OAutomaticBackup"&gt;
    &lt;parameters&gt;
        &lt;parameter name="enabled" value="false"/&gt;
        &lt;!-- LOCATION OF JSON CONFIGURATION FILE --&gt;
        &lt;parameter name="config" value="${ORIENTDB_HOME}/config/automatic-backup.json"/&gt;
    &lt;/parameters&gt;
&lt;/handler&gt;
</code></pre>
<p>This section tells the OrientDB server to read the file at <code>$ORIENTDB_HOME/config/automatic-backup.json</code> for the automatic backup configuration.</p>
<pre><code class="language-json">{
  "enabled": true,
  "mode": "FULL_BACKUP",
  "exportOptions": "",
  "delay": "4h",
  "firstTime": "23:00:00",
  "targetDirectory": "backup",
  "targetFileName": "${DBNAME}-${DATE:yyyyMMddHHmmss}.zip",
  "compressionLevel": 9,
  "bufferSize": 1048576
}
</code></pre>
<ul>
<li><strong><code>"enabled"</code></strong> Defines whether it uses automatic backups.  The supported values are:
<ul>
<li><em><code>true</code></em> Enables automatic backups.</li>
<li><em><code>false</code></em> Disables automatic backups.  This is the default setting.</li>
</ul>
</li>
<li><strong><code>"mode"</code></strong> Defines the backup mode.  The supported values are:
<ul>
<li><em><code>"FULL_BACKUP"</code></em> Executes a full backup.  Prior to version 2.2, this was the only mode available.  This operation blocks the database.</li>
<li><em><code>"INCREMENTAL_BACKUP"</code></em> Executes an <a href="plugins/../admin/Incremental-Backup-And-Restore.html">incremental backup</a>.  This is available only in the <a href="plugins/../ee/Enterprise-Edition.html">Enterprise Edition</a>.  It uses one directory per database.  This operation doesn't block the database.</li>
<li><em><code>"EXPORT"</code></em> Executes an database export, using gziped JSON format. This operation is not blocking.</li>
</ul>
</li>
<li><strong><code>"exportOptions"</code></strong> Defines export options to use with that mode.  This feature was introduced in version 2.2.</li>
<li><strong><code>"delay"</code></strong> Defines the delay time for each backup.  Supports the following suffixes:
<ul>
<li><em><code>ms</code></em> Delay measured in milliseconds.</li>
<li><em><code>s</code></em> Delay measured in seconds.</li>
<li><em><code>m</code></em> Delay measured in minutes.</li>
<li><em><code>h</code></em> Delay measured in hours.</li>
<li><em><code>d</code></em> Delay measured in days.</li>
</ul>
</li>
<li><strong><code>"firstTime"</code></strong> Defines when to initiate the first backup in the schedule.  It uses the format of <code>HH:mm:ss</code> in the GMT time zone, on the current day.</li>
<li><strong><code>"targetDirectory"</code></strong> Defines the target directory to write backups.  By default, it is set to the <code>backup/</code> directory.</li>
<li><strong><code>"targetFileName"</code></strong> Defines the target filename.  This parameter supports the use of the following variables, (that is, <code>"${DBNAME}-backup.zip"</code> produces <code>mydatabase-backup.zip</code>):
<ul>
<li><em><code>${DBNAME}</code></em> Renders the database name.</li>
<li><em><code>${DATE}</code></em> Renders the current date, using the <a href="http://download.oracle.com/javase/1,5.0/docs/api/java/text/SimpleDateFormat.html">Java DateTime syntax</a> format.</li>
</ul>
</li>
<li><strong><code>"dbInclude"</code></strong> Defines in a list the databases to include in the automatic backups.  If empty, it backs up all databases.</li>
<li><strong><code>"dbExclude"</code></strong> Defines in a list the databases to exclude from the automatic backups.</li>
<li><strong><code>"bufferSize"</code></strong> Defines the in-memory buffer sizes to use in compression.  By default, it is set to <code>1MB</code>.  Larger buffers mean faster backups, but they in turn consume more RAM.</li>
<li><strong><code>"compressionLevel"</code></strong> Defines the compression level for the resulting ZIP file.  By default it is set to the maximum level of <code>9</code>.  Set it to a lower value if you find that the backup takes too much time.</li>
</ul>
<h2 id="legacy-plugin-configuration"><a class="header" href="#legacy-plugin-configuration">Legacy Plugin Configuration</a></h2>
<p>In versions prior to 2.2, the only option in configuring automatic backups is to use the <code>config/orientdb-server-config.xml</code> configuration file.   Beginning with version 2.2 you can manage automatic backup configuration through a separate JSON file or use the legacy approach.</p>
<p>The example below configures automatic backups/exports on the database as a <a href="plugins/../internals/DB-Server.html#plugins">Server Plugin</a>.</p>
<pre><code class="language-xml">&lt;!-- AUTOMATIC BACKUP, TO TURN ON SET THE 'ENABLED' PARAMETER TO 'true' --&gt;
&lt;handler class="com.orientechnologies.orient.server.handler.OAutomaticBackup"&gt;
  &lt;parameters&gt;
    &lt;parameter name="enabled" value="false" /&gt;
     &lt;!-- CAN BE: FULL_BACKUP, INCREMENTAL_BACKUP, EXPORT --&gt;
     &lt;parameter name="mode" value="FULL_BACKUP"/&gt;
     &lt;!-- OPTION FOR EXPORT --&gt;
     &lt;parameter name="exportOptions" value=""/&gt;
    &lt;parameter name="delay" value="4h" /&gt;
    &lt;parameter name="target.directory" value="backup" /&gt;
    &lt;!-- ${DBNAME} AND ${DATE:} VARIABLES ARE SUPPORTED --&gt;
    &lt;parameter name="target.fileName" value="${DBNAME}-${DATE:yyyyMMddHHmmss}.zip" /&gt;
    &lt;!-- DEFAULT: NO ONE, THAT MEANS ALL DATABASES. 
	     USE COMMA TO SEPARATE MULTIPLE DATABASE NAMES --&gt;
    &lt;parameter name="db.include" value="" /&gt;
    &lt;!-- DEFAULT: NO ONE, THAT MEANS ALL DATABASES. 
	     USE COMMA TO SEPARATE MULTIPLE DATABASE NAMES --&gt;
    &lt;parameter name="db.exclude" value="" /&gt;
    &lt;parameter name="compressionLevel" value="9"/&gt;
    &lt;parameter name="bufferSize" value="1048576"/&gt;
  &lt;/parameters&gt;
&lt;/handler&gt;
</code></pre>
<ul>
<li><strong><code>enabled</code></strong> Defines whether it uses automatic backups.  Supported values are:
<ul>
<li><em><code>true</code></em> Enables automatic backups.</li>
<li><em><code>false</code></em> Disables automatic backups.  This is the default setting.</li>
</ul>
</li>
<li><strong><code>mode/&gt;</code></strong> Defines the backup mode.  Supported values are:
<ul>
<li><em><code>FULL_BACKUP</code></em> Executes a full backup.  For versions prior to 2.2, this is the only option available.  This operation blocks the database.</li>
<li><em><code>INCREMENTAL_BACKUP</code></em> Executes an incremental backup.  Uses one directory per database.  This operation doesn't block the database.</li>
<li>*<code>EXPORT</code> Executes an export of the database in gzipped JSON format, instead of a backup.  This operation doesn't block the database.</li>
</ul>
</li>
<li><strong><code>exportOptions</code></strong> Defines export options to use with that mode.  This feature was introduced in version 2.2.</li>
<li><strong><code>delay</code></strong> Defines the delay time.  Supports the following suffixes:
<ul>
<li><em><code>ms</code></em> Delay measured in milliseconds.</li>
<li><em><code>s</code></em> Delay measured in seconds.</li>
<li><em><code>m</code></em> Delay measured in minutes.</li>
<li><em><code>h</code></em> Delay measured in hours.</li>
<li><em><code>d</code></em> Delay measured in days.</li>
</ul>
</li>
<li><strong><code>firstTime</code></strong> Defines when to initiate the first backup in the schedule.  It uses the format of <code>HH:mm:ss</code> in the GMT time zone, on the current day.</li>
<li><strong><code>target.directory</code></strong> Defines the target directory to write backups.  By default, it is set to the <code>backup/</code> directory.</li>
<li><strong><code>target.fileName</code></strong> Defines the target file name.  The parameter supports the use of the following variables, (that is, <code>&lt;parameter name="target.filename" value="${DBNAME}-backup.zip"/&gt;</code> produces a <code>mydatabase-backup.zip</code> file).
<ul>
<li><em><code>${DBNAME}</code></em> Renders the database name.</li>
<li><em><code>${DATE}</code></em> Renders the current date, using the <a href="http://download.oracle.com/javase/1,5.0/docs/api/java/text/SimpleDateFormat.html">Java DateTime syntax</a> format.</li>
</ul>
</li>
<li><strong><code>db.include</code></strong> Defines in a list the databases to include in the automatic backups.  If left empty, it backs up all databases.</li>
<li><strong><code>db.exclude</code></strong> Defines in a list the databases to exclude from automatic backups.</li>
<li><strong><code>bufferSize</code></strong> Defines the in-memory buffer sizes to use in compression.  By default it is set to <code>1MB</code>.  Larger buffers mean faster backups, but use more RAM.  This feature was introduced in version 1.7.</li>
<li><strong><code>compressionLevel</code></strong> Defines the compression level for the resulting ZIP file.  By default, it is set to the maximum level of <code>9</code>.  Set it to a lower value if you find that the backup takes too much time.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="syslog-plugin"><a class="header" href="#syslog-plugin">SysLog Plugin</a></h1>
<p>Java class implementation:</p>
<pre><code class="language-java">com.orientechnologies.security.syslog.ODefaultSyslog
</code></pre>
<p>Available since: <strong>v. 2.2.0</strong>.</p>
<h2 id="introduction-2"><a class="header" href="#introduction-2">Introduction</a></h2>
<p>Allows sending event logs to the <a href="https://en.wikipedia.org/wiki/Syslog">Operating System's SYSLOG daemon</a>.</p>
<h2 id="configuration"><a class="header" href="#configuration">Configuration</a></h2>
<p>This plugin is configured as a <a href="plugins/../internals/DB-Server.html#plugins">Server plugin</a>. The plugin can be easily configured by changing parameters in the <code>orientdb-server-config.xml</code> file.:</p>
<table>
  <tr><th>Name</th><th>Description</th><th>Type</th><th>Example</th><th>Since</th></tr>
  <tr><td>enabled</td><td>true to turn on, false (default) is turned off</td><td>boolean</td><td>true</td><td>2.2.0</td></tr>
  <tr><td>debug</td><td>Enables debug mode</td><td>boolean</td><td>false</td><td>2.2.0</td></tr>
  <tr><td>hostname</td><td>The hostname of the syslog daemon</td><td>string</td><td>localhost</td><td>2.2.0</td></tr>
  <tr><td>port</td><td>The UDP port of the syslog daemon</td><td>integer</td><td>514</td><td>2.2.0</td></tr>
  <tr><td>appName</td><td>The name of the application submitting the events to SysLog</td><td>string</td><td>OrientDB</td><td>2.2.0</td></tr>
</table>
<p>Default configuration in <code>orientdb-server-config.xml</code>. Example:</p>
<pre><code class="language-xml">&lt;!-- SYS LOG CONNECTOR, TO TURN ON SET THE 'ENABLED' PARAMETER TO 'true' --&gt;
&lt;handler class="com.orientechnologies.security.syslog.ODefaultSyslog"&gt;
    &lt;parameters&gt;
        &lt;parameter name="enabled" value="true"/&gt;
        &lt;parameter name="debug" value="false"/&gt;
        &lt;parameter name="hostname" value="localhost"/&gt;
        &lt;parameter name="port" value="514"/&gt;
        &lt;parameter name="appName" value="OrientDB"/&gt;
    &lt;/parameters&gt;
&lt;/handler&gt;
</code></pre>
<h2 id="usage-1"><a class="header" href="#usage-1">Usage</a></h2>
<p>Look at <a href="plugins/../security/Security-Config.html">Security Config</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="mail-plugin"><a class="header" href="#mail-plugin">Mail Plugin</a></h1>
<p>Java class implementation:</p>
<pre><code class="language-java">com.orientechnologies.orient.server.plugin.mail.OMailPlugin
</code></pre>
<p>Available since: <strong>v. 1.2.0</strong>.</p>
<h2 id="introduction-3"><a class="header" href="#introduction-3">Introduction</a></h2>
<p>Allows to send (and in future read) emails.</p>
<h2 id="configuration-1"><a class="header" href="#configuration-1">Configuration</a></h2>
<p>This plugin is configured as a <a href="plugins/../internals/DB-Server.html#plugins">Server handler</a>. The plugin can be configured in easy way by changing parameters:</p>
<table>
  <tr><th>Name</th><th>Description</th><th>Type</th><th>Example</th><th>Since</th></tr>
  <tr><td>enabled</td><td>true to turn on, false (default) is turned off</td><td>boolean</td><td>true</td><td>1.2.0</td></tr>
  <tr><td><code>profile.&lt;name&gt;.mail.smtp.host</code></td><td>The SMTP host name or ip-address</td><td>string</td><td>smtp.gmail.com</td><td>1.2.0</td></tr>
  <tr><td><code>profile.&lt;name&gt;.mail.smtp.port</code></td><td>The SMTP port</td><td>number</td><td>587</td><td>1.2.0</td></tr>
  <tr><td><code>profile.&lt;name&gt;.mail.smtp.auth</code></td><td>Authenticate in SMTP</td><td>boolean</td><td>true</td><td>1.2.0</td></tr>
  <tr><td><code>profile.&lt;name&gt;.mail.smtp.starttls.enable</code></td><td>Enable the starttls</td><td>boolean</td><td>true</td><td>1.2.0</td></tr>
  <tr><td><code>profile.&lt;name&gt;.mail.smtp.user</code></td><td>The SMTP username</td><td>string</td><td>yoda@starwars.com</td><td>1.2.0</td></tr>
  <tr><td><code>profile.&lt;name&gt;.mail.from</code></td><td>The source's email address</td><td>string</td><td>yoda@starwars.com</td><td>1.7</td></tr>
  <tr><td><code>profile.&lt;name&gt;.mail.smtp.password</code></td><td>The SMTP password</td><td>string</td><td>UseTh3F0rc3</td><td>1.2.0</td></tr>
  <tr><td><code>profile.&lt;name&gt;.mail.date.format</code></td><td>The date format to use, default is "yyyy-MM-dd HH:mm:ss"</td><td>string</td><td>yyyy-MM-dd HH:mm:ss</td><td>1.2.0</td></tr>
</table>
<p>Default configuration in orientdb-server-config.xml. Example:</p>
<pre><code class="language-xml">&lt;!-- MAIL, TO TURN ON SET THE 'ENABLED' PARAMETER TO 'true' --&gt;
&lt;handler
class="com.orientechnologies.orient.server.plugin.mail.OMailPlugin"&gt;
  &lt;parameters&gt;
    &lt;parameter name="enabled" value="true" /&gt;
    &lt;!-- CREATE MULTIPLE PROFILES WITH profile.&lt;name&gt;... --&gt;
    &lt;parameter name="profile.default.mail.smtp.host" value="smtp.gmail.com"/&gt;
    &lt;parameter name="profile.default.mail.smtp.port" value="587" /&gt;
    &lt;parameter name="profile.default.mail.smtp.auth" value="true" /&gt;
    &lt;parameter name="profile.default.mail.smtp.starttls.enable" value="true" /&gt;
    &lt;parameter name="profile.default.mail.from" value="test@gmail.com" /&gt;
    &lt;parameter name="profile.default.mail.smtp.user" value="test@gmail.com" /&gt;
    &lt;parameter name="profile.default.mail.smtp.password" value="mypassword" /&gt;
    &lt;parameter name="profile.default.mail.date.format" value="yyyy-MM-dd HH:mm:ss" /&gt;
  &lt;/parameters&gt;
&lt;/handler&gt;
</code></pre>
<h2 id="usage-2"><a class="header" href="#usage-2">Usage</a></h2>
<p>The message is managed as a map of properties containing all the fields those are part of the message.</p>
<p>Supported message properties:</p>
<table><tbody>
  <tr><th>Name</th><th>Description</th><th>Mandatory</th><th>Example</th><th>Since</th></tr>
  <tr><td>from</td><td>source email address</td><td>No</td><td>to : "first@mail.com", "second@mail.com"</td><td>1.7</td></tr>
  <tr><td>to</td><td>destination addresses separated by commas</td><td>Yes</td><td>to : "first@mail.com", "second@mail.com"</td><td>1.2.0</td></tr>
  <tr><td>cc</td><td>Carbon copy addresses separated by commas</td><td>No</td><td>cc: "first@mail.com", "second@mail.com"</td><td>1.2.0</td></tr>
  <tr><td>bcc</td><td>Blind Carbon Copy addresses separated by commas</td><td>No</td><td>bcc : "first@mail.com", "second@mail.com"</td><td>1.2.0</td></tr>
  <tr><td>subject</td><td>The subject of the message</td><td>No</td><td>subject : "This Email plugin rocks!"</td><td>1.2.0</td></tr>
  <tr><td>message</td><td>The message's content</td><td>Yes</td><td>message : "Hi, how are you mate?"</td><td>1.2.0</td></tr>
  <tr><td>date</td><td>The subject of the message. Pass a java.util.Date object or a string formatted following the rules specified in "mail.date.format" configuration parameter or "yyyy-MM-dd HH:mm:ss" is taken</td><td>No, if not specified current date is assumed</td><td>date : "2012-09-25 13:20:00"</td><td>1.2.0</td></tr>
  <tr><td>attachments</td><td>The files to attach</td><td>No</td><td></td><td>1.2.0</td></tr>
</tbody></table>
<h2 id="from-server-side-functions"><a class="header" href="#from-server-side-functions">From Server-Side Functions</a></h2>
<p>The Email plugin install a new variable in the server-side function's context: "mail". "profile" attribute is the profile name in <a href="plugins/Mail-Plugin.html#configuration">configuration</a>.</p>
<p>Example to send an email writing a function in JS:</p>
<pre><code class="language-javascript">mail.send({
      profile : "default",
      to: "orientdb@ruletheworld.com",
      cc: "yoda@starwars.com",
      bcc: "darthvader@starwars.com",
      subject: "The EMail plugin works",
      message : "Sending email from OrientDB Server is so powerful to build real web applications!"
    });
</code></pre>
<p>On Nashorn (&gt;= Java8) the mapping of JSON to Map is not implicit. Use this:</p>
<pre><code class="language-javascript">mail.send( new java.util.HashMap{
      profile : "default",
      to: "orientdb@ruletheworld.com",
      cc: "yoda@starwars.com",
      bcc: "darthvader@starwars.com",
      subject: "The EMail plugin works",
      message : "Sending email from OrientDB Server is so powerful to build real web applications!"
  });
</code></pre>
<h2 id="from-java"><a class="header" href="#from-java">From Java</a></h2>
<pre><code class="language-java">OMailPlugin plugin = OServerMain.server().getPlugin("mail");

Map&lt;String, Object&gt; message = new HashMap&lt;String, Object&gt;();
message.put("profile", "default");
message.put("to",      "orientdb@ruletheworld.com");
message.put("cc",      "yoda@starts.com,yoda-beach@starts.com");
message.put("bcc",     "darthvader@starwars.com");
message.put("subject", "The EMail plugin works");
message.put("message", "Sending email from OrientDB Server is so powerful to build real web applications!");

plugin.send(message);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="jmx-plugin"><a class="header" href="#jmx-plugin">JMX plugin</a></h1>
<p>Java class implementation:</p>
<pre><code class="language-java">com.orientechnologies.orient.server.handler.OJMXPlugin
</code></pre>
<p>Available since: <strong>v. 1.2.0</strong>.</p>
<h1 id="introduction-4"><a class="header" href="#introduction-4">Introduction</a></h1>
<p>Expose the OrientDB server configuration through JMX protocol. This task is configured as a <a href="plugins/../internals/DB-Server.html#plugins">Server handler</a>. The task can be configured in easy way by changing parameters:</p>
<ul>
<li><strong>enabled</strong>: true to turn on, false (default) is turned off</li>
<li><strong>profilerManaged</strong>: manage the <a href="plugins/../tuning/Profiler.html">Profiler</a> instance</li>
</ul>
<p>Default configuration in orientdb-server-config.xml</p>
<pre><code class="language-xml">&lt;!-- JMX SERVER, TO TURN ON SET THE 'ENABLED' PARAMETER TO 'true' --&gt;
&lt;handler class="com.orientechnologies.orient.server.handler.OJMXPlugin"&gt;
  &lt;parameters&gt;
    &lt;parameter name="enabled" value="false" /&gt;
    &lt;parameter name="profilerManaged" value="true" /&gt;
  &lt;/parameters&gt;
&lt;/handler&gt;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rexster"><a class="header" href="#rexster">Rexster</a></h1>
<p><a href="https://github.com/tinkerpop/rexster/wiki/">Rexster</a> provides a RESTful shell to any Blueprints-complaint graph database. This HTTP web service provides: a set of standard low-level GET, POST, and DELETE methods, a flexible extension model which allows plug-in like development for external services (such as ad-hoc graph queries through Gremlin), and a browser-based interface called The Dog House.</p>
<p>A graph database hosted in the OrientDB can be configured in Rexster and then accessed using the standard RESTful interface powered by the Rexster web server.</p>
<h2 id="installation-1"><a class="header" href="#installation-1">Installation</a></h2>
<p>You can get the latest stable release of Rexster from its <a href="https://github.com/tinkerpop/rexster/downloads">Download Page</a>.  The latest stable release when this page was last updated was <em>2.5.0</em>.</p>
<p>Or you can build a snapshot by executing the following <a href="http://git-scm.com/">Git</a> and <a href="http://maven.apache.org/">Maven</a> commands:</p>
<pre><code class="language-java">git clone https://github.com/tinkerpop/rexster.git
cd rexster
mvn clean install
</code></pre>
<p>Rexster is distributed as a zip file (also the building process creates a zip file) hence the installation consist of unzipping the archive in a directory of your choice. In the following sections, this directory is referred to as <em>$REXSTER_HOME</em>.</p>
<p>After unzipping the archive, you should copy <em>orient-client.jar</em> and <em>orient-enterprise.jar</em> in <em>$REXSTER_HOME/ext</em>.  Make sure you use the same version of OrientDB as those used by Rexster.  For example Rexster 2.5.0 uses OrientDB 1.7.6.</p>
<p>You can find more details about Rexster installation at the <a href="https://github.com/tinkerpop/rexster/wiki/Getting-Started">Getting Started page</a>.</p>
<h2 id="configuration-2"><a class="header" href="#configuration-2">Configuration</a></h2>
<p>Refer to Rexster's <a href="https://github.com/tinkerpop/rexster/wiki/Rexster-Configuration">Configuration page</a> and <a href="https://github.com/tinkerpop/rexster/wiki/Specific-Graph-Configurations#orientdb">OrientDB specific configuration page</a> for the latest details.</p>
<h3 id="synopsis"><a class="header" href="#synopsis">Synopsis</a></h3>
<p>The Rexster configuration file <em>rexster.xml</em> is used to configure parameters such as: TCP ports used by Rexster server modules to listen for incoming connections; character set supported by the Rexster REST requests and responses; connection parameters of graph instances.</p>
<p>In order to configure Rexster to connect to your OrientDB graph, locate the <em>rexster.xml</em> in the Rexster directory and add the following snippet of code:</p>
<pre><code class="language-xml">&lt;rexster&gt;
  ...
  &lt;graphs&gt;
    ...
    &lt;graph&gt;
      &lt;graph-enabled&gt;true&lt;/graph-enabled&gt;
      &lt;graph-name&gt;my-orient-graph&lt;/graph-name&gt;
      &lt;graph-type&gt;orientgraph&lt;/graph-type&gt;
      &lt;graph-file&gt;url-to-your-db&lt;/graph-file&gt;
      &lt;properties&gt;
        &lt;username&gt;user&lt;/username&gt;
        &lt;password&gt;pwd&lt;/password&gt;
      &lt;/properties&gt;
    &lt;/graph&gt;
  ...
  &lt;/graphs&gt;
&lt;/rexster&gt;
</code></pre>
<p>In the configuration file, there could be a sample <code>graph</code> element for an OrientDB instance (<code>&lt;graph-name&gt;orientdbsample&lt;graph-name&gt;</code>): you might edit it according to your needs.</p>
<p>The <code>&lt;graph-name&gt;</code> element must be unique within the list of configured graphs and reports the name used to identify your graph.
The <code>&lt;graph-enabled&gt;</code> element states whether the graph should be loaded and managed by Rexster. Setting its contents to <code>false</code> will prevent that graph from loading to Rexster; setting explicitly to <code>true</code> the graph will be loaded.
The <code>&lt;graph-type&gt;</code> element reports the type of graph by using an identifier (<code>orientgraph</code> for an OrientDB Graph instance) or the full name of the class that implements the <a href="https://github.com/tinkerpop/rexster/blob/master/rexster-core/src/main/java/com/tinkerpop/rexster/config/GraphConfiguration.java">GraphConfiguration interface</a>
(<a href="https://github.com/orientechnologies/orientdb/blob/master/graphdb/src/main/java/com/tinkerpop/rexster/OrientGraphConfiguration.java">com.tinkerpop.rexster.OrientGraphConfiguration</a> for an OrientDB Graph).</p>
<p>The <code>&lt;graph-file&gt;</code> element reports the URL to the OrientDB database Rexster is expected to connect to:</p>
<ul>
<li><code>plocal:*path-to-db*</code>, if the graph can be accessed over the file system (e.g. <code>plocal:/tmp/graph/db</code>)</li>
<li><code>remote:*url-to-db*</code>, if the graph can be accessed over the network and/or if you want to enable multiple accesses to the graph (e.g. <code>remote:localhost/mydb</code>)</li>
<li><code>memory:*db-name*</code>, if the graph resides in memory only. Updates to this kind of graph are never persistent and when the OrientDB server ends the graph is lost</li>
</ul>
<p>The <code>&lt;username&gt;</code> and <code>&lt;password&gt;</code> elements reports the credentials to access the graph (e.g. <code>admin</code> <code>admin</code>).</p>
<h2 id="run"><a class="header" href="#run">Run</a></h2>
<p><strong>Note: <font color="RED">only Rexster 0.5-SNAPSHOT and further releases work with OrientDB GraphEd</font></strong><br/>
In this section we present a step-by-step guide to Rexster-ify an OrientDB graph.<br/>
We assume that:</p>
<ul>
<li>you created a Blueprints enabled graph called <em>orientGraph</em> using the class <code>com.tinkerpop.blueprints.pgm.impls.orientdb.OrientGraph</code></li>
<li>you inserted in the Rexster configuration file a <code>&lt;graph&gt;</code> element with the <code>&lt;graph-name&gt;</code> element set to <code>my-orient-graph</code> and the <code>graph-file</code> element set to <code>remote:orienthost/orientGraph</code> (if you do not remember how to do this, go back to the <a href="plugins/Rexster.html#configuration">Configuration</a> section).</li>
</ul>
<ol>
<li>Be sure that the OrientDB server is running and you have properly configured the <code>&lt;graph-file&gt;</code> location and the access credentials of your graph.</li>
<li>Execute the startup script (<em>$REXSTER_HOME/bin/rexster.bat</em> or <em>$REXSTER_HOME/bin/rexster.sh</em>)</li>
<li>The shell console appears and you should see the following log message (line 10 states that the OrientDB graph instance has been loaded):</li>
</ol>
<pre><code class="language-java">[INFO] WebServer - .:Welcome to Rexster:.
[INFO] GraphConfigurationContainer - Graph emptygraph - tinkergraph[vertices:0 edges:0] loaded
[INFO] RexsterApplicationGraph - Graph [tinkergraph] - configured with allowable namespace [tp:gremlin]
[INFO] GraphConfigurationContainer - Graph tinkergraph - tinkergraph[vertices:6 edges:6] loaded
[INFO] RexsterApplicationGraph - Graph [tinkergraph-readonly] - configured with allowable namespace [tp:gremlin]
[INFO] GraphConfigurationContainer - Graph tinkergraph-readonly - (readonly)tinkergraph[vertices:6 edges:6] loaded
[INFO] RexsterApplicationGraph - Graph [gratefulgraph] - configured with allowable namespace [tp:gremlin]
[INFO] GraphConfigurationContainer - Graph gratefulgraph - tinkergraph[vertices:809 edges:8049] loaded
[INFO] GraphConfigurationContainer - Graph sailgraph - sailgraph[memorystore] loaded
[INFO] GraphConfigurationContainer - Graph my-orient-graph - orientgraph[remote:orienthost/orientGraph] loaded
[INFO] GraphConfigurationContainer - Graph neo4jsample -  not enabled and not loaded.
[INFO] GraphConfigurationContainer - Graph dexsample -  not enabled and not loaded.
[INFO] MapResultObjectCache - Cache constructed with a maximum size of 1000
[INFO] WebServer - Web Server configured with com..sun..jersey..config..property..packages: com.tinkerpop.rexster
[INFO] WebServer - No servlet initialization parameters passed for configuration: admin-server-configuration
[INFO] WebServer - Rexster Server running on: [http://localhost:8182]
[INFO] WebServer - Dog House Server running on: [http://localhost:8183]
[INFO] ShutdownManager$ShutdownSocketListener - Bound shutdown socket to /127.0.0.1:8184. Starting listener thread for shutdown requests.
</code></pre>
<ul>
<li>Now you can use <a href="https://github.com/tinkerpop/rexster/wiki/Basic-REST-API">Rexster REST API</a> and <a href="https://github.com/tinkerpop/rexster/wiki/The-Dog-House">The Dog House web application</a> to retrieve and modify the data stored in the OrientDB graph.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="gephi-visual-tool"><a class="header" href="#gephi-visual-tool">Gephi Visual Tool</a></h1>
<h1 id="introduction-5"><a class="header" href="#introduction-5">Introduction</a></h1>
<p>Gephi is a visual tool to manipulate and analyze graphs. http://gephi.org is an Open Source project. Take a look at the amazing <a href="http://gephi.org/features/">features</a>.</p>
<p>Gephi can be used to analyze graphs extracted from OrientDB. There are 2 level of integration:</p>
<ul>
<li>the <a href="https://gephi.org/plugins/graph-streaming/">Streaming plugin</a> that calls OrientDB server via HTTP. OrientDB exposes the new "/gephi" command in HTTP GET method that executes a query and returns the result set in "gephi" format.</li>
<li><a href="https://github.com/datablend/gephi-blueprints-plugin/wiki">Gephi importer for Blueprints</a></li>
</ul>
<p>In this mini guide we will take a look at the first one: the streaming plugin.</p>
<p>For more information:</p>
<ul>
<li><a href="https://github.com/gephi/gephi/wiki">Gephi Graph Streaming format</a></li>
<li><a href="http://www.youtube.com/watch?v=7SW_FDiY0sg">Tutorial video</a></li>
</ul>
<h1 id="getting-started-1"><a class="header" href="#getting-started-1">Getting started</a></h1>
<p>Before to start assure you've <a href="https://oss.sonatype.org/content/groups/public/com/orientechnologies/orientdb/1.1.0-SNAPSHOT/">OrientDB 1.1.0-SNAPSHOT</a> or greater.</p>
<h2 id="download-and-install"><a class="header" href="#download-and-install">Download and install</a></h2>
<ol>
<li>To download Gephi goto: http://gephi.org/users/download/</li>
<li>Install it, depends on your OS</li>
<li>Run Gephi</li>
<li>Click on the menu <strong>Tools</strong> -&gt; <strong>Plugins</strong></li>
<li>Click on the tab <strong>Available Plugins</strong></li>
<li>Select the plugin <strong>Graph Streaming</strong>, click on the <strong>Install</strong> button and wait the plugin is installed</li>
</ol>
<h2 id="import-a-graph-in-gephi"><a class="header" href="#import-a-graph-in-gephi">Import a graph in Gephi</a></h2>
<p>Before to import a graph assure a OrientDB server instance is running somewhere. For more information watch this <a href="http://www.youtube.com/watch?v=7SW_FDiY0sg">video</a>.</p>
<ol>
<li>Go to the <strong>Overview</strong> view (click on <strong>Overview</strong> top left button)</li>
<li>Click on the <strong>Streaming</strong> tab on the left</li>
<li>Click on the big <strong>+</strong> green button</li>
<li>Insert as <strong>Source URL</strong> the query you want to execute. Example:  <code>http://localhost:2480/gephi/demo/sql/select%20from%20v/100</code> (below more information about the syntax of query)</li>
<li>Select as <strong>Stream type</strong> the <strong>JSON</strong> format (OrientDB talks in JSON)</li>
<li>Enable the <strong>Use Basic Authentication</strong> and insert the user and password of OrientDB database you want to access. The default user is "admin" as user and password</li>
<li>Click on <strong>OK</strong> button</li>
</ol>
<h1 id="executing-a-query"><a class="header" href="#executing-a-query">Executing a query</a></h1>
<p>The OrientDB's "/gephi" HTTP command allow to execute any query. The format is:</p>
<pre><code>http://&lt;host&gt;:&lt;port&gt;/gephi/&lt;database&gt;/&lt;language&gt;/&lt;query&gt;[/&lt;limit&gt;]
</code></pre>
<p>Where:</p>
<ul>
<li><strong><code>host</code></strong> is the host name or the ip address where the OrientDB server is running. If you're executing OrientDB on the same machine where Gephi is running use "localhost"</li>
<li><strong><code>port</code></strong> is the port number where the OrientDB server is running. By default is 2480.</li>
<li><strong><code>database</code></strong> is the database name</li>
<li><strong><code>language</code></strong></li>
<li><strong><code>query</code></strong>, the query text following the <a href="http://www.w3schools.com/tags/ref_urlencode.asp">URL encoding rules</a>. For example to use the spaces use <code>%20</code>, so the query <code>select from v</code> becomes <code>select%20from%20v</code></li>
<li><strong><code>limit</code></strong>, optional, set the limit of the result set. If not defined 20 is taken by default. <code>-1</code> means no limits</li>
</ul>
<h2 id="sql-graph-language"><a class="header" href="#sql-graph-language">SQL Graph language</a></h2>
<p>To use the OrientDB's SQL language use <strong><code>sql</code></strong> as language. For more information look at the <a href="plugins/../sql/SQL-Query.html">SQL-Syntax</a>.</p>
<p>For example, to return the first 1,000 vertices (class V) with outgoing connections the query would be:</p>
<pre><code class="language-sql">SELECT FROM V WHERE out.size() &gt; 0
</code></pre>
<p>Executed on "localhost" against the "demo" database + encoding becomes:</p>
<pre><code>http://localhost:2480/gephi/demo/sql/select%20from%20V%20where%20out.size()%20%3E%200/1000
</code></pre>
<h2 id="gremlin-language"><a class="header" href="#gremlin-language">GREMLIN language</a></h2>
<p>To use the powerful GREMLIN language to retrieve the graph or a portion of it use <strong><code>gremlin</code></strong> as language. For more information look at the <a href="plugins/../gremlin/Gremlin.html">GREMLIN syntax</a>.</p>
<p>For example, to return the first 100 vertices:</p>
<pre><code>g.V[0..99]
</code></pre>
<p>Executed on "localhost" against the "demo" database + encoding becomes:</p>
<pre><code>http://localhost:2480/gephi/demo/gremlin/g.V%5B0..99%5D/-1
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="spider-box"><a class="header" href="#spider-box">spider-box</a></h1>
<p><a href="https://github.com/spider/spider-box">spider-box</a> is not really a "plug-in", but more a quick way to set up an environment to play with OrientDB in a local VM. It requires a virtualization system like <a href="https://www.virtualbox.org/">Virtualbox</a>, <a href="https://www.vmware.com/de/products/fusion">VMWare Fusion</a> or <a href="http://www.parallels.com/">Parallels</a> and the provisioning software <a href="https://www.vagrantup.com/">Vagrant</a>.</p>
<p>Once installed, you can very quickly start playing with the newest version of OrientDB Studio or the console. Or even start developing software with OrientDB as the database.</p>
<p>spider-box is configured mainly to build a PHP development environment. But, since it is built on <a href="https://puphpet.com/">Puphpet</a>, you can easily change the configuration, so Python or even node.js is also installed. Ruby is installed automatically.</p>
<p>If you have questions about changing configuration or using spider-box, please do ask in an issue in the spider-box repo.</p>
<p>Have fun playing with OrientDB and spider-box!</p>
<p>Note: Neo4j and Gremlin Server are also installed, when you <code>vagrant up</code> spider-box.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="plugins"><a class="header" href="#plugins">Plugins</a></h1>
<p>If you're looking for drivers or JDBC connector go to  <a href="plugins/../apis-and-drivers/README.html">Programming-Language-Bindings</a>.</p>
<hr />
<p><a href="http://www.springsource.org"><img width="100" align="left" src="http://www.springsource.org/files/imagefield_default_images/placeholder_video_spring_projects.png" /></a>
<br>
 
<br></p>
<ul>
<li><a href="https://github.com/orientechnologies/spring-data-orientdb">OrientDB Spring Data</a> is the official <a href="http://projects.spring.io/spring-data/">Spring Data Plugin</a> for both Graph and Document APIs</li>
<li><a href="https://github.com/megadix/orientdb-spring">spring-orientdb</a> is an attempt to provide a PlatformTransactionManager for OrientDB usable with the Spring Framework, in particular with @Transactional annotation. Apache 2 license
<br></li>
<li><a href="https://github.com/maseev/spring-session-orientdb">Spring Session OrientDB</a> is a Spring Session extension for OrientDB.</li>
</ul>
<hr />
<p><a href="http://www.playframework.org"><img width="100" align="left" src="https://www.playframework.com/assets/images/logos/play_full_color.png" /></a>
<br>
 
<br></p>
<ul>
<li><a href="https://github.com/ratcashdev/play-with-orientdb">Play Framework 2.1 PLAY-WITH-ORIENTDB plugin</a></li>
<li><a href="https://github.com/sgougi/play21-origami-plugin">Play Framework 2.1 ORIGAMI plugin</a></li>
<li><a href="http://www.playframework.org/modules/orientdb">Play Framework 1.x ORIENTDB plugin</a></li>
<li><a href="https://github.com/sgougi/play21-frames-orientdb-plugin">Frames-OrientDB Plugin Play Framework 2.x</a> Frames-OrientDB plugin is a Java O/G mapper for the OrientDB with the Play! framework 2. It is used with the TinkerPop Frames for O/G mapping.</li>
</ul>
<hr />
<p><a href="https://github.com/faizod/orientdb-liquibase-plugin"><img src="https://raw.githubusercontent.com/liquibase/liquibase.github.com/master/custom_images/liquibase_logo.gif" width="300"></a></p>
<hr />
<p><a href="https://github.com/PhantomYdn/wicket-orientdb"><img src="http://wicket.apache.org/img/logo-apachewicket-white.svg" width="300"></a><br></p>
<p>With proper mark-up/logic separation, a POJO data model, and a refreshing lack of XML, Apache Wicket makes developing web-apps simple and enjoyable again. Swap the boilerplate, complex debugging and brittle code for powerful, reusable components written with plain Java and HTML.</p>
<hr />
<!-- 
<a href="https://github.com/google/guice"><img src="http://www.jaritimonen.com/wp-content/uploads/2012/06/Guice.jpg"/></a>
<br>
&nbsp;
<br>  
-->
<p>Guice (pronounced 'juice') is a lightweight dependency injection framework for Java 6 and above, brought to you by Google.
<a href="https://github.com/xvik/guice-persist-orient">OrientDB Guice plugin</a> allows to integrate OrientDB inside Guice. Features:</p>
<ul>
<li>Integration through guice-persist (UnitOfWork, PersistService, @Transactional, dynamic finders supported)</li>
<li>Support for document, object and graph databases</li>
<li>Database types support according to classpath (object and graph db support activated by adding jars to classpath)</li>
<li>Auto mapping entities in package to db scheme or using classpath scanning to map annotated entities</li>
<li>Auto db creation</li>
<li>Hooks for schema migration and data initialization extensions</li>
<li>All three database types may be used in single unit of work (but each type will use its own transaction)</li>
</ul>
<hr />
<p><a href="http://vertx.io/"><img src="http://vertx.io/assets/logo-sm.png" width="200"></a>
<br></p>
<p>Vert.x is a lightweight, high performance application platform for the JVM that's designed for modern mobile, web, and enterprise applications.
<a href="https://github.com/aschrijver/mod-tinkerpop-persistor">Vert.x Persistor Module</a> for Tinkerpop-compatible Graph Databases like OrientDB.</p>
<hr />
<p><a href="https://gephi.org"><img width="100" align="left" src="http://gephi.github.io/images/logo.png" /></a><br></p>
<p><a href="plugins/Gephi.html">Gephi Visual tool</a> usage with OrientDB and the <a href="https://github.com/datablend/gephi-blueprints-plugin/wiki">Blueprints importer</a></p>
<hr />
<h2 id="orientdb-session-store-for-connect"><a class="header" href="#orientdb-session-store-for-connect"><a href="https://github.com/ffissore/connect-orientdb">OrientDB session store</a> for Connect</a></h2>
<a href="http://forge.puppetlabs.com"/>
<br>
[Puppet module](https://github.com/example42/puppet-orientdb)
<hr />
<h1 id="chef"><a class="header" href="#chef"><a href="https://supermarket.chef.io/cookbooks/orientdb">Chef</a></a></h1>
<hr />
<p><a href="http://tomcat.apache.org"><img width="100" align="left" src="http://tomcat.apache.org/images/tomcat.gif" /></a>
<br>
<a href="http://wiki.apache.org/tomcat/OrientDBRealm">Apache Tomcat realm</a> plugin by <a href="mailto:jonathan.tellier@gmail.com">Jonathan Tellier</a></p>
<hr />
<p><a href="http://shibboleth.net"><img width="100" align="left" src="http://shibboleth.net/images/shibboleth_logo.png" /></a><br></p>
<p><a href="https://wiki.shibboleth.net/confluence/display/SHIB2/OrientDB+Connector">Shibboleth connector</a> by Jonathan Tellier. The <a href="http://shibboleth.net">Shibboleth</a> System is a standards based, open source software package for web single sign-on across or within organizational boundaries. It allows sites to make informed authorization decisions for individual access of protected online resources in a privacy-preserving manner</p>
<hr />
<p><a href="http://media.xircles.codehaus.org"><img width="100" align="left" src="http://griffon-framework.org/img/griffon-icon-32x32.png" /></a><br></p>
<p><a href="https://github.com/griffon/griffon-orientdb-plugin">Griffon plugin</a>, Apache 2 license</p>
<hr />
<p><strong>JCA connectors</strong></p>
<ul>
<li><a href="http://team.ops4j.org/wiki/display/ORIENT/JCA+Resource+Adapter">OPS4J Orient</a> provides a JCA resource adapter for integrating OrientDB with Java EE 6 servers</li>
<li><a href="https://github.com/kirpi4ik/orientdb-jca">OrientDB JCA connector</a> to access to OrientDB database via JCA API + XA Transactions</li>
</ul>
<hr />
<p><a href="https://github.com/pdlug/pacer-orient">Pacer plugin</a> by Paul Dlug. <a href="https://github.com/pangloss/pacer">Pacer</a> is a <a href="http://jruby.org/">JRuby</a>  graph traversal framework built on the Tinkerpop stack. This plugin enables full OrientDB graph support in Pacer.</p>
<hr />
<p><a href="http://www.axonframework.org"><img width="100" align="left" src="http://www.axonframework.org/wp-content/uploads/AxonFramework_logoTxt.png" /></a><br></p>
<p><a href="http://www.axonframework.org/">EventStore for Axonframework</a>, which uses fully transactional (full ACID support) NoSQL database OrientDB. <a href="http://www.axonframework.org/">Axon Framework</a> helps build scalable, extensible and maintainable applications by supporting developers apply the Command Query Responsibility Segregation (CQRS) architectural pattern</p>
<hr />
<p><a href="https://github.com/mproch/slick-orientdb#readme"><img width="100" align="left" src="http://slick.typesafe.com/resources/images/slick-logo.png"></a><br></p>
<p>Accessing OrientDB using Slick</p>
<hr />
<p><a href="https://github.com/eiswind/jackrabbit-orient"><img width="100" align="left" src="http://jackrabbit.apache.org/jcr/images/logos/jlogo.gif" /></a><br></p>
<p>Jackrabbit module to use OrientDB as backend.</p>
<hr />
<!--
<a href="https://github.com/sakuraiyuta/fuel-orientdb"><img width="100" align="left" src="http://fuelphp.com/addons/shared_addons/themes/fuel/img/logo.png" /></a><br>

&nbsp;&nbsp;Plugin for <a href="http://fuelphp.com">FuelPHP framework</a>.
-->
<hr />
<p><a href="https://github.com/raymanrt/orientqb">orientqb</a><br></p>
<p>orientqb is a builder for OSQL query language written in Java. orientqb has been thought to help developers in writing complex queries dynamically and aims to be simple but powerful.</p>
<hr />
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-11-26 SAM -->
<h1 id="multi-model"><a class="header" href="#multi-model">Multi-Model</a></h1>
<p>The OrientDB engine supports <strong>Graph</strong>, <strong>Document</strong>, <strong>Key/Value</strong>, and <strong>Object</strong> models, so you can use OrientDB as a replacement for a product in any of these categories. However, the main reason why users choose OrientDB is because of its true <strong>Multi-Model</strong> DBMS abilities, which combine all the features of the four models into the core. These abilities are not just interfaces to the database engine, but rather the engine itself was built to support all four models. This is also the main difference to other multi-model DBMSs, as they implement an additional layer with an API, which mimics additional models. However, under the hood, they're truly only one model, therefore they are limited in speed and scalability.</p>
<h2 id="the-document-model"><a class="header" href="#the-document-model">The Document Model</a></h2>
<p>The data in this model is stored inside documents. A document is a set of key/value pairs (also referred to as fields or properties), where the key allows access to its value. Values can hold primitive data types, embedded documents, or arrays of other values. Documents are not typically forced to have a schema, which can be advantageous, because they remain flexible and easy to modify. Documents are stored in collections, enabling developers to group data as they decide. OrientDB uses the concepts of "<a href="datamodeling/Concepts.html#class">classes</a>" and "<a href="datamodeling/../internals/Clusters.html">clusters</a>" as its form of "collections" for grouping documents. This provides several benefits, which we will discuss in further sections of the documentation.</p>
<p>OrientDB's Document model also adds the concept of a "<a href="datamodeling/Concepts.html#relationships">LINK</a>" as a relationship between documents. With OrientDB, you can decide whether to embed documents or link to them directly. When you fetch a document, all the links are automatically resolved by OrientDB. This is a major difference to other Document Databases, like MongoDB or CouchDB, where the developer must handle any and all relationships between the documents herself.</p>
<p>The table below illustrates the comparison between the relational model, the document model, and the OrientDB document model:</p>
<div class="table-wrapper"><table><thead><tr><th>Relational Model</th><th>Document Model</th><th>OrientDB Document Model</th></tr></thead><tbody>
<tr><td>Table</td><td>Collection</td><td><a href="datamodeling/Concepts.html#class">Class</a> or <a href="datamodeling/../internals/Clusters.html">Cluster</a></td></tr>
<tr><td>Row</td><td>Document</td><td><a href="datamodeling/Concepts.html#document">Document</a></td></tr>
<tr><td>Column</td><td>Key/value pair</td><td>Document field</td></tr>
<tr><td>Relationship</td><td>not available</td><td><a href="datamodeling/Concepts.html#relationships">Link</a></td></tr>
</tbody></table>
</div>
<h2 id="the-graph-model"><a class="header" href="#the-graph-model">The Graph Model</a></h2>
<p>A graph represents a network-like structure consisting of Vertices (also known as Nodes) interconnected by Edges (also known as Arcs). OrientDB's graph model is represented by the concept of a property graph, which defines the following:</p>
<ul>
<li>
<p><strong>Vertex</strong> - an entity that can be linked with other Vertices and has the following mandatory properties:</p>
<ul>
<li>unique identifier</li>
<li>set of incoming Edges</li>
<li>set of outgoing Edges</li>
</ul>
</li>
<li>
<p><strong>Edge</strong> - an entity that links two Vertices and has the following mandatory properties:</p>
<ul>
<li>unique identifier</li>
<li>link to an incoming Vertex (also known as head)</li>
<li>link to an outgoing Vertex (also known as tail)</li>
<li>label that defines the type of connection/relationship between head and tail vertex</li>
</ul>
</li>
</ul>
<p>In addition to mandatory properties, each vertex or edge can also hold a set of custom properties. These properties can be defined by users, which can make vertices and edges appear similar to documents. In the table below, you can find a comparison between the graph model, the relational data model, and the OrientDB graph model:</p>
<div class="table-wrapper"><table><thead><tr><th>Relational Model</th><th>Graph Model</th><th>OrientDB Graph Model</th></tr></thead><tbody>
<tr><td>Table</td><td>Vertex and Edge Class</td><td><a href="datamodeling/Concepts.html#class">Class</a> that extends "V" (for Vertex) and "E" (for Edges)</td></tr>
<tr><td>Row</td><td>Vertex</td><td>Vertex</td></tr>
<tr><td>Column</td><td>Vertex and Edge property</td><td>Vertex and Edge property</td></tr>
<tr><td>Relationship</td><td>Edge</td><td>Edge</td></tr>
</tbody></table>
</div>
<h2 id="the-keyvalue-model"><a class="header" href="#the-keyvalue-model">The Key/Value Model</a></h2>
<p>This is the simplest model of the three. Everything in the database can be reached by a key, where the values can be simple and complex types. OrientDB supports Documents and Graph Elements as values allowing for a richer model, than what you would normally find in the classic Key/Value model. The classic Key/Value model provides "buckets" to group key/value pairs in different containers. The most classic use cases of the Key/Value Model are:</p>
<ul>
<li>POST the value as payload of the HTTP call -&gt; <code>/&lt;bucket&gt;/&lt;key&gt;</code></li>
<li>GET the value as payload from the HTTP call -&gt; <code>/&lt;bucket&gt;/&lt;key&gt;</code></li>
<li>DELETE the value by Key, by calling the HTTP call -&gt; <code>/&lt;bucket&gt;/&lt;key&gt;</code></li>
</ul>
<p>The table below illustrates the comparison between the relational model, the Key/Value model, and the OrientDB Key/Value model:</p>
<div class="table-wrapper"><table><thead><tr><th>Relational Model</th><th>Key/Value Model</th><th>OrientDB Key/Value Model</th></tr></thead><tbody>
<tr><td>Table</td><td>Bucket</td><td><a href="datamodeling/Concepts.html#class">Class</a> or <a href="datamodeling/../internals/Clusters.html">Cluster</a></td></tr>
<tr><td>Row</td><td>Key/Value pair</td><td><a href="datamodeling/Concepts.html#document">Document</a></td></tr>
<tr><td>Column</td><td>not available</td><td>Document field or Vertex/Edge property</td></tr>
<tr><td>Relationship</td><td>not available</td><td><a href="datamodeling/Concepts.html#relationships">Link</a></td></tr>
</tbody></table>
</div>
<h2 id="the-object-model"><a class="header" href="#the-object-model">The Object Model</a></h2>
<p>This model has been inherited by <a href="http://en.wikipedia.org/wiki/Object-oriented_programming">Object Oriented programming</a> and supports <strong>Inheritance</strong> between types (sub-types extends the super-types), <strong>Polymorphism</strong> when you refer to a base class and <strong>Direct binding</strong> from/to Objects used in programming languages.</p>
<p>The table below illustrates the comparison between the relational model, the Object model, and the OrientDB Object model:</p>
<div class="table-wrapper"><table><thead><tr><th>Relational Model</th><th>Object Model</th><th>OrientDB Object Model</th></tr></thead><tbody>
<tr><td>Table</td><td>Class</td><td><a href="datamodeling/Concepts.html#class">Class</a> or <a href="datamodeling/../internals/Clusters.html">Cluster</a></td></tr>
<tr><td>Row</td><td>Object</td><td><a href="datamodeling/Concepts.html#document">Document</a> or Vertex</td></tr>
<tr><td>Column</td><td>Object property</td><td>Document field or Vertex/Edge property</td></tr>
<tr><td>Relationship</td><td>Pointer</td><td><a href="datamodeling/Concepts.html#relationships">Link</a></td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="multi-tenant"><a class="header" href="#multi-tenant">Multi Tenant</a></h1>
<p>There are at many ways to build multi-tenant applications on top of OrientDB, in this page we are going to analyze pros and cons of three of the most used approaches.</p>
<h2 id="one-database-per-tenant"><a class="header" href="#one-database-per-tenant">One database per tenant</a></h2>
<p>With this solution, each tenant is a database. The OrientDB server allows to host multiple databases.</p>
<p>Pros:</p>
<ul>
<li>Easy to use: to create/drop a new tenant, simply create/drop the database</li>
<li>Easy to scale up by moving the database on different servers</li>
</ul>
<p>Cons:</p>
<ul>
<li>Hard to create reports and analytics cross tenant, it requires to execute the same query against all the databases</li>
</ul>
<h2 id="specific-clusters-per-tenant"><a class="header" href="#specific-clusters-per-tenant">Specific clusters per tenant</a></h2>
<p>With this solution, each tenant is stored in one or more clusters of the same database. For example, the class <code>Product</code> could have the following clusters: <code>Product_ClientA</code>, <code>Product_ClientB</code>, <code>Product_ClientC</code>. In this way a query against a specific cluster will be used to retrieve data from one tenant only. Example to retrieve all the products of 2016, ordered by the most recent, only for the tenant "ClientC": <code>select * from cluster:Product_ClientC where date &gt;= '2016-01-01' order by date desc</code>.</p>
<p>Instead, a query against the class <code>Product</code> will return a cross-tenant result. Example: <code>select * from Product where date &gt;= '2016-01-01' order by date desc</code>.</p>
<p>Pros:</p>
<ul>
<li>Easy to create reports and analytics cross tenant, because it's just one database</li>
<li>It's possible to scale up on multiple servers by using sharding</li>
</ul>
<p>Cons:</p>
<ul>
<li>The maximum number of clusters per database is 32,768. To bypass this limitation, use multiple databases</li>
<li>No security out of the box, it's entirely up to the application to isolate access between tenants</li>
</ul>
<h2 id="use-partitioned-graphs"><a class="header" href="#use-partitioned-graphs">Use Partitioned Graphs</a></h2>
<p>By using the OrientDB's record level security, it's possible to have multiple partitions of graphs accessible by different users. For more information look at <a href="datamodeling/../java/Partitioned-Graphs.html">Partitioned Graphs</a>.</p>
<p>Pros:</p>
<ul>
<li>Easy to create reports and analytics cross tenant, because it's just one database</li>
</ul>
<p>Cons:</p>
<ul>
<li>Performance: record level security has an overhead, specially with queries</li>
<li>Scales worse than "One database per tenant" solution, because the database will end up to be much bigger</li>
<li>Sharding is not possible because records of multiple tenants are mixed on the same clusters</li>
<li>Hard to guarantee a predictable level of service for all the users, because users connect to a tenant impact the other tenants</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-11-26 SAM -->
<h1 id="basic-concepts"><a class="header" href="#basic-concepts">Basic Concepts</a></h1>
<h3 id="record"><a class="header" href="#record">Record</a></h3>
<p>The smallest unit that you can load from and store in the database.  Records come in four types:</p>
<ul>
<li>Documents</li>
<li>Blobs</li>
<li>Vertices</li>
<li>Edges</li>
</ul>
<p>A <strong>Record</strong> is the smallest unit that can be loaded from and stored into the database. A record can be a Document, a Blob a Vertex or even an Edge.</p>
<h3 id="document"><a class="header" href="#document">Document</a></h3>
<p>The Document is the most flexible record type available in OrientDB.  Documents are softly typed and are defined by schema classes with defined constraints, but you can also use them in a schema-less mode too.</p>
<p>Documents handle fields in a flexible manner.  You can easily import and export them in JSON format.  For example,</p>
<pre><code class="language-json">{
     "name"      : "Jay",
     "surname"   : "Miner",
     "job"       : "Developer",
     "creations" : [
          {
		       "name"    : "Amiga 1000",
               "company" : "Commodore Inc."
		   }, {
		       "name"    : "Amiga 500",
               "company" : "Commodore Inc."
           }
     ]
}
</code></pre>
<p>For Documents, OrientDB also supports complex <a href="datamodeling/Concepts.html#relationships">relationships</a>.  From the perspective of developers, this can be understood as a persistent <code>Map&lt;String,Object&gt;</code>.</p>
<h3 id="blob"><a class="header" href="#blob">BLOB</a></h3>
<p>In addition to the Document record type, OrientDB can also load and store binary data.  The BLOB record type was called <code>RecordBytes</code> before OrientDB v2.2.</p>
<h3 id="vertex"><a class="header" href="#vertex">Vertex</a></h3>
<p>In Graph databases, the most basic unit of data is the node, which in OrientDB is called a vertex.  The Vertex stores information for the database.  There is a separate record type called the Edge that connects one vertex to another.</p>
<p>Vertices are also documents.  This means they can contain embedded records and arbitrary properties.</p>
<h3 id="edge"><a class="header" href="#edge">Edge</a></h3>
<p>In Graph databases, an arc is the connection between two nodes, which in OrientDB is called an edge.  Edges are bidirectional and can only connect two vertices.</p>
<p>Edges can be regular or lightweight. The Regular Edge saves as a Document, while the Lightweight Edge does not. For an understanding of the differences between these, see <a href="datamodeling/../java/Lightweight-Edges.html">Lightweight Edges</a>.</p>
<p>For more information on connecting vertices in general, see <a href="datamodeling/Concepts.html#relationships">Relationships</a>, below.</p>
<h2 id="record-id"><a class="header" href="#record-id">Record ID</a></h2>
<p>When OrientDB generates a record, it auto-assigns a unique unit identifier, called a Record ID, or RID.  The syntax for the Record ID is the pound sign with the cluster identifier and the position. The format is like this:</p>
<p><code>#&lt;cluster&gt;:&lt;position&gt;</code>.</p>
<ul>
<li>
<p><strong>Cluster Identifier</strong>: This number indicates the cluster to which the record belongs. Positive numbers in the cluster identifier indicate persistent records. Negative numbers indicate temporary records, such as those that appear in result-sets for queries that use projections.</p>
</li>
<li>
<p><strong>Position</strong>: This number defines the absolute position of the record in the cluster.</p>
</li>
</ul>
<blockquote>
<p><strong>NOTE</strong>: The prefix character <code>#</code> is mandatory to recognize a Record ID.</p>
</blockquote>
<p>Records never lose their identifiers unless they are deleted.  When deleted, OrientDB never recycles identifiers.  Additionally, you can access records directly through their Record ID's.  For this reason, you don't need to create a field to serve as the primary key, as you do in Relational databases.</p>
<h2 id="record-version"><a class="header" href="#record-version">Record Version</a></h2>
<p>Records maintain their own version number, which increments on each update.  In optimistic transactions, OrientDB checks the version in order to avoid conflicts at commit time.</p>
<h2 id="class-1"><a class="header" href="#class-1">Class</a></h2>
<p>The concept of the Class is taken from the <a href="http://en.wikipedia.org/wiki/Object-oriented_programming">Object Oriented Programming</a> paradigm.  In OrientDB, classes define records.  It is closest to the concept of a table in Relational databases.</p>
<p>Classes can be schema-less, schema-full or a mix.  They can inherit from other classes, creating a tree of classes.  <a href="http://en.wikipedia.org/wiki/Inheritance_%28object-oriented_programming%29">Inheritance</a>, in this context, means that a sub-class extends a parent class, inheriting all of its attributes.</p>
<p>Each class has its own <a href="datamodeling/Concepts.html#cluster">clusters (data files)</a>.  A non-abstract class (see below) must have at least one cluster defined, which functions as its default cluster.  But, a class can support multiple clusters.  When you execute a query against a class, it automatically propagates to all clusters that are part of the class.  When you create a new record, OrientDB selects the cluster to store it in using a <a href="datamodeling/../misc/Cluster-Selection.html">configurable strategy</a>.</p>
<p>When you create a new class, by default, OrientDB creates new <a href="datamodeling/Concepts.html#database-url">persistent clusters</a> with the same name as the class, in lowercase, suffixed with underscore and an integer.  As a default, OrientDB creates as many clusters per class as many cores (processors) the host machine has.</p>
<p>Eg. for class <code>Person</code>, OrientDB will create clusters <code>person</code>, <code>person_1</code>, <code>person_2</code> and so on so forth.</p>
<h3 id="abstract-class"><a class="header" href="#abstract-class">Abstract Class</a></h3>
<p>The concept of an Abstract Class is one familiar to Object-Oriented programming.  In OrientDB, this feature has been available since version 1.2.0.  Abstract classes are classes used as the foundation for defining other classes.  They are also classes that cannot have instances. For more information on how to create an abstract class, see <a href="datamodeling/../sql/SQL-Create-Class.html">CREATE CLASS</a>.</p>
<p>This concept is essential to Object Orientation, without the typical spamming of the database with always empty, auto-created clusters.</p>
<blockquote>
<p>For more information on Abstract Class as a concept, see <a href="http://en.wikipedia.org/wiki/Abstract_type">Abstract Type</a> and <a href="http://docs.oracle.com/javase/tutorial/java/IandI/abstract.html">Abstract Methods and Classes</a></p>
</blockquote>
<h3 id="class-vs-cluster-in-queries"><a class="header" href="#class-vs-cluster-in-queries">Class vs. Cluster in Queries</a></h3>
<p>The combination of classes and clusters is very powerful and has a number of use cases.  Consider an example where you create a class <code>Invoice</code>, with two clusters <code>invoice2015</code> and <code>invoice2016</code>.  You can query all invoices using the class as a target with <a href="datamodeling/../sql/SQL-Query.html"><code>SELECT</code></a>.</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM Invoice</code>
</pre>
<p>In addition to this, you can filter the result-set by year.  The class <code>Invoice</code> includes a <code>year</code> field, you can filter it through the <a href="datamodeling/../sql/SQL-Where.html"><code>WHERE</code></a> clause.</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM Invoice WHERE year = 2012</code>
</pre>
<p>You can also query specific objects from a single cluster.  By splitting the class <code>Invoice</code> across multiple clusters, (that is, one per year), you can optimize the query by narrowing the potential result-set.</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM CLUSTER:invoice2012</code>
</pre>
<p>Due to the optimization, this query runs significantly faster, because OrientDB can narrow the search to the targeted cluster.</p>
<h2 id="cluster"><a class="header" href="#cluster">Cluster</a></h2>
<p>Where classes provide you with a logical framework for organizing data, clusters provide physical or in-memory space in which OrientDB actually stores the data.  It is comparable to the collection in Document databases and the table in Relational databases.</p>
<p>When you create a new class, the <a href="datamodeling/../sql/SQL-Create-Class.html"><code>CREATE CLASS</code></a> process also creates physical clusters that serve as the default location in which to store data for that class.  OrientDB forms the cluster names using the class name, with all lower case letters.  Beginning with version 2.2, OrientDB creates additional clusters for each class, (one for each CPU core on the server), to improve performance of parallelism.</p>
<blockquote>
<p>For more information, see the <a href="datamodeling/../gettingstarted/Tutorial-Clusters.html">Clusters Tutorial</a>.</p>
</blockquote>
<h2 id="materialized-view"><a class="header" href="#materialized-view">Materialized View</a></h2>
<p>A materialized view is a persistent object that contains the result of a query. In terms of SQL querying, it can be considered as the equivalent of a class, that means that it can be used as a target for queries.</p>
<p>A materialized view can be configured to be read-only or updatable. Updating a record of a materialized view results in the update of the original record (ie. the record from which the view raw was created).</p>
<p>Views can have indexes, like normal classes.</p>
<h2 id="relationships-1"><a class="header" href="#relationships-1">Relationships</a></h2>
<p>OrientDB supports two kinds of relationships: <strong>referenced</strong> and <strong>embedded</strong>.  It can manage relationships in a schema-full or schema-less scenario.</p>
<h3 id="referenced-relationships-1"><a class="header" href="#referenced-relationships-1">Referenced Relationships</a></h3>
<p>In Relational databases, tables are linked through <code>JOIN</code> commands, which can prove costly on computing resources.  OrientDB manges relationships natively without computing <code>JOIN</code>'s.  Instead, it stores direct links to the target objects of the relationship.  This boosts the load speed for the entire graph of connected objects, such as in Graph and Object database systems.</p>
<p>For example</p>
<pre><code>                  customer
  Record A     -------------&gt;    Record B
CLASS=Invoice                 CLASS=Customer
  RID=5:23                       RID=10:2
</code></pre>
<p>Here, record <code>A</code> contains the reference to record <code>B</code> in the property <code>customer</code>.  Note that both records are reachable by other records, given that they have a <a href="datamodeling/Concepts.html#record-id">Record ID</a>.</p>
<p>With the Graph API, <a href="datamodeling/Concepts.html#edge">Edges</a> are represented with two links stored on both vertices to handle the bidirectional relationship.</p>
<h4 id="11-and-1n-referenced-relationships"><a class="header" href="#11-and-1n-referenced-relationships">1:1 and 1:<em>n</em> Referenced Relationships</a></h4>
<p>OrientDB expresses relationships of these kinds using links of the <code>LINK</code> type.</p>
<h4 id="1n-and-nn-referenced-relationships"><a class="header" href="#1n-and-nn-referenced-relationships">1:<em>n</em> and <em>n</em>:<em>n</em> Referenced Relationships</a></h4>
<p>OrientDB expresses relationships of these kinds using a collection of links, such as:</p>
<ul>
<li><code>LINKLIST</code> An ordered list of links.</li>
<li><code>LINKSET</code> An unordered set of links, which does not accept duplicates.</li>
<li><code>LINKMAP</code> An ordered map of links, with <code>String</code> as the key type.  Duplicates keys are not accepted.</li>
</ul>
<p>With the Graph API, <a href="datamodeling/Concepts.html#edge">Edges</a> connect only two vertices.  This means that 1:<em>n</em> relationships are not allowed.  To specify a 1:<em>n</em> relationship with graphs, create multiple edges.</p>
<h3 id="embedded-relationships-1"><a class="header" href="#embedded-relationships-1">Embedded Relationships</a></h3>
<p>When using Embedded relationships, OrientDB stores the relationship within the record that embeds it.  These relationships are stronger than Reference relationships.  You can represent it as a <a href="http://en.wikipedia.org/wiki/Class_diagram#Composition">UML Composition relationship</a>.</p>
<p>Embedded records do not have their own <a href="datamodeling/Concepts.html#record-id">Record ID</a>, given that you can't directly reference it through other records.  It is only accessible through the container record.</p>
<p>In the event that you delete the container record, the embedded record is also deleted.  For example,</p>
<pre><code>                   address
  Record A     &lt;&gt;----------&gt;   Record B
CLASS=Account               CLASS=Address
  RID=5:23                     NO RID!
</code></pre>
<p>Here, record <code>A</code> contains the entirety of record <code>B</code> in the property <code>address</code>.  You can reach record <code>B</code> only by traversing the container record.  For example,</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM Account WHERE address.city = 'Rome'</code>
</pre>
<h4 id="11-and-n1-embedded-relationships-1"><a class="header" href="#11-and-n1-embedded-relationships-1">1:1 and <em>n</em>:1 Embedded Relationships</a></h4>
<p>OrientDB expresses relationships of these kinds using the <code>EMBEDDED</code> type.</p>
<h4 id="1n-and-nn-embedded-relationships-1"><a class="header" href="#1n-and-nn-embedded-relationships-1">1:<em>n</em> and <em>n</em>:<em>n</em> Embedded Relationships</a></h4>
<p>OrientDB expresses relationships of these kinds using a collection of links, such as:</p>
<ul>
<li><code>EMBEDDEDLIST</code> An ordered list of records.</li>
<li><code>EMBEDDEDSET</code> An unordered set of records, that doesn't accept duplicates.</li>
<li><code>EMBEDDEDMAP</code> An ordered map of records as the value and a string as the key, it doesn't accept duplicate keys.</li>
</ul>
<h3 id="inverse-relationships"><a class="header" href="#inverse-relationships">Inverse Relationships</a></h3>
<p>In OrientDB, all Edges in the Graph model are bidirectional.  This differs from the Document model, where relationships are always unidirectional, requiring the developer to maintain data integrity.  In addition, OrientDB automatically maintains the consistency of all bidirectional relationships.</p>
<h2 id="database"><a class="header" href="#database">Database</a></h2>
<p>The database is an interface to access the real <a href="datamodeling/Concepts.html#database-url">Storage</a>.  IT understands high-level concepts such as queries, schemas, metadata, indices and so on.  OrientDB also provides multiple database types.  For more information on these types, see <a href="datamodeling/../java/Java-API.html#component-architecture">Database Types</a>.</p>
<p>Each server or Java VM can handle multiple database instances, but the database name must be unique. You can't manage two databases at the same time, even if they are in different directories.  To handle this case, use the <code>$</code> dollar character as a separator instead of the <code>/</code> slash character.  OrientDB binds the entire name, so it becomes unique, but at the file system level it converts <code>$</code> with <code>/</code>, allowing multiple databases with the same name in different paths.  For example,</p>
<pre><code>test$customers -&gt; test/customers
production$customers = production/customers
</code></pre>
<h3 id="database-url"><a class="header" href="#database-url">Database URL</a></h3>
<p>OrientDB uses its own <a href="http://en.wikipedia.org/wiki/Uniform_Resource_Locator">URL</a> format, of engine and database name as <code>&lt;engine&gt;:&lt;db-name&gt;</code>.</p>
<div class="table-wrapper"><table><thead><tr><th>Engine</th><th>Description</th><th>Example</th></tr></thead><tbody>
<tr><td><a href="datamodeling/../internals/Paginated-Local-Storage.html">plocal</a></td><td>This engine writes to the file system to store data. There is a LOG of changes to restore the storage in case of a crash.</td><td><code>plocal:/temp/databases/petshop/petshop</code></td></tr>
<tr><td><a href="datamodeling/../internals/Memory-storage.html">memory</a></td><td>Open a database completely in memory</td><td><code>memory:petshop</code></td></tr>
<tr><td>remote</td><td>The storage will be opened via a remote network connection. It requires an OrientDB Server up and running. In this mode, the database is shared among multiple clients. Syntax: <code>remote:&lt;server&gt;:[&lt;port&gt;]/db-name</code>. The port is optional and defaults to 2424.</td><td><code>remote:localhost/petshop</code></td></tr>
</tbody></table>
</div>
<h3 id="database-usage"><a class="header" href="#database-usage">Database Usage</a></h3>
<p>You must always close the database once you finish working on it.</p>
<blockquote>
<p><strong>NOTE</strong>: OrientDB automatically closes all opened databases, when the process dies gracefully (not by killing it by force). This is assured if the Operating System allows a graceful shutdown.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-programs"><a class="header" href="#orientdb-programs">OrientDB Programs</a></h1>
<p>When you install OrientDB on your system, there are a number of applications included in the package.  You can find them in the <code>$ORIENTDB_HOME/bin/</code> directory.  These applications include the OrientDB Server, the Console used to connect to the server and various other programs and administrative utilities.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-server"><a class="header" href="#orientdb-server">OrientDB Server</a></h1>
<p>OrientDB provides several methods of starting and managing the Server process.  These include individual scripts that initialize the Java Virtual Machine and start <a href="programs/../java/ref/OServer.html">OServer</a> and systemd and initscripts that allow you to launch and manage the Server using the <code>systemctl</code> or <code>service</code> utilities on Linux.</p>
<h2 id="programs"><a class="header" href="#programs">Programs</a></h2>
<p>There are two scripts that you can use to start the OrientDB Server directly.  Each script has two builds: a <code>.sh</code> shell script for use on Linux distributions and a <code>.bat</code> batch file for use on Windows.</p>
<div class="table-wrapper"><table><thead><tr><th>Script</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>dserver</strong></td><td>Used to start the OrientDB Server in distributed environments</td></tr>
<tr><td><strong>server</strong></td><td>Used to start a standalone OrientDB Server</td></tr>
</tbody></table>
</div>
<h3 id="process-management"><a class="header" href="#process-management">Process Management</a></h3>
<p>Where the above programs make it easy to start the Server on your desktop for experimentation and similar tasks, it is not very convenient for use on a production host.  In addition to the Server startup scripts, OrientDB also ships with a systemd service file and an initscript, which you can install on Linux distributions to start, stop and restart the OrientDB Server using either <code>systemctl</code> or <code>service</code> utilities.</p>
<p>For more information, see <a href="programs/orientdb.html">OrientDB Server Process</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-server---server"><a class="header" href="#orientdb-server---server">OrientDB Server - <code>server</code></a></h1>
<p>The OrientDB Server is a Java application that manages database operations, retrieval and storage. The shell script <code>server</code> provides a convenient command-line interface to use in configuring and launching the OrientDB Server.</p>
<p>OrientDB provides a <code>server.sh</code> shell script for starting the server on Linux operating systems and a <code>server.bat</code> batch file for starting it on Windows.</p>
<h2 id="configuration-environmental-variables"><a class="header" href="#configuration-environmental-variables">Configuration Environmental Variables</a></h2>
<p>OrientDB manages most of its configuration options through various XML configuration files.  However, there are a handful of environmental variables that it utilizes when starting the Server.  When the script runs, it check these variables to determine whether any value has been set on them.  In the event that it finds none, it instead sets a sensible default value.</p>
<p>On Linux, you can set the environmental variable using the <code>export</code> command:</p>
<pre><code class="language-sh">$ export ORIENTDB_HOME=/opt/orientdb/3.2.44/
</code></pre>
<p>The following environmental variables are used by <code>server.sh</code>:</p>
<div class="table-wrapper"><table><thead><tr><th>Variable Name</th><th>Default</th><th>Description</th></tr></thead><tbody>
<tr><td><code>$CONFIG_FILE</code></td><td><code>$ORIENTDB_HOME/config/orientdb-server-config.xml</code></td><td>XML configuration file for the server</td></tr>
<tr><td><code>$JAVA_HOME</code></td><td><code>$PATH/java</code></td><td>Path to Java home directory, used when you have multiple installations of Java available on the host</td></tr>
<tr><td><code>$JAVA_OPTS_SCRIPT</code></td><td><code>-Djna.nosys=true -XX:+HeapDumpOnOutOfMemoryError -Djava.awt.headless=true -Dfile.encoding=UTF8 -Drhino.opt.level=9</code></td><td>Defines</td></tr>
<tr><td><code>$ORIENTDB_HOME</code></td><td>current working directory</td><td>OrientDB installation directory</td></tr>
<tr><td><code>$ORIENTDB_LOG_CONF</code></td><td><code>$ORIENTDB_HOME/config/orientdb-server-log.properties</code></td><td>Path to Java properties file you want to use</td></tr>
<tr><td><code>$ORIENTDB_OPTS_MEMORY</code></td><td><code>-Xms2G -Xmx2G</code></td><td>Memory options, defaults to 2GB of heap</td></tr>
<tr><td><code>$ORIENTDB_PID</code></td><td><code>$ORIENTDB_HOME/bin/orient.pid</code></td><td>Path to the process id (<code>.pid</code>) file</td></tr>
<tr><td><code>$ORIENTDB_SETTINGS</code></td><td></td><td>Default settings for OrientDB</td></tr>
<tr><td><code>$ORIENTDB_WWW_PATH</code></td><td><code>$ORIENTDB_HOME/www/</code></td><td>Path to web resources, defaults to the interface to launch OrientDB Studio</td></tr>
</tbody></table>
</div>
<p>The <code>server.sh</code> script also accepts argument.  If one of the arguments is <code>debug</code>, the script enables the following Java options <code>-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=1044</code>.  Any additional arguments are passed directly to the <code>java</code> program.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-server---dserversh"><a class="header" href="#orientdb-server---dserversh">OrientDB Server - dserver.sh</a></h1>
<p>In situations where an individual host is insufficient for your storage or performance needs, you can run OrientDB on multiple hosts distributing the load between them.  Where the <a href="programs/server.html"><code>server</code></a> script starts OrientDB as an individual Server, the <code>dserver</code> script does the same, while configuring Server to operate in a distributed environment.</p>
<p>OrientDB provides a <code>dserver.sh</code> shell script for Linux operating systems and <code>dserver.bat</code> batch file for the Windows operating system.</p>
<h2 id="configuration-environmental-variables-1"><a class="header" href="#configuration-environmental-variables-1">Configuration Environmental Variables</a></h2>
<p>OrientDB manages most of its configuration options through various XML configuration files.  However, there are a handful of environmental variables that it utilizes when starting the Server.  When the script runs, it check these variables to determine whether any value has been set on them.  In the event that it finds none, it instead sets a sensible default value.</p>
<p>On Linux, you can set the environmental variable using the <code>export</code> command:</p>
<pre><code class="language-sh">$ export ORIENTDB_HOME=/opt/orientdb/3.2.44/
</code></pre>
<p>The following environmental variables are used by <code>server.sh</code>:</p>
<div class="table-wrapper"><table><thead><tr><th>Variable Name</th><th>Default</th><th>Description</th></tr></thead><tbody>
<tr><td><code>$CONFIG_FILE</code></td><td><code>$ORIENTDB_HOME/config/orientdb-server-config.xml</code></td><td>XML configuration file for the server</td></tr>
<tr><td><code>$JAVA_HOME</code></td><td><code>$PATH/java</code></td><td>Path to Java home directory, used when you have multiple installations of Java available on the host</td></tr>
<tr><td><code>$JAVA_OPTS_SCRIPT</code></td><td><code>-Djna.nosys=true -XX:+HeapDumpOnOutOfMemoryError -Djava.awt.headless=true -Dfile.encoding=UTF8 -Drhino.opt.level=9</code></td><td>Defines</td></tr>
<tr><td><code>$ORIENTDB_HOME</code></td><td>current working directory</td><td>OrientDB installation directory</td></tr>
<tr><td><code>$ORIENTDB_LOG_CONF</code></td><td><code>$ORIENTDB_HOME/config/orientdb-server-log.properties</code></td><td>Path to Java properties file you want to use</td></tr>
<tr><td><code>$ORIENTDB_OPTS_MEMORY</code></td><td><code>-Xms2G -Xmx2G</code></td><td>Memory options, defaults to 2GB of heap</td></tr>
<tr><td><code>$ORIENTDB_PID</code></td><td><code>$ORIENTDB_HOME/bin/orient.pid</code></td><td>Path to the process id (<code>.pid</code>) file</td></tr>
<tr><td><code>$ORIENTDB_SETTINGS</code></td><td></td><td>Default settings for OrientDB</td></tr>
<tr><td><code>$ORIENTDB_WWW_PATH</code></td><td><code>$ORIENTDB_HOME/www/</code></td><td>Path to web resources, defaults to the interface to launch OrientDB Studio</td></tr>
</tbody></table>
</div>
<p>The <a href="programs/dserver.html"><code>dserver.sh</code></a> script also accepts argument.  If one of the arguments is <code>debug</code>, the script enables the following Java options <code>-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=1044</code>.  Any additional arguments are passed directly to the <code>java</code> program.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-server-process"><a class="header" href="#orientdb-server-process">OrientDB Server Process</a></h1>
<p>Using the <a href="programs/service.html"><code>server</code></a> or <a href="programs/dserver.html"><code>dserver</code></a> shell scripts or batch files you can manually start the OrientDB Server. While this is often sufficient for testing or experimentation, however, in production environments it is preferable to user process and service management tools, like init and systemd.</p>
<h2 id="service-installation"><a class="header" href="#service-installation">Service Installation</a></h2>
<p>In order to manage OrientDB through process or service management tools, you first need to install it on your system.  The <code>bin/</code> directory of your OrientDB installation contains an <code>orientdb.sh</code> script that you need to modify and install at <code>/etc/init.d/orientdb</code>.</p>
<p>For instance,</p>
<pre><code># cp $ORIENTDB_HOME/bin/orientdb.sh /etc/init.d/orientdb
</code></pre>
<p>Once you have the file in place, edit it and modify the two script variables at the top of the file.</p>
<div class="table-wrapper"><table><thead><tr><th>Variable</th><th>Description</th></tr></thead><tbody>
<tr><td><code>ORIENTDB_HOME</code></td><td>Defines the path where you've installed OrientDB</td></tr>
<tr><td><code>ORIENTDB_USER</code></td><td>Defines the system user you want the script to switch to before it starts the server</td></tr>
</tbody></table>
</div>
<h3 id="service-file"><a class="header" href="#service-file">Service File</a></h3>
<p>In cases where your host uses systemd for service and process management, you also need to copy the <code>orientdb.service</code> file.</p>
<pre><code># cp $ORIENTDB_HOME/bin/orientdb.service /etc/systemd/system
</code></pre>
<p>Once this is done, edit the service file to update values on the following fields:</p>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody>
<tr><td><code>User</code></td><td>Set to the user you want to switch to when running the OrientDB Server</td></tr>
<tr><td><code>Group</code></td><td>Set to the group you want to switch to when running the OrientDB Server</td></tr>
<tr><td><code>ExecStart</code></td><td>Set to the path to <code>orientdb</code> init script copied above, <code>/etc/init.d/orientdb</code></td></tr>
</tbody></table>
</div>
<h2 id="usage-3"><a class="header" href="#usage-3">Usage</a></h2>
<p>On operating systems that use init for process management, copying the OrientDB script and setting the variables is enough to manage it using the <code>service</code> command.  On hosts that utilize systemd, you also need to copy over the <code>orientdb.service</code> file.</p>
<h3 id="usage-with-init"><a class="header" href="#usage-with-init">Usage with init</a></h3>
<p>When working with a host that uses init, you can manage the OrientDB Server using the following commands:</p>
<p>To start the OrientDB Server:</p>
<pre><code># service orientdb start
</code></pre>
<p>To stop the OrientDB Server</p>
<pre><code># service orientdb stop
</code></pre>
<p>To start OrientDB when the server boots:</p>
<pre><code># service orientdb enable
</code></pre>
<h3 id="usage-with-systemd"><a class="header" href="#usage-with-systemd">Usage with systemd</a></h3>
<p>When working with a host that uses systemd, you can manage the OrientDB Server using the following commands:</p>
<p>To start the OrientDB Server:</p>
<pre><code># systemctl start orientdb 
</code></pre>
<p>To stop the OrientDB Server</p>
<pre><code># systemctl stop orientdb 
</code></pre>
<p>To start OrientDB when the server boots:</p>
<pre><code># systemctl enable orientdb 
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-client-programs"><a class="header" href="#orientdb-client-programs">OrientDB Client Programs</a></h1>
<p>OrientDB ships with one client utility: the <a href="programs/../console/README.html">Console</a>.  The Console is an interactive text-based interface for administering OrientDB Server and databases.</p>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-01-05 SAM -->
<h1 id="console-1"><a class="header" href="#console-1">Console</a></h1>
<p>OrientDB provides a <em>Console</em> Tool, which is a Java application that connects to and operates on OrientDB databases and Server instances.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="console-modes"><a class="header" href="#console-modes">Console Modes</a></h1>
<p>There are two modes available to you, while executing commands through the OrientDB Console: interactive mode and batch mode.</p>
<h2 id="interactive-mode"><a class="header" href="#interactive-mode">Interactive Mode</a></h2>
<p>By default, the Console starts in interactive mode.  In this mode, the Console loads to an <code>orientdb&gt;</code> prompt.  From there you can execute commands and SQL statements as you might expect in any other database console.</p>
<p>You can launch the console in interactive mode by executing the <code>console.sh</code> for Linux OS systems or <code>console.bat</code> for Windows systems in the <code>bin</code> directory of your OrientDB installation. Note that running this file requires execution permissions.</p>
<pre>
$ <code class="lang-sh userinput">cd $ORIENTDB_HOME/bin</code>
$ <code class="lang-sh userinput">./console.sh</code>

OrientDB console v.X.X.X (build 0) www.orientdb.dev
Type 'HELP' to display all the commands supported.
Installing extensions for GREMLIN language v.X.X.X

orientdb>
</pre>
<p>From here, you can begin running SQL statements or commands.  For a list of these commands, see <a href="console/Console-Commands.html#console-commands">commands</a>.</p>
<h2 id="batch-mode"><a class="header" href="#batch-mode">Batch mode</a></h2>
<p>When the Console runs in batch mode, it takes commands as arguments on the command-line or as a text file and executes the commands in that file in order.  Use the same <code>console.sh</code> or <code>console.bat</code> file found in <code>bin</code> at the OrientDB installation directory.</p>
<ul>
<li>
<p><strong>Command-line</strong>: To execute commands in batch mode from the command line, pass the commands you want to run in a string, separated by a semicolon.</p>
<pre>
$ <code class="lang-sh userinput">$ORIENTDB_HOME/bin/console.sh "CONNECT REMOTE:localhost/demo;SELECT FROM Profile"</code>
</pre>
</li>
<li>
<p><strong>Script Commands</strong>: In addition to entering the commands as a string on the command-line, you can also save the commands to a text file as a semicolon-separated list.</p>
<pre>
$ <code class="lang-sh userinput">vim commands.txt</code>
<code class="lang-sql userinput">
  CONNECT REMOTE:localhost/demo;SELECT FROM Profile
</code>
$ <code class="lang-sh userinput">$ORIENTDB_HOME/bin/console.sh commands.txt</code>
</pre>
</li>
</ul>
<h3 id="ignoring-errors"><a class="header" href="#ignoring-errors">Ignoring Errors</a></h3>
<p>When running commands in batch mode, you can tell the console to ignore errors, allowing the script to continue the execution, with the <code>ignoreErrors</code> setting.</p>
<pre>
$ <code class="lang-sh userinput">vim commands.txt</code>
<code class="lang-sql userinput">
  SET ignoreErrors TRUE
</code>
</pre>
<h3 id="enabling-echo"><a class="header" href="#enabling-echo">Enabling Echo</a></h3>
<p>Regardless of whether you call the commands as an argument or through a file, when you run console commands in batch mode, you may also need to display them as they execute.  You can enable this feature using the <code>echo</code> setting, near the start of your commands list.</p>
<pre>
$ <code class='lang-sh userinput'>vim commands.txt</code>
<code class="lang-sql userinput">
  SET echo TRUE
</code>
</pre>
<h2 id="enabling-date-in-prompt"><a class="header" href="#enabling-date-in-prompt">Enabling Date in prompt</a></h2>
<p>Starting from v2.2.9, to enable the date in the prompt, set the variable <code>promptDateFormat</code> with the date format following the <a href="https://docs.oracle.com/javase/8/docs/api/java/text/SimpleDateFormat.html">SimpleDateFormat specs</a>.</p>
<pre>
<code class='lang-sh userinput'>
orientdb {db=test1}> set promptDateFormat "yyy-MM-dd hh:mm:ss.sss"

orientdb {db=test1 (2016-08-26 09:34:12.012)}> 
</code>
</pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="console-commands"><a class="header" href="#console-commands">Console Commands</a></h1>
<p>OrientDB implements a number of SQL statements and commands that are available through the Console. In the event that you need information while working in the console, you can access it using either the <code>HELP</code> or <code>?</code> command.</p>
<div class="table-wrapper"><table><thead><tr><th>Command</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="console/Console-Command-Backup.html"><code>BACKUP DATABASE</code></a></td><td>Backup a database</td></tr>
<tr><td><a href="console/Console-Command-Browse-Class.html"><code>BROWSE CLASS</code></a></td><td>Browses all the records of a class</td></tr>
<tr><td><a href="console/Console-Command-Browse-Cluster.html"><code>BROWSE CLUSTER</code></a></td><td>Browses all the records of a cluster</td></tr>
<tr><td><a href="console/Console-Command-Classes.html"><code>CLASSES</code></a></td><td>Displays all the configured classes</td></tr>
<tr><td><a href="console/Console-Command-Cluster-Status.html"><code>CLUSTER STATUS</code></a></td><td>Displays the status of distributed cluster of servers</td></tr>
<tr><td><a href="console/Console-Command-Clusters.html"><code>CLUSTERS</code></a></td><td>Displays all the configured clusters</td></tr>
<tr><td><a href="console/Console-Command-Config.html"><code>CONFIG</code></a></td><td>Displays the configuration where the opened database is located (local or remote)</td></tr>
<tr><td><a href="console/Console-Command-Config-Get.html"><code>CONFIG GET</code></a></td><td>Returns a configuration value</td></tr>
<tr><td><a href="console/Console-Command-Config-Set.html"><code>CONFIG SET</code></a></td><td>Set a configuration value</td></tr>
<tr><td><a href="console/Console-Command-Connect.html"><code>CONNECT</code></a></td><td>Connects to a database (deprecated see OPEN)</td></tr>
<tr><td><a href="console/Console-Command-Connect-Env.html"><code>CONNECT ENV</code></a></td><td>Connects to an OrientDB server/environment</td></tr>
<tr><td><a href="console/Console-Command-Create-Database.html"><code>CREATE DATABASE</code></a></td><td>Creates a new database</td></tr>
<tr><td><a href="console/Console-Command-Declare-Intent.html"><code>DECLARE INTENT</code></a></td><td>Declares an intent</td></tr>
<tr><td><a href="console/Console-Command-Dictionary-Keys.html"><code>DICTIONARY KEYS</code></a></td><td>Displays all the keys in the database dictionary</td></tr>
<tr><td><a href="console/Console-Command-Dictionary-Get.html"><code>DICTIONARY GET</code></a></td><td>Lookups for a record using the dictionary. If found set it as the current record</td></tr>
<tr><td><a href="console/Console-Command-Dictionary-Put.html"><code>DICTIONARY PUT</code></a></td><td>Inserts or modify an entry in the database dictionary. The entry is composed by key=String, value=record-id</td></tr>
<tr><td><a href="console/Console-Command-Dictionary-Remove.html"><code>DICTIONARY REMOVE</code></a></td><td>Removes the association in the dictionary</td></tr>
<tr><td><a href="console/Console-Command-Disconnect.html"><code>DISCONNECT</code></a></td><td>Disconnects from the current database</td></tr>
<tr><td><a href="console/Console-Command-Display-Record.html"><code>DISPLAY RECORD</code></a></td><td>Displays current record's attributes</td></tr>
<tr><td><a href="console/Console-Command-Display-Raw-Record.html"><code>DISPLAY RAW RECORD</code></a></td><td>Displays current record's raw format</td></tr>
<tr><td><a href="console/Console-Command-Drop-Database.html"><code>DROP DATABASE</code></a></td><td>Drop a database</td></tr>
<tr><td><a href="console/Console-Command-Export.html"><code>EXPORT DATABASE</code></a></td><td>Exports a database</td></tr>
<tr><td><a href="console/Console-Command-Export-Record.html"><code>EXPORT RECORD</code></a></td><td>Exports a record in any of the supported format (i.e. json)</td></tr>
<tr><td><a href="console/Console-Command-Freeze-Db.html"><code>FREEZE DATABASE</code></a></td><td>Freezes the database locking all the changes. Use this to raw backup. Once frozen it uses the <a href="console/Console-Command-Release-Db.html"><code>RELEASE DATABASE</code></a> to release it</td></tr>
<tr><td><a href="console/Console-Command-Get.html"><code>GET</code></a></td><td>Returns the value of a property</td></tr>
<tr><td><a href="console/Console-Command-Import.html"><code>IMPORT DATABASE</code></a></td><td>Imports a database previously exported</td></tr>
<tr><td><a href="console/Console-Command-Indexes.html"><code>INDEXES</code></a></td><td>Displays information about indexes</td></tr>
<tr><td><a href="console/Console-Command-Info.html"><code>INFO</code></a></td><td>Displays information about current status</td></tr>
<tr><td><a href="console/Console-Command-Info-Class.html"><code>INFO CLASS</code></a></td><td>Displays information about a class</td></tr>
<tr><td><a href="console/../js/Javascript-Command.html#via-console"><code>JS</code></a></td><td>Executes a Javascript in the console</td></tr>
<tr><td><a href="console/../js/Javascript-Command.html#via-console"><code>JSS</code></a></td><td>Executes a Javascript in the server</td></tr>
<tr><td><a href="console/Console-Command-List-Databases.html"><code>LIST DATABASES</code></a></td><td>List the available databases</td></tr>
<tr><td><a href="console/Console-Command-List-Connections.html"><code>LIST CONNECTIONS</code></a></td><td>List the available connections</td></tr>
<tr><td><a href="console/Console-Command-Load-Record.html"><code>LOAD RECORD</code></a></td><td>Loads a record in memory and set it as the current one</td></tr>
<tr><td><a href="console/Console-Command-Load-Script.html"><code>LOAD SCRIPT</code></a></td><td>Loads and executes a sql script</td></tr>
<tr><td><a href="console/Console-Command-Open.html"><code>OPEN</code></a></td><td>Opens a database connection on the currently connected server/environment (see CONNECT ENV)</td></tr>
<tr><td><a href="console/Console-Command-Profiler.html"><code>PROFILER</code></a></td><td>Controls the <a href="console/../tuning/Profiler.html">Profiler</a></td></tr>
<tr><td><a href="console/Console-Command-Properties.html"><code>PROPERTIES</code></a></td><td>Returns all the configured properties</td></tr>
<tr><td><code>pwd</code></td><td>Display current path</td></tr>
<tr><td><a href="console/Console-Command-Release-Db.html"><code>RELEASE DATABASE</code></a></td><td>Releases a <a href="console/Console-Command-Freeze-Db.html">Console Freeze Database</a> database</td></tr>
<tr><td><a href="console/Console-Command-Reload-Record.html"><code>RELOAD RECORD</code></a></td><td>Reloads a record in memory and set it as the current one</td></tr>
<tr><td><code>RELOAD SCHEMA</code></td><td>Reloads the schema</td></tr>
<tr><td><a href="console/Console-Command-Restore.html"><code>RESTORE DATABASE</code></a></td><td>Restore a database</td></tr>
<tr><td><a href="console/Console-Command-Set.html"><code>SET</code></a></td><td>Changes the value of a property</td></tr>
<tr><td><code>HELP</code></td><td>Prints this help</td></tr>
<tr><td><code>EXIT</code></td><td>Closes the console</td></tr>
<tr><td><a href="console/../sql/SQL-Commands.html">SQL Commands</a></td><td></td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-01-05 SAM -->
<h1 id="console---backup"><a class="header" href="#console---backup">Console - <code>BACKUP</code></a></h1>
<p>Executes a complete backup on the currently opened database. It then compresses the backup file using the ZIP algorithm. You can then restore a database from backups, using the <a href="console/Console-Command-Restore.html"><code>RESTORE DATABASE</code></a> command. You can automate backups using the <a href="console/../plugins/Automatic-Backup.html">Automatic-Backup</a> server plugin.</p>
<p>Backups and restores are similar to the <a href="console/Console-Command-Export.html"><code>EXPORT DATABASE</code></a> and <a href="console/Console-Command-Import.html"><code>IMPORT DATABASE</code></a>, but they offer better performance than these options.</p>
<blockquote>
<p><strong>NOTE</strong>: OrientDB Community Edition does not support backing up remote databases.  OrientDB <a href="http://www.orientechnologies.com/orientdb-enterprise/">Enterprise Edition</a> does support this feature.  For more information on how to implement this with Enterprise Edition, see <a href="http://www.orientechnologies.com/enterprise/last/servermanagement.html">Remote Backups</a>.</p>
</blockquote>
<p><strong>Syntax:</strong></p>
<pre><code>BACKUP DATABASE &lt;output-file&gt; [-incremental] [-compressionLevel=&lt;compressionLevel&gt;] [-bufferSize=&lt;bufferSize&gt;]
</code></pre>
<ul>
<li><strong><code>&lt;output-file&gt;</code></strong> Defines the path to the backup file.</li>
<li><strong><code>-incremental</code></strong> Option to execute an <a href="console/../admin/Incremental-Backup-And-Restore.html">incremental backup</a>.  When enabled, it computes the data to backup as all new changes since the last backup. Available only in the <a href="console/../ee/Enterprise-Edition.html">OrientDB Enterprise Edition</a> version 2.2 or later.</li>
<li><strong>-<code>compressionLevel</code></strong> Defines the level of compression for the backup file.  Valid levels are <code>0</code> to <code>9</code>.  The default is <code>9</code>.  Available in 1.7 or later.</li>
<li><strong><code>-bufferSize</code></strong> Defines the compression buffer size.  By default, this is set to 1MB.  Available in 1.7 or later.</li>
</ul>
<p><strong>Permissions:</strong></p>
<p>In order to enable a user to execute this command, you must add the permission of <code>create</code> for the resource <code>database.backup</code> to the <a href="console/../security/Database-Security.html#users">database user</a>.</p>
<p><strong>Example:</strong></p>
<ul>
<li>Backing up a database:</li>
</ul>
<pre>
orientdb> <code class="lang-sql userinput">CONNECT plocal:../databases/mydatabase admin admin</code>
orientdb> <code class="lang-sql userinput">BACKUP DATABASE /backups/mydb.zip</code>

Backing current database to: database mydb.zip
Backup executed in 0.52 seconds
</pre>
<h3 id="incremental-backup"><a class="header" href="#incremental-backup">Incremental Backup</a></h3>
<p>Since version 2.2, <a href="console/../ee/Enterprise-Edition.html">OrientDB Enterprise Edition</a> supports incremental backups.
For more details see <a href="console/../admin/Incremental-Backup-And-Restore.html">Incremental Backup and Restore</a></p>
<blockquote>
<p>For more information, see:</p>
</blockquote>
<blockquote>
<ul>
<li><a href="console/Console-Command-Restore.html">Restore Database</a></li>
<li><a href="console/Console-Command-Export.html">Export Database</a></li>
<li><a href="console/Console-Command-Import.html">Import Database</a></li>
<li><a href="console/Console-Commands.html">Console-Commands</a></li>
<li><a href="https://github.com/orientechnologies/orientdb/blob/master/core/src/main/java/com/orientechnologies/orient/core/db/tool/ODatabaseExport.java">ODatabaseExport Java class</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-01-06 SAM -->
<h1 id="console---browse-class"><a class="header" href="#console---browse-class">Console - <code>BROWSE CLASS</code></a></h1>
<p>Displays all records associated with the given class.</p>
<p><strong>Syntax:</strong></p>
<pre><code>BROWSE CLASS &lt;class-name&gt;
</code></pre>
<ul>
<li><strong><code>&lt;class-name&gt;</code></strong> Defines the class for the records you want to display.</li>
</ul>
<p><strong>Permissions:</strong></p>
<p>In order to enable a user to execute this command, you must add the permission of <code>read</code> for the resource <code>database.class.&lt;class&gt;</code> to the <a href="console/../security/Database-Security.html#users">database user</a>.</p>
<p><strong>Example:</strong></p>
<ul>
<li>
<p>Browse records associated with the class <code>City</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">BROWSE CLASS City</code>

----+------+-------------------
  # | RID  | NAME
----+------+-------------------
  0 | -6:0 | Rome
  1 | -6:1 | London
  2 | -6:2 | Honolulu
----+------+-------------------
</pre>
</li>
</ul>
<blockquote>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-01-07 SAM -->
<h1 id="console---browse-cluster"><a class="header" href="#console---browse-cluster">Console - <code>BROWSE CLUSTER</code></a></h1>
<p>Displays all records associated with the given cluster.</p>
<p><strong>Syntax:</strong></p>
<pre><code>BROWSE CLUSTER &lt;cluster-name&gt;
</code></pre>
<ul>
<li><strong><code>&lt;cluster-name&gt;</code></strong> Defines the cluster for the records you want to display.</li>
</ul>
<p><strong>Permissions:</strong></p>
<p>In order to enable a user to execute this command, you must add the permission of <code>read</code> for the resource <code>database.cluster.&lt;class&gt;</code> to the <a href="console/../security/Database-Security.html#users">database user</a>.</p>
<p><strong>Example:</strong></p>
<ul>
<li>
<p>Browse records associated with the cluster <code>City</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">BROWSE CLUSTER City</code>

----+------+-------------------
  # | RID  | NAME
----+------+-------------------
  0 | -6:0 | Rome
  1 | -6:1 | London
  2 | -6:2 | Honolulu
----+------+-------------------
</pre>
</li>
</ul>
<blockquote>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-01-07 SAM -->
<h1 id="console---list-classes"><a class="header" href="#console---list-classes">Console - <code>LIST CLASSES</code></a></h1>
<p>Displays all configured classes in the current database.</p>
<p><strong>Syntax:</strong></p>
<ul>
<li>
<p>Long Syntax:</p>
<pre><code>LIST CLASSES
</code></pre>
</li>
<li>
<p>Short Syntax:</p>
<pre><code>CLASSES
</code></pre>
</li>
</ul>
<p><strong>Example</strong></p>
<ul>
<li>
<p>List current classes in the database:</p>
<pre>
orientdb> <code class="lang-sql userinput">LIST CLASSES</code>

CLASSES
-------------+------+-------------+-----------
 NAME        |  ID  | CLUSTERS    | ELEMENTS  
-------------+------+-------------+-----------
 Person      |    0 | person      |         7 
 Animal      |    1 | animal      |         5 
 AnimalRace  |    2 | AnimalRace  |         0 
 AnimalType  |    3 | AnimalType  |         1 
 OrderItem   |    4 | OrderItem   |         0 
 Order       |    5 | Order       |         0 
 City        |    6 | City        |         3 
-------------+------+-------------+-----------
 TOTAL                                     16 
-----------------------------------------------
</pre>
</li>
</ul>
<blockquote>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-01-07 SAM -->
<h1 id="console---cluster-status"><a class="header" href="#console---cluster-status">Console - <code>CLUSTER STATUS</code></a></h1>
<p>Displays the status of the cluster in distributed configuration.</p>
<p><strong>Syntax:</strong></p>
<pre><code>CLUSTER STATUS
</code></pre>
<p><strong>Example:</strong></p>
<ul>
<li>
<p>Display the status of the cluster:</p>
<pre>
orientdb> <code class="lang-sql userinput">CLUSTER STATUS</code>
<code class="lang-json">
{
    "localName": "_hzInstance_1_orientdb",
    "localId": "3735e690-9a7b-44d2-b4bc-27089da065e2",
    "members": [
        {
            "id": "3735e690-9a7b-44d2-b4bc-27089da065e2",
            "name": "node1",
            "startedOn": "2015-05-14 17:06:40:418",
            "listeners": [
                {
                    "protocol": "ONetworkProtocolBinary",
                    "listen": "10.3.15.55:2424"
                },
                {
                    "protocol": "ONetworkProtocolHttpDb",
                    "listen": "10.3.15.55:2480"
                }
            ],
            "databases": []
        }
    ]
}</code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-01-07 SAM -->
<h1 id="console---list-clusters"><a class="header" href="#console---list-clusters">Console - <code>LIST CLUSTERS</code></a></h1>
<p>Displays all configured clusters in the current database.</p>
<p><strong>Syntax:</strong></p>
<ul>
<li>
<p>Long Syntax:</p>
<pre><code>LIST CLUSTERS
</code></pre>
</li>
<li>
<p>Short Syntax:</p>
<pre><code>CLUSTERS
</code></pre>
</li>
</ul>
<p><strong>Example:</strong></p>
<ul>
<li>
<p>List current clusters on database:</p>
<pre>
orientdb> <code class="lang-sql userinput">LIST CLUSTERS</code>

CLUSTERS
-------------+------+-----------+-----------
 NAME        |  ID  | TYPE      | ELEMENTS  
-------------+------+-----------+-----------
 metadata    |    0 | Physical  |        11 
 index       |    1 | Physical  |         0 
 default     |    2 | Physical  |       779 
 csv         |    3 | Physical  |      1000 
 binary      |    4 | Physical  |      1001 
 person      |    5 | Physical  |         7 
 animal      |    6 | Physical  |         5 
 animalrace  |   -2 | Logical   |         0 
 animaltype  |   -3 | Logical   |         1 
 orderitem   |   -4 | Logical   |         0 
 order       |   -5 | Logical   |         0 
 city        |   -6 | Logical   |         3 
-------------+------+-----------+-----------
 TOTAL                                 2807 
--------------------------------------------
</pre>
</li>
</ul>
<blockquote>
<p>For information on creating new clusters in the current database, see the <a href="console/../sql/SQL-Create-Cluster.html"><code>CREATE CLUSTER</code></a> command.  For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-01-07 SAM -->
<h1 id="console---list-servers"><a class="header" href="#console---list-servers">Console - <code>LIST SERVERS</code></a></h1>
<p>Displays all active servers connected within a cluster.</p>
<blockquote>
<p>This command was introduced in OrientDB version 2.2.</p>
</blockquote>
<p><strong>Syntax:</strong></p>
<pre><code class="language-sql">LIST SERVERS
</code></pre>
<p><strong>Example:</strong></p>
<ul>
<li>
<p>List the servers currently connected to the cluster:</p>
<pre>
orientdb> <code class="lang-sql userinput">LIST SERVERS</code>

CONFIGURED SERVERS
-+----+------+-----------+-------------+-----------+-----------+-----------+----------+---------
#|Name|Status|Connections|StartedOn     |Binary    |HTTP       |UsedMemory |FreeMemory|MaxMemory
-+----+------+-----------+-------------+-----------+-----------+-----------+----------+---------
0|no2 |ONLINE|0          |2015-10-30...|192.168.0.6|192.168.0.6|80MB(8.80%)|215MB(23%)|910MB 
1|no1 |ONLINE|0          |2015-10-30...|192.168.0.6|192.168.0.6|90MB(2.49%)|195MB(5%) |3.5GB   
-+----+------+-----------+-------------+-----------+-----------+-----------+----------+---------
</pre>
</li>
<li>
<p>Use the <a href="console/Console-Command-Display-Record.html"><code>DISPLAY</code></a> command to show information on a specific server:</p>
<pre>
orientdb> <code class="lang-sql userinput">DISPLAY 0</code>
-------------+------------------------------
        Name | Value                        
-------------+------------------------------
        Name | node2
      Status | ONLINE
 Connections | 0
   StartedOn | Fri Oct 30 21:41:07 CDT 2015
      Binary | 192.168.0.6:2425 
        HTTP | 192.168.0.6:2481
  UsedMemory | 80,16MB (8,80%)
  FreeMemory | 215,34MB (23,65%)
   MaxMemory | 910,50MB
-------------+------------------------------
</pre>
</li>
</ul>
<blockquote>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="console---list-server-users"><a class="header" href="#console---list-server-users">Console - LIST SERVER USERS</a></h1>
<blockquote>
<p>This feature was introduced in OrientDB version 2.2.</p>
</blockquote>
<p>Displays all configured users on the server. In order to display the users, the current system user that is running the console must have permissions to read the <code>$ORIENTDB_HOME/config/orientdb-server-config.xml</code> configuration file. For more information, see <a href="console/../security/Server-Security.html">OrientDB Server Security</a>.</p>
<p><strong>Syntax:</strong></p>
<pre><code>LIST SERVER USERS
</code></pre>
<p><strong>Example:</strong></p>
<ul>
<li>
<p>List configured users on a server:</p>
<pre>
orientdb> <code class="lang-sql userinput">LIST SERVER USERS</code>

SERVER USERS
- 'root', permissions: *
- 'guest', permissions: connect,server.listDatabases,server.dblist
</pre>
</li>
</ul>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="console/Console-Command-Set-Server-User.html"><code>SET SERVER USER</code></a></li>
<li><a href="console/Console-Command-Drop-Server-User.html"><code>DROP SERVER USER</code></a></li>
</ul>
<p>For more information on other console commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="console---check-database"><a class="header" href="#console---check-database">Console - <code>CHECK DATABASE</code></a></h1>
<p>Checks the integrity of a database. In the case the database contains graphs, their consistency is checked. To repair a database, use <a href="console/Console-Command-Repair-Database.html">Repair Database Command</a>.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">CHECK DATABASE [--skip-graph] [-v]
</code></pre>
<ul>
<li><strong><code>[--skip-graph]</code></strong> Skips the check of the graph</li>
<li><strong><code>[-v]</code></strong> Verbose mode</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>Check a graph database:</li>
</ul>
<pre><code>  orientdb&gt; CHECK DATABASE

  Check of graph 'plocal:/temp/testdb' is started ...
  Scanning 1 edges (skipEdges=0)...
  + found corrupted edge E#17:0{out:#9:0,in:#11:0,test:true} v2 because incoming vertex (#11:0) does not contain the edge
  Scanning edges completed
  Scanning 710 vertices...
  + found corrupted vertex V#10:0{in_:[#17:0],name:Marko} v2 the edge should be removed from property in_ (ridbag)
  Scanning vertices completed
  Check of graph 'plocal:/temp/testdb' completed in 0 secs
   scannedEdges.....: 1
   edgesToRemove....: 1
   scannedVertices..: 710
   scannedLinks.....: 2
   linksToRemove....: 1
   verticesToRepair.: 0
  Check of storage completed in 296ms.  without errors.
</code></pre>
<blockquote>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="console---config"><a class="header" href="#console---config">Console - <code>CONFIG</code></a></h1>
<p>Displays the configuration information on the current database, as well as whether it is local or remote.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">CONFIG
</code></pre>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Display the configuration of the current database:</p>
<pre>
orientdb> <code class="userinput lang-sql">CONFIG</code>

REMOTE SERVER CONFIGURATION:
+------------------------------------+--------------------------------+
| NAME                               | VALUE                          |
+------------------------------------+--------------------------------+
| treemap.lazyUpdates                | 300                            |
| db.cache.enabled                   | false                          |
| file.mmap.forceRetry               | 5                              |
| treemap.optimizeEntryPointsFactor  | 1.0                            |
| storage.keepOpen                   | true                           |
| treemap.loadFactor                 | 0.7                            |
| file.mmap.maxMemory                | 110000000                      |
| network.http.maxLength             | 10000                          |
| storage.cache.size                 | 5000                           |
| treemap.nodePageSize               | 1024                           |
| ...                                | ...                            |
| treemap.entryPoints                | 30                             |
+------------------------------------+--------------------------------+
</pre>
</li>
</ul>
<blockquote>
<p>You can change configuration variables displayed here using the <a href="console/Console-Command-Config-Set.html"><code>CONFIG SET</code></a> command.  To display the value set to one configuration variable, use the <a href="console/Console-Command-Config-Get.html"><code>CONFIG GET</code></a> command.</p>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-01-07 SAM -->
<h1 id="console---config-get"><a class="header" href="#console---config-get">Console - <code>CONFIG GET</code></a></h1>
<p>Displays the value of the requested configuration variable.</p>
<p><strong>Syntax</strong></p>
<pre><code>CONFIG GET &lt;config-variable&gt;
</code></pre>
<ul>
<li><strong><code>&lt;config-variable&gt;</code></strong>  Defines the configuration variable you want to query.</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Display the value to the <code>tx.log.fileType</code> configuration variable:</p>
<pre>
orientdb> <code class="lang-sql userinput">CONFIG GET tx.log.fileType</code>

Remote configuration: tx.log.fileType = classic
</pre>
</li>
</ul>
<blockquote>
<p>You can display all configuration variables using the <a href="console/Console-Command-Config.html"><code>CONFIG</code></a> command. To change the values, use the <a href="console/Console-Command-Config-Set.html"><code>CONFIG SET</code></a> command.</p>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Config Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-01-07 SAM -->
<h1 id="console---config-set"><a class="header" href="#console---config-set">Console - <code>CONFIG SET</code></a></h1>
<p>Updates a configuration variable to the given value.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">CONFIG SET &lt;config-variable&gt; &lt;config-value&gt;
</code></pre>
<ul>
<li><strong><code>&lt;config-variable&gt;</code></strong> Defines the configuration variable you want to change.</li>
<li><strong><code>&lt;config-value&gt;</code></strong> Defines the value you want to set.</li>
</ul>
<p><strong>Example</strong></p>
<ul>
<li>
<p>Display the current value for <code>tx.autoRetry</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">CONFIG GET tx.autoRetry</code>

Remote configuration: tx.autoRetry = 1
</pre>
<p>Change the <code>tx.autoRetry</code> value to <code>5</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">CONFIG SET tx.autoRetry 5</code>

Remote configuration value changed correctly.
</pre>
<p>Display new value:</p>
<pre>
orientdb> <code class="lang-sql userinput">CONFIG GET tx.autoRetry</code>

Remote configuration: tx.autoRetry = 5
</pre>
</li>
</ul>
<blockquote>
<p>You can display all configuration variables with the <a href="console/Console-Command-Config.html"><code>CONFIG</code></a> command.  You can view the current value on a configuration variable using the <a href="console/Console-Command-Config-Get.html"><code>CONFIG GET</code></a> command.</p>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a></p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-01-07 SAM -->
<h1 id="console---connect"><a class="header" href="#console---connect">Console - <code>CONNECT</code></a></h1>
<blockquote>
<p>(deprecated, see <a href="console/Console-Command-Connect-Env.html">CONNECT ENV</a> and <a href="console/Console-Command-Open.html">OPEN</a>)</p>
</blockquote>
<p>Opens a database or connects to a server.</p>
<p><strong>Syntax</strong></p>
<pre><code>CONNECT &lt;database-url&gt; &lt;user&gt; &lt;password&gt;
</code></pre>
<ul>
<li><strong><code>&lt;database-url&gt;</code></strong> Defines the URL of the database you want to connect to.  It uses the format <code>&lt;mode&gt;:&lt;path&gt;</code>
<ul>
<li><em><code>&lt;mode&gt;</code></em> Defines the mode you want to use in connecting to the database.  It can be <code>plocal</code> or <code>remote</code>.</li>
<li><em><code>&lt;path&gt;</code></em> Defines the path to the database.</li>
</ul>
</li>
<li><strong><code>&lt;user&gt;</code></strong> Defines the user you want to connect to the database with.</li>
<li><strong><code>&lt;password&gt;</code></strong> Defines the password needed to connect to the database, with the defined user.</li>
</ul>
<p><strong>Examples:</strong></p>
<ul>
<li>
<p>Connect to a local database as the user <code>admin</code>, loading it directly into the console:</p>
<pre>
orientdb> <code class="userinput lang-sql">connect plocal:../databases/GratefulDeadConcerts admin my_admin_password</code>

Connecting to database [plocal:../databases/GratefulDeadConcerts]...OK
</pre>
</li>
<li>
<p>Connect to a remote database:</p>
<pre>
orientdb> <code class="lang-sql userinput">connect remote:192.168.1.1/GratefulDeadConcerts admin my_admin_password</code>

Connecting to database [remote:192.168.1.1/GratefulDeadConcerts]...OK
</pre>
</li>
</ul>
<blockquote>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><hr />
<h2>search:
keywords: ['console', 'command', 'connection', 'CONNECT']</h2>
<h1 id="console---connect-env"><a class="header" href="#console---connect-env">Console - <code>CONNECT ENV</code></a></h1>
<p>(since v 3.2)</p>
<p>Connects the console to an OrientDB server or to an embedded environment.</p>
<p><strong>Syntax</strong></p>
<pre><code>CONNECT ENV &lt;env-url&gt; [&lt;user&gt; &lt;password&gt;]
</code></pre>
<ul>
<li><strong><code>&lt;env-url&gt;</code></strong> defines the URL of an OrientDB server/environment. It uses the format <code>&lt;mode&gt;:&lt;path&gt;</code>
<ul>
<li><em><code>&lt;mode&gt;</code></em> Defines the mode you want to use in connecting to the database.  It can be <code>plocal</code> or <code>remote</code>.</li>
<li><em><code>&lt;path&gt;</code></em> Defines the path to the database.</li>
</ul>
</li>
<li><strong><code>&lt;user&gt;</code></strong> Defines the user you want to connect with.</li>
<li><strong><code>&lt;password&gt;</code></strong> Defines the password needed to connect, with the defined user. User and password are needed to execute authenticated operations on the environment (eg. create a database on a remote server); they are not needed for operations that do not require an authentication or that require different credentials (eg. to open a database you can pass the database user and password, see <a href="console/Console-Command-Open.html">OPEN</a>)</li>
</ul>
<p>After the console is connected to an environment, it allows to execute operations and <a href="console/../serverlevel/README.html">Server-Level</a> commands on it.</p>
<p><strong>Examples:</strong></p>
<ul>
<li>
<p>Connect the console to a local (embedded) environment as the user <code>root</code>, loading it directly into the console:</p>
<pre>

orientdb> <code class="userinput lang-sql">connect env plocal:../databases/</code>
  
</pre>
</li>
<li>
<p>Connect to a remote server:</p>
<pre>
orientdb> <code class="lang-sql userinput">connect env remote:192.168.1.1 root root</code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-01-07 SAM -->
<h1 id="console---create-database"><a class="header" href="#console---create-database">Console - <code>CREATE DATABASE</code></a></h1>
<blockquote>
<p>WARNING: OrientDB v 3.2 includes some important changes to DB creation; in particular, default database users/passwords are not created anymore. The console command <code>CREATE DATABASE</code> had a specific behaviour that relied on default users: it created the database and THEN connected to the DB using admin/admin. This is not possible anymore, so we had to change the syntax AND the semantics of the command</p>
</blockquote>
<p>Creates and connects to a new database.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">CREATE DATABASE &lt;database-name&gt; &lt;storage-type&gt; [users ( (&lt;username&gt; identified by &lt;password&gt; role &lt;rolename&gt;)* )]
</code></pre>
<ul>
<li><strong><code>&lt;database-name&gt;</code></strong> Defines the name of the database you want to create.</li>
<li><strong><code>&lt;storage-type&gt;</code></strong> Defines the storage type that you want to use.  You can choose between <code>PLOCAL</code> and <code>MEMORY</code>.</li>
<li><strong><code>&lt;username&gt;</code></strong> The name of a user to create</li>
<li><strong><code>&lt;password&gt;</code></strong> The password of this newly created user</li>
<li><strong><code>&lt;rolename&gt;</code></strong> The role name of this user</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Create a local database <code>demo</code> without default users:</p>
<pre>

orientdb> <code class="lang-sql userinput">CONNECT ENV embedded:/my/databases/dir root root</code>
  
orientdb> <code class="lang-sql userinput">CREATE DATABASE demo plocal </code>

Database created successfully.
</pre>
</li>
<li>
<p>Create a remote database <code>demo</code> without default users:</p>
<pre>

orientdb> <code class="lang-sql userinput">CONNECT ENV remote:localhost root root</code>
  
orientdb> <code class="lang-sql userinput">CREATE DATABASE demo plocal </code>

Database created successfully.
</pre>
</li>
<li>
<p>Create a remote database <code>demo</code> with an "admin" and a "reader" user:</p>
<pre>

orientdb> <code class="lang-sql userinput">CONNECT ENV remote:localhost root root</code>
  
orientdb> <code class="lang-sql userinput">CREATE DATABASE demo plocal users (admin identified by 'MyAdminPassword' role admin, reader identified by 'MyReaderPw' role reader) </code>

Database created successfully.
</pre>
</li>
</ul>
<p><strong>Old Syntax</strong></p>
<p>(still compatible in v 3.2)</p>
<pre><code class="language-sql">CREATE DATABASE &lt;database-url&gt; [&lt;user&gt; &lt;password&gt; &lt;storage-type&gt; [&lt;db-type&gt;]] [-restore=&lt;backup-path&gt;]
</code></pre>
<ul>
<li><strong><code>&lt;database-url&gt;</code></strong> Defines the URL of the database you want to connect to. It uses the format <code>&lt;mode&gt;:&lt;path&gt;</code>
<ul>
<li><em><code>&lt;mode&gt;</code></em> Defines the mode you want to use in connecting to the database.  It can be <code>PLOCAL</code> or <code>REMOTE</code>.</li>
<li><em><code>&lt;path&gt;</code></em> Defines the path to the database.</li>
</ul>
</li>
<li><strong><code>&lt;user&gt;</code></strong> Defines the user you want to connect to the database with.</li>
<li><strong><code>&lt;password&gt;</code></strong> Defines the password needed to connect to the database, with the defined user.</li>
<li><strong><code>&lt;storage-type&gt;</code></strong> Defines the storage type that you want to use.  You can choose between <code>PLOCAL</code> and <code>MEMORY</code>.</li>
<li><strong><code>&lt;db-type&gt;</code></strong> Defines the database type.  You can choose between <code>GRAPH</code> and <code>DOCUMENT</code>.  The default is <code>GRAPH</code>.</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Create a local database <code>demo</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE DATABASE PLOCAL:/usr/local/orientdb/databases/demo</code>

Creating database [plocal:/usr/local/orientdb/databases/demo]...
Connecting to database [plocal:/usr/local/orientdb/databases/demo]...OK
Database created successfully.

Current database is: plocal:/usr/local/orientdb/databases/demo

orientdb {db=demo}>
</pre>
</li>
<li>
<p>Create a remote database <code>trick</code>:</p>
<pre>
orientdb> <code class='lang-sql userinput'>CREATE DATABASE REMOTE:192.168.1.1/trick root 
          E30DD873203AAA245952278B4306D94E423CF91D569881B7CAD7D0B6D1A20CE9 PLOCAL</code>

Creating database [remote:192.168.1.1/trick ]...
Connecting to database [remote:192.168.1.1/trick ]...OK
Database created successfully.

Current database is: remote:192.168.1.1/trick

orientdb {db=trick}>
</pre>
</li>
</ul>
<blockquote>
<p>To create a static database to use from the server, see <a href="console/../internals/DB-Server.html#storages"><code>Server pre-configured storage types</code></a>.</p>
<p>To remove a database, see <a href="console/Console-Command-Drop-Database.html"><code>DROP DATABASE</code></a>.  To change database configurations after creation, see <a href="console/../sql/SQL-Alter-Database.html"><code>ALTER DATABASE</code></a>.</p>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<p><strong>Incremental restore option</strong></p>
<p>You can execute an incremental restore at creation time through the option <code>-restore</code> specifying as value the path where your backup is placed. Let's suppose we want create a new fresh database "mydb" and restore data from a backup, located in <code>/tmp/backup</code>, performed from another database in one shot. In this case we can type:</p>
<pre><code>orientdb&gt; create database remote:localhost/mydb root root plocal graph -restore=/tmp/backup

Creating database [remote:localhost/mydb] using the storage type [plocal]...
Connecting to database [remote:localhost/mydb] with user 'admin'...OK

Database created successfully.

Current database is: remote:localhost/mydb
</code></pre>
<p>For further details on incremental backup and restore you can refer to the page <a href="console/../admin/Incremental-Backup-And-Restore.html">Incremental Backup and Restore</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-01-07 SAM -->
<h1 id="console---declare-intent"><a class="header" href="#console---declare-intent">Console - <code>DECLARE INTENT</code></a></h1>
<p>Declares an intent for the current database. Intents allow you to tell the database what you want to do.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">DECLARE INTENT &lt;intent-name&gt;
</code></pre>
<ul>
<li><strong><code>&lt;intent-name&gt;</code></strong> Defines the name of the intent. OrientDB supports three intents:
<ul>
<li><em><code>NULL</code></em> Removes the current intent.</li>
<li><em><code>MASSIVEINSERT</code></em></li>
<li><em><code>MASSIVEREAD</code></em></li>
</ul>
</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Declare an intent for a massive insert:</p>
<pre>
orientdb> <code class="lang-sql userinput">DECLARE INTENT MASSIVEINSERT</code>
</pre>
</li>
<li>
<p>After the insert, clear the intent:</p>
<pre>
orientdb> <code class="lang-sql userinput">DECLARE INTENT NULL</code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-01-07 SAM -->
<h1 id="console---dictionary-get"><a class="header" href="#console---dictionary-get">Console - <code>DICTIONARY GET</code></a></h1>
<p>Displays the value of the requested key, loaded from the database dictionary.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">DICTIONARY GET &lt;key&gt;
</code></pre>
<ul>
<li><strong><code>&lt;key&gt;</code></strong> Defines the key you want to access.</li>
</ul>
<p><strong>Example</strong></p>
<ul>
<li>
<p>In a dictionary of U.S. presidents, display the entry for Barack Obama:</p>
<pre>
orientdb> <code class='lang-sql userinput'>DICTIONARY GET obama</code>

-------------------------------------------------------------------------
Class: Person id: 5:4 v.1
-------------------------------------------------------------------------
    parent: null
 children : [Person@5:5{parent:Person@5:4,children:null,name:Malia Ann,
            surname:Obama,city:null}, Person@5:6{parent:Person@5:4,
            children:null,name:Natasha,surname:Obama,city:null}]
     name : Barack
  surname : Obama
     city : City@-6:2{name:Honolulu}
-------------------------------------------------------------------------
</pre>
</li>
</ul>
<blockquote>
<p>You can display all keys stored in a database using the <a href="console/Console-Command-Dictionary-Keys.html"><code>DICTIONARY KEYS</code></a> command. For more information on indexes, see <a href="console/../indexing/Indexes.html">Indexes</a>.</p>
</blockquote>
<blockquote>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="console---dictionary-keys"><a class="header" href="#console---dictionary-keys">Console - <code>DICTIONARY KEYS</code></a></h1>
<p>Displays all the keys stored in the database dictionary.</p>
<p><strong>Syntax</strong></p>
<pre><code>DICTIONARY KEYS
</code></pre>
<p><strong>Example</strong></p>
<ul>
<li>
<p>Display all the keys stored in the database dictionary:</p>
<pre>
orientdb> <code class='lang-sql userinput'>DICTIONARY KEYS</code>

Found 4 keys:
#0: key-148
#1: key-147
#2: key-146
#3: key-145
</pre>
</li>
</ul>
<blockquote>
<p>To load the records associated with these keys, use the <a href="console/Console-Command-Dictionary-Get.html"><code>DICTIONARY GET</code></a> command.  For more information on indexes, see <a href="console/../indexing/Indexes.html">Indexes</a>.</p>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-01-07 SAM -->
<h1 id="console---dictionary-put"><a class="header" href="#console---dictionary-put">Console - <code>DICTIONARY PUT</code></a></h1>
<p>Binds a record to a key in the dictionary database, making it accessible to the <a href="console/Console-Command-Dictionary-Get.html"><code>DICTIONARY GET</code></a> command.</p>
<p><strong>Syntax</strong></p>
<pre><code>DICTIONARY PUT &lt;key&gt; &lt;record-id&gt;
</code></pre>
<ul>
<li><strong><code>&lt;key&gt;</code></strong> Defines the key you want to bind.</li>
<li><strong><code>&lt;record-id&gt;</code></strong> Defines the ID for the record you want to bind to the key.</li>
</ul>
<p><strong>Example</strong></p>
<ul>
<li>
<p>In the database dictionary of U.S. presidents, bind the record for Barack Obama to the key <code>obama</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">DICTIONARY PUT obama 5:4</code>

------------------------------------------------------------------------
 Class: Person  id: 5:4  v.1
------------------------------------------------------------------------
    parent : null
  children : [Person@5:5{parent:Person@5:4,children:null,name:Malia Ann,
             surname:Obama,city:null}, Person@5:6{parent:Person@5:4,
             children:null,name:Natasha,surname:Obama,city:null}]
      name : Barack
   surname : Obama
      city : City@-6:2{name:Honolulu}
------------------------------------------------------------------------
The entry obama=5:4 has been inserted in the database dictionary
</pre>
</li>
</ul>
<blockquote>
<p>To see all the keys stored in the database dictionary, use the <a href="console/Console-Command-Dictionary-Keys.html"><code>DICTIONARY KEYS</code></a> command.  For more information on dictionaries and indexes, see <a href="console/../indexing/Indexes.html">Indexes</a>.</p>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-01-07 SAM -->
<h1 id="console---dictionary-remove"><a class="header" href="#console---dictionary-remove">Console - <code>DICTIONARY REMOVE</code></a></h1>
<p>Removes the association from the database dictionary.</p>
<p><strong>Syntax</strong></p>
<pre><code>DICTIONARY REMOVE &lt;key&gt;
</code></pre>
<ul>
<li><strong><code>&lt;key&gt;</code></strong> Defines the key that you want to remove.</li>
</ul>
<p><strong>Example</strong></p>
<ul>
<li>
<p>In a database dictionary of U.S. presidents, remove the key for Barack Obama:</p>
<pre>
orientdb> <code class="lang-sql userinput">DICTIONARY REMOVE obama</code>

Entry removed from the dictionary. Last value of entry was:
------------------------------------------------------------------------
Class: Person   id: 5:4   v.1
------------------------------------------------------------------------
   parent : null
 children : [Person@5:5{parent:Person@5:4,children:null,name:Malia Ann,
            surname:Obama,city:null}, Person@5:6{parent:Person@5:4,
            children:null,name:Natasha,surname:Obama,city:null}]
     name : Barack
  surname : Obama
     city : City@-6:2{name:Honolulu}
------------------------------------------------------------------------
</pre>
</li>
</ul>
<blockquote>
<p>You can display information for all keys stored in the database dictionary using the <a href="console/Console-Command-Dictionary-Keys.html"><code>DICTIONARY KEY</code></a> command.  For more information on dictionaries and indexes, see <a href="console/../indexing/Indexes.html">Indexes</a>.</p>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="console---disconnect"><a class="header" href="#console---disconnect">Console - DISCONNECT</a></h1>
<p>Closes the currently opened database.</p>
<p><strong>Syntax</strong></p>
<pre><code>DISCONNECT
</code></pre>
<p><strong>Example</strong></p>
<ul>
<li>
<p>Disconnect from the current database:</p>
<pre>
orientdb> <code class='lang-sql userinput'>DISCONNECT</code>

Disconnecting from the database [../databases/petshop/petshop]...OK
</pre>
</li>
</ul>
<blockquote>
<p>To connect to a database, see <a href="console/Console-Command-Connect.html"><code>CONNECT</code></a>.  For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="console---displays-record"><a class="header" href="#console---displays-record">Console - DISPLAYS RECORD</a></h1>
<p>Displays details on the given record from the last returned result-set.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">DISPLAY RECORD &lt;record-number&gt;
</code></pre>
<ul>
<li><strong><code>&lt;record-number&gt;</code></strong> Defines the relative position of the record in the last result-set.</li>
</ul>
<p><strong>Example</strong></p>
<ul>
<li>
<p>Query the database on the class <code>Person</code> to generate a result-set:</p>
<pre>
orientdb> <code class='lang-sql userinput'>SELECT FROM Person</code>

---+-----+--------+----------+-----------+-----------+------
 # | RID | PARENT | CHILDREN | NAME      | SURNAME   | City
---+-----+--------+----------+-----------+-----------+------
 0 | 5:0 | null   | null     | Giuseppe  | Garibaldi | -6:0
 1 | 5:1 | 5:0    | null     | Napoleon  | Bonaparte | -6:0
 2 | 5:2 | 5:3    | null     | Nicholas  | Churchill | -6:1
 3 | 5:3 | 5:2    | null     | Winston   | Churchill | -6:1
 4 | 5:4 | null   | [2]      | Barack    | Obama     | -6:2
 5 | 5:5 | 5:4    | null     | Malia Ann | Obama     | null
 6 | 5:6 | 5:4    | null     | Natasha   | Obama     | null
---+-----+--------+----------+-----------+-----------+------
7 item(s) found. Query executed in 0.038 sec(s).
</pre>
</li>
<li>
<p>With the result-set ready, display record number four in the result-set, (for Malia Ann Obama):</p>
<pre>
orientdb> <code class='lang-sql userinput'>DISPLAY RECORD 5</code>

------------------------------------------------------------------------
Class: Person   id: 5:5   v.0
------------------------------------------------------------------------
  parent : Person@5:4{parent:null,children:[Person@5:5, Person@5:6],
           name:Barack,surname:Obama,city:City@-6:2}
 children : null
     name : Malia Ann
  surname : Obama
      city : null
------------------------------------------------------------------------
</pre>
</li>
</ul>
<blockquote>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="console---displays-raw-record"><a class="header" href="#console---displays-raw-record">Console - <code>DISPLAYS RAW RECORD</code></a></h1>
<p>Displays details on the given record from the last returned result-set in a binary format.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">DISPLAY RAW RECORD &lt;record-number&gt;
</code></pre>
<ul>
<li><strong><code>&lt;record-number&gt;</code></strong> Defines the relative position of the record in the last result-set.</li>
</ul>
<p><strong>Example</strong></p>
<ul>
<li>
<p>Query the database on the class <code>V</code> to generate a result-set:</p>
<pre>
orientdb {db=GratefulDeadConcerts}> <code class="lang-sql userinput">SELECT song_type, name, performances FROM V LIMIT 6</code>

-----+-------+--------+----------+-------------------------+--------------
 #   | @RID  | @CLASS | song_type | name                   | performances
-----+-------+--------+----------+-------------------------+--------------
 0   | #9:1  | V      | cover     | HEY BO DIDDLEY         | 5                 
 1   | #9:2  | V      | cover     | IM A MAN               | 1                 
 2   | #9:3  | V      | cover     | NOT FADE AWAY          | 531               
 3   | #9:4  | V      | original  | BERTHA                 | 394               
 4   | #9:5  | V      | cover     | GOING DOWN THE ROAD... | 293               
 5   | #9:6  | V      | cover     | MONA                   | 1                
 6   | #9:7  | V      | null      | Bo_Diddley             | null       
-----+-------+--------+-----------+------------------------+-------------
LIMIT EXCEEDED: resultset contains more items not displayed (limit=6)
6 item(s) found. Query executed in 0.136 sec(s).
</pre>
</li>
<li>
<p>Display raw record on the song "Hey Bo Diddley" from the result-set:</p>
<pre>
orientdb {db=GratefulDeadConcerts}> <code class="lang-sql userinput">DISPLAY RAW RECORD 0</code>

Raw record content. The size is 292 bytes, while settings force to print first 150 bytes:

^@^BV^Rsong_type^@^@^@^G^Hname^@^@^@^G^Htype^@^@^@ ^G^Xperformances^@^@^@ ^A^^out_followed_by^@^@^@ ^V^\out_written)by^@^@^@ ^V^Vout_sung_by^@^@^@ ^V^\in_followed_by^@^@^@ ^V^@civer^\HEY Bo D
</pre>
</li>
</ul>
<blockquote>
<p>For more information on other commands available, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="console---drop-database"><a class="header" href="#console---drop-database">Console - <code>DROP DATABASE</code></a></h1>
<p>Removes a database completely.  If the database is open and a database name not given, it removes the current database.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">DROP DATABASE [&lt;database-name&gt; &lt;server-username&gt; &lt;server-user-password&gt;]
</code></pre>
<ul>
<li><strong><code>&lt;database-name</code></strong> Defines the database you want to drop.  By default it uses the current database, if it's open.</li>
<li><strong><code>&lt;server-username&gt;</code></strong> Defines the server user.  This user must have the privileges to drop the database.</li>
<li><strong><code>&lt;server-user-password&gt;</code></strong> Defines the password for the server user.</li>
</ul>
<blockquote>
<p><strong>NOTE</strong>: When you drop a database, it deletes the database and all records, caches and schema information it contains.  Unless you have made backups, there is no way to restore the database after you drop it.</p>
</blockquote>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Remove the current local database:</p>
<pre>
orientdb> <code class="lang-sql userinput">DROP DATABASE</code>
</pre>
</li>
<li>
<p>Remove the database <code>demo</code> at localhost:</p>
<pre>
orientdb> <code class="lang-sql userinput">DROP DATABASE REMOTE:localhost/demo root root_password</code>
</pre>
</li>
</ul>
<blockquote>
<p>You can create a new database using the <a href="console/Console-Command-Create-Database.html"><code>CREATE DATABASE</code></a> command.  To make changes to an existing database, use the <a href="console/../sql/SQL-Alter-Database.html"><code>ALTER DATABASE</code></a> command.</p>
</blockquote>
<blockquote>
<p>For more information on other commands, please refer to <a href="console/Console-Commands.html">Console Commands</a> and <a href="console/../sql/SQL-Commands.html">SQL Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="console---drop-server-user"><a class="header" href="#console---drop-server-user">Console - <code>DROP SERVER USER</code></a></h1>
<p>Removes a user from the server.  In order to do so, the current system user running the Console, must have permissions to write to the <code>$ORIENTDB_HOME/config/orientdb-server-config.xmL</code> configuration file.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">DROP SERVER USER &lt;user-name&gt;
</code></pre>
<ul>
<li><strong><code>&lt;user-name&gt;</code></strong> Defines the user you want to drop.</li>
</ul>
<blockquote>
<p><strong>NOTE</strong>: For more information on server users, see <a href="console/../security/Server-Security.html">OrientDB Server Security</a>.</p>
</blockquote>
<blockquote>
<p>This feature was introduced in version 2.2.</p>
</blockquote>
<p><strong>Example</strong></p>
<ul>
<li>
<p>Remove the user <code>editor</code> from the Server:</p>
<pre>
orientdb> <code class="lang-sql userinput">DROP SERVER USER editor</code>

Server user 'editor' dropped correctly
</pre>
</li>
</ul>
<blockquote>
<p>To view the current server users, see the <a href="console/Console-Command-List-Server-Users.html"><code>LIST SERVER USERS</code></a> command.  To create or update a server user, see the <a href="console/Console-Command-Set-Server-User.html"><code>SET SERVER USER</code></a> command.</p>
</blockquote>
<blockquote>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="console---export"><a class="header" href="#console---export">Console - <code>EXPORT</code></a></h1>
<p>Exports the current database to a file.  OrientDB uses a JSON-based <a href="console/../admin/Export-Format.html">Export Format</a>.  By default, it compresses the file using the GZIP algorithm.</p>
<p>With the <a href="console/Console-Command-Import.html"><code>IMPORT</code></a> command, this allows you to migrate the database between different versions of OrientDB without losing data.</p>
<blockquote>
<p>If you receive an error about the database version, export the database using the same version of OrientDB that has generated the database.</p>
</blockquote>
<p>Bear in mind, exporting a database browses it, rather than locking it.  While this does mean that concurrent operations can execute during the export, it also means that you cannot create an exact replica of the database at the point when the command is issued.  In the event that you need to create a snapshot, use the <a href="console/Console-Command-Backup.html"><code>BACKUP</code></a> command.</p>
<p>You can restore a database from an export using the <a href="console/Console-Command-Import.html"><code>IMPORT</code></a>.</p>
<blockquote>
<p><strong>NOTE</strong>: While the export format is JSON, there are some constraints in the field order.  Editing this file or adjusting its indentation may cause imports to fail.</p>
</blockquote>
<p><strong>Syntax</strong></p>
<p>By default, this command exports the full database.  Use its options to disable the parts you don't need to export.</p>
<pre><code class="language-sql">EXPORT DATABASE &lt;output-file&gt;
      [-excludeAll]
      [-includeClass=&lt;class-name&gt;*]
      [-excludeClass=&lt;class-name&gt;*]
      [-includeCluster=&lt;cluster-name&gt;*]
      [-excludeCluster=&lt;cluster-name&gt;*]
      [-includeInfo=&lt;true|false&gt;]
      [-includeClusterDefinitions=&lt;true|false&gt;]
      [-includeSchema=&lt;true|false&gt;]
      [-includeSecurity=&lt;true|false&gt;]
      [-includeRecords=&lt;true|false&gt;]
      [-includeIndexDefinitions=&lt;true|false&gt;]
      [-includeManualIndexes=&lt;true|false&gt;]
      [-compressionLevel=&lt;0-9&gt;]
      [-compressionBuffer=&lt;bufferSize&gt;]
</code></pre>
<ul>
<li><strong><code>&lt;output-file&gt;</code></strong> Defines the path to the output file.</li>
<li><strong><code>-excludeAll</code></strong> Sets the export to exclude everything not otherwise included through command options</li>
<li><strong><code>-includeClass</code></strong> Export includes certain classes, specifically those defined by a space-separated list.In case you specify multiple class names, you have to wrap the list between quotes, eg. <code>-includeClass="Foo Bar Baz"</code></li>
<li><strong><code>-excludeClass</code></strong> Export excludes certain classes, specifically those defined by a space-separated list.</li>
<li><strong><code>-includeCluster</code></strong> Export includes certain clusters, specifically those defined by a space-separated list.</li>
<li><strong><code>-excludeCluster</code></strong> Export excludes certain clusters, specifically those defined by a space-separated list.</li>
<li><strong><code>-includeInfo</code></strong> Defines whether the export includes database information.</li>
<li><strong><code>-includeClusterDefinitions</code></strong> Defines whether the export includes cluster definitions.</li>
<li><strong><code>-includeSchema</code></strong> Defines whether the export includes the database schema.</li>
<li><strong><code>-includeSecurity</code></strong> Defines whether the export includes database security parameters.</li>
<li><strong><code>-includeRecords</code></strong> Defines whether the export includes record contents.</li>
<li><strong><code>-includeIndexDefinitions</code></strong> Defines whether the export includes the database index definitions.</li>
<li><strong><code>-includeManualIndexes</code></strong> Defines whether the export includes manual index contents.</li>
<li><strong><code>-compressionLevel</code></strong> Defines the compression level to use on the export, in a range between <code>0</code> (no compression) and <code>9</code> (maximum compression).  The default is <code>1</code>.  (Feature introduced in version 1.7.6.)</li>
<li><strong><code>-compressionBuffer</code></strong> Defines the compression buffer size in bytes to use in compression.  The default is 16kb.  (Feature introduced in version 1.7.6.)</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Export the current database, including everything:</p>
<pre>
orientdb> <code class='lang-sql userinput'>EXPORT DATABASE C:\temp\petshop.export</code>

Exporting current database to: C:\temp\petshop.export...

Exporting database info...OK
Exporting dictionary...OK
Exporting schema...OK
Exporting clusters...
- Exporting cluster 'metadata' (records=11) -> ...........OK
- Exporting cluster 'index' (records=0) -> OK
- Exporting cluster 'default' (records=779) -> OK
- Exporting cluster 'csv' (records=1000) -> OK
- Exporting cluster 'binary' (records=1001) -> OK
- Exporting cluster 'person' (records=7) -> OK
- Exporting cluster 'animal' (records=5) -> OK
- Exporting cluster 'animalrace' (records=0) -> OK
- Exporting cluster 'animaltype' (records=1) -> OK
- Exporting cluster 'orderitem' (records=0) -> OK
- Exporting cluster 'order' (records=0) -> OK
- Exporting cluster 'city' (records=3) -> OK
Export of database completed.
</pre>
</li>
<li>
<p>Export the current database, including only its functions:</p>
<pre>
orientdb> <code class='lang-sql userinput'>EXPORT DATABASE functions.gz -includeClass=OFunction -includeInfo=FALSE 
          -includeClusterDefinitions=FALSE -includeSchema=FALSE 
          -includeIndexDefinitions=FALSE -includeManualIndexes=FALSE</code>
</pre>
</li>
<li>
<p>Alternatively, you can simplify the above by excluding all, then including only those features that you need.  For instance, export the current database, including only the schema:</p>
<pre>
orientdb> <code class='lang-sql userinput'>EXPORT DATABASE schema.gz -excludeALL -includeSchema=TRUE</code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information on backups and restores, imports and exports, see the following commands:</p>
<ul>
<li><a href="console/Console-Command-Import.html">IMPORT DATABASE</a></li>
<li><a href="console/Console-Command-Backup.html">BACKUP DATABASE</a></li>
<li><a href="console/Console-Command-Restore.html">RESTORE DATABASE</a></li>
</ul>
<p>as well as the following pages:</p>
<ul>
<li><a href="console/../admin/Export-Format.html">Export File Format</a></li>
<li><a href="https://github.com/orientechnologies/orientdb/blob/master/core/src/main/java/com/orientechnologies/orient/core/db/tool/ODatabaseExport.java"><code>ODatabaseExport</code></a>
Java Class</li>
</ul>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="console---export-record"><a class="header" href="#console---export-record">Console - <code>EXPORT RECORD</code></a></h1>
<p>Exports the current record, using the requested format.  In the event that you give a format that OrientDB does not support, it provides a list of supported formats.</p>
<p><strong>Syntax</strong></p>
<pre><code>EXPORT RECORD &lt;format&gt;
</code></pre>
<ul>
<li><strong><code>&lt;format&gt;</code></strong> Defines the export format you want to use.</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Use <a href="console/../sql/SQL-Query.html"><code>SELECT</code></a> to create a record for export:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT name, surname, parent, children, city FROM Person WHERE 
          name='Barack' AND surname='Obama'</code>

---+-----+--------+---------+--------+------------+------
 # | RID | name   | surname | parent | children   | city
---+-----+--------+---------+--------+------------+------
 0 | 5:4 | Barack | Obama   | null   | [5:5, 5:6] | -6:2
---+-----+--------+---------+--------+------------+------
</pre>
</li>
<li>
<p>Export JSON data from this record:</p>
<pre>
orientdb> <code class="lang-sql userinput">EXPORT RECORD JSON</code>

{
  'name': 'Barack',
  'surname': 'Obama',
  'parent': null,
  'children': [5:5, 5:6],
  'city': -6:2
}
</pre>
</li>
<li>
<p>Use a bad format value to determine what export formats are available on your database:</p>
<pre> 
orientdb> <code class="lang-sql userinput">EXPORT RECORD GIBBERISH</code>

ERROR: Format 'GIBBERISH' was not found.
Supported formats are:
- json
- ORecordDocument2csv
</pre>
</li>
</ul>
<blockquote>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="console---freeze-database"><a class="header" href="#console---freeze-database">Console - <code>FREEZE DATABASE</code></a></h1>
<p>Flushes all cached content to disk and restricts permitted operations to read commands.  With the exception of reads, none of the commands made on a frozen database execute.  It remains in this state until you run the <a href="console/Console-Command-Release-Db.html"><code>RELEASE</code></a> command.</p>
<p>Executing this command requires server administration rights.  You can only execute it on remote databases.  If you would like to freeze or release a local database, use the <code>ODatabase.freeze()</code> and <code>ODatabase.release()</code> methods directly through the OrientDB API.</p>
<blockquote>
<p>You may find this command useful in the event that you would like to perform backups on a live database.  To do so, freeze the database, perform a file system snapshot, then release the database.  You can now copy the snapshot anywhere you want.</p>
</blockquote>
<blockquote>
<p>This works best when the backup doesn't take very long to run.</p>
</blockquote>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">FREEZE DATABASE
</code></pre>
<p><strong>Example</strong></p>
<ul>
<li>
<p>Freezes the current database:</p>
<pre>
orientdb> <code class='lang-sql userinput'>FREEZE DATABASE</code>
</pre>
</li>
</ul>
<blockquote>
<p>To unfreeze a database, use the <a href="console/Console-Command-Release-Db.html"><code>RELEASE DATABASE</code></a> command.</p>
</blockquote>
<blockquote>
<p>For more information on other commands, please refer to <a href="console/Console-Commands.html">Console Commands</a> and <a href="console/../sql/SQL-Commands.html">SQL Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="console---get"><a class="header" href="#console---get">Console - <code>GET</code></a></h1>
<p>Returns the value of the requested property.</p>
<p><strong>Syntax</strong></p>
<pre><code>GET &lt;property-name&gt;
</code></pre>
<ul>
<li><strong><code>&lt;property-name&gt;</code></strong> Defines the name of the property.</li>
</ul>
<p><strong>Example</strong></p>
<ul>
<li>
<p>Find the default limit on your database:</p>
<pre>
orientdb> <code class="lang-sql userinput">GET LIMIT</code>

limit = 20
</pre>
</li>
</ul>
<blockquote>
<p>To display all available properties configured on your database, use the <a href="console/Console-Command-Properties.html"><code>PROPERTIES</code></a> command.</p>
</blockquote>
<blockquote>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="console---import"><a class="header" href="#console---import">Console - <code>IMPORT</code></a></h1>
<p>Imports an exported database into the current one open. Import process doesn't lock the database, so any concurrent operations are allowed, but they could interfere in the import process causing errors.</p>
<p>The input file must use the JSON <a href="console/../admin/Export-Format.html">Export Format</a>, as generated by the <a href="console/Console-Command-Export.html"><code>EXPORT</code></a> command.  By default, this file is compressed using the GZIP algorithm.</p>
<p>With <a href="console/Console-Command-Export.html"><code>EXPORT</code></a>, this command allows you to migrate between releases without losing data, by exporting data from the old version and importing it into the new version.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">IMPORT DATABASE &lt;input-file&gt; [-format = &lt;format&gt;]
                             [-preserveClusterIDs = &lt;true|false&gt;]
                             [-deleteRIDMapping = &lt;true|false&gt;]
                             [-merge = &lt;true|false&gt;]
                             [-migrateLinks = &lt;true|false&gt;]
                             [-rebuildIndexes = &lt;true|false&gt;]
</code></pre>
<ul>
<li><strong><code>&lt;format&gt;</code></strong> Is the input file format. If not specified, OrientDB tries to recognize it. The available formats are (since v2.2.8):</li>
<li><strong>orientdb</strong>, the <a href="console/Console-Command-Export.html">OrientDB export file format</a></li>
<li><strong>graphml</strong>, for <a href="https://en.wikipedia.org/wiki/GraphML">Graph XML</a></li>
<li><strong>graphson</strong>, for <a href="https://github.com/tinkerpop/blueprints/wiki/GraphSON-Reader-and-Writer-Library">Graph JSON</a></li>
<li><strong><code>&lt;input-file&gt;</code></strong> Defines the path to the file you want to import.</li>
<li><strong><code>-preserveClusterIDs</code></strong> Defines whether you want to preserve cluster ID's during the import.  When turned off, the import creates temporary cluster ID's, which can sometimes fail.  This option is only valid with PLocal storage.</li>
<li><strong><code>-deleteRIDMapping</code></strong> Defines whether you want to preserve the dictionary index used by the import to map old RIDs to new RIDs. The index name is <code>___exportImportRIDMap</code> and you could use in your application.  By default the index is removed after the import.</li>
<li><strong><code>-merge</code></strong> Defines whether you want to merge the import with the data already in the current database.  When turned off, the default, the import overwrites current data, with the exception of security classes, (<code>ORole</code>, <code>OUser</code>, <code>OIdentity</code>), which it always preserves.  This feature was introduced in version 1.6.1.</li>
<li><strong><code>-migrateLinks</code></strong> Defines whether you want to migrate links after the import.  When enabled, this updates all references from the old links to the new Record ID's.  By default, it is enabled.  Advisable that you only turn it off when merging and you're certain no other existent records link to those you're importing.  This feature was introduced in version 1.6.1.</li>
<li><strong><code>-rebuildIndexes</code></strong> Defines whether you want to rebuild indexes after the import.  By default, it does.  You can set it to false to speed up the import, but do so only when you're certain the import doesn't affect indexes.  This feature was introduced in version 1.6.1.</li>
</ul>
<p><strong>Example</strong></p>
<ul>
<li>
<p>Import the database <code>petshop.export</code>:</p>
<pre>
orientdb> <code class='lang-sql userinput'>IMPORT DATABASE C:/temp/petshop.export -preserveClusterIDs=true</code>

Importing records...
- Imported records into the cluster 'internal': 5 records
- Imported records into the cluster 'index': 4 records
- Imported records into the cluster 'default': 1022 records
- Imported records into the cluster 'orole': 3 records
- Imported records into the cluster 'ouser': 3 records
- Imported records into the cluster 'csv': 100 records
- Imported records into the cluster 'binary': 101 records
- Imported records into the cluster 'account': 1005 records
- Imported records into the cluster 'company': 9 records
- Imported records into the cluster 'profile': 9 records
- Imported records into the cluster 'whiz': 1000 records
- Imported records into the cluster 'address': 164 records
- Imported records into the cluster 'city': 55 records
- Imported records into the cluster 'country': 55 records
- Imported records into the cluster 'animalrace': 3 records
- Imported records into the cluster 'ographvertex': 102 records
- Imported records into the cluster 'ographedge': 101 records
- Imported records into the cluster 'graphcar': 1 records
</pre>
</li>
</ul>
<blockquote>
<p>For more information on backups, restores, and exports, see: <a href="console/Console-Command-Backup.html"><code>BACKUP</code></a>, <a href="console/Console-Command-Restore.html"><code>RESTORE</code></a> and <a href="console/Console-Command-Export.html"><code>EXPORT</code></a> commands, and the <a href="https://github.com/orientechnologies/orientdb/blob/master/core/src/main/java/com/orientechnologies/orient/core/db/tool/ODatabaseImport.java"><code>ODatabaseImport</code></a>
Java class.  For the JSON format, see <a href="console/../admin/Export-Format.html">Export File Format</a>.</p>
</blockquote>
<blockquote>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<h2 id="troubleshooting-1"><a class="header" href="#troubleshooting-1">Troubleshooting</a></h2>
<h3 id="validation-errors"><a class="header" href="#validation-errors">Validation Errors</a></h3>
<p>Occasionally, you may encounter validation errors during imports, usually shown as an <code>OValidationException</code> exception.  Beginning with version 2.2, you can disable validation at the database-level using the <a href="console/../sql/SQL-Alter-Database.html"><code>ALTER DATABASE</code></a> command, to allow the import to go through.</p>
<ol>
<li>
<p>Disable validation for the current database:</p>
<pre>
orientdb> <code class="lang-sql userinput">ALTER DATABASE validation false</code>
</pre>
</li>
<li>
<p>Import the exported database:</p>
<pre>
orientdb> <code class="lang-sql userinput">IMPORT DATABASE /path/to/my_data.export -preserveClusterIDs=TRUE</code>
</pre>
</li>
<li>
<p>Re-enable validation:</p>
<pre>
orientdb> <code class="lang-sql userinput">ALTER DATABASE validation true</code>
</pre>
</li>
</ol>
<h3 id="cluster-ids"><a class="header" href="#cluster-ids">Cluster ID's</a></h3>
<p>During imports you may occasionally encounter an error that reads: <code>Imported cluster 'XXX' has id=6 different from the original: 5</code>.  Typically occurs in databases that were created in much older versions of OrientDB.  You can correct it using the <a href="console/../sql/SQL-Drop-Class.html"><code>DROP CLASS</code></a> on the class <code>ORIDs</code>, then attempting the import again.</p>
<ol>
<li>
<p>Import the database:</p>
<pre>
orientdb> <code class="lang-sql userinput">IMPORT DATABASE /path/to/old_data.export</code>

</li>
</ol>
<p>Importing records...</p>
<ul>
<li>
<p>Creating cluster 'company'...Error on database import happened just before line
16, column 52 com.orientechnologies.orient.core.exception.OConfigurationException:
Imported cluster 'company has id=6 different from the original: 5 at
com.orientechnologies.orient.core.db.tool.ODatabaseImport.importClusters(
ODatabaseImport.java:500) at
com.orientechnologies.orient.core.db.tool.ODatabaseIMport.importDatabase(
ODatabaseImport.java:121)
</pre></p>
</li>
<li>
<p>Drop the <code>ORIDs</code> class:</p>
<pre>
orientdb> <code class="lang-sql userinput">DROP CLASS ORIDs</code>
</pre>
</li>
<li>
<p>Import the database:</p>
 <pre>
 orientdb> <code class="lang-sql userinput">IMPORT DATABASE /path/to/old_data.export</code>
 </pre>
</li>
</ul>
<p>The database now imports without error.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="console---indexes"><a class="header" href="#console---indexes">Console - <code>INDEXES</code></a></h1>
<p>Displays all indexes in the current database.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">INDEXES
</code></pre>
<p><strong>Example</strong></p>
<ul>
<li>
<p>Display indexes in the current database:</p>
<pre>
orientdb {db=GratefulDeadConcerts}> <code class="lang-sql userinput">INDEXES</code>

INDEXES
--------------+------------+-------+--------+---------
 NAME         | TYPE       | CLASS | FIELDS | RECORDS 
--------------+------------+-------+--------+---------
 dictionary   | DICTIONARY |       |        |       0 
 Group.Grp_Id | UNIQUE     | Group | Grp_Id |       1 
 ORole.name   | UNIQUE     | ORole | name   |       3 
 OUser.name   | UNIQUE     | OUser | name   |       4 
--------------+------------+----------------+---------
 TOTAL = 4                                          8 
------------------------------------------------------
</pre>
</li>
</ul>
<blockquote>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="console---info"><a class="header" href="#console---info">Console - <code>INFO</code></a></h1>
<p>Displays all information on the current database.</p>
<p><strong>Syntax</strong></p>
<pre><code>INFO
</code></pre>
<p><strong>Example</strong></p>
<ul>
<li>
<p>Display information on database <code>petshop</code>:</p>
<pre>
orientdb {db=petshop}> <code class='lang-sql userinput'>INFO</code>

Current database: ../databases/petshop/petshop
CLUSTERS:
------------+------+----------+----------
 NAME       |  ID  | TYPE     | ELEMENTS 
------------+------+----------+----------
 metadata   |    0 | Physical |       11 
 index      |    1 | Physical |        0 
 default    |    2 | Physical |      779 
 csv        |    3 | Physical |     1000 
 binary     |    4 | Physical |     1001 
 person     |    5 | Physical |        7 
 animal     |    6 | Physical |        5 
 animalrace |   -2 | Logical  |        0 
 animaltype |   -3 | Logical  |        1 
 orderitem  |   -4 | Logical  |        0 
 order      |   -5 | Logical  |        0 
 city       |   -6 | Logical  |        3 
------------+------+----------+----------
 TOTAL                              2807 
-----------------------------------------

CLASSES:
------------+----+------------+----------
 NAME       | ID | CLUSTERS   | ELEMENTS 
------------+----+------------+----------
 Person     |  0 | person     |        7 
 Animal     |  1 | animal     |        5 
 AnimalRace |  2 | AnimalRace |        0 
 AnimalType |  3 | AnimalType |        1 
 OrderItem  |  4 | OrderItem  |        0 
 Order      |  5 | Order      |        0 
 City       |  6 | City       |        3 
------------+----+------------+----------
 TOTAL                                16 
----------------------------------------- 
</pre>
</li>
</ul>
<blockquote>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="console---info-class"><a class="header" href="#console---info-class">Console - <code>INFO CLASS</code></a></h1>
<p>Displays all information on given class.</p>
<p><strong>Syntax</strong></p>
<pre><code>INFO CLASS &lt;class-name&gt;
</code></pre>
<ul>
<li><strong><code>&lt;class-name&gt;</code></strong> Defines what class you want information on.</li>
</ul>
<p><strong>Example</strong></p>
<ul>
<li>
<p>Display information on class <code>Profile</code></p>
<pre>
orientdb> <code class="lang-sql userinput">INFO CLASS Profile</code>

Default cluster......: profile (id=10)
Supported cluster ids: [10]
Properties:
--------+----+----------+-----------+---------+-----------+----------+-----+----
 NAME   | ID | TYPE     | LINK TYPE | INDEX   | MANDATORY | NOT NULL | MIN | MAX
--------+----+----------+-----------+---------+-----------+----------+-----+----
 nick   |  3 | STRING   | null      |         | false     | false    | 3   | 30 
 name   |  2 | STRING   | null      |NOTUNIQUE| false     | false    | 3   | 30 
 surname|  1 | STRING   | null      |         | false     | false    | 3   | 30 
 ...    |    | ...      | ...       | ...     | ...       | ...      |...  | ...
 photo  |  0 | TRANSIENT| null      |         | false     | false    |     |    
--------+----+----------+-----------+---------+-----------+----------+-----+----
</pre>
</li>
</ul>
<blockquote>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="console---info-property"><a class="header" href="#console---info-property">Console - <code>INFO PROPERTY</code></a></h1>
<p>Displays all information on the given property.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">INFO PROPERTY &lt;class-name&gt;.&lt;property-name&gt;
</code></pre>
<ul>
<li><strong><code>&lt;class-name&gt;</code></strong> Defines the class to which the property belongs.</li>
<li><strong><code>&lt;property-name&gt;</code></strong> Defines the property you want information on.</li>
</ul>
<p><strong>Example</strong></p>
<ul>
<li>
<p>Display information on the property <code>name</code> in the class <code>OUser</code>:</p>
<pre>
orientdb> <code class='userinput lang-sql'>INFO PROPERTY OUser.name</code>

PROPERTY 'OUser.name'

Type.................: STRING
Mandatory............: true
Not null.............: true
Read only............: false
Default value........: null
Minimum value........: null
Maximum value........: null
REGEXP...............: null
Collate..............: {OCaseInsensitiveCollate : name = ci}
Linked class.........: null
Linked type..........: null

INDEXES (1 altogether)
--------------------+------------
 NAME               | PROPERTIES 
--------------------+------------
 OUser.name         | name       
--------------------+------------
</pre>
</li>
</ul>
<blockquote>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="console---js"><a class="header" href="#console---js">Console - <code>JS</code></a></h1>
<p>Executes commands in the Javascript language from the Console. Look also <a href="console/../js/Javascript-Command.html">Javascript Command</a>.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">JS &lt;commands&gt;
</code></pre>
<ul>
<li><strong><code>&lt;commands&gt;</code></strong> Defines the commands you want to execute.</li>
</ul>
<p><strong>Interactive Mode</strong>
You can execute a command in just one line (<code>JS print('Hello World!')</code>) or enable the interactive input by just executing <code>JS</code> and then typing the Javascript expression as multi-line inputs.  It does not execute the command until you type <code>end</code>.  Bear in mind, the <code>end</code> here is case-sensitive.</p>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Execute a query and display the result:</p>
<pre>
orientdb> <code class="lang-javascript userinput">js</code>
[Started multi-line command.  Type just 'end' to finish and execute.]
orientdb> <code class="lang-javascript userinput">var r = db.query('select from ouser');</code>
orientdb> <code class="lang-javascript userinput">for(var i=0;i<r.length;++i){</code>
orientdb> <code class="lang-javascript userinput">print( r[i] );</code>
orientdb> <code class="lang-javascript userinput">}</code>
orientdb> <code class="lang-javascript userinput">end</code>

OUser#5:0{roles:[1],status:ACTIVE,password:{PBKDF2WithHmacSHA256}C08CE0F5160EA4050B8F10EDBB86F06EB0A2EE82DF73A340:BC1B6040727C1E11E3A961A1B2A49615C96938710AF17ADD:65536,name:admin} v1
OUser#5:1{name:reader,password:{PBKDF2WithHmacSHA256}41EF9B675430D215E0970AFDEB735899B6665DF44A29FE98:5BC48B2D20752B12B5E32BE1F22C6C85FF7CCBEFB318B826:65536,status:ACTIVE,roles:[1]} v1
OUser#5:2{name:writer,password:{PBKDF2WithHmacSHA256}FA0AD7301EA2DB371355EB2855D63F4802F13858116AB82E:18B8077E1E63A45DB0A3347F91E03E4D2218EA16E5100105:65536,status:ACTIVE,roles:[1]} v1

Client side script executed in 0.142000 sec(s). Value returned is: null
</pre>
</li>
</ul>
<blockquote>
<p>For more information on the Javascript execution, see <a href="console/../js/Javascript-Command.html">Javascript Command</a>.  For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="console---jss"><a class="header" href="#console---jss">Console - <code>JSS</code></a></h1>
<p>Executes commands on OrientDB Server in the Javascript language from the Console. Look also <a href="console/../js/Javascript-Command.html">Javascript Command</a>.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">JSS &lt;commands&gt;
</code></pre>
<ul>
<li><strong><code>&lt;commands&gt;</code></strong> Defines the commands you want to execute.</li>
</ul>
<p><strong>Interactive Mode</strong>
You can execute a command in just one line (<code>JSS print('Hello World!')</code>) or enable the interactive input by just executing <code>JSS</code> and then typing the Javascript expression as multi-line inputs.  It does not execute the command until you type <code>end</code>.  Bear in mind, the <code>end</code> here is case-sensitive.</p>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Execute a query and display the result:</p>
<pre>
orientdb> <code class="lang-javascript userinput">jss</code>
[Started multi-line command.  Type just 'end' to finish and execute.]
orientdb> <code class="lang-javascript userinput">var r = db.query('select from ouser');</code>
orientdb> <code class="lang-javascript userinput">for(var i=0;i<r.length;++i){</code>
orientdb> <code class="lang-javascript userinput">print( r[i] );</code>
orientdb> <code class="lang-javascript userinput">}</code>
orientdb> <code class="lang-javascript userinput">end</code>

Server side script executed in 0.146000 sec(s). Value returned is: null
</pre>
<p>In this case the output will be displayed on the server console.</p>
</li>
</ul>
<blockquote>
<p>For more information on the Javascript execution, see <a href="console/../js/Javascript-Command.html">Javascript Command</a>.  For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="console---list-databases"><a class="header" href="#console---list-databases">Console - <code>LIST DATABASES</code></a></h1>
<p>Displays all databases hosted on the current server.  Note that this command requires you connect to the OrientDB Server.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">LIST DATABASES
</code></pre>
<p><strong>Example</strong></p>
<ul>
<li>
<p>Connect to the server:</p>
<pre>
orientdb> <code class="lang-sql userinput">CONNECT REMOTE:localhost admin admin_password</code>
</pre>
</li>
<li>
<p>List the databases hosted on the server:</p>
<pre>
orientdb {server=remote:localhost/}> <code class="lang-sql userinput">LIST DATABASES</code>

Found 4 databases:

* ESA (plocal)
* Napster (plocal)
* Homeland (plocal)
* GratefulDeadConcerts (plocal)
</pre>
</li>
</ul>
<blockquote>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="console---list-connections"><a class="header" href="#console---list-connections">Console - <code>LIST CONNECTIONS</code></a></h1>
<p>Displays all active connections to the OrientDB Server.  Command introduced in version 2.2.
The connections as per server, so you should connect to the server, not to the database.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">LIST CONNECTIONS
</code></pre>
<p><strong>Permissions</strong></p>
<p>In order to enable a user to execute this command, you must add <code>"server.info"</code> as resource to the <a href="console/Console-Command-Set-Server-User.html">server user</a>.</p>
<p><strong>Example</strong></p>
<ul>
<li>
<p>List the current connections to the OrientDB Server:</p>
<pre>
orientdb {server=remote:localhost/}> <code class='lang-sql userinput'>LIST CONNECTIONS</code>

---+----+--------------+------+-------------------+--------+-----+--------+--------
 # | ID |REMOTE_ADDRESS|PROTOC|LAST_OPERATION_ON  |DATABASE|USER |COMMAND |TOT_REQS
---+----+--------------+------+-------------------+--------+-----+--------+--------
 0 | 17 |/127.0.0.1    |binary|2015-10-12 19:22:34|-       |-    |info    | 1       
 1 | 16 |/127.0.0.1    |binary|1970-01-01 01:00:00|-       |-    |-       | 0       
 5 | 1  |/127.0.0.1    |http  |1970-01-01 00:59:59|pokec   |admin|Listen  | 32      
---+----+--------------+------+-------------------+--------+-----+--------+--------
</pre>
</li>
</ul>
<blockquote>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="console---load-record"><a class="header" href="#console---load-record">Console - <code>LOAD RECORD</code></a></h1>
<p>Loads a record the given <a href="console/../datamodeling/Concepts.html#record-id">Record ID</a> from the current database.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">LOAD RECORD &lt;record-id&gt;
</code></pre>
<ul>
<li><strong><code>&lt;record-id</code></strong> Defines the Record ID of the record you want to load.</li>
</ul>
<p>In the event that you don't have a Record ID, execute a query to find the one that you want.</p>
<p><strong>Example</strong></p>
<ul>
<li>
<p>Load the record for <code>#5:5</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">LOAD RECORD #5:5</code>

--------------------------------------------------------------------------------
 Class: Person   id: #5:5   v.0
--------------------------------------------------------------------------------
   parent : Person@5:4{parent:null,children:[Person@5:5, Person@5:6],name:Barack,
            surname:Obama,city:City@-6:2}
 children : null
     name : Malia Ann
  surname : Obama
     city : null
--------------------------------------------------------------------------------
</pre>
</li>
</ul>
<blockquote>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="console---load-script-from-2218"><a class="header" href="#console---load-script-from-2218">Console - <code>LOAD SCRIPT</code> (from 2.2.18)</a></h1>
<p>Loads a sql script from the given path and executes it.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">LOAD SCRIPT &lt;script path&gt;
</code></pre>
<p><strong>Example</strong></p>
<ul>
<li>
<p>Load a script from an absolute path:</p>
<pre>
orientdb> <code class="lang-sql userinput">LOAD SCRIPT /path/to/scripts/data.osql</code>

</pre>
</li>
<li>
<p>Launch the console in batch mode and load script to a remote database:</p>
<pre>
$ <code class="lang-sh userinput">$ORIENTDB_HOME/bin/console.sh "CONNECT REMOTE:localhost/demo;LOAD SCRIPT /path/to/scripts/data.osql"</code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><hr />
<h2>search:
keywords: ['console', 'command', 'connection', 'CONNECT']</h2>
<h1 id="console---open"><a class="header" href="#console---open">Console - <code>OPEN</code></a></h1>
<p>(since v 3.2)</p>
<p>Opens a database.</p>
<p><strong>Syntax</strong></p>
<pre><code>OPEN &lt;database-name&gt; &lt;user&gt; &lt;password&gt;
</code></pre>
<ul>
<li><strong><code>&lt;database-name&gt;</code></strong> Defines the name of the database you want to connect to.  The console has to be connected to a server/environment (see <a href="console/Console-Command-Connect-Env.html">CONNECT ENV</a> ) and the database has to be present in that environment</li>
<li><strong><code>&lt;user&gt;</code></strong> Defines the user you want to connect to the database with.</li>
<li><strong><code>&lt;password&gt;</code></strong> Defines the password needed to connect to the database, with the defined user.</li>
</ul>
<p><strong>Examples:</strong></p>
<ul>
<li>
<p>Connect to a local database as the user <code>admin</code>, loading it directly into the console:</p>
<pre>

orientdb> <code class="userinput lang-sql">connect env plocal:../databases/</code>
  
orientdb> <code class="userinput lang-sql">open demodb admin my_admin_password</code>

Connecting to database [plocal:../databases/demodb]...OK
</pre>
</li>
<li>
<p>Connect to a remote database:</p>
<pre>
orientdb> <code class="lang-sql userinput">connect env remote:192.168.1.1</code>

orientdb> <code class="userinput lang-sql">open demodb admin my_admin_password</code>

Connecting to database [remote:192.168.1.1/demodb]...OK
</pre>
</li>
</ul>
<blockquote>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="console---profiler"><a class="header" href="#console---profiler">Console - <code>PROFILER</code></a></h1>
<p>Controls the <a href="console/../tuning/Profiler.html">Profiler</a>.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">PROFILER ON|OFF|DUMP|RESET
</code></pre>
<ul>
<li><strong><code>ON</code></strong> Turn on the Profiler and begin recording.</li>
<li><strong><code>OFF</code></strong> Turn off the Profiler and stop recording.</li>
<li><strong><code>DUMP</code></strong> Dump the Profiler data.</li>
<li><strong><code>RESET</code></strong> Reset the Profiler data.</li>
</ul>
<p><strong>Example</strong></p>
<ul>
<li>
<p>Turn the Profiler on:</p>
<pre>
orientdb> <code class='lang-sql userinput'>PROFILER ON</code>

Profiler is ON now, use 'profiler off' to turn off.
</pre>
</li>
<li>
<p>Dump Profiler data:</p>
<pre>
orientdb> <code class='lang-sql userinput'>PROFILER DUMP</code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="console---properties"><a class="header" href="#console---properties">Console - <code>PROPERTIES</code></a></h1>
<p>Displays all configured properties.</p>
<p><strong>Syntax</strong></p>
<pre><code>PROPERTIES
</code></pre>
<p><strong>Example</strong></p>
<ul>
<li>
<p>List configured properties:</p>
<pre>
orientdb> <code class='lang-sql userinput'>PROPERTIES</code>

PROPERTIES:
------------------------+-----------
 NAME                   | VALUE
------------------------+-----------
 limit                  | 20 
 backupBufferSize       | 1048576
 backupCompressionLevel | 9      
 collectionMaxItems     | 10     
 verbose                | 2      
 width                  | 150    
 maxBinaryDisplay       | 150    
 debug                  | false  
 ignoreErrors           | false  
------------------------+-----------
</pre>
</li>
</ul>
<blockquote>
<p>To change a property value, use the <a href="console/Console-Command-Set.html"><code>SET</code></a> command.</p>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="console---release-database"><a class="header" href="#console---release-database">Console - <code>RELEASE DATABASE</code></a></h1>
<p>Releases database from a frozen state, from where it only allows read operations back to normal mode.  Execution requires server administration rights.</p>
<p>You may find this command useful in the event that you want to perform live database backups.  Run the <a href="console/Console-Command-Freeze-Db.html"><code>FREEZE DATABASE</code></a> command to take a snapshot, you can then copy the snapshot anywhere you want.  Use such approach when you want to take short-term backups.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">RELEASE DATABASE
</code></pre>
<p><strong>Example</strong></p>
<ul>
<li>
<p>Release the current database from a freeze:</p>
<pre>
orientdb> <code class='lang-sql userinput'>RELEASE DATABASE</code>
</pre>
</li>
</ul>
<blockquote>
<p>To freeze a database, see the <a href="console/Console-Command-Freeze-Db.html"><code>FREEZE DATABASE</code></a> command.</p>
<p>For more information on other commands, please refer to <a href="console/Console-Commands.html">Console Commands</a> and <a href="console/../sql/SQL-Commands.html">SQL Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="console---reload-record"><a class="header" href="#console---reload-record">Console - <code>RELOAD RECORD</code></a></h1>
<p>Reloads a record from the current database by its Record ID, ignoring the cache.</p>
<p>You may find this command useful in cases where external applications change the record and you need to see the latest update.</p>
<p><strong>Syntax</strong></p>
<pre><code>RELOAD RECORD &lt;record-id&gt;
</code></pre>
<ul>
<li><strong><code>&lt;record-id&gt;</code></strong> Defines the unique Record ID for the record you want to reload.  If you don't have the Record ID, execute a query first.</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Reload record with the ID of <code>5:5</code>:</p>
<pre>
orientdb> <code class='lang-sql userinput'>RELOAD RECORD 5:5</code>

------------------------------------------------------------------------
Class: Person   id: 5:5   v.0
------------------------------------------------------------------------
   parent : Person@5:4{parent:null,children:[Person@5:5, Person@5:6],
            name:Barack,surname:Obama,city:City@-6:2}
 children : null
     name : Malia Ann
  surname : Obama
     city : null
------------------------------------------------------------------------
</pre>
</li>
</ul>
<blockquote>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="console---repair-database"><a class="header" href="#console---repair-database">Console - <code>REPAIR DATABASE</code></a></h1>
<p>Repairs a database. To check if a database needs to be repaired, you can use the <a href="console/Console-Command-Check-Database.html">Check Database Command</a>.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">REPAIR DATABASE [--fix-graph [-skipVertices=&lt;vertices&gt;] [-skipEdges=&lt;edges&gt;]]
                [--fix-links] [-v]]
                [--fix-ridbags]
                [--fix-bonsai]
                [-v]
</code></pre>
<ul>
<li><strong><code>[--fix-graph]</code></strong> Fixes the database as graph. All broken edges are removed and all corrupted vertices repaired. This mode takes the following optional parameters:</li>
<li><strong><code>-skipVertices=&lt;vertices&gt;</code></strong>, where <code>&lt;vertices&gt;</code> are the number of vertices to skip on repair.</li>
<li><strong><code>-skipEdges=&lt;edges&gt;</code></strong>, where <code>&lt;edges&gt;</code> are the number of edges to skip on repair.</li>
<li><strong><code>[--fix-links]</code></strong> Fixes links. It removes any reference to not existent records. The optional <code>[-v]</code> tells to print more information.</li>
<li><strong><code>[--fix-ridbags]</code></strong> Fixes the ridbag structures only (collection of references).</li>
<li><strong><code>[--fix-bonsai]</code></strong> Fixes the bonsai structures only (internal representation of trees)</li>
<li><strong><code>[-v]</code></strong> Verbose mode</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>Repair a graph database:</li>
</ul>
<pre><code>  orientdb&gt; REPAIR DATABASE --fix-graph

  Repair of graph 'plocal:/temp/demo' is started ...
  Scanning 26632523 edges (skipEdges=0)...
  ...
  + edges: scanned 100000, removed 0 (estimated remaining time 10 secs)
  + edges: scanned 200000, removed 0 (estimated remaining time 9 secs)
  + deleting corrupted edge friend#40:22044{out:#25:1429,in:#66:1,enabled:true} v7 because missing incoming vertex (#66:1)
  ...
  Scanning edges completed
  Scanning 32151775 vertices...
  + vertices: scanned 100000, repaired 0 (estimated remaining time 892 secs)
  + vertices: scanned 200000, repaired 0 (estimated remaining time 874 secs)
  + vertices: scanned 300000, repaired 0 (estimated remaining time 835 secs)
  + repaired corrupted vertex Account#25:961{out_friend:[],dateUpdated:Wed Aug 12 19:00:00 CDT 2015,createdOn:Wed Aug 12 19:00:00 CDT 2015} v4
  ...
  + vertices: scanned 32100000, repaired 47 (estimated remaining time 2 secs)
  ...
  Scanning vertices completed
  Repair of graph 'plocal:/temp/demo' completed in 2106 secs
   scannedEdges.....: 1632523
   removedEdges.....: 129
   scannedVertices..: 32151775
   scannedLinks.....: 53264852
   removedLinks.....: 64
   repairedVertices.: 47
</code></pre>
<blockquote>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="console---restore-database"><a class="header" href="#console---restore-database">Console - <code>RESTORE DATABASE</code></a></h1>
<p>Restores a database from a backup.  It must be done against a new database.  It does not support restores that merge with an existing database.  If you need to backup and restore to an existing database, use the <a href="console/Console-Command-Export.html"><code>EXPORT DATABASE</code></a> and <a href="console/Console-Command-Import.html"><code>IMPORT DATABASE</code></a> commands.</p>
<p><a href="console/../ee/Enterprise-Edition.html">OrientDB Enterprise Edition</a> version 2.2 and major, support <a href="console/../admin/Incremental-Backup-And-Restore.html">incremental backup</a>.</p>
<p>To create a backup file to restore from, use the <a href="console/Console-Command-Backup.html"><code>BACKUP DATABASE</code></a> command.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">RESTORE DATABASE &lt;backup-file&gt;|&lt;incremental-backup-directory&gt;
</code></pre>
<ul>
<li><strong><code>&lt;backup-file&gt;</code></strong> Defines the database file you want to restore.</li>
<li><strong><code>&lt;incremental-backup-directory&gt;</code></strong> Defines the database directory you want to restore from an incremental backup. Available only in <a href="console/../ee/Enterprise-Edition.html">OrientDB Enterprise Edition</a> version 2.2 and major.</li>
</ul>
<p><strong>Permissions:</strong></p>
<p>In order to enable a user to execute this command, you must add the permission of <code>create</code> for the resource <code>database.restore</code> to the <a href="console/../security/Database-Security.html#users">database user</a>.</p>
<p><strong>Example of full restore</strong></p>
<ul>
<li>
<p>Create a new database to receive the restore:</p>
<pre>
orientdb> <code class='lang-sql userinput'>CREATE DATABASE PLOCAL:/tmp/mydb</code>
</pre>
</li>
<li>
<p>Restore the database from the <code>mydb.zip</code> backup file:</p>
<pre>
orientdb {db=/tmp/mydb}> <code class='lang-sql userinput'>RESTORE DATABASE /backups/mydb.zip</code>
</pre>
</li>
</ul>
<p><strong>Example of incremental restore</strong></p>
<p>This is available only in <a href="console/../ee/Enterprise-Edition.html">OrientDB Enterprise Edition</a> version 2.2 and major.</p>
<ul>
<li>
<p>Open a database to receive the restore:</p>
<pre>
orientdb> <code class='lang-sql userinput'>CONNECT PLOCAL:/tmp/mydb</code>
</pre>
</li>
<li>
<p>Restore the database from the <code>/backup</code> backup directory:</p>
<pre>
orientdb {db=/tmp/mydb}> <code class='lang-sql userinput'>RESTORE DATABASE /backup</code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information, see the <a href="console/Console-Command-Backup.html"><code>BACKUP DATABASE</code></a>, <a href="console/Console-Command-Export.html"><code>EXPORT DATABASE</code></a>, <a href="console/Console-Command-Import.html"><code>IMPORT DATABASE</code></a> commands.  For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="console---set"><a class="header" href="#console---set">Console - <code>SET</code></a></h1>
<p>Changes the value of a property.</p>
<p><strong>Syntax</strong></p>
<pre><code>SET &lt;property-name&gt; &lt;property-value&gt;
</code></pre>
<ul>
<li><strong><code>&lt;property-name&gt;</code></strong> Defines the name of the property</li>
<li><strong><code>&lt;property-value&gt;</code></strong> Defines the value you want to change the property to.</li>
</ul>
<p><strong>Example</strong></p>
<ul>
<li>
<p>Change the <code>LIMIT</code> property to one hundred:</p>
<pre>
orientdb> <code class="lang-sql userinput">SET LIMIT 100</code>

Previous value was: 20
limit = 100
</pre>
</li>
</ul>
<blockquote>
<p>To display all properties use the <a href="console/Console-Command-Properties.html"><code>PROPERTIES</code></a> command.  To display the value of a particular property, use the <a href="console/Console-Command-Get.html"><code>GET</code></a> command.</p>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="console---set-server-user"><a class="header" href="#console---set-server-user">Console - <code>SET SERVER USER</code></a></h1>
<p>Creates a server user.  If the server user already exists, it updates the password and permissions.</p>
<p>In order to create or modify the user, the current system user must have write permissions on the <code>$ORIENTDB_HOME/config/orientdb-server-config.xml</code> configuration file.</p>
<p><strong>Syntax</strong></p>
<pre><code>SET SERVER USER &lt;user-name&gt; &lt;user-password&gt; &lt;user-permissions&gt; 
</code></pre>
<ul>
<li><strong><code>&lt;user-name&gt;</code></strong> Defines the server username.</li>
<li><strong><code>&lt;user-password&gt;</code></strong> Defines the password for the server user.</li>
<li><strong><code>&lt;user-permissions&gt;</code></strong> Defines the <a href="console/../security/Server-Security.html#server-resources">permissions</a> for the server user.</li>
</ul>
<blockquote>
<p>For more information on security, see <a href="console/../security/Server-Security.html">OrientDB Server Security</a>.  Feature introduced in version 2.2.</p>
</blockquote>
<p><strong>Example</strong></p>
<ul>
<li>
<p>Create the server user <code>editor</code>, give it all permissions:</p>
<pre>
orientdb> <code class='lang-sql userinput'>SET SERVER USER editor my_password *</code>

Server user 'editor' set correctly
</pre>
</li>
</ul>
<blockquote>
<p>To display all server users, see the <a href="console/Console-Command-List-Server-Users.html"><code>LIST SERVER USERS</code></a> command.  To remove a server user, see <a href="console/Console-Command-Drop-Server-User.html"><code>DROP SERVER USER</code></a> command.</p>
<p>For more information on other commands, see <a href="console/Console-Commands.html">Console Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="custom-console-commands"><a class="header" href="#custom-console-commands">Custom Console Commands</a></h1>
<p>In addition to the commands implemented by OrientDB, you can also develop custom commands to extend features in your particular implementation. To do this, edit the <a href="https://github.com/orientechnologies/orientdb/blob/master/tools/src/main/java/com/orientechnologies/orient/console/OConsoleDatabaseApp.java">OConsoleDatabaseApp</a> class and add to it a new method.  There's an auto-discovery system in place that adds the new method to the available commands. To provide a description of the command, use annotations. The command name must follow the Java code convention of separating words using camel-case.</p>
<p>For instance, consider a case in which you might want to add a <code>MOVE CLUSTER</code> command to the console:</p>
<pre><code class="language-java">@ConsoleCommand(description = "Move the physical location of cluster files")
public void moveCluster(
   @ConsoleParameter(name = "cluster-name", description = "The name or the id of the cluster to remove") String iClusterName,
   @ConsoleParameter(name = "target-path", description = "path of the new position where to move the cluster files") String iNewPath ) {

   checkCurrentDatabase(); // THE DB MUST BE OPENED

   System.out.println("Moving cluster '" + iClusterName + "' to path " + iNewPath + "...");
   }
</code></pre>
<p>Once you have this code in place, <code>MOVE CLUSTER</code> now appears in the listing of available commands shown by <code>HELP</code>.</p>
<pre>
orientdb> <code class="lang-sql userinput">HELP</code>

AVAILABLE COMMANDS:

 * alter class <command-text>   Alter a class in the database schema
 * alter cluster <command-text> Alter class in the database schema
 ...                            ...
 * move cluster                 Move the physical location of cluster files
 ...                            ...
 * help                         Print this help
 * exit                         Close the console

orientdb> <code class="lang-sql userinput">MOVE CLUSTER foo /temp</code>

Moving cluster 'foo' to path /tmp...
</pre>
<p>In the event that you develop a custom command and find it especially useful in your deployment, you can contribute your code to the <a href="https://groups.google.com/forum/#!forum/orient-database">OrientDB Community</a>!</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-administrative-and-utility-programs"><a class="header" href="#orientdb-administrative-and-utility-programs">OrientDB Administrative and Utility Programs</a></h1>
<ul>
<li><a href="programs/backup.html">Backup</a></li>
<li><a href="programs/shutdown.html">Shutdown</a></li>
<li><a href="programs/stresstester.html">Stress tester</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><p>#OrientDB Data Import Programs</p>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-01-06 SAM -->
<h1 id="orientdb-server-administration"><a class="header" href="#orientdb-server-administration">OrientDB Server Administration</a></h1>
<p>OrientDB has a number of tools to make administration of the database easier. There is the <a href="admin/../console/README.html">Console</a>, which allows you to run a large number of <a href="admin/../console/Console-Commands.html">commands</a>.</p>
<p>There is also the <a href="admin/../studio/README.html">OrientDB Studio</a>, which allows you to run queries and visually look at the graph.</p>
<p><img src="admin/../images/GraphEditor.png" alt="GraphEditor" /></p>
<p>OrientDB also offers several tools for the <a href="admin/Export-and-Import.html">import and export of data</a>, <a href="admin/Logging.html">logging</a> and <a href="admin/../misc/Troubleshooting.html">trouble shooting</a>, along with <a href="admin/../etl/ETL-Introduction.html">ETL tools</a>.</p>
<p>All of OrientDB's administration facilities are aimed to make your usage of OrientDB as simple and as easy as possible.</p>
<blockquote>
<p>For more information see:</p>
</blockquote>
<blockquote>
<ul>
<li><a href="admin/../studio/README.html">Studio</a></li>
<li><a href="admin/../console/README.html">Console</a></li>
<li><a href="admin/Backup-and-Restore.html">Backup and Restore</a></li>
<li><a href="admin/Export-and-Import.html">Export and Import</a></li>
<li><a href="admin/Logging.html">Logging</a></li>
<li><a href="admin/../misc/Troubleshooting.html">Trouble shooting</a></li>
<li><a href="admin/../tuning/Performance-Tuning.html">Performance Tuning</a></li>
<li><a href="admin/../etl/ETL-Introduction.html">ETL Tools</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation-2"><a class="header" href="#installation-2">Installation</a></h1>
<p>OrientDB Community Edition is available as a binary package for <a href="http://orientdb.dev/downloads/">download</a> or as source code on GitHub. The Enterprise Edition is available as a binary package to all our Customers that purchased one of the available <a href="http://orientdb.dev/support/">Subscriptions</a>.</p>
<p>OrientDB prerequisites can be found <a href="admin/installation/../installation/Prerequisites.html">here</a>.</p>
<h2 id="binary-installation"><a class="header" href="#binary-installation">Binary Installation</a></h2>
<p>OrientDB provides a pre-compiled binary package to install the database on your system.  Depending on your operating system, this is a tarred or zipped package that contains all the relevant files you need to run OrientDB. For desktop installations, go to <a href="http://orientdb.dev/downloads/">OrientDB Downloads</a> and select the package that best suits your system.</p>
<p>On server installations, you can use the <code>wget</code> utility:</p>
<pre><code class="lang-sh">$ wget https://repo1.maven.org/maven2/com/orientechnologies/orientdb-community/3.2.44/orientdb-community-3.2.43.tar.gz -O orientdb-community-3.2.44.tar.gz</code></pre>	
<p>Whether you use your web browser or <code>wget</code>, unzip or extract the downloaded file into a directory convenient for your use, (for example, <code>/opt/orientdb/</code> on Linux).  This creates a directory called orientdb-community-3.2.44 with relevant files and scripts, which you will need to run OrientDB on your system.</p>
<h2 id="use-docker"><a class="header" href="#use-docker">Use Docker</a></h2>
<p>If you have Docker installed in your computer, this is the easiest way to run OrientDB. From the command line type:</p>
<pre><code>$ docker run -d --name orientdb -p 2424:2424 -p 2480:2480
   -e ORIENTDB_ROOT_PASSWORD=root orientdb:latest
</code></pre>
<p>Where instead of "root", type the root's password you want to use.</p>
<p>More details on how to build your own OrientDB Docker image can be found <a href="admin/installation/../Docker-Home.html">here</a></p>
<h2 id="use-ansible"><a class="header" href="#use-ansible">Use Ansible</a></h2>
<p>If you manage your servers through Ansible, you can use the following role : https://galaxy.ansible.com/migibert/orientdb which is highly customizable and allows you to deploy OrientDB as a standalone instance or multiple clusterized instances.</p>
<p>For using it, you can follow these steps :</p>
<p><strong>Install the role</strong></p>
<pre><code>ansible-galaxy install migibert.orientdb
</code></pre>
<p><strong>Create an Ansible inventory</strong></p>
<p>Assuming you have one two servers with respective IPs fixed at 192.168.10.5 and 192.168.10.6, using ubuntu user.</p>
<pre><code>[orientdb-servers]
192.168.20.5 ansible_ssh_user=ubuntu
192.168.20.6 ansible_ssh_user=ubuntu
</code></pre>
<p><strong>Create an Ansible playbook</strong></p>
<p>In this example, we provision a two node cluster using multicast discovery mode. Please note that this playbook assumes java is already installed on the machine so you should have one step before that install Java 8 on the servers</p>
<pre><code>- hosts: orientdb-servers
  become: yes
  vars:
    orientdb_version: 2.0.5
    orientdb_enable_distributed: true
    orientdb_distributed:
      hazelcast_network_port: 2434
      hazelcast_group: orientdb
      hazelcast_password: orientdb
      multicast_enabled: True
      multicast_group: 235.1.1.1
      multicast_port: 2434
      tcp_enabled: False
      tcp_members: []
    orientdb_users:
      - name: root
        password: root
         tasks:
  - apt:
      name: openjdk-8-jdk
      state: present
  roles:
  - role: orientdb-role
</code></pre>
<p><strong>Run the playbook</strong>
<code>ansible-playbook -i inventory playbook.yml</code></p>
<h2 id="source-code-installation"><a class="header" href="#source-code-installation">Source Code Installation</a></h2>
<p>For information on how to install OrientDB from source, please refer to <a href="admin/installation/../admin/installation/Installation-from-Source.html">this</a> Section.</p>
<h2 id="post-installation-tasks"><a class="header" href="#post-installation-tasks">Post-installation Tasks</a></h2>
<p>For desktop users installing the binary, OrientDB is now installed and can be run through shell scripts found in the package <code>bin</code> directory of the installation.  For servers, there are some additional steps that you need to take in order to manage the database server for OrientDB as a service.  The procedure for this varies, depending on your operating system.</p>
<ul>
<li><a href="admin/installation/../admin/Unix-Service.html">Install as Service on Unix, Linux and Mac OS X</a></li>
<li><a href="admin/installation/../admin/Windows-Service.html">Install as Service on Microsoft Windows</a></li>
</ul>
<h2 id="upgrading"><a class="header" href="#upgrading">Upgrading</a></h2>
<p>When the time comes to upgrade to a newer version of OrientDB, the methods vary depending on how you chose to install it in the first place.  If you installed from binary downloads, repeat the download process above and update any symbolic links or shortcuts to point to the new directory.</p>
<p>For systems where OrientDB was built from source, pull down the latest source code and compile from source.</p>
<pre><code class="language-sh">$ git pull origin master
$ mvn clean install
</code></pre>
<p>Bear in mind that when you build from source, you can switch branches to build different versions of OrientDB using Git.  For example,</p>
<pre><code class="language-sh">$ git checkout 2.2.x
$ mvn clean install
</code></pre>
<p>builds the <code>2.2.x</code> branch, instead of <code>master</code>.</p>
<h2 id="building-a-single-executable-jar-with-orientdb"><a class="header" href="#building-a-single-executable-jar-with-orientdb">Building a single executable jar with OrientDB</a></h2>
<p>OrientDB for internal components like engines, operators, factories uses Java SPI <a href="https://docs.oracle.com/javase/tutorial/ext/basics/spi.html">Service Provider Interface</a>. That means that the jars of OrientDB are shipped with files in <code>META-INF/services</code> that contains the implementation of components. Bear in mind that when building a single executable jar, you have to concatenate the content of files with the same name in different orientdb-*.jar . If you are using <a href="https://maven.apache.org/plugins/maven-shade-plugin/">Maven Shade Plugin</a> you can use <a href="https://maven.apache.org/plugins/maven-shade-plugin/examples/resource-transformers.html#ServicesResourceTransformer">Service Resource Transformer</a> to do that.</p>
<h2 id="other-resources"><a class="header" href="#other-resources">Other Resources</a></h2>
<p>To learn more about how to install OrientDB on specific environments, please refer to the guides below:</p>
<ul>
<li><a href="admin/installation/../admin/Docker-Home.html">Install with Docker</a></li>
<li><a href="https://github.com/migibert/orientdb-role">Install with Ansible</a></li>
<li><a href="http://famvdploeg.com/blog/2013/01/setting-up-an-orientdb-server-on-ubuntu/">Install on Linux Ubuntu</a></li>
<li><a href="http://team.ops4j.org/wiki/display/ORIENT/Installation+on+JBoss+AS">Install on JBoss AS</a></li>
<li><a href="http://team.ops4j.org/wiki/display/ORIENT/Installation+on+GlassFish">Install on GlassFish</a></li>
<li><a href="https://www.digitalocean.com/community/articles/how-to-install-and-use-orientdb-on-an-ubuntu-12-04-vps">Install on Ubuntu 12.04 VPS (DigitalOcean)</a></li>
<li><a href="https://bitbucket.org/nuspy/vagrant-orientdb-with-tinkerpop/overview">Install on Vagrant</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="prerequisites-1"><a class="header" href="#prerequisites-1">Prerequisites</a></h1>
<p>Both <a href="admin/installation/../../misc/Editions.html">editions</a> of OrientDB run on any operating system that implements the Java Virtual machine (JVM) from v 8 to v 11, specifically the JDK. Examples of these include:</p>
<ul>
<li>Linux, all distributions, including ARM (Raspberry Pi, etc.)</li>
<li>Mac OS X</li>
<li>Microsoft Windows</li>
</ul>
<p>OrientDB requires <a href="http://www.java.com/en/download">Java</a>, version 8 to 11, of the JDK.</p>
<blockquote>
<p><strong>Note</strong>: In OSGi containers, OrientDB uses a <code>ConcurrentLinkedHashMap</code> implementation provided by <a href="https://github.com/ben-manes/concurrentlinkedhashmap">concurrentlinkedhashmap</a> to create the LRU based cache. This library actively uses the sun.misc package which is usually not exposed as a system package. To overcome this limitation you should add property <code>org.osgi.framework.system.packages.extra</code> with value <code>sun.misc</code> to your list of framework properties.</p>
<p>It may be as simple as passing an argument to the VM starting the platform:</p>
<pre><code class="language-sh">$ java -Dorg.osgi.framework.system.packages.extra=sun.misc
</code></pre>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation-from-source"><a class="header" href="#installation-from-source">Installation from Source</a></h1>
<p>In addition to downloading the binary packages, you also have the option of compiling OrientDB from the Community Edition source code, available on GitHub.  This process requires that you install <a href="http://www.git-scm.com/">Git</a> and <a href="https://maven.apache.org/">Apache Maven</a> on your system.</p>
<p>To compile OrientDB from source code, clone the Community Edition repository, then run Maven (<code>mvn</code>) in the newly created directory:</p>
<pre><code class="language-sh">$ git clone https://github.com/orientechnologies/orientdb
$ git checkout develop
$ cd orientdb
$ mvn clean install
</code></pre>
<p>It is possible to skip tests:</p>
<pre><code class="language-sh">$ mvn clean install -DskipTests
</code></pre>
<p>The develop branch contains code for the next version of OrientDB. Stable versions are tagged on master branch.
For each maintained version OrientDB has its own <code>hotfix</code> branch.
As the time of writing this notes, the state of branches is:</p>
<ul>
<li>develop: work in progress for next 3.0.x release (3.0.x-SNAPSHOT)</li>
<li>2.2.x: hot fix for next 2.2.x stable release (2.2.x-SNAPSHOT)</li>
<li>2.1.x: hot fix for next 2.1.x stable release (2.1.x-SNAPSHOT)</li>
<li>2.0.x: hot fix for next 2.0.x stable release (2.0.x-SNAPSHOT)</li>
<li>last tag on master is 2.2.0</li>
</ul>
<p>The build process installs all jars in the local maven repository and creates archives under the <code>distribution</code> module inside the <code>target</code> directory. At the time of writing, building from branch 2.1.x gave:</p>
<pre><code class="language-sh">$ls -l distribution/target/
total 199920
    1088 26 Jan 09:57 archive-tmp
     102 26 Jan 09:57 databases
     102 26 Jan 09:57 orientdb-community-2.2.1-SNAPSHOT.dir
48814386 26 Jan 09:57 orientdb-community-2.2.1-SNAPSHOT.tar.gz
53542231 26 Jan 09:58 orientdb-community-2.2.1-SNAPSHOT.zip
$
</code></pre>
<p>The directory <code>orientdb-community-2.2.1-SNAPSHOT.dir</code> contains the OrientDB distribution uncompressed.
Take a look to <a href="admin/installation/../../misc/Contribute-to-OrientDB.html">Contribute to OrientDB</a> if you want to be involved.</p>
<h2 id="update-permissions"><a class="header" href="#update-permissions">Update Permissions</a></h2>
<p>For Linux, Mac OS X and UNIX-based operating system, you need to change the permissions on  some of the files after compiling from source.</p>
<pre><code class="language-sh">$ chmod 755 bin/*.sh
$ chmod -R 777 config
</code></pre>
<p>These commands update the execute permissions on files in the <code>config/</code> directory and shell scripts in <code>bin/</code>, ensuring that you can run the scripts or programs that you've compiled.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="install-as-service-on-unixlinux"><a class="header" href="#install-as-service-on-unixlinux">Install as Service on Unix/Linux</a></h1>
<p>Following the installation guide above, whether you choose to download binaries or build from source, does not install OrientDB at a system-level.  There are a few additional steps you need to take in order to manage the database system as a service.</p>
<p>OrientDB ships with a script, which allows you to manage the database server as a system-level daemon.  You can find it in the <code>bin/</code> path of your installation directory, (that is, at <code>$ORIENTDB_HOME/bin/orientdb.sh</code>.</p>
<p>The script supports three parameters:</p>
<ul>
<li><code>start</code></li>
<li><code>stop</code></li>
<li><code>status</code></li>
</ul>
<h2 id="configuring-the-script"><a class="header" href="#configuring-the-script">Configuring the Script</a></h2>
<p>In order to use the script on your system, you need to edit the file to define two variables: the path to the installation directory and the user you want to run the database server.</p>
<pre>
$ <code class="lang-sh userinput">vi $ORIENTDB_HOME/bin/orientdb.sh</code>

#!/bin/sh
# OrientDB service script
#
# Copyright (c) Orient Technologies LTD (http://www.orientechnologies.com)

# chkconfig: 2345 20 80
# description: OrientDb init script
# processname: orientdb.sh

# You have to SET the OrientDB installation directory here
ORIENTDB_DIR="YOUR_ORIENTDB_INSTALLATION_PATH"
ORIENTDB_USER="USER_YOU_WANT_ORIENTDB_RUN_WITH"
</pre>
<p>Edit the <code>ORIENTDB_DIR</code> variable to indicate the installation directory.  Edit the <code>ORIENTDB_USER</code> variable to indicate the user you want to run the database server, (for instance, <code>orientdb</code>).</p>
<h2 id="installing-the-script"><a class="header" href="#installing-the-script">Installing the Script</a></h2>
<p>Different operating systems and Linux distributions have different procedures when it comes to managing system daemons, as well as the procedure for starting and stopping them during boot up and shutdown.  Below are generic guides for init and systemd based unix systems as well Mac OS X.  For more information, check the documentation for your particular system.</p>
<h3 id="installing-for-init"><a class="header" href="#installing-for-init">Installing for init</a></h3>
<p>Many Unix-like operating systems such as FreeBSD, most older distributions of Linux, as well as current releases of Debian, Ubuntu and their derivatives use variations on SysV-style init for these processes.  These are typically the systems that manage such processes using the <code>service</code> command.</p>
<p>To install OrientDB as a service on an init-based unix or Linux system, copy the modified <code>orientdb.sh</code> file from <code>$ORIENTDB_HOME/bin</code> into <code>/etc/init.d/</code>:</p>
<pre>
# <code class="lang-sh userinput">cp $ORIENTDB_HOME/bin/orientdb.sh /etc/init.d/orientdb</code>
</pre>
<p>Once this is done, you can start and stop OrientDB using the <code>service</code> command:</p>
<pre>
# <code class="lang-sh userinput">service orientdb start</code>
Starting OrientDB server daemon...
</pre>
<h3 id="installing-for-systemd"><a class="header" href="#installing-for-systemd">Installing for systemd</a></h3>
<p>Most newer releases of Linux, especially among the RPM-based distributions like Red Hat, Fedora, and CentOS, as well as future releases of Debian and Ubuntu use systemd for these processes.  These are the systems that manage such processes using the <code>systemctl</code> command.</p>
<p>The OrientDB's  package  contains a service descriptor file for systemd based distros. The  <code>orientdb.service</code> is placed in the <code>bin</code> directory. To install OrientDB copy the <code>orientdb.service</code> to<code>/etc/systemd/system</code>  directory (check this, may depend on distro). Edit the file:</p>
<pre>
# <code class="lang-sh userinput">vi /etc/systemd/system/orientdb.service</code>

#
# Copyright (c) OrientDB LTD (https://orientdb.dev/)
#

[Unit]
Description=OrientDB Server
After=network.target
After=syslog.target

[Install]
WantedBy=multi-user.target

[Service]
User=ORIENTDB_USER
Group=ORIENTDB_GROUP
ExecStart=$ORIENTDB_HOME/bin/server.sh

</pre>
<p>Set the right user and group. You may want to use the absolute path instead of the environment variable <code>$ORIENTDB_HOME</code>.  Once this file is saved, you can start and stop the OrientDB server using the <code>systemctl</code> command:</p>
<pre>
# <code class="lang-sh userinput">systemctl start orientdb.service</code>
</pre>
<p>Additionally, with the <code>orientdb.service</code> file saved, you can set systemd to start the database server automatically during boot by issuing the <code>enable</code> command:</p>
<pre>
# <code class="lang-sh userinput">systemctl enable orientdb.service</code>
Synchronizing state of orientdb.service with SysV init with /usr/lib/systemd/systemd-sysv-install...
Executing /usr/lib/systemd/systemd-sysv-install enable orientdb
Created symlink from /etc/systemd/system/multi-user.target.wants/orientdb.service to /etc/systemd/system/orientdb.service.
</pre>
<h2 id="installing-for-mac-os-x"><a class="header" href="#installing-for-mac-os-x">Installing for Mac OS X</a></h2>
<h3 id="manual-install"><a class="header" href="#manual-install">Manual install</a></h3>
<p>For Mac OS X:</p>
<ul>
<li>follow the steps described above, in the <code>Configuring the Script</code> section</li>
<li>create an alias to the OrientDB system daemon script and the console.</li>
</ul>
<pre><code class="language-sh">$ alias orientdb-server=/path/to/$ORIENTDB_HOME/bin/orientdb.sh
$ alias orientdb-console=/path/to/$ORIENTDB_HOME/bin/console.sh
</code></pre>
<p>You can now start the OrientDB database server using the following command:</p>
<pre><code class="language-sh">$ orientdb-server start
</code></pre>
<p>Once the database starts, it is accessible through the console script.</p>
<pre>
$ <code class="lang-sh userinput">orientdb-console</code>

OrientDB console v.1.6 www.orientechnologies.com
Type 'HELP' to display all the commands supported.

orientdb>
</pre>
<h3 id="brew"><a class="header" href="#brew">Brew</a></h3>
<p>OrientDB is available through <a href="http://brew.sh/">brew</a>.</p>
<pre>
$ <code class="lang-sh userinput">brew install orientdb</code>
</pre>
<p>The installation process gives an output similar to the following one:</p>
<pre><code class="language-sh">...
==&gt; Downloading https://orientdb.com/download.php?file=orientdb-community-&lt;ORIENTDB_VERSION&gt;.tar.gz
==&gt; /usr/bin/nohup  /usr/local/Cellar/orientdb/&lt;ORIENTDB_VERSION&gt;/libexec/bin/server.sh &amp;
==&gt; /usr/local/Cellar/orientdb/&lt;ORIENTDB_VERSION&gt;/libexec/bin/shutdown.sh
==&gt; OrientDB installed, server's root user password is 'changeme'
==&gt; Please, follow the instruction on the link below to reset it
==&gt; http://orientdb.dev/docs/3.2.x/Server-Security.html#restoring-the-servers-user-root
...
</code></pre>
<p>The installation process setups a default server's root user password that <strong>must</strong> be changed.
The <code>orientdb-server-config.xml</code> file is installed in <code>/usr/local/Cellar/orientdb/&lt;ORIENTDB_VERSION&gt;/libexec/config/</code>.
Open the file and remove the "root" user entry.
Remove the tag <isAfterFirstTime>true</isAfterFirstTime> at the end of the file.
Start the server on interactive console:</p>
<pre><code class="language-sh">/usr/local/Cellar/orientdb/&lt;ORIENTDB_VERSION&gt;/libexec/bin/server.sh
</code></pre>
<p>The script asks for a new password for the database's root user.</p>
<h2 id="other-resources-1"><a class="header" href="#other-resources-1">Other resources</a></h2>
<p>To learn more about how to install OrientDB on specific environment please follow the guide below:</p>
<ul>
<li><a href="http://famvdploeg.com/blog/2013/01/setting-up-an-orientdb-server-on-ubuntu/">Install on Linux Ubuntu</a></li>
<li><a href="http://team.ops4j.org/wiki/display/ORIENT/Installation+on+JBoss+AS">Install on JBoss AS</a></li>
<li><a href="http://team.ops4j.org/wiki/display/ORIENT/Installation+on+GlassFish">Install on GlassFish</a></li>
<li><a href="https://www.digitalocean.com/community/articles/how-to-install-and-use-orientdb-on-an-ubuntu-12-04-vps">Install on Ubuntu 12.04 VPS (DigitalOcean)</a></li>
<li><a href="admin/Unix-Service.html">Install as service on Unix, Linux and MacOSX</a></li>
<li><a href="admin/Windows-Service.html">Install as service on Windows</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="install-as-a-service-on-windows"><a class="header" href="#install-as-a-service-on-windows">Install as a Service on Windows</a></h1>
<p>OrientDB is a Java server application. As most server applications, they have to perform several tasks, before being able to shut down the Virtual Machine process, hence they need a portable way to be notified of the imminent Virtual Machine shutdown.
At the moment, the only way to properly shut down an OrientDB server instance (not embedded) is to execute the <em>shutdown.bat</em> (or <em>shutdown.sh</em>) script shipped with the OrientDB distribution, but it's up to the user to take care of this. This implies that the server instance isn't  stopped correctly, when the computer on which it is deployed, is shut down without executing the above script.</p>
<p><strong>IMPORTANT</strong> Note that you need to start the OrientDB server once manually via <code>server.bat</code> in %ORIENTDB_HOME%\bin once, before starting the service.</p>
<h2 id="apache-commons-daemon"><a class="header" href="#apache-commons-daemon">Apache Commons Daemon</a></h2>
<p><a href="http://commons.apache.org/daemon/">Apache Commons Daemon</a> is a set of applications and API enabling Java server application to run as native non interactive server applications under Unix and Windows. In Unix, server applications running in the background are called <em>daemons</em> and are controlled by the operating system with a set of specified <em>signals</em>. Under Windows, such programs are called services and are controlled by appropriate calls to specific functions defined in the application binary. Although the ways of dealing with running daemons or services are different, in both cases the operating system can notify a server application of its imminent shutdown, and the underlying application has the ability to perform certain tasks, before its process of execution is destroyed. Wrapping OrientDB as a <em>Unix daemon</em> or as a <em>Windows service</em> enables the management of this server application lifecycle through the mechanisms provided natively by both Unix and Windows operating systems.</p>
<h2 id="installation-3"><a class="header" href="#installation-3">Installation</a></h2>
<p>This tutorial is focused on Windows, so you have to download <em>procrun</em>. <a href="http://commons.apache.org/daemon/procrun.html">Procrun</a> is a set of applications, which allow Windows users to wrap (mostly) Java applications (e.g. Tomcat) as a Windows service. The service can be set to automatically start, when the machine boots and will continue to run with no user logged onto the machine.</p>
<ol>
<li>Point you browser to the <a href="http://commons.apache.org/daemon/download_daemon.cgi">Apache Commons Daemon download page</a>.</li>
<li>Click on <strong>Browse native binaries download area...</strong>: you will see the index <strong>commons/daemon/binaries/</strong> (even if the title in the page reports <strong>Index of dist/commons</strong>).</li>
<li>Click on <strong>windows</strong>. Now you can see the index of <strong>commons/daemon/binaries/windows</strong>.</li>
<li>Click on <strong>commons-daemon-x.x.x-bin-windows.zip</strong>. The download starts.</li>
<li>Unzip the file in a directory of your choice.
The content of the archive is depicted below:</li>
</ol>
<pre><code>commons-daemon-1.0.7-bin-windows
|
\---amd64
    |
    \---prunsrv.exe
|
\---ia64
    |
    \---prunsrv.exe
|
\---LICENCE.txt
|
\---NOTICE.txt
|
\---prunmgr.exe
|
\---prunsrv.exe
|
\---RELEASE-NOTES.txt
</code></pre>
<p><strong>prunmgr</strong> is a GUI application for monitoring and configuring Windows services wrapped with procrun. <strong>prunsrv</strong> is a service application for running applications as services. It can convert any application (not just Java applications) to run as a service. The directory <strong>amd64</strong> contains a version of <strong>prunsrv</strong> for x86-64 machines while the directory <strong>ia64</strong> contains a version of <strong>prunsrv</strong> for Itanium 64 machines.</p>
<p>Once you downloaded the applications, you have to put them in a folder under the OrientDB installation folder.</p>
<ol>
<li>Go to the OrientDB folder, in the following referred as <em>%ORIENTDB_HOME%</em></li>
<li>Create a new directory and name it <strong>service</strong></li>
<li>Copy there the appropriate versions of <strong>prunsrv</strong> according to the architecture of your machine and <strong>prunmgr</strong>.</li>
</ol>
<h2 id="configuration-3"><a class="header" href="#configuration-3">Configuration</a></h2>
<p>In this section, we will show how to wrap OrientDB as a Windows Service.
In order to wrap OrientDB as a service, you have to execute a short script that uses the prunsrv application to configure a Windows Service.</p>
<p>Before defining the Windows Service, you have to rename <strong>prunsrv</strong> and <strong>prunmgr</strong> according to the name of the service. Both applications require the name of the service to manage and monitor as parameter but you can avoid it by naming them with the name of the service. In this case, rename them respectively <strong>OrientDBGraph</strong> and <strong>OrientDBGraphw</strong> as <em>OrientDBGraph</em> is the name of the service that you are going to configure with the script below. If you want to use a difference service name, you have to rename both application respectively <strong>myservicename</strong> and <strong>myservicenamew</strong> (for example, if you are wrapping OrientDB and the name of the service is <em>OrientDB</em>, you could rename <em>prunsrv</em> as <em>OrientDB</em> and <em>prunmgr</em> as <em>OrientDBw</em>).
After that, create the file <strong>%ORIENTDB_HOME%\service\installService.bat</strong> with the content depicted below:</p>
<pre><code>:: OrientDB Windows Service Installation
@echo off
rem Remove surrounding quotes from the first parameter
set str=%~1
rem Check JVM DLL location parameter
if "%str%" == "" goto missingJVM
set JVM_DLL=%str%
rem Remove surrounding quotes from the second parameter
set str=%~2
rem Check OrientDB Home location parameter
if "%str%" == "" goto missingOrientDBHome
set ORIENTDB_HOME=%str%

set CONFIG_FILE=%ORIENTDB_HOME%/config/orientdb-server-config.xml
set LOG_FILE=%ORIENTDB_HOME%/config/orientdb-server-log.properties
set LOG_CONSOLE_LEVEL=info
set LOG_FILE_LEVEL=fine
set WWW_PATH=%ORIENTDB_HOME%/www
set ORIENTDB_ENCODING=UTF8
set ORIENTDB_SETTINGS=-Dprofiler.enabled=true -Dcache.level1.enabled=false -Dcache.level2.strategy=1
set JAVA_OPTS_SCRIPT=-XX:+HeapDumpOnOutOfMemoryError

rem Install service
OrientDBGraph.exe //IS --DisplayName="OrientDB GraphEd" ^
--Description="OrientDB Graph Edition, aka GraphEd, contains OrientDB server integrated with the latest release of the TinkerPop Open Source technology stack supporting property graph data model." ^
--StartClass=com.orientechnologies.orient.server.OServerMain --StopClass=com.orientechnologies.orient.server.OServerShutdownMain ^
--Classpath="%ORIENTDB_HOME%\lib\*" --JvmOptions=-Dfile.encoding=%ORIENTDB_ENCODING%;-Djava.util.logging.config.file="%LOG_FILE%";-Dorientdb.config.file="%CONFIG_FILE%";-Dorientdb.www.path="%WWW_PATH%";-Dlog.console.level=%LOG_CONSOLE_LEVEL%;-Dlog.file.level=%LOG_FILE_LEVEL%;-Dorientdb.build.number="@BUILD@";-DORIENTDB_HOME="%ORIENTDB_HOME%" ^
--StartMode=jvm --StartPath="%ORIENTDB_HOME%\bin" --StopMode=jvm --StopPath="%ORIENTDB_HOME%\bin" --Jvm="%JVM_DLL%" --LogPath="%ORIENTDB_HOME%\log" --Startup=auto

EXIT /B

:missingJVM
echo Insert the JVM DLL location
goto printUsage

:missingOrientDBHome
echo Insert the OrientDB Home
goto printUsage

:printUsage
echo usage:
echo     installService JVM_DLL_location OrientDB_Home
EXIT /B
</code></pre>
<p>The script requires two input parameters:</p>
<ol>
<li>The location of jvm.dll, for example <em>C:\Program Files\Java\jdk1.6.0_26\jre\bin\server\jvm.dll</em></li>
<li>The location of the OrientDB installation folder, for example <em>D:\orientdb-graphed-1.0rc5</em></li>
</ol>
<p>The service is actually installed when executing <strong>OrientDBGraph.exe</strong> (originally prunsrv) with the appropriate set of command line arguments and parameters.
The command line argument <strong>//IS</strong> states that the execution of that application will result in a service installation.
Below there is the table with the command line parameters used in the above script.</p>
<table><tbody>
  <tr><th>Parameter name</th><th>Description</th><th>Source</th></tr>
  <tr><td>--DisplayName</td><td>The name displayed in the Windows Services Management Console</td><td>Custom</td></tr>
  <tr><td>--Description</td><td>The description displayed in the Windows Services Management Console</td><td>Custom</td></tr>
  <tr><td>--StartClass</td><td>Class that contains the startup method (= the method to be called to start the application). The default method to be called is the <code>main</code> method</td><td>The class invoked in the */bin/server.bat* script</td></tr>
  <tr><td>--StopClass</td><td>Class that will be used when receiving a Stop service signal. The default method to be called is the <code>main</code> method</td><td>The class invoked in the */bin/shutdown.bat* script</td></tr>
  <tr><td>--Classpath</td><td>Set the Java classpath</td><td>The value of the <code>-cp</code> parameter specified in the _%ORIENTDB_HOME%\bin\server.bat_ script</td></tr>
  <tr><td>--JvmOptions</td><td>List of options to be passed to the JVM separated using either # or ; characters</td><td>The list of options in the form of -D or -X specified in the _%ORIENTDB_HOME%\bin\server.bat_ script and the definition of the ORIENTDB_HOME system property</td></tr>
  <tr><td>--StartMode</td><td>Specify how to start the process. In this case, it will start Java in-process and not as a separate image</td><td>Based on Apache Tomcat configuration</td></tr>
  <tr><td>--StartPath</td><td>Working path for the StartClass</td><td>_%ORIENTDB_HOME%\bin_</td></tr>
  <tr><td>--StopMode</td><td>The same as --StartMode</td><td>Based on Apache Tomcat configuration</td></tr>
  <tr><td>--StopPath</td><td>Working path for the StopClass</td><td>_%ORIENTDB_HOME%\bin_</td></tr>
  <tr><td>--Jvm</td><td>Which *jvm.dll* to use: the default one or the one located in the specified full path</td><td>The first input parameter of this script. Ensure that you insert the location of the Java HotSpot Server VM as a full path. We will use the server version for both start and stop.</td></tr>
  <tr><td>--LogPath</td><td>Path used by prunsrv for logging</td><td>The default location of the Apache Commons Daemon log</td></tr>
  <tr><td>--Startup</td><td>States if the service should start at machine start up or manually</td><td>auto</td></tr>
</tbody></table>
For a complete reference to all available parameters and arguments for prunsrv and prunmgr, visit the [Procrun page](http://commons.apache.org/daemon/procrun.html).
<p>In order to install the service:</p>
<ol>
<li>Open the Windows command shell</li>
<li>Go to <em>%ORIENTDB_HOME%\service</em>, for example typing in the shell <code>&gt; cd D:\orientdb-graphed-1.0rc5\service</code></li>
<li>Execute the <em>installService.bat</em> specifying the <em>jvm.dll</em> location and the OrientDB Home as full paths, for example typing in the shell <code>&gt; installService.bat "C:\Program Files\Java\jdk1.6.0_26\jre\bin\server\jvm.dll" D:\orientdb-graphed-1.0rc5</code></li>
<li>Open the Windows Services Management Console - from the taskbar, click on <em>Start</em>, <em>Control Panel</em>, <em>Administrative Tools</em> and then <em>Service</em> - and check the existance of a service with the same name specified as value of the <code>--DisplayName</code> parameter (in this case <strong>OrientDB GraphEd 1.0rc5</strong>). You can also use <em>%ORIENTDB_HOME%\service\OrientDBGraphw.exe</em> to manage and monitor the <em>OrientDBGraph</em> service.</li>
</ol>
<p>Example (in the <code>service</code> directroy) start and stop the service:</p>
<pre><code>:start
OrientDBGraph.exe //ES
:stop
OrientDBGraph.exe //SS
</code></pre>
<p>Note that you need to start the OrientDB server once manually via <code>server.bat</code> in %ORIENTDB_HOME%\bin once, before starting the service.</p>
<h3 id="other-resources-2"><a class="header" href="#other-resources-2">Other resources</a></h3>
<p>To learn more about how to install OrientDB on specific environment please follow the guide below:</p>
<ul>
<li><a href="http://famvdploeg.com/blog/2013/01/setting-up-an-orientdb-server-on-ubuntu/">Install on Linux Ubuntu</a></li>
<li><a href="http://team.ops4j.org/wiki/display/ORIENT/Installation+on+JBoss+AS">Install on JBoss AS</a></li>
<li><a href="http://team.ops4j.org/wiki/display/ORIENT/Installation+on+GlassFish">Install on GlassFish</a></li>
<li><a href="https://www.digitalocean.com/community/articles/how-to-install-and-use-orientdb-on-an-ubuntu-12-04-vps">Install on Ubuntu 12.04 VPS (DigitalOcean)</a></li>
<li><a href="admin/Unix-Service.html">Install as service on Unix, Linux and MacOSX</a></li>
<li><a href="admin/Windows-Service.html">Install as service on Windows</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installing-in-a-docker-container"><a class="header" href="#installing-in-a-docker-container">Installing in a Docker Container</a></h1>
<p>If you have Docker installed in your computer, this is the easiest way to run OrientDB. From the command line type:</p>
<pre><code class="language-sh">$ docker run -d --name orientdb -p 2424:2424 -p 2480:2480
   -e ORIENTDB_ROOT_PASSWORD=root orientdb:latest
</code></pre>
<p>Where instead of "root", type the root's password you want to use.</p>
<h2 id="building-the-image-on-your-own"><a class="header" href="#building-the-image-on-your-own">Building the image on your own</a></h2>
<p>Dockerfiles are available on a dedicated <a href="https://github.com/orientechnologies/orientdb-docker">repository</a>. The repository has a folder for each maintained version of OrientDB. Dockerfiles are approved by Docker's team.. This allows to build images on your own or even customize them for your special purpose.</p>
<ol>
<li>Clone this project to a local folder:
<pre><code class="language-sh">git clone https://github.com/orientechnologies/orientdb-docker.git
</code></pre>
</li>
<li>Build the image for 2.2.x:
<pre><code class="language-sh">cd 2.2
docker build -t &lt;YOUR_DOCKER_HUB_USER&gt;/orientdb:2.2.11 .
</code></pre>
</li>
<li>Push it to your Docker Hub repository (it will ask for your login credentials):
<pre><code class="language-sh">docker push &lt;YOUR_DOCKER_HUB_USER&gt;/orientdb:2.2.11
</code></pre>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="configuration-4"><a class="header" href="#configuration-4">Configuration</a></h1>
<p>OrientDB can be configured in several ways.</p>
<h2 id="getting-settings"><a class="header" href="#getting-settings">Getting settings</a></h2>
<h3 id="from-java-1"><a class="header" href="#from-java-1">From Java</a></h3>
<p>To retrieve the default or current value of a setting you can use the methods <code>getDefValue()</code> and <code>getValue()</code> of the java enumerator <code>OGlobalConfiguration</code>.</p>
<p>Example:</p>
<ul>
<li>get the default value of the setting <code>USE_WAL</code>: <code>OGlobalConfiguration.USE_WAL.getDefValue();</code></li>
<li>get the current value of the setting <code>USE_WAL</code>: <code>OGlobalConfiguration.USE_WAL.getValue());</code></li>
</ul>
<h3 id="from-the-console"><a class="header" href="#from-the-console">From the Console</a></h3>
<p>To retrieve the full list of current settings from the <a href="admin/../console/README.html">Console</a> you can use the <a href="admin/../console/Console-Command-Config.html"><code>CONFIG</code></a> command:</p>
<pre><code>orientdb&gt; CONFIG

LOCAL SERVER CONFIGURATION
+----+----------------------------------------------+--------------+
|#   |NAME                                          |VALUE         |
+----+----------------------------------------------+--------------+
|0   |environment.dumpCfgAtStartup                  |false         |
|1   |environment.concurrent                        |true          |
|2   |environment.lockManager.concurrency.level     |32            |
|3   |environment.allowJVMShutdown                  |true          |
|4   |script.pool.maxSize                           |20            |
...
|219 |client.channel.minPool                        |1             |
|220 |storage.keepOpen                              |true          |
|221 |cache.local.enabled                           |true          |
+----+----------------------------------------------+--------------+
</code></pre>
<p>To retrieve the value of a specific setting, you can use the <a href="admin/../console/Console-Command-Config-Get.html"><code>CONFIG GET</code></a> command.</p>
<p>Example:</p>
<pre><code>orientdb&gt; CONFIG GET tx.log.fileType

Remote configuration: tx.log.fileType = classic
</code></pre>
<h2 id="changing-settings"><a class="header" href="#changing-settings">Changing settings</a></h2>
<h3 id="by-command-line"><a class="header" href="#by-command-line">By command line</a></h3>
<p>You can pass settings via command line when the JVM is launched. This is typically stored inside <code>server.sh</code> (or <code>server.bat</code> on Windows):</p>
<pre><code>java -Dcache.size=10000 -Dstorage.keepOpen=true ...
</code></pre>
<h3 id="by-server-configuration"><a class="header" href="#by-server-configuration">By server configuration</a></h3>
<p>Put in the <code>&lt;properties&gt;</code> section of the file <strong>orientdb-server-config.xml</strong> (or orientdb-dserver-config.xml) the entries to configure.</p>
<p>Example:</p>
<pre><code class="language-xml">  ...
  &lt;properties&gt;
    &lt;entry name="cache.size" value="10000" /&gt;
    &lt;entry name="storage.keepOpen" value="true" /&gt;
  &lt;/properties&gt;
  ...
</code></pre>
<h3 id="at-run-time"><a class="header" href="#at-run-time">At run-time</a></h3>
<p>Some settings can be changed at run-time.</p>
<h4 id="from-java-2"><a class="header" href="#from-java-2">From Java</a></h4>
<p>To change at run-time a setting from java you can use the <code>setValue()</code> method of the java enumerator <code>OGlobalConfiguration</code>.</p>
<p>Example:</p>
<pre><code class="language-java">OGlobalConfiguration.MVRBTREE_NODE_PAGE_SIZE.setValue(2048);
</code></pre>
<h4 id="from-the-console-1"><a class="header" href="#from-the-console-1">From the Console</a></h4>
<p>To change at run-time a setting from the <a href="admin/../console/README.html">Console</a> you can use the <a href="admin/../console/Console-Command-Config-Set.html"><code>CONFIG SET</code></a> command.</p>
<p>Example:</p>
<pre><code>orientdb&gt; CONFIG SET tx.autoRetry 5
</code></pre>
<h2 id="dump-the-configuration"><a class="header" href="#dump-the-configuration">Dump the configuration</a></h2>
<p>To dump the OrientDB configuration you can set a parameter at JVM launch:</p>
<pre><code>java -Denvironment.dumpCfgAtStartup=true ...
</code></pre>
<p>Or via API at any time:</p>
<pre><code class="language-java">OGlobalConfiguration.dumpConfiguration(System.out);
</code></pre>
<h2 id="parameters"><a class="header" href="#parameters">Parameters</a></h2>
<p>To know more look at the Java enumeration: <a href="https://github.com/nuvolabase/orientdb/blob/master/core/src/main/java/com/orientechnologies/orient/core/config/OGlobalConfiguration.java">OGlobalConfiguration.java</a>. NOTE: <em>The documentation below is auto-generated by parsing the OGlobalConfiguration.java class. Please do not edit the parameters here, but rather edit the documentation in the java class</em>.</p>
<hr />
<h3 id="environment"><a class="header" href="#environment">Environment</a></h3>
<h5 id="environmentdumpcfgatstartup"><a class="header" href="#environmentdumpcfgatstartup">environment.dumpCfgAtStartup</a></h5>
<p>Dumps the configuration during application startup.</p>
<pre><code>Setting name...: environment.dumpCfgAtStartup
Default value..: false
Set at run-time: false
</code></pre>
<h5 id="environmentconcurrent"><a class="header" href="#environmentconcurrent">environment.concurrent</a></h5>
<p>Specifies if running in multi-thread environment. Setting this to false turns off the internal lock management.</p>
<pre><code>Setting name...: environment.concurrent
Default value..: true
Set at run-time: false
</code></pre>
<h5 id="environmentlockmanagerconcurrencylevel"><a class="header" href="#environmentlockmanagerconcurrencylevel">environment.lockManager.concurrency.level</a></h5>
<p>Concurrency level of lock manager.</p>
<pre><code>Setting name...: environment.lockManager.concurrency.level
Default value..: 64
Set at run-time: false
</code></pre>
<h5 id="environmentallowjvmshutdown"><a class="header" href="#environmentallowjvmshutdown">environment.allowJVMShutdown</a></h5>
<p>Allows the shutdown of the JVM, if needed/requested.</p>
<pre><code>Setting name...: environment.allowJVMShutdown
Default value..: true
Set at run-time: true
</code></pre>
<hr />
<h3 id="script"><a class="header" href="#script">Script</a></h3>
<h5 id="scriptpoolmaxsize"><a class="header" href="#scriptpoolmaxsize">script.pool.maxSize</a></h5>
<p>Maximum number of instances in the pool of script engines.</p>
<pre><code>Setting name...: script.pool.maxSize
Default value..: 20
Set at run-time: false
</code></pre>
<hr />
<h3 id="memory"><a class="header" href="#memory">Memory</a></h3>
<h5 id="memoryuseunsafe"><a class="header" href="#memoryuseunsafe">memory.useUnsafe</a></h5>
<p>Indicates whether Unsafe will be used, if it is present.</p>
<pre><code>Setting name...: memory.useUnsafe
Default value..: true
Set at run-time: false
</code></pre>
<h5 id="memorychunksize"><a class="header" href="#memorychunksize">memory.chunk.size</a></h5>
<p>Size of single memory chunk (in bytes) which will be preallocated by OrientDB.</p>
<pre><code>Setting name...: memory.chunk.size
Default value..: 2147483647
Set at run-time: false
</code></pre>
<h5 id="memorydirectmemorysafemode"><a class="header" href="#memorydirectmemorysafemode">memory.directMemory.safeMode</a></h5>
<p>Indicates whether to perform a range check before each direct memory update. It is true by default, but usually it can be safely set to false. It should only be to true after dramatic changes have been made in the storage structures.</p>
<pre><code>Setting name...: memory.directMemory.safeMode
Default value..: true
Set at run-time: false
</code></pre>
<h5 id="memorydirectmemorytrackmode"><a class="header" href="#memorydirectmemorytrackmode">memory.directMemory.trackMode</a></h5>
<p>Activates the direct memory pool <a href="admin/../troubleshooting/Leak-Detector.html">leak detector</a>. This detector causes a large overhead and should be used for debugging purposes only. It's also a good idea to pass the -Djava.util.logging.manager=com.orientechnologies.common.log.OLogManager$DebugLogManager switch to the JVM, if you use this mode, this will enable the logging from JVM shutdown hooks..</p>
<pre><code>Setting name...: memory.directMemory.trackMode
Default value..: false
Set at run-time: false
</code></pre>
<h5 id="memorydirectmemoryonlyalignedmemoryaccess"><a class="header" href="#memorydirectmemoryonlyalignedmemoryaccess">memory.directMemory.onlyAlignedMemoryAccess</a></h5>
<p>Some architectures do not allow unaligned memory access or may suffer from speed degradation. For such platforms, this flag should be set to true.</p>
<pre><code>Setting name...: memory.directMemory.onlyAlignedMemoryAccess
Default value..: true
Set at run-time: false
</code></pre>
<hr />
<h3 id="jvm"><a class="header" href="#jvm">Jvm</a></h3>
<h5 id="jvmgcdelayforoptimize"><a class="header" href="#jvmgcdelayforoptimize">jvm.gc.delayForOptimize</a></h5>
<p>Minimal amount of time (in seconds), since the last System.gc(), when called after tree optimization.</p>
<pre><code>Setting name...: jvm.gc.delayForOptimize
Default value..: 600
Set at run-time: false
</code></pre>
<hr />
<h3 id="storage"><a class="header" href="#storage">Storage</a></h3>
<h5 id="storageopenfileslimit"><a class="header" href="#storageopenfileslimit">storage.openFiles.limit</a></h5>
<p>Limit of amount of files which may be open simultaneously.</p>
<pre><code>Setting name...: storage.openFiles.limit
Default value..: 512
Set at run-time: false
</code></pre>
<h5 id="storagecomponentslockcache"><a class="header" href="#storagecomponentslockcache">storage.componentsLock.cache</a></h5>
<p>Amount of cached locks is used for component lock to avoid constant creation of new lock instances.</p>
<pre><code>Setting name...: storage.componentsLock.cache
Default value..: 10000
Set at run-time: false
</code></pre>
<h5 id="storagediskcachepinnedpages"><a class="header" href="#storagediskcachepinnedpages">storage.diskCache.pinnedPages</a></h5>
<p>Maximum amount of pinned pages which may be contained in cache, if this percent is reached next pages will be left in unpinned state. You can not set value more than 50.</p>
<pre><code>Setting name...: storage.diskCache.pinnedPages
Default value..: 20
Set at run-time: false
</code></pre>
<h5 id="storagediskcachebuffersize"><a class="header" href="#storagediskcachebuffersize">storage.diskCache.bufferSize</a></h5>
<p>Size of disk buffer in megabytes, disk size may be changed at runtime, but if does not enough to contain all pinned pages exception will be thrown.</p>
<pre><code>Setting name...: storage.diskCache.bufferSize
Default value..: 4096
Set at run-time: true
</code></pre>
<h5 id="storagediskcachewritecachepart"><a class="header" href="#storagediskcachewritecachepart">storage.diskCache.writeCachePart</a></h5>
<p>Percentage of disk cache, which is used as write cache.</p>
<pre><code>Setting name...: storage.diskCache.writeCachePart
Default value..: 15
Set at run-time: false
</code></pre>
<h5 id="storagediskcachewritecachepagettl"><a class="header" href="#storagediskcachewritecachepagettl">storage.diskCache.writeCachePageTTL</a></h5>
<p>Max time until a page will be flushed from write cache (in seconds).</p>
<pre><code>Setting name...: storage.diskCache.writeCachePageTTL
Default value..: 86400
Set at run-time: false
</code></pre>
<h5 id="storagediskcachewritecachepageflushinterval"><a class="header" href="#storagediskcachewritecachepageflushinterval">storage.diskCache.writeCachePageFlushInterval</a></h5>
<p>Interval between flushing of pages from write cache (in ms).</p>
<pre><code>Setting name...: storage.diskCache.writeCachePageFlushInterval
Default value..: 25
Set at run-time: false
</code></pre>
<h5 id="storagediskcachewritecacheflushinactivityinterval"><a class="header" href="#storagediskcachewritecacheflushinactivityinterval">storage.diskCache.writeCacheFlushInactivityInterval</a></h5>
<p>Interval between 2 writes to the disk cache, if writes are done with an interval more than provided, all files will be fsynced before the next write, which allows a data restore after a server crash (in ms).</p>
<pre><code>Setting name...: storage.diskCache.writeCacheFlushInactivityInterval
Default value..: 60000
Set at run-time: false
</code></pre>
<h5 id="storagediskcachewritecacheflushlocktimeout"><a class="header" href="#storagediskcachewritecacheflushlocktimeout">storage.diskCache.writeCacheFlushLockTimeout</a></h5>
<p>Maximum amount of time the write cache will wait before a page flushes (in ms, -1 to disable).</p>
<pre><code>Setting name...: storage.diskCache.writeCacheFlushLockTimeout
Default value..: -1
Set at run-time: false
</code></pre>
<h5 id="storagediskcachediskfreespacecheckinterval"><a class="header" href="#storagediskcachediskfreespacecheckinterval">storage.diskCache.diskFreeSpaceCheckInterval</a></h5>
<p>The interval (in seconds), after which the storage periodically checks whether the amount of free disk space is enough to work in write mode.</p>
<pre><code>Setting name...: storage.diskCache.diskFreeSpaceCheckInterval
Default value..: 5
Set at run-time: false
</code></pre>
<h5 id="storagediskcachediskfreespacecheckintervalinpages"><a class="header" href="#storagediskcachediskfreespacecheckintervalinpages">storage.diskCache.diskFreeSpaceCheckIntervalInPages</a></h5>
<p>The interval (how many new pages should be added before free space will be checked), after which the storage periodically checks whether the amount of free disk space is enough to work in write mode.</p>
<pre><code>Setting name...: storage.diskCache.diskFreeSpaceCheckIntervalInPages
Default value..: 2048
Set at run-time: false
</code></pre>
<h5 id="storagediskcachekeepstate"><a class="header" href="#storagediskcachekeepstate">storage.diskCache.keepState</a></h5>
<p>Keep disk cache state between moment when storage is closed and moment when it is opened again. true by default.</p>
<pre><code>Setting name...: storage.diskCache.keepState
Default value..: true
Set at run-time: false
</code></pre>
<h5 id="storageconfigurationsynconupdate"><a class="header" href="#storageconfigurationsynconupdate">storage.configuration.syncOnUpdate</a></h5>
<p>Indicates a force sync should be performed for each update on the storage configuration.</p>
<pre><code>Setting name...: storage.configuration.syncOnUpdate
Default value..: true
Set at run-time: false
</code></pre>
<h5 id="storagecompressionmethod"><a class="header" href="#storagecompressionmethod">storage.compressionMethod</a></h5>
<p>Record compression method used in storage Possible values : gzip, nothing, snappy, snappy-native. Default is 'nothing' that means no compression.</p>
<pre><code>Setting name...: storage.compressionMethod
Default value..: nothing
Set at run-time: false
</code></pre>
<h5 id="storageencryptionmethod"><a class="header" href="#storageencryptionmethod">storage.encryptionMethod</a></h5>
<p>Record encryption method used in storage Possible values : 'aes' and 'des'. Default is 'nothing' for no encryption.</p>
<pre><code>Setting name...: storage.encryptionMethod
Default value..: nothing
Set at run-time: false
</code></pre>
<h5 id="storageencryptionkey"><a class="header" href="#storageencryptionkey">storage.encryptionKey</a></h5>
<p>Contains the storage encryption key. This setting is hidden.</p>
<pre><code>Setting name...: storage.encryptionKey
Default value..: null
Set at run-time: false
</code></pre>
<h5 id="storagemakefullcheckpointaftercreate"><a class="header" href="#storagemakefullcheckpointaftercreate">storage.makeFullCheckpointAfterCreate</a></h5>
<p>Indicates whether a full checkpoint should be performed, if storage was created.</p>
<pre><code>Setting name...: storage.makeFullCheckpointAfterCreate
Default value..: false
Set at run-time: false
</code></pre>
<h5 id="storagemakefullcheckpointafteropen"><a class="header" href="#storagemakefullcheckpointafteropen">storage.makeFullCheckpointAfterOpen</a></h5>
<p>Indicates whether a full checkpoint should be performed, if storage was opened. It is needed so fuzzy checkpoints can work properly.</p>
<pre><code>Setting name...: storage.makeFullCheckpointAfterOpen
Default value..: true
Set at run-time: false
</code></pre>
<h5 id="storagemakefullcheckpointafterclustercreate"><a class="header" href="#storagemakefullcheckpointafterclustercreate">storage.makeFullCheckpointAfterClusterCreate</a></h5>
<p>Indicates whether a full checkpoint should be performed, if storage was opened.</p>
<pre><code>Setting name...: storage.makeFullCheckpointAfterClusterCreate
Default value..: true
Set at run-time: false
</code></pre>
<h5 id="storagetrackchangedrecordsinwal"><a class="header" href="#storagetrackchangedrecordsinwal">storage.trackChangedRecordsInWAL</a></h5>
<p>If this flag is set metadata which contains rids of changed records is added at the end of each atomic operation.</p>
<pre><code>Setting name...: storage.trackChangedRecordsInWAL
Default value..: false
Set at run-time: false
</code></pre>
<h5 id="storageusewal"><a class="header" href="#storageusewal">storage.useWAL</a></h5>
<p>Whether WAL should be used in paginated storage.</p>
<pre><code>Setting name...: storage.useWAL
Default value..: true
Set at run-time: false
</code></pre>
<h5 id="storagewalsynconpageflush"><a class="header" href="#storagewalsynconpageflush">storage.wal.syncOnPageFlush</a></h5>
<p>Indicates whether a force sync should be performed during WAL page flush.</p>
<pre><code>Setting name...: storage.wal.syncOnPageFlush
Default value..: true
Set at run-time: false
</code></pre>
<h5 id="storagewalcachesize"><a class="header" href="#storagewalcachesize">storage.wal.cacheSize</a></h5>
<p>Maximum size of WAL cache (in amount of WAL pages, each page is 64k) If set to 0, caching will be disabled.</p>
<pre><code>Setting name...: storage.wal.cacheSize
Default value..: 3000
Set at run-time: false
</code></pre>
<h5 id="storagewalfileautocloseinterval"><a class="header" href="#storagewalfileautocloseinterval">storage.wal.fileAutoCloseInterval</a></h5>
<p>Interval in seconds after which WAL file will be closed if there is no any IO operations on this file (in seconds), default value is 10.</p>
<pre><code>Setting name...: storage.wal.fileAutoCloseInterval
Default value..: 10
Set at run-time: false
</code></pre>
<h5 id="storagewalmaxsegmentsize"><a class="header" href="#storagewalmaxsegmentsize">storage.wal.maxSegmentSize</a></h5>
<p>Maximum size of single WAL segment (in megabytes).</p>
<pre><code>Setting name...: storage.wal.maxSegmentSize
Default value..: 128
Set at run-time: false
</code></pre>
<h5 id="storagewalmaxsize"><a class="header" href="#storagewalmaxsize">storage.wal.maxSize</a></h5>
<p>Maximum size of WAL on disk (in megabytes).</p>
<pre><code>Setting name...: storage.wal.maxSize
Default value..: 4096
Set at run-time: false
</code></pre>
<h5 id="storagewalcommittimeout"><a class="header" href="#storagewalcommittimeout">storage.wal.commitTimeout</a></h5>
<p>Maximum interval between WAL commits (in ms.).</p>
<pre><code>Setting name...: storage.wal.commitTimeout
Default value..: 1000
Set at run-time: false
</code></pre>
<h5 id="storagewalshutdowntimeout"><a class="header" href="#storagewalshutdowntimeout">storage.wal.shutdownTimeout</a></h5>
<p>Maximum wait interval between events, when the background flush threadreceives a shutdown command and when the background flush will be stopped (in ms.).</p>
<pre><code>Setting name...: storage.wal.shutdownTimeout
Default value..: 10000
Set at run-time: false
</code></pre>
<h5 id="storagewalfuzzycheckpointinterval"><a class="header" href="#storagewalfuzzycheckpointinterval">storage.wal.fuzzyCheckpointInterval</a></h5>
<p>Interval between fuzzy checkpoints (in seconds).</p>
<pre><code>Setting name...: storage.wal.fuzzyCheckpointInterval
Default value..: 300
Set at run-time: false
</code></pre>
<h5 id="storagewalreportafteroperationsduringrestore"><a class="header" href="#storagewalreportafteroperationsduringrestore">storage.wal.reportAfterOperationsDuringRestore</a></h5>
<p>Amount of processed log operations, after which status of data restore procedure will be printed (0 or a negative value, disables the logging).</p>
<pre><code>Setting name...: storage.wal.reportAfterOperationsDuringRestore
Default value..: 10000
Set at run-time: false
</code></pre>
<h5 id="storagewalrestorebatchsize"><a class="header" href="#storagewalrestorebatchsize">storage.wal.restore.batchSize</a></h5>
<p>Amount of WAL records, which are read at once in a single batch during a restore procedure.</p>
<pre><code>Setting name...: storage.wal.restore.batchSize
Default value..: 1000
Set at run-time: false
</code></pre>
<h5 id="storagewalreadcachesize"><a class="header" href="#storagewalreadcachesize">storage.wal.readCacheSize</a></h5>
<p>Size of WAL read cache in amount of pages.</p>
<pre><code>Setting name...: storage.wal.readCacheSize
Default value..: 1000
Set at run-time: false
</code></pre>
<h5 id="storagewalfuzzycheckpointshutdownwait"><a class="header" href="#storagewalfuzzycheckpointshutdownwait">storage.wal.fuzzyCheckpointShutdownWait</a></h5>
<p>The amount of time the DB should wait until it shuts down (in seconds).</p>
<pre><code>Setting name...: storage.wal.fuzzyCheckpointShutdownWait
Default value..: 600
Set at run-time: false
</code></pre>
<h5 id="storagewalfullcheckpointshutdowntimeout"><a class="header" href="#storagewalfullcheckpointshutdowntimeout">storage.wal.fullCheckpointShutdownTimeout</a></h5>
<p>The amount of time the DB will wait, until a checkpoint is finished, during a DB shutdown (in seconds).</p>
<pre><code>Setting name...: storage.wal.fullCheckpointShutdownTimeout
Default value..: 600
Set at run-time: false
</code></pre>
<h5 id="storagewalpath"><a class="header" href="#storagewalpath">storage.wal.path</a></h5>
<p>Path to the WAL file on the disk. By default, it is placed in the DB directory, but it is highly recommended to use a separate disk to store log operations.</p>
<pre><code>Setting name...: storage.wal.path
Default value..: null
Set at run-time: false
</code></pre>
<h5 id="storagediskcachepagesize"><a class="header" href="#storagediskcachepagesize">storage.diskCache.pageSize</a></h5>
<p>Size of page of disk buffer (in kilobytes). !!! NEVER CHANGE THIS VALUE !!!.</p>
<pre><code>Setting name...: storage.diskCache.pageSize
Default value..: 64
Set at run-time: false
</code></pre>
<h5 id="storagediskcachediskfreespacelimit"><a class="header" href="#storagediskcachediskfreespacelimit">storage.diskCache.diskFreeSpaceLimit</a></h5>
<p>Minimum amount of space on disk, which, when exceeded, will cause the database to switch to read-only mode (in megabytes).</p>
<pre><code>Setting name...: storage.diskCache.diskFreeSpaceLimit
Default value..: 256
Set at run-time: false
</code></pre>
<h5 id="storagelowestfreelistbound"><a class="header" href="#storagelowestfreelistbound">storage.lowestFreeListBound</a></h5>
<p>The least amount of free space (in kb) in a page, which is tracked in paginated storage.</p>
<pre><code>Setting name...: storage.lowestFreeListBound
Default value..: 16
Set at run-time: false
</code></pre>
<h5 id="storagelocktimeout"><a class="header" href="#storagelocktimeout">storage.lockTimeout</a></h5>
<p>Maximum amount of time (in ms) to lock the storage.</p>
<pre><code>Setting name...: storage.lockTimeout
Default value..: 0
Set at run-time: false
</code></pre>
<h5 id="storagerecordlocktimeout"><a class="header" href="#storagerecordlocktimeout">storage.record.lockTimeout</a></h5>
<p>Maximum of time (in ms) to lock a shared record.</p>
<pre><code>Setting name...: storage.record.lockTimeout
Default value..: 2000
Set at run-time: false
</code></pre>
<h5 id="storageusetombstones"><a class="header" href="#storageusetombstones">storage.useTombstones</a></h5>
<p>When a record is deleted, the space in the cluster will not be freed, but rather tombstoned.</p>
<pre><code>Setting name...: storage.useTombstones
Default value..: false
Set at run-time: false
</code></pre>
<h5 id="storageclusterusecrc32"><a class="header" href="#storageclusterusecrc32">storage.cluster.usecrc32</a></h5>
<p>Indicates whether crc32 should be used for each record to check record integrity.</p>
<pre><code>Setting name...: storage.cluster.usecrc32
Default value..: false
Set at run-time: false
</code></pre>
<h5 id="storagekeepopen"><a class="header" href="#storagekeepopen">storage.keepOpen</a></h5>
<p>Deprecated.</p>
<pre><code>Setting name...: storage.keepOpen
Default value..: true
Set at run-time: false
</code></pre>
<hr />
<h3 id="record-1"><a class="header" href="#record-1">Record</a></h3>
<h5 id="recorddownsizingenabled"><a class="header" href="#recorddownsizingenabled">record.downsizing.enabled</a></h5>
<p>On updates, if the record size is lower than before, this reduces the space taken accordingly. If enabled this could increase defragmentation, but it reduces the used disk space.</p>
<pre><code>Setting name...: record.downsizing.enabled
Default value..: true
Set at run-time: false
</code></pre>
<hr />
<h3 id="object"><a class="header" href="#object">Object</a></h3>
<h5 id="objectsaveonlydirty"><a class="header" href="#objectsaveonlydirty">object.saveOnlyDirty</a></h5>
<p>Object Database only! It saves objects bound to dirty records.</p>
<pre><code>Setting name...: object.saveOnlyDirty
Default value..: false
Set at run-time: true
</code></pre>
<hr />
<h3 id="db"><a class="header" href="#db">Db</a></h3>
<h5 id="dbpoolmin"><a class="header" href="#dbpoolmin">db.pool.min</a></h5>
<p>Default database pool minimum size.</p>
<pre><code>Setting name...: db.pool.min
Default value..: 1
Set at run-time: false
</code></pre>
<h5 id="dbpoolmax"><a class="header" href="#dbpoolmax">db.pool.max</a></h5>
<p>Default database pool maximum size.</p>
<pre><code>Setting name...: db.pool.max
Default value..: 100
Set at run-time: false
</code></pre>
<h5 id="dbpoolidletimeout"><a class="header" href="#dbpoolidletimeout">db.pool.idleTimeout</a></h5>
<p>Timeout for checking for free databases in the pool.</p>
<pre><code>Setting name...: db.pool.idleTimeout
Default value..: 0
Set at run-time: false
</code></pre>
<h5 id="dbpoolidlecheckdelay"><a class="header" href="#dbpoolidlecheckdelay">db.pool.idleCheckDelay</a></h5>
<p>Delay time on checking for idle databases.</p>
<pre><code>Setting name...: db.pool.idleCheckDelay
Default value..: 0
Set at run-time: false
</code></pre>
<h5 id="dbmvccthrowfast"><a class="header" href="#dbmvccthrowfast">db.mvcc.throwfast</a></h5>
<p>Use fast-thrown exceptions for MVCC OConcurrentModificationExceptions. No context information will be available. Set to true, when these exceptions are thrown, but the details are not necessary.</p>
<pre><code>Setting name...: db.mvcc.throwfast
Default value..: false
Set at run-time: true
</code></pre>
<h5 id="dbvalidation"><a class="header" href="#dbvalidation">db.validation</a></h5>
<p>Enables or disables validation of records.</p>
<pre><code>Setting name...: db.validation
Default value..: true
Set at run-time: true
</code></pre>
<h5 id="dbdocumentserializer"><a class="header" href="#dbdocumentserializer">db.document.serializer</a></h5>
<p>The default record serializer used by the document database.</p>
<pre><code>Setting name...: db.document.serializer
Default value..: ORecordSerializerBinary
Set at run-time: false
</code></pre>
<h5 id="dbmakefullcheckpointonindexchange"><a class="header" href="#dbmakefullcheckpointonindexchange">db.makeFullCheckpointOnIndexChange</a></h5>
<p>When index metadata is changed, a full checkpoint is performed.</p>
<pre><code>Setting name...: db.makeFullCheckpointOnIndexChange
Default value..: true
Set at run-time: true
</code></pre>
<h5 id="dbmakefullcheckpointonschemachange"><a class="header" href="#dbmakefullcheckpointonschemachange">db.makeFullCheckpointOnSchemaChange</a></h5>
<p>When index schema is changed, a full checkpoint is performed.</p>
<pre><code>Setting name...: db.makeFullCheckpointOnSchemaChange
Default value..: true
Set at run-time: true
</code></pre>
<h5 id="dbmvcc"><a class="header" href="#dbmvcc">db.mvcc</a></h5>
<p>Deprecated, MVCC cannot be disabled anymore.</p>
<pre><code>Setting name...: db.mvcc
Default value..: true
Set at run-time: false
</code></pre>
<h5 id="dbusedistributedversion"><a class="header" href="#dbusedistributedversion">db.use.distributedVersion</a></h5>
<p>Deprecated, distributed version is not used anymore.</p>
<pre><code>Setting name...: db.use.distributedVersion
Default value..: false
Set at run-time: false
</code></pre>
<hr />
<h3 id="nontx"><a class="header" href="#nontx">NonTX</a></h3>
<h5 id="nontxrecordupdatesynch"><a class="header" href="#nontxrecordupdatesynch">nonTX.recordUpdate.synch</a></h5>
<p>Executes a sync against the file-system for every record operation. This slows down record updates, but guarantees reliability on unreliable drives.</p>
<pre><code>Setting name...: nonTX.recordUpdate.synch
Default value..: false
Set at run-time: false
</code></pre>
<h5 id="nontxclusterssyncimmediately"><a class="header" href="#nontxclusterssyncimmediately">nonTX.clusters.sync.immediately</a></h5>
<p>List of clusters to sync immediately after update (separated by commas). Can be useful for a manual index.</p>
<pre><code>Setting name...: nonTX.clusters.sync.immediately
Default value..: manindex
Set at run-time: false
</code></pre>
<hr />
<h3 id="tx"><a class="header" href="#tx">Tx</a></h3>
<h5 id="txtrackatomicoperations"><a class="header" href="#txtrackatomicoperations">tx.trackAtomicOperations</a></h5>
<p>This setting is used only for debug purposes. It creates a stack trace of methods, when an atomic operation is started.</p>
<pre><code>Setting name...: tx.trackAtomicOperations
Default value..: false
Set at run-time: false
</code></pre>
<h5 id="txcommitsynch"><a class="header" href="#txcommitsynch">tx.commit.synch</a></h5>
<p>Synchronizes the storage after transaction commit.</p>
<pre><code>Setting name...: tx.commit.synch
Default value..: false
Set at run-time: false
</code></pre>
<h5 id="txautoretry"><a class="header" href="#txautoretry">tx.autoRetry</a></h5>
<p>Maximum number of automatic retry if some resource has been locked in the middle of the transaction (Timeout exception).</p>
<pre><code>Setting name...: tx.autoRetry
Default value..: 1
Set at run-time: false
</code></pre>
<h5 id="txlogfiletype"><a class="header" href="#txlogfiletype">tx.log.fileType</a></h5>
<p>File type to handle transaction logs: mmap or classic.</p>
<pre><code>Setting name...: tx.log.fileType
Default value..: classic
Set at run-time: false
</code></pre>
<h5 id="txlogsynch"><a class="header" href="#txlogsynch">tx.log.synch</a></h5>
<p>Executes a synch against the file-system at every log entry. This slows down transactions but guarantee transaction reliability on unreliable drives.</p>
<pre><code>Setting name...: tx.log.synch
Default value..: false
Set at run-time: false
</code></pre>
<h5 id="txuselog"><a class="header" href="#txuselog">tx.useLog</a></h5>
<p>Transactions use log file to store temporary data to be rolled back in case of crash.</p>
<pre><code>Setting name...: tx.useLog
Default value..: true
Set at run-time: false
</code></pre>
<hr />
<h3 id="index"><a class="header" href="#index">Index</a></h3>
<h5 id="indexembeddedtosbtreebonsaithreshold"><a class="header" href="#indexembeddedtosbtreebonsaithreshold">index.embeddedToSbtreeBonsaiThreshold</a></h5>
<p>Amount of values, after which the index implementation will use an sbtree as a values container. Set to -1, to disable and force using an sbtree.</p>
<pre><code>Setting name...: index.embeddedToSbtreeBonsaiThreshold
Default value..: 40
Set at run-time: true
</code></pre>
<h5 id="indexsbtreebonsaitoembeddedthreshold"><a class="header" href="#indexsbtreebonsaitoembeddedthreshold">index.sbtreeBonsaiToEmbeddedThreshold</a></h5>
<p>Amount of values, after which index implementation will use an embedded values container (disabled by default).</p>
<pre><code>Setting name...: index.sbtreeBonsaiToEmbeddedThreshold
Default value..: -1
Set at run-time: true
</code></pre>
<h5 id="indexautosynchronousautorebuild"><a class="header" href="#indexautosynchronousautorebuild">index.auto.synchronousAutoRebuild</a></h5>
<p>Synchronous execution of auto rebuilding of indexes, in case of a DB crash.</p>
<pre><code>Setting name...: index.auto.synchronousAutoRebuild
Default value..: true
Set at run-time: false
</code></pre>
<h5 id="indexautolazyupdates"><a class="header" href="#indexautolazyupdates">index.auto.lazyUpdates</a></h5>
<p>Configure the TreeMaps for automatic indexes, as buffered or not. -1 means buffered until tx.commit() or db.close() are called.</p>
<pre><code>Setting name...: index.auto.lazyUpdates
Default value..: 10000
Set at run-time: false
</code></pre>
<h5 id="indexflushaftercreate"><a class="header" href="#indexflushaftercreate">index.flushAfterCreate</a></h5>
<p>Flush storage buffer after index creation.</p>
<pre><code>Setting name...: index.flushAfterCreate
Default value..: true
Set at run-time: false
</code></pre>
<h5 id="indexmanuallazyupdates"><a class="header" href="#indexmanuallazyupdates">index.manual.lazyUpdates</a></h5>
<p>Configure the TreeMaps for manual indexes as buffered or not. -1 means buffered until tx.commit() or db.close() are called.</p>
<pre><code>Setting name...: index.manual.lazyUpdates
Default value..: 1
Set at run-time: false
</code></pre>
<h5 id="indexdurableinnontxmode"><a class="header" href="#indexdurableinnontxmode">index.durableInNonTxMode</a></h5>
<p>Indicates whether index implementation for plocal storage will be durable in non-Tx mode (true by default).</p>
<pre><code>Setting name...: index.durableInNonTxMode
Default value..: true
Set at run-time: false
</code></pre>
<h5 id="indexignorenullvaluesdefault"><a class="header" href="#indexignorenullvaluesdefault">index.ignoreNullValuesDefault</a></h5>
<p>Controls whether null values will be ignored by default by newly created indexes or not (false by default).</p>
<pre><code>Setting name...: index.ignoreNullValuesDefault
Default value..: false
Set at run-time: false
</code></pre>
<h5 id="indextxmode"><a class="header" href="#indextxmode">index.txMode</a></h5>
<p>Indicates the index durability level in TX mode. Can be ROLLBACK_ONLY or FULL (ROLLBACK_ONLY by default).</p>
<pre><code>Setting name...: index.txMode
Default value..: FULL
Set at run-time: false
</code></pre>
<h5 id="indexcursorprefetchsize"><a class="header" href="#indexcursorprefetchsize">index.cursor.prefetchSize</a></h5>
<p>Default prefetch size of index cursor.</p>
<pre><code>Setting name...: index.cursor.prefetchSize
Default value..: 500000
Set at run-time: false
</code></pre>
<h5 id="indexautorebuildafternotsoftclose"><a class="header" href="#indexautorebuildafternotsoftclose">index.auto.rebuildAfterNotSoftClose</a></h5>
<p>Auto rebuild all automatic indexes after upon database open when wasn't closed properly.</p>
<pre><code>Setting name...: index.auto.rebuildAfterNotSoftClose
Default value..: true
Set at run-time: false
</code></pre>
<hr />
<h3 id="hashtable"><a class="header" href="#hashtable">HashTable</a></h3>
<h5 id="hashtableslitbucketsbufferlength"><a class="header" href="#hashtableslitbucketsbufferlength">hashTable.slitBucketsBuffer.length</a></h5>
<p>Length of buffer (in pages), where buckets that were split, but not flushed to the disk, are kept. This buffer is used to minimize random IO overhead.</p>
<pre><code>Setting name...: hashTable.slitBucketsBuffer.length
Default value..: 1500
Set at run-time: false
</code></pre>
<hr />
<h3 id="sbtree"><a class="header" href="#sbtree">Sbtree</a></h3>
<h5 id="sbtreemaxdepth"><a class="header" href="#sbtreemaxdepth">sbtree.maxDepth</a></h5>
<p>Maximum depth of sbtree, which will be traversed during key look up until it will be treated as broken (64 by default).</p>
<pre><code>Setting name...: sbtree.maxDepth
Default value..: 64
Set at run-time: false
</code></pre>
<h5 id="sbtreemaxkeysize"><a class="header" href="#sbtreemaxkeysize">sbtree.maxKeySize</a></h5>
<p>Maximum size of a key, which can be put in the SBTree in bytes (10240 by default).</p>
<pre><code>Setting name...: sbtree.maxKeySize
Default value..: 10240
Set at run-time: false
</code></pre>
<h5 id="sbtreemaxembeddedvaluesize"><a class="header" href="#sbtreemaxembeddedvaluesize">sbtree.maxEmbeddedValueSize</a></h5>
<p>Maximum size of value which can be put in an SBTree without creation link to a standalone page in bytes (40960 by default).</p>
<pre><code>Setting name...: sbtree.maxEmbeddedValueSize
Default value..: 40960
Set at run-time: false
</code></pre>
<hr />
<h3 id="sbtreebonsai"><a class="header" href="#sbtreebonsai">Sbtreebonsai</a></h3>
<h5 id="sbtreebonsaibucketsize"><a class="header" href="#sbtreebonsaibucketsize">sbtreebonsai.bucketSize</a></h5>
<p>Size of bucket in OSBTreeBonsai (in kB). Contract: bucketSize &lt; storagePageSize, storagePageSize % bucketSize == 0.</p>
<pre><code>Setting name...: sbtreebonsai.bucketSize
Default value..: 2
Set at run-time: false
</code></pre>
<h5 id="sbtreebonsailinkbagcachesize"><a class="header" href="#sbtreebonsailinkbagcachesize">sbtreebonsai.linkBagCache.size</a></h5>
<p>Amount of LINKBAG collections to be cached, to avoid constant reloading of data.</p>
<pre><code>Setting name...: sbtreebonsai.linkBagCache.size
Default value..: 100000
Set at run-time: false
</code></pre>
<h5 id="sbtreebonsailinkbagcacheevictionsize"><a class="header" href="#sbtreebonsailinkbagcacheevictionsize">sbtreebonsai.linkBagCache.evictionSize</a></h5>
<p>The number of cached LINKBAG collections, which will be removed, when the cache limit is reached.</p>
<pre><code>Setting name...: sbtreebonsai.linkBagCache.evictionSize
Default value..: 1000
Set at run-time: false
</code></pre>
<h5 id="sbtreebonsaifreespacereusetrigger"><a class="header" href="#sbtreebonsaifreespacereusetrigger">sbtreebonsai.freeSpaceReuseTrigger</a></h5>
<p>How much free space should be in an sbtreebonsai file, before it will be reused during the next allocation.</p>
<pre><code>Setting name...: sbtreebonsai.freeSpaceReuseTrigger
Default value..: 0.5
Set at run-time: false
</code></pre>
<hr />
<h3 id="ridbag"><a class="header" href="#ridbag">RidBag</a></h3>
<h5 id="ridbagembeddeddefaultsize"><a class="header" href="#ridbagembeddeddefaultsize">ridBag.embeddedDefaultSize</a></h5>
<p>Size of embedded RidBag array, when created (empty).</p>
<pre><code>Setting name...: ridBag.embeddedDefaultSize
Default value..: 4
Set at run-time: false
</code></pre>
<h5 id="ridbagembeddedtosbtreebonsaithreshold"><a class="header" href="#ridbagembeddedtosbtreebonsaithreshold">ridBag.embeddedToSbtreeBonsaiThreshold</a></h5>
<p>Amount of values after which a LINKBAG implementation will use sbtree as values container. Set to -1 to always use an sbtree.</p>
<pre><code>Setting name...: ridBag.embeddedToSbtreeBonsaiThreshold
Default value..: 40
Set at run-time: true
</code></pre>
<h5 id="ridbagsbtreebonsaitoembeddedtothreshold"><a class="header" href="#ridbagsbtreebonsaitoembeddedtothreshold">ridBag.sbtreeBonsaiToEmbeddedToThreshold</a></h5>
<p>Amount of values, after which a LINKBAG implementation will use an embedded values container (disabled by default).</p>
<pre><code>Setting name...: ridBag.sbtreeBonsaiToEmbeddedToThreshold
Default value..: -1
Set at run-time: true
</code></pre>
<hr />
<h3 id="collections"><a class="header" href="#collections">Collections</a></h3>
<h5 id="collectionsprefersbtreeset"><a class="header" href="#collectionsprefersbtreeset">collections.preferSBTreeSet</a></h5>
<p>This configuration setting is experimental.</p>
<pre><code>Setting name...: collections.preferSBTreeSet
Default value..: false
Set at run-time: false
</code></pre>
<hr />
<h3 id="file"><a class="header" href="#file">File</a></h3>
<h5 id="filetrackfileclose"><a class="header" href="#filetrackfileclose">file.trackFileClose</a></h5>
<p>Log all the cases when files are closed. This is needed only for internal debugging purposes.</p>
<pre><code>Setting name...: file.trackFileClose
Default value..: false
Set at run-time: false
</code></pre>
<h5 id="filelock"><a class="header" href="#filelock">file.lock</a></h5>
<p>Locks files when used. Default is true.</p>
<pre><code>Setting name...: file.lock
Default value..: true
Set at run-time: false
</code></pre>
<h5 id="filedeletedelay"><a class="header" href="#filedeletedelay">file.deleteDelay</a></h5>
<p>Delay time (in ms) to wait for another attempt to delete a locked file.</p>
<pre><code>Setting name...: file.deleteDelay
Default value..: 10
Set at run-time: false
</code></pre>
<h5 id="filedeleteretry"><a class="header" href="#filedeleteretry">file.deleteRetry</a></h5>
<p>Number of retries to delete a locked file.</p>
<pre><code>Setting name...: file.deleteRetry
Default value..: 50
Set at run-time: false
</code></pre>
<hr />
<h3 id="security-1"><a class="header" href="#security-1">Security</a></h3>
<h5 id="securityuserpasswordsaltiterations"><a class="header" href="#securityuserpasswordsaltiterations">security.userPasswordSaltIterations</a></h5>
<p>Number of iterations to generate the salt or user password. Changing this setting does not affect stored passwords.</p>
<pre><code>Setting name...: security.userPasswordSaltIterations
Default value..: 65536
Set at run-time: false
</code></pre>
<h5 id="securityuserpasswordsaltcachesize"><a class="header" href="#securityuserpasswordsaltcachesize">security.userPasswordSaltCacheSize</a></h5>
<p>Cache size of hashed salt passwords. The cache works as LRU. Use 0 to disable the cache.</p>
<pre><code>Setting name...: security.userPasswordSaltCacheSize
Default value..: 500
Set at run-time: false
</code></pre>
<h5 id="securityuserpassworddefaultalgorithm"><a class="header" href="#securityuserpassworddefaultalgorithm">security.userPasswordDefaultAlgorithm</a></h5>
<p>Default encryption algorithm used for passwords hashing.</p>
<pre><code>Setting name...: security.userPasswordDefaultAlgorithm
Default value..: PBKDF2WithHmacSHA256
Set at run-time: false
</code></pre>
<h5 id="securitycreatedefaultusers"><a class="header" href="#securitycreatedefaultusers">security.createDefaultUsers</a></h5>
<p>Indicates whether default database users should be created.</p>
<pre><code>Setting name...: security.createDefaultUsers
Default value..: true
Set at run-time: false
</code></pre>
<hr />
<h3 id="network"><a class="header" href="#network">Network</a></h3>
<h5 id="networkmaxconcurrentsessions"><a class="header" href="#networkmaxconcurrentsessions">network.maxConcurrentSessions</a></h5>
<p>Maximum number of concurrent sessions.</p>
<pre><code>Setting name...: network.maxConcurrentSessions
Default value..: 1000
Set at run-time: true
</code></pre>
<h5 id="networksocketbuffersize"><a class="header" href="#networksocketbuffersize">network.socketBufferSize</a></h5>
<p>TCP/IP Socket buffer size.</p>
<pre><code>Setting name...: network.socketBufferSize
Default value..: 32768
Set at run-time: true
</code></pre>
<h5 id="networklocktimeout"><a class="header" href="#networklocktimeout">network.lockTimeout</a></h5>
<p>Timeout (in ms) to acquire a lock against a channel.</p>
<pre><code>Setting name...: network.lockTimeout
Default value..: 15000
Set at run-time: true
</code></pre>
<h5 id="networksockettimeout"><a class="header" href="#networksockettimeout">network.socketTimeout</a></h5>
<p>TCP/IP Socket timeout (in ms).</p>
<pre><code>Setting name...: network.socketTimeout
Default value..: 15000
Set at run-time: true
</code></pre>
<h5 id="networkrequesttimeout"><a class="header" href="#networkrequesttimeout">network.requestTimeout</a></h5>
<p>Request completion timeout (in ms).</p>
<pre><code>Setting name...: network.requestTimeout
Default value..: 3600000
Set at run-time: true
</code></pre>
<h5 id="networkretry"><a class="header" href="#networkretry">network.retry</a></h5>
<p>Number of attempts to connect to the server on failure.</p>
<pre><code>Setting name...: network.retry
Default value..: 5
Set at run-time: true
</code></pre>
<h5 id="networkretrydelay"><a class="header" href="#networkretrydelay">network.retryDelay</a></h5>
<p>The time (in ms) the client must wait, before reconnecting to the server on failure.</p>
<pre><code>Setting name...: network.retryDelay
Default value..: 500
Set at run-time: true
</code></pre>
<h5 id="networkbinaryloadbalancingenabled"><a class="header" href="#networkbinaryloadbalancingenabled">network.binary.loadBalancing.enabled</a></h5>
<p>Asks for DNS TXT record, to determine if load balancing is supported.</p>
<pre><code>Setting name...: network.binary.loadBalancing.enabled
Default value..: false
Set at run-time: true
</code></pre>
<h5 id="networkbinaryloadbalancingtimeout"><a class="header" href="#networkbinaryloadbalancingtimeout">network.binary.loadBalancing.timeout</a></h5>
<p>Maximum time (in ms) to wait for the answer from DNS about the TXT record for load balancing.</p>
<pre><code>Setting name...: network.binary.loadBalancing.timeout
Default value..: 2000
Set at run-time: true
</code></pre>
<h5 id="networkbinarymaxlength"><a class="header" href="#networkbinarymaxlength">network.binary.maxLength</a></h5>
<p>TCP/IP max content length (in KB) of BINARY requests.</p>
<pre><code>Setting name...: network.binary.maxLength
Default value..: 16384
Set at run-time: true
</code></pre>
<h5 id="networkbinaryreadresponsemaxtimes"><a class="header" href="#networkbinaryreadresponsemaxtimes">network.binary.readResponse.maxTimes</a></h5>
<p>Maximum attempts, until a response can be read. Otherwise, the response will be dropped from the channel.</p>
<pre><code>Setting name...: network.binary.readResponse.maxTimes
Default value..: 20
Set at run-time: true
</code></pre>
<h5 id="networkbinarydebug"><a class="header" href="#networkbinarydebug">network.binary.debug</a></h5>
<p>Debug mode: print all data incoming on the binary channel.</p>
<pre><code>Setting name...: network.binary.debug
Default value..: false
Set at run-time: true
</code></pre>
<h5 id="networkhttpinstalldefaultcommands"><a class="header" href="#networkhttpinstalldefaultcommands">network.http.installDefaultCommands</a></h5>
<p>Installs the default HTTP commands.</p>
<pre><code>Setting name...: network.http.installDefaultCommands
Default value..: true
Set at run-time: true
</code></pre>
<h5 id="networkhttpserverinfo"><a class="header" href="#networkhttpserverinfo">network.http.serverInfo</a></h5>
<p>Server info to send in HTTP responses. Change the default if you want to hide it is a OrientDB Server.</p>
<pre><code>Setting name...: network.http.serverInfo
Default value..: OrientDB Server v.2.2.12-SNAPSHOT
Set at run-time: true
</code></pre>
<h5 id="networkhttpmaxlength"><a class="header" href="#networkhttpmaxlength">network.http.maxLength</a></h5>
<p>TCP/IP max content length (in bytes) for HTTP requests.</p>
<pre><code>Setting name...: network.http.maxLength
Default value..: 1000000
Set at run-time: true
</code></pre>
<h5 id="networkhttpstreaming"><a class="header" href="#networkhttpstreaming">network.http.streaming</a></h5>
<p>Enable Http chunked streaming for json responses.</p>
<pre><code>Setting name...: network.http.streaming
Default value..: true
Set at run-time: false
</code></pre>
<h5 id="networkhttpcharset"><a class="header" href="#networkhttpcharset">network.http.charset</a></h5>
<p>Http response charset.</p>
<pre><code>Setting name...: network.http.charset
Default value..: utf-8
Set at run-time: true
</code></pre>
<h5 id="networkhttpjsonresponseerror"><a class="header" href="#networkhttpjsonresponseerror">network.http.jsonResponseError</a></h5>
<p>Http response error in json.</p>
<pre><code>Setting name...: network.http.jsonResponseError
Default value..: true
Set at run-time: true
</code></pre>
<h5 id="networkhttpjsonp"><a class="header" href="#networkhttpjsonp">network.http.jsonp</a></h5>
<p>Enable the usage of JSONP, if requested by the client. The parameter name to use is 'callback'.</p>
<pre><code>Setting name...: network.http.jsonp
Default value..: false
Set at run-time: true
</code></pre>
<h5 id="networkhttpsessionexpiretimeout"><a class="header" href="#networkhttpsessionexpiretimeout">network.http.sessionExpireTimeout</a></h5>
<p>Timeout, after which an http session is considered to have expired (in seconds).</p>
<pre><code>Setting name...: network.http.sessionExpireTimeout
Default value..: 300
Set at run-time: false
</code></pre>
<h5 id="networkhttpusetoken"><a class="header" href="#networkhttpusetoken">network.http.useToken</a></h5>
<p>Enable Token based sessions for http.</p>
<pre><code>Setting name...: network.http.useToken
Default value..: false
Set at run-time: false
</code></pre>
<h5 id="networktokensecretkey"><a class="header" href="#networktokensecretkey">network.token.secretKey</a></h5>
<p>Network token secret key.</p>
<pre><code>Setting name...: network.token.secretKey
Default value..: 
Set at run-time: false
</code></pre>
<h5 id="networktokenencryptionalgorithm"><a class="header" href="#networktokenencryptionalgorithm">network.token.encryptionAlgorithm</a></h5>
<p>Network token algorithm.</p>
<pre><code>Setting name...: network.token.encryptionAlgorithm
Default value..: HmacSHA256
Set at run-time: false
</code></pre>
<h5 id="networktokenexpiretimeout"><a class="header" href="#networktokenexpiretimeout">network.token.expireTimeout</a></h5>
<p>Timeout, after which a binary session is considered to have expired (in minutes).</p>
<pre><code>Setting name...: network.token.expireTimeout
Default value..: 60
Set at run-time: false
</code></pre>
<hr />
<h3 id="profiler"><a class="header" href="#profiler">Profiler</a></h3>
<h5 id="profilerenabled"><a class="header" href="#profilerenabled">profiler.enabled</a></h5>
<p>Enables the recording of statistics and counters.</p>
<pre><code>Setting name...: profiler.enabled
Default value..: false
Set at run-time: true
</code></pre>
<h5 id="profilerconfig"><a class="header" href="#profilerconfig">profiler.config</a></h5>
<p>Configures the profiler as <seconds-for-snapshot>,<archive-snapshot-size>,<summary-size>.</p>
<pre><code>Setting name...: profiler.config
Default value..: null
Set at run-time: true
</code></pre>
<h5 id="profilerautodumpinterval"><a class="header" href="#profilerautodumpinterval">profiler.autoDump.interval</a></h5>
<p>Dumps the profiler values at regular intervals (in seconds).</p>
<pre><code>Setting name...: profiler.autoDump.interval
Default value..: 0
Set at run-time: true
</code></pre>
<h5 id="profilermaxvalues"><a class="header" href="#profilermaxvalues">profiler.maxValues</a></h5>
<p>Maximum values to store. Values are managed in a LRU.</p>
<pre><code>Setting name...: profiler.maxValues
Default value..: 200
Set at run-time: false
</code></pre>
<hr />
<h3 id="sequence"><a class="header" href="#sequence">Sequence</a></h3>
<h5 id="sequencemaxretry"><a class="header" href="#sequencemaxretry">sequence.maxRetry</a></h5>
<p>Maximum number of retries between attempt to change a sequence in concurrent mode.</p>
<pre><code>Setting name...: sequence.maxRetry
Default value..: 100
Set at run-time: false
</code></pre>
<h5 id="sequenceretrydelay"><a class="header" href="#sequenceretrydelay">sequence.retryDelay</a></h5>
<p>Maximum number of ms to wait between concurrent modification exceptions. The value is computed as random between 1 and this number.</p>
<pre><code>Setting name...: sequence.retryDelay
Default value..: 200
Set at run-time: false
</code></pre>
<hr />
<h3 id="storageprofiler"><a class="header" href="#storageprofiler">StorageProfiler</a></h3>
<h5 id="storageprofilerintervalbetweensnapshots"><a class="header" href="#storageprofilerintervalbetweensnapshots">storageProfiler.intervalBetweenSnapshots</a></h5>
<p>Interval between snapshots of profiler state in milliseconds.</p>
<pre><code>Setting name...: storageProfiler.intervalBetweenSnapshots
Default value..: 100
Set at run-time: false
</code></pre>
<h5 id="storageprofilercleanupinterval"><a class="header" href="#storageprofilercleanupinterval">storageProfiler.cleanUpInterval</a></h5>
<p>Interval between time series in milliseconds.</p>
<pre><code>Setting name...: storageProfiler.cleanUpInterval
Default value..: 5000
Set at run-time: false
</code></pre>
<hr />
<h3 id="log"><a class="header" href="#log">Log</a></h3>
<h5 id="logconsolelevel"><a class="header" href="#logconsolelevel">log.console.level</a></h5>
<p>Console logging level.</p>
<pre><code>Setting name...: log.console.level
Default value..: info
Set at run-time: true
</code></pre>
<h5 id="logfilelevel"><a class="header" href="#logfilelevel">log.file.level</a></h5>
<p>File logging level.</p>
<pre><code>Setting name...: log.file.level
Default value..: info
Set at run-time: true
</code></pre>
<h5 id="logconsoleansi"><a class="header" href="#logconsoleansi">log.console.ansi</a></h5>
<p>ANSI Console support. 'auto' means automatic check if it is supported, 'true' to force using ANSI, 'false' to avoid using ANSI.</p>
<pre><code>Setting name...: log.console.ansi
Default value..: auto
Set at run-time: false
</code></pre>
<hr />
<h3 id="class-2"><a class="header" href="#class-2">Class</a></h3>
<h5 id="classminimumclusters"><a class="header" href="#classminimumclusters">class.minimumClusters</a></h5>
<p>Minimum clusters to create when a new class is created. 0 means Automatic.</p>
<pre><code>Setting name...: class.minimumClusters
Default value..: 0
Set at run-time: false
</code></pre>
<hr />
<h3 id="cache"><a class="header" href="#cache">Cache</a></h3>
<h5 id="cachelocalimpl"><a class="header" href="#cachelocalimpl">cache.local.impl</a></h5>
<p>Local Record cache implementation.</p>
<pre><code>Setting name...: cache.local.impl
Default value..: com.orientechnologies.orient.core.cache.ORecordCacheWeakRefs
Set at run-time: false
</code></pre>
<h5 id="cachelocalenabled"><a class="header" href="#cachelocalenabled">cache.local.enabled</a></h5>
<p>Deprecated, Level1 cache cannot be disabled anymore.</p>
<pre><code>Setting name...: cache.local.enabled
Default value..: true
Set at run-time: false
</code></pre>
<hr />
<h3 id="command"><a class="header" href="#command">Command</a></h3>
<h5 id="commandtimeout"><a class="header" href="#commandtimeout">command.timeout</a></h5>
<p>Default timeout for commands (in ms).</p>
<pre><code>Setting name...: command.timeout
Default value..: 0
Set at run-time: true
</code></pre>
<h5 id="commandcacheenabled"><a class="header" href="#commandcacheenabled">command.cache.enabled</a></h5>
<p>Enable command cache.</p>
<pre><code>Setting name...: command.cache.enabled
Default value..: false
Set at run-time: false
</code></pre>
<h5 id="commandcacheevictstrategy"><a class="header" href="#commandcacheevictstrategy">command.cache.evictStrategy</a></h5>
<p>Command cache strategy between: [INVALIDATE_ALL,PER_CLUSTER].</p>
<pre><code>Setting name...: command.cache.evictStrategy
Default value..: PER_CLUSTER
Set at run-time: false
</code></pre>
<h5 id="commandcacheminexecutiontime"><a class="header" href="#commandcacheminexecutiontime">command.cache.minExecutionTime</a></h5>
<p>Minimum execution time to consider caching the result set.</p>
<pre><code>Setting name...: command.cache.minExecutionTime
Default value..: 10
Set at run-time: false
</code></pre>
<h5 id="commandcachemaxresultsetsize"><a class="header" href="#commandcachemaxresultsetsize">command.cache.maxResultsetSize</a></h5>
<p>Maximum resultset time to consider caching result set.</p>
<pre><code>Setting name...: command.cache.maxResultsetSize
Default value..: 500
Set at run-time: false
</code></pre>
<hr />
<h3 id="query"><a class="header" href="#query">Query</a></h3>
<h5 id="queryparallelauto"><a class="header" href="#queryparallelauto">query.parallelAuto</a></h5>
<p>Auto enable parallel query, if requirements are met.</p>
<pre><code>Setting name...: query.parallelAuto
Default value..: false
Set at run-time: false
</code></pre>
<h5 id="queryparallelminimumrecords"><a class="header" href="#queryparallelminimumrecords">query.parallelMinimumRecords</a></h5>
<p>Minimum number of records to activate parallel query automatically.</p>
<pre><code>Setting name...: query.parallelMinimumRecords
Default value..: 300000
Set at run-time: false
</code></pre>
<h5 id="queryparallelresultqueuesize"><a class="header" href="#queryparallelresultqueuesize">query.parallelResultQueueSize</a></h5>
<p>Size of the queue that holds results on parallel execution. The queue is blocking, so in case the queue is full, the query threads will be in a wait state.</p>
<pre><code>Setting name...: query.parallelResultQueueSize
Default value..: 20000
Set at run-time: false
</code></pre>
<h5 id="queryscanprefetchpages"><a class="header" href="#queryscanprefetchpages">query.scanPrefetchPages</a></h5>
<p>Pages to prefetch during scan. Setting this value higher makes scans faster, because it reduces the number of I/O operations, though it consumes more memory. (Use 0 to disable).</p>
<pre><code>Setting name...: query.scanPrefetchPages
Default value..: 20
Set at run-time: false
</code></pre>
<h5 id="queryscanbatchsize"><a class="header" href="#queryscanbatchsize">query.scanBatchSize</a></h5>
<p>Scan clusters in blocks of records. This setting reduces the lock time on the cluster during scans. A high value mean a faster execution, but also a lower concurrency level. Set to 0 to disable batch scanning. Disabling batch scanning is suggested for read-only databases only.</p>
<pre><code>Setting name...: query.scanBatchSize
Default value..: 1000
Set at run-time: false
</code></pre>
<h5 id="queryscanthresholdtip"><a class="header" href="#queryscanthresholdtip">query.scanThresholdTip</a></h5>
<p>If the total number of records scanned in a query exceeds this setting, then a warning is given. (Use 0 to disable).</p>
<pre><code>Setting name...: query.scanThresholdTip
Default value..: 50000
Set at run-time: false
</code></pre>
<h5 id="querylimitthresholdtip"><a class="header" href="#querylimitthresholdtip">query.limitThresholdTip</a></h5>
<p>If the total number of returned records exceeds this value, then a warning is given. (Use 0 to disable).</p>
<pre><code>Setting name...: query.limitThresholdTip
Default value..: 10000
Set at run-time: false
</code></pre>
<h5 id="querylivesupport"><a class="header" href="#querylivesupport">query.live.support</a></h5>
<p>Enable/Disable the support of live query. (Use false to disable).</p>
<pre><code>Setting name...: query.live.support
Default value..: true
Set at run-time: false
</code></pre>
<hr />
<h3 id="statement"><a class="header" href="#statement">Statement</a></h3>
<h5 id="statementcachesize"><a class="header" href="#statementcachesize">statement.cacheSize</a></h5>
<p>Number of parsed SQL statements kept in cache.</p>
<pre><code>Setting name...: statement.cacheSize
Default value..: 100
Set at run-time: false
</code></pre>
<hr />
<h3 id="sql-1"><a class="header" href="#sql-1">Sql</a></h3>
<h5 id="sqlgraphconsistencymode"><a class="header" href="#sqlgraphconsistencymode">sql.graphConsistencyMode</a></h5>
<p>Consistency mode for graphs. It can be 'tx' (default), 'notx_sync_repair' and 'notx_async_repair'. 'tx' uses transactions to maintain consistency. Instead both 'notx_sync_repair' and 'notx_async_repair' do not use transactions, and the consistency, in case of JVM crash, is guaranteed by a database repair operation that run at startup. With 'notx_sync_repair' the repair is synchronous, so the database comes online after the repair is ended, while with 'notx_async_repair' the repair is a background process.</p>
<pre><code>Setting name...: sql.graphConsistencyMode
Default value..: tx
Set at run-time: false
</code></pre>
<hr />
<h3 id="client"><a class="header" href="#client">Client</a></h3>
<h5 id="clientchannelmaxpool"><a class="header" href="#clientchannelmaxpool">client.channel.maxPool</a></h5>
<p>Maximum size of pool of network channels between client and server. A channel is a TCP/IP connection.</p>
<pre><code>Setting name...: client.channel.maxPool
Default value..: 100
Set at run-time: false
</code></pre>
<h5 id="clientconnectionpoolwaittimeout"><a class="header" href="#clientconnectionpoolwaittimeout">client.connectionPool.waitTimeout</a></h5>
<p>Maximum time, where the client should wait for a connection from the pool, when all connections busy.</p>
<pre><code>Setting name...: client.connectionPool.waitTimeout
Default value..: 5000
Set at run-time: true
</code></pre>
<h5 id="clientchanneldbreleasewaittimeout"><a class="header" href="#clientchanneldbreleasewaittimeout">client.channel.dbReleaseWaitTimeout</a></h5>
<p>Delay (in ms), after which a data modification command will be resent, if the DB was frozen.</p>
<pre><code>Setting name...: client.channel.dbReleaseWaitTimeout
Default value..: 10000
Set at run-time: true
</code></pre>
<h5 id="clientsslenabled"><a class="header" href="#clientsslenabled">client.ssl.enabled</a></h5>
<p>Use SSL for client connections.</p>
<pre><code>Setting name...: client.ssl.enabled
Default value..: false
Set at run-time: false
</code></pre>
<h5 id="clientsslkeystore"><a class="header" href="#clientsslkeystore">client.ssl.keyStore</a></h5>
<p>Use SSL for client connections.</p>
<pre><code>Setting name...: client.ssl.keyStore
Default value..: null
Set at run-time: false
</code></pre>
<h5 id="clientsslkeystorepass"><a class="header" href="#clientsslkeystorepass">client.ssl.keyStorePass</a></h5>
<p>Use SSL for client connections.</p>
<pre><code>Setting name...: client.ssl.keyStorePass
Default value..: null
Set at run-time: false
</code></pre>
<h5 id="clientssltruststore"><a class="header" href="#clientssltruststore">client.ssl.trustStore</a></h5>
<p>Use SSL for client connections.</p>
<pre><code>Setting name...: client.ssl.trustStore
Default value..: null
Set at run-time: false
</code></pre>
<h5 id="clientssltruststorepass"><a class="header" href="#clientssltruststorepass">client.ssl.trustStorePass</a></h5>
<p>Use SSL for client connections.</p>
<pre><code>Setting name...: client.ssl.trustStorePass
Default value..: null
Set at run-time: false
</code></pre>
<h5 id="clientkrb5config"><a class="header" href="#clientkrb5config">client.krb5.config</a></h5>
<p>Location of the Kerberos configuration file.</p>
<pre><code>Setting name...: client.krb5.config
Default value..: null
Set at run-time: false
</code></pre>
<h5 id="clientkrb5ccname"><a class="header" href="#clientkrb5ccname">client.krb5.ccname</a></h5>
<p>Location of the Kerberos client ticketcache.</p>
<pre><code>Setting name...: client.krb5.ccname
Default value..: null
Set at run-time: false
</code></pre>
<h5 id="clientkrb5ktname"><a class="header" href="#clientkrb5ktname">client.krb5.ktname</a></h5>
<p>Location of the Kerberos client keytab.</p>
<pre><code>Setting name...: client.krb5.ktname
Default value..: null
Set at run-time: false
</code></pre>
<h5 id="clientcredentialinterceptor"><a class="header" href="#clientcredentialinterceptor">client.credentialinterceptor</a></h5>
<p>The name of the CredentialInterceptor class.</p>
<pre><code>Setting name...: client.credentialinterceptor
Default value..: null
Set at run-time: false
</code></pre>
<h5 id="clientsessiontokenbased"><a class="header" href="#clientsessiontokenbased">client.session.tokenBased</a></h5>
<p>Request a token based session to the server.</p>
<pre><code>Setting name...: client.session.tokenBased
Default value..: true
Set at run-time: false
</code></pre>
<h5 id="clientchannelminpool"><a class="header" href="#clientchannelminpool">client.channel.minPool</a></h5>
<p>Minimum pool size.</p>
<pre><code>Setting name...: client.channel.minPool
Default value..: 1
Set at run-time: false
</code></pre>
<hr />
<h3 id="server"><a class="header" href="#server">Server</a></h3>
<h5 id="serveropenalldatabasesatstartup"><a class="header" href="#serveropenalldatabasesatstartup">server.openAllDatabasesAtStartup</a></h5>
<p>If true, the server opens all the available databases at startup. Available since 2.2.</p>
<pre><code>Setting name...: server.openAllDatabasesAtStartup
Default value..: false
Set at run-time: false
</code></pre>
<h5 id="serverchannelcleandelay"><a class="header" href="#serverchannelcleandelay">server.channel.cleanDelay</a></h5>
<p>Time in ms of delay to check pending closed connections.</p>
<pre><code>Setting name...: server.channel.cleanDelay
Default value..: 5000
Set at run-time: false
</code></pre>
<h5 id="servercachestaticfile"><a class="header" href="#servercachestaticfile">server.cache.staticFile</a></h5>
<p>Cache static resources upon loading.</p>
<pre><code>Setting name...: server.cache.staticFile
Default value..: false
Set at run-time: false
</code></pre>
<h5 id="serverlogdumpclientexceptionlevel"><a class="header" href="#serverlogdumpclientexceptionlevel">server.log.dumpClientExceptionLevel</a></h5>
<p>Logs client exceptions. Use any level supported by Java java.util.logging.Level class: OFF, FINE, CONFIG, INFO, WARNING, SEVERE.</p>
<pre><code>Setting name...: server.log.dumpClientExceptionLevel
Default value..: FINE
Set at run-time: false
</code></pre>
<h5 id="serverlogdumpclientexceptionfullstacktrace"><a class="header" href="#serverlogdumpclientexceptionfullstacktrace">server.log.dumpClientExceptionFullStackTrace</a></h5>
<p>Dumps the full stack trace of the exception sent to the client.</p>
<pre><code>Setting name...: server.log.dumpClientExceptionFullStackTrace
Default value..: false
Set at run-time: true
</code></pre>
<h5 id="serversecurityfile"><a class="header" href="#serversecurityfile">server.security.file</a></h5>
<p>Location of the OrientDB security.json configuration file.</p>
<pre><code>Setting name...: server.security.file
Default value..: null
Set at run-time: false
</code></pre>
<hr />
<h3 id="distributed-1"><a class="header" href="#distributed-1">Distributed</a></h3>
<h5 id="distributedcrudtasktimeout"><a class="header" href="#distributedcrudtasktimeout">distributed.crudTaskTimeout</a></h5>
<p>Maximum timeout (in ms) to wait for CRUD remote tasks.</p>
<pre><code>Setting name...: distributed.crudTaskTimeout
Default value..: 3000
Set at run-time: true
</code></pre>
<h5 id="distributedcommandtasktimeout"><a class="header" href="#distributedcommandtasktimeout">distributed.commandTaskTimeout</a></h5>
<p>Maximum timeout (in ms) to wait for command distributed tasks.</p>
<pre><code>Setting name...: distributed.commandTaskTimeout
Default value..: 120000
Set at run-time: true
</code></pre>
<h5 id="distributedcommandquicktasktimeout"><a class="header" href="#distributedcommandquicktasktimeout">distributed.commandQuickTaskTimeout</a></h5>
<p>Maximum timeout (in ms) to wait for quick command distributed tasks.</p>
<pre><code>Setting name...: distributed.commandQuickTaskTimeout
Default value..: 5000
Set at run-time: true
</code></pre>
<h5 id="distributedcommandlongtasktimeout"><a class="header" href="#distributedcommandlongtasktimeout">distributed.commandLongTaskTimeout</a></h5>
<p>Maximum timeout (in ms) to wait for Long-running distributed tasks.</p>
<pre><code>Setting name...: distributed.commandLongTaskTimeout
Default value..: 86400000
Set at run-time: true
</code></pre>
<h5 id="distributeddeploydbtasktimeout"><a class="header" href="#distributeddeploydbtasktimeout">distributed.deployDbTaskTimeout</a></h5>
<p>Maximum timeout (in ms) to wait for database deployment.</p>
<pre><code>Setting name...: distributed.deployDbTaskTimeout
Default value..: 1200000
Set at run-time: true
</code></pre>
<h5 id="distributeddeploychunktasktimeout"><a class="header" href="#distributeddeploychunktasktimeout">distributed.deployChunkTaskTimeout</a></h5>
<p>Maximum timeout (in ms) to wait for database chunk deployment.</p>
<pre><code>Setting name...: distributed.deployChunkTaskTimeout
Default value..: 15000
Set at run-time: true
</code></pre>
<h5 id="distributeddeploydbtaskcompression"><a class="header" href="#distributeddeploydbtaskcompression">distributed.deployDbTaskCompression</a></h5>
<p>Compression level (between 0 and 9) to use in backup for database deployment.</p>
<pre><code>Setting name...: distributed.deployDbTaskCompression
Default value..: 7
Set at run-time: true
</code></pre>
<h5 id="distributedasynchqueuesize"><a class="header" href="#distributedasynchqueuesize">distributed.asynchQueueSize</a></h5>
<p>Queue size to handle distributed asynchronous operations. The bigger is the queue, the more operation are buffered, but also more memory it's consumed. 0 = dynamic allocation, which means up to 2^31-1 entries.</p>
<pre><code>Setting name...: distributed.asynchQueueSize
Default value..: 0
Set at run-time: false
</code></pre>
<h5 id="distributedasynchresponsestimeout"><a class="header" href="#distributedasynchresponsestimeout">distributed.asynchResponsesTimeout</a></h5>
<p>Maximum timeout (in ms) to collect all the asynchronous responses from replication. After this time the operation is rolled back (through an UNDO).</p>
<pre><code>Setting name...: distributed.asynchResponsesTimeout
Default value..: 15000
Set at run-time: false
</code></pre>
<h5 id="distributedpurgeresponsestimerdelay"><a class="header" href="#distributedpurgeresponsestimerdelay">distributed.purgeResponsesTimerDelay</a></h5>
<p>Maximum timeout (in ms) to collect all the asynchronous responses from replication. This is the delay the purge thread uses to check asynchronous requests in timeout.</p>
<pre><code>Setting name...: distributed.purgeResponsesTimerDelay
Default value..: 15000
Set at run-time: false
</code></pre>
<h5 id="distributedconflictresolverrepairerchain"><a class="header" href="#distributedconflictresolverrepairerchain">distributed.conflictResolverRepairerChain</a></h5>
<p>Chain of conflict resolver implementation to use.</p>
<pre><code>Setting name...: distributed.conflictResolverRepairerChain
Default value..: majority,content,version
Set at run-time: false
</code></pre>
<h5 id="distributedconflictresolverrepairercheckevery"><a class="header" href="#distributedconflictresolverrepairercheckevery">distributed.conflictResolverRepairerCheckEvery</a></h5>
<p>Time (in ms) when the conflict resolver auto-repairer checks for records/cluster to repair.</p>
<pre><code>Setting name...: distributed.conflictResolverRepairerCheckEvery
Default value..: 5000
Set at run-time: true
</code></pre>
<h5 id="distributedconflictresolverrepairerbatch"><a class="header" href="#distributedconflictresolverrepairerbatch">distributed.conflictResolverRepairerBatch</a></h5>
<p>Number of record to repair in batch.</p>
<pre><code>Setting name...: distributed.conflictResolverRepairerBatch
Default value..: 100
Set at run-time: true
</code></pre>
<h5 id="distributedtxalivetimeout"><a class="header" href="#distributedtxalivetimeout">distributed.txAliveTimeout</a></h5>
<p>Maximum timeout (in ms) a distributed transaction can be alive. This timeout is to rollback pending transactions after a while.</p>
<pre><code>Setting name...: distributed.txAliveTimeout
Default value..: 30000
Set at run-time: true
</code></pre>
<h5 id="distributedrequestchannels"><a class="header" href="#distributedrequestchannels">distributed.requestChannels</a></h5>
<p>Number of network channels used to send requests.</p>
<pre><code>Setting name...: distributed.requestChannels
Default value..: 1
Set at run-time: false
</code></pre>
<h5 id="distributedresponsechannels"><a class="header" href="#distributedresponsechannels">distributed.responseChannels</a></h5>
<p>Number of network channels used to send responses.</p>
<pre><code>Setting name...: distributed.responseChannels
Default value..: 1
Set at run-time: false
</code></pre>
<h5 id="distributedheartbeattimeout"><a class="header" href="#distributedheartbeattimeout">distributed.heartbeatTimeout</a></h5>
<p>Maximum time in ms to wait for the heartbeat. If the server does not respond in time, it is put offline.</p>
<pre><code>Setting name...: distributed.heartbeatTimeout
Default value..: 10000
Set at run-time: false
</code></pre>
<h5 id="distributedcheckhealthcanofflineserver"><a class="header" href="#distributedcheckhealthcanofflineserver">distributed.checkHealthCanOfflineServer</a></h5>
<p>In case a server does not respond to the heartbeat message, it is set offline.</p>
<pre><code>Setting name...: distributed.checkHealthCanOfflineServer
Default value..: false
Set at run-time: false
</code></pre>
<h5 id="distributedcheckhealthevery"><a class="header" href="#distributedcheckhealthevery">distributed.checkHealthEvery</a></h5>
<p>Time in ms to check the cluster health. Set to 0 to disable it.</p>
<pre><code>Setting name...: distributed.checkHealthEvery
Default value..: 10000
Set at run-time: false
</code></pre>
<h5 id="distributedautoremoveofflineservers"><a class="header" href="#distributedautoremoveofflineservers">distributed.autoRemoveOfflineServers</a></h5>
<p>This is the amount of time (in ms) the server has to be OFFLINE, before it is automatically removed from the distributed configuration. -1 = never, 0 = immediately, &gt;0 the actual time to wait.</p>
<pre><code>Setting name...: distributed.autoRemoveOfflineServers
Default value..: -1
Set at run-time: true
</code></pre>
<h5 id="distributedpublishnodestatusevery"><a class="header" href="#distributedpublishnodestatusevery">distributed.publishNodeStatusEvery</a></h5>
<p>Time in ms to publish the node status on distributed map. Set to 0 to disable such refresh of node configuration.</p>
<pre><code>Setting name...: distributed.publishNodeStatusEvery
Default value..: 5000
Set at run-time: true
</code></pre>
<h5 id="distributedlocalqueuesize"><a class="header" href="#distributedlocalqueuesize">distributed.localQueueSize</a></h5>
<p>Size of the intra-thread queue for distributed messages.</p>
<pre><code>Setting name...: distributed.localQueueSize
Default value..: 10000
Set at run-time: false
</code></pre>
<h5 id="distributeddbworkerthreads"><a class="header" href="#distributeddbworkerthreads">distributed.dbWorkerThreads</a></h5>
<p>Number of parallel worker threads per database that process distributed messages.</p>
<pre><code>Setting name...: distributed.dbWorkerThreads
Default value..: 8
Set at run-time: false
</code></pre>
<h5 id="distributedqueuemaxsize"><a class="header" href="#distributedqueuemaxsize">distributed.queueMaxSize</a></h5>
<p>Maximum queue size to mark a node as stalled. If the number of messages in queue are more than this values, the node is restarted with a remote command (0 = no maximum, which means up to 2^31-1 entries).</p>
<pre><code>Setting name...: distributed.queueMaxSize
Default value..: 10000
Set at run-time: false
</code></pre>
<h5 id="distributedbackupdirectory"><a class="header" href="#distributedbackupdirectory">distributed.backupDirectory</a></h5>
<p>Directory where the copy of an existent database is saved, before it is downloaded from the cluster. Leave it empty to avoid the backup..</p>
<pre><code>Setting name...: distributed.backupDirectory
Default value..: ../backup/databases
Set at run-time: false
</code></pre>
<h5 id="distributedconcurrenttxmaxautoretry"><a class="header" href="#distributedconcurrenttxmaxautoretry">distributed.concurrentTxMaxAutoRetry</a></h5>
<p>Maximum attempts the transaction coordinator should execute a transaction automatically, if records are locked. (Minimum is 1 = no attempts).</p>
<pre><code>Setting name...: distributed.concurrentTxMaxAutoRetry
Default value..: 10
Set at run-time: true
</code></pre>
<h5 id="distributedatomiclocktimeout"><a class="header" href="#distributedatomiclocktimeout">distributed.atomicLockTimeout</a></h5>
<p>Timeout (in ms) to acquire a distributed lock on a record. (0=infinite).</p>
<pre><code>Setting name...: distributed.atomicLockTimeout
Default value..: 300
Set at run-time: true
</code></pre>
<h5 id="distributedconcurrenttxautoretrydelay"><a class="header" href="#distributedconcurrenttxautoretrydelay">distributed.concurrentTxAutoRetryDelay</a></h5>
<p>Delay (in ms) between attempts on executing a distributed transaction, which had failed because of locked records. (0=no delay).</p>
<pre><code>Setting name...: distributed.concurrentTxAutoRetryDelay
Default value..: 100
Set at run-time: true
</code></pre>
<h5 id="distributedqueuetimeout"><a class="header" href="#distributedqueuetimeout">distributed.queueTimeout</a></h5>
<p>Maximum timeout (in ms) to wait for the response in replication.</p>
<pre><code>Setting name...: distributed.queueTimeout
Default value..: 500000
Set at run-time: true
</code></pre>
<hr />
<h3 id="jna"><a class="header" href="#jna">Jna</a></h3>
<h5 id="jnadisablesystemlibrary"><a class="header" href="#jnadisablesystemlibrary">jna.disable.system.library</a></h5>
<p>This property disables using JNA, should it be installed on your system. (Default true) To use JNA bundled with database.</p>
<pre><code>Setting name...: jna.disable.system.library
Default value..: true
Set at run-time: false
</code></pre>
<hr />
<h3 id="oauth2"><a class="header" href="#oauth2">Oauth2</a></h3>
<h5 id="oauth2secretkey"><a class="header" href="#oauth2secretkey">oauth2.secretkey</a></h5>
<p>Http OAuth2 secret key.</p>
<pre><code>Setting name...: oauth2.secretkey
Default value..: 
Set at run-time: false
</code></pre>
<hr />
<h3 id="lazyset"><a class="header" href="#lazyset">Lazyset</a></h3>
<h5 id="lazysetworkonstream"><a class="header" href="#lazysetworkonstream">lazyset.workOnStream</a></h5>
<p>Deprecated, now BINARY serialization is used in place of CSV.</p>
<pre><code>Setting name...: lazyset.workOnStream
Default value..: true
Set at run-time: false
</code></pre>
<hr />
<h3 id="mvrbtree"><a class="header" href="#mvrbtree">Mvrbtree</a></h3>
<h5 id="mvrbtreetimeout"><a class="header" href="#mvrbtreetimeout">mvrbtree.timeout</a></h5>
<p>Deprecated, MVRBTREE IS NOT USED ANYMORE IN FAVOR OF SBTREE AND HASHINDEX.</p>
<pre><code>Setting name...: mvrbtree.timeout
Default value..: 0
Set at run-time: false
</code></pre>
<h5 id="mvrbtreenodepagesize"><a class="header" href="#mvrbtreenodepagesize">mvrbtree.nodePageSize</a></h5>
<p>Deprecated, MVRBTREE IS NOT USED ANYMORE IN FAVOR OF SBTREE AND HASHINDEX.</p>
<pre><code>Setting name...: mvrbtree.nodePageSize
Default value..: 256
Set at run-time: false
</code></pre>
<h5 id="mvrbtreeloadfactor"><a class="header" href="#mvrbtreeloadfactor">mvrbtree.loadFactor</a></h5>
<p>Deprecated, MVRBTREE IS NOT USED ANYMORE IN FAVOR OF SBTREE AND HASHINDEX.</p>
<pre><code>Setting name...: mvrbtree.loadFactor
Default value..: 0.7
Set at run-time: false
</code></pre>
<h5 id="mvrbtreeoptimizethreshold"><a class="header" href="#mvrbtreeoptimizethreshold">mvrbtree.optimizeThreshold</a></h5>
<p>Deprecated, MVRBTREE IS NOT USED ANYMORE IN FAVOR OF SBTREE AND HASHINDEX.</p>
<pre><code>Setting name...: mvrbtree.optimizeThreshold
Default value..: 100000
Set at run-time: false
</code></pre>
<h5 id="mvrbtreeentrypoints"><a class="header" href="#mvrbtreeentrypoints">mvrbtree.entryPoints</a></h5>
<p>Deprecated, MVRBTREE IS NOT USED ANYMORE IN FAVOR OF SBTREE AND HASHINDEX.</p>
<pre><code>Setting name...: mvrbtree.entryPoints
Default value..: 64
Set at run-time: false
</code></pre>
<h5 id="mvrbtreeoptimizeentrypointsfactor"><a class="header" href="#mvrbtreeoptimizeentrypointsfactor">mvrbtree.optimizeEntryPointsFactor</a></h5>
<p>Deprecated, MVRBTREE IS NOT USED ANYMORE IN FAVOR OF SBTREE AND HASHINDEX.</p>
<pre><code>Setting name...: mvrbtree.optimizeEntryPointsFactor
Default value..: 1.0
Set at run-time: false
</code></pre>
<h5 id="mvrbtreeentrykeysinmemory"><a class="header" href="#mvrbtreeentrykeysinmemory">mvrbtree.entryKeysInMemory</a></h5>
<p>Deprecated, MVRBTREE IS NOT USED ANYMORE IN FAVOR OF SBTREE AND HASHINDEX.</p>
<pre><code>Setting name...: mvrbtree.entryKeysInMemory
Default value..: false
Set at run-time: false
</code></pre>
<h5 id="mvrbtreeentryvaluesinmemory"><a class="header" href="#mvrbtreeentryvaluesinmemory">mvrbtree.entryValuesInMemory</a></h5>
<p>Deprecated, MVRBTREE IS NOT USED ANYMORE IN FAVOR OF SBTREE AND HASHINDEX.</p>
<pre><code>Setting name...: mvrbtree.entryValuesInMemory
Default value..: false
Set at run-time: false
</code></pre>
<h5 id="mvrbtreeridbinarythreshold"><a class="header" href="#mvrbtreeridbinarythreshold">mvrbtree.ridBinaryThreshold</a></h5>
<p>Deprecated, MVRBTREE IS NOT USED ANYMORE IN FAVOR OF SBTREE AND HASHINDEX.</p>
<pre><code>Setting name...: mvrbtree.ridBinaryThreshold
Default value..: -1
Set at run-time: false
</code></pre>
<h5 id="mvrbtreeridnodepagesize"><a class="header" href="#mvrbtreeridnodepagesize">mvrbtree.ridNodePageSize</a></h5>
<p>Deprecated, MVRBTREE IS NOT USED ANYMORE IN FAVOR OF SBTREE AND HASHINDEX.</p>
<pre><code>Setting name...: mvrbtree.ridNodePageSize
Default value..: 64
Set at run-time: false
</code></pre>
<h5 id="mvrbtreeridnodesavememory"><a class="header" href="#mvrbtreeridnodesavememory">mvrbtree.ridNodeSaveMemory</a></h5>
<p>Deprecated, MVRBTREE IS NOT USED ANYMORE IN FAVOR OF SBTREE AND HASHINDEX.</p>
<pre><code>Setting name...: mvrbtree.ridNodeSaveMemory
Default value..: false
Set at run-time: false
</code></pre>
<p><em>NOTE: On 64-bit systems you have not the limitation of 32-bit systems with memory.</em></p>
<h2 id="logging"><a class="header" href="#logging">Logging</a></h2>
<p>Logging is configured in a separate file, look at <a href="admin/Logging.html">Logging</a> for more information.</p>
<h2 id="storage-configuration"><a class="header" href="#storage-configuration">Storage configuration</a></h2>
<p>OrientDB allows modifications to the storage configuration. Even though this will be supported with high level commands, for now it's pretty "internal" using Java API.</p>
<p>To get the storage configuration for the current database:</p>
<pre><code>OStorageConfiguration cfg = db.getStorage().getConfiguration();
</code></pre>
<p>Look at <code><a href="https://github.com/nuvolabase/orientdb/blob/master/core/src/main/java/com/orientechnologies/orient/core/config/OStorageConfiguration.java">OStorageConfiguration</a></code> to discover all the properties you can change. To change the configuration of a cluster get it by ID;</p>
<pre><code>OStoragePhysicalClusterConfigurationLocal clusterCfg = (OStoragePhysicalClusterConfigurationLocal) cfg.clusters.get(3);
</code></pre>
<p>To change the default settings for new clusters get the file template object. In this example we change the initial file size from the default 500Kb down to 10Kb:</p>
<pre><code>OStorageSegmentConfiguration defaultCfg = (OStorageSegmentConfiguration) cfg.fileTemplate;
defaultCfg.fileStartSize = "10Kb";
</code></pre>
<p>After changes call <code>OStorageConfiguration.update()</code>:</p>
<pre><code>cfg.update();
</code></pre>
<h2 id="distributed-configuration"><a class="header" href="#distributed-configuration">Distributed Configuration</a></h2>
<p>For information about the Distributed Configuration, please refer to the section <a href="admin/../distributed/Distributed-Configuration.html">Distributed Configuration</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="upgrading-1"><a class="header" href="#upgrading-1">Upgrading</a></h1>
<p>OrientDB uses the Semantic Versioning System (http://semver.org), where the version numbers follow this format MAJOR.MINOR.PATCH,
Here are the meanings of the increments:</p>
<ul>
<li>MAJOR version entails incompatible API changes,</li>
<li>MINOR version entails functionality in a backward-compatible manner</li>
<li>PATCH version entails backward-compatible bug fixes.</li>
</ul>
<p>So between PATCH versions, the compatibility is assured (example 2.1.0 -&gt; 2.1.8). Between MINOR and MAJOR versions, you may need to export and re-import the database. To find out if your upgrade must be done over exporting and <a href="release/../admin/Export-to-and-Import-from-JSON.html">importing the database</a>, see below in the column "Database":</p>
<h2 id="compatibility-matrix"><a class="header" href="#compatibility-matrix">Compatibility Matrix</a></h2>
<div class="table-wrapper"><table><thead><tr><th>FROM</th><th>TO</th><th>Guide</th><th>Blueprints</th><th>Database</th><th>Binary Protocol</th><th>HTTP Protocol</th></tr></thead><tbody>
<tr><td>3.1.x</td><td>3.2.x</td><td><a href="http://www.orientdb.org/docs/3.2.x/release/3.2/Upgrading-to-OrientDB-3.2.html">Docs</a></td><td>v 3.3.0</td><td><a href="release/../misc/Backward-compatibility.html">Automatic</a></td><td>38</td><td>10</td></tr>
<tr><td>3.0.x</td><td>3.1.x</td><td>No need to upgrade the application layer (import/export only)</td><td>v 3.3.0</td><td><a href="release/../misc/Backward-compatibility.html">Automatic</a></td><td>38</td><td>10</td></tr>
<tr><td>2.2.x</td><td>3.0.x</td><td><a href="http://www.orientdb.org/docs/3.0.x/release/3.0/Upgrading-to-OrientDB-3.0.html">Docs</a></td><td>v 3.3.0</td><td><a href="release/../misc/Backward-compatibility.html">Automatic</a></td><td>37</td><td>10</td></tr>
<tr><td>2.1.x</td><td>2.2.x</td><td><a href="https://orientdb.org/docs/2.2.x/Upgrade.html">Docs</a></td><td>Final v2.6.0</td><td><a href="release/../misc/Backward-compatibility.html">Automatic</a></td><td>34</td><td>10</td></tr>
<tr><td>2.0.x</td><td>2.1.x</td><td><a href="https://orientdb.org/docs/2.2.x/Release-2.1.0.html">Docs</a></td><td>Final v2.6.0</td><td><a href="release/../misc/Backward-compatibility.html">Automatic</a></td><td>30</td><td>10</td></tr>
</tbody></table>
</div>
<h2 id="instructions"><a class="header" href="#instructions">Instructions</a></h2>
<p>There are two possible scenarios:</p>
<ul>
<li>upgrade to a new hotfix release (eg. from 3.0.10 to 3.0.11)</li>
<li>upgrade to a new major/minor release (eg. from 3.0.31 to 3.1.0)</li>
</ul>
<p>For major/minor release upgrades, please refer to the docs linked in the above table.</p>
<p>For hotfix upgrades, the easiest way to upgrade OrientDB is to plan ahead for future upgrades from the beginning.</p>
<p>The recommended strategy is to store databases separately from the OrientDB installation, often on a separate data volume.</p>
<p>As an example, you might have a data volume, called <code>/data</code>, with a <code>databases</code> directory under that where all of your database directories will be stored.</p>
<pre><code>/data/databases:
MyDB
WebAppDB
</code></pre>
<h3 id="upgrading-with-no-existing-databases"><a class="header" href="#upgrading-with-no-existing-databases">Upgrading with no existing databases</a></h3>
<p>If you're just starting with OrientDB or just creating new databases, from the OrientDB installation directory, you can remove the <code>databases</code> directory and then create a symbolic link to the <code>/data/databases</code> directory previously created.</p>
<p>Make sure OrientDB is not running.</p>
<p>On a Linux system, you could call <code>rm -rf databases</code> to remove the <em>databases</em> directory and recursively remove all sub-directories.</p>
<p><strong>DO NOT issue that command if you have any live databases that have not been moved!</strong></p>
<p>Once the <code>databases</code> directory is removed, create a symbolic link to the <code>/data/databases</code> directory.</p>
<p>On a Linux system, you could call <code>ln -s /data/databases ./databases</code>.</p>
<p>On a Windows system, you can use <code>mklink /d .\databases d:\data\databases</code>, assuming your data volume resides as the <code>d:</code> drive in Windows.  The <code>/d</code> switch creates a directory symbolic link.  You can use <code>/j</code> instead to create a directory junction.</p>
<p>You should now be able to start OrientDB and create new databases that will reside under <code>/data/databases</code>.</p>
<h3 id="upgrading-symbolic-linked-databases"><a class="header" href="#upgrading-symbolic-linked-databases">Upgrading Symbolic-Linked Databases</a></h3>
<p>If you used a similar symbolic link scheme as suggested in the prior section, upgrading OrientDB is very easy.  Simply follow the same instructions to remove the <code>databases</code> directory from the <strong>NEW</strong> OrientDB installation directory and then create a symbolic link to <code>/data/databases</code>.</p>
<h3 id="upgrading-existing-databases"><a class="header" href="#upgrading-existing-databases">Upgrading Existing Databases</a></h3>
<p>If you've been running OrientDB in the standard way, with the <code>databases</code> directory stored directly under the OrientDB installation directory, then you have two options when upgrading to a newer version of OrientDB.</p>
<ol>
<li>You can move your database directories to the <code>databases</code> directory under the new installation.</li>
<li>You can move your database directories to an external location and then set-up a symbolic link from the new installation.</li>
</ol>
<h4 id="moving-databases-to-a-new-installation"><a class="header" href="#moving-databases-to-a-new-installation">Moving Databases to a New Installation</a></h4>
<p>Make sure OrientDB is not running.  From the old OrientDB installation location, move each database directory under <code>databases</code> to the <code>databases</code> directory in the new OrientDB installation.</p>
<h4 id="moving-databases-to-an-external-location"><a class="header" href="#moving-databases-to-an-external-location">Moving Databases to an External Location</a></h4>
<p>Make sure OrientDB is not running.  Using the earlier example of <code>/data/databases</code>, from the old OrientDB installation location, move each database directory under <code>databases</code> to the <code>/data/databases</code> location.</p>
<p>Now, follow the instructions under <a href="release/Upgrade.html#new-databases">New Databases</a> to create a symbolic link from within the new OrientDB installation to the <code>/data/databases</code> directory.</p>
<h3 id="external-storage-advantages"><a class="header" href="#external-storage-advantages">External Storage Advantages</a></h3>
<p>If you store your databases separately from the OrientDB installation, not only will you be able to upgrade more easily in the future, but you may even be able to improve performance by using a data volume that is mounted on a disk that's faster than the volume where the main installation resides.</p>
<p>Also, many cloud-based providers support creating snapshots of data volumes, which can be a useful way of backing up all of your databases.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="backward-compatibility"><a class="header" href="#backward-compatibility">Backward Compatibility</a></h1>
<p>When upgrading OrientDB to a more recent version, you should always follow the migration instructions (see <a href="misc/../release/3.1/Upgrading-to-OrientDB-3.1.html">upgrade guide</a> ).</p>
<p>This said, in OrientDB development process we always try to support binary compatibility between two subsequent minor releases.</p>
<p>For example, lets suppose that we have following releases 1.5, 1.5.1, 1.6.1, 1.6.2, 1.7, 1.7.1 then binary compatibility at least between 1.6.1, 1.6.2, 1.7, 1.7.1 releases will be supported.</p>
<p>If we have releases 1.5, 1.5.1, 1.6.1, 1.6.2, 1.7, 1.7.1, 2.0  then binary compatibility will be supported at least between releases 1.7, 1.7.1, 2.0.</p>
<p>Binary compatibility feature is implemented using following algorithm:</p>
<ol>
<li>When storage is opened, version of binary format which is used when storage is created is read from storage configuration.</li>
<li>Factory of objects are used to present disk based data structures for current binary format is created.</li>
</ol>
<p>Only features and database components which existed at the moment when current binary format was latest one will be used. It means that you cannot use all database features available in latest release if you use storage which was created using old binary format version. It also means that bugs which are fixed in new versions may be (but may be not) reproducible on storage created using old binary format.</p>
<p>To update binary format storage to latest one you should export database in JSON format and import it back.
Using either console commands <a href="misc/../console/Console-Command-Export.html">export database</a> and <a href="misc/../console/Console-Command-Import.html">import database</a> or Java API look at <code>com.orientechnologies.orient.core.db.tool.ODatabaseImport</code>, <code>com.orientechnologies.orient.core.db.tool.ODatabaseExport</code> classes and <code>com.orientechnologies.orient.test.database.auto.DbImportExportTest</code> test.</p>
<ul>
<li>Current binary format version can be read from <code>com.orientechnologies.orient.core.db.record.OCurrentStorageComponentsFactory#binaryFormatVersion</code> property.</li>
<li>Instance of <code>OCurrentStorageComponentsFactory</code> class can be retrieved by call of <code>com.orientechnologies.orient.core.storage.OStorage#getComponentsFactory</code> method.</li>
<li>Latest binary format version can be read from here <code>com.orientechnologies.orient.core.config.OStorageConfiguration#CURRENT_BINARY_FORMAT_VERSION</code>.</li>
</ul>
<p>Please note that binary compatibility is supported since <strong>1.7-rc2</strong> version for plocal storage (as exception you can read database created in 1.5.1 version by 1.7-rc2 version).</p>
<p>Return to <a href="misc/../release/Upgrade.html">Upgrade</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="upgrading-a-distributed-environment"><a class="header" href="#upgrading-a-distributed-environment">Upgrading a Distributed Environment</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="logging-1"><a class="header" href="#logging-1">Logging</a></h1>
<p>OrientDB handles logs using the Java Logging Framework, which is bundled with the JVM.  The specific format it uses derives from the <code>OLogFormatter</code> class, which defaults to:</p>
<pre><code>&lt;date&gt; &lt;level&gt; &lt;message&gt; [&lt;requester&gt;]
</code></pre>
<ul>
<li><strong><code>&lt;date&gt;</code></strong> Shows the date of the log entry, using the date format <code>YYYY-MM-DD HH:MM:SS:SSS</code>.</li>
<li><strong><code>&lt;level&gt;</code></strong> Shows the log level.</li>
<li><strong><code>&lt;message&gt;</code></strong> Shows the log message.</li>
<li><strong><code>&lt;class&gt;</code></strong> Shows the Java class that made the entry, (optional).</li>
</ul>
<p>The supported levels are those contained in the JRE class <a href="http://java.sun.com/j2se/1.5.0/docs/api/java/util/logging/Level.html"><code>java.util.logging.Level</code></a>.  From highest to lowest:</p>
<ul>
<li><code>SEVERE</code></li>
<li><code>WARNING</code></li>
<li><code>INFO</code></li>
<li><code>CONFIG</code></li>
<li><code>FINE</code></li>
<li><code>FINER</code></li>
<li><code>FINEST</code></li>
</ul>
<p>By default, OrientDB installs two loggers:</p>
<ul>
<li><strong><code>console</code></strong>: Logs to the shell or command-prompt that starts the application or the server.  You can modify it by setting the <code>log.console.level</code> variable.</li>
<li><strong><code>file</code></strong>: Logs to the log file.  You can modify it by setting the <code>log.file.level</code> variable.</li>
</ul>
<h2 id="configuration-file"><a class="header" href="#configuration-file">Configuration File</a></h2>
<p>You can configure logging strategies and policies by creating a configuration file that follows the
Java <a href="http://www.javapractices.com/topic/TopicAction.do?Id=143">Logging Messages</a> configuration syntax.  For example, consider the following from the <code>orientdb-server-log.properties</code> file:</p>
<pre><code class="language-java"># Specify the handlers to create in the root logger
# (all loggers are children of the root logger)
# The following creates two handlers
handlers = java.util.logging.ConsoleHandler, java.util.logging.FileHandler

# Set the default logging level for the root logger
.level = ALL

# Set the default logging level for new ConsoleHandler instances
java.util.logging.ConsoleHandler.level = INFO
# Set the default formatter for new ConsoleHandler instances
java.util.logging.ConsoleHandler.formatter = com.orientechnologies.common.log.OLogFormatter

# Set the default logging level for new FileHandler instances
java.util.logging.FileHandler.level = INFO
# Naming style for the output file
java.util.logging.FileHandler.pattern=../log/orient-server.log
# Set the default formatter for new FileHandler instances
java.util.logging.FileHandler.formatter = com.orientechnologies.common.log.OLogFormatter
# Limiting size of output file in bytes:
java.util.logging.FileHandler.limit=10000000
# Number of output files to cycle through, by appending an
# integer to the base file name:
java.util.logging.FileHandler.count=10
</code></pre>
<p>When the log properties file is ready, you need to tell the JVM to use t, by setting <code>java.util.logging.config.file</code> system property.</p>
<pre>
$ <code class="lang-sh userinput">java -Djava.util.logging.config.file=mylog.properties</code>
</pre>
<h2 id="setting-the-log-level"><a class="header" href="#setting-the-log-level">Setting the Log Level</a></h2>
<p>To change the log level without modifying the logging configuration, set the <code>log.console.level</code> and <code>log.file.level</code> system variables.  These system variables are accessible both at startup and at runtime.</p>
<h3 id="configuring-log-level-at-startup"><a class="header" href="#configuring-log-level-at-startup">Configuring Log Level at Startup</a></h3>
<p>You can configure log level at startup through both the <code>orientdb-server-config.xml</code> configuration file and by modifying the JVM before you start the server:</p>
<h4 id="using-the-configuration-file"><a class="header" href="#using-the-configuration-file">Using the Configuration File</a></h4>
<p>To configure log level from the configuration file, update the following elements in the <code>&lt;properties&gt;</code> section:</p>
<pre><code class="language-xml">&lt;properties&gt;
   &lt;entry value="info" name="log.console.level" /&gt;
   &lt;entry value="fine" name="log.file.level" /&gt;
   ...
&lt;/properties&gt;
</code></pre>
<h4 id="using-the-jvm"><a class="header" href="#using-the-jvm">Using the JVM</a></h4>
<p>To configure log level from the JVM before starting the server, run the <code>java</code> command to configure the <code>log.console.level</code> and <code>log.file.level</code> variables:</p>
<pre>
$ <code class="lang-sh userinput">java -Dlog.console.level=INFO -Dlog.file.level=FINE</code>
</pre>
<h3 id="configuring-log-level-at-runtime"><a class="header" href="#configuring-log-level-at-runtime">Configuring Log Level at Runtime</a></h3>
<p>You can configure log level at runtime through both the Java API and by executing an HTTP <code>POST</code> against the remote server.</p>
<h4 id="using-java-code"><a class="header" href="#using-java-code">Using Java Code</a></h4>
<p>Through the Java API, you can set the system variables for logging at startup through the <code>System.setProperty()</code> method.  For instance,</p>
<pre><code class="language-java">public void main(String[] args){
  System.setProperty("log.console.level", "FINE");
  ...
}
</code></pre>
<h4 id="using-http-post"><a class="header" href="#using-http-post">Using HTTP POST</a></h4>
<p>Through the HTTP requests, you can update the logging system variables by executing a <code>POST</code> against the URL: <code>/server/log.&lt;type&gt;/&lt;level&gt;</code>.</p>
<ul>
<li><strong><code>&lt;type&gt;</code></strong> Defines the log type: <code>console</code> or <code>file</code>.</li>
<li><strong><code>&lt;level&gt;</code></strong> Defines the log level.</li>
</ul>
<p><strong>Examples</strong></p>
<p>The examples below use <a href="https://en.wikipedia.org/wiki/CURL">cURL</a> to execute the HTTP <code>POST</code> commands against the OrientDB server.  It uses the server <code>root</code> user and password.</p>
<ul>
<li>
<p>Enable the finest tracing level to the console:</p>
<pre>
$ <code class="lang-sh userinput">curl -u root:root -X POST http://localhost:2480/server/log.console/FINEST</code>
</pre>
</li>
<li>
<p>Enable the finest tracing level to file:</p>
<pre>
$ <code class="lang-sh userinput">curl -u root:root -X POST http://localhost:2480/server/log.file/FINEST</code>
</pre>
</li>
</ul>
<h2 id="change-logging-on-the-client"><a class="header" href="#change-logging-on-the-client">Change logging on the client</a></h2>
<p>On the client is the same as for the server, but you should rather configure the file <code>config/orientdb-client-log.properties</code> and add this at your client's JVM:</p>
<pre>
$ <code class="lang-sh userinput">java -Djava.util.logging.config.file=config/orientdb-client-log.properties</code>
</pre>
<h2 id="install-log-formatter"><a class="header" href="#install-log-formatter">Install Log Formatter</a></h2>
<p>OrientDB Server uses its own log formatter.  In order to enable the same for your application, you need to include the following line:</p>
<pre><code class="language-java">OLogManager.installCustomFormatter();
</code></pre>
<p>The Server automatically installs the log formatter.  To disable it, use <code>orientdb.installCustomFormatter</code>.</p>
<pre>
$ <code class="lang-sh userinput">java -Dorientdb.installCustomFormatter=false</code>
</pre>
<h2 id="debugging-logger"><a class="header" href="#debugging-logger">Debugging Logger</a></h2>
<p>Java Logging Framework runtime has a known problem with logging from shutdown hooks, sometimes log entries may be lost. OrientDB uses shutdown hooks to properly shutdown its internals, so it also may be affected by this problem, something may go wrong silently on shutdown. To workaround this problem OrientDB provides a special logger – the debugging logger. To activate it provide following command line argument to your JVM:</p>
<pre><code>-Djava.util.logging.manager=com.orientechnologies.common.log.OLogManager$DebugLogManager
</code></pre>
<blockquote>
<p>Use this logger for debugging and troubleshooting purposes only, since it may interfere with your production logging configuration.</p>
</blockquote>
<blockquote>
<p>Make sure <code>$DebugLogManager</code> part is not interpreted as a shell variable substitution. To avoid the substitution apply escaping specific to your shell environment.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="event-scheduler"><a class="header" href="#event-scheduler">Event Scheduler</a></h1>
<p>OrientDB has a Scheduler of events you can use to fire your events on regular basis. To manage events you can use both SQL and Java API. The scheduler gets the popular <a href="https://en.wikipedia.org/wiki/Cron#CRON_expression">CRON expression</a> syntax. The scheduled event, when fired, executes a Database</p>
<h2 id="resources-1"><a class="header" href="#resources-1">Resources</a></h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Cron#CRON_expression">CRON expressions on Wikipedia</a></li>
<li><a href="http://www.cronmaker.com/">CRON expression maker</a> is an online resource to create CRON expressions</li>
</ul>
<h2 id="schedule-an-event"><a class="header" href="#schedule-an-event">Schedule an event</a></h2>
<h3 id="via-sql"><a class="header" href="#via-sql">Via SQL</a></h3>
<p>In order to schedule a new event via SQL, all you need is to create a new record in the <code>OSchedule</code> class. Example on scheduling the event "myEvent" that calls the function "myFunction" every second:</p>
<pre><code class="language-sql">INSERT INTO oschedule
  SET name = 'myEvent',
      function = (SELECT FROM ofunction WHERE name = 'myFunction'),
      rule = \"0/1 * * * * ?\"
</code></pre>
<h3 id="via-java-api"><a class="header" href="#via-java-api">Via Java API</a></h3>
<pre><code class="language-java">db.getMetadata().getScheduler().scheduleEvent(
  new OScheduledEventBuilder().setName("myEvent").setRule("0/1 * * * * ?")
  .setFunction(func).build());
</code></pre>
<h2 id="update-an-event"><a class="header" href="#update-an-event">Update an event</a></h2>
<h3 id="via-sql-1"><a class="header" href="#via-sql-1">Via SQL</a></h3>
<p>To update the scheduling of an event, update the record with the new <code>rule</code>. Example:</p>
<pre><code class="language-sql">UPDATE oschedule SET rule = "0/2 * * * * ?" WHERE name = 'myEvent'
</code></pre>
<h3 id="via-java-api-1"><a class="header" href="#via-java-api-1">Via Java API</a></h3>
<p>To update an event, remove it and reschedule it.</p>
<pre><code class="language-java">db.getMetadata().getScheduler().removeEvent("myEvent");
db.getMetadata().getScheduler().scheduleEvent(
  new OScheduledEventBuilder().setName("myEvent").setRule("0/2 * * * * ?")
  .setFunction(func).build());
</code></pre>
<h2 id="remove-an-event"><a class="header" href="#remove-an-event">Remove an event</a></h2>
<h3 id="via-sql-2"><a class="header" href="#via-sql-2">Via SQL</a></h3>
<p>To cancel a scheduled event, just delete the record. Example:</p>
<pre><code class="language-sql">DELETE oschedule WHERE name = 'myEvent'
</code></pre>
<h3 id="via-java-api-2"><a class="header" href="#via-java-api-2">Via Java API</a></h3>
<pre><code class="language-java">db.getMetadata().getScheduler().removeEvent("myEvent");
</code></pre>
<h2 id="tutorial"><a class="header" href="#tutorial">Tutorial</a></h2>
<p>In this tutorial we want to purge all the records older than 1 year.</p>
<h3 id="1-create-a-function"><a class="header" href="#1-create-a-function">1) Create a <a href="admin/Functions-Creation.html">Function</a></a></h3>
<p>First, create a SQL function that delete the records. To have the date of 1y ago you can use the expression <code>sysdate() - 31536000000</code>, where 31536000000 represents the number of milliseconds in a year.  You can this via SQL or Java API.</p>
<h4 id="via-sql-3"><a class="header" href="#via-sql-3">Via <a href="admin/../sql/SQL-Create-Function.html">SQL</a></a></h4>
<pre><code class="language-sql">CREATE FUNCTION purgeHistoricalRecords
  "DELETE FROM Logs WHERE date &lt; ( sysdate() - 31536000000 )"
  LANGUAGE SQL 
</code></pre>
<h4 id="via-java-api-3"><a class="header" href="#via-java-api-3">Via Java API</a></h4>
<pre><code class="language-java">OFunction func = db.getMetadata().getFunctionLibrary().createFunction("purgeHistoricalRecords");
func.setLanguage("SQL");
func.setCode("DELETE FROM Logs WHERE date &lt; ( sysdate() - 31536000000 )");
func.save();
return func;
</code></pre>
<h3 id="2-schedule-the-event"><a class="header" href="#2-schedule-the-event">2) Schedule the event</a></h3>
<p>The second step is scheduling the event. The CRON expression for "every midnight" is <code>00 00 * * * ?</code>. You can this via SQL or Java API.</p>
<h4 id="via-sql-4"><a class="header" href="#via-sql-4">Via SQL</a></h4>
<pre><code class="language-sql">INSERT INTO oschedule
 SET name = 'purgeHistoricalRecordsAtMidnight',
     function = (SELECT FROM ofunction WHERE name = 'purgeHistoricalRecords'),
     rule = \"00 00 * * * ?\"
</code></pre>
<h4 id="via-java-api-4"><a class="header" href="#via-java-api-4">Via Java API</a></h4>
<pre><code class="language-java">db.command(new OCommandSQL(
 "INSERT INTO oschedule SET name = 'purgeHistoricalRecordsAtMidnight', function = ?, rule = \"00 00 * * * ?\""))
 .execute(func.getId());
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="functions-1"><a class="header" href="#functions-1">Functions</a></h1>
<p>A <strong>Function</strong> is an executable unit of code that can take parameters and return a result. Using Functions you can perform <a href="http://en.wikipedia.org/wiki/Functional_programming">Functional programming</a> where logic and data are all together in a central place. Functions are similar to the <a href="http://en.wikipedia.org/wiki/Stored_procedure">Stored Procedures</a> of RDBMS.</p>
<blockquote>
<p><strong>NOTE</strong>: This guide refers to the last available release of OrientDB. For past revisions look at <a href="admin/Functions.html#compatibility">Compatibility</a>.</p>
</blockquote>
<p>OrientDB Functions features:</p>
<ul>
<li>are persistent</li>
<li>can be written in <a href="admin/../sql/README.html">SQL</a> or Javascript (Ruby, Scala, Java and other languages are coming)</li>
<li>can be executed via <a href="admin/../sql/README.html">SQL</a>, <a href="admin/Functions-Use.html#functions-using-the-java-api">Java</a>, <a href="admin/Functions-Use.html#functions-using-the-http-rest-api">REST</a> and <a href="https://github.com/orientechnologies/orientdb-studio/wiki">Studio</a></li>
<li>can call each other</li>
<li>supports recursion</li>
<li>have automatic mapping of parameters by position and name</li>
<li>plugins can inject new objects to being used by functions</li>
</ul>
<blockquote>
<p>The <a href="admin/../sql/README.html">OrientDB SQL</a> dialect supports many functions written in the native language.  To get better performance, you can write your own native functions in the Java language and register them to the engine.</p>
<p>For more information, see <a href="admin/../sql/SQL-Functions.html#custom-functions-in-java">Custom Functions in Java</a>.</p>
</blockquote>
<h2 id="compatibility"><a class="header" href="#compatibility">Compatibility</a></h2>
<h3 id="150-and-before"><a class="header" href="#150-and-before">1.5.0 and before</a></h3>
<p>OrientDB binds the following variables:</p>
<ul>
<li><code>db</code>, that is the current document database instance</li>
<li><code>gdb</code>, that is the current graph database instance</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="creating-functions"><a class="header" href="#creating-functions">Creating Functions</a></h1>
<p>In addition to the functions provided in OrientDB by default, you can also create your own functions.</p>
<h2 id="using-orientdb-studio"><a class="header" href="#using-orientdb-studio">Using OrientDB Studio</a></h2>
<p>You can do so through the <a href="admin/../studio/README.html">OrientDB Studio</a>. To create a sample function, complete the following steps:</p>
<ol>
<li>
<p>In Studio, open a database and navigate to the <strong>Functions</strong> panel.</p>
</li>
<li>
<p>Enter <code>sum</code> as a name, then add two parameters: <code>a</code> and <code>b</code>.</p>
</li>
<li>
<p>Give the function the following code in the text area:</p>
<pre><code class="language-javascript">return parseInt(a) + parseInt(b);
</code></pre>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
<p>This adds the function <code>sum</code> to the database.  In Studio, it appears on the left-side with the available functions.</p>
<p>On the bottom of the page, there are two empty boxes in which you can test the function.  Write <code>3</code> in one and <code>5</code> in the other, then click <strong>Execute</strong> to see the results.</p>
<p><img src="admin/../images/studio-function-sum.png" alt="image" /></p>
<blockquote>
<p>Why using <code>parseInt()</code> instead of <code>a + b</code>?  Because HTTP protocol passes parameters as strings.</p>
</blockquote>
<h2 id="saved-functions"><a class="header" href="#saved-functions">Saved Functions</a></h2>
<p>OrientDB saves functions in the database, using the <code>OFunction</code> class.  This class has the following properties:</p>
<div class="table-wrapper"><table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody>
<tr><td><code>name</code></td><td>Defines the name of the function.</td></tr>
<tr><td><code>code</code></td><td>Defines the code the function executes.</td></tr>
<tr><td><code>parameters</code></td><td>Defines an optional <code>EMBEDDEDLIST</code> of strings, containing the parameter names, if any.</td></tr>
<tr><td><code>idempotent</code></td><td>Defines whether the function is idempotent, that is if it changes the database.  Read-only functions are idempotent.  This is needed to avoid calling non-idempotent functions using the HTTP GET method.</td></tr>
</tbody></table>
</div>
<blockquote>
<p>Given that OrientDB uses one record per function, the MVCC mechanism is used to protect against concurrent record updates.</p>
</blockquote>
<h2 id="using-recursive-calls"><a class="header" href="#using-recursive-calls">Using Recursive Calls</a></h2>
<p>Functions can call on other functions in order to process the results.  They can also call themselves in a recursive call.</p>
<p>For instance, create a new function with the name <code>factorial</code>.  Give it the parameter <code>num</code>, with the following code:</p>
<pre><code class="language-javascript">if (num === 0)
  return 1;
else
  return num * factorial( num - 1 );
</code></pre>
<p><img src="admin/../images/studio-function-factorial.png" alt="image" /></p>
<p>When you call <code>factorial()</code>, it calls itself in order to determine the factorial of the given <code>num</code> value, until it reaches the result, which in the case of the test is <code>3648800.0</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="using-functions"><a class="header" href="#using-functions">Using Functions</a></h1>
<h2 id="call-functions-via-sql"><a class="header" href="#call-functions-via-sql">Call Functions via SQL</a></h2>
<p>All the database functions are automatically registered in the SQL Engine.</p>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Calling the sum function from SQL with static parameters:</p>
<pre><code class="language-sql">SELECT SUM(3,4)
</code></pre>
</li>
<li>
<p>Calling the sum function from SQL with parameters taken from database:</p>
<pre><code class="language-sql">SELECT SUM(salary,bonus) AS total FROM Employee
</code></pre>
<p>In this case the function SUM is invoked for each record in the Employee class by passing the value of the fields <code>salary</code> and <code>bonus</code>.</p>
</li>
</ul>
<h2 id="functions-using-the-java-api"><a class="header" href="#functions-using-the-java-api">Functions using the Java API</a></h2>
<p>Using OrientDB functions from the Java API is relatively straightforward:</p>
<ol>
<li>Get the reference to the Function Manager</li>
<li>Get the function you want to use.</li>
<li>Execute the function.</li>
</ol>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Passing the parameters by position:</p>
<pre><code class="language-java">ODatabaseDocumentTx db = new ODatabaseDocumentTx("local:/tmp/db");
db.open("admin", "admin");
OFunction sum = db.getMetadata().getFunctionLibrary().getFunction("sum");
Number result = sum.execute(3, 5);
</code></pre>
</li>
<li>
<p>Using the Blueprints Graph API:</p>
<pre><code class="language-java">OFunction sum = graph.getRawGraph().getMetadata().getFunctionLibrary().getFunction("sum");
</code></pre>
</li>
<li>
<p>Execute the function by passing the parameters by name:</p>
</li>
</ul>
<pre><code class="language-java"> Map&lt;String,Object&gt; params = new  HashMap&lt;String,Object&gt;();
 params.put("a", 3);
 params.put("b", 5);
 Number result = sum.execute(params);
</code></pre>
<h2 id="functions-using-the-http-rest-api"><a class="header" href="#functions-using-the-http-rest-api">Functions using the HTTP REST API</a></h2>
<p>OrientDB exposes functions as a REST service, through which it can receive parameters.  Parameters are passed by position in the URL.  Beginning with OrientDB version 2.1, you can also pass parameters in the request payload as JSON.  In which case, the mapping is not positional, but by name.</p>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Execute the <code>sum</code> function, passing <code>3</code> and <code>5</code> as parameters in the URL:</p>
<pre><code>http://localhost:2480/function/demo/sum/3/5
</code></pre>
</li>
<li>
<p>Execute the <code>sum</code> function, passing <code>3</code> and <code>5</code> in the request's payload:</p>
<pre><code class="language-json">{"a": 3, "b": 5}
</code></pre>
</li>
</ul>
<p>Each example returns an HTTP 202 OK with an envelope containing the result of the calculation:</p>
<pre><code class="language-json">{"result":[{"@type":"d","@version":0,"value":2}]}
</code></pre>
<p>You can only call functions with the HTTP GET method if you declare it as <code>idempotent</code>.  You can call any functions using the HTTP POST method.</p>
<p>When executing functions with the HTTP POST method, encode the content and set the HTTP request header to: <code>"Content-Type: application/json"</code>.</p>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="admin/../misc/OrientDB-REST.html#function">HTTP REST Protocol</a>.</li>
<li><a href="admin/Functions-Server.html">Server-side Functions</a></li>
</ul>
</blockquote>
<h3 id="function-return-values-in-http"><a class="header" href="#function-return-values-in-http">Function Return Values in HTTP</a></h3>
<p>When calling a function through a REST service, OrientDB returns the results as JSON to the client through HTTP.  There may be differences in the results, depending on the return value of function.</p>
<p>For instance,</p>
<ul>
<li>
<p>Function that returns a number:</p>
<pre><code class="language-javascript">return 31;
</code></pre>
<p>Would return the result:</p>
<pre><code class="language-json">{"result":[{"@type":"d","@version":0,"value":31}]}
</code></pre>
</li>
<li>
<p>Function that returns a JavaScript object:</p>
<pre><code>return {"a":1, "b":"foo"}
</code></pre>
<p>Would return the result:</p>
<pre><code class="language-json">{"result":[{"@type":"d","@version":0,"value":{"a":1,"b":"foo"}}]}
</code></pre>
</li>
<li>
<p>Function that returns an array:</p>
<pre><code class="language-javascript">return [1, 2, 3]
</code></pre>
<p>Would return the result:</p>
<pre><code class="language-json">{"result":[{"@type":"d","@version":0,"value":[1,2,3]}]}
</code></pre>
</li>
<li>
<p>Function that returns a query result:</p>
<pre><code class="language-javascript">return db.query("SELECT FROM OUser")
</code></pre>
<p>Would return the result:</p>
<pre><code class="language-json">{
  "result": [
      {
          "@type": "d",
          "@rid": "#6:0",
          "@version": 1,
          "@class": "OUser",
          "name": "admin",
          "password": "...",
          "status": "ACTIVE",
          "roles": [
              "#4:0"
          ],
          "@fieldTypes": "roles=n"
      },
      {
          "@type": "d",
          "@rid": "#6:1",
          "@version": 1,
          "@class": "OUser",
          "name": "reader",
          "password": "...",
          "status": "ACTIVE",
          "roles": [
              "#4:1"
          ],
          "@fieldTypes": "roles=n"
      }
  ]
}
</code></pre>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="accessing-the-database-from-a-function"><a class="header" href="#accessing-the-database-from-a-function">Accessing the Database from a Function</a></h1>
<p>When you create a function for OrientDB, it always binds the special variable <code>orient</code> to allow you to use OrientDB services from within the function.  The most important methods are:</p>
<div class="table-wrapper"><table><thead><tr><th>Function</th><th>Description</th></tr></thead><tbody>
<tr><td><code>orient.getDatabase()</code></td><td>Returns the current <a href="http://www.orientechnologies.com/javadoc/latest/com/orientechnologies/orient/core/db/document/ODatabaseDocumentTx.html">document database</a> instance.</td></tr>
</tbody></table>
</div>
<p>For security reason starting from <em>OrientDB 3.0.29</em>, the usage of Java classes is forbidden by default, with a class filter implemented in the JS engine.
To enable the access to classes or packages in your JS code change the <code>allowedPackages</code> field with comma separated packages or classes.</p>
<pre><code class="language-xml">  &lt;handler class="com.orientechnologies.orient.server.handler.OServerSideScriptInterpreter"&gt;
    &lt;parameters&gt;
      &lt;parameter name="enabled" value="true" /&gt;
      &lt;parameter name="allowedLanguages" value="SQL" /&gt;
       &lt;!--  Comma separated packages  allowed in JS scripts eg. java.math.*, java.util.ArrayList --&gt;
      &lt;parameter name="allowedPackages" value=""/&gt;
    &lt;/parameters&gt;
  &lt;/handler&gt;
</code></pre>
<h2 id="executing-queries-1"><a class="header" href="#executing-queries-1">Executing Queries</a></h2>
<p>Queries are idempotent commands.  To execute a query from within a function, use the <code>query()</code> method.  For instance,</p>
<pre><code class="language-javascript">return orient.getDatabase().query("SELECT name FROM OUser");
</code></pre>
<h3 id="queries-with-external-parameters"><a class="header" href="#queries-with-external-parameters">Queries with External Parameters</a></h3>
<p>Create a new function with the name <code>getUserRoles</code> with the parameter <code>user</code>.  Then use this code:</p>
<pre><code class="language-javascript">return orient.getDatabase().query("SELECT roles FROM OUser WHERE name = ?", name );
</code></pre>
<p>Here, the function binds the <code>name</code> parameter as a variable in JavaScript.  You can use this variable to build your query.</p>
<h3 id="sql-commands"><a class="header" href="#sql-commands">SQL Commands</a></h3>
<p>Execute an SQL command within the function:</p>
<pre><code class="language-javascript">var results = orient.getDatabase().command("SELECT FROM Employee WHERE company = ?", [ "Orient Technologies" ] );
</code></pre>
<p>The command returns an array of <a href="admin/../java/ref/OElement.html"><code>OElement</code></a> objects</p>
<h2 id="creating-repository-classes"><a class="header" href="#creating-repository-classes">Creating Repository Classes</a></h2>
<p>Functions provide an ideal place for developing the logic your application uses to access the database.  You can adopt a <a href="http://en.wikipedia.org/wiki/Domain-driven_design">Domain-driven design</a> approach, allowing the function to work as a <a href="http://en.wikipedia.org/wiki/Domain-drven_design#Building_blocks_of_DDD">repository</a> or as a <a href="http://en.wikipedia.org/wiki/Data_access_object">Data Access Object</a>.</p>
<p>This provides a thin (or thick, if you prefer) layer of encapsulation which may protect you from database changes.</p>
<p>Furthermore, each function is published and reachable via the HTTP REST protocol, allowing the automatic creation of a RESTful service.</p>
<p><strong>Examples</strong></p>
<p>Below are some examples of functions to build a repository for <code>OUser</code> records:</p>
<pre><code class="language-javascript">function user_getAll() {
   return orient.getDatabase().query("SELECT FROM OUser");
}

function user_getByName( name ){
   return orient.getDatabase().query("SELECT FROM OUser WHERE name = ?", name );
}

function user_getAdmin(){
   return user_getByName("admin");
}
 
function user_create( name, role ){
   var db = orient.getDatabase();
   var role = db.query("SELECT FROM ORole WHERE name = ?", roleName);
   if( role == null ){
      response.send(404, "Role name not found", "text/plain", "Error: role name not found" );
   } else {

      db.begin();
      try{
         var result = db.save({ "@class" : "OUser", name : "Luca", password : "Luc4", status: "ACTIVE", roles : role});
         db.commit();
         return result;
      }catch ( err ){
         db.rollback()
         response.send(500, "Error on creating new user", "text/plain", err.toString() );
      }
   }
}
</code></pre>
<p><img src="admin/../images/studio-function-repository.png" alt="image" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="server-side-functions"><a class="header" href="#server-side-functions">Server-side Functions</a></h1>
<p>In OrientDB, you can replace the use of Servlets with server-side functions.  For more information on how to call server-side functions, see <a href="admin/Functions-Use.html#functions-using-the-http-rest-api">Functions using the HTTP REST API</a>.</p>
<p>When the HTTP REST protocol calls server-side functions, OrientDB embeds a few additional variables:</p>
<ul>
<li><a href="admin/Functions-Server.html#request-object"><strong>Request Object</strong></a> The HTTP request, implemented by the <code>OHttpRequestWrapper</code> class.</li>
<li><a href="admin/Functions-Server.html#response-object"><strong>Response Object</strong></a> The HTTP request response, implemented by the <code>OHttpResponseWrapper</code> class.</li>
<li><a href="admin/Functions-Server.html#util-object"><strong>Util Object</strong></a> The utility class with helper functions, to use inside the functions, implemented by the <code>OFunctionUtilWrapper</code> class.</li>
</ul>
<h2 id="request-object"><a class="header" href="#request-object">Request Object</a></h2>
<p>OrientDB references this object as <code>request</code>.  For instance,</p>
<pre><code class="language-javascript">var params = request.getParameters();
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Method signature</th><th>Description</th><th>Return type</th></tr></thead><tbody>
<tr><td><code>getContent()</code></td><td>Returns the request content.</td><td>String</td></tr>
<tr><td><code>getUser()</code></td><td>Gets the request user name.</td><td>String</td></tr>
<tr><td><code>getContentType()</code></td><td>Returns the request content type.</td><td>String</td></tr>
<tr><td><code>getHttpVersion()</code></td><td>Return the request HTTP version.</td><td>String</td></tr>
<tr><td><code>getHttpMethod()</code></td><td>Return the request HTTP method called.</td><td>String</td></tr>
<tr><td><code>getIfMatch()</code></td><td>Return the request IF-MATCH header.</td><td>String</td></tr>
<tr><td><code>isMultipart()</code></td><td>Returns if the request is multi-part.</td><td>boolean</td></tr>
<tr><td><code>getArguments()</code></td><td>Returns the request arguments passed in REST form. Example: <code>/2012/10/26</code>.</td><td>String[]</td></tr>
<tr><td><code>getArgument(&lt;position&gt;)</code></td><td>Returns the request argument by position, or <code>null</code> if not found.</td><td>String</td></tr>
<tr><td><code>getParameters()</code></td><td>Returns the request parameters.</td><td>String</td></tr>
<tr><td><code>getParameter(&lt;name&gt;</code>)</td><td>Returns the request parameter by name or null if not found.</td><td>String</td></tr>
<tr><td><code>hasParameters(&lt;name&gt;*</code>)</td><td>Returns the number of parameters found between those passed.</td><td>Integer</td></tr>
<tr><td><code>getSessionId()</code></td><td>Returns the session-id.</td><td>String</td></tr>
<tr><td><code>getURL()</code></td><td>Returns the request URL.</td><td>String</td></tr>
</tbody></table>
</div>
<h2 id="response-object"><a class="header" href="#response-object">Response Object</a></h2>
<p>OrientDB references this object as <code>response</code>.  For instance,</p>
<pre><code class="language-javascript">var db = orient.getDatabase();
var roles = db.query("select from ORole where name = ?", roleName);
if( roles == null || roles.length == 0 ){
  response.send(404, "Role name not found", "text/plain", "Error: role name not found" );
} else {

  db.begin();
  try{
    var result = db.save({ "@class" : "OUser", name : "Luca", password : "Luc4", "roles" : roles});
    db.commit();
    return result;
  }catch ( err ){
    db.rollback();
    response.send(500, "Error on creating new user", "text/plain", err.toString() );
  }
}
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Method signature</th><th>Description</th><th>Return type</th></tr></thead><tbody>
<tr><td><code>getHeader()</code></td><td>Returns the response additional headers.</td><td>String</td></tr>
<tr><td><code>setHeader(String header)</code></td><td>Sets the response additional headers to send back. To specify multiple headers use the line breaks.</td><td>Request object</td></tr>
<tr><td><code>getContentType()</code></td><td>Returns the response content type. If null will be automatically detected.</td><td>String</td></tr>
<tr><td><code>setContentType(String contentType)</code></td><td>Sets the response content type.  If null will be automatically detected.</td><td>Request object</td></tr>
<tr><td><code>getCharacterSet()</code></td><td>Returns the response character set used.</td><td>String</td></tr>
<tr><td><code>setCharacterSet(String characterSet)</code></td><td>Sets the response character set.</td><td>Request object</td></tr>
<tr><td><code>getHttpVersion()</code></td><td>Returns the HTTP version.</td><td>String</td></tr>
<tr><td><code>writeStatus(int httpCode, String reason)</code></td><td>Sets the response status as HTTP code and reason.</td><td>Request object</td></tr>
<tr><td><code>writeStatus(int httpCode, String reason)</code></td><td>Sets the response status as HTTP code and reason.</td><td>Request object</td></tr>
<tr><td><code>writeHeaders(String contentType)</code></td><td>Sets the response headers using the keep-alive.</td><td>Request object</td></tr>
<tr><td><code>writeHeaders(String contentType, boolean keepAlive)</code></td><td>Sets the response headers specifying when using the keep-alive or not.</td><td>Request object</td></tr>
<tr><td><code>writeLine(String content)</code></td><td>Writes a line in the response. A line feed will be appended at the end of the content.</td><td>Request object</td></tr>
<tr><td><code>writeContent(String content)</code></td><td>Writes content directly to the response.</td><td>Request object</td></tr>
<tr><td><code>writeRecords(List&lt;OIdentifiable&gt; records)</code></td><td>Writes records as response. The records are serialized in JSON format.</td><td>Request object</td></tr>
<tr><td><code>writeRecords( List&lt;OIdentifiable&gt; records, String fetchPlan)</code></td><td>Writes records as response specifying a fetch-plan to serialize nested records. The records are serialized in JSON format.</td><td>Request object</td></tr>
<tr><td><code>writeRecord(ORecord record)</code></td><td>Writes a record as response. The record is serialized in JSON format.</td><td>Request object</td></tr>
<tr><td><code>writeRecord(ORecord record, String fetchPlan)</code></td><td>Writes a record as response. The record is serialized in JSON format.</td><td>Request object</td></tr>
<tr><td><code>send(int code, String reason, String contentType, Object content)</code></td><td>Sends the complete HTTP response in one call.</td><td>Request object</td></tr>
<tr><td><code>send(int code, String reason, String contentType, Object content, String headers)</code></td><td>Sends the complete HTTP response in one call specifying additional headers. Keep-alive is set.</td><td>Request object</td></tr>
<tr><td><code>send(int code, String reason, String contentType, Object content, String headers, boolean keepAlive)</code></td><td>Sends the complete HTTP response in one call specifying additional headers.</td><td>Request object</td></tr>
<tr><td><code>sendStream(int code, String reason, String contentType, InputStream content, long size)</code></td><td>Sends the complete HTTP response in one call specifying a stream as content.</td><td>Request object</td></tr>
<tr><td><code>flush()</code></td><td>Flushes the content to the TCP/IP socket.</td><td>Request object</td></tr>
</tbody></table>
</div>
<h2 id="util-object"><a class="header" href="#util-object">Util Object</a></h2>
<p>OrientDB references this object as <code>util</code>.  For instance,</p>
<pre><code class="language-javascript">if( util.exists(year) ){
  print("\nYes, the year was passed!");
}
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Method signature</th><th>Description</th><th>Return type</th></tr></thead><tbody>
<tr><td><code>exists(&lt;variable&gt;)</code></td><td>Returns trues if any of the passed variables are defined. In JS, for example, a variable is defined if it's not null and not equal to <code>undefined</code>.</td><td>Boolean</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="backup--restore"><a class="header" href="#backup--restore">Backup &amp; Restore</a></h1>
<p>OrientDB supports backup and and restore operations, like any database management system.</p>
<p>The <a href="admin/../console/Console-Command-Backup.html"><code>BACKUP DATABASE</code></a> command executes a complete backup on the currently open database.  It compresses the backup the backup using the ZIP algorithm.  To restore the database from the subsequent <code>.zip</code> file, you can use the <a href="admin/../console/Console-Command-Restore.html"><code>RESTORE DATABASE</code></a> command.</p>
<p>Backups and restores are much faster than the <a href="admin/../console/Console-Command-Export.html"><code>EXPORT DATABASE</code></a> and <a href="admin/../console/Console-Command-Import.html"><code>IMPORT DATABASE</code></a> commands.  You can also automate backups using the <a href="admin/../plugins/Automatic-Backup.html">Automatic Backup</a> server plugin.  Additionally, beginning with version 2.2 of <a href="admin/../ee/Enterprise-Edition.html">Enterprise Edition</a> OrientDB introduces major support for <a href="admin/Incremental-Backup-And-Restore.html">incremental backups</a>.</p>
<blockquote>
<p><strong>NOTE</strong>: OrientDB Community Edition does not support backing up remote databases.  OrientDB <a href="http://www.orientechnologies.com/orientdb-enterprise/">Enterprise Edition</a> does support this feature.  For more information on how to implement this with Enterprise Edition, see <a href="http://www.orientechnologies.com/enterprise/last/servermanagement.html">Remote Backups</a>.</p>
</blockquote>
<h2 id="backups-versus-exports"><a class="header" href="#backups-versus-exports">Backups versus Exports</a></h2>
<p>During backups, the <a href="admin/../console/Console-Command-Backup.html"><code>BACKUP DATABASE</code></a> command produces a consistent copy of the database.  During this process, the database locks all write operations, waiting for the backup to finish.  If you need perform reads and writes on the database during backups, set up a distributed cluster of nodes.  To access to the non blocking backup feature, use the <a href="admin/Incremental-Backup-And-Restore.html">Enterprise Edition</a>.</p>
<p>By contrast, the <a href="admin/../console/Console-Command-Export.html"><code>EXPORT DATABASE</code></a> command doesn't lock the database, allowing concurrent writes to occur during the export process.  Consequentially, the export may include changes made after you initiated the export, which may result in inconsistencies.</p>
<h2 id="using-the-backup-script"><a class="header" href="#using-the-backup-script">Using the Backup Script</a></h2>
<p>Beginning in version 1.7.8, OrientDB introduces a <code>backup.sh</code> script found in the <code>$ORIENTDB_HOME/bin</code> directory.  This script allows you to initiate backups from the system console.</p>
<p><strong>Syntax</strong></p>
<pre><code>./backup.sh &lt;db-url&gt; &lt;user&gt; &lt;password&gt; &lt;destination&gt; [&lt;type&gt;]
</code></pre>
<ul>
<li><strong><code>&lt;db-url&gt;</code></strong> Defines the URL for the database to backup.</li>
<li><strong><code>&lt;user&gt;</code></strong> Defines the user to run the backup.</li>
<li><strong><code>&lt;password&gt;</code></strong> Defines the password for the user.</li>
<li><strong><code>&lt;destination&gt;</code></strong> Defines the path to the backup file the script creates, (use the <code>.zip</code> extension).</li>
<li><strong><code>&lt;type&gt;</code></strong> Defines the backup type.  Supported types:
<ul>
<li><em><code>default</code></em> Locks the database during the backup.</li>
<li><em><code>lvm</code></em> Executes an LVM copy-on-write snapshot in the background.</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>NOTE</strong> Non-blocking backups require that the operating system support LVM.  For more information, see</p>
<ul>
<li><a href="http://en.wikipedia.org/wiki/Logical_Volume_Manager_%28Linux%29">LVM</a></li>
<li><a href="http://arstechnica.com/information-technology/2004/10/linux-20041013/">File system snapshots with LVM</a></li>
<li><a href="http://www.tldp.org/HOWTO/LVM-HOWTO/snapshots_backup.html">LVM snapshot backup</a></li>
</ul>
</blockquote>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Backup a database opened using <code>plocal</code>:</p>
<pre>
$ <code class="lang-sh userinput">$ORIENTDB_HOME/bin/backup.sh plocal:../database/testdb \
      admin adminpasswd \
  	/path/to/backup.zip</code>
</pre>
</li>
<li>
<p>Perform a non-blocking LVM backup, using <code>plocal</code>:</p>
<pre>
$ <code class='lang-sh userinput'>$ORIENTDB_HOME/bin/backup.sh plocal:../database/testdb \
      admin adminpasswd \
  	/path/to/backup.zip \
  	lvm</code>
</pre>
</li>
<li>
<p>Perform a backup using the OrientDB Console with the <a href="admin/../console/Console-Command-Backup.html"><code>BACKUP</code></a> command:</p>
<pre>
orientdb> <code class='lang-sql userinput'>CONNECT PLOCAL:../database/testdb/ admin adminpasswd</code>
orientdb> <code class='lang-sql userinput'>BACKUP DATABASE /path/to/backup.zip</code>

Backup executed in 0.52 seconds.
</pre>
</li>
</ul>
<h2 id="restoring-databases"><a class="header" href="#restoring-databases">Restoring Databases</a></h2>
<p>Once you have created your <code>backup.zip</code> file, you can restore it to the database either through the OrientDB Console, using the <a href="admin/../console/Console-Command-Restore.html"><code>RESTORE DATABASE</code></a> command.</p>
<pre>
orientdb> <code class='lang-sql userinput'>RESTORE DATABASE /backups/mydb.zip</code>

Restore executed in 6.33 seconds
</pre>
<p>Bear in mind that OrientDB does not support merging during restores.  If you need to merge the old data with new writes, instead use <a href="admin/../console/Console-Command-Export.html"><code>EXPORT DATABASE</code></a> and <a href="admin/../console/Console-Command-Export.html"><code>IMPORT DATABASE</code></a> commands, instead.</p>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="admin/../console/Console-Command-Backup.html"><code>BACKUP DATABASE</code></a></li>
<li><a href="admin/../console/Console-Command-Restore.html"><code>RESTORE DATABASE</code></a></li>
<li><a href="admin/../console/Console-Command-Export.html"><code>EXPORT DATABASE</code></a></li>
<li><a href="admin/../console/Console-Command-Import.html"><code>IMPORT DATABASE</code></a></li>
<li><a href="admin/../console/Console-Commands.html">Console Commands</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="incremental-backup-and-restore"><a class="header" href="#incremental-backup-and-restore">Incremental Backup and Restore</a></h1>
<p>(Since v2.2 - Enterprise Edition only)</p>
<p>An incremental backup generates smaller backup files by storing only the delta between two versions of the database. This is useful when you execute a backup on a regular basis and you want to avoid having to back up the entire database each time. The easiest way to execute a backup and a restore is using <a href="admin/../studio/backups-imports-exports/Studio-Backup-Management.html">Studio</a>.</p>
<blockquote>
<p><strong>NOTE</strong>: This feature is available only in the <a href="http://orientdb.com/orientdb-enterprise">OrientDB Enterprise Edition</a>. If you are interested in a commercial license look at <a href="http://orientdb.dev/support">OrientDB Subscription Packages</a>.</p>
</blockquote>
<p>NOTE: Lucene Indexes are not supported yet in the incremental backup/restore process. Once the incremental restore is finished the indexes rebuild is necessary see (here)[https://github.com/orientechnologies/orientdb/issues/5958]</p>
<h2 id="see-also"><a class="header" href="#see-also">See also</a></h2>
<ul>
<li><a href="admin/Backup-and-Restore.html">Backup and Restore</a></li>
<li><a href="admin/../console/Console-Command-Backup.html">BACKUP DATABASE console command</a></li>
<li><a href="admin/../console/Console-Command-Restore.html">RESTORE DATABASE console command</a></li>
</ul>
<h2 id="how-does-it-work-1"><a class="header" href="#how-does-it-work-1">How does it work?</a></h2>
<p>Every time a backup is executed, OrientDB writes a file named <code>last-backup.json</code> in the database directory. This is an example of the content:</p>
<pre><code class="language-json">{
  "lsn": 8438432,
  "startedOn": "2015-08-17 10:33:23.943",
  "completedOn": "2015-08-17 10:33:45.121"
}
</code></pre>
<p>The most important information is the <code>lsn</code> field that is the WAL LSN (Last Serial Number). Thanks to this number, OrientDB is able to understand the last change in the database, so the next incremental backup will be done starting from last <code>lsn</code> + 1.</p>
<h2 id="executing-an-incremental-backup"><a class="header" href="#executing-an-incremental-backup">Executing an Incremental Backup</a></h2>
<h3 id="incremental-backup-via-console"><a class="header" href="#incremental-backup-via-console">Incremental Backup via Console</a></h3>
<p><a href="admin/../console/Console-Command-Backup.html">Backup Database console command</a> accepts <code>-incremental</code> as an optional parameter to execute an incremental backup. In this case the new backup is executed from the last backup (file <code>last-backup.json</code> is read if present). If this is the first incremental backup, a full backup is executed. Example:</p>
<pre><code>orientdb&gt; connect plocal:/databases/mydb admin admin
orientdb {db=Whisky}&gt; backup database /tmp/backup -incremental
</code></pre>
<p>The incremental backup setting also allows you to specify an LSN version to start with. Example:</p>
<pre><code>orientdb&gt; connect plocal:/databases/mydb admin admin
orientdb {db=Whisky}&gt; backup database /tmp/backup -incremental=93222
</code></pre>
<h3 id="incremental-backup-via-java-api"><a class="header" href="#incremental-backup-via-java-api">Incremental Backup via Java API</a></h3>
<p>You can perform an incremental backup via the Java API too.</p>
<p><strong>NOTE</strong> The <code>remote</code> protocol is supported, but the specified <em>path</em> is relative to the server.</p>
<p>If you are managing an ODocumentDatabase you have to call the <code>incrementalBackup()</code> method that accepts a String <em>path</em> parameter to the backup directory:</p>
<pre><code>ODatabaseDocumentTx documentDatabase = new ODatabaseDocumentTx(dbURL);
documentDatabase.open("root", "password");
documentDatabase.incrementalBackup("/tmp/backup");
</code></pre>
<p>If you are using the OrientGraph interface you have to get the raw graph before calling the <code>incrementalBackup()</code> method:</p>
<pre><code>OrientGraph graphDatabase = new OrientGraphNoTx(dbURL);
graphDatabase.open("root", "password");
graphDatabase.getRawGraph().incrementalBackup("/tmp/backup");
</code></pre>
<h2 id="executing-an-incremental-restore"><a class="header" href="#executing-an-incremental-restore">Executing an Incremental Restore</a></h2>
<h3 id="incremental-restore-via-the-console"><a class="header" href="#incremental-restore-via-the-console">Incremental Restore via the Console</a></h3>
<p><a href="admin/../console/Console-Command-Restore.html">Restore Database console command</a> automatically recognizes if a backup contains incremental data. Restoring an incremental backup creates a new database with the restored content.  You cannot perform an in-place incremental restore on an existing database. The execution of the create database command with the option <code>-restore</code> builds a fresh database and performs the incremental restore starting from the backup path.</p>
<p>Example:</p>
<pre><code>orientdb&gt; create database remote:localhost/mydb root root plocal graph -restore=/tmp/backup

Creating database [remote:localhost/mydb] using the storage type [plocal]...
Connecting to database [remote:localhost/mydb] with user 'admin'...OK

Database created successfully.

Current database is: remote:localhost/mydb
</code></pre>
<p>In distributed mode restore will success only with a single node in the cluster. If you have 2 nodes or more in your cluster you have to use the standard restore procedure.</p>
<h3 id="incremental-restore-via-the-java-api"><a class="header" href="#incremental-restore-via-the-java-api">Incremental Restore via the Java API</a></h3>
<p>You can perform an incremental restore via the Java API too.
To create a database from an incremental backup you can call from Java <code>ODatabase#create(path-to-incremental-backup-directory)</code>.</p>
<h3 id="incremental-restore-in-distributed-architecture"><a class="header" href="#incremental-restore-in-distributed-architecture">Incremental Restore in Distributed Architecture</a></h3>
<p>The incremental restore affects only the local node where the restore command is executed.<br />
Let's suppose we have 3 nodes and we execute an incremental restore on node1. If we execute an incremental restore on node1 a new fresh database is created on all the 3 nodes, but only on node1 the restore procedure is performed. Thus we obtain the database correctly restored on node1 but an empty database on node2 and node 3.<br />
You can overcome this inconsistency by executing a shutdown on all the nodes of the cluster not involved in the restore procedure (node2 and node3 in our example), so once restarted they will get the full database from node1.</p>
<h2 id="distributed-architecture-1"><a class="header" href="#distributed-architecture-1">Distributed Architecture</a></h2>
<p>The incremental backup is used in the <a href="admin/../distributed/Distributed-Architecture.html">Distributed Architecture</a> when a server node restarts. This avoids having to backup and transfer the entire database across the network.</p>
<h2 id="internals-1"><a class="header" href="#internals-1">Internals</a></h2>
<h3 id="file-format"><a class="header" href="#file-format">File Format</a></h3>
<p>In case of incremental backup, the content of the zip file is not the database directory, but rather meta files needed to update the database with the delta. Example of the content:</p>
<pre><code>- Employee.pcl
- Person.pcl.incremental
- Person.pcm.incremental
</code></pre>
<p>This means only three files are changed.  Employee.pcl is a full file, while the other two files with extension ".incremental" are incremental. Incremental files contain all the page changes and have the following format:</p>
<pre><code>+----------------+-----------------+
| PAGE NUMBER    | PAGE CONTENT    |
| (long)         | byte[]          |
+----------------+-----------------+
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="export-and-import"><a class="header" href="#export-and-import">Export and Import</a></h1>
<p>OrientDB supports export and import operations, like any database management system.</p>
<p>This Section provides information on how to export-to and import-from JSON, as well on how to import from a RDBMS and Neo4j.</p>
<blockquote>
<p>Neo4j is a registered trademark of Neo Technology, Inc.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="export-to--import-from-json"><a class="header" href="#export-to--import-from-json">Export to &amp; Import from JSON</a></h1>
<p>The <a href="admin/../console/Console-Command-Export.html"><code>EXPORT DATABASE</code></a> command exports the current opened database into a file.  The exported file is in the <a href="admin/Export-Format.html">Export JSON</a> format.  By default, it compresses the file using the GZIP algorithm.</p>
<p>Using exports with the <a href="admin/../console/Console-Command-Import.html"><code>IMPORT DATABASE</code></a> command, you can migrate the database between different releases of OrientDB without losing data.  When doing this, if you receive an error relating to the database version, export the database using the same version of OrientDB on which you created the database.</p>
<pre>
orientdb> <code class='lang-sql userinput'>EXPORT DATABASE /temp/petshop.export</code>

Exporting current database to: /temp/petshop.export...

Exporting database info...OK
Exporting dictionary...OK
Exporting schema...OK
Exporting clusters...
- Exporting cluster 'metadata' (records=11) -> ...........OK
- Exporting cluster 'index' (records=0) -> OK
- Exporting cluster 'default' (records=779) -> OK
- Exporting cluster 'csv' (records=1000) -> OK
- Exporting cluster 'binary' (records=1001) -> OK
- Exporting cluster 'person' (records=7) -> OK
- Exporting cluster 'animal' (records=5) -> OK
- Exporting cluster 'animalrace' (records=0) -> OK
- Exporting cluster 'animaltype' (records=1) -> OK
- Exporting cluster 'orderitem' (records=0) -> OK
- Exporting cluster 'order' (records=0) -> OK
- Exporting cluster 'city' (records=3) -> OK
Export of database completed.
</pre>
<h2 id="exports-versus-backups"><a class="header" href="#exports-versus-backups">Exports versus Backups</a></h2>
<p>Exports don't lock the database.  Instead, they browse the contents.  This means that OrientDB can execute concurrent operations during the export, but the exported database may not be an exact replica from the time when you issued the command.  If you need a database snapshot, use backups.</p>
<p>The <a href="admin/../console/Console-Command-Backup.html"><code>BACKUP DATABASE</code></a> command does create a consistent copy of the database, but it locks the database.  During the backup, the database remains in read-only mode, all concurrent write operations are blocked until the backup finishes.  In the event that you need a database snapshot <em>and</em> the ability to perform read/write operations during the backup, set up a distributed cluster of nodes.</p>
<blockquote>
<p><strong>NOTE</strong>: Even though the export file is 100% JSON, there are some constraints in the JSON format, where the field order must be kept.  Modifying the file to adjust the indentation may make the file unusable in database imports.</p>
</blockquote>
<h2 id="importing-databases"><a class="header" href="#importing-databases">Importing Databases</a></h2>
<p>Once you have exported your database, you can import it using the <a href="admin/../console/Console-Command-Import.html"><code>IMPORT DATABASE</code></a> command.</p>
<pre>
orientdb> <code class='lang-sql userinput'>IMPORT DATABASE /temp/petshop.export.gz -preserveClusterIDs=true</code>

Importing records...
- Imported records into the cluster 'internal': 5 records
- Imported records into the cluster 'index': 4 records
- Imported records into the cluster 'default': 1022 records
- Imported records into the cluster 'orole': 3 records
- Imported records into the cluster 'ouser': 3 records
- Imported records into the cluster 'csv': 100 records
- Imported records into the cluster 'binary': 101 records
- Imported records into the cluster 'account': 1005 records
- Imported records into the cluster 'company': 9 records
- Imported records into the cluster 'profile': 9 records
- Imported records into the cluster 'whiz': 1000 records
- Imported records into the cluster 'address': 164 records
- Imported records into the cluster 'city': 55 records
- Imported records into the cluster 'country': 55 records
- Imported records into the cluster 'animalrace': 3 records
- Imported records into the cluster 'ographvertex': 102 records
- Imported records into the cluster 'ographedge': 101 records
- Imported records into the cluster 'graphcar': 1 records
</pre>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="admin/Export-Format.html">JSON Export Format</a></li>
<li><a href="admin/../console/Console-Command-Restore.html"><code>RESTORE DATABASE</code></a></li>
<li><a href="admin/../console/Console-Command-Export.html"><code>EXPORT DATABASE</code></a></li>
<li><a href="admin/../console/Console-Command-Import.html"><code>IMPORT DATABASE</code></a></li>
<li><a href="admin/../console/Console-Commands.html">Console Commands</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="export-format"><a class="header" href="#export-format">Export Format</a></h1>
<p>When you run the <a href="admin/../console/Console-Command-Export.html"><code>EXPORT DATABASE</code></a> command, OrientDB exports the database into a zipped file using a special JSON format.  When you run the <a href="admin/../console/Console-Command-Import.html"><code>IMPORT DATABASE</code></a> command, OrientDB unzips the file and parses the JSON, making the import.</p>
<h2 id="sections"><a class="header" href="#sections">Sections</a></h2>
<p>Export files for OrientDB use the following sections.  Note that while the export format is 100% JSON, there are some constraints in the format, where the field order must be kept.  Additionally, modifying the file to adjust the indentation (as has been done in the examples below), may make it unusable in database imports.</p>
<h3 id="info-section"><a class="header" href="#info-section">Info Section</a></h3>
<p>The first section contains the resuming database information as well as all versions used during the export.  OrientDB uses this information to check for compatibility during the import.</p>
<pre><code class="language-json">"info": {
  "name": "demo",
  "default-cluster-id": 2,
  "exporter-format": 2,
  "engine-version": "1.7-SNAPSHOT",
  "storage-config-version": 2,
  "schema-version": 4,
  "mvrbtree-version": 0
}
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>JSON Type</th></tr></thead><tbody>
<tr><td><code>"name"</code></td><td>Defines the name of the database.</td><td>String</td></tr>
<tr><td><code>"default-cluster-id"</code></td><td>Defines the Cluster ID to use by default.  Range: 0-32,762.</td><td>Integer</td></tr>
<tr><td><code>"exporter-format"</code></td><td>Defines the version of the database exporter.</td><td>Integer</td></tr>
<tr><td><code>"engine-version"</code></td><td>Defines the version of OrientDB.</td><td>String</td></tr>
<tr><td><code>"storage-version"</code></td><td>Defines the version of the Storage layer.</td><td>Integer</td></tr>
<tr><td><code>"schema-version"</code></td><td>Defines the version of the schema exporter.</td><td>Integer</td></tr>
<tr><td><code>"mvrbtree-version"</code></td><td>Defines the version of the MVRB-Tree.</td><td>Integer</td></tr>
</tbody></table>
</div>
<h3 id="clusters-section"><a class="header" href="#clusters-section">Clusters Section</a></h3>
<p>This section defines the database structure in clusters.  It is formed from a list with an entry for each cluster in the database.</p>
<pre><code class="language-json">"clusters": [
  {"name": "internal", "id": 0, "type": "PHYSICAL"},
  {"name": "index", "id": 1, "type": "PHYSICAL"},
  {"name": "default", "id": 2, "type": "PHYSICAL"}
]
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>JSON Type</th></tr></thead><tbody>
<tr><td><code>"name"</code></td><td>Defines the logical name of the cluster.</td><td>String</td></tr>
<tr><td><code>"id"</code></td><td>Defines the Cluster ID.  Range: 0-32, 767.</td><td>Integer</td></tr>
<tr><td><code>"type"</code></td><td>Defines the cluster type: <code>PHYSICAL</code>, <code>LOGICAL</code> and <code>MEMORY</code>.</td><td>String</td></tr>
</tbody></table>
</div>
<h3 id="schema-section"><a class="header" href="#schema-section">Schema Section</a></h3>
<p>This section defines the database schema as classes and properties.</p>
<pre><code class="language-json">"schema":{
  "version": 210,
  "classes": [
    {"name": "Account", "default-cluster-id": 9, "cluster-ids": [9],
      "properties": [
        {"name": "binary", "type": "BINARY", "mandatory": false, "not-null": false},
        {"name": "birthDate", "type": "DATE", "mandatory": false, "not-null": false},
        {"name": "id", "type": "INTEGER", "mandatory": false, "not-null": false}
      ]
    }
  ]
}
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>JSON Type</th></tr></thead><tbody>
<tr><td><code>"version"</code></td><td>Defines the version of the record storing the schema.  Range: 0-2,147,483,647.</td><td>Integer</td></tr>
<tr><td><code>"classes"</code></td><td>Defines a list of entries for each class in the schema.</td><td>Array</td></tr>
</tbody></table>
</div>
<p><strong>Parameters for the Classes Subsection:</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>JSON Type</th></tr></thead><tbody>
<tr><td><code>"name"</code></td><td>Defines the logical name of the class.</td><td>String</td></tr>
<tr><td><code>"default-cluster-id"</code></td><td>Defines the default Cluster ID for the class.  It represents the cluster that stores the class records.</td><td>Integer</td></tr>
<tr><td><code>"cluster-ids"</code></td><td>Defines an array of Cluster ID's that store the class records.  The first ID is always the default Cluster ID.</td><td>Array of Integers</td></tr>
<tr><td><code>"properties"</code></td><td>Defines a list of entries for each property for the class in the schema.</td><td>Array</td></tr>
</tbody></table>
</div>
<p><strong>Parameters for the Properties Sub-subsection:</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>JSON Type</th></tr></thead><tbody>
<tr><td><code>"name"</code></td><td>Defines the logical name of the property.</td><td>String</td></tr>
<tr><td><code>"type"</code></td><td>Defines the <a href="admin/../general/Types.html">property type</a>.</td><td>String</td></tr>
<tr><td><code>"mandatory"</code></td><td>Defines whether the property is mandatory.</td><td>Boolean</td></tr>
<tr><td><code>"not-null"</code></td><td>Defines whether the property accepts a <code>NULL</code> value.</td><td>Boolean</td></tr>
</tbody></table>
</div>
<h3 id="records-section"><a class="header" href="#records-section">Records Section</a></h3>
<p>This section defines the exported record with metadata and fields.  Entries for metadata are distinguished from fields by the <code>@</code> symbol.</p>
<pre><code class="language-json">"records": [
   {"@type": "d", "@rid": "#12:476", "@version": 0, "@class": "Account",
    "account_id": 476,
	"date": "2011-12-09 00:00:00:0000",
	"@fieldTypes": ["account_id=i", "date=t"]
   },
   {"@type": "d", "@rid": "#12:477", "@version": 0,	"@class": "Whiz",
    "id": 477,
    "date": "2011-12-09 00:00:00:000",
    "text": "He in office return He inside electronics for $500,000 Jay",
    "@fieldTypes": "date=t"
   }
]
</code></pre>
<p><strong>Parameters for Metadata</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>JSON Type</th></tr></thead><tbody>
<tr><td><code>"@type"</code></td><td>Defines the record-type: <code>d</code> for Document, <code>b</code> for Binary.</td><td>String</td></tr>
<tr><td><code>"@rid"</code></td><td>Defines the <a href="admin/../datamodeling/Concepts.html#record-id">Record ID</a>, using the format: <code>&lt;cluster-id&gt;:&lt;cluster-position&gt;</code>.</td><td>String</td></tr>
<tr><td><code>"@version"</code></td><td>Defines the record version.  Range: 0-2, 147, 483, 647.</td><td>Integer</td></tr>
<tr><td><code>"@class"</code></td><td>Defines the logical class name for the record.</td><td>String</td></tr>
<tr><td><code>"@fieldTypes"</code></td><td>Defines an array of the types for each field in this record.</td><td>Any</td></tr>
</tbody></table>
</div>
<p><strong>Supported Field Types</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Value</th><th>Type</th></tr></thead><tbody>
<tr><td><code>l</code></td><td>Long</td></tr>
<tr><td><code>f</code></td><td>Float</td></tr>
<tr><td><code>d</code></td><td>Double</td></tr>
<tr><td><code>s</code></td><td>Short</td></tr>
<tr><td><code>t</code></td><td>Datetime</td></tr>
<tr><td><code>d</code></td><td>Date</td></tr>
<tr><td><code>c</code></td><td>Decimal</td></tr>
<tr><td><code>b</code></td><td>Byte</td></tr>
</tbody></table>
</div>
<h2 id="full-example"><a class="header" href="#full-example">Full Example</a></h2>
<pre><code class="language-json">{
  "info":{
    "name": "demo",
    "default-cluster-id": 2,
    "exporter-version": 2,
    "engine-version": "1.0rc8-SNAPSHOT",
    "storage-config-version": 2,
    "schema-version": 4,
    "mvrbtree-version": 0
  },
  "clusters": [
    {"name": "internal", "id": 0, "type": "PHYSICAL"},
    {"name": "index", "id": 1, "type": "PHYSICAL"},
    {"name": "default", "id": 2, "type": "PHYSICAL"},
    {"name": "orole", "id": 3, "type": "PHYSICAL"},
    {"name": "ouser", "id": 4, "type": "PHYSICAL"},
    {"name": "orids", "id": 5, "type": "PHYSICAL"},
    {"name": "csv", "id": 6, "type": "PHYSICAL"},
    {"name": "binary", "id": 8, "type": "PHYSICAL"},
    {"name": "account", "id": 9, "type": "PHYSICAL"},
    {"name": "company", "id": 10, "type": "PHYSICAL"},
    {"name": "profile", "id": 11, "type": "PHYSICAL"},
    {"name": "whiz", "id": 12, "type": "PHYSICAL"},
    {"name": "address", "id": 13, "type": "PHYSICAL"},
    {"name": "city", "id": 14, "type": "PHYSICAL"},
    {"name": "country", "id": 15, "type": "PHYSICAL"},
    {"name": "dummy", "id": 16, "type": "PHYSICAL"},
    {"name": "ographvertex", "id": 26, "type": "PHYSICAL"},
    {"name": "ographedge", "id": 27, "type": "PHYSICAL"},
    {"name": "graphvehicle", "id": 28, "type": "PHYSICAL"},
    {"name": "graphcar", "id": 29, "type": "PHYSICAL"},
    {"name": "graphmotocycle", "id": 30, "type": "PHYSICAL"},
    {"name": "newv", "id": 31, "type": "PHYSICAL"},
    {"name": "mappoint", "id": 33, "type": "PHYSICAL"},
    {"name": "person", "id": 35, "type": "PHYSICAL"},
    {"name": "order", "id": 36, "type": "PHYSICAL"},
    {"name": "post", "id": 37, "type": "PHYSICAL"},
    {"name": "comment", "id": 38, "type": "PHYSICAL"}
  ],
  "schema":{
    "version": 210,
    "classes": [
      {"name": "Account", "default-cluster-id": 9, "cluster-ids": [9],
        "properties": [
          {"name": "binary", "type": "BINARY", "mandatory": false, "not-null": false},
          {"name": "birthDate", "type": "DATE", "mandatory": false, "not-null": false},
          {"name": "id", "type": "INTEGER", "mandatory": false, "not-null": false}
        ]
      },
      {"name": "Address", "default-cluster-id": 13, "cluster-ids": [13]
      },
      {"name": "Animal", "default-cluster-id": 17, "cluster-ids": [17]
      },
      {"name": "AnimalRace", "default-cluster-id": 18, "cluster-ids": [18]
      },
      {"name": "COMMENT", "default-cluster-id": 38, "cluster-ids": [38]
      },
      {"name": "City", "default-cluster-id": 14, "cluster-ids": [14]
      },
      {"name": "Company", "default-cluster-id": 10, "cluster-ids": [10], "super-class": "Account",
        "properties": [
        ]
      },
      {"name": "Country", "default-cluster-id": 15, "cluster-ids": [15]
      },
      {"name": "Dummy", "default-cluster-id": 16, "cluster-ids": [16]
      },
      {"name": "GraphCar", "default-cluster-id": 29, "cluster-ids": [29], "super-class": "GraphVehicle",
        "properties": [
        ]
      },
      {"name": "GraphMotocycle", "default-cluster-id": 30, "cluster-ids": [30], "super-class": "GraphVehicle",
        "properties": [
        ]
      },
      {"name": "GraphVehicle", "default-cluster-id": 28, "cluster-ids": [28], "super-class": "OGraphVertex",
        "properties": [
        ]
      },
      {"name": "MapPoint", "default-cluster-id": 33, "cluster-ids": [33],
        "properties": [
          {"name": "x", "type": "DOUBLE", "mandatory": false, "not-null": false},
          {"name": "y", "type": "DOUBLE", "mandatory": false, "not-null": false}
        ]
      },
      {"name": "OGraphEdge", "default-cluster-id": 27, "cluster-ids": [27], "short-name": "E",
        "properties": [
          {"name": "in", "type": "LINK", "mandatory": false, "not-null": false, "linked-class": "OGraphVertex"},
          {"name": "out", "type": "LINK", "mandatory": false, "not-null": false, "linked-class": "OGraphVertex"}
        ]
      },
      {"name": "OGraphVertex", "default-cluster-id": 26, "cluster-ids": [26], "short-name": "V",
        "properties": [
          {"name": "in", "type": "LINKSET", "mandatory": false, "not-null": false, "linked-class": "OGraphEdge"},
          {"name": "out", "type": "LINKSET", "mandatory": false, "not-null": false, "linked-class": "OGraphEdge"}
        ]
      },
      {"name": "ORIDs", "default-cluster-id": 5, "cluster-ids": [5]
      },
      {"name": "ORole", "default-cluster-id": 3, "cluster-ids": [3],
        "properties": [
          {"name": "mode", "type": "BYTE", "mandatory": false, "not-null": false},
          {"name": "name", "type": "STRING", "mandatory": true, "not-null": true},
          {"name": "rules", "type": "EMBEDDEDMAP", "mandatory": false, "not-null": false, "linked-type": "BYTE"}
        ]
      },
      {"name": "OUser", "default-cluster-id": 4, "cluster-ids": [4],
        "properties": [
          {"name": "name", "type": "STRING", "mandatory": true, "not-null": true},
          {"name": "password", "type": "STRING", "mandatory": true, "not-null": true},
          {"name": "roles", "type": "LINKSET", "mandatory": false, "not-null": false, "linked-class": "ORole"}
        ]
      },
      {"name": "Order", "default-cluster-id": 36, "cluster-ids": [36]
      },
      {"name": "POST", "default-cluster-id": 37, "cluster-ids": [37],
        "properties": [
          {"name": "comments", "type": "LINKSET", "mandatory": false, "not-null": false, "linked-class": "COMMENT"}
        ]
      },
      {"name": "Person", "default-cluster-id": 35, "cluster-ids": [35]
      },
      {"name": "Person2", "default-cluster-id": 22, "cluster-ids": [22],
        "properties": [
          {"name": "age", "type": "INTEGER", "mandatory": false, "not-null": false},
          {"name": "firstName", "type": "STRING", "mandatory": false, "not-null": false},
          {"name": "lastName", "type": "STRING", "mandatory": false, "not-null": false}
        ]
      },
      {"name": "Profile", "default-cluster-id": 11, "cluster-ids": [11],
        "properties": [
          {"name": "hash", "type": "LONG", "mandatory": false, "not-null": false},
          {"name": "lastAccessOn", "type": "DATETIME", "mandatory": false, "not-null": false, "min": "2010-01-01 00:00:00"},
          {"name": "name", "type": "STRING", "mandatory": false, "not-null": false, "min": "3", "max": "30"},
          {"name": "nick", "type": "STRING", "mandatory": false, "not-null": false, "min": "3", "max": "30"},
          {"name": "photo", "type": "TRANSIENT", "mandatory": false, "not-null": false},
          {"name": "registeredOn", "type": "DATETIME", "mandatory": false, "not-null": false, "min": "2010-01-01 00:00:00"},
          {"name": "surname", "type": "STRING", "mandatory": false, "not-null": false, "min": "3", "max": "30"}
        ]
      },
      {"name": "PropertyIndexTestClass", "default-cluster-id": 21, "cluster-ids": [21],
        "properties": [
          {"name": "prop1", "type": "STRING", "mandatory": false, "not-null": false},
          {"name": "prop2", "type": "INTEGER", "mandatory": false, "not-null": false},
          {"name": "prop3", "type": "BOOLEAN", "mandatory": false, "not-null": false},
          {"name": "prop4", "type": "INTEGER", "mandatory": false, "not-null": false},
          {"name": "prop5", "type": "STRING", "mandatory": false, "not-null": false}
        ]
      },
      {"name": "SQLDropIndexTestClass", "default-cluster-id": 23, "cluster-ids": [23],
        "properties": [
          {"name": "prop1", "type": "DOUBLE", "mandatory": false, "not-null": false},
          {"name": "prop2", "type": "INTEGER", "mandatory": false, "not-null": false}
        ]
      },
      {"name": "SQLSelectCompositeIndexDirectSearchTestClass", "default-cluster-id": 24, "cluster-ids": [24],
        "properties": [
          {"name": "prop1", "type": "INTEGER", "mandatory": false, "not-null": false},
          {"name": "prop2", "type": "INTEGER", "mandatory": false, "not-null": false}
        ]
      },
      {"name": "TestClass", "default-cluster-id": 19, "cluster-ids": [19],
        "properties": [
          {"name": "name", "type": "STRING", "mandatory": false, "not-null": false},
          {"name": "testLink", "type": "LINK", "mandatory": false, "not-null": false, "linked-class": "TestLinkClass"}
        ]
      },
      {"name": "TestLinkClass", "default-cluster-id": 20, "cluster-ids": [20],
        "properties": [
          {"name": "testBoolean", "type": "BOOLEAN", "mandatory": false, "not-null": false},
          {"name": "testString", "type": "STRING", "mandatory": false, "not-null": false}
        ]
      },
      {"name": "Whiz", "default-cluster-id": 12, "cluster-ids": [12],
        "properties": [
          {"name": "account", "type": "LINK", "mandatory": false, "not-null": false, "linked-class": "Account"},
          {"name": "date", "type": "DATE", "mandatory": false, "not-null": false, "min": "2010-01-01"},
          {"name": "id", "type": "INTEGER", "mandatory": false, "not-null": false},
          {"name": "replyTo", "type": "LINK", "mandatory": false, "not-null": false, "linked-class": "Account"},
          {"name": "text", "type": "STRING", "mandatory": true, "not-null": false, "min": "1", "max": "140"}
        ]
      },
      {"name": "classclassIndexManagerTestClassTwo", "default-cluster-id": 25, "cluster-ids": [25]
      },
      {"name": "newV", "default-cluster-id": 31, "cluster-ids": [31], "super-class": "OGraphVertex",
        "properties": [
          {"name": "f_int", "type": "INTEGER", "mandatory": false, "not-null": false}
        ]
      },
      {"name": "vertexA", "default-cluster-id": 32, "cluster-ids": [32], "super-class": "OGraphVertex",
        "properties": [
          {"name": "name", "type": "STRING", "mandatory": false, "not-null": false}
        ]
      },
      {"name": "vertexB", "default-cluster-id": 34, "cluster-ids": [34], "super-class": "OGraphVertex",
        "properties": [
          {"name": "map", "type": "EMBEDDEDMAP", "mandatory": false, "not-null": false},
          {"name": "name", "type": "STRING", "mandatory": false, "not-null": false}
        ]
      }
    ]
  },
  "records": [{
          "@type": "d", "@rid": "#12:476", "@version": 0, "@class": "Whiz",
          "id": 476,
          "date": "2011-12-09 00:00:00:000",
          "text": "Los a went chip, of was returning cover, In the",
          "@fieldTypes": "date=t"
        },{
          "@type": "d", "@rid": "#12:477", "@version": 0, "@class": "Whiz",
          "id": 477,
          "date": "2011-12-09 00:00:00:000",
          "text": "He in office return He inside electronics for $500,000 Jay",
          "@fieldTypes": "date=t"
        }
  ]
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-12-11 SAM -->
<h1 id="import-from-rdbms"><a class="header" href="#import-from-rdbms">Import from RDBMS</a></h1>
<p><em>NOTE: As of OrientDB 2.0, you can use the <a href="https://github.com/orientechnologies/orientdb-etl/wiki/Import-from-DBMS">OrientDB-ETL module</a> to import data from an RDBMS. You can use ETL also with 1.7.x by installing it as a separate module.</em></p>
<p>OrientDB supports a subset of SQL, so importing a database created as "Relational" is straightforward. For the sake of simplicity, consider your Relational database having just these two tables:</p>
<ul>
<li>POST</li>
<li>COMMENT</li>
</ul>
<p>Where the relationship is between Post and comment as One-2-Many.</p>
<pre><code>TABLE POST:
+----+----------------+
| id | title          |
+----+----------------+
| 10 | NoSQL movement |
| 20 | New OrientDB   |
+----+----------------+

TABLE COMMENT:
+----+--------+--------------+
| id | postId | text         |
+----+--------+--------------+
|  0 |   10   | First        |
|  1 |   10   | Second       |
| 21 |   10   | Another      |
| 41 |   20   | First again  |
| 82 |   20   | Second Again |
+----+--------+--------------+
</code></pre>
<ul>
<li><a href="admin/Import-RDBMS-to-Document-Model.html">Import using the Document Model (relationships as links)</a></li>
<li><a href="admin/Import-RDBMS-to-Graph-Model.html">Import using the Graph Model (relationships as edges)</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="import-from-a-relational-database"><a class="header" href="#import-from-a-relational-database">Import from a Relational Database</a></h1>
<p>Relational databases typically query and manipulate data with SQL.  Given that OrientDB supports a subset of SQL, it is relatively straightforward to import data from a Relational databases to OrientDB.
You can manage imports using the Java API, <a href="admin/../studio/README.html">OrientDB Studio</a> or the <a href="admin/../console/README.html">OrientDB Console</a>.  The examples below use the Console.</p>
<blockquote>
<p>This guide covers importing into the Document Model.  Beginning with version 2.0, you can import into the Graph Model using the <a href="admin/../etl/Import-from-DBMS.html">ETL Module</a>.  From version 1.7.x you can still use ETL by installing it as a separate module</p>
</blockquote>
<p>For these examples, assume that your Relational database, (referred to as <code>reldb</code> in the code), contains two tables: <code>Post</code> and <code>Comment</code>.  The relationship between these tables is one-to-many.</p>
<pre>
reldb> <code class='lang-sql userinput'>SELECT * FROM post;</code>

+----+----------------+
| id | title          |
+----+----------------+
| 10 | NoSQL movement |
| 20 | New OrientDB   |
+----+----------------+


reldb> <code class='lang-sql userinput'>SELECT * FROM comment;</code>

+----+--------+--------------+
| id | postId | text         |
+----+--------+--------------+
|  0 |   10   | First        |
|  1 |   10   | Second       |
| 21 |   10   | Another      |
| 41 |   20   | First again  |
| 82 |   20   | Second Again |
+----+--------+--------------+
</pre>
<p>Given that the Relational Model doesn't use concepts from Object Oriented Programming, there are some things to consider in the transition from a Relational database to OrientDB.</p>
<ul>
<li>
<p>In Relational databases there is no concept of class, so in the import to OrientDB you need to create on class per table.</p>
</li>
<li>
<p>In Relational databases, one-to-many references invert from the target table to the source table.</p>
<pre><code>Table POST    &lt;- (foreign key) Table COMMENT
</code></pre>
<p>In OrientDB, it follows the Object Oriented Model, so you have a collection of <a href="admin/../datamodeling/Concepts.html#relationships">links</a> connecting instances of <code>Post</code> and <code>Comment</code>.</p>
<pre><code>Class POST -&gt;* (collection of links) Class COMMENT
</code></pre>
</li>
</ul>
<h2 id="exporting-relational-databases"><a class="header" href="#exporting-relational-databases">Exporting Relational Databases</a></h2>
<p>Most Relational database management systems provide a way to export the database into SQL format.  What you specifically need from this is a text file that contains the SQL <a href="admin/../sql/SQL-Insert.html"><code>INSERT</code></a> commands to recreate the database from scratch.  For example,</p>
<ul>
<li>MySQL: the <a href="https://dev.mysql.com/doc/refman/5.6/en/mysqldump.html"><code>mysqldump</code></a> utility.</li>
<li>Oracle Database: the <a href="http://www.orafaq.com/wiki/Data_Pump">Datapump</a> utilities.</li>
<li>Microsoft SQL Server: the <a href="https://msdn.microsoft.com/en-us/library/ms141209.aspx">Import and Export Wizard</a>.</li>
</ul>
<p>When you run this utility on the example database, it produces an <code>.sql</code> file that contains the exported SQL of the Relational database.</p>
<pre><code class="language-sql">DROP TABLE IF EXISTS post;
CREATE TABLE post (
id INT(11) NOT NULL AUTO_INCREMENT,
title VARCHAR(128),
PRIMARY KEY (id)
);

DROP TABLE IF EXISTS comment;
CREATE TABLE comment (
id INT(11) NOT NULL AUTO_INCREMENT,
postId INT(11),
text TEXT,
PRIMARY KEY (id),
CONSTRAINT `fk_comments`
    FOREIGN KEY (`postId` )
    REFERENCES `post` (`id` )
);

INSERT INTO POST (id, title) VALUES( 10, 'NoSQL movement' );
INSERT INTO POST (id, title) VALUES( 20, 'New OrientDB' );

INSERT INTO COMMENT (id, postId, text) VALUES( 0, 10, 'First' );
INSERT INTO COMMENT (id, postId, text) VALUES( 1, 10, 'Second' );
INSERT INTO COMMENT (id, postId, text) VALUES( 21, 10, 'Another' );
INSERT INTO COMMENT (id, postId, text) VALUES( 41, 20, 'First again' );
INSERT INTO COMMENT (id, postId, text) VALUES( 82, 20, 'Second Again' );
</code></pre>
<h2 id="modifying-the-export-file"><a class="header" href="#modifying-the-export-file">Modifying the Export File</a></h2>
<p>Importing from the Relational database requires that you modify the SQL file to make it usable by OrientDB.  In order to do this, you need to open the SQL file, (called <code>export.sql</code> below), in a text editor and modify the commands there.  Once this is done, you can execute the file on the Console using batch mode.</p>
<h3 id="database-1"><a class="header" href="#database-1">Database</a></h3>
<p>In order to import a data into OrientDB, you need to have a database ready to receive the import.  Note that the example <code>export.sql</code> file doesn't include statements to create the database.  You can either create a new database or use an existing one.</p>
<h4 id="using-new-databases"><a class="header" href="#using-new-databases">Using New Databases</a></h4>
<p>In creating a database for the import, you can either create a volatile in-memory database, (one that is only available while OrientDB is running), or you can create a persistent disk-based database.  For a persistent database, you can create it on a remote server or locally through the PLocal mode.</p>
<p>The recommended method is PLocal, given that it offers better performance on massive inserts.</p>
<ul>
<li>
<p>Using the embedded Plocal mode:</p>
<pre>
$ <code class="lang-sh userinput">vim export.sql</code>
<code class="lang-sql userinput">
CREATE DATABASE PLOCAL:/tmp/db/blog admin_user admin_passwd PLOCAL DOCUMENT
</code></pre>
<p>Here, the <a href="admin/../console/Console-Command-Create-Database.html"><code>CREATE DATABASE</code></a> command creates a new database at <code>/tmp/db/blog</code>.</p>
</li>
<li>
<p>Using the Remote mode:</p>
<pre>
$ <code class="lang-sh userinput">vim export.sql</code>
<code class="lang-sql userinput">
CREATE DATABASE REMOTE:localhost/blog root_user dkdf383dhdsj PLOCAL DOCUMENT
</code></pre>
<p>This creates a database at the URL <code>http://localhost/blog</code>.</p>
</li>
</ul>
<blockquote>
<p><strong>NOTE</strong>: When you create remote databases, you need the server credentials to access it.  The user <code>root</code> and its password are stored in the <code>$ORIENTDB_HOME/config/orientdb-server-config.xml</code> configuration file.</p>
</blockquote>
<h4 id="using-existing-databases"><a class="header" href="#using-existing-databases">Using Existing Databases</a></h4>
<p>In the event that you already have a database set up and ready for the import, instead of creating a database add a line that connects to that databases, using the <a href="admin/../console/Console-Command-Connect.html"><code>CONNECT</code></a> command.</p>
<ul>
<li>
<p>Using the embedded PLocal mode:</p>
<pre>
$ <code class="lang-sh userinput">vim export.sh</code>
<code class="lang-sql userinput">
CONNECT PLOCAL:/tmp/db/blog admin_user admin_passwd
</code></pre>
<p>This connects to the database at <code>/tmp/db/blog</code>.</p>
</li>
<li>
<p>Using the Remote mode:</p>
<pre>
$ <code class="lang-sh userinput">vim export.sql</code>
<code class="lang-sql userinput">
CONNECT REMOTE:localhost/blog admin_user admin_passwd
</code></pre>
<p>This connects to the database at the URL <code>http://localhost/blog</code>.</p>
</li>
</ul>
<h3 id="declaring-intent"><a class="header" href="#declaring-intent">Declaring Intent</a></h3>
<p>In the SQL file, after you create or connect to the database, you need to declare your intention to perform a massive insert.  Intents allow you to utilize automatic tuning OrientDB for maximum performance on particular operations, such as large inserts or reads.</p>
<pre>
$ <code class="lang-sh userinput">vim export.sh</code>
...<code class="lang-sql userinput">
DECLARE INTENT MASSIVEINSERT
</code></pre>
<h3 id="creating-classes"><a class="header" href="#creating-classes">Creating Classes</a></h3>
<p>Relational databases have no parallel to concepts in Object Oriented programming, such as classes.  Conversely, OrientDB doesn't have a concept of tables in the Relational sense.</p>
<p>Modify the SQL file, changing <code>CREATE TABLE</code> statements to <a href="admin/../sql/SQL-Create-Class.html"><code>CREATE CLASS</code></a> commands:</p>
<pre>
$ <code class="lang-sql userinput">vim export.sql</code>
...<code class="lang-sql userinput">
CREATE CLASS Post
CREATE CLASS Comment
</code></pre>
<blockquote>
<p><strong>NOTE</strong>: In cases where your Relational database was created using Object Relational Mapping, or ORM, tools, such as  <a href="http://www.hibernate.org">Hibernate</a> or <a href="http://www.datanucleus.org">Data Nucleus</a>, you have to rebuild the original Object Oriented Structure directly in OrientDB.</p>
</blockquote>
<h3 id="create-links"><a class="header" href="#create-links">Create Links</a></h3>
<p>In the Relational database, the relationship between the <code>post</code> and <code>comment</code> was handled through foreign keys on the <code>id</code> fields.  OrientDB handles relationships differently, using links between two or more records of the Document type.</p>
<p>By default, the <a href="admin/../sql/SQL-Create-Link.html"><code>CREATE LINK</code></a> command creates a direct relationship in your object model. Navigation goes from <code>Post</code> to <code>Comment</code> and not vice versa, which is the case for the Relational database.  You'll need to use the <code>INVERSE</code> keyword to make the links work in both directions.</p>
<p>Add the following line after the <a href="admin/../sql/SQL-Insert.html"><code>INSERT</code></a> statements.</p>
<pre>
$ <code class="lang-sh userinput">vim export.sql</code>
...<code class="lang-sql userinput">
CREATE LINK comments TYPE LINKSET FROM comment.postId TO post.id INVERSE
</code></pre>
<h3 id="remove-constraints"><a class="header" href="#remove-constraints">Remove Constraints</a></h3>
<p>Unlike how Relational databases handle tables, OrientDB does not require you to create a strict schema on your classes.  The properties on each class are defined through the <a href="admin/../sql/SQL-Insert.html"><code>INSERT</code></a> statements.  That is, <code>id</code> and <code>title</code> on <code>Post</code> and <code>id</code>, <code>postId</code> and <code>text</code> on <code>Comment</code>.</p>
<p>Given that you created a link in the above section, the property <code>postId</code> is no longer necessary.  Instead of modifying each <a href="admin/../sql/SQL-Insert.html"><code>INSERT</code></a> statement, you can use the <a href="admin/../sql/SQL-Update.html"><code>UPDATE</code></a> command to remove them at the end:</p>
<pre>
$ <code class="lang-sh userinput">vim export.sql</code>
...<code class="lang-sql userinput">
UPDATE comment REMOVE postId
</code></pre>
<p>Bear in mind, this is an optional step.  The database will still function if you leave this field in place.</p>
<h3 id="expected-output"><a class="header" href="#expected-output">Expected Output</a></h3>
<p>When you've finished, remove any statements that OrientDB does not support.  With the changes above this leaves you with a file similar to the one below:</p>
<pre>
$ <code class="lang-sh userinput">cat export.sql</code>

CONNECT plocal:/tmp/db/blog admin admin

DECLARE INTENT MASSIVEINSERT

CREATE CLASS Post
CREATE CLASS Comment

INSERT INTO Post (id, title) VALUES( 10, 'NoSQL movement' )
INSERT INTO Post (id, title) VALUES( 20, 'New OrientDB' )

INSERT INTO Comment (id, postId, text) VALUES( 0, 10, 'First' )
INSERT INTO Comment (id, postId, text) VALUES( 1, 10, 'Second' )
INSERT INTO Comment (id, postId, text) VALUES( 21, 10, 'Another' )
INSERT INTO Comment (id, postId, text) VALUES( 41, 20, 'First again' )
INSERT INTO Comment (id, postId, text) VALUES( 82, 20, 'Second Again' )

CREATE LINK comments TYPE LINKSET FROM Comment.postId TO Post.id INVERSE
UPDATE Comment REMOVE postId
</pre>
<h2 id="importing-databases-1"><a class="header" href="#importing-databases-1">Importing Databases</a></h2>
<p>When you finish modifying the SQL file, you can execute it through the Console in batch mode.  This is done by starting the Console with the SQL file given as the first argument.</p>
<pre>
$ <code class="lang-sql userinput">$ORIENTDB_HOME/bin/console.sh export.sql</code>
</pre>
<p>When the OrientDB starts, it executes each of the commands given in the SQL files, creating or connecting to the database, creating the classes and inserting the data from the Relational database.  You now have a working instance of OrientDB to use.</p>
<h3 id="using-the-database"><a class="header" href="#using-the-database">Using the Database</a></h3>
<p>You now have an OrientDB Document database where relationships are direct and handled without the use of joins.</p>
<ul>
<li>
<p>Query for all posts with comments:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM Post WHERE comments.size() > 0</code>
</pre>
</li>
<li>
<p>Query for all posts where the comments contain the word "flame" in the <code>text</code> property:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM Post WHERE comments CONTAINS(text 
          LIKE '%flame%')</code>
</pre>
</li>
<li>
<p>Query for all posts with comments made today, assuming that you have added a <code>date</code> property to the <code>Comment</code> class:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM Post WHERE comments CONTAINS(date > 
          '2011-04-14 00:00:00')</code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="admin/../sql/SQL-Commands.html">SQL Commands</a></li>
<li><a href="admin/../console/Console-Commands.html">Console-Commands</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="import-from-rdbms-to-graph-model"><a class="header" href="#import-from-rdbms-to-graph-model">Import from RDBMS to Graph Model</a></h1>
<p>To import from RDBMS to OrientDB using the Graph Model the ETL tool is the suggested way to do it. Take a look at: <a href="http://www.orientechnologies.com/docs/last/orientdb-etl.wiki/Import-from-CSV-to-a-Graph.html">Import from CSV to a Graph</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="import-from-neo4j"><a class="header" href="#import-from-neo4j">Import from Neo4j</a></h1>
<p>Neo4j is an open-source graph database that queries and manipulates data using its own Cypher Query Language.</p>
<blockquote>
<p>For more information on the differences between Neo4j and OrientDB, please refer to the <a href="http://orientdb.com/orientdb-vs-neo4j/">OrientDB vs. Neo4j</a> page.</p>
</blockquote>
<blockquote>
<p>Neo4j and Cypher are registered trademark of Neo Technology, Inc.</p>
</blockquote>
<h2 id="migration-strategies"><a class="header" href="#migration-strategies">Migration Strategies</a></h2>
<p>Importing data from Neo4j into OrientDB is a straightforward process.</p>
<p>To migrate, you may use the <em>Neo4j to OrientDB Importer</em>. Starting from OrientDB version 2.2, this is the preferred way to migrate from Neo4j.</p>
<p>The <em>Neo4j to OrientDB Importer</em> allows you to migrate Neo4j's nodes, relationships, constraints and indexes. For more details, please refer to the <a href="admin/../neo4j-to-orientdb-importer/README.html">Neo4j to OrientDB Importer</a> Section.</p>
<p><strong>Note:</strong> if your data is in CSV format, you can migrate to OrientDB using the <a href="admin/../etl/ETL-Introduction.html">OrientDB's ETL</a> tool.</p>
<div style="break-before: page; page-break-before: always;"></div><div class="table-wrapper"><table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td><img src="admin/../images/warning.png" alt="" /></td><td>This is a legacy strategy to migrate from Neo4j. The new strategy is to migrate using the <a href="admin/../neo4j-to-orientdb-importer/README.html">Neo4j to OrientDB Importer</a>.</td></tr>
</tbody></table>
</div>
<h1 id="import-from-neo4j-using-graphml"><a class="header" href="#import-from-neo4j-using-graphml">Import from Neo4j using GraphML</a></h1>
<p>This section describes the process of importing data from Neo4j to OrientDB using GraphML. For general information on the possible Neo4j to OrientDB migration strategies, please refer to the <a href="admin/Import-from-Neo4j-into-OrientDB.html">Import from Neo4j</a> section.</p>
<p>Neo4j can export in GraphML, an XML-based file format for graphs. Given that OrientDB can read GraphML, you can use this file format to import data from Neo4j into OrientDB, using the Console or the Java API.</p>
<p><strong>Note:</strong></p>
<blockquote>
<p>For large and complex datasets, the preferred way to migrate from Neo4j is using the <a href="admin/../neo4j-to-orientdb-importer/README.html">Neo4j to OrientDB Importer</a>.</p>
</blockquote>
<blockquote>
<p>Neo4j and Cypher are registered trademark of Neo Technology, Inc.</p>
</blockquote>
<h2 id="exporting-graphml"><a class="header" href="#exporting-graphml">Exporting GraphML</a></h2>
<p>In order to export data from Neo4j into GraphML, you need to install the <a href="https://github.com/jexp/neo4j-shell-tools">Neo4j Shell Tools</a> plugin.  Once you have this package installed, you can use the <code>export-graphml</code> utility to export the database.</p>
<ol>
<li>
<p>Change into the Neo4j home directory:</p>
<pre>
$ <code class="lang-sql userinput">cd /path/to/neo4j-community-2.3.2</code>
</pre>
</li>
<li>
<p>Download the Neo4j Shell Tools:</p>
<pre>
$ <code class="lang-sh userinput">curl http://dist.neo4j.org/jexp/shell/neo4j-shell-tools_2.3.2.zip \
      -o neo4j-shell-tools.zip</code>
</pre>
</li>
<li>
<p>Unzip the <code>neo4j-shell-tools.zip</code> file into the <code>lib</code> directory:</p>
<pre>
$ <code class="lang-sh userinput">unzip neo4j-shell-tools.zip -d lib</code>
</pre>
</li>
<li>
<p>Restart the Neo4j Server.  In the event that it's not running, <code>start</code> it:</p>
<pre>
$ <code class="lang-sh userinput">./bin/neo4j restart</code>
</pre>
</li>
<li>
<p>Once you have Neo4j restarted with the Neo4j Shell Tools, launch the <a href="http://docs.neo4j.org/chunked/stable/shell.html">Neo4j Shell</a> tool, located in the <code>bin/</code> directory:</p>
<pre>
$ <code class="lang-sh userinput">./bin/neo4j-shell</code>
Welcome to the Neo4j Shell! Enter 'help' for a list of commands
NOTE: Remote Neo4j graph database service 'shell' at port 1337

neo4j-sh (0)$
</pre>
</li>
<li>
<p>Export the database into GraphML:</p>
<pre>
neo4j-sh (0)$ <code class="lang-sh userinput">export-graphml -t -o /tmp/out.graphml</code>
Wrote to GraphML-file /tmp/out.graphml 0. 100%: nodes = 302 rels = 834
properties = 4221 time 59 sec total 59 sec
</pre>
</li>
</ol>
<p>This exports the database to the path <code>/tmp/out.graphml</code>.</p>
<h2 id="importing-graphml"><a class="header" href="#importing-graphml">Importing GraphML</a></h2>
<p>There are three methods available in importing the GraphML file into OrientDB: through the Console, through Gremlin or through the Java API.</p>
<h3 id="importing-through-the-orientdb-console"><a class="header" href="#importing-through-the-orientdb-console">Importing through the OrientDB Console</a></h3>
<p>For more recent versions of OrientDB, you can import data from GraphML through the OrientDB Console.  If you have version 2.0 or greater, this is the recommended method given that it can automatically translate the Neo4j labels into classes.</p>
<ol>
<li>
<p>Log into the OrientDB Console.</p>
<pre>
$ <code class="lang-sh userinput">$ORIENTDB_HOME/bin/console.sh</code>
</pre>
</li>
<li>
<p>In OrientDB, create a database to receive the import:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE DATABASE PLOCAL:/tmp/db/test</code>
Creating database [plocal:/tmp/db/test] using the storage type [plocal]...
Database created successfully.

Current database is: plocal:/tmp/db/test
</pre>
</li>
<li>
<p>Import the data from the GraphML file:</p>
<pre>
orientdb {db=test}> <code class="lang-sql userinput">IMPORT DATABASE /tmp/out.graphml</code>

Importing GRAPHML database database from /tmp/out.graphml...
Transaction 8 has been committed in 12ms
</pre>
</li>
</ol>
<p>This imports the Neo4j database into OrientDB on the <code>test</code> database.</p>
<h3 id="importing-through-the-gremlin-console"><a class="header" href="#importing-through-the-gremlin-console">Importing through the Gremlin Console</a></h3>
<p>For older versions of OrientDB, you can import data from GraphML through the Gremlin Console.  If you have a version 1.7 or earlier, this is the method to use.  It is not recommended on more recent versions, given that it doesn't consider labels declared in Neo4j.  In this case, everything imports as the base vertex and edge classes, (that is, <code>V</code> and <code>E</code>).  This means that, after importing through Gremlin you need to refactor you graph elements to fit a more structured schema.</p>
<p>To import the GraphML file into OrientDB, complete the following steps:</p>
<ol>
<li>
<p>Launch the Gremlin Console:</p>
<pre>
$ <code class="lang-sh userinput">$ORIENTDB_HOME/bin/gremlin.sh</code>

         \,,,/
         (o o)
-----oOOo-(_)-oOOo-----
</pre>
</li>
<li>
<p>From the Gremlin Console, create a new graph, specifying the path to your Graph database, (here <code>/tmp/db/test</code>):</p>
<pre>
gremlin> <code class="lang-js userinput">g = new OrientGraph("plocal:/tmp/db/test");</code>
==>orientgraph[plocal:/db/test]
</pre>
</li>
<li>
<p>Load the GraphML file into the graph object (that is, <code>g</code>):</p>
<pre>
gremlin> <code class="lang-js userinput">g.loadGraphML("/tmp/out.graphml");</code>
==>null
</pre>
</li>
<li>
<p>Exit the Gremlin Console:</p>
<pre>
gremlin> <code class="lang-js userinput">quit</code>
</pre>
</li>
</ol>
<p>This imports the GraphML file into your OrientDB database.</p>
<h3 id="importing-through-the-java-api"><a class="header" href="#importing-through-the-java-api">Importing through the Java API</a></h3>
<p>OrientDB Console calls the Java API.  Using the Java API directly allows you greater control over the import process.  For instance,</p>
<pre><code class="language-java">new OGraphMLReader(new OrientGraph("plocal:/temp/bettergraph")).inputGraph("/temp/neo4j.graphml");
</code></pre>
<p>This line imports the GraphML file into OrientDB.</p>
<h4 id="defining-custom-strategies"><a class="header" href="#defining-custom-strategies">Defining Custom Strategies</a></h4>
<p>Beginning in version 2.1, OrientDB allows you to modify the import process through custom strategies for vertex and edge attributes.  It supports the following strategies:</p>
<ul>
<li><code>com.orientechnologies.orient.graph.graphml.OIgnoreGraphMLImportStrategy</code>
Defines attributes to ignore.</li>
<li><code>com.orientechnologies.orient.graph.graphml.ORenameGraphMLImportStrategy</code> Defines attributes to rename.</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Ignore the vertex attribute <code>type</code>:</p>
<pre><code class="language-java">new OGraphMLReader(new OrientGraph("plocal:/temp/bettergraph")).defineVertexAttributeStrategy("__type__", new OIgnoreGraphMLImportStrategy()).inputGraph("/temp/neo4j.graphml");
</code></pre>
</li>
<li>
<p>Ignore the edge attribute <code>weight</code>:</p>
<pre><code class="language-java">new OGraphMLReader(new OrientGraph("plocal:/temp/bettergraph")).defineEdgeAttributeStrategy("weight", new OIgnoreGraphMLImportStrategy()).inputGraph("/temp/neo4j.graphml");
</code></pre>
</li>
<li>
<p>Rename the vertex attribute <code>type</code> in just <code>type</code>:</p>
<pre><code class="language-java">new OGraphMLReader(new OrientGraph("plocal:/temp/bettergraph")).defineVertexAttributeStrategy("__type__", new ORenameGraphMLImportStrategy("type")).inputGraph("/temp/neo4j.graphml");
</code></pre>
</li>
</ul>
<h2 id="import-tips-and-tricks"><a class="header" href="#import-tips-and-tricks">Import Tips and Tricks</a></h2>
<h3 id="dealing-with-memory-issues"><a class="header" href="#dealing-with-memory-issues">Dealing with Memory Issues</a></h3>
<p>In the event that you experience memory issues while attempting to import from Neo4j, you might consider reducing the batch size.  By default, the batch size is set to <code>1000</code>.  Smaller value causes OrientDB to process the import in smaller units.</p>
<ul>
<li>
<p>Import with adjusted batch size through the Console:</p>
<pre>
orientdb {db=test}> <code class="lang-sql userinput">IMPORT DATABASE /tmp/out.graphml batchSize=100</code>
</pre>
</li>
<li>
<p>Import with adjusted batch size through the Java API:</p>
<pre><code class="language-java">new OGraphMLReader(new OrientGraph("plocal:/temp/bettergraph")).setBatchSize(100).inputGraph("/temp/neo4j.graphml");
</code></pre>
</li>
</ul>
<h3 id="storing-the-vertex-ids"><a class="header" href="#storing-the-vertex-ids">Storing the Vertex ID's</a></h3>
<p>By default, OrientDB updates the import to use its own ID's for vertices.  If you want to preserve the original vertex ID's from Neo4j, use the <code>storeVertexIds</code> option.</p>
<ul>
<li>
<p>Import with the original vertex ID's through the Console:</p>
<pre>
orientdb {db=test}> <code class="lang-sql userinput">IMPORT DATABASE /tmp/out.graphml storeVertexIds=true</code>
</pre>
</li>
<li>
<p>Import with the original vertex ID's through the Java API:</p>
<pre><code class="language-java">new OGraphMLReader(new OrientGraph("plocal:/temp/bettergraph")).setStoreVertexIds(true).inputGraph("/temp/neo4j.graphml");
</code></pre>
</li>
</ul>
<h2 id="example"><a class="header" href="#example">Example</a></h2>
<p>A complete example of a migration from Neo4j to OrientDB using the GraphML  method can be found in the section <a href="admin/../gettingstarted/tutorials/Tutorial-Importing-the-Movie-Database-from-Neo4j.html">Tutorial: Importing the <em>movie</em> Database from Neo4j</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="monitoring"><a class="header" href="#monitoring">Monitoring</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="jmx"><a class="header" href="#jmx">JMX</a></h1>
<h2 id="read-cache"><a class="header" href="#read-cache">Read Cache</a></h2>
<p>JMX bean name: <code>com.orientechnologies.orient.core.storage.cache.local:type=O2QCacheMXBean</code></p>
<p>It has following members:</p>
<ul>
<li><code>usedMemory</code>, <code>usedMemoryInMB</code>, <code>usedMemoryInGB</code> which is amount of direct memory consumed by read cache in different units of measurements</li>
<li><code>cacheHits</code> is percent of cases when records will be downloaded not from disk but from read cache</li>
<li><code>clearCacheStatistics()</code> method may be called to clear cache hits statics so we always may start to gather cache hits statistic from any moment of time</li>
<li><code>amSize</code> ,  <code>a1OutSize</code>, <code>a1InSize</code> is the size of LRU queues are used in 2Q algorithm</li>
</ul>
<h2 id="write-cache"><a class="header" href="#write-cache">Write Cache</a></h2>
<p>JMX bean name: <code>com.orientechnologies.orient.core.storage.cache.local:type=OWOWCacheMXBean,name=&lt;storage name&gt;,id=&lt;storage id&gt;</code></p>
<p>Write cache alike read cache is not JVM wide, it is storage wide, but one JVM may run several servers and each server may contain storage with the same name, that is why we need such complex name.</p>
<p>JMX bean of write cache has following members:</p>
<ul>
<li><code>writeCacheSize</code>, <code>writeCacheSizeInMB</code>, <code>writeCacheSizeInGB</code> provides size of data in different units which should be flushed to disk in background thread</li>
<li><code>exclusiveWriteCacheSize</code> , <code>exclusiveWriteCacheSizeInMB</code>, <code>exclusiveWriteCacheSizeInGB</code> provides size of data which should be flushed to disk but contained only in write cache</li>
</ul>
<h1 id="more-about-memory-model-and-data-flow"><a class="header" href="#more-about-memory-model-and-data-flow">More about memory model and data flow</a></h1>
<p>At first when we read page we load it from disk and put it in read cache.
Then we change page and put it back to read cache and write cache,  but we do not copy page from read to write cache we merely send pointer to the same memory to write cache. Write cache flushes "dirty write page" in background thread. That is what property "writeCacheSize" shows us amount of data in dirty pages which should be flushed. But there are very rare situations when page which is rarely used still is not flushed on disk and read cache has not enough memory to keep it. In such case this page is removed from read cache , but pointer to this page still exists in write cache, that is what property "exclusiveWriteCacheSize" shows us. Please note that this value is more than 0 only during extremely high load.</p>
<p>The rest properties of write cache JMX bean are following:</p>
<ul>
<li><code>lastFuzzyCheckpointDate</code></li>
<li><code>lastAmountOfFlushedPages</code></li>
<li><code>durationOfLastFlush</code></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><p>#Tools</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-to-orientdb-studio"><a class="header" href="#introduction-to-orientdb-studio">Introduction to OrientDB Studio</a></h1>
<p>People have different preferences to how they would like to interact with a database.  Some prefer to work through an application, some through an API, some a console.  OrientDB <em>Studio</em> is for those who are most comfortable operating on databases through a graphical user interface.</p>
<p>When you start the OrientDB Server, the JVM also runs Studio on port 2480.  Running OrientDB on your local system, you can access it through the web browser by navigating to <a href="http://localhost:2480">http://localhost:2480</a>.  To access Studio on a remote machine, you may want to use an SSH tunnel for better security.</p>
<p><img src="studio/../images/studio/studio-login.png" alt="Home Page" /></p>
<p>From the Studio Home Page, you can:</p>
<ul>
<li><a href="studio/working-with-databases/Studio-Common-Database-Operations.html#connecting-to-an-existing-database">Connect</a> to an existing database</li>
<li><a href="studio/working-with-databases/Studio-Common-Database-Operations.html#creating-a-new-database">Create</a> a new database</li>
<li><a href="studio/working-with-databases/Studio-Common-Database-Operations.html#importing-a-public-database">Import</a> a public (OrientDB) database</li>
<li><a href="studio/working-with-databases/Studio-Common-Database-Operations.html#dropping-an-existing-database">Drop</a> an existing database</li>
<li><a href="studio/backups-imports-exports/Studio-Teleporter.html">Start a migration</a> to OrientDB using the tool Teleporter</li>
<li>Access the <a href="studio/server-management/README.html">Server Management</a> features</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="overview-of-menus-and-panels"><a class="header" href="#overview-of-menus-and-panels">Overview of Menus and Panels</a></h1>
<p>This Section contains a list of all <em>Studio</em>'s menu and a quick map between the menu and the corresponding <em>panel</em> in the program.</p>
<h2 id="horizontal-menus"><a class="header" href="#horizontal-menus">Horizontal Menus</a></h2>
<h3 id="browse"><a class="header" href="#browse">Browse</a></h3>
<p>If you click on the <em>Browse</em> menu the <a href="studio/menus-panels/../working-with-data/browse/README.html"><em>Browse</em></a> panel will be shown.</p>
<p>The <em>Browse</em> panel includes an SQL query editor from which you can execute (and run the explain of) a query.
Query results can be visualized in a <em>table</em> or <em>JSON</em> format. In case the executed query returns an editable recordset, you will be able to edit your data.</p>
<p>From this panel, returned recordsets can be sent to the <a href="studio/menus-panels/../working-with-data/graph-editor/README.html">Graph Editor</a> to see their graph visualization.</p>
<p>See Also:</p>
<ul>
<li><a href="studio/menus-panels/../working-with-data/README.html">Working with Data</a></li>
</ul>
<h3 id="schema-1"><a class="header" href="#schema-1">Schema</a></h3>
<p>If you click on the <em>Schema</em> menu the <a href="studio/menus-panels/../working-with-schemas/Studio-Schema-Manager.html"><em>Schema Manager</em></a> will be shown.</p>
<p>The <em>Schema Manager</em> includes a lists of all Classes and Indexes of in the current database, and allows you create, edit or drop Classes, their Properties, and Indexes.</p>
<p>See Also:</p>
<ul>
<li><a href="studio/menus-panels/../working-with-schemas/README.html">Working with Schemas</a></li>
</ul>
<h3 id="security-2"><a class="header" href="#security-2">Security</a></h3>
<p>If you click on the <em>Security</em> menu the <a href="studio/menus-panels/../working-with-users-roles/Studio-Security-Manager.html"><em>Security Manager</em></a> will be shown.</p>
<p>The <em>Security Manager</em> includes a lists of all Users and Roles of in the current database, and allows you create, edit or drop Users and Roles.</p>
<p>See Also:</p>
<ul>
<li><a href="studio/menus-panels/../working-with-users-roles/REAME.html">Working with Users and Roles</a></li>
</ul>
<h3 id="graph"><a class="header" href="#graph">Graph</a></h3>
<p>If you click on the <em>Graph</em> menu the <a href="studio/menus-panels/../working-with-data/graph-editor/README.html"><em>Graph Editor</em></a> will be shown.</p>
<p>The <em>Graph Editor</em> includes an SQL query editor from which you can execute a query to visualize a graph. It also allows you to modify a graph, by adding new vertices, edges and setting their properties.</p>
<p>See Also:</p>
<ul>
<li><a href="studio/menus-panels/../working-with-data/README.html">Working with Data</a></li>
</ul>
<h3 id="functions-2"><a class="header" href="#functions-2">Functions</a></h3>
<p>If you click on the <em>Function</em> menu the <a href="studio/menus-panels/../working-with-functions/Studio-Functions.html"><em>Function Management</em></a> panel will be shown.</p>
<p>The <em>Function Management</em> panel allows you to create, edit and drop functions.</p>
<p>See Also:</p>
<ul>
<li><a href="studio/menus-panels/../working-with-functions/README.html">Working with Functions</a></li>
</ul>
<h3 id="db-1"><a class="header" href="#db-1">DB</a></h3>
<p>If you click on the <em>DB</em> menu the <a href="studio/menus-panels/../working-with-databases/Studio-Database-Management.html"><em>Database Management</em></a> panel will be shown.</p>
<p>The <em>Database Management</em> panel includes several (structure and metadata) information about the current database. It also allows you to export the current database in JSON format.</p>
<p>See Also:</p>
<ul>
<li><a href="studio/menus-panels/../working-with-functions/README.html">Working with Functions</a></li>
<li><a href="studio/menus-panels/../backups-imports-exports/README.html">Backups, Imports and Exports</a></li>
</ul>
<h2 id="vertical-menus"><a class="header" href="#vertical-menus">Vertical Menus</a></h2>
<h3 id="dashboard"><a class="header" href="#dashboard">Dashboard</a></h3>
<h3 id="servers-management"><a class="header" href="#servers-management">Servers Management</a></h3>
<h3 id="cluster-management"><a class="header" href="#cluster-management">Cluster Management</a></h3>
<h3 id="backup-management"><a class="header" href="#backup-management">Backup Management</a></h3>
<h3 id="query-profiler"><a class="header" href="#query-profiler">Query Profiler</a></h3>
<h3 id="security-3"><a class="header" href="#security-3">Security</a></h3>
<h3 id="teleporter"><a class="header" href="#teleporter">Teleporter</a></h3>
<h3 id="alerts-management"><a class="header" href="#alerts-management">Alerts Management</a></h3>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="common-database-operations"><a class="header" href="#common-database-operations">Common Database Operations</a></h1>
<h2 id="connecting-to-an-existing-database"><a class="header" href="#connecting-to-an-existing-database">Connecting to an Existing Database</a></h2>
<p>To connect to an existing database, select a database from the databases list and use a valid <em>database</em> user.</p>
<p>By default <strong>reader/reader</strong> can read records from the database, <strong>writer/writer</strong> can read, create, update and delete records. <strong>admin/admin</strong> has all rights.</p>
<h2 id="creating-a-new-database"><a class="header" href="#creating-a-new-database">Creating a New Database</a></h2>
<p>To create a new database, click the "New DB" button from the Home Page:</p>
<p><img src="studio/working-with-databases/../../images/studio-newDb.png" alt="Home Page" /></p>
<p>Some information is needed to create a new database:</p>
<ul>
<li>Database name</li>
<li>Database type (Document/Graph)</li>
<li>Storage type (plocal/memory)</li>
<li><em>Server</em> user</li>
<li><em>Server</em> password</li>
</ul>
<p>You can find the server credentials in the
$ORIENTDB_HOME/config/orientdb-server-config.xml file:</p>
<pre><code>&lt;users&gt;
  &lt;user name="root" password="pwd" resources="*" /&gt;
&lt;/users&gt;
</code></pre>
<p>Once created, Studio will automatically login to the new database.</p>
<h2 id="importing-a-public-database"><a class="header" href="#importing-a-public-database">Importing a Public Database</a></h2>
<p>Starting from version 2.2, Studio allows you to import databases from a public repository.
These databases contain public data and bookmarked queries that will allow you to start
playing with OrientDB and OrientDB SQL.</p>
<p><img src="studio/working-with-databases/../../images/studio-importPublic.png" alt="Home Page" /></p>
<p>To install a public database, you will need the Server Credentials.
Then, click the download button of the database that you are interested in.
Then Studio will download and install in to your $ORIENTDB_HOME/databases directory.
Once finished, Studio will automatically login to the newly installed database.</p>
<h2 id="dropping-an-existing-database"><a class="header" href="#dropping-an-existing-database">Dropping an Existing Database</a></h2>
<p>To drop an existing database, select it from the databases list and click the trash icon.
Studio will display a confirmation popup where you have to insert:</p>
<ul>
<li><em>Server</em> User</li>
<li><em>Server</em> Password</li>
</ul>
<p>and then click the "Drop database" button.
You can find the server credentials in the
$ORIENTDB_HOME/config/orientdb-server-config.xml file:</p>
<pre><code>&lt;users&gt;
  &lt;user name="root" password="pwd" resources="*" /&gt;
&lt;/users&gt;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><hr />
<h2>search:
keywords: ['Studio', 'database', 'Database Management']</h2>
<h1 id="database-management-panel"><a class="header" href="#database-management-panel"><em>Database Management</em> Panel</a></h1>
<p>This is the panel containing all the information about the current database.</p>
<p>#Structure
Represents the database structure as clusters. Each cluster has the following information:</p>
<ul>
<li><code>ID</code>, is the cluster ID</li>
<li><code>Name</code>, is the name of the cluster</li>
<li><code>Records</code>, are the total number of records stored in the cluster</li>
<li><code>Conflict Strategy</code>, is the conflict strategy used. I empty, the database's strategy is used as default</li>
</ul>
<p><img src="studio/working-with-databases/../../images/structure.png" alt="Structure" /></p>
<p>##Configuration</p>
<p>Contains the database configuration and custom properties. Here you can display and change the following settings:</p>
<ul>
<li><code>dateFormat</code>, is the <a href="studio/working-with-databases/../../general/Managing-Dates.html">date format</a> used in the database by default. Example: yyyy-MM-dd</li>
<li><code>dateTimeFormat</code> is the <a href="studio/working-with-databases/../../general/Managing-Dates.html">datetime format</a> used in the database by default. Example: yyyy-MM-dd HH:mm:ss</li>
<li><code>localeCountry</code>, is the country used. "NO" means no country set</li>
<li><code>localeLanguage</code>, is the language used. "no" means no language set</li>
<li><code>charSet</code>,	is the charset used. Default is <em>UTF-8</em></li>
<li><code>timezone</code>, is the timezone used. Timezone is taken on database creation</li>
<li><code>definitionVersion</code>, is the internal version used to store the metadata</li>
<li><code>clusterSelection</code>, is the strategy used on selecting the cluster on creation of new record of a class</li>
<li><code>minimumClusters</code>, minimum number of clusters to create when at class creation</li>
<li><code>conflictStrategy</code>, is the database strategy for resolving conflicts</li>
</ul>
<p><img src="studio/working-with-databases//images/configuration.png" alt="Configuration" /></p>
<p>##Export
Allows to export the current database in GZipped JSON format. To import the file into another database, use the <a href="studio/working-with-databases/../../console/Console-Command-Import.html">Import Console Command</a>.</p>
<p><img src="studio/working-with-databases/../../images/import-export.png" alt="Export" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="working-with-data"><a class="header" href="#working-with-data">Working with Data</a></h1>
<p><em>Studio</em> provides two main features to interact and work with data:</p>
<ol>
<li>The <a href="studio/working-with-data/browse/README.html"><em>Browse</em></a> panel</li>
<li>The <a href="studio/working-with-data/graph-editor/README.html"><em>Graph Editor</em></a></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="browse-panel"><a class="header" href="#browse-panel"><em>Browse</em> Panel</a></h1>
<p>Studio supports auto recognition of the language you're using between those supported: <a href="studio/working-with-data/browse/../../../sql/README.html">SQL</a> and <a href="studio/working-with-data/browse/../../../gremlin/Gremlin.html">Gremlin</a>.
While writing, use the auto-complete feature by pressing Ctrl + Space.</p>
<p>Other shortcuts are available in the query editor:</p>
<ul>
<li><strong>Ctrl + Return</strong> to execute the query or just click the <strong>Run</strong> button</li>
<li><strong>Ctrl/Cmd + Z</strong> to undo changes</li>
<li><strong>Ctrl/Cmd + Shift</strong> + Z  to redo changes</li>
<li><strong>Ctrl/Cmd + F</strong> to search in the editor</li>
<li><strong>Ctrl/Cmd + /</strong> to toggle a comment</li>
</ul>
<blockquote>
<p><strong>Note:</strong>
If you have multiple queries in the editor, you can select a single query with text selection and execute it with <strong>Ctrl + Return</strong> or the <strong>Run</strong> button</p>
</blockquote>
<p><img src="studio/working-with-data/browse//images/browse.png" alt="Query result" /></p>
<p>By clicking any @rid value in the result set, you will go into <a href="studio/working-with-data/browse/Studio-Edit-Document.html">document edit</a> mode if the record is a Document, otherwise you will go into <a href="studio/working-with-data/browse/Studio-Edit-Vertex.html">vertex edit</a>.</p>
<p>You can bookmark your queries by clicking the star icon in the results set or in the editor.
To browse bookmarked queries, click the <strong>Bookmarks</strong> button. <em>Studio</em> will open the bookmarks list on the left, where you can edit/delete or rerun queries.</p>
<p><img src="studio/working-with-data/browse/../../../images/bookmarks.png" alt="Bookmarks" /></p>
<p><em>Studio</em> saves the executed queries in the Local Storage of the browser, in the query settings, you can configure how many queries <em>Studio</em> will keep in history.
You can also search a previously executed query, delete all the queries from the history or delete a single query.</p>
<p>Starting from <em>Studio</em> v.2.0, you can send the result set of a query to the <a href="studio/working-with-data/browse/../graph-editor/README.html">Graph Editor</a> by clicking on the circle icon in the result set actions. This allows you to visualize your data graphically.</p>
<h2 id="json-output"><a class="header" href="#json-output">JSON Output</a></h2>
<p>Studio communicates with the OrientDB Server using <a href="studio/working-with-data/browse/../../../misc/OrientDB-REST.html">HTTP/RESt+JSON protocol</a>. To see the output in JSON format, press the <strong>RAW</strong> tab.</p>
<p><img src="studio/working-with-data/browse/../../../images/resultRaw.png" alt="Query result" /></p>
<h2 id="query-explain"><a class="header" href="#query-explain">Query Explain</a></h2>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><hr />
<h2>search:
keywords: ['Studio', 'edit document']</h2>
<h1 id="edit-document"><a class="header" href="#edit-document">Edit Document</a></h1>
<p><img src="studio/working-with-data/browse/../../../images/editDocument.png" alt="Edit Document" /></p>
<div style="break-before: page; page-break-before: always;"></div><hr />
<h2>search:
keywords: ['Studio', 'edit vertex']</h2>
<h1 id="edit-vertex"><a class="header" href="#edit-vertex">Edit Vertex</a></h1>
<p><img src="studio/working-with-data/browse/../../images/editVertex.png" alt="Edit Document" /></p>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><hr />
<h2>search:
keywords: ['Studio', 'graph', 'Graph Editor']</h2>
<h1 id="graph-editor"><a class="header" href="#graph-editor">Graph Editor</a></h1>
<p>Since Studio 2.0 we have a new brand graph editor.  Not only you can visualize your data in a graph way
but you can also interact with the graph and modify it.</p>
<p>To populate the graph area just type a query in the query editor or use the functionality <strong>Send To Graph</strong> from the <a href="studio/working-with-data/graph-editor/../browse/Studio-Browse-Querying-Data.html">Browse UI</a></p>
<p><img src="studio/working-with-data/graph-editor//images/GraphEditor.png" alt="GraphEditor" /></p>
<p>Supported operations in the Graph Editor are:</p>
<ul>
<li>Add Vertices</li>
<li>Save the Graph Rendering Configuration</li>
<li>Clear the Graph Rendering Canvas</li>
<li>Delete Vertices</li>
<li>Remove Vertices from Canvas</li>
<li>Edit Vertices</li>
<li>Inspect Vertices</li>
<li>Change the Rendering Configuration of Vertices</li>
<li>Navigating Relationships</li>
<li>Create Edges between Vertices</li>
<li>Delete Edges between Vertices</li>
<li>Inspect Edges</li>
<li>Edit Edges</li>
</ul>
<h2 id="add-vertices"><a class="header" href="#add-vertices">Add Vertices</a></h2>
<p>To add a new Vertex in your Graph Database and in the Graph Canvas area you have to press the button
<strong>Add Vertex</strong>.
This operation is done in two steps.</p>
<p>The first step you have to choose the class for the new Vertex and then click <strong>Next</strong></p>
<p><img src="studio/working-with-data/graph-editor/../../../images/AddVertex1.png" alt="AddVertex1" /></p>
<p>In the second step you have to insert the fields values of the new vertex, you can also add custom fields as OrientDB supports Schema-Less mode. To make the new vertex persistent click to <strong>Save changes</strong> and the
vertex will be saved into the database and added to the canvas area</p>
<p><img src="studio/working-with-data/graph-editor/../../../images/AddVertex2.png" alt="AddVertex2" /></p>
<h2 id="delete-vertices"><a class="header" href="#delete-vertices">Delete Vertices</a></h2>
<p>Open the circular menu by clicking on the Vertex that you want to delete, open the sub-menu by passing hover the mouse to the menu entry more (<strong>...</strong>) and then click the trash icon.</p>
<h2 id="remove-vertices-from-canvas"><a class="header" href="#remove-vertices-from-canvas">Remove Vertices from Canvas</a></h2>
<p>Open the circular menu , open the sub-menu by passing hover the mouse to the menu entry more (<strong>...</strong>) and then click the <strong>eraser</strong> icon.</p>
<h2 id="edit-vertices"><a class="header" href="#edit-vertices">Edit Vertices</a></h2>
<p>Open the circular menu and then click to the <strong>edit</strong> icon, Studio will open a popup where you can edit the vertex properties.</p>
<h2 id="inspect-vertices"><a class="header" href="#inspect-vertices">Inspect Vertices</a></h2>
<p>If you want to take a quick look to the Vertex property, click to the <strong>eye</strong> icon.</p>
<p><img src="studio/working-with-data/graph-editor/../../../images/Property.png" alt="Property" /></p>
<h2 id="change-the-rendering-configuration-of-vertices"><a class="header" href="#change-the-rendering-configuration-of-vertices">Change the Rendering Configuration of Vertices</a></h2>
<p><img src="studio/working-with-data/graph-editor/../../../images/Settings.png" alt="Settings" /></p>
<h2 id="navigating-relationships"><a class="header" href="#navigating-relationships">Navigating Relationships</a></h2>
<h2 id="create-edges-between-vertices"><a class="header" href="#create-edges-between-vertices">Create Edges between Vertices</a></h2>
<h2 id="delete-edges-between-vertices"><a class="header" href="#delete-edges-between-vertices">Delete Edges between Vertices</a></h2>
<h2 id="inspect-edges"><a class="header" href="#inspect-edges">Inspect Edges</a></h2>
<h2 id="edit-edges"><a class="header" href="#edit-edges">Edit Edges</a></h2>
<div style="break-before: page; page-break-before: always;"></div><p>link to the schema manager</p>
<div style="break-before: page; page-break-before: always;"></div><hr />
<h2>search:
keywords: ['Studio', 'schema', 'schema manager']</h2>
<h1 id="schema-manager-panel"><a class="header" href="#schema-manager-panel">Schema Manager Panel</a></h1>
<p>OrientDB can work in schema-less mode, schema mode or a mix of both. Here we'll discuss the schema mode. To know more about schema in OrientDB go <a href="studio/working-with-schemas/../../general/Schema.html">here</a></p>
<p><img src="studio/working-with-schemas/../../images/schema.png" alt="Schema" /></p>
<p>Here you can :</p>
<ul>
<li>Browse all the Classes of your database</li>
<li>Create a new Class</li>
<li>Rename/Drop a Class</li>
<li>Change the <a href="studio/working-with-schemas/../../sql/SQL-Alter-Class.html">cluster selection</a> for a Class</li>
<li>Edit a class by clicking on a class row in the table</li>
<li>View all indexes created</li>
</ul>
<h2 id="view-all-indexes"><a class="header" href="#view-all-indexes">View all indexes</a></h2>
<p>When you want to have an overview of all indexes created in your database, just click the <strong>All indexes</strong> button in the Schema UI. This will provide quick access to some information about indexes (name, type, properties, etc) and you can drop or rebuild them from here.</p>
<p><img src="studio/working-with-schemas/../../images/indexes.png" alt="newClass" /></p>
<div style="break-before: page; page-break-before: always;"></div><hr />
<h2>search:
keywords: ['Studio', 'class']</h2>
<h1 id="classes-1"><a class="header" href="#classes-1">Classes</a></h1>
<h2 id="creating-a-class"><a class="header" href="#creating-a-class">Creating a Class</a></h2>
<p>To create a new Class, just click the <strong>New Class</strong> button.
Some information is required to create the new class.</p>
<ul>
<li>Name</li>
<li>SuperClass</li>
<li>Alias (Optional)</li>
<li>Abstract</li>
</ul>
<p>Here you can find more information about <a href="studio/working-with-schemas/../../general/Schema.html#class">Classes</a>
<img src="studio/working-with-schemas/../../images/newClass.png" alt="newClass" /></p>
<h2 id="editing-a-class"><a class="header" href="#editing-a-class">Editing a Class</a></h2>
<p><img src="studio/working-with-schemas/../../images/class.png" alt="Class" /></p>
<h2 id="dropping-a-class"><a class="header" href="#dropping-a-class">Dropping a Class</a></h2>
<div style="break-before: page; page-break-before: always;"></div><hr />
<h2>search:
keywords: ['Studio', 'property']</h2>
<h1 id="properties-1"><a class="header" href="#properties-1">Properties</a></h1>
<h2 id="creating-a-property"><a class="header" href="#creating-a-property">Creating a Property</a></h2>
<p><img src="studio/working-with-schemas/../../images/newProperty.png" alt="Property" /></p>
<h2 id="editing-a-property"><a class="header" href="#editing-a-property">Editing a Property</a></h2>
<h2 id="dropping-a-property"><a class="header" href="#dropping-a-property">Dropping a Property</a></h2>
<div style="break-before: page; page-break-before: always;"></div><hr />
<h2>search:
keywords: ['Studio', 'index']</h2>
<h1 id="indexes-1"><a class="header" href="#indexes-1">Indexes</a></h1>
<h2 id="creating-an-index"><a class="header" href="#creating-an-index">Creating an Index</a></h2>
<p><img src="studio/working-with-schemas/../../images/newIndex.png" alt="Property" /></p>
<h2 id="rebuilding-an-index"><a class="header" href="#rebuilding-an-index">Rebuilding an Index</a></h2>
<h2 id="dropping-an-index"><a class="header" href="#dropping-an-index">Dropping an Index</a></h2>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><hr />
<h2>search:
keywords: ['Studio', 'functions']</h2>
<h1 id="functions-management-panel"><a class="header" href="#functions-management-panel"><em>Functions Management</em> Panel</a></h1>
<p>OrientDB allows to extend the SQL language by providing <a href="studio/working-with-functions/../../admin/Functions.html">Functions</a>. Functions can be used also to create data-driven micro services. For more information look at <a href="studio/working-with-functions/../../admin/Functions.html">Functions</a>.</p>
<p><img src="studio/working-with-functions//images/functions.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><div style="break-before: page; page-break-before: always;"></div><hr />
<h2>search:
keywords: ['Studio', 'security']</h2>
<h1 id="security-manager-panel"><a class="header" href="#security-manager-panel"><em>Security Manager</em> Panel</a></h1>
<p>The <em>Security Manager</em> panel allows you to manage <em>Database</em> Users and Roles in a graphical way.
For detailed information about Security in OrientDB, visit <a href="studio/working-with-users-roles/../../security/Security.html">here</a></p>
<h2 id="tab-users"><a class="header" href="#tab-users">Tab Users</a></h2>
<p>Here you can manage the database users:</p>
<ul>
<li>Search Users</li>
<li>Add Users</li>
<li>Delete Users</li>
<li>Edit User: roles can be edited in-line, for name, status and password click the <strong>Edit</strong> button</li>
</ul>
<p><img src="studio/working-with-users-roles/../../images/users.png" alt="Home Page" /></p>
<h2 id="tab-roles"><a class="header" href="#tab-roles">Tab Roles</a></h2>
<p>Here you can manage the database roles:</p>
<ul>
<li>Search Role</li>
<li>Add Role</li>
<li>Delete Role</li>
<li>Edit Role</li>
</ul>
<p><img src="studio/working-with-users-roles/../../images/roles.png" alt="Home Page" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="users-management"><a class="header" href="#users-management">Users Management</a></h1>
<h2 id="creating-database-users"><a class="header" href="#creating-database-users">Creating Database Users</a></h2>
<p>To add a new User, click the <strong>Add User</strong> button, complete the information for the new user
(name, password, status, roles) and then save to add the new user to the database.</p>
<p><img src="studio/working-with-users-roles/../../images/newUser.png" alt="New User" /></p>
<h2 id="editing-database-users"><a class="header" href="#editing-database-users">Editing Database Users</a></h2>
<h2 id="dropping-database-users"><a class="header" href="#dropping-database-users">Dropping Database Users</a></h2>
<div style="break-before: page; page-break-before: always;"></div><h1 id="roles-management"><a class="header" href="#roles-management">Roles Management</a></h1>
<h2 id="creating-roles"><a class="header" href="#creating-roles">Creating Roles</a></h2>
<p>To add a new User, click the <strong>Add Role</strong> button, complete the information for the new role
(name, parent role, mode) and then save to add the new role to the database.</p>
<p><img src="studio/working-with-users-roles/../../images/newRole.png" alt="New Role" /></p>
<h2 id="deleting-roles"><a class="header" href="#deleting-roles">Deleting Roles</a></h2>
<h2 id="adding-rules-to-a-role"><a class="header" href="#adding-rules-to-a-role">Adding Rules to a Role</a></h2>
<p>To add a new security rule for the selected role, click the <em>Add Rule</em> button.
This will ask you the string of the resource that you want to secure. For a list of
available resources, see <a href="studio/working-with-users-roles/../../security/Database-Security.html#resources">Resources</a></p>
<p>Then you can configure the CRUD permissions on the newly created resource.</p>
<p><img src="studio/working-with-users-roles/../../images/newRule.png" alt="New User" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="server-level-commands-2"><a class="header" href="#server-level-commands-2">Server-Level Commands</a></h1>
<p>(since v 3.2)</p>
<p>Server-Level Commands allow SQL-like script execution on the server.</p>
<p>Since the very first versions, OrientDB allowed to execute a few different types of scripts, like SQL commands or console scripts.</p>
<p>SQL commands have a generic API that could be executed from any endpoint (REST, Studio, Console, application API) with the exact same effect. The scope of a SQL command is only a single database schema, so operations that do not involve the DB but have a broader scope (eg. the server instance or the cluster) can hardly be implemented with this mechanism.</p>
<p>Console scripts (eg. commands like <code>info</code> or like the old <code>create database</code>) act at server level, but they can only be executed via CLI. This makes this mechanism a bit limited and hard to extend.</p>
<p>In V 3.2 OrientDB introduces Server-Level Commands as a first-class component.</p>
<p>A Server-Level Command is a text command that is executed in the scope of a server, so the goal of this component is to run operations that do not limit their scope to a single database.</p>
<p>At this stage, the following commands are supported</p>
<ul>
<li><a href="serverlevel/Create-Database.html">CREATE DATABASE</a></li>
<li><a href="serverlevel/Drop-Database.html">DROP DATABASE</a></li>
<li><a href="serverlevel/Create-System-User.html">CREATE SYSTEM USER</a></li>
<li><a href="serverlevel/Alter-System-Role.html">ALTER SYSTEM ROLE</a></li>
<li><a href="serverlevel/Exists-System-Role.html">EXISTS SYSTEM ROLE</a></li>
</ul>
<h2 id="how-to-invoke-a-server-level-command"><a class="header" href="#how-to-invoke-a-server-level-command">How to invoke a Server-Level Command</a></h2>
<h3 id="console-2"><a class="header" href="#console-2">Console</a></h3>
<p>The console natively supports Server-Level Commands.</p>
<p>To run a command you have to be connected to a Server with <code>connect env</code></p>
<p>eg. to create a MEMORY database using a Server-Level Command:</p>
<pre><code>orientdb&gt; connect env embedded:./target/dir root root

orientdb&gt; create database test memory users (admin identified by 'admin' role admin)
</code></pre>
<h3 id="studio"><a class="header" href="#studio">Studio</a></h3>
<p>From SERVER MANAGEMENT</p>
<p><img src="serverlevel/../images/server-level-commands.png" alt="Server Level Commands" /></p>
<h3 id="java-api"><a class="header" href="#java-api">Java API</a></h3>
<p>Using OrientDB class, with the new <code>execute()</code> methods</p>
<pre><code>orientDB = new OrientDB("remote:localhost", "root", "root", OrientDBConfig.defaultConfig());
orientDB.execute(
        "create database ? memory users (admin identified by 'admin' role admin)",
        theDbName);
    
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><hr />
<h2>search:
keywords: ['SQL', 'command', 'create', 'database', 'CREATE DATABASE']</h2>
<h1 id="server-commands---create-database"><a class="header" href="#server-commands---create-database">Server Commands - <code>CREATE DATABASE</code></a></h1>
<p>Creates a database on the current environment/server</p>
<p><strong>Syntax</strong></p>
<p>CREATE DATABASE foo plocal users (foo identified by 'pippo' role admin, reader identified by ? role [reader, writer])</p>
<pre><code class="language-sql">CREATE DATABASE &lt;dbName&gt; &lt;type&gt; [ USERS (&lt;username&gt; IDENTIFIED BY &lt;password&gt; ROLE &lt;roleName&gt;)*] [&lt;configJson&gt;]
</code></pre>
<ul>
<li><strong><code>&lt;dbName&gt;</code></strong> The database name</li>
<li><strong><code>&lt;type&gt;</code></strong> <code>plocal</code> or <code>memory</code></li>
<li><strong><code>&lt;username&gt;</code></strong> the name of a user to add to the database</li>
<li><strong><code>&lt;password&gt;</code></strong> the password of a user to add to the database</li>
<li><strong><code>&lt;roleName&gt;</code></strong> the name of a role to assign to the user added to the database</li>
<li><strong><code>&lt;configJson&gt;</code></strong> the custom configuration for current db</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Create a DB:</p>
<pre>
orientdb> <code class='lang-sql userinput'>CREATE DATABASE foo plocal</code>
</pre>
</li>
<li>
<p>Create a DB with custom users:</p>
<pre>
orientdb> <code class='lang-sql userinput'>CREATE DATABASE foo plocal users (foo identified by 'pippo' role admin, reader identified by ? role [reader, writer])</code>
</pre>
</li>
<li>
<p>Create a DB with legacy default users:</p>
<pre>
orientdb> <code class='lang-sql userinput'>CREATE DATABASE foo plocal {"config":{"security.createDefaultUsers": true}} </code>
</pre>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><hr />
<h2>search:
keywords: ['SQL', 'command', 'alter', 'class', 'ALTER CLASS']</h2>
<h1 id="server-commands---drop-database"><a class="header" href="#server-commands---drop-database">Server Commands - <code>DROP DATABASE</code></a></h1>
<p>Drops a database</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">DROP DATABASE &lt;dbName&gt; [if exists]
</code></pre>
<ul>
<li><strong><code>&lt;dbName&gt;</code></strong> the name of an existing db</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>drop an existing db:</p>
<pre>
orientdb> <code class='lang-sql userinput'>DROP DATABASE foo</code>
</pre>
</li>
<li>
<p>drop a db if it exists:</p>
<pre>
orientdb> <code class='lang-sql userinput'>DROP DATABASE foo if exists</code>
</pre>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><hr />
<h2>search:
keywords: ['SQL', 'command', 'alter', 'class', 'ALTER CLASS']</h2>
<h1 id="server-commands---create-system-user"><a class="header" href="#server-commands---create-system-user">Server Commands - <code>CREATE SYSTEM USER</code></a></h1>
<p>Creates a System user</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">CREATE SYSTEM USER &lt;userName&gt; IDENTIFIED BY &lt;password&gt; ROLE &lt;role&gt;
</code></pre>
<ul>
<li><strong><code>&lt;userName&gt;</code></strong> the user name</li>
<li><strong><code>&lt;password&gt;</code></strong> the password</li>
<li><strong><code>&lt;role&gt;</code></strong> an existing role name</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Create a system user with one role:</p>
<pre>
orientdb> <code class='lang-sql userinput'>CREATE SYSTEM USER test IDENTIFIED BY 'foo' ROLE admin</code>
</pre>
</li>
<li>
<p>Create a system user with multiple roles:</p>
<pre>
orientdb> <code class='lang-sql userinput'>CREATE SYSTEM USER test IDENTIFIED BY 'foo' ROLE [reader, writer] </code>
</pre>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="server-commands---alter-system-role"><a class="header" href="#server-commands---alter-system-role">Server Commands - <code>ALTER SYSTEM Role</code></a></h1>
<p>Alters the properties of an existing system user</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">ALTER SYSTEM ROLE &lt;roleName&gt; [SET POLICY &lt;policyName ON &lt;resource&gt;]* [REMOVE POLICY ON &lt;resource&gt;] 
</code></pre>
<ul>
<li><strong><code>&lt;roleName&gt;</code></strong> A system role name</li>
<li><strong><code>&lt;policyName&gt;</code></strong> The name of a security policy</li>
<li><strong><code>&lt;resource&gt;</code></strong> A database resource, eg. <code>database.class.AClassName</code></li>
</ul>
<p><strong>Examples</strong></p>
  <pre>
  orientdb> <code class='lang-sql userinput'>
  alter system role Foo  set policy bar on database.class.Person 
     set policy bar on database.class.Xx remove policy on database.class.Person
  </code>
  </pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="server-commands---exists-system-user"><a class="header" href="#server-commands---exists-system-user">Server Commands - <code>EXISTS SYSTEM USER</code></a></h1>
<p>Checks whether a system user exists</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">EXISTS SYSTEM USER &lt;userName&gt;
</code></pre>
<ul>
<li><strong><code>&lt;userName&gt;</code></strong> the system user name</li>
</ul>
<p><strong>Examples</strong></p>
  <pre>
  orientdb> <code class='lang-sql userinput'>EXISTS SYSTEM USER test</code>
  </pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="teleporter-1"><a class="header" href="#teleporter-1">Teleporter</a></h1>
<p><strong>OrientDB Teleporter</strong> is a tool that synchronizes a RDBMS to OrientDB database. You can use Teleporter to:</p>
<ul>
<li>Import your existing RDBMS to OrientDB</li>
<li>Keep your OrientDB database synchronized with changes from the RDBMS. In this case the database on RDBMS remains the primary and the database on OrientDB a synchronized copy. <a href="teleporter/Teleporter-Sequential-Executions-and-One-Way-Synchronizer.html">Synchronization</a> is one way, so all the changes in OrientDB database will not be propagated to the RDBMS</li>
</ul>
<p>Teleporter is fully compatible with several RDBMS that have a JDBC driver: we successfully tested Teleporter with Oracle, SQLServer, MySQL, PostgreSQL and HyperSQL. Teleporter manages all the necessary type conversions between the different DBMSs and imports all your data as Graph in OrientDB.</p>
<p><strong>NOTE</strong>: This feature is available both for the <a href="http://orientdb.com/orientdb-enterprise">OrientDB Enterprise Edition</a> and the <a href="http://orientdb.dev/downloads/">OrientDB Community Edition</a>. <strong>But beware</strong>: in <strong>community edition</strong> you can migrate your source relational database but <strong>you cannot enjoy the synchronize feature</strong>, only available in the enterprise edition.</p>
<h2 id="how-teleporter-works"><a class="header" href="#how-teleporter-works">How Teleporter works</a></h2>
<p>Teleporter looks for the specific DBMS meta-data in order to perform a logical inference of the source DB schema for the building of a corresponding graph model. Eventually the data importing phase is performed.</p>
<p>Teleporter has a pluggable importing strategy. Two strategies are provided out of the box:</p>
<ul>
<li><strong>naive</strong> strategy, the simplest one</li>
<li><strong>naive-aggregate</strong> strategy. It performs a "naive" import of the data source. The data source schema is translated semi-directly in a correspondent and coherent graph model using an aggregation policy on the junction tables of dimension equals to 2</li>
</ul>
<p>To learn more about the two different execution strategies <a href="teleporter/Teleporter-Execution-Strategies.html">click here.</a></p>
<h2 id="usage-4"><a class="header" href="#usage-4">Usage</a></h2>
<p>Teleporter is a tool written in Java, but can be used as a tool thanks to the teleporter.sh script (or .bat on Windows).</p>
<pre><code>./oteleporter.sh -jdriver &lt;jdbc-driver&gt; -jurl &lt;jdbc-url&gt; -juser &lt;username&gt; 
                -jpasswd &lt;password&gt; -ourl &lt;orientdb-url&gt; [-s &lt;strategy&gt;]
                [-nr &lt;name-resolver&gt;] [-v &lt;verbose-level&gt;] 
                ([-include &lt;table-names&gt;] | [-exclude &lt;table-names&gt;]) 
                [-inheritance &lt;orm-technology&gt;:&lt;ORM-file-url&gt;] 
                [-conf &lt;configuration-file-location&gt;]
</code></pre>
<h3 id="arguments"><a class="header" href="#arguments">Arguments</a></h3>
<ul>
<li><strong>-jdriver</strong> is the driver name of the DBMS from which you want to execute the import (it's not case sensitive)</li>
<li><strong>-jurl</strong> is the JDBC URL giving the location of the source database to import</li>
<li><strong>-ourl</strong> is the URL for the destination OrientDB graph database</li>
<li><strong>-juser (optional)</strong> is the username to access the source database</li>
<li><strong>-jpasswd (optional)</strong> is the password to access the source database</li>
<li><strong>-s (optional)</strong> is the strategy adopted during the importing phase. If not specified naive-aggregate strategy is adopted. Possible values:</li>
<li><strong>naive</strong>: performs a "naive" import of the data source. The data source schema is translated semi-directly in a correspondent and coherent graph model</li>
<li><strong>naive-aggregate</strong>: performs a "naive" import of the data source. The data source schema is translated semi-directly in a correspondent and coherent graph model using an aggregation policy on the junction tables of dimension equals to 2</li>
<li><strong>-nr (optional)</strong> is the name of the resolver which transforms the names of all the elements of the source database
according to a specific convention (if not specified original convention is adopted). Possible values:</li>
<li><strong>original</strong>: maintains the original name convention</li>
<li><strong>java</strong>: performs name transformations on all the elements of the data source according to the Java convention</li>
<li><strong>-v (optional)</strong> is the level of verbosity printed to the output during the execution (if not specified INFO level will be adopted). Levels:</li>
<li><strong>0</strong>: NO logging messages will be printed</li>
<li><strong>1</strong>: DEBUG level logging messages</li>
<li><strong>2</strong>: INFO level logging messages (default)</li>
<li><strong>3</strong>: WARNING level logging messages</li>
<li><strong>4</strong>: ERROR level logging messages</li>
<li><strong>-include (optional)</strong> allows you to import only the listed tables</li>
<li><strong>-exclude (optional)</strong> excludes the listed tables from the importing process</li>
<li><strong>-inheritance (optional)</strong> executes the import taking advantage of OrientDB's polymorphism</li>
<li><strong>-config</strong> allows you to define a custom configuration for your importing job</li>
</ul>
<h2 id="access-credentials"><a class="header" href="#access-credentials">Access Credentials</a></h2>
<p>By convention three users are always created by default each time a new database is built. Passwords are the same as the user name. Default users are:</p>
<ul>
<li><code>admin</code>, with default password "<code>admin</code>", has access to all functions without limitation.</li>
<li><code>reader</code>, with default password "<code>reader</code>", is the classic read-only user. The reader can read any records but can't modify or delete them and has no access to internal information such as users and roles, themselves.</li>
<li><code>writer</code>, with the default password "<code>writer</code>", is like the user reader but can also create, update, and delete records.</li>
</ul>
<p>For further informations about the Security of the OrientDB database <a href="https://github.com/orientechnologies/orientdb-docs/blob/master/Database-Security.md">click here.</a></p>
<h2 id="examples-2"><a class="header" href="#examples-2">Examples</a></h2>
<h3 id="importing-testdb-from-postgresql-dbms-with-default-parameters"><a class="header" href="#importing-testdb-from-postgresql-dbms-with-default-parameters">Importing "testdb" from PostgreSQL DBMS with default parameters</a></h3>
<p>Using plocal connection:</p>
<pre><code>./oteleporter.sh -jdriver postgresql -jurl jdbc:postgresql://localhost:5432/testdb 
                -juser username -jpasswd password -ourl plocal:$ORIENTDB_HOME/databases/testdb
</code></pre>
<p>Using remote connection:</p>
<pre><code>./oteleporter.sh -jdriver postgresql -jurl jdbc:postgresql://localhost:5432/testdb 
                -juser username -jpasswd password -ourl remote:localhost/testdb
</code></pre>
<p>With these parameters it will be performed an import according to the default settings:</p>
<ul>
<li>strategy adopted: <strong>naive-aggregate</strong></li>
<li>name resolver: <strong>original name resolver</strong></li>
<li>level of verbosity: <strong>INFO</strong> (2nd level)</li>
</ul>
<h3 id="importing-testdb-from-postgresql-dbms-with-customized-optional-parameters"><a class="header" href="#importing-testdb-from-postgresql-dbms-with-customized-optional-parameters">Importing "testdb" from PostgreSQL DBMS with customized optional parameters</a></h3>
<p>Using plocal connection:</p>
<pre><code>./oteleporter.sh -jdriver postgresql -jurl jdbc:postgresql://localhost:5432/testdb 
                -juser username -jpasswd password -ourl plocal:$ORIENTDB_HOME/databases/testdb 
                -s naive -nr java -v 1
</code></pre>
<p>Using remote connection:</p>
<pre><code>./oteleporter.sh -jdriver postgresql -jurl jdbc:postgresql://localhost:5432/testdb 
                -juser username -jpasswd password -ourl remote:localhost/testdb 
                -s naive -nr java -v 1
</code></pre>
<p>With these parameters it will be performed an import according to the chosen settings:</p>
<ul>
<li>strategy adopted: <strong>naive</strong></li>
<li>name resolver: <strong>java name resolver</strong></li>
<li>level of verbosity: <strong>DEBUG</strong> (1st level)</li>
</ul>
<h2 id="teleporter-execution"><a class="header" href="#teleporter-execution">Teleporter Execution</a></h2>
<p>Teleporter execution consists of 4 steps:</p>
<ol>
<li><strong>Source DB Schema Building:</strong> the source database schema is built by querying the source DB metadata.</li>
<li><strong>Graph Model Building:</strong> a correspondent and coherent Graph Model is built.</li>
<li><strong>OrientDB Schema Writing:</strong> the OrientDB schema is written according to the Graph Model in memory.</li>
<li><strong>OrientDB importing:</strong> importing data from source database to OrientDB.</li>
</ol>
<p>Thus the whole workflow is:</p>
<p><img src="teleporter/../images/teleporter-whole-workflow.png" alt="Whole Workflow" /></p>
<p>Below is reported a Teleporter execution dump:</p>
<p><img src="teleporter/../images/teleporter-execution-dump.png" alt="Execution Dump" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation-and-configuration"><a class="header" href="#installation-and-configuration">Installation and Configuration</a></h1>
<h2 id="installation-4"><a class="header" href="#installation-4">Installation</a></h2>
<p>Teleporter is out-of-the-box both in Community and Enterprise Edition, so you don't need any configuration or modification.
<strong>But beware</strong>: in <strong>Community Edition</strong> you can migrate your source relational database but <strong>you cannot enjoy the synchronize feature</strong>, only available in the <strong>Enterprise Edition</strong>.</p>
<p>You can run the tool through the script as described in the <a href="teleporter/Teleporter-Home.html">Home page</a> or just execute it via OrientDB Studio as described <a href="teleporter/../studio/backups-imports-exports/Studio-Teleporter.html">here.</a></p>
<h2 id="driver-configuration"><a class="header" href="#driver-configuration">Driver Configuration.</a></h2>
<h3 id="automatic-driver-configuration"><a class="header" href="#automatic-driver-configuration">Automatic Driver Configuration</a></h3>
<p>Teleporter provides an automaic driver configuration: when the application starts, it looks for the required driver. If the driver is not found the application will download it and it will automatically configure the classpath, not delegating anything to the end user.<br />
So when you run Teleporter you just have to indicate the name of the DBMS you want to connect. Teleporter is compatible with Oracle, MySQL, PostgreSQL and HyperSQL products, thus you have to type one of the following parameters <strong>(not case sensitive)</strong>:</p>
<ul>
<li><strong>Oracle</strong></li>
<li><strong>SQLServer</strong></li>
<li><strong>MySQL</strong></li>
<li><strong>PostgreSQL</strong></li>
<li><strong>HyperSQL</strong></li>
</ul>
<p>Teleporter will search for the correspondent driver in the $ORIENTDB_HOME/lib folder and if it's not present, it will download the latest available driver version. If a driver is already present in the folder, then it will be used for the connection to the source DB.
Therefore if you want use a new driver version, you just have to delete the older version and run Teleporter which will download and configure for you the latest available version.</p>
<pre><code>./oteleporter.sh -jdriver postgresql -jurl jdbc:postgresql://localhost:5432/testdb 
                -juser username -jpasswd password -ourl plocal:$ORIENTDB_HOME/databases/testdb 
                -s naive -nr java -v 2
</code></pre>
<h3 id="manual-driver-configuration"><a class="header" href="#manual-driver-configuration">Manual Driver configuration</a></h3>
<p>It's possible to perform a manual configuration downloading own favourite driver version and properly defining the classpath in the application.
Below are reported the last driver tested versions with some useful information for download, configuration and use.</p>
<div class="table-wrapper"><table><thead><tr><th>Driver</th><th>Last Tested Version</th><th>Path pattern</th><th>Path Example</th><th>Link for download</th></tr></thead><tbody>
<tr><td>Oracle</td><td>12c</td><td>jdbc:oracle:thin:@HOST:PORT:SID</td><td>jdbc:oracle:thin:@localhost:1521:orcl</td><td>http://www.oracle.com/technetwork/database/features/jdbc/default-2280470.html</td></tr>
<tr><td>SQLServer</td><td>SQLServer 2014</td><td>jdbc:sqlserver://HOST:PORT;databaseName=DB</td><td>jdbc:sqlserver://localhost:1433;databaseName=testdb; <strong>(*)</strong></td><td>http://www.java2s.com/Code/JarDownload/sqljdbc4/sqljdbc4-2.0.jar.zip</td></tr>
<tr><td>MySQL</td><td>5.1.35</td><td>jdbc:mysql://HOST:PORT/DB</td><td>jdbc:mysql://localhost:3306/testdb</td><td>http://dev.mysql.com/downloads/connector/j/</td></tr>
<tr><td>PostgreSQL</td><td>9.4-1201</td><td>jdbc:postgresql://HOST:PORT/DB</td><td>jdbc:postgresql://localhost:5432/testdb</td><td>https://jdbc.postgresql.org/download.html</td></tr>
<tr><td>HyperSQL</td><td>2.3.2</td><td>jdbc:hsqldb:hsql://HOST:PORT/DB OR jdbc:hsqldb:file:FILEPATH</td><td>jdbc:hsqldb:hsql://localhost:9500/testdb OR jdbc:hsqldb:file:testdb</td><td>http://central.maven.org/maven2/org/hsqldb/hsqldb/2.3.3/hsqldb-2.3.3.jar</td></tr>
</tbody></table>
</div>
<p><strong>(*)</strong>  If the source database contains spaces in the name you have to use a URL like this:</p>
<p>“Source DB” →  -jurl “jdbc:sqlserver://localhost:1433;databaseName={Source DB};”</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="execution-strategies"><a class="header" href="#execution-strategies">Execution Strategies</a></h1>
<p>Teleporter provides two different import strategies:</p>
<ul>
<li><strong>naive</strong> strategy</li>
<li><strong>naive-aggregate</strong> strategy</li>
</ul>
<p>Both strategies build a schema in OrientDB starting from the source DB schema: each table (known also as Entity) and each Relationship in the DB is inferred from these metadata, therefore if you didn't defined some constraints, such as foreign keys between the tables on which you usually perform join operations, you will lose this kind of info during the import process.<br />
For example if foreign keys are missing, you will not have any edges in your final Graph Database.<br />
You can overcome this limit by defining an <a href="teleporter/Teleporter-Import-Configuration.html">Import Configuration</a> that allows you to add new relationships or modify those already present in your source database schema.<br />
Once built the OrientDB schema, the real import process begins.</p>
<p>Now both strategies will be individually discussed below.</p>
<h2 id="naive-strategy"><a class="header" href="#naive-strategy">Naive Strategy</a></h2>
<p>This strategy follows a basic approach for the import. The source DB schema is directly translated in the OrientDB schema as follows:</p>
<ol>
<li>Each Entity in the source DB is converted into a Vertex Type.</li>
<li>Each Relationship between two Entities in the source DB is converted into an Edge Type (remember, relationships in your DB schema are represented  by the foreign keys).</li>
</ol>
<p>Thus all records of each table are imported according to this "schemas-mapping": each pair of records on which it's possible to perform a join operation, will correspond to a pair of vertices connected by an edge of a specific Edge Type.</p>
<p>####Example 1 - Without Join Table
Source DB schema translation in OrientDB schema:</p>
<p><img src="teleporter/../images/teleporter-naive-strategy-schema1.png" alt="" /></p>
<p>Correspondent records import:</p>
<p><img src="teleporter/../images/teleporter-strategies-example1.png" alt="" /></p>
<p>####Example 2 - With Aggregable Join Table
Source DB schema translation in OrientDB schema:</p>
<p><img src="teleporter/../images/teleporter-naive-strategy-schema2.png" alt="" /></p>
<p>Starting from the following tables</p>
<p><img src="teleporter/../images/teleporter-strategies-example2-tables.png" alt="" /></p>
<p>we will obtain the following graph:</p>
<p><img src="teleporter/../images/teleporter-strategies-example2-not-aggr.png" alt="" /></p>
<h2 id="naive-aggregate-strategy"><a class="header" href="#naive-aggregate-strategy">Naive-Aggregate Strategy</a></h2>
<p>Unlike the first strategy, this one performs aggregation on join tables of dimension equals to 2, that is to say those tables which map two tables together by referencing the primary keys of each data table through a foreign key. The join tables of dimension greater than 2 are ignored by the aggregation algorithm.
Thus each candidate join table is converted into an appropriate edge, and each field not involved in any relationship with other tables (hence not involved in any foreign key in the source DB schema) is aggregated in the properties of the new built edge.</p>
<p>Referring to the scenario of the last example is evident as even if the new DB doesn't reflect the original DB model, the aggregation leads to a great saving in terms of resources and avoids a substantial overhead. The OrientDB schema after the aggregation process comes out simpler, hence also the import result it is.</p>
<p>####Example 3 - With Aggregable Join Table
Source DB schema translation in OrientDB schema:</p>
<p><img src="teleporter/../images/teleporter-naive-aggr-strategy-schema3.png" alt="" /></p>
<p>Through this strategy, starting from the same previous scenario</p>
<p><img src="teleporter/../images/teleporter-strategies-example2-tables.png" alt="" /></p>
<p>this time we will obtain a less complex graph:</p>
<p><img src="teleporter/../images/teleporter-strategies-example2-aggr.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sequential-executions-and-one-way-synchronizer"><a class="header" href="#sequential-executions-and-one-way-synchronizer">Sequential Executions and One-Way Synchronizer</a></h1>
<p>Teleporter is conceived to support many sequential executions from the same source DB to the same graph DB of OrientDB, in this way you can:</p>
<ul>
<li><strong>personalize your import,</strong> combining the different strategies and settings by including or excluding the chosen tables and by running Teleport more times in order to obtain a more complex and customized import strategy</li>
<li><strong>use it as a one-way synchronizer</strong> and maintain a copy of your DB: all the changes applied to the source DB (primary DB) are propagated to the imported graph DB, but not vice versa.</li>
</ul>
<p>A sample migration scenario is reported below:</p>
<p><img src="teleporter/../images/teleporter-migration1.png" alt="Migration Scenario1" />
<img src="teleporter/../images/teleporter-migration2.png" alt="Migration Scenario2" /></p>
<p>##Synchronization policy
Teleporter propagates the applied changes of the source DB both for the schema and for the records following the policy described below:</p>
<p><strong>1. SCHEMA SYNCHRONIZATION (Full Synchronization)</strong></p>
<div class="table-wrapper"><table><thead><tr><th>SOURCE DB SCHEMA</th><th></th><th>TARGET ORIENTDB SCHEMA</th><th>SYNCH</th></tr></thead><tbody>
<tr><td>Add Operation</td><td>--&gt;</td><td>Add Operation</td><td>YES</td></tr>
<tr><td>Delete Operation</td><td>--&gt;</td><td>Delete Operation</td><td>YES</td></tr>
<tr><td>Update Operation</td><td>--&gt;</td><td>Update Operation</td><td>YES</td></tr>
</tbody></table>
</div>
<hr />
<p><strong>2. RECORDS SYNCHRONIZATION (Delete-less Synchronization)</strong></p>
<div class="table-wrapper"><table><thead><tr><th>SOURCE DB</th><th></th><th>TARGET ORIENTDB GRAPHDB</th><th>SYNCH</th></tr></thead><tbody>
<tr><td>Add Operation</td><td>--&gt;</td><td>Add Operation</td><td>YES</td></tr>
<tr><td>Delete Operation</td><td>--&gt;</td><td>No Operation</td><td>NO</td></tr>
<tr><td>Update Operation</td><td>--&gt;</td><td>Update Operation</td><td>YES</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="import-filters"><a class="header" href="#import-filters">Import Filters</a></h1>
<p>It's possible to apply filters to the import process through the <strong>include</strong> and <strong>exclude</strong> arguments.<br />
With the <strong>include</strong> argument you'll import the listed tables according to the following syntax:</p>
<pre><code>-include &lt;tableName1&gt;,&lt;tableName2&gt;,...,&lt;tableNameX&gt;

</code></pre>
<p>With the <strong>exclude</strong> argument you'll import all the tables except for the listed ones  according to the following syntax:</p>
<pre><code>-exclude &lt;tableName1&gt;,&lt;tableName2&gt;,...,&lt;tableNameX&gt;

</code></pre>
<p>For both arguments recognizing tables is <strong>case sensitive.</strong><br />
These arguments are <strong>mutually exclusive,</strong> thus you can use just one of them during the same execution.</p>
<p>####Example 1: include usage</p>
<p>Importing only the "actor" and "film" tables from the source DB.</p>
<pre><code>./oteleporter.sh -jdriver postgresql -jurl jdbc:postgresql://localhost:5432/dvdrental
                -juser username -jpasswd password -ourl plocal:$ORIENTDB_HOME/databases/dvdrental
                -include actor,film
</code></pre>
<p>####Example 2: exclude usage</p>
<p>Importing all tables from the source DB except for the "actor" table.</p>
<pre><code>./oteleporter.sh -jdriver postgresql -jurl jdbc:postgresql://localhost:5432/dvdrental
                -juser username -jpasswd password -ourl plocal:$ORIENTDB_HOME/databases/dvdrental
                -exclude actor
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="inheritance-2"><a class="header" href="#inheritance-2">Inheritance</a></h1>
<p>Teleporter allows you to take advantage of OrientDB's polymorphism. In fact you can enrich the import phase via an ORM file which describes the inheritance relationships being between different tables (or Entities) of your source DB.</p>
<p>At the moment <strong>Hibernate's syntax</strong> is supported, and you can exploit this feature even if you don't use the Hibernate framework, which can automatically build the requested file for you. In fact the ORM file is simply interpreted as a "mapping file" between Relational and Object-Oriented models. Thus you can also write the file by yourself and give it as input to Teleporter, this is all you need.</p>
<h2 id="inheritance-patterns-in-relational-databases"><a class="header" href="#inheritance-patterns-in-relational-databases">Inheritance Patterns in Relational Databases</a></h2>
<p>Because relational databases have no concept of inheritance, there isn't a standard way of implementing inheritance in a database, so the hardest part of persisting inheritance is choosing how to represent the inheritance in the database. There are three main patterns commonly used:</p>
<ul>
<li><a href="teleporter/Teleporter-Single-Table-Inheritance.html"><strong>Single Table Inheritance</strong></a></li>
<li><a href="teleporter/Teleporter-Table-Per-Class-Inheritance.html"><strong>Table Per Class Inheritance</strong></a></li>
<li><a href="teleporter/Teleporter-Table-Per-Concrete-Class-Inheritance.html"><strong>Table Per Concrete Class Inheritance</strong></a></li>
</ul>
<p>Teleporter can faithfully reproduce all inheritance relationships present in your source DB using the argument <strong>'-inheritance'</strong> and the following the syntax:</p>
<pre><code>./oteleporter.sh -jdriver &lt;jdbc-driver&gt; -jurl &lt;jdbc-url&gt; -juser &lt;username&gt; 
                -jpasswd &lt;password&gt; -ourl &lt;orientdb-url&gt; -s &lt;strategy&gt;
                -inheritance hibernate:&lt;ORM-file-url&gt;
</code></pre>
<p>Example:</p>
<pre><code>./oteleporter.sh -jdriver &lt;jdbc-driver&gt; -jurl &lt;jdbc-url&gt; -juser &lt;username&gt; 
                -jpasswd &lt;password&gt; -ourl &lt;orientdb-url&gt; -s &lt;strategy&gt;
                -inheritance hibernate:/home/orientdb-user/mapping.xml
</code></pre>
<p>The resulting hierarchy in OrientDB is the same for each adopted pattern, as shown in the specific pattern descriptions.</p>
<h2 id="hibernate-syntax"><a class="header" href="#hibernate-syntax">Hibernate Syntax</a></h2>
<p>The mapping file is an XML document having &lt;hibernate-mapping&gt; as the root element which contains all the <class> elements.
Now we analyze some details about the Hibernate syntax used for the mapping file definition:</p>
<ul>
<li>The <strong>&lt;class&gt;</strong> elements are used to define the correspondence between Java classes and the database tables. The <strong>name</strong> attribute of the class element specifies the Java class name and the <strong>table</strong> attribute specifies the database table name.</li>
<li>The <strong>&lt;meta&gt;</strong> element is an optional element which can contain a class description.</li>
<li>The <strong>&lt;id&gt;</strong> element maps the unique ID attribute of the Java class to the primary key of the  correspondent database table. This element can have a <strong>name</strong> attribute and a <strong>column</strong> attribute  which manage the correspondence between the Object Model and the Relational Model as previously described: here the column attribute refers to the column in the table corresponding to that name. The <strong>type</strong> attribute holds the hibernate mapping type, this mapping types will convert from Java to SQL data type. If you write this file by yourself you should know that this element with its three attributes are superfluous for Teleporter.</li>
<li>The <strong>&lt;generator&gt;</strong> element within the <strong>id</strong> element is used to automatically generate the primary key values. Also this element is superfluous for Teleport.</li>
<li>The <strong>&lt;property&gt;</strong> element maps a Java class property to a column in the database table. The <strong>name</strong> attribute and the <strong>column</strong> have the same role in the Object and the Relational models mapping. The <strong>type</strong> attribute holds the hibernate mapping type.</li>
</ul>
<p>There are other attributes and elements available among which:</p>
<ul>
<li><strong>&lt;subclass&gt;</strong> element, used in the Single Table Inheritance pattern.</li>
<li><strong>&lt;subclass&gt;</strong> with a nested <strong>&lt;join&gt;</strong> element, used in the Table Per Class Inheritance pattern.</li>
<li><strong>&lt;joined-subclass&gt;</strong> element, used in the Table Per Class Inheritance pattern.</li>
<li><strong>&lt;union-subclass&gt;</strong> element, used in the Table Per Concrete Class Inheritance pattern.</li>
</ul>
<p>Their usage will be explained specifically in the description of each individual pattern.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="single-table-inheritance"><a class="header" href="#single-table-inheritance">Single Table Inheritance</a></h1>
<p>Single Table strategy is the simplest and typically the best performing solution. By this inheritance strategy, we can map the whole hierarchy through a single table. The table will have a column for every attribute of every class in the hierarchy and an extra column (also known as <strong>discriminator</strong> column) is created in the table to identify the class.</p>
<h2 id="example-1"><a class="header" href="#example-1">Example</a></h2>
<p>Now suppose you want to map the whole hierarchy given below into a coherent relational database schema. The <strong>Employee</strong> class is a superclass both for <strong>Regular_Employee</strong> and <strong>Contract_Employee</strong> classes. The <strong>type</strong> attribute acts as discriminator column.<br />
The application of the above described pattern leads to the DB schema shown in the following diagram:</p>
<p><img src="teleporter/../images/teleporter-inheritance-single-table.png" alt="" /></p>
<p>The correspondent mapping file for this hierarchy should be:</p>
<pre><code>&lt;?xml version='1.0' encoding='UTF-8'?&gt;  
&lt;!DOCTYPE hibernate-mapping PUBLIC 
   "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
   "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;

&lt;hibernate-mapping&gt;
	&lt;class name="Employee" table="EMPLOYEE"
		discriminator-value="emp"&gt;
		&lt;id name="id" column="id"&gt;
			&lt;generator class="increment"&gt;&lt;/generator&gt;
		&lt;/id&gt;

		&lt;discriminator column="type" type="string"&gt;&lt;/discriminator&gt;
		&lt;property name="name" column="name"&gt;&lt;/property&gt;

		&lt;subclass name="Regular_Employee"
			discriminator-value="reg_emp"&gt;
			&lt;property name="salary" column="salary"&gt;&lt;/property&gt;
			&lt;property name="bonus" column="bonus"&gt;&lt;/property&gt;
		&lt;/subclass&gt;

		&lt;subclass name="Contract_Employee"
			discriminator-value="cont_emp"&gt;
			&lt;property name="payPerHour" column="pay_per_hour"&gt;&lt;/property&gt;
			&lt;property name="contractDuration" column="contract_duration"&gt;&lt;/property&gt;
		&lt;/subclass&gt;
	&lt;/class&gt;
&lt;/hibernate-mapping&gt;  
</code></pre>
<p>Taking advantage of this inheritance-feature on the proposed model above, you will get the following schema in OrientDB:</p>
<p><img src="teleporter/../images/teleporter-inheritance-orientdb-schema.png" alt="" /></p>
<p>If you deal with a multi-level inheritance relationships in the DB, you have to represent them in the ORM file by recursively nesting each definition according to the hierarchical dependencies being between the Entities of the model.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="table-per-class-inheritance"><a class="header" href="#table-per-class-inheritance">Table Per Class Inheritance</a></h1>
<p>Table Per Class strategy is the most logical inheritance solution because it mirrors the object model in the data model. In this pattern a table is defined for each class in the inheritance hierarchy to store only the local attributes of that class.
All classes in the hierarchy must share the same id attribute.</p>
<p>Some JPA providers support Table Per Class Inheritance with or without a discriminator column, some required the discriminator column, and some don't support the discriminator column. This pattern doesn't seem to be fully standardized yet. On Hibernate a discriminator column is supported but not required.</p>
<h2 id="example-2"><a class="header" href="#example-2">Example</a></h2>
<p>Now suppose you want to map the whole hierarchy given below into a coherent relational database schema. The <strong>Employee</strong> class is a superclass both for <strong>Regular_Employee</strong> and <strong>Contract_Employee</strong> classes.<br />
The application of the above described pattern leads to the DB schema shown in the following diagram:</p>
<p><img src="teleporter/../images/teleporter-inheritance-table-class.png" alt="" /></p>
<p>There are two equivalent mapping file to represent this hierarchy:<br />
1.</p>
<pre><code>&lt;?xml version='1.0' encoding='UTF-8'?&gt;  
&lt;!DOCTYPE hibernate-mapping PUBLIC 
   "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
   "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;

&lt;hibernate-mapping&gt;
	&lt;class name="Employee" table="EMPLOOYEE"&gt;
		&lt;id name="id" column="id"&gt;
			&lt;generator class="increment"&gt;&lt;/generator&gt;
		&lt;/id&gt;

		&lt;property name="name" column="name"&gt;&lt;/property&gt;

		&lt;joined-subclass name="Regular_Employee"
			table="REGULAR EMPLOYEE"&gt;
			&lt;key column="eid"&gt;&lt;/key&gt;
			&lt;property name="salary" column="salary"&gt;&lt;/property&gt;
			&lt;property name="bonus" column="bonus"&gt;&lt;/property&gt;
		&lt;/joined-subclass&gt;

		&lt;joined-subclass name="Contract_Employee"
			table="CONTRACT EMPLOYEE"&gt;
			&lt;key column="eid"&gt;&lt;/key&gt;
			&lt;property name="payPerHour" column="pay_per_hour"&gt;&lt;/property&gt;
			&lt;property name="contractDuration" column="contract_duration"&gt;&lt;/property&gt;
		&lt;/joined-subclass&gt;
	&lt;/class&gt;
&lt;/hibernate-mapping&gt;      
</code></pre>
<ol start="2">
<li></li>
</ol>
<pre><code>&lt;?xml version='1.0' encoding='UTF-8'?&gt;  
&lt;!DOCTYPE hibernate-mapping PUBLIC 
   "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
   "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;

&lt;hibernate-mapping&gt;
	&lt;class name="Employee" table="EMPLOYEE"&gt;
		&lt;id name="id" column="id"&gt;
			&lt;generator class="increment"&gt;&lt;/generator&gt;
		&lt;/id&gt;
        &lt;discriminator column="type" type="string" /&gt;
		&lt;property name="name" column="name"&gt;&lt;/property&gt;

		&lt;subclass name="Regular_Employee" discriminator-value="R"&gt;
			&lt;join table="REGULAR EMPLOYEE"&gt;
				&lt;key column="eid"&gt;&lt;/key&gt;
				&lt;property name="salary" column="salary"&gt;&lt;/property&gt;
				&lt;property name="bonus" column="bonus"&gt;&lt;/property&gt;
			&lt;/join&gt;
		&lt;/subclass&gt;

		&lt;subclass name="Contract_Employee" discriminator-value="C"&gt;
			&lt;join table="CONTRACT EMPLOYEE"&gt;
				&lt;key column="eid"&gt;&lt;/key&gt;
				&lt;property name="payPerHour" column="par_per_hour"&gt;&lt;/property&gt;
				&lt;property name="contractDuration" column="contract_duration"&gt;&lt;/property&gt;
			&lt;/join&gt;
		&lt;/subclass&gt;
	&lt;/class&gt;
&lt;/hibernate-mapping&gt;  
</code></pre>
<p>Taking advantage of this inheritance-feature on the proposed model above, you will get the following schema in OrientDB:</p>
<p><img src="teleporter/../images/teleporter-inheritance-orientdb-schema.png" alt="" /></p>
<p>If you deal with a multi-level inheritance relationships in the DB, you have to represent them in the ORM file by recursively nesting each definition according to the hierarchical dependencies being between the Entities of the model.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="table-per-concrete-class-inheritance"><a class="header" href="#table-per-concrete-class-inheritance">Table Per Concrete Class Inheritance</a></h1>
<p>In Table Per Concrete Class strategy a table is defined for each concrete class in the inheritance hierarchy to store all the attributes of that class and all of its superclasses. This strategy is optional in several ORM technologies (e.g. JPA), and querying root or branch classes can be very difficult and inefficient.</p>
<h2 id="example-3"><a class="header" href="#example-3">Example</a></h2>
<p>Now suppose you want to map the whole hierarchy given below into a coherent relational database schema. The <strong>Employee</strong> class is a superclass both for <strong>Regular_Employee</strong> and <strong>Contract_Employee</strong> classes.<br />
The application of the above described pattern leads to the DB schema shown in the following diagram:</p>
<p><img src="teleporter/../images/teleporter-inheritance-table-concrete-class.png" alt="" /></p>
<p>The correspondent mapping file for this hierarchy should be:</p>
<pre><code>&lt;?xml version='1.0' encoding='UTF-8'?&gt;  
&lt;!DOCTYPE hibernate-mapping PUBLIC 
   "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
   "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;

&lt;hibernate-mapping&gt;
	&lt;class name="Employee" table="EMPLOYEE"&gt;
		&lt;id name="id" column="id"&gt;
			&lt;generator class="increment"&gt;&lt;/generator&gt;
		&lt;/id&gt;

		&lt;property name="name"  column="name"&gt;&lt;/property&gt;

		&lt;union-subclass name="Regular_Employee"
			table="REGULAR EMPLOYEE"&gt;
			&lt;property name="salary" column="salary"&gt;&lt;/property&gt;
			&lt;property name="bonus" column="bonus"&gt;&lt;/property&gt;
		&lt;/union-subclass&gt;

		&lt;union-subclass name="Contract_Employee"
			table="CONTRACT EMPLOYEE"&gt;
			&lt;property name="payPerHour" column="pay_per_hour"&gt;&lt;/property&gt;
			&lt;property name="contractDuration" column="contract_duration"&gt;&lt;/property&gt;
		&lt;/union-subclass&gt;
	&lt;/class&gt;
&lt;/hibernate-mapping&gt;      
</code></pre>
<p>Taking advantage of this inheritance-feature on the proposed model above, you will get the following schema in OrientDB:</p>
<p><img src="teleporter/../images/teleporter-inheritance-orientdb-schema.png" alt="" /></p>
<p>If you deal with a multi-level inheritance relationships in the DB, you have to represent them in the ORM file by recursively nesting each definition according to the hierarchical dependencies being between the Entities of the model.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="import-configuration"><a class="header" href="#import-configuration">Import Configuration</a></h1>
<p>It's possible to specify an import configuration by writing down a <strong>configuration file in JSON format</strong> and passing its location to Teleporter through the argument <code>-conf</code>:</p>
<pre><code>./oteleporter.sh -jdriver &lt;jdbc-driver&gt; -jurl &lt;jdbc-url&gt; -juser &lt;username&gt; 
                -jpasswd &lt;password&gt; -ourl &lt;orientdb-url&gt; [-s &lt;strategy&gt;]
                [-nr &lt;name-resolver&gt;] [-v &lt;verbose-level&gt;] 
                ([-include &lt;table-names&gt;] | [-exclude &lt;table-names&gt;]) 
                [-inheritance &lt;orm-technology&gt;:&lt;ORM-file-url&gt;] 
                [-conf &lt;configuration-file-location&gt;]


</code></pre>
<p>For example if you want enrich your migration from Postgresql with a configuration file <code>migration-config.json</code> located in the <code>/tmp</code> folder you can type:</p>
<pre><code>./oteleporter.sh -jdriver postgresql -jurl jdbc:postgresql://localhost:5432/testdb 
                -juser username -jpasswd password -ourl plocal:$ORIENTDB_HOME/databases/testdb 
                -conf /tmp/migration-config.json

</code></pre>
<p>After the first migration, the graph database will be built and the configuration you passed as argument to Teleporter <strong>will be copied into the database</strong> folder in a path like that:</p>
<pre><code>$ORIENDB_HOME/databases/testdb/teleporter-config/migration-config.json
</code></pre>
<p>In the following executions the new configuration in your database will be processed automatically, making coherent and simpler the synchronization procedure. If you want change any setting you can modify directly that file.<br />
In fact Teleporter, at execution time, <strong>sequentially looks for</strong>:</p>
<ol>
<li>the configuration file <code>migration-config.json</code> in the database directory <strong>$ORIENDB_HOME/databases/testdb/teleporter-config/</strong></li>
<li>if no config file will be found, then a <strong>potential input config</strong> will be considered</li>
<li>if no config file was passed as argument the <strong>migration will be performed without any configuration</strong></li>
</ol>
<h2 id="relationship-configuration"><a class="header" href="#relationship-configuration">Relationship configuration</a></h2>
<p>The configuration allows you to <strong>manage the relationships of your database domain</strong>.<br />
To comprehend the importance of this feature we have to consider that Teleporter builds the schema in OrientDB and carries out the migration starting from the source DB schema: <strong>Vertices and Edges are built starting from Entities (tables) and Relationships (foreign keys)</strong> which are inferred from your database metadata.<br />
Therefore if you didn't defined some constraints, such as foreign keys between the tables on which you usually perform join operations, you will lose this kind of info during the importing process.<br />
To be clear <strong>if no foreign keys are declared in the schema, you will not have any edges in your final Graph Database</strong>.</p>
<p>So if some constraints are not defined in your schema for performance reasons, submitting a configuration file is essential in order to obtain a complete graph model and perform a good and effective migration to OrientDB.</p>
<p>You can do that by <strong>enriching the basic mapping</strong> of Teleporter between the <strong>E-R model and the Graph Model</strong> to customize your importing. You can add new relationships or modify info about relationships already defined in your database schema, interacting directly on the domains-mapping carried out by Teleporter.<br />
Each Relationship expressed in your schema through a foreign key will be transformed into an Edge class in the graph model according to automatic choices that implicate:</p>
<ul>
<li>the <strong>name</strong> of the Edge</li>
<li>the <strong>direction</strong> of the Edge</li>
<li>the <strong>properties</strong> of the Edge</li>
<li>the <strong>type</strong> of each property and potential constraints (mandatory, readOnly, notNull)</li>
</ul>
<p>So you can intervene in this mapping and make your personal choices.</p>
<p>Let's start to analyse the syntax in order to examine the two main actions you can manage during the migration:</p>
<ul>
<li><strong>adding relationships</strong> not declared in your schema</li>
<li><strong>modifying relationships</strong> present in your schema</li>
</ul>
<p>###Adding Relationships</p>
<p>The JSON syntax of the <strong>configuration file</strong> will appear very intuitive if you bear in mind that it <strong>reflects the mapping between the E-R model and the Graph Model</strong>.<br />
Let's consider the configuration below:</p>
<pre><code>{
	"edges": [{
		"WorksAtProject": {
			"mapping": {
				"fromTable": "EMPLOYEE",
				"fromColumns": ["PROJECT"],
				"toTable": "PROJECT",
				"toColumns": ["ID"],
				"direction": "direct"
			},
			"properties": {
				"updatedOn": {
					"type": "DATE",
					"mandatory": true,
					"readOnly": false,
					"notNull": false
				}
			}
		}
	}]
}
</code></pre>
<p>We are defining all the edges we want to map through the key <code>edges</code> which contains an array of elements. Each element in the array is an <strong>Edge class definition containing the mapping with a Relationship</strong> in the relational model.<br />
Let's suppose we have two entities "Employee" and "Project" in our database with a logical Relationship between them: starting from an Employee you can navigate the Projects he's working at.</p>
<pre><code>		  EMPLOYEE                                                     PROJECT
	      (Foreign Table)                                              (Parent Table)
 ________________________________________________                _____________________________________
|       |              |             |           |              |       |         |                   |
|  ID   |  FIRST_NAME  |  LAST_NAME  |  PROJECT  |              |  ID   |  TITLE  |  PROJECT_MANAGER  |
|_______|______________|_____________|___________|              |_______|_________|___________________|
|       |              |             |           |              |       |         |                   |
|       |              |             |           |              |       |         |                   |
|_______|______________|_____________|___________|              |_______|_________|___________________|


</code></pre>
<p>Without a foreign key definition we lose this Relationship and we obtain a graph model without the correspondent Edge class; consequently no edges between vertices of class "Employee" and vertices of class "Project" will be present.</p>
<p>&lt;img: tables without FK -- graph model wihtout edge class -- graph without edges&gt;</p>
<p>Through this mapping we can <strong>overcome the lack of a foreign key</strong> and recover the lost info.<br />
Let's take a look closer to the <strong>edge mapping</strong>:</p>
<pre><code>{
	"WorksAtProject": {
		"mapping": {
			"fromTable": "EMPLOYEE",
			"fromColumns": ["PROJECT"],
			"toTable": "PROJECT",
			"toColumns": ["ID"],
			"direction": "direct"
		},
		"properties": {
			"updatedOn": {
				"type": "DATE",
				"mandatory": true,
				"readOnly": false,
				"notNull": false
			}
		}
	}
}
</code></pre>
<p>We are mapping the Edge class "WorksAtProject" with a Relationship with cardinality 1-N between "Employee" and "Project" on the basis of 4 essential values:</p>
<ul>
<li><strong>fromTable</strong>: the foreign entity that imports the primary key of the parent table. In the example it's the "EMPLOYEE" table.</li>
<li><strong>fromColumns</strong>: the attributes involved in the foreign key. In the example it's the "PROJECT" column in the "EMPLOYEE" table.</li>
<li><strong>toTable</strong>: the parent entity whose primary key is imported by the foreign table. In the example it's the "PROJECT" table.</li>
<li><strong>toColumns</strong>: the attributes involved in the primary key imported. In the example it's the "ID" column in the "PROJECT" table.</li>
</ul>
<p>As this Relationship is not declared in your database, it will be added and the correspondent Edge will be built according to the other info you can set.</p>
<p>With the key <code>direction</code> you can express the direction of the edges between the vertices. You can set this argument with two different values:</p>
<ul>
<li><strong>direct</strong>: the edge will reflect the direction of the relationship.</li>
<li><strong>inverse</strong>: the edge will have opposite direction respect to the relationship.</li>
</ul>
<p>So if we define in the configuration file a relationship as follows:</p>
<pre><code>"WorksAtProject": {
		"mapping": {
			"fromTable": "EMPLOYEE",
			"fromColumns": ["PROJECT"],
			"toTable": "PROJECT",
			"toColumns": ["ID"],
			"direction": "direct"
		},
 		...
}
</code></pre>
<p>a new Relationship will be added</p>
<pre><code>EMPLOYEE -----------------------------&gt; PROJECT
	   fromTable    =  EMPOYEE
	   toTable      =  PROJECT
	   fromColumns  =  [PROJECT]
	   TOColumns    =  [ID]
</code></pre>
<p>and choosing "direct" direction, or don't declaring anything about that, we will obtain an Edge like that:</p>
<pre><code>Employee ----[WorksAtProject]----&gt; Project
</code></pre>
<p>Suppose we want have the <strong>inverse logical navigation</strong> in the graph database that we could not express in the relational model.<br />
Here is the configuration we must use:</p>
<pre><code>		"HasCommittedEmployee": {
			"mapping": {
				"fromTable": "EMPLOYEE",
				"fromColumns": ["PROJECT"],
				"toTable": "PROJECT",
				"toColumns": ["ID"],
				"direction": "inverse"
			},
			...
		}
</code></pre>
<p>In this case the <strong>same relationship</strong> of the previous example will be built</p>
<pre><code>EMPLOYEE -----------------------------&gt; PROJECT
	   fromTable    =  EMPOYEE
	   toTable      =  PROJECT
	   fromColumns  =  [PROJECT]
	   TOColumns    =  [ID]
</code></pre>
<p>but the correspondent <strong>Edge will have inverse direction</strong></p>
<pre><code>Employee &lt;----[???]----- Project
</code></pre>
<p>and for this reason we have changed the name of the Edge in "HasCommittedEmployee" so that the name of the class makes sense:</p>
<pre><code>Employee &lt;----[HasCommittedEmployee]----- Project
</code></pre>
<p><strong>Remember: direction refers to edges in the graph, not to relationships in your database.</strong> Relationships must be always coherent with the structure of the tables.</p>
<p>As you can see it's possible to <strong>define additional properties</strong> for the final edge:</p>
<pre><code>{
	"WorksAtProject": {
		"mapping": {
			"fromTable": "EMPLOYEE",
			"fromColumns": ["PROJECT"],
			"toTable": "PROJECT",
			"toColumns": ["ID"],
			"direction": "direct"
		},
		"properties": {
			"updatedOn": {
				"type": "DATE",
				"mandatory": true,
				"readOnly": false,
				"notNull": false
			}
		}
	}
}

</code></pre>
<p>In the example above we added a property named <code>updatedOn</code> of type OType.DATE to our Edge class.<br />
For each new defined property you can declare the following values:</p>
<ul>
<li><strong>type</strong>: it's the OrientDB type. This value is mandatory, if not declared the property is not added to the Edge.</li>
<li><strong>mandatory</strong>: adds the mandatory constraint to the property and applies to it the specified value (true or false).</li>
<li><strong>readOnly</strong>: adds the readOnly constraint to the property and applies to it the specified value (true or false).</li>
<li><strong>notNull</strong>: adds the notNull constraint to the property and applies to it the specified value (true or false).</li>
</ul>
<p>By omitting a constraint or setting it to false you will have the same result: the constraint is not considered for the specific property.</p>
<p>###Modifying existent Relationships</p>
<p>If the relationship you are mapping is already present in your database, it will be overridden with the parameters you defined in the configuration.<br />
In this way you can <strong>change the name and the direction of the Edge class correspondent to a relationship already present</strong> in the database schema.<br />
Let's suppose we have a foreign key between "Employee" and "Project":</p>
<pre><code>		  EMPLOYEE                                                          PROJECT
	      (Foreign Table)                                                   (Parent Table)
 ________________________________________________                    _____________________________________
|       |              |             |           |        R         |       |         |                   |
|  ID   |  FIRST_NAME  |  LAST_NAME  |  PROJECT  |   -----------&gt;   |  ID   |  TITLE  |  PROJECT_MANAGER  |
|_______|______________|_____________|___________|                  |_______|_________|___________________|
|       |              |             |           |                  |       |         |                   |
|       |              |             |           |                  |       |         |                   |
|_______|______________|_____________|___________|                  |_______|_________|___________________|


</code></pre>
<p>In this case through the automated mapping of Teleporter we will obtain the following graph model:</p>
<p>&lt;graph-model with edge hasProject + graph&gt;</p>
<pre><code>Employee ----[HasProject]----&gt; Project
</code></pre>
<p>In case we want reach a different result from the migration we can <strong>change the attributes of the relationship</strong> declaring them in the mapping.<br />
Teleporter will <strong>recognize the relationship</strong> you want override on the basis of the values:</p>
<ul>
<li><strong>fromTable</strong></li>
<li><strong>fromColumns</strong></li>
<li><strong>toTable</strong></li>
<li><strong>toColumns</strong></li>
</ul>
<p><strong>These values must to be coherent with the direction of the foreign key representing the above-mentioned Relationship. Otherwise Teleporter will interpret the relationship as a new one</strong>.<br />
So if for example we want override the Edge built starting from the relationship</p>
<pre><code>EMPLOYEE -----------------------------&gt; PROJECT
	   fromTable    =  EMPOYEE
	   toTable      =  PROJECT
	   fromColumns  =  [PROJECT]
	   TOColumns    =  [ID]
</code></pre>
<p>but we define the mapping as follows:</p>
<pre><code>	"WorksAtProject": {
		"mapping": {
			"fromTable": "PROJECT",
			"fromColumns": ["ID"],
			"toTable": "EMPLOYEE",
			"toColumns": ["PROJECT"],
			"direction": "direct"
		},
		...
	}
</code></pre>
<p>as result we will obtain the adding of a second relationship with inverted direction between the two tables:</p>
<pre><code>PROJECT -----------------------------&gt; EMPLOYEE
	   fromTable    =  PROJECT
	   toTable      =  EMPLOYEE
	   fromColumns  =  [ID]
	   TOColumns    =  [PROJECT]
</code></pre>
<p>So in the graph model we will have two Edge classes (the second one is totally wrong):</p>
<pre><code>Employee ----[HasProject]-------&gt; Project
Employee &lt;---[WorksAtProject]---- Project
</code></pre>
<p>So remember to <strong>be coherent with the underlying physical schema</strong> during the mapping definition:</p>
<p>Mapping:</p>
<pre><code>	"WorksAtProject": {
		"mapping": {
			"fromTable": "EMPLOYEE",
			"fromColumns": ["PROJECT"],
			"toTable": "PROJECT",
			"toColumns": ["ID"],
			"direction": "direct"
		},
		...
	}
</code></pre>
<p>Relationship in the E-R model:</p>
<pre><code>EMPLOYEE -----------------------------&gt; PROJECT
	   fromTable    =  EMPOYEE
	   toTable      =  PROJECT
	   fromColumns  =  [PROJECT]
	   TOColumns    =  [ID]
</code></pre>
<p>Resulting Graph Model:</p>
<pre><code>Employee ----[WorksAtProject]-------&gt; Project
</code></pre>
<p>If you want <strong>change the direction of the Edge</strong> you can exploit the option <code>direction</code> as described in the previous paragraph:</p>
<pre><code>	"HasCommittedEmployee": {
		"mapping": {
			"fromTable": "EMPLOYEE",
			"fromColumns": ["PROJECT"],
			"toTable": "PROJECT",
			"toColumns": ["ID"],
			"direction": "inverse"
		}
	}
</code></pre>
<p>Relationship in the E-R model:</p>
<pre><code>EMPLOYEE -----------------------------&gt; PROJECT
	   fromTable    =  EMPOYEE
	   toTable      =  PROJECT
	   fromColumns  =  [PROJECT]
	   TOColumns    =  [ID]
</code></pre>
<p>Resulting Graph Model:</p>
<pre><code>Project ----[HasCommittedEmployee]-------&gt; Employee
</code></pre>
<p>You can also <strong>add properties</strong> to the Edge class using the syntax already defined in the previous paragraph:</p>
<pre><code>{
	"WorksAtProject": {
		"mapping": {
			"fromTable": "EMPLOYEE",
			"fromColumns": ["PROJECT"],
			"toTable": "PROJECT",
			"toColumns": ["ID"],
			"direction": "direct"
		},
		"properties": {
			"updatedOn": {
				"type": "DATE",
				"mandatory": true,
				"readOnly": false,
				"notNull": false
			}
		}
	}
}
</code></pre>
<p>In the example above we added a properties with name "updatedOn" of type OType.DATE to our Edge class and we set only the constraint mandatory.</p>
<p>###Configuring aggregation strategy</p>
<p>Teleporter offers two importing strategies as described in the <a href="teleporter/Teleporter-Execution-Strategies.html">Execution strategies</a> page:</p>
<ul>
<li><strong>naive</strong> strategy: no aggregations are executed</li>
<li><strong>naive-aggregate</strong> strategy: aggregations can be executed</li>
</ul>
<p>The aggregation is performed on join tables of dimension equals to 2 (other join tables are ignored), that is to say those tables which allow joins only between two tables.<br />
Each candidate join table is converted into an appropriate Edge class, and each field not involved in any relationship with other tables (hence not involved in any foreign key in the source database schema) is aggregated in the properties of the new built Edge.</p>
<p>If no foreign keys are defined for a specific join table the aggregation will not be performed and no edges will represent the N-N relationship.<br />
Through the configuration you can overcome this limit and kill two birds with one stone: in fact you can <strong>declare the two relationships with the external tables and define the mapping with an Aggregator-Edge in one shot</strong>.</p>
<p>Let's suppose we have a N-N relationship between two tables "Film" and "Actor" without foreign keys defined in the schema.</p>
<pre><code>                 ACTOR                                    ACTOR_FILM                                FILM
                                                         (Join Table)
 ____________________________________        ____________________________________        ______________________________
|       |              |             |      |            |           |           |      |       |         |            |
|  ID   |  FIRST_NAME  |  LAST_NAME  |      |  ACTOR_ID  |  FILM_ID  |  PAYMENT  |      |  ID   |  TITLE  |  CATEGORY  |   
|_______|______________|_____________|      |____________|___________|___________|      |_______|_________|____________|
|       |              |             |      |            |           |           |      |       |         |            |
|       |              |             |      |            |           |           |      |       |         |            |
|_______|______________|_____________|      |____________|___________|___________|      |_______|_________|____________|


</code></pre>
<p>We want obtain an aggregated structure as follows:</p>
<pre><code>Actor ----[Performs]-------&gt; Film
</code></pre>
<p>In this case we have to use this syntax:</p>
<pre><code>{
	"Performs": {
		"mapping": {
			"fromTable": "ACTOR",
			"fromColumns": ["ID"],
			"toTable": "FILM",
			"toColumns": ["ID"],
			"joinTable": {
				"tableName": "ACTOR_FILM",
				"fromColumns": ["ACTOR_ID"],
				"toColumns": ["FILM_ID"]
			},
			"direction": "direct"
		},
		"properties": {
		 ...
		}
	}
}
</code></pre>
<p>We can implicitly define the <strong>direction</strong> of the Edge by choosing:</p>
<ul>
<li>the <strong>from-table</strong></li>
<li>the <strong>to-table</strong></li>
</ul>
<p>In our example we decided to express the relationship between Actors and Films through a "Performs" Edge starting from Actor vertices and ending into Film vertices.</p>
<p>Once again we can exploit the semantics of the <code>direction</code> key to reverse the final edge:</p>
<pre><code>{
	"HasActor": {
		"mapping": {
			"fromTable": "ACTOR",
			"fromColumns": ["ID"],
			"toTable": "FILM",
			"toColumns": ["ID"],
			"joinTable": {
				"tableName": "ACTOR_FILM",
				"fromColumns": ["ACTOR_ID"],
				"toColumns": ["FILM_ID"]
			},
			"direction": "inverse"
		},
		"properties": {

		}
	}
}
</code></pre>
<p>In this way we can have the following schema:</p>
<pre><code>Film ------[HasActor]------&gt; Actor
```	

When you are taking advantage of this aggregating feature you have to define an **additional field** `join table` as shown in the example.

</code></pre>
<pre><code>"joinTable": {
	"tableName": "ACTOR_FILM",
	"fromColumns": ["ACTOR_ID"],
	"toColumns": ["FILM_ID"]
}
</code></pre>
<pre><code>
In this field you have to specify:

- **tableName**: the name of the join table which will be aggregated into the declared Edge.
- **fromColumns**: the columns of the join table involved in the relationship with the "from-table".
- **toColumns**: the columns of the join table involved in the relationship with the "to-table".

**This info is essential** for Teleporter to infer all the single relationships between the records of the two external tables "ACTOR" and "FILM" and to build all the edges coherently, so if you don't declare any of these fields an **exception** will be thrown.

Remember that this syntax offers a shortcut to configure relationships and aggregation choices, thus **you can use it only when you are executing the aggregation strategy**.  
Performing your migration with a naive strategy using this syntax makes no sense, and here again an exception will be thrown.







</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-12-11 SAM -->
<h1 id="etl"><a class="header" href="#etl">ETL</a></h1>
<p>The Extractor Transformer and Loader, or ETL, module for OrientDB provides support for moving data to and from OrientDB databases using <a href="http://en.wikipedia.org/wiki/Extract,_transform,_load">ETL processes</a>.</p>
<ul>
<li><a href="etl/Configuration-File.html">Configuration</a>: The ETL module uses a configuration file, written in JSON.</li>
<li><a href="etl/Extractor.html">Extractor</a> Pulls data from the source database.</li>
<li><a href="etl/Transformer.html">Transformers</a> Convert the data in the pipeline from its source format to one accessible to the target database.</li>
<li><a href="etl/Loader.html">Loader</a> loads the data into the target database.</li>
</ul>
<h2 id="how-etl-works"><a class="header" href="#how-etl-works">How ETL Works</a></h2>
<p>The ETL module receives a backup file from another database, it then converts the fields into an accessible format and loads it into OrientDB.</p>
<pre><code>EXTRACTOR =&gt; TRANSFORMERS[] =&gt; LOADER
</code></pre>
<p>For example, consider the process for a CSV file.  Using the ETL module, OrientDB loads the file, applies whatever changes it needs, then stores the record as a document into the current OrientDB database.</p>
<pre><code>+-----------+-----------------------+-----------+
|           |              PIPELINE             |
+ EXTRACTOR +-----------------------+-----------+
|           |     TRANSFORMERS      |  LOADER   |
+-----------+-----------------------+-----------+
|   FILE   ==&gt;  CSV-&gt;FIELD-&gt;MERGE  ==&gt; OrientDB |
+-----------+-----------------------+-----------+
</code></pre>
<h2 id="usage-5"><a class="header" href="#usage-5">Usage</a></h2>
<p>To use the ETL module, run the <code>oetl.sh</code> script with the configuration file given as an argument.</p>
<pre>
$ <code class="lang-sh userinput">$ORIENTDB_HOME/bin/oetl.sh config-dbpedia.json</code>
</pre>
<div class="table-wrapper"><table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td><img src="etl/../images/warning.png" alt="NOTE" /></td><td><em>NOTE: If you are importing data for use in a distributed database, then you must set <code>ridBag.embeddedToSbtreeBonsaiThreshold=Integer.MAX\_VALUE</code> for the ETL process to avoid replication errors, when the database is updated online.</em></td></tr>
</tbody></table>
</div>
<h3 id="run-time-configuration"><a class="header" href="#run-time-configuration">Run-time Configuration</a></h3>
<p>When you run the ETL module, you can define its configuration variables by passing it a JSON file, which the ETL module resolves at run-time by passing them as it starts up.</p>
<p>You could also define the values for these variables through command-line options.  For example, you could assign the database URL as <code>${databaseURL}</code>, then pass the relevant argument through the command-line:</p>
<pre>
$ <code class="lang-sh userinput">$ORIENTDB_HOME/bin/oetl.sh config-dbpedia.json \
      -databaseURL=plocal:/tmp/mydb</code>
</pre>
<p>When the ETL module initializes, it pulls <code>/tmp/mydb</code> from the command-line to define this variable in the configuration file.</p>
<h2 id="available-components"><a class="header" href="#available-components">Available Components</a></h2>
<ul>
<li><a href="etl/Block.html">Blocks</a></li>
<li><a href="etl/Source.html">Sources</a></li>
<li><a href="etl/Extractor.html">Extractors</a></li>
<li><a href="etl/Transformer.html">Transformers</a></li>
<li><a href="etl/Loader.html">Loaders</a></li>
</ul>
<p>Examples:</p>
<ul>
<li><a href="etl/../gettingstarted/tutorials/Import-the-Database-of-Beers.html">Import the database of Beers</a></li>
<li><a href="etl/Import-from-CSV-to-a-Graph.html">Import from CSV to a Graph</a></li>
<li><a href="etl/Import-from-JSON.html">Import from JSON</a></li>
<li><a href="etl/Import-from-DBPedia.html">Import DBPedia</a></li>
<li><a href="etl/Import-from-DBMS.html">Import from a DBMS</a></li>
<li><a href="etl/Import-from-PARSE.html">Import from Parse (Facebook)</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-12-11 SAM -->
<h1 id="etl---configuration"><a class="header" href="#etl---configuration">ETL - Configuration</a></h1>
<p>OrientDB manages configuration for the ETL module through a single JSON configuration file, called at execution.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-json">{
  "config": {
    &lt;name&gt;: &lt;value&gt;
  },
  "begin": [
    { &lt;block-name&gt;: { &lt;configuration&gt; } }
  ],
  "source" : {
    { &lt;source-name&gt;: { &lt;configuration&gt; } }
  },
  "extractor" : {
    { &lt;extractor-name&gt;: { &lt;configuration&gt; } }
  },
  "transformers" : [
    { &lt;transformer-name&gt;: { &lt;configuration&gt; } }
  ],
  "loader" : { &lt;loader-name&gt;: { &lt;configuration&gt; } },
  "end": [
   { &lt;block-name&gt;: { &lt;configuration&gt; } }
  ]
}
</code></pre>
<ul>
<li><strong><code>"config"</code></strong> Manages all settings and context variables used by any component of the process.</li>
<li><strong><code>"source"</code></strong> Manages the source data to process.</li>
<li><strong><code>"begin"</code></strong> Defines a list of <a href="etl/Block.html">blocks</a> to execute in order when the process begins.</li>
<li><strong><code>"extractor"</code></strong> Manages the <a href="etl/Extractor.html">extractor</a> settings.</li>
<li><strong><code>"transformers"</code></strong> Defines a list of <a href="etl/Transformer.html">transformers</a> to execute in the pipeline.</li>
<li><strong><code>"loader"</code></strong> Manages the <a href="etl/Loader.html">loader</a> settings.</li>
<li><strong><code>"end"</code></strong> Defines a list of <a href="etl/Block.html">blocks</a> to execute in order when the process finishes.</li>
</ul>
<p><strong>Example</strong></p>
<pre><code class="language-json">{
  "config": {
    "log": "debug",
    "fileDirectory": "/temp/databases/dbpedia_csv/",
    "fileName": "Person.csv.gz"
  },
  "begin": [
   { "let": { "name": "$filePath",  "value": "$fileDirectory.append( $fileName )"} },
   { "let": { "name": "$className", "value": "$fileName.substring( 0, $fileName.indexOf(".") )"} }
  ],
  "source" : {
    "file": { "path": "$filePath", "lock" : true }
  },
  "extractor" : {
    "row": {}
  },
  "transformers" : [
   { "csv": { "separator": ",", "nullValue": "NULL", "skipFrom": 1, "skipTo": 3 } },
   { "merge": { "joinFieldName":"URI", "lookup":"V.URI" } },
   { "vertex": { "class": "$className"} }
  ],
  "loader" : {
    "orientdb": {
      "dbURL": "plocal:/temp/databases/dbpedia",
      "dbUser": "admin",
      "dbPassword": "admin",
      "dbAutoCreate": true,
      "tx": false,
      "batchCommit": 1000,
      "dbType": "graph",
      "indexes": [{"class":"V", "fields":["URI:string"], "type":"UNIQUE" }]
    }
  }
}
</code></pre>
<h2 id="general-rules"><a class="header" href="#general-rules">General Rules</a></h2>
<p>In developing a configuration file for ETL module processes, consider the following:</p>
<ul>
<li>
<p>You can use context variables by prefixing them with the <code>$</code> sign.</p>
</li>
<li>
<p>It assigns the <code>$input</code> context variable before each transformation.</p>
</li>
<li>
<p>You can execute an expression in OrientDB SQL with the <code>={&lt;expression&gt;}</code> syntax.  For instance,</p>
<pre><code class="language-json">"field": ={EVAL('3 * 5)}
</code></pre>
</li>
</ul>
<h3 id="conditional-execution"><a class="header" href="#conditional-execution">Conditional Execution</a></h3>
<p>In conditional execution, OrientDB only runs executable blocks, such as <a href="etl/Transformer.html">transformers</a> and <a href="etl/Block.html">blocks</a>, when a condition is found true, such as with a <a href="etl/../sql/SQL-Where.html"><code>WHERE</code></a> clause.</p>
<p>For example,</p>
<pre><code class="language-json">{ "let": {
    "name": "path",
    "value": "C:/Temp",
    "if": "${os.name} = 'Windows'"
  }
},
{ "let": {
    "name": "path",
    "value": "/tmp",
    "if": "${os.name}.indexOf('nux')"
  }
}
</code></pre>
<h3 id="log-setting"><a class="header" href="#log-setting">Log setting</a></h3>
<p>Most blocks, such <a href="etl/Transformer.html">transformers</a> and <a href="etl/Block.html">blocks</a>, support the <code>"log"</code> setting.  Logs take one of the following logging levels, (which are case-insensitive),: <code>NONE</code>, <code>ERROR</code>, <code>INFO</code>, <code>DEBUG</code>.  By default, it uses the <code>INFO</code> level.
ETL uses the <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/logging/overview.html">Java util logging</a> and writes logs on the console and on a dedicated rolling file. A dedicated configuration file (<code>orientdb-etl-log.properties</code>) is present under the <code>config</code> directory of the OrientDB distribution.
ETL logging levels are mapped to JUL levels:</p>
<div class="table-wrapper"><table><thead><tr><th>ETL level</th><th>JUL level</th></tr></thead><tbody>
<tr><td><code>"NONE"</code></td><td><code>"OFF"</code></td></tr>
<tr><td><code>"INFO"</code></td><td><code>"INFO"</code></td></tr>
<tr><td><code>"DEBUG"</code></td><td><code>"FINE"</code></td></tr>
<tr><td><code>"ERROR"</code></td><td><code>"SEVERE"</code></td></tr>
</tbody></table>
</div>
<p>Setting the log-level to <code>DEBUG</code> displays more information on execution.  It also slows down execution, so use it only for development and debugging purposes.</p>
<pre><code class="language-json">{ "http": {
    "url": "http://ip.jsontest.com/",
    "method": "GET",
    "headers": {
      "User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/36.0.1985.125 Safari/537.36"
    },
    "log": "DEBUG"
  }
}
</code></pre>
<h3 id="configuration-variables"><a class="header" href="#configuration-variables">Configuration Variables</a></h3>
<p>The ETL module binds all values declared in the <code>"config"</code> block to the execution context and are accessible to ETL processing.  There are also some special variables used by the ETL process.</p>
<div class="table-wrapper"><table><thead><tr><th>Variable</th><th>Description</th><th>Type</th><th>Default value</th></tr></thead><tbody>
<tr><td><code>"log"</code></td><td>Defines the global logging level.  The accepted levels are: <code>NONE</code>, <code>ERROR</code>, <code>INFO</code>, and <code>DEBUG</code>. This parameter is useful to debug a ETL process or single component.</td><td>string</td><td><code>INFO</code></td></tr>
<tr><td><code>"maxRetries"</code></td><td>Defines the maximum number of retries allowed, in the event that the loader raises an <code>ONeedRetryException</code>, for concurrent modification of the same record.</td><td>integer</td><td>10</td></tr>
<tr><td><code>"parallel"</code></td><td>Defines whether the ETL module executes pipelines in parallel, using all available cores.</td><td>boolean</td><td><code>false</code></td></tr>
<tr><td><code>"haltOnError"</code></td><td>Defines whether the ETL module halts the process when it encounters unmanageable errors.  When set to <code>false</code>, the process continues in the event of errors.  It reports the number of errors it encounters at the end of the import.  This feature was introduced in version 2.0.9.</td><td>boolean</td><td><code>true</code></td></tr>
</tbody></table>
</div>
<h3 id="split-configuration-on-multiple-files"><a class="header" href="#split-configuration-on-multiple-files">Split Configuration on Multiple Files</a></h3>
<p>You can split the configuration into several files allowing for the composition of common parts such as paths, URL's and database references.</p>
<p>For example, you might split the above configuration into two files: one with the input paths for <code>Person.csv</code> specifically, while the other would contain common configurations for the ETL module.</p>
<pre>
$ <code class="lang-sh userinput">cat personConfig.json</code>
<code class="lang-json">
{
  "config": {
    "log": "debug",
    "fileDirectory": "/temp/databases/dbpedia_csv/",
    "fileName": "Person.csv.gz"
  }
}</code>

$ <code class="lang-sh userinput">cat commonConfig.json</code>
<code class="lang-json">
{
  "begin": [
   { "let": { "name": "$filePath",  "value": "$fileDirectory.append( $fileName )"} },
   { "let": { "name": "$className", "value": "$fileName.substring( 0, $fileName.indexOf(".") )"} }
  ],
  "source" : {
    "file": { "path": "$filePath", "lock" : true }
  },
  "extractor" : {
    "row": {}
  },
  "transformers" : [
   { "csv": { "separator": ",", "nullValue": "NULL", "skipFrom": 1, "skipTo": 3 } },
   { "merge": { "joinFieldName":"URI", "lookup":"V.URI" } },
   { "vertex": { "class": "$className"} }
  ],
  "loader" : {
    "orientdb": {
      "dbURL": "plocal:/temp/databases/dbpedia",
      "dbUser": "admin",
      "dbPassword": "admin",
      "dbAutoCreate": true,
      "tx": false,
      "batchCommit": 1000,
      "dbType": "graph",
      "indexes": [{"class":"V", "fields":["URI:string"], "type":"UNIQUE" }]
    }
  }
}</code>
</pre>
<p>Then, when you can call both configuration files when you run the ETL module:</p>
<pre>
$ <code class="lang-sh userinput">$ORIENTDB_HOME/bin/oetl.sh commonConfig.json personConfig.json</code>
</pre>
<h3 id="run-time-configuration-1"><a class="header" href="#run-time-configuration-1">Run-time configuration</a></h3>
<p>In the configuration file for the ETL module, you can define variables that the module resolves at run-time by passing them as command-line options.  Values passed in this manner <em>override</em> the values defined in the <code>"config"</code> section, even when you use multiple configuration files.</p>
<p>For instance, you might set the configuration variable in the file to <code>${databaseURL}</code>, then define it through the command-line using:</p>
<pre>
$ <code class="lang-sh userinput">$ORIENTDB_HOME/bin/oetl.sh config-dbpedia.json \
      -databaseURL=plocal:/tmp/mydb</code>
</pre>
<p>In this case, the <code>databaseURL</code> parameter is set in the <code>"config"</code> section to <code>/tmp/mydb</code>, overriding any value given the file.</p>
<pre><code class="language-json">{
  "config": {
    "log": "debug",
    "fileDirectory": "/temp/databases/dbpedia_csv/",
    "fileName": "Person.csv.gz"
    "databaseUrl": "plocal:/temp/currentDb"
  },
  ...
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="etl---blocks"><a class="header" href="#etl---blocks">ETL - Blocks</a></h1>
<p>When OrientDB executes the ETL module, blocks in the ETL configuration define components to execute in the process. The ETL module in OrientDB supports the following types of blocks:</p>
<ul>
<li><a href="etl/Block.html#let-blocks"><code>"let"</code></a></li>
<li><a href="etl/Block.html#code-blocks"><code>"code"</code></a></li>
<li><a href="etl/Block.html#console-blocks"><code>"console"</code></a></li>
</ul>
<h2 id="let-blocks"><a class="header" href="#let-blocks">Let Blocks</a></h2>
<p>In a <code>"let"</code> block, you can define variables to the ETL process context.</p>
<ul>
<li>Component name: <code>let</code></li>
</ul>
<p><strong>Syntax</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th style="text-align: center">Mandatory</th><th>Default value</th></tr></thead><tbody>
<tr><td><code>"name"</code></td><td>Defines the variable name.  The ETL process ignores any values with the <code>$</code> prefix.</td><td>string</td><td style="text-align: center">yes</td><td></td></tr>
<tr><td><code>"value"</code></td><td>Defines the fixed value to assign.</td><td>an</td><td style="text-align: center"></td><td></td></tr>
<tr><td><code>"expression"</code></td><td>Defines an expression in the OrientDB SQL language to evaluate and assign.</td><td>string</td><td style="text-align: center"></td><td></td></tr>
</tbody></table>
</div>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Assign a value to the file path variable</p>
<pre><code class="language-json">{ 
  "let": { 
    "name": "$filePath",
    "value": "/temp/myfile"
  } 
}
</code></pre>
</li>
<li>
<p>Concat the <code>$fileName</code> variable to the <code>$fileDirectory</code> to create a new variable for <code>$filePath</code>:</p>
<pre><code class="language-json">{ 
   "let": { 
      "name": "$filePath",  
  	"expression": "$fileDirectory.append($fileName )"
   } 
}
</code></pre>
</li>
</ul>
<h2 id="code-blocks"><a class="header" href="#code-blocks">Code Blocks</a></h2>
<p>In the <code>"code"</code> block, you can configure code snippets to execute in any JVM-supported languages.  The default language is JavaScript.</p>
<ul>
<li>Component name: <code>code</code></li>
</ul>
<p><strong>Syntax</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th style="text-align: center">Mandatory</th><th>Default value</th></tr></thead><tbody>
<tr><td><code>"language"</code></td><td>Defines the programming language to use.</td><td>string</td><td style="text-align: center"></td><td>Javascript</td></tr>
<tr><td><code>"code"</code></td><td>Defines the code to execute.</td><td>string</td><td style="text-align: center">yes</td><td></td></tr>
</tbody></table>
</div>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Execute a <code>Hello, World!</code> program in JavaScript, through the ETL module:</p>
<pre><code class="language-json">{ 
   "code": { 
      "language": "Javascript",
      "code": "print('Hello World!');"
   }
}
</code></pre>
</li>
</ul>
<h2 id="console-blocks"><a class="header" href="#console-blocks">Console Blocks</a></h2>
<p>In a <code>"console"</code> block, you can define commands OrientDB executes through the <a href="etl/../console/README.html">Console</a>.</p>
<ul>
<li>Component name: <code>console</code></li>
</ul>
<p><strong>Syntax</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th style="text-align: center">Mandatory</th><th>Default value</th></tr></thead><tbody>
<tr><td><code>"file"</code></td><td>Defines the path to a file containing the commands you want to execute.</td><td>string</td><td style="text-align: center"></td><td></td></tr>
<tr><td><code>"commands"</code></td><td>Defines an array of commands, as strings, to execute in sequence.</td><td>string array</td><td style="text-align: center"></td><td></td></tr>
</tbody></table>
</div>
<p><strong>Example</strong></p>
<ul>
<li>
<p>Invoke the console with a file containing the commands:</p>
<pre><code class="language-json">{ 
   "console": { 
      "file": "/temp/commands.sql"
   } 
 }
</code></pre>
</li>
<li>
<p>Invoke the console with an array of commands:</p>
<pre><code class="language-json">{ 
   "console": {
      "commands": [
         "CONNECT plocal:/temp/db/mydb admin admin",
         "INSERT INTO Account set name = 'Luca'"
      ]
  }
}
</code></pre>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-12-11 SAM -->
<h1 id="etl---sources"><a class="header" href="#etl---sources">ETL - Sources</a></h1>
<p>When OrientDB executes the ETL module, source components define the source of the data you want to extract.  In the case of some <a href="etl/Extractor.html">extractors</a> like JDBCExtractor work without source, making this component optional.  The ETL module in OrientDB supports the following types of sources:</p>
<ul>
<li><a href="etl/Source.html#file-sources"><code>"file"</code></a></li>
<li><a href="etl/Source.html#input-sources"><code>"input"</code></a></li>
<li><a href="etl/Source.html#http-sources"><code>"http"</code></a></li>
</ul>
<h2 id="file-sources"><a class="header" href="#file-sources">File Sources</a></h2>
<p>In the file source component, the variables represent a source file containing the data you want the ETL module to read.  You can use text files or files compressed to <code>tar.gz</code>.</p>
<ul>
<li>Component name: <code>file</code></li>
</ul>
<p><strong>Syntax</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th style="text-align: center">Mandatory</th><th>Default value</th></tr></thead><tbody>
<tr><td><code>"path"</code></td><td>Defines the path to the file</td><td>string</td><td style="text-align: center">yes</td><td></td></tr>
<tr><td><code>"lock"</code></td><td>Defines whether to lock the file during the extraction phase.</td><td>boolean</td><td style="text-align: center"></td><td><code>false</code></td></tr>
<tr><td><code>"encoding"</code></td><td>Defines the encoding for the file.</td><td>string</td><td style="text-align: center"></td><td><code>UTF-8</code></td></tr>
</tbody></table>
</div>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Extract data from the file at <code>/tmp/actor.tar.gz</code>:</p>
<pre><code class="language-json">{ 
   "file": { 
      "path": "/tmp/actor.tar.gz", 
  	"lock" : true , 
  	"encoding" : "UTF-8" 
   }
}
</code></pre>
</li>
</ul>
<h2 id="input-sources"><a class="header" href="#input-sources">Input Sources</a></h2>
<p>In the input source component, the ETL module extracts data from console input.  You may find this useful in cases where the ETL module operates in a pipe with other tools.</p>
<ul>
<li>Component name: <code>input</code></li>
</ul>
<p><strong>Syntax</strong></p>
<pre><code class="language-sh">oetl.sh "&lt;input&gt;"
</code></pre>
<p><strong>Example</strong></p>
<ul>
<li>
<p>Cat a file, piping its output into the ETL module:</p>
<pre>
$ <code class="lang-sh userinput">cat /etc/csv | $ORIENTDB_HOME/bin/oetl.sh \
      "{transformers:[{csv:{}}]}"</code>
</pre>
</li>
</ul>
<h2 id="http-sources"><a class="header" href="#http-sources">HTTP Sources</a></h2>
<p>In the HTTP source component, the ETL module extracts data from an HTTP address as source.</p>
<ul>
<li>Component name: <code>http</code></li>
</ul>
<p><strong>Syntax</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th style="text-align: center">Mandatory</th><th>Default value</th></tr></thead><tbody>
<tr><td><code>"url"</code></td><td>Defines the URL to look to for source data.</td><td>string</td><td style="text-align: center">yes</td><td></td></tr>
<tr><td><code>"method"</code></td><td>Defines the HTTP method to use in extracting data.  Supported methods are: <code>GET</code>, <code>POST</code>, <code>PUT</code>, <code>DELETE</code>, <code>HEAD</code>, <code>OPTIONS</code>, and <code>TRACE</code>.</td><td>string</td><td style="text-align: center"></td><td><code>GET</code></td></tr>
<tr><td><code>"headers"</code></td><td>Defines the request headers as an inner document key/value.</td><td>document</td><td style="text-align: center"></td><td></td></tr>
</tbody></table>
</div>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Execute an HTTP request in a <code>GET</code>, setting the user agent in the header:</p>
<pre><code class="language-json">{ 
   "http": {
      "url": "http://ip.jsontest.com/",
      "method": "GET",
      "headers": {
         "User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/36.0.1985.125 Safari/537.36"
      }
   }
}
</code></pre>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-12-11 SAM -->
<h1 id="etl---extractors"><a class="header" href="#etl---extractors">ETL - Extractors</a></h1>
<p>When OrientDB executes the ETL module, extractor components handle data extraction from source.  They are the first part of the ETL process. The ETL module in OrientDB supports the following extractors:</p>
<ul>
<li><a href="etl/Extractor.html#row-extractor">Row</a></li>
<li><a href="etl/Extractor.html#csv-extractor">CSV</a></li>
<li><a href="etl/Extractor.html#jdbc-extractor">JDBC</a></li>
<li><a href="etl/Extractor.html#json-extractor">JSON</a></li>
<li><a href="etl/Extractor.html#xml-extractor">XML</a></li>
</ul>
<h2 id="row-extractor"><a class="header" href="#row-extractor">Row Extractor</a></h2>
<p>When the ETL module runs with a Row Extractor, it extracts content row by row.  It outputs a string array class.</p>
<ul>
<li>Component name: <code>row</code></li>
<li>Output Class: <code>[ string ]</code></li>
</ul>
<p><strong>Syntax</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th style="text-align: center">Mandatory</th><th>Default value</th></tr></thead><tbody>
<tr><td><code>"multiLine"</code></td><td>Defines whether the process supports multiline.  Useful with CSV's supporting linefeed inside of string.</td><td>boolean</td><td style="text-align: center"></td><td><code>true</code></td></tr>
<tr><td><code>"linefeed"</code></td><td>Defines the linefeed to use in the event of multiline processing.</td><td>string</td><td style="text-align: center"></td><td><code>\r\n</code></td></tr>
</tbody></table>
</div>
<blockquote>
<p>The <code>"multiLine"</code> and <code>"linefeed"</code> parameters were introduced in version 2.0.9.</p>
</blockquote>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Use the row extractor with its default configuration:</p>
<pre><code class="language-json">{ 
   "row": {} 
}
</code></pre>
</li>
</ul>
<h2 id="csv-extractor"><a class="header" href="#csv-extractor">CSV Extractor</a></h2>
<p>When the ETL module runs the CSV Extractor, it parses a file formatted to <a href="https://commons.apache.org/proper/commons-csv">Apache Commons CSV</a> and extracts the data into OrientDB.  This component was introduced in version 2.1.4 and is unavailable in older releases of OrientDB.</p>
<ul>
<li>Component name: <code>csv</code></li>
<li>Output class: <code>[ ODocument ]</code></li>
</ul>
<p><strong>Syntax</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Mandatory</th><th>Default value</th></tr></thead><tbody>
<tr><td><code>"separator"</code></td><td>Defines the column separator.</td><td>char</td><td></td><td><code>,</code></td></tr>
<tr><td><code>"columnsOnFirstLine"</code></td><td>Defines whether the first line contains column descriptors.</td><td>boolean</td><td></td><td><code>true</code></td></tr>
<tr><td><code>"columns"</code></td><td>Defines array for names and (optionally) types to write.</td><td>string array</td><td></td><td></td></tr>
<tr><td><code>"nullValue"</code></td><td>Defines the null value in the file.</td><td>string</td><td></td><td><code>NULL</code></td></tr>
<tr><td><code>"dateFormat"</code></td><td>Defines the format to use in parsing dates from file.</td><td>string</td><td></td><td><code>yyyy-MM-dd</code></td></tr>
<tr><td><code>"dateTimeFormat"</code></td><td>Defines the format to use in parsing dates with time from file.</td><td>string</td><td></td><td><code>yyyy-MM-dd HH:mm</code></td></tr>
<tr><td><code>"quote"</code></td><td>Defines string character delimiter.</td><td>char</td><td></td><td><code>"</code></td></tr>
<tr><td><code>"skipFrom"</code></td><td>Defines the line number you want to skip from.</td><td>integer</td><td></td><td></td></tr>
<tr><td><code>"skipTo"</code></td><td>Defines the line number you want to skip to.</td><td>integer</td><td></td><td></td></tr>
<tr><td><code>"ignoreEmptyLines"</code></td><td>Defines whether it should ignore empty lines.</td><td>boolean</td><td></td><td><code>false</code></td></tr>
<tr><td><code>"ignoreMissingColumns"</code></td><td>Defines whether it should ignore empty columns.</td><td>boolean</td><td></td><td><code>false</code></td></tr>
<tr><td><code>"predefinedFormat"</code></td><td>Defines the CSV format you want to use.</td><td>string</td><td></td><td></td></tr>
</tbody></table>
</div>
<ul>
<li>
<p>For the <code>"columns"</code> parameter, specify the type by postfixing it to the value.  Specifying types guarantees better performance.</p>
</li>
<li>
<p>For the <code>"predefinedFormat"</code> parameter, the available formats are: <code>Default</code>, <code>Excel</code>, <code>MySQL</code>, <code>RFC4180</code>, <code>TDF</code>.</p>
</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Extract lines from CSV to the <code>ODocument</code> class, using commas as the separator, considering <code>NULL</code> as the null value and skipping rows two through four:</p>
<pre><code class="language-json">{ "csv": 
    {  "separator": ",", 
       "nullValue": "NULL",
       "skipFrom": 1, 
       "skipTo": 3 
    }
}
</code></pre>
</li>
<li>
<p>Extract lines from a CSV exported from MySQL:</p>
<pre><code class="language-json">{ "csv": 
    {  "predefinedFormat": "MySQL"}
}
</code></pre>
</li>
<li>
<p>Extract lines from a CSV with the default formatting, using <code>N/A</code> as the null value and a custom date format:</p>
<pre><code class="language-json">{ "csv": 
    {  "predefinedFormat": "Default",
       "nullValue" : "N/A",
       "dateFormat" : "dd-MM-yyyy",
       "dateTimeFormat" : "dd-MM-yyyy HH:mm"
    }
}
</code></pre>
</li>
<li>
<p>Extract lines from a CSV with the default formatting, using <code>N/A</code> as the null value, a custom date format, a custom dateTime format and columns type mapping :</p>
<pre><code class="language-json">{ "csv": 
    {  "predefinedFormat": "DEFAULT",
       "nullValue" : "N/A",
       "dateFormat" : "dd-MM-yyyy",
       "dateTimeFormat" : "dd-MM-yyyy HH:mm",
       "columns": ["name:string","createdAt:date","updatedAt:dateTime"]
    }
}
</code></pre>
</li>
</ul>
<h2 id="jdbc-extractor"><a class="header" href="#jdbc-extractor">JDBC Extractor</a></h2>
<p>When the ETL module runs the JDBC Extractor, it can access any database management system that supports the <a href="http://en.wikipedia.org/wiki/JDBC_driver">JDBC</a> driver.</p>
<p>In order for the ETL component to connect to the source database, put the source database's JDBC driver in the classpath, or in the <code>$ORIENTDB_HOME/lib</code> directory.</p>
<ul>
<li>Component name: <code>jdbc</code></li>
<li>Output class: <code>[ ODocument ]</code></li>
</ul>
<p><strong>Syntax</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Mandatory</th><th>Default value</th></tr></thead><tbody>
<tr><td><code>"driver"</code></td><td>Defines the JDBC Driver class.</td><td>string</td><td>yes</td><td></td></tr>
<tr><td><code>"url"</code></td><td>Defines the JDBC URL to connect to.</td><td>string</td><td>yes</td><td></td></tr>
<tr><td><code>"userName"</code></td><td>Defines the username to use on the source database.</td><td>string</td><td>yes</td><td></td></tr>
<tr><td><code>"userPassword"</code></td><td>Defines the user password to use on the source database.</td><td>string</td><td>yes</td><td></td></tr>
<tr><td><code>"query"</code></td><td>Defines the query to extract the record you want to import.</td><td>string</td><td>yes</td><td></td></tr>
<tr><td><code>"queryCount"</code></td><td>Defines query that returns the count of the fetched records, (used to provide a correct progress indicator).</td><td>string</td><td></td><td></td></tr>
</tbody></table>
</div>
<p><strong>Example</strong></p>
<ul>
<li>
<p>Extract the contents of the <code>client</code> table on the MySQL database <code>test</code> at localhost:</p>
<pre><code class="language-json">{ "jdbc": {
    "driver": "com.mysql.jdbc.Driver",
    "url": "jdbc:mysql://localhost/test",
    "userName": "root",
    "userPassword": "my_mysql_passwd",
    "query": "SELECT * FROM client"
  }
}
</code></pre>
</li>
</ul>
<h2 id="json-extractor"><a class="header" href="#json-extractor">JSON Extractor</a></h2>
<p>When the ETL module runs with a JSON Extractor, it extracts data by parsing JSON objects.  If the data has more than one JSON items, you must enclose the in <code>[]</code> brackets.</p>
<ul>
<li>Component name: <code>json</code></li>
<li>Output class: <code>[ ODocument ]</code></li>
</ul>
<!-- #### Syntax
| Parameter | Description | Type | Mandatory | Default value |
|-----------|-------------|------|-----------|-----------| -->
<p><strong>Example</strong></p>
<ul>
<li>
<p>Extract data from a JSON file.</p>
<pre><code class="language-json">{ "json": {} }
</code></pre>
</li>
</ul>
<h2 id="xml-extractor"><a class="header" href="#xml-extractor">XML Extractor</a></h2>
<p>When the ETL module runs with the XML extractor, it extracts data by parsing XML elements.  This feature was introduced in version 2.2.</p>
<ul>
<li>Component name: <code>xml</code></li>
<li>Output class: <code>[ ODocument ]</code></li>
</ul>
<p><strong>Syntax</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Mandatory</th><th>Default value</th></tr></thead><tbody>
<tr><td><code>"rootNode"</code></td><td>Defines the root node to extract in the XML.  By default, it builds from the root element in the file.</td><td>string</td><td></td><td></td></tr>
<tr><td><code>"tagsAsAttribute"</code></td><td>Defines an array of elements, where child elements are considered as attributes of the document and the attribute values as the text within the element.</td><td>string array</td><td></td><td></td></tr>
</tbody></table>
</div>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Extract data from an XML file, where the XML file reads as:</p>
<pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;a&gt;
  &lt;b&gt;
  	&lt;c name='Ferrari' color='red'&gt;ignore&lt;/c&gt;
  	&lt;c name='Maserati' color='black'/&gt;
  &lt;/b&gt;
&lt;/a&gt;
</code></pre>
<p>While the OrientDB-ETL configuration file reads as:</p>
<pre><code class="language-json">{ "source": 
  { "file": 
    { "path": "src/test/resources/simple.xml" } 
  }, 
  "extractor" : 
    { "xml": {} }, 
    "loader": 
      { "test": {} } 
}
</code></pre>
<p>This extracts the data as:</p>
<pre><code class="language-json">{
  "a": {
    "b": {
      "c": [
        {
          "color": "red",
          "name": "Ferrari"
        },
        {
          "color": "black",
          "name": "Maserati"
        }
      ]
    }
  }
}
</code></pre>
</li>
<li>
<p>Extract a collection from XML, where the XML file reads as:</p>
<pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;CATALOG&gt;
    &lt;CD&gt;
        &lt;TITLE&gt;Empire Burlesque&lt;/TITLE&gt;
        &lt;ARTIST&gt;Bob Dylan&lt;/ARTIST&gt;
        &lt;COUNTRY&gt;USA&lt;/COUNTRY&gt;
        &lt;COMPANY&gt;Columbia&lt;/COMPANY&gt;
        &lt;PRICE&gt;10.90&lt;/PRICE&gt;
        &lt;YEAR&gt;1985&lt;/YEAR&gt;
    &lt;/CD&gt;
    &lt;CD&gt;
        &lt;TITLE&gt;Hide your heart&lt;/TITLE&gt;
        &lt;ARTIST&gt;Bonnie Tyler&lt;/ARTIST&gt;
        &lt;COUNTRY&gt;UK&lt;/COUNTRY&gt;
        &lt;COMPANY&gt;CBS Records&lt;/COMPANY&gt;
        &lt;PRICE&gt;9.90&lt;/PRICE&gt;
        &lt;YEAR&gt;1988&lt;/YEAR&gt;
    &lt;/CD&gt;
    &lt;CD&gt;
        &lt;TITLE&gt;Greatest Hits&lt;/TITLE&gt;
        &lt;ARTIST&gt;Dolly Parton&lt;/ARTIST&gt;
        &lt;COUNTRY&gt;USA&lt;/COUNTRY&gt;
        &lt;COMPANY&gt;RCA&lt;/COMPANY&gt;
        &lt;PRICE&gt;9.90&lt;/PRICE&gt;
        &lt;YEAR&gt;1982&lt;/YEAR&gt;
    &lt;/CD&gt;
&lt;/CATALOG&gt;
</code></pre>
<p>While the OrientDB-ETL configuration file reads:</p>
<pre><code class="language-json">{ "source": 
  { "file": 
    { "path": "src/test/resources/music.xml" } 
  }, "extractor" : 
    { "xml": 
      { "rootNode": "CATALOG.CD", 
  	  "tagsAsAttribute": ["CATALOG.CD"] 
  	} 
    }, 
    "loader": { "test": {} } 
}
</code></pre>
<p>This extracts the data as:</p>
<pre><code class="language-json">{
  "TITLE": "Empire Burlesque",
  "ARTIST": "Bob Dylan",
  "COUNTRY": "USA",
  "COMPANY": "Columbia",
  "PRICE": "10.90",
  "YEAR": "1985"
}
{
  "TITLE": "Hide your heart",
  "ARTIST": "Bonnie Tyler",
  "COUNTRY": "UK",
  "COMPANY": "CBS Records",
  "PRICE": "9.90",
  "YEAR": "1988"
}
{
  "TITLE": "Greatest Hits",
  "ARTIST": "Dolly Parton",
  "COUNTRY": "USA",
  "COMPANY": "RCA",
  "PRICE": "9.90",
  "YEAR": "1982"
}
</code></pre>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-12-11 SAM -->
<h1 id="etl-transformers"><a class="header" href="#etl-transformers">ETL Transformers</a></h1>
<p>When OrientDB runs the ETL module, transformer components execute in a pipeline to modify the data before it gets loaded into the OrientDB database.  The operate on received input and return output.</p>
<p>Before execution, it always initializes the <code>$input</code> variable, so that if you need to you can access it at run-time.</p>
<ul>
<li><a href="etl/Transformer.html#csv-transformer">CSV</a></li>
<li><a href="etl/Transformer.html#field-transformer">FIELD</a></li>
<li><a href="etl/Transformer.html#load-transformer">LOAD</a></li>
<li><a href="etl/Transformer.html#merge-transformer">MERGE</a></li>
<li><a href="etl/Transformer.html#vertex-transformer">VERTEX</a></li>
<li><a href="etl/Transformer.html#code-transformer">CODE</a></li>
<li><a href="etl/Transformer.html#link-transformer">LINK</a></li>
<li><a href="etl/Transformer.html#edge-transformer">EDGE</a></li>
<li><a href="etl/Transformer.html#flow-transformer">FLOW</a></li>
<li><a href="etl/Transformer.html#flow-transformer">LOG</a></li>
<li><a href="etl/Transformer.html#block-transformer">BLOCK</a></li>
<li><a href="etl/Transformer.html#command-transformer">COMMAND</a></li>
</ul>
<h2 id="csv-transformer"><a class="header" href="#csv-transformer">CSV Transformer</a></h2>
<blockquote>
<p>Beginning with version 2.1.4, the CSV Transformer has been deprecated in favor of the <a href="etl/Extractor.html#csv-extractor">CSV Extractor</a>.</p>
</blockquote>
<p>Converts a string in a Document, parsing it as CSV</p>
<p>Component description.</p>
<ul>
<li>Component name: <strong>csv</strong></li>
<li>Supported inputs types: [<strong>String</strong>]</li>
<li>Output: <strong>ODocument</strong></li>
</ul>
<p><strong>Syntax</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Mandatory</th><th>Default value</th></tr></thead><tbody>
<tr><td><code>"separator"</code></td><td>Defines the column separator.</td><td>char</td><td></td><td><code>,</code></td></tr>
<tr><td><code>"columnsOnFirstLine"</code></td><td>Defines whether the first line contains column descriptions.</td><td>boolean</td><td></td><td><code>true</code></td></tr>
<tr><td><code>"columns"</code></td><td>Defines array containing column names, you can define types by postfixing the names with <code>:&lt;type&gt;</code>.</td><td>string array</td><td></td><td></td></tr>
<tr><td><code>"nullValue"</code></td><td>Defines the value to interpret as null.</td><td>string</td><td></td><td></td></tr>
<tr><td><code>"stringCharacter"</code></td><td>Defines string character delimiter.</td><td>char</td><td></td><td><code>"</code></td></tr>
<tr><td><code>"skipFrom"</code></td><td>Defines the line number to skip from.</td><td>integer</td><td>yes</td><td></td></tr>
<tr><td><code>"skipTo"</code></td><td>Defines the line number to skip to.</td><td>integer</td><td>yes</td><td></td></tr>
</tbody></table>
</div>
<blockquote>
<p>For the <code>"columns"</code> parameter, specifying type guarantees better performance.</p>
</blockquote>
<p><strong>Example</strong></p>
<ul>
<li>
<p>Transforms a row in CSV (as <code>ODocument</code> class), using commas as the separator, considering <code>NULL</code> as a null value and skipping rows two through four.</p>
<pre><code class="language-json">{ "csv": { "separator": ",", "nullValue": "NULL",
           "skipFrom": 1, "skipTo": 3 } }
</code></pre>
</li>
</ul>
<h2 id="field-transformer"><a class="header" href="#field-transformer">Field Transformer</a></h2>
<p>When the ETL module calls the Field Transformer, it executes an SQL transformer against the field.</p>
<p>Component description.</p>
<ul>
<li>Component name: <strong>vertex</strong></li>
<li>Supported inputs types: [<strong>ODocument</strong>]</li>
<li>Output: <strong>ODocument</strong></li>
</ul>
<p><strong>Syntax</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Mandatory</th><th>Default value</th></tr></thead><tbody>
<tr><td><code>"fieldName"</code></td><td>Defines the document field name to use.</td><td>string</td><td></td><td></td></tr>
<tr><td><code>"expression"</code></td><td>Defines the expression you want to evaluate, using OrientDB SQL.</td><td>string</td><td>yes</td><td></td></tr>
<tr><td><code>"value"</code></td><td>Defines the value to set.  If the value is taken or computed at run-time, use <code>"expression"</code> instead.</td><td>any</td><td></td><td></td></tr>
<tr><td><code>"operation"</code></td><td>Defines the operation to execute against the fields: <code>SET</code> or <code>REMOVE</code>.</td><td>string</td><td></td><td><code>SET</code></td></tr>
<tr><td><code>"save"</code></td><td>Defines whether to save the vertex, edge or document right after setting the fields.</td><td>boolean</td><td></td><td><code>false</code></td></tr>
</tbody></table>
</div>
<blockquote>
<p>The <code>"fieldName"</code> parameter was introduced in version 2.1.</p>
</blockquote>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Transforms the field <code>class</code> into the <code>ODocument</code> class, by prefixing it with <code>_</code>:</p>
<pre><code class="language-json">{ "field": 
  { "fieldName": "@class", 
    "expression": "class.prefix('_')"
  } 
}
</code></pre>
</li>
<li>
<p>Applies the class name, based on the value of another field:</p>
<pre><code class="language-json">{ "field": 
  { "fieldName": "@class", 
    "expression": "if( ( fileCount &gt;= 0 ), 'D', 'F')"
  }
}
</code></pre>
</li>
<li>
<p>Assigns the last part of a path to the <code>name</code> field:</p>
<pre><code class="language-json">{ "field": 
  { "fieldName": "name",
    "expression": "path.substring( eval( '$current.path.lastIndexOf(\"/\") + 1') )" 
  }
}
</code></pre>
</li>
<li>
<p>Assigns the field a fixed value:</p>
<pre><code class="language-json">{ "field": 
  { "fieldName": "counter", 
    "value": 0
  }
}
</code></pre>
</li>
<li>
<p>Renames the field from <code>salary</code> to <code>remuneration</code>:</p>
<pre><code class="language-json">{ "field": 
  { "fieldName": "remuneration", 
    "expression": "salary"
  } 
},
{ "field": 
  { "fieldName": "salary", 
    "operation": "remove"
  } 
}
</code></pre>
</li>
<li>
<p>Renames multiple fields in one call.</p>
<pre><code class="language-json">{ "field": 
  { "fieldNames": 
    [ "remuneration", "salary" ], 
    "operation": "remove"
  } 
}
</code></pre>
<p>This feature was introduced in version 2.1.</p>
</li>
</ul>
<h2 id="load-transformer"><a class="header" href="#load-transformer">Load Transformer</a></h2>
<p>When the ETL module calls the Load Transformer, it takes input from one <code>ODocument</code> instance to output into another, loaded by lookup.  THe lookup can either be a lookup against an index or a <a href="etl/../sql/SQL-Query.html"><code>SELECT</code></a> query.</p>
<p>Component description.</p>
<ul>
<li>Component name: <strong>load</strong></li>
<li>Supported inputs types: [<strong>ODocument</strong>, <strong>OrientVertex</strong>]</li>
<li>Output: one or multiple <strong>ODocument</strong> instances</li>
</ul>
<p><strong>Syntax</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Mandatory</th><th>Default value</th></tr></thead><tbody>
<tr><td><code>"joinFieldName"</code></td><td>Defines the field containing the join value.</td><td>string</td><td>yes</td><td></td></tr>
<tr><td><code>"lookup"</code></td><td>Defines the index on which to execute the lookup, or a <a href="etl/../sql/SQL-Query.html"><code>SELECT</code></a> query.</td><td>string</td><td>yes</td><td></td></tr>
<tr><td><code>"unresolvedLinkAction"</code></td><td>Defines the action to execute in the event that the join hasn't been resolved.</td><td>string</td><td></td><td><code>NOTHING</code></td></tr>
</tbody></table>
</div>
<p>For the <code>"unresolvedLinkAction"</code> parameter, the supported actions are:</p>
<div class="table-wrapper"><table><thead><tr><th>Action</th><th>Description</th></tr></thead><tbody>
<tr><td><code>NOTHING</code></td><td>Tells the transformer to do nothing.</td></tr>
<tr><td><code>WARNING</code></td><td>Tells the transformer to increment warnings.</td></tr>
<tr><td><code>ERROR</code></td><td>Tells the transformer to increment errors.</td></tr>
<tr><td><code>HALT</code></td><td>Tells the transformer to interrupt the process.</td></tr>
<tr><td><code>SKIP</code></td><td>Tells the transformer to skip the current row.</td></tr>
</tbody></table>
</div>
<p><strong>Example</strong></p>
<ul>
<li>
<p>Loads the current record against the record returned by the lookup on index <code>V.URI</code>, with the value contained in the field <code>URI</code> of the input document:</p>
<pre><code class="language-json">{ "load": 
  { "joinFieldName": "URI", 
    "lookup":"V.URI" 
  } 
}
</code></pre>
</li>
</ul>
<h2 id="merge-transformer"><a class="header" href="#merge-transformer">Merge Transformer</a></h2>
<p>When the ETL module calls the Merge Transformer, it takes input from one <code>ODocument</code> instance to output into another, loaded by lookup.  THe lookup can either be a lookup against an index or a <a href="etl/../sql/SQL-Query.html"><code>SELECT</code></a> query.</p>
<p>Component description.</p>
<ul>
<li>Component name: <strong>merge</strong></li>
<li>Supported inputs types: [<strong>ODocument</strong>, <strong>OrientVertex</strong>]</li>
<li>Output: <strong>ODocument</strong></li>
</ul>
<p><strong>Syntax</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Mandatory</th><th>Default value</th></tr></thead><tbody>
<tr><td><code>"joinFieldName"</code></td><td>Defines the field containing the join value.</td><td>string</td><td>yes</td><td></td></tr>
<tr><td><code>"lookup"</code></td><td>Defines the index on which to execute the lookup, or a <a href="etl/../sql/SQL-Query.html"><code>SELECT</code></a> query.</td><td>string</td><td>yes</td><td></td></tr>
<tr><td><code>"unresolvedLinkAction"</code></td><td>Defines the action to execute in the event that the join hasn't been resolved.</td><td>string</td><td></td><td><code>NOTHING</code></td></tr>
</tbody></table>
</div>
<p>For the <code>"unresolvedLinkAction"</code> parameter, the supported actions are:</p>
<div class="table-wrapper"><table><thead><tr><th>Action</th><th>Description</th></tr></thead><tbody>
<tr><td><code>NOTHING</code></td><td>Tells the transformer to do nothing.</td></tr>
<tr><td><code>WARNING</code></td><td>Tells the transformer to increment warnings.</td></tr>
<tr><td><code>ERROR</code></td><td>Tells the transformer to increment errors.</td></tr>
<tr><td><code>HALT</code></td><td>Tells the transformer to interrupt the process.</td></tr>
<tr><td><code>SKIP</code></td><td>Tells the transformer to skip the current row.</td></tr>
</tbody></table>
</div>
<p><strong>Example</strong></p>
<ul>
<li>
<p>Merges the current record against the record returned by the lookup on index <code>V.URI</code>, with the value contained in the field <code>URI</code> of the input document:</p>
<pre><code class="language-json">{ "merge": 
  { "joinFieldName": "URI", 
    "lookup":"V.URI" 
  } 
}
</code></pre>
</li>
</ul>
<h2 id="vertex-transformer"><a class="header" href="#vertex-transformer">Vertex Transformer</a></h2>
<p>When the ETL module runs the Vertex Transformer, it transforms <code>ODocument</code> input to output <code>OrientVertex</code>.</p>
<p>Component description.</p>
<ul>
<li>Component name: <strong>vertex</strong></li>
<li>Supported inputs types: [<strong>ODocument</strong>, <strong>OrientVertex</strong>]</li>
<li>Output: <strong>OrientVertex</strong></li>
</ul>
<p><strong>Syntax</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Mandatory</th><th>Default value</th></tr></thead><tbody>
<tr><td><code>"class"</code></td><td>Defines the vertex class to use.</td><td>string</td><td></td><td><code>V</code></td></tr>
<tr><td><code>"skipDuplicates"</code></td><td>Defines whether it skips duplicates.  When class has a <code>UNIQUE</code> constraint, ETL ignores duplicates.</td><td>boolean</td><td></td><td><code>false</code></td></tr>
</tbody></table>
</div>
<blockquote>
<p>The <code>"skipDuplicates"</code> parameter was introduced in version 2.1.</p>
</blockquote>
<p><strong>Example</strong></p>
<ul>
<li>
<p>Transforms <code>ODocument</code> input into a vertex, setting the class value to the <code>$classname</code> variable:</p>
<pre><code class="language-json">{ "vertex": 
  { "class": "$className", 
    "skipDuplicates": true 
  } 
}
</code></pre>
</li>
</ul>
<h2 id="edge-transformer"><a class="header" href="#edge-transformer">Edge Transformer</a></h2>
<p>When the ETL modules calls the Edge Transformer, it converts join values in one or more edges between the current vertex and all vertices returned by the lookup.  The lookup can either be made against an index or a <a href="etl/../sql/SQL-Query.html"><code>SELECT</code></a>.</p>
<p>Component description.</p>
<ul>
<li>Component name: <strong>EDGE</strong></li>
<li>Supported inputs types: [<strong>ODocument</strong>, <strong>OrientVertex</strong>]</li>
<li>Output: <strong>OrientVertex</strong></li>
</ul>
<p><strong>Syntax</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Mandatory</th><th>Default value</th></tr></thead><tbody>
<tr><td><code>"joinFieldName"</code></td><td>Defines the field containing the join value.</td><td>string</td><td>yes</td><td></td></tr>
<tr><td><code>"direction"</code></td><td>Defines the edge direction.</td><td>string</td><td></td><td><code>out</code></td></tr>
<tr><td><code>"class"</code></td><td>Defines the edge class.</td><td>string</td><td></td><td><code>E</code></td></tr>
<tr><td><code>"lookup"</code></td><td>Defines the index on which to execute the lookup or a <a href="etl/../sql/SQL-Query.html"><code>SELECT</code></a>.</td><td>string</td><td>yes</td><td></td></tr>
<tr><td><code>"targetVertexFields"</code></td><td>Defines the field on which to set the target vertex.</td><td>object</td><td></td><td></td></tr>
<tr><td><code>"edgeFields"</code></td><td>Defines the fields to set in the edge.</td><td>object</td><td></td><td></td></tr>
<tr><td><code>"skipDuplicates"</code></td><td>Defines whether to skip duplicate edges when the <code>UNIQUE</code> constraint is set on both the <code>out</code> and <code>in</code> properties.</td><td>boolean</td><td></td><td><code>false</code></td></tr>
<tr><td><code>"unresolvedLinkAction"</code></td><td>Defines the action to execute in the event that the join hasn't been resolved.</td><td>string</td><td></td><td><code>NOTHING</code></td></tr>
</tbody></table>
</div>
<blockquote>
<p>The <code>"targetVertexFields"</code> and <code>"edgeFields"</code> parameters were introduced in version 2.1.</p>
</blockquote>
<p>For the <code>"unresolvedLinkAction"</code> parameter, the following actions are supported:</p>
<div class="table-wrapper"><table><thead><tr><th>Action</th><th>Description</th></tr></thead><tbody>
<tr><td><code>NOTHING</code></td><td>Tells the transformer to do nothing.</td></tr>
<tr><td><code>CREATE</code></td><td>Tells the transformer to create an instance of <code>OrientVertex</code>, setting the primary key to the join value.</td></tr>
<tr><td><code>WARNING</code></td><td>Tells the transformer to increment warnings.</td></tr>
<tr><td><code>ERROR</code></td><td>Tells the transformer to increment errors.</td></tr>
<tr><td><code>HALT</code></td><td>Tells the transformer to interrupt the process.</td></tr>
<tr><td><code>SKIP</code></td><td>Tells the transformer to skip the current row.</td></tr>
</tbody></table>
</div>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Creates an edge from the current vertex, with the class set to <code>Parent</code>, to all vertices returned by the lookup on the <code>D.inode</code> index with the value contained in the filed <code>inode_parent</code> of the input's vertex:</p>
<pre><code class="language-json">{ "edge": 
  { "class": "Parent", 
    "joinFieldName": "inode_parent",
    "lookup":"D.inode",    
    "unresolvedLinkAction": "CREATE"
  } 
}
</code></pre>
</li>
<li>
<p>Transformer a single-line CSV that contains both vertices and edges:</p>
<pre><code class="language-json">{ "source": 
  { "content": 
    { "value": "id,name,surname,friendSince,friendId,friendName,friendSurname\n0,Jay,Miner,1996,1,Luca,Garulli"
    }
  },
  "extractor": 
    { "row": {} },
  "transformers": 
    [ 
      { "csv": {} },
      { "vertex": 
  	  { "class": "V1" }
      },
      { "edge": 
  	  { "unresolvedLinkAction": "CREATE",
          "class": "Friend",
          "joinFieldName": "friendId",
          "lookup": "V2.fid",
          "targetVertexFields": 
  		  { "name": "${input.friendName}",
               "surname": "${input.friendSurname}"
            },
            "edgeFields": 
  		    { "since": "${input.friendSince}" }
              }
        },
        { "field": 
  	    { "fieldNames": 
  		  [ "friendSince",
              "friendId",
              "friendName",
              "friendSurname"
            ],
            "operation": "remove"
          }
        }
      ],
      "loader": 
  	  { "orientdb": 
  	    { "dbURL": "memory:ETLBaseTest",
            "dbType": "graph",
            "useLightweightEdges": false
          }
      }
  }
</code></pre>
</li>
</ul>
<h2 id="flow-transformer"><a class="header" href="#flow-transformer">Flow Transformer</a></h2>
<p>When the ETL module calls the Flow Transformer, it modifies the flow through the pipeline.  Supported operations are <code>skip</code> and <code>halt</code>.  Typically, this transformer operates with the <code>if</code> attribute.</p>
<p>Component description.</p>
<ul>
<li>Component name: <strong>flow</strong></li>
<li>Supported inputs types: <strong>Any</strong></li>
<li>Output: same type as input</li>
</ul>
<p><strong>Syntax</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Mandatory</th><th>Default value</th></tr></thead><tbody>
<tr><td><code>"operation"</code></td><td>Defines the flow operation: <code>skip</code> or <code>halt</code>.</td><td>string</td><td>yes</td><td></td></tr>
</tbody></table>
</div>
<p><strong>Example</strong></p>
<ul>
<li>
<p>Skips the current record if <code>name</code> is null:</p>
<pre><code class="language-json">{ "flow": 
  { "if": "name is null", 
    "operation" : "skip" 
  } 
}
</code></pre>
</li>
</ul>
<h2 id="code-transformer"><a class="header" href="#code-transformer">Code Transformer</a></h2>
<p>When the ETL module calls the Code Transformer, it executes a snippet of code in any JVM supported language.  The default is JavaScript.  The last object in the code is returned as output.</p>
<p>In the execution context:</p>
<ul>
<li><code>input</code> The input object received.</li>
<li><code>record</code> The record extracted from the input object, when possible.  In the event that input object is a vertex or edge, it assigns the underlying <code>ODocument</code> to the variable.</li>
</ul>
<p>Component description.</p>
<ul>
<li>Component name: <strong>code</strong></li>
<li>Supported inputs types: [<strong>Object</strong>]</li>
<li>Output: <strong>Object</strong></li>
</ul>
<p><strong>Syntax</strong></p>
<p>| Parameter | Description | Type | Mandatory | Default value |
|-----------|-------------|-----------|-----------|
| <code>"language"</code> | Defines the programming language to use. | string | | JavaScript |
| <code>"code"</code> | Defines the code to execute. | string | yes | |</p>
<p><strong>Example</strong></p>
<ul>
<li>
<p>Displays the current record and return the parent:</p>
<pre><code class="language-json">{ "code": 
  { "language": "Javascript",
    "code": "print('Current record: ' + record); record.field('parent');"
  }
}
</code></pre>
</li>
</ul>
<h2 id="link-transformer"><a class="header" href="#link-transformer">Link Transformer</a></h2>
<p>When the ETL module calls the Link Transformer, it converts join values into links within the current record, using the result of the lookup.  The lookup can be made against an index or a <a href="etl/../sql/SQL-Query.html"><code>SELECT</code></a>.</p>
<p>Component description.</p>
<ul>
<li>Component name: <strong>link</strong></li>
<li>Supported inputs types: [<strong>ODocument</strong>, <strong>OrientVertex</strong>]</li>
<li>Output: <strong>ODocument</strong></li>
</ul>
<p><strong>Syntax</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Mandatory</th><th>Default value</th></tr></thead><tbody>
<tr><td><code>"joinFieldName"</code></td><td>Defines the field containing hte join value.</td><td>string</td><td></td><td></td></tr>
<tr><td><code>"joinValue"</code></td><td>Defines the value to look up.</td><td>string</td><td></td><td></td></tr>
<tr><td><code>"linkFieldName"</code></td><td>Defines the field containing the link to set.</td><td>string</td><td>yes</td><td></td></tr>
<tr><td><code>"linkFieldType"</code></td><td>Defines the link type.</td><td>string</td><td>yes</td><td></td></tr>
<tr><td><code>"lookup"</code></td><td>Defines the index on which to execute the lookup or a <a href="etl/../sql/SQL-Query.html"><code>SELECT</code></a> query.</td><td>string</td><td>yes</td><td></td></tr>
<tr><td><code>"unresolvedLinkAction"</code></td><td>Defines the action to execute in the event that the join doesn't resolve.</td><td>string</td><td></td><td><code>NOTHING</code></td></tr>
</tbody></table>
</div>
<p>For the <code>"linkFieldType"</code> parameter, supported link types are: <code>LINK</code>, <code>LINKSET</code> and <code>LINKLIST</code>.</p>
<p>For the <code>"unresolvedLinkAction"</code> parameter the following actions are supported:</p>
<div class="table-wrapper"><table><thead><tr><th>Action</th><th>Description</th></tr></thead><tbody>
<tr><td><code>NOTHING</code></td><td>Tells the transformer to do nothing.</td></tr>
<tr><td><code>CREATE</code></td><td>Tells the transformer to create an <code>ODocument</code> instance, setting the primary key as the join value.</td></tr>
<tr><td><code>WARNING</code></td><td>Tells the transformer to increment warnings.</td></tr>
<tr><td><code>ERROR</code></td><td>Tells the transformer to increment errors.</td></tr>
<tr><td><code>HALT</code></td><td>Tells the transformer to interrupt the process.</td></tr>
<tr><td><code>SKIP</code></td><td>Tells the transformer to skip the current row.</td></tr>
</tbody></table>
</div>
<p><strong>Example</strong></p>
<ul>
<li>
<p>Transforms a JSON value into a link within the current record, set as <code>parent</code> of the type <code>LINK</code>, with the result of the lookup on the index <code>D.node</code> with the value contained in the field <code>inode_parent</code> on the input document.</p>
<pre><code class="language-json">{ "link": 
  { "linkFieldName": "parent", 
    "linkFieldType": "LINK",
    "joinFieldName": "inode_parent", 
    "lookup":"D.inode",  
    "unresolvedLinkAction":"CREATE"
  } 
}
</code></pre>
</li>
</ul>
<h2 id="log-transformer"><a class="header" href="#log-transformer">Log Transformer</a></h2>
<p>When the ETL module uses the Log Transformer, it logs the input object to <code>System.out</code>.</p>
<p>Component description.</p>
<ul>
<li>Component name: <strong>log</strong></li>
<li>Supported inputs types: <strong>Any</strong></li>
<li>Output: <strong>Any</strong></li>
</ul>
<p><strong>Syntax</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Mandatory</th><th>Default value</th></tr></thead><tbody>
<tr><td><code>"prefix"</code></td><td>Defines what it writes before the content.</td><td>string</td><td></td><td></td></tr>
<tr><td><code>"postfix"</code></td><td>Defines what it writes after the content.</td><td>string</td><td></td><td></td></tr>
</tbody></table>
</div>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Logs the current value:</p>
<pre><code class="language-json">{ "log": {} }
</code></pre>
</li>
<li>
<p>Logs the current value with <code>-&gt;</code> as the prefix:</p>
<pre><code class="language-json">{ "log": 
  { "prefix" : "-&gt; " } 
}
</code></pre>
</li>
</ul>
<h2 id="block-transformer"><a class="header" href="#block-transformer">Block Transformer</a></h2>
<p>When the ETL module calls the Block Transformer, it executes an ETL <a href="etl/Block.html">Block</a> component as a transformation step.</p>
<p>Component description.</p>
<ul>
<li>Component name: <strong>block</strong></li>
<li>Supported inputs types: [<strong>Any</strong>]</li>
<li>Output: <strong>Any</strong></li>
</ul>
<p><strong>Syntax</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Mandatory</th><th>Default value</th></tr></thead><tbody>
<tr><td><code>"block"</code></td><td>Defines the block to execute.</td><td>document</td><td>yes</td><td></td></tr>
</tbody></table>
</div>
<p><strong>Example</strong></p>
<ul>
<li>
<p>Log the current value:</p>
<pre><code class="language-json">{ "block": 
  { "let": 
    { "name": "id",
      "value": "={eval('$input.amount * 2')}"
    }
  }
}
</code></pre>
</li>
</ul>
<h2 id="command-transformer"><a class="header" href="#command-transformer">Command Transformer</a></h2>
<p>When the ETL module calls the Command Transformer, it executes the given command.</p>
<p>Component description.</p>
<ul>
<li>Component name: <strong>command</strong></li>
<li>Supported inputs types: [<strong>ODocument</strong>]</li>
<li>Output: <strong>ODocument</strong></li>
</ul>
<p><strong>Syntax</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Mandatory</th><th>Default value</th></tr></thead><tbody>
<tr><td><code>"language"</code></td><td>Defines the command language: SQL or Gremlin.</td><td>string</td><td></td><td><code>sql</code></td></tr>
<tr><td><code>"command"</code></td><td>Defines the command to execute.</td><td>string</td><td>yes</td><td></td></tr>
</tbody></table>
</div>
<p><strong>Example</strong></p>
<ul>
<li>
<p>Executes a <a href="etl/../sql/SQL-Query.html"><code>SELECT</code></a> and output an edge:</p>
<pre><code class="language-json">{ "command" : 
  { "command" : "SELECT FROM E WHERE id = ${input.edgeid}",
    "output" : "edge"
  }
}
</code></pre>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-12-11 SAM -->
<h1 id="etl---loaders"><a class="header" href="#etl---loaders">ETL - Loaders</a></h1>
<p>When the ETL module executes, Loaders handle the saving of records.  They run at the last stage of the process.  The ETL module in OrientDB supports the following loaders:</p>
<ul>
<li><a href="etl/Loader.html#output-loader">Output</a></li>
<li><a href="etl/Loader.html#orientdb-loader">OrientDB</a></li>
</ul>
<h2 id="output-loader"><a class="header" href="#output-loader">Output Loader</a></h2>
<p>When the ETL module runs the Output Loader, it prints the transformer results to the console output.  This is the loader that runs by default.</p>
<ul>
<li>Component name: <strong>output</strong></li>
<li>Accepted input classes: [<strong>Object</strong>]</li>
</ul>
<h2 id="orientdb-loader"><a class="header" href="#orientdb-loader">OrientDB Loader</a></h2>
<p>When the ETL module runs the OrientDB Loader, it loads the records and vertices from the transformers into the OrientDB database.</p>
<ul>
<li>Component name: <code>orientdb</code></li>
<li>Accepted input classes: <code>[ ODocument, OrientVertex ]</code></li>
</ul>
<p><strong>Syntax</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Mandatory</th><th>Default value</th></tr></thead><tbody>
<tr><td><code>"dbURL"</code></td><td>Defines the database URL.</td><td>string</td><td>yes</td><td></td></tr>
<tr><td><code>"dbUser"</code></td><td>Defines the user name.</td><td>string</td><td></td><td><code>admin</code></td></tr>
<tr><td><code>"dbPassword"</code></td><td>Defines the user password.</td><td>string</td><td></td><td><code>admin</code></td></tr>
<tr><td><code>"serverUser"</code></td><td>Defines the server administrator user name, usually <code>root</code></td><td>string</td><td></td><td></td></tr>
<tr><td><code>"serverPassword"</code></td><td>Defines the server administrator user password that is provided at server startup</td><td>string</td><td></td><td></td></tr>
<tr><td><code>"dbAutoCreate"</code></td><td>Defines whether it automatically creates the database, in the event that it doesn't exist already.</td><td>boolean</td><td></td><td><code>true</code></td></tr>
<tr><td><code>"dbAutoCreateProperties"</code></td><td>Defines whether it automatically creates properties in the schema.</td><td>boolean</td><td></td><td><code>false</code></td></tr>
<tr><td><code>"dbAutoDropIfExists"</code></td><td>Defines whether it automatically drops the database if it exists already.</td><td>boolean</td><td></td><td><code>false</code></td></tr>
<tr><td><code>"tx"</code></td><td>Defines whether it uses <a href="etl/../internals/Transactions.html">transactions</a></td><td>boolean</td><td></td><td><code>false</code></td></tr>
<tr><td><code>"txUseLog"</code></td><td>Defines whether it uses log in transactions.</td><td>boolean</td><td></td><td></td></tr>
<tr><td><code>"wal"</code></td><td>Defines whether it uses write ahead logging.  Disable to achieve better performance.</td><td>boolean</td><td></td><td><code>true</code></td></tr>
<tr><td><code>"batchCommit"</code></td><td>When using transactions, defines the batch of entries it commits.  Helps avoid having one large transaction in memory.</td><td>integer</td><td></td><td><code>0</code></td></tr>
<tr><td><code>"dbType"</code></td><td>Defines the database type: <code>graph</code> or <code>document</code>.</td><td>string</td><td></td><td><code>document</code></td></tr>
<tr><td><code>"class"</code></td><td>Defines the class to use in storing new record.</td><td>string</td><td></td><td></td></tr>
<tr><td><code>"cluster"</code></td><td>Defines the cluster in which to store the new record.</td><td>string</td><td></td><td></td></tr>
<tr><td><code>"classes"</code></td><td>Defines whether it creates <a href="etl/Loader.html#classes">classes</a>, if not defined already in the database.</td><td>inner document</td><td></td><td></td></tr>
<tr><td><code>"indexes"</code></td><td>Defines <a href="etl/Loader.html#indexes">indexes</a> to use on the ETL process.  Before starting, it creates any declared indexes not present in the database.  Indexes must have <code>"type"</code>, <code>"class"</code> and <code>"fields"</code>.</td><td>inner document</td><td></td><td></td></tr>
<tr><td><code>"useLightweightEdges"</code></td><td>Defines whether it changes the default setting for <a href="etl/../java/Lightweight-Edges.html">Lightweight Edges</a>.</td><td>boolean</td><td></td><td><code>false</code></td></tr>
<tr><td><code>"standardELementConstraints"</code></td><td>Defines whether it changes the default setting for TinkerPop BLueprint constraints.  Value cannot be null and you cannot use <code>id</code> as a property name.</td><td>boolean</td><td></td><td><code>true</code></td></tr>
</tbody></table>
</div>
<p>For the <code>"txUseLog"</code> parameter, when WAL is disabled you can still achieve reliable transactions through this parameter.  You may find it useful to group many operations into a batch, such as <a href="etl/../sql/SQL-Create-Edge.html"><code>CREATE EDGE</code></a>.
If <code>"dbAutoCreate"</code> or <code>"dbAutoDropIfExists"</code> are set to true and remote connection is used,  <code>serverUsername</code> and <code>serverPassword</code> must be provided. Usually the server administrator user name is <code>root</code> and  the password is provided at the startup of the OrientDB server.</p>
<h3 id="classes-2"><a class="header" href="#classes-2">Classes</a></h3>
<p>When using the <code>"classes"</code> parameter, it defines an inner document that contains additional configuration variables.</p>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Mandatory</th><th>Default value</th></tr></thead><tbody>
<tr><td><code>"name"</code></td><td>Defines the class name.</td><td>string</td><td>yes</td><td></td></tr>
<tr><td><code>"extends"</code></td><td>Defines the super-class name.</td><td>string</td><td></td><td></td></tr>
<tr><td><code>"clusters"</code></td><td>Defines the number of cluster to create under the class.</td><td>integer</td><td></td><td><code>1</code></td></tr>
</tbody></table>
</div>
<blockquote>
<p><strong>NOTE</strong>: The <code>"clusters"</code> parameter was introduced in version 2.1.</p>
</blockquote>
<h3 id="indexes-2"><a class="header" href="#indexes-2">Indexes</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Mandatory</th><th>Default value</th></tr></thead><tbody>
<tr><td><code>"name"</code></td><td>Defines the index name.</td><td>string</td><td></td><td></td></tr>
<tr><td><code>"class"</code></td><td>Defines the class name in which to create the index.</td><td>string</td><td>yes</td><td></td></tr>
<tr><td><code>"type"</code></td><td>Defines the index type.</td><td>string</td><td>yes</td><td></td></tr>
<tr><td><code>"fields"</code></td><td>Defines an array of fields to index.  To specify the field type, use the syntax: <code>&lt;field&gt;.&lt;type&gt;</code>.</td><td>string</td><td>yes</td><td></td></tr>
<tr><td><code>"metadata"</code></td><td>Defines additional index metadata.</td><td>string</td><td></td><td></td></tr>
</tbody></table>
</div>
<h2 id="examples-3"><a class="header" href="#examples-3">Examples</a></h2>
<p>Configuration to load data into the database <code>dbpedia</code> on OrientDB, in the directory <code>/temp/databases</code> using the PLocal protocol and a Graph database.  The load is transactional, performing commits in thousand insert batches.  It creates two lookup vertices with indexes against the property string <code>URI</code> in the base vertex class <code>V</code>.  The index is unique.</p>
<pre><code class="language-json">"orientdb": {
      "dbURL": "plocal:/temp/databases/dbpedia",
      "dbUser": "importer",
      "dbPassword": "IMP",
      "dbAutoCreate": true,
      "tx": false,
      "batchCommit": 1000,
      "wal" : false,
      "dbType": "graph",
      "classes": [
        {"name":"Person", "extends": "V" },
        {"name":"Customer", "extends": "Person", "clusters":8 }
      ],
      "indexes": [
        {"class":"V", "fields":["URI:string"], "type":"UNIQUE" },
        {"class":"Person", "fields":["town:string"], "type":"NOTUNIQUE" ,
            metadata : { "ignoreNullValues" : false }
        }
      ]
    }
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="import-from-a-csv-file-to-a-graph"><a class="header" href="#import-from-a-csv-file-to-a-graph">Import from a CSV file to a Graph</a></h1>
<p>This example describes the process for importing from a CSV file into OrientDB as a Graph. For the sake of simplicity, consider only these 2 entities:</p>
<ul>
<li>POST</li>
<li>COMMENT</li>
</ul>
<p>Also consider the relationship between Post and Comment as One-2-Many. One Post can have multiple Comments. We're representing them as they would appear in an RDBMS, but the source could be anything.</p>
<p>With an RDBMS Post and Comment would be stored in 2 separate tables:</p>
<pre><code>TABLE POST:
+----+----------------+
| id | title          |
+----+----------------+
| 10 | NoSQL movement |
| 20 | New OrientDB   |
+----+----------------+

TABLE COMMENT:
+----+--------+--------------+
| id | postId | text         |
+----+--------+--------------+
|  0 |   10   | First        |
|  1 |   10   | Second       |
| 21 |   10   | Another      |
| 41 |   20   | First again  |
| 82 |   20   | Second Again |
+----+--------+--------------+
</code></pre>
<p>With an RDBMS, one-2-many references are inverted from the target table (Comment) to the source one (Post). This is due to the inability of an RDBMS to handle a collection of values.</p>
<p>In comparison, using the OrientDB Graph model, relationships are modeled as you would think, when you design an application: POSTs have edges to COMMENTs.</p>
<p>So, with an RDBMS you have:</p>
<pre><code>Table POST    &lt;- (foreign key) Table COMMENT
</code></pre>
<p>With OrientDB, the Graph model uses <a href="etl/../gettingstarted/Tutorial-Working-with-graphs.html">Edges</a> to manage relationships:</p>
<pre><code>Class POST -&gt;* (collection of edges) Class COMMENT
</code></pre>
<h2 id="1-export-to-csv"><a class="header" href="#1-export-to-csv">(1) Export to CSV</a></h2>
<p>If you're using an RDBMS or any other source, export your data in <a href="etl/Transformer.html#csv-transformer">CSV</a> format. The ETL module is also able to extract from <a href="etl/Extractor.html#json-extractor">JSON</a> and an RDBMS directly through <a href="etl/Extractor.html#jdbc-extractor">JDBC</a> drivers. However, for the sake of simplicity, in this example we're going to use <a href="etl/Transformer.html#csv-transformer">CSV</a> as the source format.</p>
<p>Consider having 2 CSV files:</p>
<h4 id="file-postscsv"><a class="header" href="#file-postscsv">File posts.csv</a></h4>
<p><strong>posts.csv</strong> file, containing all the posts</p>
<pre><code>id,title
10,NoSQL movement
20,New OrientDB
</code></pre>
<h4 id="file-commentscsv"><a class="header" href="#file-commentscsv">File comments.csv</a></h4>
<p><strong>comments.csv</strong> file, containing all the comments, with the relationship to the commented post</p>
<pre><code>id,postId,text
0,10,First
1,10,Second
21,10,Another
41,20,First again
82,20,Second Again
</code></pre>
<h2 id="2-etl-configuration"><a class="header" href="#2-etl-configuration">(2) ETL Configuration</a></h2>
<p>The OrientDB ETL tool requires only a JSON file to define the ETL process as <a href="etl/Extractor.html">Extractor</a>, a list of <a href="etl/Transformer.html">Transformers</a> to be executed in the pipeline, and a <a href="etl/Loader.html">Loader</a>, to load graph elements into the OrientDB database.</p>
<p>Below are 2 files containing the ETL to import Posts and Comments separately.</p>
<h3 id="postjson-etl-file"><a class="header" href="#postjson-etl-file">post.json ETL file</a></h3>
<pre><code class="language-json">{
  "source": { "file": { "path": "/temp/datasets/posts.csv" } },
  "extractor": { "csv": {} },
  "transformers": [
    { "vertex": { "class": "Post" } }
  ],
  "loader": {
    "orientdb": {
       "dbURL": "plocal:/temp/databases/blog",
       "dbType": "graph",
       "classes": [
         {"name": "Post", "extends": "V"},
         {"name": "Comment", "extends": "V"},
         {"name": "HasComments", "extends": "E"}
       ], "indexes": [
         {"class":"Post", "fields":["id:integer"], "type":"UNIQUE" }
       ]
    }
  }
}
</code></pre>
<p>The Loader contains all the information to connect to an OrientDB database. We have used a plocal database, because it's faster. However, if you have an OrientDB server up &amp; running, use "remote:" instead. Note the classes and indexes declared in the Loader. As soon as the Loader is configured, the classes and indexes are created, if they do not already exist. We have created the index on the Post.id field to assure that there are no duplicates and that the lookup on the created edges (see below) will be fast enough.</p>
<h3 id="commentsjson-etl-file"><a class="header" href="#commentsjson-etl-file">comments.json ETL file</a></h3>
<pre><code class="language-json">{
  "source": { "file": { "path": "/temp/datasets/comments.csv" } },
  "extractor": { "csv": {} },
  "transformers": [
    { "vertex": { "class": "Comment" } },
    { "edge": { "class": "HasComments",
                "joinFieldName": "postId",
                "lookup": "Post.id",
                "direction": "in"
            }
        }
  ],
  "loader": {
    "orientdb": {
       "dbURL": "plocal:/temp/databases/blog",
       "dbType": "graph",
       "classes": [
         {"name": "Post", "extends": "V"},
         {"name": "Comment", "extends": "V"},
         {"name": "HasComments", "extends": "E"}
       ], "indexes": [
         {"class":"Post", "fields":["id:integer"], "type":"UNIQUE" }
       ]
    }
  }
}
</code></pre>
<p>This file is similar to the previous one, but the Edge transformer does the job. Since the link found in the CSV goes in the opposite direction (Comment-&gt;Post), while we want to model directly (Post-&gt;Comment), we used the direction "in" (default is always "out").</p>
<h2 id="3-run-the-etl-process"><a class="header" href="#3-run-the-etl-process">(3) Run the ETL process</a></h2>
<p>Now allow the ETL to run by executing both imports in sequence. Open a shell under the OrientDB home directory, and execute the following steps:</p>
<pre><code>$ cd bin
$ ./oetl.sh post.json
$ ./oetl.sh comment.json
</code></pre>
<p>Once both scripts execute successfully, you'll have your Blog imported into OrientDB as a Graph!</p>
<h2 id="4-check-the-database"><a class="header" href="#4-check-the-database">(4) Check the database</a></h2>
<p>Open the database under the OrientDB console and execute the following commands to check that the import is ok:</p>
<pre><code>$ ./console.sh

OrientDB console v.2.0-SNAPSHOT (build 2565) www.orientechnologies.com
Type 'help' to display all the supported commands.
Installing extensions for GREMLIN language v.2.6.0

orientdb&gt; connect plocal:/temp/databases/blog admin admin

Connecting to database [plocal:/temp/databases/blog] with user 'admin'...OK

orientdb {db=blog}&gt; select expand( out() ) from Post where id = 10

----+-----+-------+----+------+-------+--------------
#   |@RID |@CLASS |id  |postId|text   |in_HasComments
----+-----+-------+----+------+-------+--------------
0   |#12:0|Comment|0   |10    |First  |[size=1]
1   |#12:1|Comment|1   |10    |Second |[size=1]
2   |#12:2|Comment|21  |10    |Another|[size=1]
----+-----+-------+----+------+-------+--------------

3 item(s) found. Query executed in 0.002 sec(s).
orientdb {db=blog}&gt; select expand( out() ) from Post where id = 20

----+-----+-------+----+------+------------+--------------
#   |@RID |@CLASS |id  |postId|text        |in_HasComments
----+-----+-------+----+------+------------+--------------
0   |#12:3|Comment|41  |20    |First again |[size=1]
1   |#12:4|Comment|82  |20    |Second Again|[size=1]
----+-----+-------+----+------+------------+--------------

2 item(s) found. Query executed in 0.001 sec(s).
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-12-11 SAM -->
<h1 id="import-a-tree-structure"><a class="header" href="#import-a-tree-structure">Import a tree structure</a></h1>
<p>If you have a tree structure in an RDBMS or CSV file and you want to import it in OrientDB, the ETL can come to your rescue. In this example, we use CSV for the sake of simplicity, but it's the same with JDBC input and a SQL query against an RDBMS.</p>
<h2 id="sourcecsv"><a class="header" href="#sourcecsv">source.csv</a></h2>
<pre><code>ID,PARENT_ID,LAST_YEAR_INCOME,DATE_OF_BIRTH,STATE
0,-1,10000,1990-08-11,Arizona
1,0,12234,1976-11-07,Missouri
2,0,21322,1978-01-01,Minnesota
3,0,33333,1960-05-05,Iowa
</code></pre>
<h2 id="etljson"><a class="header" href="#etljson">etl.json</a></h2>
<pre><code class="language-json">{
  "source": { "file": { "path": "source.csv" } },
  "extractor": { "row": {} },
  "transformers": [
    { "csv": {} },
    { "vertex": { "class": "User" } },
	{ "edge": {
		"class": "ParentOf",
		"joinFieldName": "PARENT_ID",
		"direction": "in",
		"lookup": "User.ID",
                "unresolvedLinkAction": "SKIP"
		}
	}
  ],
  "loader": {
    "orientdb": {
       "dbURL": "plocal:/temp/mydb",
       "dbType": "graph",
       "classes": [
         {"name": "User", "extends": "V"},
		 {"name": "ParentOf", "extends": "E"}
       ], "indexes": [
         {"class":"User", "fields":["ID:Long"], "type":"UNIQUE" }
       ]
    }
  }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="import-form-json"><a class="header" href="#import-form-json">Import form JSON</a></h1>
<p>If you are migrating from MongoDB or any other DBMS that exports data in JSON format, the <a href="etl/Extractor.html#json-extractor">JSON extractor</a> is what you need. For more information look also at: <a href="etl/Import-from-PARSE.html">Import-from-PARSE</a>.</p>
<p>This is the input file stored in <code>/tmp/database.json</code> file:</p>
<pre><code class="language-json">[
 {
  "name": "Joe",
  "id": 1,
  "friends": [2,4,5],
  "enemies": [6]
 },
 {
  "name": "Suzie",
  "id": 2,
  "friends": [1,4,6],
  "enemies": [5,2]
 }
]
</code></pre>
<p>Note that <code>friends</code> and <code>enemies</code> represent relationships with nodes of the same type. They are in the form of an array of IDs. This is what we need:</p>
<ul>
<li>Use the Vertex class "Account" to store nodes</li>
<li>Use the Edge classes "Friend" and "Enemy" to connect vertices</li>
<li>Merge and Lookups will be on <code>id</code> property of Account class that will be unique</li>
<li>In case the connected friend hasn't been inserted yet, create it ("unresolvedLinkAction": "CREATE")</li>
<li>To speed up lookups, a unique index will be created on <code>Account.it</code></li>
</ul>
<p>And this pipeline (log is at <code>debug</code> level to show all the messages):</p>
<pre><code class="language-json">{
  "config": {
    "log": "debug"
  },
  "source" : {
    "file": { "path": "/tmp/database.json" }
  },
  "extractor" : {
    "json": {}
  },
  "transformers" : [
    { "merge": { "joinFieldName": "id", "lookup": "Account.id" } },
    { "vertex": { "class": "Account"} },
    { "edge": {
      "class": "Friend",
      "joinFieldName": "friends",
      "lookup": "Account.id",
      "unresolvedLinkAction": "CREATE"
    } },
    { "edge": {
      "class": "Enemy",
      "joinFieldName": "enemies",
      "lookup": "Account.id",
      "unresolvedLinkAction": "CREATE"
    } }
  ],
  "loader" : {
    "orientdb": {
      "dbURL": "plocal:/tmp/databases/db",
      "dbUser": "admin",
      "dbPassword": "admin",
      "dbAutoDropIfExists": true,
      "dbAutoCreate": true,
      "standardElementConstraints": false,
      "tx": false,
      "wal": false,
      "batchCommit": 1000,
      "dbType": "graph",
      "classes": [{"name": "Account", "extends":"V"}, {"name": "Friend", "extends":"E"}, {"name": "Enemy", "extends":"E"}],
      "indexes": [{"class":"Account", "fields":["id:integer"], "type":"UNIQUE_HASH_INDEX" }]
    }
  }
}
</code></pre>
<p>Note also the setting</p>
<pre><code>      "standardElementConstraints": false,
</code></pre>
<p>This is needed, in order to allow importing the property "id" in the OrientDB Loader. Without this option, the Blueprints standard would reject it, because "id" is a reserved name.</p>
<p>By executing the ETL process, this is the output:</p>
<pre><code>OrientDB etl v.2.1-SNAPSHOT www.orientechnologies.com
feb 09, 2015 2:46:42 AM com.orientechnologies.common.log.OLogManager log
INFORMAZIONI: OrientDB auto-config DISKCACHE=10.695MB (heap=3.641MB os=16.384MB disk=42.205MB)
[orientdb] INFO Dropping existent database 'plocal:/tmp/databases/db'...
BEGIN ETL PROCESSOR
[file] DEBUG Reading from file /tmp/database.json
[orientdb] DEBUG - OrientDBLoader: created vertex class 'Account' extends 'V'
[orientdb] DEBUG orientdb: found 0 vertices in class 'null'
[orientdb] DEBUG - OrientDBLoader: created edge class 'Friend' extends 'E'
[orientdb] DEBUG orientdb: found 0 vertices in class 'null'
[orientdb] DEBUG - OrientDBLoader: created edge class 'Enemy' extends 'E'
[orientdb] DEBUG orientdb: found 0 vertices in class 'null'
[orientdb] DEBUG - OrientDBLoader: created property 'Account.id' of type: integer
[orientdb] DEBUG - OrientDocumentLoader: created index 'Account.id' type 'UNIQUE_HASH_INDEX' against Class 'Account', fields [id:integer]
[0:merge] DEBUG Transformer input: {name:Joe,id:1,friends:[3],enemies:[1]}
[0:merge] DEBUG joinValue=1, lookupResult=null
[0:merge] DEBUG Transformer output: {name:Joe,id:1,friends:[3],enemies:[1]}
[0:vertex] DEBUG Transformer input: {name:Joe,id:1,friends:[3],enemies:[1]}
[0:vertex] DEBUG Transformer output: v(Account)[#11:0]
[0:edge] DEBUG Transformer input: v(Account)[#11:0]
[0:edge] DEBUG joinCurrentValue=2, lookupResult=null
[0:edge] DEBUG created new vertex=Account#11:1{id:2} v1
[0:edge] DEBUG created new edge=e[#12:0][#11:0-Friend-&gt;#11:1]
[0:edge] DEBUG joinCurrentValue=4, lookupResult=null
[0:edge] DEBUG created new vertex=Account#11:2{id:4} v1
[0:edge] DEBUG created new edge=e[#12:1][#11:0-Friend-&gt;#11:2]
[0:edge] DEBUG joinCurrentValue=5, lookupResult=null
[0:edge] DEBUG created new vertex=Account#11:3{id:5} v1
[0:edge] DEBUG created new edge=e[#12:2][#11:0-Friend-&gt;#11:3]
[0:edge] DEBUG Transformer output: v(Account)[#11:0]
[0:edge] DEBUG Transformer input: v(Account)[#11:0]
[0:edge] DEBUG joinCurrentValue=6, lookupResult=null
[0:edge] DEBUG created new vertex=Account#11:4{id:6} v1
[0:edge] DEBUG created new edge=e[#13:0][#11:0-Enemy-&gt;#11:4]
[0:edge] DEBUG Transformer output: v(Account)[#11:0]
[1:merge] DEBUG Transformer input: {name:Suzie,id:2,friends:[3],enemies:[2]}
[1:merge] DEBUG joinValue=2, lookupResult=Account#11:1{id:2,in_Friend:[#12:0]} v2
[1:merge] DEBUG merged record Account#11:1{id:2,in_Friend:[#12:0],name:Suzie,friends:[3],enemies:[2]} v2 with found record={name:Suzie,id:2,friends:[3],enemies:[2]}
[1:merge] DEBUG Transformer output: Account#11:1{id:2,in_Friend:[#12:0],name:Suzie,friends:[3],enemies:[2]} v2
[1:vertex] DEBUG Transformer input: Account#11:1{id:2,in_Friend:[#12:0],name:Suzie,friends:[3],enemies:[2]} v2
[1:vertex] DEBUG Transformer output: v(Account)[#11:1]
[1:edge] DEBUG Transformer input: v(Account)[#11:1]
[1:edge] DEBUG joinCurrentValue=1, lookupResult=Account#11:0{name:Joe,id:1,friends:[3],enemies:[1],out_Friend:[#12:0, #12:1, #12:2],out_Enemy:[#13:0]} v5
[1:edge] DEBUG created new edge=e[#12:3][#11:1-Friend-&gt;#11:0]
[1:edge] DEBUG joinCurrentValue=4, lookupResult=Account#11:2{id:4,in_Friend:[#12:1]} v2
[1:edge] DEBUG created new edge=e[#12:4][#11:1-Friend-&gt;#11:2]
[1:edge] DEBUG joinCurrentValue=6, lookupResult=Account#11:4{id:6,in_Enemy:[#13:0]} v2
[1:edge] DEBUG created new edge=e[#12:5][#11:1-Friend-&gt;#11:4]
[1:edge] DEBUG Transformer output: v(Account)[#11:1]
[1:edge] DEBUG Transformer input: v(Account)[#11:1]
[1:edge] DEBUG joinCurrentValue=5, lookupResult=Account#11:3{id:5,in_Friend:[#12:2]} v2
[1:edge] DEBUG created new edge=e[#13:1][#11:1-Enemy-&gt;#11:3]
[1:edge] DEBUG joinCurrentValue=2, lookupResult=Account#11:1{id:2,in_Friend:[#12:0],name:Suzie,friends:[3],enemies:[2],out_Friend:[#12:3, #12:4, #12:5],out_Enemy:[#13:1]} v6
[1:edge] DEBUG created new edge=e[#13:2][#11:1-Enemy-&gt;#11:1]
[1:edge] DEBUG Transformer output: v(Account)[#11:1]
END ETL PROCESSOR
+ extracted 2 entries (0 entries/sec) - 2 entries -&gt; loaded 2 vertices (0 vertices/sec) Total time: 228ms [0 warnings, 0 errors]
</code></pre>
<p>Once ready, let's open the database with Studio and this is the result:</p>
<p><img src="http://www.orientdb.com/images/etl_imported_json.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="etl---import-from-rdbms"><a class="header" href="#etl---import-from-rdbms">ETL - Import from RDBMS</a></h1>
<p>Most of DBMSs support <a href="http://en.wikipedia.org/wiki/JDBC_driver">JDBC</a> driver. All you need is to gather the JDBC driver and put it in classpath or simply in the $ORIENTDB_HOME/lib directory.</p>
<p>With the configuration below all the records from the table "Client" are imported in OrientDB from MySQL database.</p>
<h2 id="example-importing-a-flat-table"><a class="header" href="#example-importing-a-flat-table">Example importing a flat table</a></h2>
<pre><code class="language-json">{
  "config": {
    "log": "debug"
  },
  "extractor" : {
    "jdbc": { "driver": "com.mysql.jdbc.Driver",
              "url": "jdbc:mysql://localhost/mysqlcrm",
              "userName": "root",
              "userPassword": "",
              "query": "select * from Client" }
  },
  "transformers" : [
   { "vertex": { "class": "Client"} }
  ],
  "loader" : {
    "orientdb": {
      "dbURL": "plocal:/temp/databases/orientdbcrm",
      "dbAutoCreate": true
    }
  }
}
</code></pre>
<h2 id="example-loading-records-from-2-connected-tables"><a class="header" href="#example-loading-records-from-2-connected-tables">Example loading records from 2 connected tables</a></h2>
<p>With this example we want to import a database that contains Blog posts in the following tables:</p>
<ul>
<li>Authors, in TABLE <strong>Author</strong>, with the following columns: <strong>id</strong> and <strong>name</strong></li>
<li>Posts, in TABLE <strong>Post</strong>, with the following columns: <strong>author_id</strong>, <strong>title</strong> and <strong>text</strong></li>
</ul>
<p>To import them into OrientDB we'd need 2 ETL processes.</p>
<h3 id="importing-of-authors"><a class="header" href="#importing-of-authors">Importing of Authors</a></h3>
<pre><code class="language-json">{
  "config": {
    "log": "debug"
  },
  "extractor" : {
    "jdbc": { "driver": "com.mysql.jdbc.Driver",
              "url": "jdbc:mysql://localhost/mysql",
              "userName": "root",
              "userPassword": "",
              "query": "select * from Author" }
  },
  "transformers" : [
   { "vertex": { "class": "Author"} }
  ],
  "loader" : {
    "orientdb": {
      "dbURL": "plocal:/temp/databases/orientdb",
      "dbAutoCreate": true
    }
  }
}
</code></pre>
<h3 id="importing-of-posts"><a class="header" href="#importing-of-posts">Importing of Posts</a></h3>
<pre><code class="language-json">{
  "config": {
    "log": "debug"
  },
  "extractor" : {
    "jdbc": { "driver": "com.mysql.jdbc.Driver",
              "url": "jdbc:mysql://localhost/mysql",
              "userName": "root",
              "userPassword": "",
              "query": "select * from Post" }
  },
  "transformers" : [
   { "vertex": { "class": "Post"} },
   { "edge": { "class": "Wrote", "direction" : "in", 
            "joinFieldName": "author_id",
            "lookup":"Author.id", "unresolvedLinkAction":"CREATE"} }
  ],
  "loader" : {
    "orientdb": {
      "dbURL": "plocal:/temp/databases/orientdb",
      "dbAutoCreate": true
    }
  }
}
</code></pre>
<p>Note the edge configuration has the direction as "in", that means starts from the Author and finishes to Post.</p>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-12-11 SAM -->
<h1 id="import-from-db-pedia"><a class="header" href="#import-from-db-pedia">Import from DB-Pedia</a></h1>
<p><a href="http://oldwiki.dbpedia.org/DBpediaAsTables">DBPedia</a> exports all the entities as GZipped CSV files.
Features:</p>
<ul>
<li>First line contains column names, second, third and forth has meta information, which we'll skip (look at <code>"skipFrom": 1, "skipTo": 3</code>in CSV transformer)</li>
<li>The vertex class name is created automatically based on the file name, so we can use the same file against any DBPedia file</li>
<li>The Primary Key is the "URI" field, where a UNIQUE index has also been created (refer to "ORIENTDB" loader)</li>
<li>The "merge" transformer is used to allow to re-import or update any file without generating duplicates</li>
</ul>
<h2 id="configuration-5"><a class="header" href="#configuration-5">Configuration</a></h2>
<pre><code class="language-json">{
  "config": {
    "log": "debug",
    "fileDirectory": "/temp/databases/dbpedia_csv/",
    "fileName": "Person.csv.gz"
  },
  "begin": [
   { "let": { "name": "$filePath",  "value": "$fileDirectory.append( $fileName )"} },
   { "let": { "name": "$className", "value": "$fileName.substring( 0, $fileName.indexOf('.') )"} }
  ],
  "source" : {
    "file": { "path": "$filePath", "lock" : true }
  },
  "extractor" : {
   { "csv": { "separator": ",", "nullValue": "NULL", "skipFrom": 1, "skipTo": 3 } },
  },
  "transformers" : [
   { "merge": { "joinFieldName":"URI", "lookup":"V.URI" } },
   { "vertex": { "class": "$className"} }
  ],
  "loader" : {
    "orientdb": {
      "dbURL": "plocal:/temp/databases/dbpedia",
      "dbUser": "admin",
      "dbPassword": "admin",
      "dbAutoCreate": true,
      "tx": false,
      "batchCommit": 1000,
      "dbType": "graph",
      "indexes": [{"class":"V", "fields":["URI:string"], "type":"UNIQUE" }]
    }
  }
}

</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-12-11 SAM -->
<h1 id="import-from-parse"><a class="header" href="#import-from-parse">Import from Parse</a></h1>
<p><a href="https://parse.com/">Parse</a> is a very popular BaaS (Backend as a Service), acquired by Facebook. Parse uses MongoDB as a database and allows to export the database in JSON format. The format is an array of JSON objects. Example:</p>
<pre><code class="language-json">[
    {
        "user": {
            "__type": "Pointer",
            "className": "_User",
            "objectId": "Ldlskf4mfS"
        },
        "address": {
            "__type": "Pointer",
            "className": "Address",
            "objectId": "lvkDfj4dmS"
        },
        "createdAt": "2013-11-15T18:15:59.336Z",
        "updatedAt": "2014-02-27T23:47:00.440Z",
        "objectId": "Ldk39fDkcj",
        "ACL": {
            "Lfo33mfDkf": {
                "write": true
            },
            "*": {
                "read": true
            }
        }
    }, {
        "user": {
            "__type": "Pointer",
            "className": "_User",
            "objectId": "Lflfem3mFe"
        },
        "address": {
            "__type": "Pointer",
            "className": "Address",
            "objectId": "Ldldjfj3dd"
        },
        "createdAt": "2014-01-01T18:04:02.321Z",
        "updatedAt": "2014-01-23T20:12:23.948Z",
        "objectId": "fkfj49fjFFN",
        "ACL": {
            "dlfnDJckss": {
                "write": true
            },
            "*": {
                "read": true
            }
        }
    }
]
</code></pre>
<p>Notes:</p>
<ul>
<li>Each object has its own <code>objectId</code> that identifies the object in the entire database.</li>
<li>Parse has the concept of <code>class</code>, like OrientDB.</li>
<li>Links are similar to OrientDB RID (but it requires a costly JOIN to be traversed), but made as an embedded object containing:</li>
<li><code>className</code> as target class name</li>
<li><code>objectId</code> as target objectId</li>
<li>Parse has ACL at record level, like <a href="http://www.orientechnologies.com/docs/last/orientdb.wiki/Security.html#record-level-security">OrientDB</a>.</li>
</ul>
<p>In order to import a PARSE file, you need to create the ETL configuration using JSON as Extractor.</p>
<h2 id="example-4"><a class="header" href="#example-4">Example</a></h2>
<p>In this example, we're going to import the file extracted from Parse containing all the records of the <code>user</code> class. Note the creation of the class <code>User</code> in OrientDB, which extends <code>V</code> (Base Vertex class). We created an index against property <code>User.objectId</code> to use the same ID, similar to Parse. If you execute this ETL import multiple times, the records in OrientDB will be updated thanks to the <code>merge</code> feature.</p>
<pre><code class="language-json">{
  "config": {
    "log": "debug"
  },
  "source" : {
    "file": { "path": "/temp/parse-user.json", "lock" : true }
  },
  "extractor" : {
    "json": {}
  },
  "transformers" : [
   { "merge": { "joinFieldName":"objectId", "lookup":"User.objectId" } },
   { "vertex": { "class": "User"} }
  ],
  "loader" : {
    "orientdb": {
      "dbURL": "plocal:/temp/databases/parse",
      "dbUser": "admin",
      "dbPassword": "admin",
      "dbAutoCreate": true,
      "tx": false,
      "batchCommit": 1000,
      "dbType": "graph",
      "classes": [
        {"name": "User", "extends": "V"}
      ],      
      "indexes": [
        {"class":"User", "fields":["objectId:string"], "type":"UNIQUE_HASH_INDEX" }
      ]
    }
  }
}

</code></pre>
<p>###See also:</p>
<p><a href="etl/Import-from-JSON.html">Import from JSON</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="neo4j-to-orientdb-importer"><a class="header" href="#neo4j-to-orientdb-importer">Neo4j to OrientDB Importer</a></h1>
<p>The <em>Neo4j to OrientDB Importer</em> is a tool that can help you importing in a quick way a Neo4j graph database into OrientDB.</p>
<p>Imported Neo4j items are:</p>
<ul>
<li>nodes</li>
<li>relationships</li>
<li>unique constraints</li>
<li>indexes</li>
</ul>
<blockquote>
<p>Neo4j and Cypher are registered trademark of Neo Technology, Inc.</p>
</blockquote>
<h2 id="supported-versions"><a class="header" href="#supported-versions">Supported Versions</a></h2>
<p>Currently, the <em>Neo4j to OrientDB Importer</em> supports, and has been tested with, the following versions:</p>
<ul>
<li>OrientDB: 2.2.x, 3.0.x</li>
<li>Neo4j: 3.x</li>
</ul>
<h2 id="limitations-1"><a class="header" href="#limitations-1">Limitations</a></h2>
<p>The following limitations apply:</p>
<ul>
<li>Currently only <code>local</code> migrations are allowed.</li>
<li>Schema limitations:
<ul>
<li>In case a node in Neo4j has multiple <em>Labels</em>, it will be imported into a single OrientDB <code>Class</code> (<em>"MultipleLabelNeo4jConversion"</em>).
<ul>
<li>Note that the information about the original set of Labels is not lost but stored into an internal property of the imported vertex (<em>"Neo4jLabelList"</em>). As a result, it will be possible to query nodes with a specific Neo4j <em>Label</em>. Note also that the nodes imported into the single class <em>"MultipleLabelNeo4jConversion"</em> can then be moved to other <code>Classes</code>, according to your specific needs, using the <a href="neo4j-to-orientdb-importer/../sql/SQL-Move-Vertex.html">MOVE VERTEX</a> command. For more information, please refer to <a href="neo4j-to-orientdb-importer/README.html#querying-nodes-by-original-neo4j-labels">this</a> Section.</li>
</ul>
</li>
<li>Neo4j Nodes with same <em>Label</em> but different case, e.g. <em>LABEL</em> and <em>LAbel</em> will be aggregated into a single OrientDB vertex <code>Class</code>.</li>
<li>Neo4j Relationship with same name but different case, e.g. <em>relaTIONship</em> and <em>RELATIONSHIP</em> will be aggregated into a single OrientDB edge <code>Class</code></li>
<li>Migration of Neo4j's <em>"existence"</em> constraints (only available in the Neo4j's Enterprise Edition) is currently not implemented.</li>
</ul>
</li>
</ul>
<h2 id="installation-5"><a class="header" href="#installation-5">Installation</a></h2>
<p>The <em>Neo4j to OrientDB Importer</em> is provided as an external plugin for the OrientDB Server, and is available as a <code>zip</code> or <code>tar.gz</code> archive.</p>
<p>Please download the plugin from maven central:</p>
<pre><code class="lang-sh">http://central.maven.org/maven2/com/orientechnologies/orientdb-neo4j-importer/3.2.44/orientdb-neo4j-importer-3.2.44.tar.gz</code></pre>
<p>Replace <code>tar.gz</code> with  <code>zip</code> for the <code>zip</code> archive.</p>
<p>To install the plugin, please unpack the archive on your OrientDB server directory (please make sure that the version of your OrientDB server and the version of the Neo4j to OrientDB Importer are the same. Upgrade your OrientDB server, if necessary). On Linux systems, to unpack the archive you can use a command like the following:</p>
<pre><code class="lang-sh">tar xfv orientdb-neo4j-importer-3.2.44.tar.gz -C path_to_orientDB/ --strip-components=1 </code></pre>
<h2 id="migration-scenarios"><a class="header" href="#migration-scenarios">Migration Scenarios</a></h2>
<p>A typical migration scenario consists of the following steps:</p>
<ul>
<li>A copy of the Neo4j's database graph directory (typically <code>graph.db</code>) is created into a safe place</li>
<li>OrientDB is installed</li>
<li>The <em>Neo4j to OrientDB Importer</em> is installed</li>
<li>The migration process is started from the command line, passing to the <em>Neo4j to OrientDB Importer</em> the copy of the Neo4j's database directory created earlier</li>
<li>OrientDB (embedded or server) is started and the newly imported graph database can be used</li>
</ul>
<p><strong>Notes:</strong></p>
<ul>
<li>
<p>Since currently only exclusive, <code>local</code>, connections are allowed, during the migration there must be no running servers on the Neo4j's database directory and on the target OrientDB's import directory.</p>
</li>
<li>
<p>As an alternative of creating a copy of the Neo4j's database directory, and in case you can schedule a Neo4j shutdown, you can:</p>
<ul>
<li>Shutdown your Neo4j Server</li>
<li>Start the migration by passing the original Neo4j's database directory to the <em>Neo4j to OrientDB Importer</em> (a good practice is to create a back-up first)</li>
</ul>
</li>
</ul>
<h2 id="usage-6"><a class="header" href="#usage-6">Usage</a></h2>
<p>After Installation, the <em>Neo4j to OrientDB Importer</em> can be launched using the provided <code>orientdb-neo4j-importer.sh</code> script (or <code>orientdb-neo4j-importer.bat</code> for Windows systems).</p>
<h3 id="syntax-2"><a class="header" href="#syntax-2">Syntax</a></h3>
<pre><code>OrientDB-Neo4j-Importer
	-neo4jlibdir &lt;neo4jlibdir&gt; (mandatory)
	-neo4jdbdir &lt;neo4jdbdir&gt; (mandatory)
	[-odbdir &lt;odbdir&gt;]
    [-o true|false]
    [-i true|false]
</code></pre>
<p>Where:</p>
<ul>
<li>
<p><strong>neo4jlibdir</strong> (mandatory option) is the full path to the Neo4j lib directory (e.g. <code>D:\neo4j\neo4j-community-3.0.7\lib</code>). On Windows systems, this parameter must be the first passed parameter.</p>
</li>
<li>
<p><strong>neo4jdbdir</strong> (mandatory option) is the full path to the Neo4j’s graph database directory (e.g. <code>D:\neo4j\neo4j-community-3.0.7\data\databases\graph.db</code>).</p>
</li>
<li>
<p><strong>odbdir</strong> (optional) is the full path to a directory where the Neo4j database will be migrated. The directory will be created by the import tool. In case the directory exists already, the <em>Neo4j to OrientDB Importer</em> will behave accordingly to the value of the option <code>o</code> (see below). The default value of <code>odbdir</code> is <code>$ORIENTDB_HOME/databases/neo4j_import</code>.</p>
</li>
<li>
<p><strong>o</strong> (optional). If <code>true</code> the <code>odbdir</code> directory will be overwritten, if it exists. If <code>false</code> and the <code>odbdir</code> directory exists, a warning will be printed and the program will exit. The default value of <code>o</code> is <code>false</code>.</p>
</li>
<li>
<p><strong>i</strong> (optional). If <code>true</code> a unique index on the property <code>Neo4jRelID</code> will be created, for all migrated edge classes. This allows you to query relationships by original Neo4j relationship Ids. The default value of <code>i</code> is <code>false</code>.</p>
</li>
</ul>
<p>If the <em>Neo4j to OrientDB Importer</em> is launched without parameters, it fails because <strong>-neo4jlibdir</strong> and <strong>-neo4jdbdir</strong> are mandatory.</p>
<h3 id="example-5"><a class="header" href="#example-5">Example</a></h3>
<p>A typical import command looks like the following (please adapt the value of the <code>-neo4jlibdir</code> and <code>-neo4jdbdir</code> parameters to your specific case):</p>
<p><strong>Windows:</strong></p>
<pre><code>orientdb-neo4j-importer.bat -neo4jlibdir="D:\neo4j\neo4j-community-3.0.7\lib" -neo4jdbdir="D:\neo4j\neo4j-community-3.0.7\data\databases\graph.db"
</code></pre>
<p><strong>Linux / Mac:</strong></p>
<pre><code>./orientdb-neo4j-importer.sh -neo4jlibdir /mnt/d/neo4j/neo4j-community-3.0.7/lib -neo4jdbdir /mnt/d/neo4j/neo4j-community-3.0.7/data/databases/graph.db
</code></pre>
<h2 id="migration-details"><a class="header" href="#migration-details">Migration Details</a></h2>
<p>Internally, the <em>Neo4j to OrientDB Importer</em> makes use of the Neo4j's <code>java</code> API to read the graph database from Neo4j and of the OrientDB's <code>java</code> API to store the graph into OrientDB.</p>
<p>The import consists of four phases:</p>
<ul>
<li><strong>Phase 1:</strong> Initialization of the Neo4j and OrientDB servers</li>
<li><strong>Phase 2:</strong> Migration of nodes and relationships</li>
<li><strong>Phase 3:</strong> Schema migration</li>
<li><strong>Phase 4:</strong> Shutdown of the servers and summary info</li>
</ul>
<h3 id="general-migration-details"><a class="header" href="#general-migration-details">General Migration Details</a></h3>
<p>The following are some general migration details that is good to keep in mind:</p>
<ul>
<li>
<p>During the import, OrientDB's <a href="http://orientdb.dev/docs/3.2.x/Configuration.html#storageusewal"><code>WAL</code></a> and <a href="http://orientdb.dev/docs/3.2.x/Configuration.html#storagewalsynconpageflush"><code>WAL_SYNC_ON_PAGE_FLUSH</code></a> are disabled, and OrientDB is prepared for massive inserts (<em>OIntentMassiveInsert</em>).</p>
</li>
<li>
<p>In case a node in Neo4j has no <em>Label</em>, it will be imported in OrientDB into the Class <em>"GenericClassNeo4jConversion"</em>.</p>
</li>
<li>
<p>Starting from version 2.2.14, in case a node in Neo4j has multiple <em>Labels</em>, it will be imported into the <code>Class</code> <em>"MultipleLabelNeo4jConversion"</em>. Before 2.2.14, only the first <em>Label</em> was imported.</p>
</li>
<li>
<p>List of original Neo4j <em>Labels</em> are stored as properties in the imported OrientDB vertices (property: <em>"Neo4jLabelList"</em>).</p>
</li>
<li>
<p>During the import, a not unique index is created on the property <em>"Neo4jLabelList"</em>. This allows you to query by <em>Label</em> even over nodes migrated into the single <code>Class</code> <em>"MultipleLabelNeo4jConversion"</em>, using queries like:
<code>SELECT FROM V WHERE Neo4jLabelList CONTAINS 'your_label_here'</code> or the equivalent with the <a href="neo4j-to-orientdb-importer/../sql/SQL-Match.html">MATCH</a> syntax: <code>MATCH {class: V, as: your_alias, where: (Neo4jLabelList CONTAINS 'your_label'} RETURN your_alias</code>.</p>
</li>
<li>
<p>Original Neo4j <code>IDs</code> are stored as properties in the imported OrientDB vertices and edges (<code>Neo4jNodeID</code> for vertices and <code>Neo4jRelID</code> for edges). Such properties can be (manually) removed at the end of the import, if not needed.</p>
</li>
<li>
<p>During the import, an OrientDB index is created on the property <code>Neo4jNodeID</code> for all imported vertex <code>classes</code> (node's <em>Labels</em> in Neo4j). This is to speed up vertices lookup during edge creation. The created indexes can be (manually) removed at the end of the import, if not needed.</p>
</li>
<li>
<p>In case a Neo4j Relationship has the same name of a Neo4j <em>Label</em>, e.g. <em>"RelationshipName"</em>, the <em>Neo4j to OrientDB Importer</em> will import that relationship into OrientDB in the class <code>E_RelationshipName</code> (i.e. prefixing the Neo4j's <code>RelationshipType</code> with an <code>E_</code>).</p>
</li>
<li>
<p>During the creation of properties in OrientDB, Neo4j <code>Char</code> data type is mapped to a <code>String</code> data type.</p>
</li>
</ul>
<h3 id="details-on-schema-migration"><a class="header" href="#details-on-schema-migration">Details on Schema Migration</a></h3>
<p>The following are some schema-specific migration details that is good to keep in mind:</p>
<ul>
<li>
<p>If in Neo4j there are no constraints or indexes, and if we exclude the properties and indexes created for internal purposes (<code>Neo4jNodeID</code>, <code>Neo4jRelID</code>, <code>Neo4jLabelList</code> and corresponding indexes), the imported OrientDB database is schemaless.</p>
</li>
<li>
<p>If in Neo4j there are constraints or indexes, the imported OrientDB database is schema-hybrid (with some properties defined). In particular, for any constraint and index:</p>
<ul>
<li>
<p>The Neo4j property where the constraint or index is defined on, is determined.</p>
</li>
<li>
<p>A corresponding property is created in OrientDB (hence the schema-hybrid mode).</p>
</li>
</ul>
</li>
<li>
<p>If a Neo4j unique constraint is found, a corresponding unique index is created in OrientDB</p>
<ul>
<li>In case the creation of the unique index fails, a not unique index will be created. Note: this scenario can happen, by design, when migrating nodes that have multiple <em>Labels</em>, as they are imported into a single vertex <code>Class</code>).</li>
</ul>
</li>
<li>
<p>If a Neo4j index is found, a corresponding (not unique) OrientDB index is created.</p>
</li>
</ul>
<h2 id="migration-best-practices"><a class="header" href="#migration-best-practices">Migration Best Practices</a></h2>
<p>Below some migration best practices.</p>
<ol>
<li>
<p>Check if you are using <em>Labels</em> with same name but different case, e.g. <em>LABEL</em> and <em>LAbel</em> and if you really need them. If the correct <em>Label</em> is <em>Label</em>, change <em>LABEL</em> and <em>LAbel</em> to <em>Label</em> in the original Neo4j database before the import. If you really cannot change them, be aware that with the current version of the Neo4j to OrientDB Importer such nodes will be aggregated into a single OrientDB vertex <code>Class</code>.</p>
</li>
<li>
<p>Check if you are using relationships with same name but different case, e.g. <em>relaTIONship</em> and <em>RELATIONSHIP</em> and if you really need them. If the correct relationship is <em>Relationship</em>, change <em>relaTIONship</em> and <em>RELATIONSHIP</em> to <em>Relationship</em> before the import. If you really cannot change them, be aware that with the current version of the Neo4j to OrientDB Importer such relationships will be aggregated into a single OrientDB edge <code>Class</code>.</p>
</li>
<li>
<p>Check your constraints and indexes before starting the import. Sometime you have more constraints or indexes than needed, e.g. old ones that you created on <em>Labels</em> that you are not using anymore. These constraints will be migrated as well, so a best practice is to check that you have defined, in Neo4j, only those that you really want to import. To check constraints and indexes in Neo4j, you can type <code>:schema</code> in the Browser and then click on the "play" icon. Please delete the not needed items.</p>
</li>
<li>
<p>Check if you are using nodes with multiple <em>Labels</em>, and if you really need more than one <em>Label</em> on them. Be aware that with current version of the Neo4j to OrientDB Importer such nodes with multiple <em>Labels</em> will be imported into a single OrientDB <code>Class</code> ("<em>MultipleLabelNeo4jConversion</em>").</p>
</li>
</ol>
<h2 id="migration-log"><a class="header" href="#migration-log">Migration Log</a></h2>
<p>During the migration, a log file is created.</p>
<p>The log can be found at <code>path_to_orientDB/log/orientdb-neo4j-importer.log</code>.</p>
<h2 id="migration-monitoring"><a class="header" href="#migration-monitoring">Migration Monitoring</a></h2>
<p>During the migration, for each imported Neo4j items (nodes, relationships, constraints and indexes) a completion percentage is written in the shell from where the import has been started, thus allowing to monitor progresses.</p>
<p>For large imports, a best practice is to monitor also the produced import log, using a program like <code>tail</code>, e.g.</p>
<pre><code>tail -f -n 100 -f path_to_orientDB/log/orientdb-neo4j-importer.log
</code></pre>
<h2 id="migration-troubleshooting"><a class="header" href="#migration-troubleshooting">Migration Troubleshooting</a></h2>
<p>In case of problems, the details of the occurred errors are written in the migration log file. Please use this file to troubleshoot the migration.</p>
<h2 id="connecting-to-the-newly-imported-database-1"><a class="header" href="#connecting-to-the-newly-imported-database-1">Connecting to the newly imported Database</a></h2>
<p>After the migration process, you may start an OrientDB server using the <code>server.sh</code> or <code>server.bat</code> scripts.</p>
<p>You can connect to the newly imported database through <a href="neo4j-to-orientdb-importer/../studio/README.html">Studio</a> or the <a href="neo4j-to-orientdb-importer/../console/README.html">Console</a> using the OrientDB's default database users, e.g. using the user <em>admin</em> and password <em>admin</em>.</p>
<p>Please secure your database by removing the default users, if you don't need them, or by creating new users.</p>
<p>For further information on using OrientDB, please refer to the <a href="neo4j-to-orientdb-importer/../gettingstarted/Tutorial-Introduction-to-the-NoSQL-world.html">Getting Started Guide</a>.</p>
<h2 id="query-strategies"><a class="header" href="#query-strategies">Query Strategies</a></h2>
<p>This section includes a few strategies that you can use to query your data after the import.</p>
<p>As first thing, please be aware that in OrientDB you can query your data using both <a href="neo4j-to-orientdb-importer/../sql/README.html">SQL</a> or pattern matching. In case you are familiar with Neo4j's Cypher query language, it may be more easy for you to use our pattern matching (see our <a href="neo4j-to-orientdb-importer/../sql/SQL-Match.html">MATCH</a> syntax for more details). However, keep in mind that depending on your specific use case, our SQL can be of great help.</p>
<h3 id="counting-all-nodes"><a class="header" href="#counting-all-nodes">Counting all nodes</a></h3>
<p>To count all nodes (vertices):</p>
<table>
<tr>
    <th width="50%">Neo4j's Cypher</th>
    <th width="50%">OrientDB's SQL</th>
</tr>
<tr>
<td>
<pre>
MATCH (n) RETURN count(n)
</pre>
</td>
<td>
<pre>
SELECT COUNT(*) FROM V
</pre>
</td>
</tr>
</table>
<h3 id="counting-all-relationships"><a class="header" href="#counting-all-relationships">Counting all relationships</a></h3>
<p>To count all relationships (edges):</p>
<table>
<tr>
    <th width="50%">Neo4j's Cypher</th>
    <th width="50%">OrientDB's SQL</th>
</tr>
<tr>
<td>
<pre>
MATCH ()-->() RETURN count(*)
</pre>
</td>
<td>
<pre>
SELECT COUNT(*) FROM E 
</pre>
</td>
</tr>
</table>   
<h3 id="querying-nodes-by-original-neo4j-id"><a class="header" href="#querying-nodes-by-original-neo4j-id">Querying nodes by original Neo4j ID</a></h3>
<p>If you would like to query nodes by their original Neo4j Node ID, you can use the property <em>Neo4jNodeID</em>, which is created automatically for you during the import, and indexed as well.</p>
<p>To query a node that belongs to a specific <code>Class</code> with name <em>ClassName</em>, you can execute a query like:</p>
<pre><code>SELECT FROM ClassName WHERE Neo4jNodeID = your_id_here
</code></pre>
<p>To query a node regardless of the <code>Class</code> where it has been included in, you can use a query like:</p>
<pre><code>SELECT FROM V WHERE Neo4jNodeID = your_id_here
</code></pre>
<h3 id="querying-relationships-by-original-neo4j-id"><a class="header" href="#querying-relationships-by-original-neo4j-id">Querying relationships by original Neo4j ID</a></h3>
<p>The strategy to query relationships by their original Neo4j Relationship ID, will be improved in the next hotfix (see GitHub <a href="https://github.com/orientechnologies/orientdb-neo4j-importer/issues/9">Issue #9</a>, which also includes a workaround).</p>
<h3 id="querying-nodes-by-original-neo4j-labels"><a class="header" href="#querying-nodes-by-original-neo4j-labels">Querying nodes by original Neo4j Labels</a></h3>
<p>In case the original nodes have just one <em>Label</em>, they will be migrated in OrientDB into a <code>Class</code> that has name equals to the Neo4j's <em>Label</em> name. In this simple case, to query nodes by <em>Label</em> you can execute a query like the following:</p>
<table>
<tr>
    <th width="50%">Neo4j's Cypher</th>
    <th width="50%">OrientDB's SQL</th>
</tr>
<tr>
<td>
<pre>
MATCH (n:LabelName) RETURN n
</pre>
</td>
<td>
<pre>
SELECT FROM LabelName
</pre>
<p>or using our MATCH syntax:</p>
<pre>
MATCH {class: LabelName, as: n} RETURN n
</pre>
</td>
</tr>
</table>  
<p>More generally speaking, since the original Neo4j <em>Label</em> is stored inside the property <em>Neo4jLabelList</em>, to query imported nodes (vertices) using their original Neo4j <em>Label</em>, you can use queries like the following:</p>
<table>
<tr>
    <th width="50%">Neo4j's Cypher</th>
    <th width="50%">OrientDB's SQL</th>
</tr>
<tr>
<td>
<pre>
MATCH (n:LabelName) RETURN n
</pre>
</td>
<td>
<pre>
SELECT * FROM V WHERE Neo4jLabelList CONTAINS 'LabelName'
</pre>
<p>or using our MATCH syntax:</p>
<pre>
MATCH {class: V, as: n, where: (Neo4jLabelList CONTAINS 'LabelName')} RETURN n
</pre>
</td>
</tr>
</table>  
<p>This is, in particular, the strategy that must be followed in case the original Neo4j's nodes have multiple <em>Labels</em> (and are hence migrated into the single OrientDB <code>Class</code> <em>MultipleLabelNeo4jConversion</em>).</p>
<p>Note that the property <em>Neo4jLabelList</em> has an index on it.</p>
<h2 id="migration-example"><a class="header" href="#migration-example">Migration Example</a></h2>
<p>A complete example of a migration from Neo4j to OrientDB using the <em>Neo4j to OrientDB Importer</em> can be found in the section <a href="neo4j-to-orientdb-importer/../gettingstarted/tutorials/Tutorial-Importing-the-northwind-Database-from-Neo4j.html">Tutorial: Importing the <em>northwind</em> Database from Neo4j</a>.</p>
<h2 id="roadmap"><a class="header" href="#roadmap">Roadmap</a></h2>
<p>A list of prioritized enhancements for the Neo4j to OrientDB Importer, along with some other project information can be found <a href="https://github.com/orientechnologies/orientdb-neo4j-importer/projects/1">here</a>.</p>
<h2 id="faq"><a class="header" href="#faq">FAQ</a></h2>
<p><strong>1. In case original nodes in Neo4j have multiple <em>Labels</em>, they are imported into a single OrientDB vertex Class. Depending on the specific use case, after the migration, it may be useful to manually move vertices to other Classes. How can this be done?</strong></p>
<p>First, please note that there is an open <a href="https://github.com/orientechnologies/orientdb-neo4j-importer/issues/8">enhancement request</a> about having a customized mapping between Neo4j <em>Labels</em> and OrientDB <code>Classes</code>. Until it is implemented, a possible strategy to quickly move vertices into other <code>Classes</code> is to use the <a href="neo4j-to-orientdb-importer/../sql/SQL-Move-Vertex.html"><code>MOVE VERTEX</code></a> syntax.</p>
<p>The following are the steps to follow:</p>
<p><strong>A</strong> - Create the <code>Classes</code> where you want to move the vertices.</p>
<p>When creating the <code>Classes</code>, please keep in mind the following:</p>
<ul>
<li>Define the following properties:
<ul>
<li><em>Neo4jNodeID</em> of type <em>LONG</em></li>
<li><em>Neo4jLabelList</em> of type <em>EmbeddedList String</em></li>
</ul>
</li>
</ul>
<p><strong>Example:</strong></p>
<pre><code>CREATE CLASS YourNewClassHere EXTENDS V
CREATE PROPERTY YourNewClassHere.Neo4jNodeID LONG 
CREATE PROPERTY YourNewClassHere.Neo4jLabelList EMBEDDEDLIST STRING 
</code></pre>
<p><strong>B</strong> - Select all vertices that have a specific Neo4j <em>Label</em>, and then move them to your new <code>Class</code>. To do this you can use a query like:</p>
<pre><code>MOVE VERTEX (
  SELECT FROM MultipleLabelNeo4jConversion 
    WHERE Neo4jLabelList CONTAINS 'Your Neo4j Label here'
  ) 
TO CLASS:YourNewClassHere BATCH 10000
</code></pre>
<p>(use a batch size appropriate to your specific case).</p>
<p><strong>C</strong> - Create the following indexes in your new <code>Classes</code>:</p>
<ul>
<li>A unique index on the property <em>Neo4jNodeID</em></li>
<li>A not unique index on the property <em>Neo4jLabelList</em></li>
</ul>
<p><strong>Important:</strong> creation of the indexes above is crucial in case you will want to query vertices using their original Neo4j node <em>IDs</em> or <em>Labels</em>.</p>
<p><strong>Example:</strong></p>
<pre><code>CREATE INDEX YourNewClassHere.Neo4jNodeID ON YourNewClassHere(Neo4jNodeID) UNIQUE
CREATE INDEX YourNewClassHere.Neo4jLabelList ON YourNewClassHere(Neo4jLabelList) NOTUNIQUE
</code></pre>
<p><strong>2. Not all constraints have been imported. Why?</strong></p>
<p>By design, there are certain cases where not all the constraints can be imported. It may be that you are in one of these cases. When nodes are aggregated into a single <code>Class</code> (either because that node has multiple <em>Labels</em> or because there are <em>Labels</em> with the same name but different case, e.g. <em>LABEL</em> and <em>LAbel</em>) not all constraints can be imported: the creation of unique indices in OrientDB will probably fail; as a workaround the Importer will try to create not unique indexes, but when aggregating nodes into a single <code>Class</code>, number of created constraints will be probably less than number of constraints in Neo4j, even after the creation of the not unique indexes. This in general may or may not be a problem depending on your specific case. Please feel free to open an <a href="https://github.com/orientechnologies/orientdb-neo4j-importer/issues">issue</a> if you believe you incurred into a bug.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql-reference"><a class="header" href="#sql-reference">SQL Reference</a></h1>
<ul>
<li><a href="sql/SQL-Introduction.html">Introduction</a></li>
<li><a href="sql/SQL-Syntax.html">SQL Syntax</a></li>
<li><a href="sql/SQL-Commands.html">SQL Commands</a></li>
<li><a href="sql/SQL-Where.html">Filtering</a></li>
<li><a href="sql/SQL-Functions.html">Functions</a></li>
<li><a href="sql/SQL-Methods.html">Methods</a></li>
<li><a href="sql/SQL-batch.html">Batch</a></li>
<li><a href="sql/Pagination.html">Pagination</a></li>
<li><a href="sql/Sequences-and-auto-increment.html">Sequences and auto increment</a></li>
<li><a href="sql/Pivoting-With-Query.html">Pivoting with Query</a></li>
<li><a href="sql/Command-Cache.html">Command Cache</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-6"><a class="header" href="#introduction-6">Introduction</a></h1>
<p>When it comes to query languages, SQL is the most widely recognized standard. The majority of developers have experience and are comfortable with SQL. For this reason Orient DB uses SQL as its query language and adds some extensions to enable graph functionality. There are a few differences between the standard SQL syntax and that supported by OrientDB, but for the most part, it should feel very natural. The differences are covered in the <a href="sql/SQL-Introduction.html#orientdb-sql-dialect">OrientDB SQL dialect</a> section of this page.</p>
<p>If you are looking for the most efficient way to traverse a graph, we suggest to use the <a href="sql/SQL-Match.html">SQL-Match</a> instead.</p>
<p>Many SQL commands share the <a href="sql/SQL-Where.html">WHERE condition</a>. Keywords and class names in OrientDB SQL are case insensitive. Field names and values are case sensitive. In the following examples keywords are in uppercase but this is not strictly required.</p>
<p>If you are not yet familiar with SQL, we suggest you to get the course on <a href="http://cs-blog.khanacademy.org/2015/05/just-released-full-introductory-sql.html">KhanAcademy</a>.</p>
<p>For example, if you have a class <code>MyClass</code> with a field named <code>id</code>, then the following SQL statements are equivalent:</p>
<pre><code class="language-sql">SELECT FROM MyClass WHERE id = 1
select from myclass where id = 1
</code></pre>
<p>The following is NOT equivalent.  Notice that the field name 'ID' is not the same as 'id'.</p>
<pre><code class="language-sql">SELECT FROM MyClass WHERE ID = 1
</code></pre>
<h2 id="automatic-usage-of-indexes"><a class="header" href="#automatic-usage-of-indexes">Automatic usage of indexes</a></h2>
<p>OrientDB allows you to execute queries against any field, indexed or not-indexed. The SQL engine automatically recognizes if any indexes can be used to speed up execution. You can also query any indexes directly by using <code>INDEX:&lt;index-name&gt;</code> as a target. Example:</p>
<pre><code class="language-sql">SELECT FROM INDEX:myIndex WHERE key = 'Jay'
</code></pre>
<h2 id="extra-resources"><a class="header" href="#extra-resources">Extra resources</a></h2>
<ul>
<li><a href="sql/SQL-Syntax.html">SQL syntax</a></li>
<li><a href="sql/SQL-Projections.html">SQL projections</a></li>
<li><a href="sql/SQL-Where.html">SQL conditions</a></li>
<li><a href="sql/SQL-Where.html">Where clause</a></li>
<li><a href="sql/SQL-Where.html#operators">Operators</a></li>
<li><a href="sql/SQL-Where.html#functions">Functions</a></li>
<li><a href="sql/Pagination.html">Pagination</a></li>
<li><a href="sql/Pivoting-With-Query.html">Pivoting-With-Query</a></li>
<li><a href="sql/SQL-batch.html">SQL batch</a></li>
<li><a href="sql/SQL-Match.html">SQL-Match</a> for traversing graphs</li>
</ul>
<h2 id="orientdb-sql-dialect"><a class="header" href="#orientdb-sql-dialect">OrientDB SQL dialect</a></h2>
<p>OrientDB supports SQL as a query language with some differences compared with SQL. Orient Technologies decided to avoid creating Yet-Another-Query-Language. Instead we started from familiar SQL with extensions to work with graphs. We prefer to focus on standards.</p>
<p>If you want learn SQL, there are many online courses such as:</p>
<ul>
<li><a href="https://www.coursera.org/course/db">Online course Introduction to Databases by Jennifer Widom from Stanford university</a></li>
<li><a href="http://www.w3schools.com/sql/sql_intro.asp">Introduction to SQL at W3 Schools</a></li>
<li><a href="https://blog.udemy.com/beginners-guide-to-sql/">Beginner guide to SQL</a></li>
<li><a href="http://www.sqlcourse2.com/intro2.html">SQLCourse.com</a></li>
<li><a href="http://www.youtube.com/playlist?list=PLD20298E653A970F8">YouTube channel Basic SQL Training by Joey Blue</a></li>
</ul>
<p>To know more, look to <a href="sql/SQL-Syntax.html">OrientDB SQL Syntax</a>.</p>
<p>Or order any book like <a href="http://www.amazon.com/s/ref=nb_sb_noss/189-0251150-4407173?url=search-alias%3Daps&amp;field-keywords=sql">these</a></p>
<h2 id="no-joins"><a class="header" href="#no-joins">No JOINs</a></h2>
<p>The most important difference between OrientDB and a Relational Database is that relationships are represented by <code>LINKS</code> instead of JOINs.</p>
<p>For this reason, the classic JOIN syntax is not supported. OrientDB uses the "dot (<code>.</code>) notation" to navigate <code>LINKS</code>. Example 1 : In SQL you might create a join such as:</p>
<pre><code class="language-sql">SELECT *
FROM Employee A, City B
WHERE A.city = B.id
AND B.name = 'Rome'
</code></pre>
<p>In OrientDB, an equivalent operation would be:</p>
<pre><code class="language-sql">SELECT * FROM Employee WHERE city.name = 'Rome'
</code></pre>
<p>This is much more straight forward and powerful! If you use multiple JOINs, the OrientDB SQL equivalent will be an even larger benefit. Example 2:  In SQL you might create a join such as:</p>
<pre><code class="language-sql">SELECT *
FROM Employee A, City B, Country C,
WHERE A.city = B.id
AND B.country = C.id
AND C.name = 'Italy'
</code></pre>
<p>In OrientDB, an equivalent operation would be:</p>
<pre><code class="language-sql">SELECT * FROM Employee WHERE city.country.name = 'Italy'
</code></pre>
<h2 id="projections"><a class="header" href="#projections">Projections</a></h2>
<p>In SQL, projections are mandatory and you can use the star character <code>*</code> to include all of the fields. With OrientDB this type of projection is optional. Example: In SQL to select all of the columns of Customer you would write:</p>
<pre><code class="language-sql">SELECT * FROM Customer
</code></pre>
<p>In OrientDB, the <code>*</code> is optional:</p>
<pre><code class="language-sql">SELECT FROM Customer
</code></pre>
<p>See <a href="sql/SQL-Projections.html">SQL projections</a></p>
<h2 id="distinct"><a class="header" href="#distinct">DISTINCT</a></h2>
<p>In OrientDB v 3.0 you can use DISTINCT keyword exactly as in a relational database:</p>
<pre><code class="language-sql">SELECT DISTINCT name FROM City
</code></pre>
<p>Until v 2.2, DISTINCT keyword was not allowed; there was a DISTINCT() function instead, with limited capabilities</p>
<pre><code class="language-sql">//legacy

SELECT DISTINCT(name) FROM City
</code></pre>
<h2 id="having"><a class="header" href="#having">HAVING</a></h2>
<p>OrientDB does not support the <code>HAVING</code> keyword, but with a nested query it's easy to obtain the same result. Example in SQL:</p>
<pre><code class="language-SQL">SELECT city, sum(salary) AS salary
FROM Employee
GROUP BY city
HAVING salary &gt; 1000
</code></pre>
<p>This groups all of the salaries by city and extracts the result of aggregates with the total salary greater than 1,000 dollars. In OrientDB the <code>HAVING</code> conditions go in a select statement in the predicate:</p>
<pre><code class="language-SQL">SELECT FROM ( SELECT city, SUM(salary) AS salary FROM Employee GROUP BY city ) WHERE salary &gt; 1000
</code></pre>
<h2 id="select-from-multiple-targets"><a class="header" href="#select-from-multiple-targets">Select from multiple targets</a></h2>
<p>OrientDB allows only one class (classes are equivalent to tables in this discussion) as opposed to SQL, which allows for many tables as the target.  If you want to select from 2 classes, you have to execute 2 sub queries and join them with the <code>UNIONALL</code> function:</p>
<pre><code class="language-sql">SELECT FROM E, V
</code></pre>
<p>In OrientDB, you can accomplish this with a few variable definitions and by using the <code>expand</code> function to the union:</p>
<pre><code class="language-sql">SELECT EXPAND( $c ) LET $a = ( SELECT FROM E ), $b = ( SELECT FROM V ), $c = UNIONALL( $a, $b )
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><!--email_off-->
<h1 id="querying-metadata"><a class="header" href="#querying-metadata">Querying Metadata</a></h1>
<p>OrientDB provides the <code>metadata:</code> target to retrieve information about OrientDB's metadata:</p>
<ul>
<li><code>schema</code>, to get classes and properties</li>
<li><code>indexmanager</code>, to get information about indexes</li>
<li><code>database</code>, to get information about the database</li>
<li><code>storage</code>, to get information about the storage</li>
</ul>
<h2 id="querying-the-schema"><a class="header" href="#querying-the-schema">Querying the Schema</a></h2>
<p>Get all the configured classes:</p>
<pre><code>select expand(classes) from metadata:schema

----+-----------+---------+----------------+----------+--------+--------+----------+----------+------------+----------
#   |name       |shortName|defaultClusterId|strictMode|abstract|overSize|clusterIds|properties|customFields|superClass
----+-----------+---------+----------------+----------+--------+--------+----------+----------+------------+----------
0   |UserGroup  |null     |13              |false     |false   |0.0     |[1]       |[2]       |null        |V
1   |WallPost   |null     |15              |false     |false   |0.0     |[1]       |[4]       |null        |V
2   |Owner      |null     |12              |false     |false   |0.0     |[1]       |[1]       |null        |E
3   |OTriggered |null     |-1              |false     |true    |0.0     |[1]       |[0]       |null        |null
4   |E          |E        |10              |false     |false   |0.0     |[1]       |[0]       |null        |null
5   |OUser      |null     |5               |false     |false   |0.0     |[1]       |[4]       |null        |OIdentity
6   |OSchedule  |null     |7               |false     |false   |0.0     |[1]       |[7]       |null        |null
7   |ORestricted|null     |-1              |false     |true    |0.0     |[1]       |[4]       |null        |null
8   |AssignedTo |null     |11              |false     |false   |0.0     |[1]       |[1]       |null        |E
9   |V          |null     |9               |false     |false   |2.0     |[1]       |[0]       |null        |null
10  |OFunction  |null     |6               |false     |false   |0.0     |[1]       |[5]       |null        |null
11  |ORole      |null     |4               |false     |false   |0.0     |[1]       |[4]       |null        |OIdentity
12  |ORIDs      |null     |8               |false     |false   |0.0     |[1]       |[0]       |null        |null
13  |OIdentity  |null     |-1              |false     |true    |0.0     |[1]       |[0]       |null        |null
14  |User       |null     |14              |false     |false   |0.0     |[1]       |[2]       |null        |V
----+-----------+---------+----------------+----------+--------+--------+----------+----------+------------+----------
</code></pre>
<p>Get all the configured properties for the class OUser:</p>
<pre><code>select expand(properties) from (
   select expand(classes) from metadata:schema
) where name = 'OUser'

----+--------+----+---------+--------+-------+----+----+------+------------+-----------
#   |name    |type|mandatory|readonly|notNull|min |max |regexp|customFields|linkedClass
----+--------+----+---------+--------+-------+----+----+------+------------+-----------
0   |status  |7   |true     |false   |true   |null|null|null  |null        |null
1   |roles   |15  |false    |false   |false  |null|null|null  |null        |ORole
2   |password|7   |true     |false   |true   |null|null|null  |null        |null
3   |name    |7   |true     |false   |true   |null|null|null  |null        |null
----+--------+----+---------+--------+-------+----+----+------+------------+-----------
</code></pre>
<p>Get only the configured <code>customFields</code> properties for OUser (assuming you added CUSTOM metadata like foo=bar):</p>
<pre><code>select customFields from (
    select expand(classes) from metadata:schema 
) where name="OUser"

----+------+------------
#   |@CLASS|customFields
----+------+------------
0   |null  |{foo=bar}
----+------+------------
</code></pre>
<p>Or, if you wish to get only the configured <code>customFields</code>  of an attribute, like if you had a comment for the password attribute for the OUser class.</p>
<pre><code>select customFields from (
  select expand(properties) from (
     select expand(classes) from metadata:schema 
  ) where name="OUser"
) where name="password"


----+------+----------------------------------------------------
#   |@CLASS|customFields
----+------+----------------------------------------------------
0   |null  |{comment=Foo Bar your password to keep it secure!}
----+------+----------------------------------------------------

</code></pre>
<h2 id="querying-the-available-indexes"><a class="header" href="#querying-the-available-indexes">Querying the available Indexes</a></h2>
<p>Get all the configured indexes:</p>
<pre><code>select expand(indexes) from metadata:indexmanager

----+------+------+--------+---------+---------+------------------------------------+------------------------------------------------------
#   |@RID  |mapRid|clusters|type     |name     |indexDefinition                     |indexDefinitionClass
----+------+------+--------+---------+---------+------------------------------------+------------------------------------------------------
0   |#-1:-1|#2:0  |[0]     |DICTIO...|dictio...|{keyTypes:[1]}                      |com.orientechnologies.orient.core.index.OSimpleKeyI...
1   |#-1:-1|#1:1  |[1]     |UNIQUE   |OUser....|{className:OUser,field:name,keyTy...|com.orientechnologies.orient.core.index.OPropertyIn...
2   |#-1:-1|#1:0  |[1]     |UNIQUE   |ORole....|{className:ORole,field:name,keyTy...|com.orientechnologies.orient.core.index.OPropertyIn...
----+------+------+--------+---------+---------+------------------------------------+-----------------------------------------
</code></pre>
<h2 id="querying-database-and-storage-metadata"><a class="header" href="#querying-database-and-storage-metadata">Querying database and storage metadata</a></h2>
<p>Querying database metadata:</p>
<pre><code>SELECT FROM metadata:database
</code></pre>
<p>Querying storage metadata:</p>
<pre><code>SELECT FROM metadata:storage
</code></pre>
<!--/email_off-->
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-sql-syntax"><a class="header" href="#orientdb-sql-syntax">OrientDB SQL syntax</a></h1>
<p>OrientDB Query Language is and SQL dialect.</p>
<p>This page lists all the details about its syntax.</p>
<h2 id="identifiers"><a class="header" href="#identifiers">Identifiers</a></h2>
<p>An identifier is a name that identifies an entity in OrientDB schema. Identifiers can refer to</p>
<ul>
<li>class names</li>
<li>property names</li>
<li>index names</li>
<li>aliases</li>
<li>cluster names</li>
<li>function names</li>
<li>method names</li>
<li>named parameters</li>
<li>variable names (LET)</li>
</ul>
<p>An identifier is a sequence of characters delimited by back-ticks <code>`</code>.
Examples of valid identifiers are</p>
<ul>
<li><code>`surname`</code></li>
<li><code>`name and surname`</code></li>
<li><code>`foo.bar`</code></li>
<li><code>`a + b`</code></li>
<li><code>`select`</code></li>
</ul>
<p>The back-tick character can be used as a valid character for identifiers, but it has to be escaped with a backslash, eg.</p>
<ul>
<li><code>`foo \` bar`</code></li>
</ul>
<p>The following are reserved identifiers, they can NEVER be used with a different meaning (upper or lower case):</p>
<ul>
<li><code>@rid</code>: record ID</li>
<li><code>@class</code>: document class</li>
<li><code>@version</code>: document version</li>
<li><code>@type</code>: record type</li>
<li><code>@fieldTypes</code>: document field types</li>
</ul>
<p><strong>Simplified identifiers</strong></p>
<p>Identifiers that start with a letter or with <code>$</code> and that contain only numbers, letters and underscores, can be written without back-tick quoting. Reserved words cannot be used as simplified identifiers. Valid simplified identifiers are</p>
<ul>
<li><code>name</code></li>
<li><code>name_and_surname</code></li>
<li><code>$foo</code></li>
<li><code>name_12</code></li>
</ul>
<p>Examples of INVALID queries for wrong identifier syntax</p>
<pre><code class="language-SQL">/* INVALID - `from` is a reserved keyword */
SELECT from from from 
/* CORRECT */
SELECT `from` from `from` 

/* INVALID - simplified identifiers cannot start with a number */
SELECT name as 1name from Foo
/* CORRECT */
SELECT name as `1name` from Foo

/* INVALID - simplified identifiers cannot contain `-` character, `and` is a reserved keyword */
SELECT name-and-surname from Foo
/* CORRECT 1 - `name-and-surname` is a single field name */
SELECT `name-and-surname` from Foo
/* CORRECT 2 - `name`, `and` and `surname` are numbers and the result is the subtraction */
SELECT name-`and`-surname from Foo
/* CORRECT 2 - with spaces  */
SELECT name - `and` - surname from Foo

/* INVALID - wrong back-tick escaping */
SELECT `foo`bar` from Foo
/* CORRECT */
SELECT `foo\`bar` from Foo

</code></pre>
<p><strong>Case sensitivity</strong></p>
<p><em>(draft)</em>
In current version, class names are case <em>insensitive</em>, all the other identifiers are case sensitive.</p>
<h2 id="reserved-words"><a class="header" href="#reserved-words">Reserved words</a></h2>
<p>In OrientDB SQL the following are reserved words</p>
<ul>
<li>AFTER</li>
<li>AND</li>
<li>AS</li>
<li>ASC</li>
<li>BATCH</li>
<li>BEFORE</li>
<li>BETWEEN</li>
<li>BREADTH_FIRST</li>
<li>BY</li>
<li>CLUSTER</li>
<li>CONTAINS</li>
<li>CONTAINSALL</li>
<li>CONTAINSKEY</li>
<li>CONTAINSTEXT</li>
<li>CONTAINSVALUE</li>
<li>CREATE</li>
<li>DEFAULT</li>
<li>DEFINED</li>
<li>DELETE</li>
<li>DEPTH_FIRST</li>
<li>DESC</li>
<li>DISTINCT</li>
<li>EDGE</li>
<li>FETCHPLAN</li>
<li>FROM</li>
<li>INCREMENT</li>
<li>INSERT</li>
<li>INSTANCEOF</li>
<li>INTO</li>
<li>IS</li>
<li>LET</li>
<li>LIKE</li>
<li>LIMIT</li>
<li>LOCK</li>
<li>MATCH</li>
<li>MATCHES</li>
<li>MAXDEPTH</li>
<li>NOCACHE</li>
<li>NOT</li>
<li>NULL</li>
<li>OR</li>
<li>PARALLEL</li>
<li>POLYMORPHIC</li>
<li>RETRY</li>
<li>RETURN</li>
<li>SELECT</li>
<li>SKIP</li>
<li>STRATEGY</li>
<li>TIMEOUT</li>
<li>TRAVERSE</li>
<li>UNSAFE</li>
<li>UNWIND</li>
<li>UPDATE</li>
<li>UPSERT</li>
<li>VERTEX</li>
<li>WAIT</li>
<li>WHERE</li>
<li>WHILE</li>
</ul>
<h2 id="base-types"><a class="header" href="#base-types">Base types</a></h2>
<p>Accepted base types in OrientDB SQL are:</p>
<ul>
<li><strong>integer numbers</strong>:</li>
</ul>
<p>Valid integers are</p>
<pre><code>(32bit)
1
12345678
-45

(64bit)
1L
12345678L
-45L
</code></pre>
<ul>
<li><strong>floating point numbers</strong>: single or double precision</li>
</ul>
<p>Valid floating point numbers are:</p>
<pre><code>(single precision)
1.5
12345678.65432
-45.0

(double precision)
0.23D
.23D
</code></pre>
<ul>
<li><strong>absolute precision, decimal numbers</strong>: like BigDecimal in Java</li>
</ul>
<p>Use the <code>bigDecimal(&lt;number&gt;)</code> function to explicitly instantiate an absolute precision number.</p>
<ul>
<li><strong>strings</strong>: delimited by <code>'</code> or by <code>"</code>. Single quotes, double quotes and back-slash inside strings can escaped using a back-slash</li>
</ul>
<p>Valid strings are:</p>
<pre><code>"foo bar"
'foo bar'
"foo \" bar"
'foo \' bar'
'foo \\ bar'
</code></pre>
<ul>
<li><strong>booleans</strong>: boolean values are case sensitive</li>
</ul>
<p>Valid boolean values are</p>
<pre><code>true
false
</code></pre>
<p>Boolean value constants are case insensitive, so also <code>TRUE</code>, <code>True</code> and so on are valid.</p>
<ul>
<li><strong>links</strong>: A link is a pointer to a document in the database</li>
</ul>
<p>In SQL a link is represented as follows (short and extended notation):</p>
<pre><code>#&lt;cluster-id&gt;:&lt;cluster-position&gt;

or

{"@rid": "#&lt;cluster-id&gt;:&lt;cluster-position&gt;"}
</code></pre>
<p>eg.</p>
<pre><code>#12:15

or

{"@rid": "#12:15"}
</code></pre>
<p>The bracket notation is mandatory inside JSON, as the short notation is not a valid value in JSON.</p>
<ul>
<li><strong>null</strong>: case insensitive (for consistency with IS NULL and IS NOT NULL conditions, that are case insensitive)</li>
</ul>
<p>Valid null expressions include</p>
<pre><code>NULL
null
Null
nUll
...
</code></pre>
<h2 id="numbers"><a class="header" href="#numbers">Numbers</a></h2>
<p>OrientDB can store five different types of numbers</p>
<ul>
<li>Integer: 32bit signed</li>
<li>Long: 64bit signed</li>
<li>Float: decimal 32bit signed</li>
<li>Double: decimal 64bit signed</li>
<li>BigDecimal: absolute precision</li>
</ul>
<p><strong>Integers</strong> are represented in SQL as plain numbers, eg. <code>123</code>. If the number represented exceeds the Integer maximum size (see Java java.lang.Integer <code>MAX_VALUE</code> and <code>MIN_VALUE</code>), then it's automatically converted to a Long.</p>
<p>When an integer is saved to a schemaful property of another numerical type, it is automatically converted.</p>
<p><strong>Longs</strong> are represented in SQL as numbers with <code>L</code> suffix, eg. <code>123L</code> (L can be uppercase or lowercase). Plain numbers (without L prefix) that exceed the Integer range are also automatically converted to Long. If the number represented exceeds the Long maximum size (see Java java.lang.Long <code>MAX_VALUE</code> and <code>MIN_VALUE</code>), then the result is <code>NULL</code>;</p>
<p>Integer and Long numbers can be represented in base 10 (decimal), 8 (octal) or 16 (hexadecimal):</p>
<ul>
<li>decimal: <code>["-"] ("0" | ( ("1"-"9") ("0"-"9")* ) ["l"|"L"]</code>, eg.
<ul>
<li><code>15</code>, <code>15L</code></li>
<li><code>-164</code></li>
<li><code>999999999999</code></li>
</ul>
</li>
<li>octal: <code>["-"] "0" ("0"-"7")+ ["l"|"L"]</code>, eg.
<ul>
<li><code>01</code>, <code>01L</code> (equivalent to decimal 1)</li>
<li><code>010</code>, <code>010L</code> (equivalent to decimal 8)</li>
<li><code>-065</code>, <code>-065L</code> (equivalent to decimal 53)</li>
</ul>
</li>
<li>hexadecimal: <code>["-"] "0" ("x"|"X") ("0"-"9"," a"-"f", "A"-"F")+ ["l"|"L"]</code>, eg.
<ul>
<li><code>0x1</code>, <code>0X1</code>, <code>0x1L</code> (equivalent to 1 decimal)</li>
<li><code>0x10</code> (equivalent to decimal 16)</li>
<li><code>0xff</code>, <code>0xFF</code> (equivalent to decimal 255)</li>
<li><code>-0xff</code>, <code>-0xFF</code> (equivalent to decimal -255)</li>
</ul>
</li>
</ul>
<p><strong>Float</strong> numbers are represented in SQL as <code>[-][&lt;number&gt;].&lt;number&gt;</code>, eg. valid Float values are <code>1.5</code>, <code>-1567.0</code>, <code>.556767</code>. If the number represented exceeds the Float maximum size (see Java java.lang.Float <code>MAX_VALUE</code> and <code>MIN_VALUE</code>), then it's automatically converted to a Double.</p>
<p><strong>Double</strong> numbers are represented in SQL as <code>[-][&lt;number&gt;].&lt;number&gt;D</code> (D can be uppercase or lowercase), eg. valid Float values are <code>1.5d</code>, <code>-1567.0D</code>, <code>.556767D</code>. If the number represented exceeds the Double maximum size (see Java java.lang.Double <code>MAX_VALUE</code> and <code>MIN_VALUE</code>), then the result is <code>NULL</code></p>
<p>Float and Double numbers can be represented as decimal, decimal with exponent, hexadecimal and hexadecimal with exponent.
Here is the full syntax:</p>
<pre><code>
FLOATING_POINT_LITERAL: ["-"] ( &lt;DECIMAL_FLOATING_POINT_LITERAL&gt; | &lt;HEXADECIMAL_FLOATING_POINT_LITERAL&gt; )

DECIMAL_FLOATING_POINT_LITERAL:
      (["0"-"9"])+ "." (["0"-"9"])* (&lt;DECIMAL_EXPONENT&gt;)? (["f","F","d","D"])?
      | "." (["0"-"9"])+ (&lt;DECIMAL_EXPONENT&gt;)? (["f","F","d","D"])?
      | (["0"-"9"])+ &lt;DECIMAL_EXPONENT&gt; (["f","F","d","D"])?
      | (["0"-"9"])+ (&lt;DECIMAL_EXPONENT&gt;)? ["f","F","d","D"]
  &gt;

DECIMAL_EXPONENT: ["e","E"] (["+","-"])? (["0"-"9"])+ 

HEXADECIMAL_FLOATING_POINT_LITERAL:
        "0" ["x", "X"] (["0"-"9","a"-"f","A"-"F"])+ (".")? &lt;HEXADECIMAL_EXPONENT&gt; (["f","F","d","D"])?
      | "0" ["x", "X"] (["0"-"9","a"-"f","A"-"F"])* "." (["0"-"9","a"-"f","A"-"F"])+ &lt;HEXADECIMAL_EXPONENT&gt; (["f","F","d","D"])?

HEXADECIMAL_EXPONENT: ["p","P"] (["+","-"])? (["0"-"9"])+ 
</code></pre>
<p>Eg.</p>
<ul>
<li>base 10
<ul>
<li><code>0.5</code></li>
<li><code>0.5f</code>, <code>0.5F</code>, <code>2f</code> (ATTENTION, this is NOT hexadecimal)</li>
<li><code>0.5d</code>, <code>0.5D</code>, <code>2D</code> (ATTENTION, this is NOT hexadecimal)</li>
<li><code>3.21e2d</code> equivalent to <code>3.21 * 10^2 = 321</code></li>
</ul>
</li>
<li>base 16
<ul>
<li><code>0x3p4d</code> equivalent to <code>3 * 2^4 = 48</code></li>
<li><code>0x3.5p4d</code> equivalent to <code>3.5(base 16) * 2^4</code></li>
</ul>
</li>
</ul>
<p><strong>BigDecimal</strong> in OrientDB is represented as a Java BigDecimal.
The instantiation of BigDecimal can be done explicitly, using the <code>bigDecimal(&lt;number&gt; | &lt;string&gt;)</code> function, eg. <code>bigDecimal(124.4)</code> or <code>bigDecimal("124.4")</code></p>
<h4 id="mathematical-operations"><a class="header" href="#mathematical-operations">Mathematical operations</a></h4>
<p>Mathematical Operations with numbers follow these rules:</p>
<ul>
<li>Operations are calculated from left to right, following the operand priority.</li>
<li>When an operation involves two numbers of different type, both are converted to the higher precision type between the two.</li>
</ul>
<p>Eg.</p>
<pre><code>15 + 20L = 15L + 20L     // the 15 is converted to 15L

15L + 20 = 15L + 20L     // the 20 is converted to 20L

15 + 20.3 = 15.0 + 20.3     // the 15 is converted to 15.0

15.0 + 20.3D = 15.0D + 20.3D     // the 15.0 is converted to 15.0D
</code></pre>
<p>the overflow follows Java rules.</p>
<p>The conversion of a number to BigDecimal can be done explicitly, using the <code>bigDecimal()</code> function, eg. <code>bigDecimal(124.4)</code> or <code>bigDecimal("124.4")</code></p>
<h2 id="collections-1"><a class="header" href="#collections-1">Collections</a></h2>
<p>OrientDB supports two types of collections:</p>
<ul>
<li><strong>Lists</strong>: ordered, allow duplicates</li>
<li><strong>Sets</strong>: not ordered (?), no duplicates</li>
</ul>
<p>The SQL notation allows to create <code>Lists</code> with square bracket notation, eg.</p>
<pre><code>[1, 3, 2, 2, 4]
</code></pre>
<p>A <code>List</code> can be converted to a <code>Set</code> using the <code>.asSet()</code> method:</p>
<pre><code>[1, 3, 2, 2, 4].asSet() = [1, 3, 2, 4] /*  the order of the elements in the resulting set is not guaranteed */
</code></pre>
<h2 id="binary-data"><a class="header" href="#binary-data">Binary data</a></h2>
<p>OrientDB can store binary data (byte arrays) in document fields. There is no native representation of binary data in SQL syntax, insert/update a binary field you have to use <code>decode(&lt;base64string&gt;, "base64")</code> function.</p>
<p>To obtain the base64 string representation of a byte array, you can use the function <code>encode(&lt;byteArray&gt;, "base64")</code></p>
<h2 id="expressions"><a class="header" href="#expressions">Expressions</a></h2>
<p>Expressions can be used as:</p>
<ul>
<li>single projections</li>
<li>operands in a condition</li>
<li>items in a GROUP BY</li>
<li>items in an ORDER BY</li>
<li>right argument of a LET assignment</li>
</ul>
<p>Valid expressions are:</p>
<ul>
<li><code>&lt;base type value&gt;</code> (string, number, boolean)</li>
<li><code>&lt;field name&gt;</code></li>
<li><code>&lt;@attribute name&gt;</code></li>
<li><code>&lt;function invocation&gt;</code></li>
<li><code>&lt;expression&gt; &lt;binary operator&gt; &lt;expression&gt;</code>: for operator precedence, see below table.</li>
<li><code>&lt;unary operator&gt; &lt;expression&gt;</code></li>
<li><code>( &lt;expression&gt; )</code>: expression between parenthesis, for precedences</li>
<li><code>( &lt;query&gt; )</code>: query between parenthesis</li>
<li><code>[ &lt;expression&gt; (, &lt;expression&gt;)* ]</code>: a list, an ordered collection that allows duplicates, eg. <code>["a", "b", "c"]</code>)</li>
<li><code>{ &lt;expression&gt;: &lt;expression&gt; (, &lt;expression&gt;: &lt;expression&gt;)* }</code>: the result is an ODocument, with <field>:<value> values, eg. <code>{"a":1, "b": 1+2+3, "c": foo.bar.size() }</code>. The key name is converted to String if it's not.</li>
<li><code>&lt;expression&gt; &lt;modifier&gt; ( &lt;modifier&gt; )*</code>: a chain of modifiers (see below)</li>
<li><code>&lt;json&gt;</code>: It is translated to an ODocument. Nested JSON is allowed and is translated to nested ODocuments</li>
<li><code>&lt;expression&gt; IS NULL</code>: check for null value of an expression</li>
<li><code>&lt;expression&gt; IS NOT NULL</code>: check for non null value of an expression</li>
</ul>
<h3 id="modifiers"><a class="header" href="#modifiers">Modifiers</a></h3>
<p>A modifier can be</p>
<ul>
<li>
<p>a dot-separated field chain, eg. <code>foo.bar</code>. Dot notation is used to navigate relationships and document fields. eg.</p>
<pre><code>john = {
          name: "John",
          surname: "Jones",
          address: {
             city: {
                name: "London"
             }
          }
       }
          
john.address.city.name = "London"
</code></pre>
</li>
<li>
<p>a method invocation, eg. <code>foo.size()</code>.</p>
<p>Method invocations can be chained, eg. <code>foo.toLowerCase().substring(2, 4)</code></p>
</li>
<li>
<p>a square bracket filter, eg. <code>foo[1]</code> or <code>foo[name = 'John']</code></p>
</li>
</ul>
<h3 id="square-bracket-filters"><a class="header" href="#square-bracket-filters">Square bracket filters</a></h3>
<p>Square brackets can be used to filter collections or maps.</p>
<p><code>field[ ( &lt;expression&gt; | &lt;range&gt; | &lt;condition&gt; ) ]</code></p>
<p>Based on what is between brackets, the square bracket filtering has different effects:</p>
<ul>
<li><code>&lt;expression&gt;</code>: If the expression returns an Integer or Long value (i), the result of the square bracket filtering
is the i-th element of the collection/map. If the result of the expression (K) is not a number, the filtering returns the value corresponding to the key K in the map field. If the field is not a collection/map, the square bracket filtering returns <code>null</code>.
The result of this filtering is ALWAYS a single value.</li>
<li><code>&lt;range&gt;</code>: A range is something like <code>M..N</code>  or <code>M...N</code> where M and N are integer/long numbers, eg. <code>fieldName[2..5]</code>. The result of range filtering is a collection that is a subset of the original field value, containing all the items from position M (included) to position N (excluded for <code>..</code>, included for <code>...</code>). Eg. if <code>fieldName = ['a', 'b', 'c', 'd', 'e']</code>, <code>fieldName[1..3] = ['b', 'c']</code>, <code>fieldName[1...3] = ['b', 'c', 'd']</code>. Ranges start from <code>0</code>. The result of this filtering is ALWAYS a list (ordered collection, allowing duplicates). If the original collection was ordered, then the result will preserve the order.</li>
<li><code>&lt;condition&gt;</code>: A normal SQL condition, that is applied to each element in the <code>fieldName</code> collection. The result is a sub-collection that contains only items that match the condition. Eg. <code>fieldName = [{foo = 1},{foo = 2},{foo = 5},{foo = 8}]</code>, <code>fieldName[foo &gt; 4] = [{foo = 5},{foo = 8}]</code>. The result of this filtering is ALWAYS a list (ordered collection, allowing duplicates). If the original collection was ordered, then the result will preserve the order.</li>
</ul>
<h2 id="conditions"><a class="header" href="#conditions">Conditions</a></h2>
<p>A condition is an expression that returns a boolean value.</p>
<p>An expression that returns something different from a boolean value is always evaluated to <code>false</code>.</p>
<h2 id="comparison-operators"><a class="header" href="#comparison-operators">Comparison Operators</a></h2>
<ul>
<li><strong><code>=</code>  (equals)</strong>: If used in an expression, it is the boolean equals (eg. <code>select from Foo where name = 'John'</code>. If used in an SET section of INSERT/UPDATE statements or on a LET statement, it represents a variable assignment (eg. <code>insert into Foo set name = 'John'</code>)</li>
<li><strong><code>!=</code> (not equals)</strong>: inequality operator.</li>
<li><strong><code>&lt;&gt;</code> (not equals)</strong>: same as <code>!=</code></li>
<li><strong><code>&gt;</code>  (greater than)</strong></li>
<li><strong><code>&gt;=</code> (greater or equal)</strong></li>
<li><strong><code>&lt;</code>  (less than)</strong></li>
<li><strong><code>&lt;=</code> (less or equal)</strong></li>
</ul>
<h2 id="math-operators"><a class="header" href="#math-operators">Math Operators</a></h2>
<ul>
<li><strong><code>+</code>  (plus)</strong>: addition if both operands are numbers, string concatenation (with string conversion) if one of the operands is not a number. The order of calculation (and conversion) is from left to right, eg <code>'a' + 1 + 2 = 'a12'</code>, <code>1 + 2 + 'a' = '3a'</code>. It can also be used as a unary operator (no effect)</li>
<li><strong><code>-</code>  (minus</strong>): subtraction between numbers. Non-number operands are evaluated to zero. Null values are treated as a zero, eg <code>1 + null = 1</code>. Minus can also be used as a unary operator, to invert the sign of a number</li>
<li><strong><code>*</code>  (multiplication)</strong>: multiplication between numbers. If one of the operands is null, the multiplication will evaluate to null.</li>
<li><strong><code>/</code>  (division)</strong>: division between numbers. If one of the operands is null, the division will evaluate to null.. The result of a division by zero is NaN</li>
<li><strong><code>%</code>  (modulo)</strong>: modulo between numbers. If one of the operands is null, the modulo will evaluate to null..</li>
<li><strong><code>&gt;&gt;</code>  (bitwise right shift)</strong>: shifts bits on the right operand by a number of positions equal to the right operand. Eg. <code>8 &gt;&gt; 2 = 2</code>. Both operands have to be Integer or Long values, otherwise the result will be null.</li>
<li><strong><code>&gt;&gt;&gt;</code>  (unsigned bitwise right shift)</strong> The same as <code>&gt;&gt;</code>, but with negative numbers it will fill with <code>1</code> on the left. Both operands have to be Integer or Long values, otherwise the result will be null.</li>
<li><strong><code>&lt;&lt;</code>  (bitwise right shift)</strong> shifts bits on the left, eg. <code>2 &lt;&lt; 2 = 8</code>. Both operands have to be Integer or Long values, otherwise the result will be null.</li>
<li><strong><code>&amp;</code>  (bitwise AND)</strong> executes a bitwise AND operation. Both operands have to be Integer or Long values, otherwise the result will be null.</li>
<li><strong><code>|</code>  (bitwise OR)</strong> executes a bitwise OR operation. Both operands have to be Integer or Long values, otherwise the result will be null.</li>
<li><strong><code>^</code>  (bitwise XOR)</strong> executes a bitwise XOR operation. Both operands have to be Integer or Long values, otherwise the result will be null.</li>
<li><strong><code>||</code></strong>: array concatenation (see below for details)</li>
</ul>
<h3 id="math-operators-precedence"><a class="header" href="#math-operators-precedence">Math Operators precedence</a></h3>
<div class="table-wrapper"><table><thead><tr><th>type</th><th>Operators</th></tr></thead><tbody>
<tr><td>multiplicative</td><td><code>*</code> <code>/</code> <code>%</code></td></tr>
<tr><td>additive</td><td><code>+</code> <code>-</code></td></tr>
<tr><td>shift</td><td><code>&lt;&lt;</code> <code>&gt;&gt;</code> <code>&gt;&gt;&gt;</code></td></tr>
<tr><td>bitwise AND</td><td><code>&amp;</code></td></tr>
<tr><td>bitwise exclusive OR</td><td><code>^</code></td></tr>
<tr><td>bitwise inclusive OR</td><td><code>|</code></td></tr>
<tr><td>array concatenation</td><td><code>||</code></td></tr>
</tbody></table>
</div>
<h2 id="math--assign-operators"><a class="header" href="#math--assign-operators">Math + Assign operators</a></h2>
<p>These operators can be used in UPDATE statements to update and set values. The semantics is the same as the operation plus the assignment,
eg. <code>a += 2</code> is just a shortcut for <code>a = a + 2</code>.</p>
<ul>
<li><strong><code>+=</code>  (add and assign)</strong>: adds right operand to left operand and assigns the value to the left operand. Returns the final value of the left operand. If one of the operands is not a number, then this operator acts as a <code>concatenate string values and assign</code></li>
<li><strong><code>-=</code>  (subtract and assign)</strong>: subtracts right operand from left operand and assigns the value to the left operand. Returns the final value of the left operand</li>
<li><strong><code>*=</code>  (multiply and assign)</strong>: multiplies left operand and right operand and assigns the value to the left operand. Returns the final value of the left operand</li>
<li><strong><code>/=</code>  (divide and assign)</strong>: divides left operand by right operand and assigns the value to the left operand. Returns the final value of the left operand</li>
<li><strong><code>%=</code>  (modulo and assign)</strong>: calculates left operand modulo right operand and assigns the value to the left operand. Returns the final value of the left operand</li>
</ul>
<h2 id="array-concatenation"><a class="header" href="#array-concatenation">Array concatenation</a></h2>
<p>The <code>||</code> operator concatenates two arrays.</p>
<pre><code>[1, 2, 3] || [4, 5] = [1, 2, 3, 4, 5]
</code></pre>
<p>If one of the elements is not an array, then it's converted to an array of one element, before the concatenation operation is executed</p>
<pre><code>[1, 2, 3] || 4 = [1, 2, 3, 4]

1 || [2, 3, 4] = [1, 2, 3, 4]

1 || 2 || 3 || 4 = [1, 2, 3, 4]
</code></pre>
<p>To add an array, you have to wrap the array element in another array:</p>
<pre><code>[[1, 2], [3, 4]] || [5, 6] = [[1, 2], [3, 4], 5, 6]

[[1, 2], [3, 4]] || [[5, 6]] = [[1, 2], [3, 4], [5, 6]]
</code></pre>
<p>The result of an array concatenation is always a List (ordered and with duplicates). The order of the elements in the list is the same as the order in the elements in the source arrays, in the order they appear in the original expression.</p>
<p>To transform the result of an array concatenation in a Set (remove duplicates), just use the <code>.asSet()</code> method</p>
<pre><code>[1, 2] || [2, 3] = [1, 2, 2, 3]

([1, 2] || [2, 3]).asSet() = [1, 2, 3] 
</code></pre>
<p><strong>Specific behavior of NULL</strong></p>
<p>Null value has no effect when applied to a || operation. eg.</p>
<pre><code>[1, 2] || null = [1, 2]

null || [1, 2] = [1, 2]
</code></pre>
<p>To add null values to a collection, you have to explicitly wrap them in another collection, eg.</p>
<pre><code>[1, 2] || [null] = [1, 2, null]
</code></pre>
<h2 id="boolean-operators"><a class="header" href="#boolean-operators">Boolean Operators</a></h2>
<ul>
<li><strong><code>AND</code></strong>: logical AND</li>
<li><strong><code>OR</code></strong>: logical OR</li>
<li><strong><code>NOT</code></strong>: logical NOT</li>
<li><strong><code>CONTAINS</code></strong>: checks if the left collection contains the right element. The left argument has to be a collection, otherwise it returns FALSE. It's NOT the check of collection intersections, so <code>['a', 'b', 'c'] CONTAINS ['a', 'b']</code> will return FALSE, while <code>['a', 'b', 'c'] CONTAINS 'a'</code> will return TRUE.</li>
<li><strong><code>IN</code></strong>: the same as CONTAINS, but with inverted operands.</li>
<li><strong><code>CONTAINSKEY</code></strong>: for maps, the same as for CONTAINS, but checks on the map keys</li>
<li><strong><code>CONTAINSVALUE</code></strong>: for maps, the same as for CONTAINS, but checks on the map values</li>
<li><strong><code>LIKE</code></strong>: for strings, checks if a string contains another string. <code>%</code> is used as a wildcard, eg. <code>'foobar CONTAINS '%ooba%''</code></li>
<li><strong><code>IS DEFINED</code></strong> (unary): returns TRUE is a field is defined in a document</li>
<li><strong><code>IS NOT DEFINED</code></strong> (unary): returns TRUE is a field is not defined in a document</li>
<li><strong><code>BETWEEN - AND</code></strong> (ternary): returns TRUE is a value is between two values, eg. <code>5 BETWEEN 1 AND 10</code></li>
<li><strong><code>MATCHES</code></strong>: checks if a string matches a regular expression</li>
<li><strong><code>INSTANCEOF</code></strong>: checks the type of a value, the right operand has to be the a String representing a class name, eg. <code>father INSTANCEOF 'Person'</code></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h2 id="sql-projections"><a class="header" href="#sql-projections">SQL Projections</a></h2>
<p>A projection is a value that is returned by a query statement (SELECT, MATCH).</p>
<p>Eg. the following query</p>
<pre><code class="language-sql">SELECT name as firstName, age * 12 as ageInMonths, out("Friend") from Person where surname = 'Smith'
</code></pre>
<p>has three projections:</p>
<ul>
<li><code>name as firstName</code></li>
<li><code>age * 12 as ageInMonths</code></li>
<li><code>out("Friend")</code></li>
</ul>
<h3 id="syntax-3"><a class="header" href="#syntax-3">Syntax</a></h3>
<p><strong>A projection</strong> has the following syntax:</p>
<p><code>&lt;expression&gt; [&lt;nestedProjection&gt;] [ AS &lt;alias&gt; ]</code></p>
<ul>
<li><code>&lt;expression&gt;</code> is an expression (see <a href="sql/SQL-Syntax.html">SQL Syntax</a>) that represents the way to calculate the value of the single projection</li>
<li><code>&lt;alias&gt;</code> is the Identifier (see <a href="sql/SQL-Syntax.html">SQL Syntax</a>) representing the field name used to return the value in the result set</li>
</ul>
<p>A projection block has the following syntax:</p>
<p><code>[DISTINCT] &lt;projection&gt; [, &lt;projection&gt; ]*</code></p>
<ul>
<li><code>DISTINCT</code>: removes duplicates from the result-set</li>
</ul>
<p><em>IMPORTANT - the old <code>distinct()</code> function (used in OrientDB &lt;=2.x) is no longer supported</em></p>
<h3 id="query-result"><a class="header" href="#query-result">Query result</a></h3>
<p>By default, a query returns a different result-set based on the projections it has:</p>
<ul>
<li><strong><code>*</code> alone</strong>: The result set is made of records as they arrive from the target, with the original @rid and @class attributes (if any)</li>
<li><strong><code>*</code> plus other projections</strong>: records of the original target, merged with the other projection values, with @rid, @class and @version of the original record.</li>
<li><strong>no projections</strong>: same behavior as <code>*</code></li>
<li><strong><code>expand(&lt;projection&gt;)</code></strong>: The result set is made of the records returned by the projection, expanded (if the projection result is a link or a collection of links) and unwinded (if the projection result is a collection). Nothing in all the other cases.</li>
<li><strong>one or more projections</strong>: temporary records (with temporary @rid and no @class). Projections that represent links are returned as simple @rid values, unless differently specified in the fetchplan.</li>
</ul>
<p><em>IMPORTANT - projection values can be overwritten in the final result, the overwrite happens from left to right</em></p>
<p>eg.</p>
<pre><code class="language-sql">SELECT 1 as a, 2 as a 
</code></pre>
<p>will return <code>[{"a":2}]</code></p>
<p>eg.</p>
<p>Having the record <code>{"@class":"Foo", "name":"bar", "@rid":"#12:0", "@version": 2}</code></p>
<pre><code class="language-sql">SELECT *, "hey" as name from Foo
</code></pre>
<p>will return <code>[{"@class":"Foo", "@rid":"#12:0", "@version": 2, "name":"hey"}]</code></p>
<pre><code class="language-sql">SELECT  "hey" as name, * from Foo
</code></pre>
<p>will return <code>[{"@class":"Foo", "@rid":"#12:0", "@version": 2, "name":"bar"}]</code></p>
<blockquote>
<p>ATTENTION: when saving back a record with a valid rid, you will overwrite the existing record! So pay attention
when using <code>*</code> together with other projections</p>
</blockquote>
<blockquote>
<p>IMPORTANT - the result of the query can be further unwound using the UNWIND operator</p>
</blockquote>
<blockquote>
<p>IMPORTANT: <code>expand()</code> cannot be used together with <code>GROUP BY</code></p>
</blockquote>
<h3 id="aliases"><a class="header" href="#aliases">Aliases</a></h3>
<p>The alias is the field name that a projection will have in the result-set.</p>
<p>An alias can be implicit, if declared with the <code>AS</code> keyword, eg.</p>
<pre><code class="language-sql">SELECT name + " " + surname as full_name from Person

result:
[{"full_name":"John Smith"}]
</code></pre>
<p>An alias can be implicit, when no <code>AS</code> is defined, eg.</p>
<pre><code class="language-sql">SELECT name from Person

result:
[{"name":"John"}]
</code></pre>
<p>An implicit alias is calculated based on how the projection is written. By default, OrientDB uses the plain String representation of the projection as alias.</p>
<pre><code>SELECT 1+2 as sum

result:
[{"sum": 3}] 
</code></pre>
<pre><code>SELECT parent.name+" "+parent.surname as full_name from Node

result:
[{"full_name": "John Smith"}] 
</code></pre>
<p>The String representation of a projection is the exact representation of the projection string, without spaces before and after dots and brackets, no spaces before commas, a single space before and after operators.</p>
<p>eg.</p>
<pre><code>SELECT 1+2 

result:
[{"1 + 2": 3}] /* see the space before and after the + sign */
</code></pre>
<pre><code>SELECT parent.name+" "+parent.surname from Node

result:
[{"parent.name + \" \" + parent.surname": "John Smith"}] 
</code></pre>
<pre><code>SELECT items[4] from Node

result:
[{"items[4]": "John Smith"}] 
</code></pre>
<h3 id="nested-projections"><a class="header" href="#nested-projections">Nested projections</a></h3>
<p>(since v 3.0 M2)</p>
<h4 id="syntax-4"><a class="header" href="#syntax-4">Syntax:</a></h4>
<p><code>":{" ( * | (["!"] &lt;identifier&gt; ["*"] (&lt;comma&gt; ["!"] &lt;identifier&gt; ["*"])* ) ) "}"</code></p>
<p>A projection can refer to a link or to a collection of links, eg. a LINKLIST or a LINKSET.
In some cases you can be interested in the expanded object instead of the RID.</p>
<p>Let's clarify this with an example. This is our dataset:</p>
<div class="table-wrapper"><table><thead><tr><th>@rid</th><th>name</th><th>surname</th><th>parent</th></tr></thead><tbody>
<tr><td>#12:0</td><td>foo</td><td>fooz</td><td></td></tr>
<tr><td>#12:1</td><td>bar</td><td>barz</td><td>#12:0</td></tr>
<tr><td>#12:2</td><td>baz</td><td>bazz</td><td>#12:1</td></tr>
</tbody></table>
</div>
<p>Given this query:</p>
<pre><code class="language-SQL">SELECT name, parent FROM TheClass WHERE name = 'baz'
</code></pre>
<p>The result is</p>
<pre><code>{ 
   "name": "baz",
   "parent": #12:1
}
</code></pre>
<p>Now suppose you want to expand the link and retrieve some properties of the linked object.
You can do it explicitly do it with other projections:</p>
<pre><code class="language-SQL">SELECT name, parent.name FROM TheClass WHERE name = 'baz'
</code></pre>
<pre><code>{ 
   "name": "baz",
   "parent.name": "bar"
}
</code></pre>
<p>but this will force you to list them one by one, and it's not always possible, especially when you don't know all their names.</p>
<p>Another alternative is to use nested projections, eg.</p>
<pre><code class="language-SQL">SELECT name, parent:{name} FROM TheClass WHERE name = 'baz'
</code></pre>
<pre><code>{ 
   "name": "baz",
   "parent": {
      "name": "bar"
   }
}
</code></pre>
<p>or with multiple attributes</p>
<pre><code class="language-SQL">SELECT name, parent:{name, surname} FROM TheClass WHERE name = 'baz'
</code></pre>
<pre><code>{ 
   "name": "baz",
   "parent": {
      "name": "bar"
      "surname": "barz"      
   }
}
</code></pre>
<p>or using a wildcard</p>
<pre><code class="language-SQL">SELECT name, parent:{*} FROM TheClass WHERE name = 'baz'
</code></pre>
<pre><code>{ 
   "name": "baz",
   "parent": {
      "name": "bar"
      "surname": "barz"      
      "parent": #12:0
   }
}
</code></pre>
<p>You can also use the <code>!</code> exclude syntax to define which attributes you want to <em>exclude</em> from the nested projection:</p>
<pre><code class="language-SQL">SELECT name, parent:{!surname} FROM TheClass WHERE name = 'baz'
</code></pre>
<pre><code>{ 
   "name": "baz",
   "parent": {
      "name": "bar"
      "parent": #12:0
   }
}
</code></pre>
<p>You can also use a wildcard on the right of property names, to specify the inclusion of attributes that start with a prefix, eg.</p>
<pre><code class="language-SQL">SELECT name, parent:{surna*} FROM TheClass WHERE name = 'baz'
</code></pre>
<pre><code>{ 
   "name": "baz",
   "parent": {
      "surname": "barz"      
   }
}
</code></pre>
<p>or their exclusion</p>
<pre><code class="language-SQL">SELECT name, parent:{!surna*} FROM TheClass WHERE name = 'baz'
</code></pre>
<pre><code>{ 
   "name": "baz",
   "parent": {
      "name": "bar",      
      "parent": #12:0
   }
}
</code></pre>
<p>Nested projection syntax allows for multiple level depth expressions, eg. you can go three levels deep as follows:</p>
<pre><code>SELECT name, parent:{name, surname, parent:{name, surname}} FROM TheClass WHERE name = 'baz'
</code></pre>
<pre><code>{ 
   "name": "baz",
   "parent": {
      "name": "bar"
      "surname": "barz"      
      "parent": {
         "name": "foo"
         "surname": "fooz"      
      }   
   }
}
</code></pre>
<p>You can also use expressions and aliases in nested projections:</p>
<pre><code>SELECT name, parent.parent:{name, surname} as grandparent FROM TheClass WHERE name = 'baz'
</code></pre>
<pre><code>{ 
   "name": "baz",
   "grandparent": {
      "name": "foo"
      "surname": "fooz"      
   }   
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql-commands-1"><a class="header" href="#sql-commands-1">SQL Commands</a></h1>
<div class="table-wrapper"><table><thead><tr><th>CRUD</th><th>Graph</th><th>Schema &amp; Indexes</th><th>Database</th><th>Utility</th></tr></thead><tbody>
<tr><td><a href="sql/SQL-Query.html">SELECT</a></td><td><a href="sql/SQL-Create-Vertex.html">CREATE VERTEX</a></td><td><a href="sql/SQL-Create-Class.html">CREATE CLASS</a></td><td><a href="sql/SQL-Create-Cluster.html">CREATE CLUSTER</a></td><td><a href="sql/SQL-Create-Link.html">CREATE LINK</a></td></tr>
<tr><td><a href="sql/SQL-Insert.html">INSERT</a></td><td><a href="sql/SQL-Create-Edge.html">CREATE EDGE</a></td><td><a href="sql/SQL-Alter-Class.html">ALTER CLASS</a></td><td><a href="sql/SQL-Alter-Cluster.html">ALTER CLUSTER</a></td><td><a href="sql/SQL-Find-References.html">FIND REFERENCES</a></td></tr>
<tr><td><a href="sql/SQL-Update.html">UPDATE</a></td><td><a href="sql/SQL-Delete-Vertex.html">DELETE VERTEX</a></td><td><a href="sql/SQL-Drop-Class.html">DROP CLASS</a></td><td><a href="sql/SQL-Drop-Cluster.html">DROP CLUSTER</a></td><td><a href="sql/SQL-Explain.html">EXPLAIN</a></td></tr>
<tr><td><a href="sql/SQL-Delete.html">DELETE</a></td><td><a href="sql/SQL-Delete-Edge.html">DELETE EDGE</a></td><td><a href="sql/SQL-Create-Property.html">CREATE PROPERTY</a></td><td><a href="sql/SQL-Alter-Database.html">ALTER DATABASE</a></td><td><a href="sql/SQL-Create-Function.html">CREATE FUNCTION</a></td></tr>
<tr><td><a href="sql/SQL-Traverse.html">TRAVERSE</a></td><td><a href="sql/SQL-Update-Edge.html">UPDATE EDGE</a></td><td><a href="sql/SQL-Alter-Property.html">ALTER PROPERTY</a></td><td><a href="sql/../console/Console-Command-Create-Database.html">CREATE DATABASE (console only)</a></td><td><a href="sql/SQL-HA-Status.html">HA STATUS</a></td></tr>
<tr><td><a href="sql/SQL-Truncate-Class.html">TRUNCATE CLASS</a></td><td><a href="sql/SQL-Move-Vertex.html">MOVE VERTEX</a></td><td><a href="sql/SQL-Drop-Property.html">DROP PROPERTY</a></td><td><a href="sql/../console/Console-Command-Drop-Database.html">DROP DATABASE (console only)</a></td><td><a href="sql/SQL-HA-Remove-Server.html">HA REMOVE SERVER</a></td></tr>
<tr><td><a href="sql/SQL-Truncate-Cluster.html">TRUNCATE CLUSTER</a></td><td><a href="sql/SQL-Match.html">MATCH</a></td><td><a href="sql/SQL-Create-Index.html">CREATE INDEX</a></td><td><a href="sql/SQL-Optimize-Database.html">OPTIMIZE DATABASE</a></td><td><a href="sql/SQL-HA-Sync-Database.html">HA SYNC DATABASE</a></td></tr>
<tr><td><a href="sql/SQL-Truncate-Record.html">TRUNCATE RECORD</a></td><td></td><td><a href="sql/SQL-Rebuild-Index.html">REBUILD INDEX</a></td><td><a href="sql/SQL-Create-User.html">CREATE USER</a></td><td><a href="sql/SQL-HA-Sync-Cluster.html">HA SYNC CLUSTER</a></td></tr>
<tr><td></td><td></td><td><a href="sql/SQL-Drop-Index.html">DROP INDEX</a></td><td><a href="sql/SQL-Drop-User.html">DROP USER</a></td><td><a href="sql/SQL-HA-Set.html">HA SET</a></td></tr>
<tr><td></td><td></td><td><a href="sql/SQL-Create-Sequence.html">CREATE SEQUENCE</a></td><td><a href="sql/SQL-Grant.html">GRANT</a></td><td><a href="sql/SQL-Profile.html">PROFILE</a></td></tr>
<tr><td></td><td></td><td><a href="sql/SQL-Alter-Sequence.html">ALTER SEQUENCE</a></td><td><a href="sql/SQL-Revoke.html">REVOKE</a></td><td></td></tr>
<tr><td></td><td></td><td><a href="sql/SQL-Drop-Sequence.html">DROP SEQUENCE</a></td><td><a href="sql/SQL-Create-Security-Policy.html">CREATE SECURITY POLICY</a></td><td></td></tr>
<tr><td></td><td></td><td></td><td><a href="sql/SQL-Alter-Security-Policy.html">ALTER SECURITY POLICY</a></td><td></td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="sql---alter-class"><a class="header" href="#sql---alter-class">SQL - <code>ALTER CLASS</code></a></h1>
<p>Updates attributes on an existing class in the schema.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">ALTER CLASS &lt;class&gt; &lt;attribute-name&gt; &lt;attribute-value&gt;
</code></pre>
<ul>
<li><strong><code>&lt;class&gt;</code></strong> Defines the class you want to change.</li>
<li><strong><code>&lt;attribute-name&gt;</code></strong> Defines the attribute you want to change.  For a list of supported attributes, see the table below.</li>
<li><strong><code>&lt;attribute-value&gt;</code></strong> Defines the value you want to set.</li>
<li><strong><code>UNSAFE</code></strong> Allows for the processing of a modification on an Edge class, without an exception error. The alteration will not take into account edge connections nor indexing. It is not recommended to use this! Be sure to make a backup before running it.</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Define a super-class:</p>
<pre>
orientdb> <code class='lang-sql userinput'>ALTER CLASS Employee SUPERCLASS Person</code>
</pre>
</li>
<li>
<p>Define multiple inheritances:</p>
<pre>
orientdb> <code class='lang-sql userinput'>ALTER CLASS Employee SUPERCLASS Person, `ORestricted`</code>
</pre>
<p>This feature was introduced in version 2.1.</p>
</li>
<li>
<p>Add a super-class:</p>
<pre>
orientdb> <code class="lang-sql userinput">ALTER CLASS Employee SUPERCLASS +Person</code>
</pre>
<p>This feature was introduced in version 2.1.</p>
</li>
<li>
<p>Remove a super-class:</p>
<pre>
orientdb> <code class="lang-sql userinput">ALTER CLASS Employee SUPERCLASS -Person</code>
</pre>
<p>This feature was introduced in version 2.1.</p>
</li>
<li>
<p>Update the class name from <code>Account</code> to <code>Seller</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">ALTER CLASS Account NAME Seller</code>
</pre>
</li>
<li>
<p>Update the oversize factor on the class <code>Account</code>:</p>
<pre>
orientdb> <code class='lang-sql userinput'>ALTER CLASS Account OVERSIZE 2</code>
</pre>
</li>
<li>
<p>Add a cluster to the class <code>Account</code>.</p>
<pre>
orientdb> <code class="lang-sql userinput">ALTER CLASS Account ADDCLUSTER account2</code>
</pre>
<p>In the event that the cluster does not exist, it automatically creates it.</p>
</li>
<li>
<p>Remove a cluster from the class <code>Account</code> with the ID <code>34</code>:</p>
<pre>
orientdb> <code class='lang-sql userinput'>ALTER CLASS Account REMOVECLUSTER 34</code>
</pre>
</li>
<li>
<p>Add custom properties:</p>
<pre>
orientdb> <code class='lang-sql userinput'>ALTER CLASS Post CUSTOM `onCreate.fields`="_allowRead,_allowUpdate"</code>
orientdb> <code class='lang-sql userinput'>ALTER CLASS Post CUSTOM `onCreate.identityType`="role"</code>
</pre>
</li>
<li>
<p>Create a new cluster for the class <code>Employee</code>, then set the cluster selection strategy to <code>balanced</code>:</p>
<pre>
orientdb> <code class='lang-sql userinput'>CREATE CLUSTER employee_1</code>
orientdb> <code class='lang-sql userinput'>ALTER CLASS Employee ADDCLUSTER employee_1</code>
orientdb> <code class='lang-sql userinput'>ALTER CLASS Employee CLUSTERSELECTION balanced</code>
</pre>
</li>
<li>
<p>Convert the class <code>TheClass</code> to an abstract class:</p>
<pre>
orientdb> <code class="lang-sql userinput">ALTER CLASS TheClass ABSTRACT true</code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information see <a href="sql/SQL-Create-Class.html"><code>CREATE CLASS</code></a>, <a href="sql/SQL-Drop-Class.html"><code>DROP CLASS</code></a>, <a href="sql/SQL-Alter-Cluster.html"><code>ALTER CLUSTER</code></a> commands.<br />
For more information on other commands, please refer to <a href="sql/../console/Console-Commands.html">Console Commands</a> and <a href="sql/SQL-Commands.html">SQL Commands</a>.</p>
</blockquote>
<h2 id="supported-attributes"><a class="header" href="#supported-attributes">Supported Attributes</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Attribute</th><th>Type</th><th>Support</th><th>Description</th></tr></thead><tbody>
<tr><td><code>NAME</code></td><td>Identifier</td><td></td><td>Changes the class name.</td></tr>
<tr><td><code>SHORTNAME</code></td><td>Identifier</td><td></td><td>Defines a short name, (that is, an alias), for the class.  Use <code>NULL</code> to remove a short name assignment.</td></tr>
<tr><td><code>SUPERCLASS</code></td><td>Identifier</td><td></td><td>Defines a super-class for the class.  Use <code>NULL</code> to remove a super-class assignment.  Beginning with version 2.1, it supports multiple inheritances. To add a new class, you can use the syntax <code>+&lt;class&gt;</code>, to remove it use <code>-&lt;class&gt;</code>.</td></tr>
<tr><td><code>SUPERCLASSES</code></td><td>Identifier [, Identifier]*</td><td></td><td>Defines a super-classes for the class.  Beginning with version 2.1, it supports multiple inheritances. To add a new class, you can use the syntax <code>+&lt;class&gt;</code>, to remove it use <code>-&lt;class&gt;</code>.</td></tr>
<tr><td><code>OVERSIZE</code></td><td>Decimal number</td><td></td><td>Defines the oversize factor.</td></tr>
<tr><td><code>ADDCLUSTER</code></td><td>Identifier or Integer</td><td></td><td>Adds a cluster to the class.  If the cluster doesn't exist, it creates a physical cluster. Adding clusters to a class is also useful in storing records in distributed servers.  For more information, see <a href="sql/../distributed/Distributed-Sharding.html">Distributed Sharding</a>.</td></tr>
<tr><td><code>REMOVECLUSTER</code></td><td>Identifier or Integer</td><td></td><td>Removes a cluster from a class.  It does not delete the cluster, only removes it from the class.</td></tr>
<tr><td><code>STRICTMODE</code></td><td>Boolean</td><td></td><td>Enables or disables strict mode.  When in strict mode, you work in schema-full mode and cannot add new properties to a record if they're part of the class' schema definition.</td></tr>
<tr><td><code>CLUSTERSELECTION</code></td><td></td><td>1.7</td><td>Defines the selection strategy in choosing which cluster it uses for new records.  On class creation it inherits the setting from the database.  For more information, see <a href="sql/../misc/Cluster-Selection.html">Cluster Selection</a>.</td></tr>
<tr><td><code>CUSTOM</code></td><td></td><td></td><td>Defines custom properties.  Property names and values must follow the syntax <code>&lt;property-name&gt;=&lt;value&gt;</code> without spaces between the name and value. The attribute name is an identifier, so it has to be back-tick quoted if it contains special characters (eg. dots); the value is a string, so it has to be quoted with single or double quotes.</td></tr>
<tr><td><code>ABSTRACT</code></td><td>Boolean</td><td></td><td>Converts class to an abstract class or the opposite.</td></tr>
</tbody></table>
</div>
<h2 id="history"><a class="header" href="#history">History</a></h2>
<h3 id="21"><a class="header" href="#21">2.1</a></h3>
<ul>
<li>Added support for multiple inheritance.</li>
</ul>
<h3 id="17"><a class="header" href="#17">1.7</a></h3>
<ul>
<li>Added support for <code>CLUSTERSELECTION</code> that sets the strategy used on selecting the cluster to use when creating new records.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---alter-cluster"><a class="header" href="#sql---alter-cluster">SQL - <code>ALTER CLUSTER</code></a></h1>
<p>Updates attributes on an existing cluster.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">ALTER CLUSTER &lt;cluster&gt; &lt;attribute-name&gt; &lt;attribute-value&gt;
</code></pre>
<ul>
<li><strong><code>&lt;cluster&gt;</code></strong> Defines the cluster you want to change.  You can use its logical name or ID.  Beginning with version 2.2, you can use the wildcard <code>*</code> to update multiple clusters together.</li>
<li><strong><code>&lt;attribute-name&gt;</code></strong> Defines the attribute you want to change.  For a list of supported attributes, see the table below.</li>
<li><strong><code>&lt;attribute-value&gt;</code></strong> Defines the value you want to set.</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Change the name of a cluster, using its name:</p>
<pre>
orientdb> <code class="lang-sql userinput">ALTER CLUSTER profile NAME "profile2"</code>
</pre>
</li>
</ul>
<blockquote>
<p>IMPORTANT: cluster name, status, compression, conflictstrategy are strings, so they have to be "quoted"</p>
</blockquote>
<ul>
<li>
<p>Change the name of a cluster, using its ID:</p>
<pre>
orientdb> <code class="lang-sql userinput">ALTER CLUSTER 9 NAME "profile2"</code>
</pre>
</li>
<li>
<p>Update the cluster conflict strategy to <code>automerge</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">ALTER CLUSTER V CONFLICTSTRATEGY "automerge"</code>
</pre>
</li>
<li>
<p>Put cluster <code>V_2012</code> offline:</p>
<pre>
orientdb> <code class='lang-sql userinput'>ALTER CLUSTER V_2012 STATUS "OFFLINE"</code>
</pre>
</li>
<li>
<p>Update multiple clusters with a similar name:</p>
<pre>
orientdb> <code class='lang-sql userinput'>ALTER CLUSTER employee* status "offline"</code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information see, <a href="sql/SQL-Create-Cluster.html"><code>CREATE CLUSTER</code></a>, <a href="sql/SQL-Drop-Cluster.html"><code>DROP CLUSTER</code></a>, <a href="sql/SQL-Alter-Cluster.html"><code>ALTER CLUSTER</code></a> commands.<br />
For more information on other commands, please refer to <a href="sql/../console/Console-Commands.html">Console Commands</a> and <a href="sql/SQL-Commands.html">SQL Commands</a>.</p>
</blockquote>
<h2 id="supported-attributes-1"><a class="header" href="#supported-attributes-1">Supported Attributes</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Support</th><th>Description</th></tr></thead><tbody>
<tr><td><code>NAME</code></td><td>String</td><td></td><td>Changes the cluster name.</td></tr>
<tr><td><code>STATUS</code></td><td>String</td><td></td><td>Changes the cluster status.  Allowed values are <code>ONLINE</code> and <code>OFFLINE</code>.  By default, clusters are online.  When offline, OrientDB no longer opens the physical files for the cluster.  You may find this useful when you want to archive old data elsewhere and restore when needed.</td></tr>
<tr><td><code>CONFLICTSTRATEGY</code></td><td>String</td><td>2.0+</td><td>Defines the strategy it uses to handle conflicts in the event that OrientDB MVCC finds an update or a delete operation it executes against an old record.  If you don't define a strategy at the cluster-level, it uses the database-level configuration.  For more information on supported strategies, see the section below.</td></tr>
</tbody></table>
</div>
<blockquote>
<p><strong>Note</strong>: from version 3.x attributes <code>COMPRESSION</code>, <code>USE_WAL</code>, <code>RECORD_OVERFLOW_GROW_FACTOR</code>, <code>RECORD_OVERFLOW_GROW_FACTOR</code> are no longer supported.</p>
</blockquote>
<h3 id="supported-conflict-strategies"><a class="header" href="#supported-conflict-strategies">Supported Conflict Strategies</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Strategy</th><th>Description</th></tr></thead><tbody>
<tr><td><code>version</code></td><td>Throws an exception when versions are different.  This is the default setting.</td></tr>
<tr><td><code>content</code></td><td>In the event that the versions are different, it checks for changes in the content, otherwise it uses the highest version to avoid throwing an exception.</td></tr>
<tr><td><code>automerge</code></td><td>Merges the changes.</td></tr>
</tbody></table>
</div>
<p>To know more about other SQL commands, take a look at <a href="sql/SQL-Commands.html">SQL Commands</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---alter-database"><a class="header" href="#sql---alter-database">SQL - <code>ALTER DATABASE</code></a></h1>
<p>Updates attributes on the current database.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">ALTER DATABASE &lt;attribute-name&gt; &lt;attribute-value&gt;
</code></pre>
<ul>
<li><strong><code>&lt;attribute-name&gt;</code></strong> Defines the attribute that you want to change.  For a list of supported attributes, see the section below.</li>
<li><strong><code>&lt;attribute-value&gt;</code></strong> Defines the value you want to set.</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Disable new SQL strict parser:</p>
<pre>
orientdb> <code class="lang-sql userinput">ALTER DATABASE CUSTOM strictSQL=false</code>
</pre>
</li>
<li>
<p>Update a Graph database that was created before version 1.4:</p>
<pre>
orientdb> <code class='lang-sql userinput'>ALTER DATABASE CUSTOM useLightweightEdges=FALSE</code>
orientdb> <code class='lang-sql userinput'>ALTER DATABASE CUSTOM useClassForEdgeLabel=FALSE</code>
orientdb> <code class='lang-sql userinput'>ALTER DATABASE CUSTOM useClassForVertexLabel=FALSE</code>
orientdb> <code class='lang-sql userinput'>ALTER DATABASE CUSTOM useVertexFieldsForEdgeLabel=FALSE</code>
</pre>
<blockquote>
<p>Version 1.4 introduced <a href="sql/../java/Lightweight-Edges.html">Lightweight Edges</a>, which was disabled by default beginning in version 2.0.  Use the above commands to maintain compatibility when using older databases with newer versions of OrientDB.</p>
</blockquote>
</li>
</ul>
<blockquote>
<p>To create a database, see the <a href="sql/../console/Console-Command-Create-Database.html"><code>CREATE DATABASE</code></a>.  To remove a database, see the <a href="sql/../console/Console-Command-Drop-Database.html"><code>DROP DATABASE</code></a> command.<br />
For more information on other commands, please refer to <a href="sql/../console/Console-Commands.html">Console Commands</a> and <a href="sql/SQL-Commands.html">SQL Commands</a>.</p>
</blockquote>
<h2 id="supported-attributes-2"><a class="header" href="#supported-attributes-2">Supported Attributes</a></h2>
<ul>
<li><strong>STATUS</strong> (String) database's status between:</li>
<li><strong>"CLOSED"</strong> to set closed status</li>
<li><strong>"IMPORTING"</strong> to set importing status</li>
<li><strong>"OPEN"</strong> to set open status</li>
<li><strong>DEFAULTCLUSTERID</strong> to set the default cluster. By default is 2 = "default"</li>
<li><strong>DATEFORMAT</strong> (String) sets the default date format. Look at <a href="http://docs.oracle.com/javase/6/docs/api/java/text/SimpleDateFormat.html">Java Date Format</a> for more information. Default is "yyyy-MM-dd"</li>
<li><strong>DATETIMEFORMAT</strong> (String) sets the default date time format. Look at <a href="http://docs.oracle.com/javase/6/docs/api/java/text/SimpleDateFormat.html">Java Date Format</a> for more information. Default is "yyyy-MM-dd HH:mm:ss"</li>
<li><strong>TIMEZONE</strong> (String) set the default timezone. Look at <a href="http://docs.oracle.com/javase/6/docs/api/java/util/TimeZone.html">Java Date TimeZones</a> for more information. Default is the JVM's default timezone</li>
<li><strong>LOCALECOUNTRY</strong> (String) sets the default locale country. Look at <a href="http://docs.oracle.com/javase/6/docs/api/java/util/Locale.html">Java Locales</a> for more information. Default is the JVM's default locale country. Example: "GB"</li>
<li><strong>LOCALELANGUAGE</strong> (String) sets the default locale language. Look at <a href="http://docs.oracle.com/javase/6/docs/api/java/util/Locale.html">Java Locales</a> for more information. Default is the JVM's default locale language. Example: "en"</li>
<li><strong>CHARSET</strong> (String) set the default charset charset. Look at <a href="http://docs.oracle.com/javase/6/docs/api/java/nio/charset/Charset.html">Java Charset</a> for more information. Default is the JVM's default charset. Example: "utf8"</li>
<li><strong>CLUSTERSELECTION</strong> (String) sets the default strategy used on selecting the cluster where to create new records. This setting is read on class creation. After creation, each class has own modifiable strategy. Supported strategies are:</li>
<li><strong>"default"</strong>, uses always the Class's <code>defaultClusterId</code> property. This was the default before 1.7</li>
<li><strong>"round-robin"</strong>, put the Class's configured clusters in a ring and returns a different cluster every time restarting from the first when the ring is completed</li>
<li><strong>"balanced"</strong>, checks the records in all the clusters and returns the smaller cluster. This allows the cluster to have all the underlying clusters balanced on size. On adding a new cluster to an existent class, the new empty cluster will be filled before the others because more empty then the others. In distributed configuration when configure clusters on different servers this setting allows to keep the server balanced with the same amount of data. Calculation of cluster size is made every 5 or more seconds to avoid to slow down insertion</li>
<li><strong>MINIMUMCLUSTERS</strong> (Integer), as the minimum number of clusters to create automatically when a new class is created. By default is 1, but on multi CPU/core having multiple clusters/files improves read/write performance</li>
<li><strong>CONFLICTSTRATEGY</strong>, (since v2.0) is the name of the strategy used to handle conflicts when OrientDB's MVCC finds an update or delete operation executed against an old record. The strategy is applied for the entire database, but single clusters can have own strategy (use <a href="sql/SQL-Alter-Cluster.html">ALTER CLUSTER</a> command for this). While it's possible to inject custom logic by writing a Java class, the out of the box modes are:</li>
<li><code>version</code>, the default, throw an exception when versions are different</li>
<li><code>content</code>, in case the version is different checks if the content is changed, otherwise use the highest version and avoid throwing exception</li>
<li><code>automerge</code>, merges the changes</li>
<li><strong>CUSTOM</strong> sets custom properties</li>
<li><strong>VALIDATION</strong>, (Since v2.2) disable or enable the validation for the entire database. This setting is not persistent, so at the next restart the validation is active (Default). Disabling the validation sometimes is needed in case of <a href="sql/../console/Console-Command-Import.html#validation-errors">remote import database</a>.</li>
</ul>
<h2 id="history-1"><a class="header" href="#history-1">History</a></h2>
<h3 id="17-1"><a class="header" href="#17-1">1.7</a></h3>
<ul>
<li>Adds support for <code>CLUSTERSELECTION</code> that sets the strategy used on selecting the cluster where to create new records.</li>
<li>Adds <code>MINIMUMCLUSTERS</code> to pre-create X clusters every time a new class is created.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---alter-property"><a class="header" href="#sql---alter-property">SQL - <code>ALTER PROPERTY</code></a></h1>
<p>Updates attributes on the existing property and class in the schema.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-xml">ALTER PROPERTY &lt;class&gt;.&lt;property&gt; &lt;attribute-name&gt; &lt;attribute-value&gt;
</code></pre>
<ul>
<li><strong><code>&lt;class&gt;</code></strong> Defines the class to which the property belongs.</li>
<li><strong><code>&lt;property&gt;</code></strong> Defines the property you want to update.</li>
<li><strong><code>&lt;attribute-name&gt;</code></strong> Defines the attribute you want to change.</li>
<li><strong><code>&lt;attribute-value&gt;</code></strong> Defines the value you want to set on the attribute.</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Change the name of the property <code>age</code> in the class <code>Account</code> to <code>born</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">ALTER PROPERTY Account.age NAME "born"</code>
</pre>
</li>
<li>
<p>Update a property to make it mandatory:</p>
<pre>
orientdb><code class="lang-sql userinput">ALTER PROPERTY Account.age MANDATORY TRUE</code>
</pre>
</li>
<li>
<p>Define a Regular Expression as constraint:</p>
<pre>
orientdb> <code class="lang-sql userinput">ALTER PROPERTY Account.gender REGEXP "[M|F]"</code>
</pre>
</li>
<li>
<p>Define a field as case-insensitive to comparisons:</p>
<pre>
orientdb> <code class="lang-sql userinput">ALTER PROPERTY Employee.name COLLATE "ci"</code>
</pre>
</li>
<li>
<p>Define a custom field on a property:</p>
<pre>
orientdb> <code class="lang-sql userinput">ALTER PROPERTY Foo.bar1 custom stereotype="visible"</code>
</pre>
</li>
<li>
<p>Set the default value for the current date:</p>
<pre>
orientdb> <code class="lang-sql userinput">ALTER PROPERTY Client.created DEFAULT "sysdate()"</code>
</pre>
</li>
<li>
<p>Define a unique id that cannot be changed after creation:</p>
<pre>
orientdb> <code class="lang-sql userinput">ALTER PROPERTY Client.id DEFAULT "uuid()" READONLY</code>
orientdb> <code class="lang-sql userinput">ALTER PROPERTY Client.id READONLY TRUE</code>
</pre>
</li>
</ul>
<h2 id="supported-attributes-3"><a class="header" href="#supported-attributes-3">Supported Attributes</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Attribute</th><th>Type</th><th>Support</th><th>Description</th></tr></thead><tbody>
<tr><td><code>LINKEDCLASS</code></td><td>String</td><td></td><td>Defines the linked class name.  Use <code>NULL</code> to remove an existing value.</td></tr>
<tr><td><code>LINKEDTYPE</code></td><td>String</td><td></td><td>Defines the <a href="sql/../general/Types.html">link type</a>.  Use <code>NULL</code> to remove an existing value.</td></tr>
<tr><td><code>MIN</code></td><td>Integer</td><td></td><td>Defines the minimum value as a constraint.  Use <code>NULL</code> to remove an existing constraint.  On String attributes, it defines the minimum length of the string.  On Integer attributes, it defines the minimum value for the number.  On Date attributes, the earliest date accepted.  For multi-value attributes (lists, sets and maps), it defines the fewest number of entries.</td></tr>
<tr><td><code>MANDATORY</code></td><td>Boolean</td><td></td><td>Defines whether the property requires a value.</td></tr>
<tr><td><code>MAX</code></td><td>Integer</td><td></td><td>Defines the maximum value as a constraint.  Use <code>NULL</code> to remove an existing constraint.  On String attributes, it defines the greatest length of the string.  On Integer attributes, it defines the maximum value for the number.  On Date attributes, the last date accepted.  For multi-value attributes (lists, sets and maps), it defines the highest number of entries.</td></tr>
<tr><td><code>NAME</code></td><td>String</td><td></td><td>Defines the property name.</td></tr>
<tr><td><code>NOTNULL</code></td><td>Boolean</td><td></td><td>Defines whether the property can have a null value.</td></tr>
<tr><td><code>REGEXP</code></td><td>String</td><td></td><td>Defines a Regular Expression as constraint.  Use <code>NULL</code> to remove an existing constraint.</td></tr>
<tr><td><code>TYPE</code></td><td>String</td><td></td><td>Defines a <a href="sql/../general/Types.html">property type</a>.</td></tr>
<tr><td><code>COLLATE</code></td><td>String</td><td></td><td>Sets collate to one of the defined comparison strategies.  By default, it is set to case-sensitive (<code>cs</code>).  You can also set it to case-insensitive (<code>ci</code>).</td></tr>
<tr><td><code>READONLY</code></td><td>Boolean</td><td></td><td>Defines whether the property value is immutable.  That is, if it is possible to change it after the first assignment.  Use with <code>DEFAULT</code> to have immutable values on creation.</td></tr>
<tr><td><code>CUSTOM</code></td><td>String</td><td></td><td>Defines custom properties.  The syntax for custom properties is <code>&lt;custom-name&gt; = &lt;custom-value&gt;</code>, such as <code>stereotype = icon</code>. The custom name is an identifier, so it has to be back-tick quoted if it contains special characters (eg. dots); the value is a string, so it has to be quoted with single or double quotes.</td></tr>
<tr><td><code>DEFAULT</code></td><td></td><td></td><td>Defines the default value or function.  Feature introduced in version 2.1, (see the section above for examples). Use <code>NULL</code> to remove an existing constraint.</td></tr>
</tbody></table>
</div>
<p>When altering <code>NAME</code> or <code>TYPE</code> this command runs a data update that may take some time, depending on the amount of data.  Don't shut the database down during this migration. When altering property name, the old value is copied to the new property name.</p>
<blockquote>
<p>To create a property, use the <a href="sql/SQL-Create-Property.html"><code>CREATE PROPERTY</code></a> command, to remove a property the <a href="sql/SQL-Drop-Property.html"><code>DROP PROPERTY</code></a> command.<br />
For more information on other commands, please refer to <a href="sql/../console/Console-Commands.html">Console Commands</a> and <a href="sql/SQL-Commands.html">SQL Commands</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---alter-security-policy"><a class="header" href="#sql---alter-security-policy">SQL - <code>ALTER SECURITY POLICY</code></a></h1>
<p>Alters an existing security policy</p>
<p>A security resource is a set of SQL predicates, associated to basic operations (eg. CREATE, READ and so on), that are evaluated for each record to determine if the operation is allowed or not.</p>
<p><strong>Syntax</strong></p>
<pre><code>ALTER SECURITY POLICY &lt;name&gt; 
[

  SET
  ( [CREATE | READ | BEFORE UPDATE | AFTER UPDATE | DELETE | EXECUTE] = (&lt;sqlPredicate&gt;) )*
]
[ 
  REMOVE [CREATE | READ | BEFORE UPDATE | AFTER UPDATE | DELETE | EXECUTE]*
]
</code></pre>
<ul>
<li><strong><code>&lt;name&gt;</code></strong> The security policy name. It is used in the GRANT statement to bind it to a role and a resource</li>
<li><strong><code>&lt;sqlPredicate&gt;</code></strong> a valid SQL predicate</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Change CREATE and READ predicates for a security policy:</p>
<pre>
<code class='lang-sql userinput'>ALTER SECURITY POLICY foo SET CREATE = (name = 'foo'), READ = (TRUE)</code>
</pre>
</li>
<li>
<p>Remove CREATE and READ predicates for a security policy:</p>
<pre>
<code class='lang-sql userinput'>ALTER SECURITY POLICY foo REMOVE CREATE, READ</code>
</pre>
</li>
</ul>
<blockquote>
<p>See also</p>
<ul>
<li><a href="sql/SQL-Commands.html">SQL Commands</a>.</li>
<li><a href="sql/SQL-Create-Security-Policy.html">CREATE SECURITY POLICY</a>.</li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---alter-sequence"><a class="header" href="#sql---alter-sequence">SQL - <code>ALTER SEQUENCE</code></a></h1>
<p>Changes the sequence.  Using this parameter you can change all sequence options, except for the sequence type.</p>
<p>This feature was introduced in version 2.2.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">ALTER SEQUENCE &lt;sequence&gt; [START &lt;start-point&gt;] [INCREMENT &lt;increment&gt;] [CACHE &lt;cache&gt;] [CYCLE TRUE|FALSE] [LIMIT &lt;limit_value&gt;] [ASC|DESC]
</code></pre>
<ul>
<li><strong><code>&lt;sequence&gt;</code></strong> Defines the sequence you want to change.</li>
<li><strong><code>START</code></strong> Defines the initial sequence value.</li>
<li><strong><code>INCREMENT</code></strong> Defines the value to increment when it calls <code>.next()</code>.</li>
<li><strong><code>CACHE</code></strong> Defines the number of values to cache, in the event that the sequence is of the type <code>CACHED</code>.</li>
<li><strong><code>CYCLE</code></strong> Defines if sequence will restart from <code>START</code> value after <code>LIMIT</code> value reached. Default value is <code>FALSE</code>.</li>
<li><strong><code>LIMIT</code></strong> Defines limit value sequence can reach. After limit value is reached cyclic sequences will restart from START value, while non cyclic sequences will throw message that limit is reached.</li>
<li><strong><code>ASC | DESC</code></strong> Defines order of the sequence. <code>ASC</code> defines that next sequence value will be <code class="lang-sql userinput">currentValue + incrementValue</code>, while <code>DESC</code> defines that next sequence value will be <code class="lang-sql userinput">currentValue - incrementValue</code> (assuming that limit is not reached). Default value is <code>ASC</code>.</li>
<li><strong><code>NOLIMIT</code></strong> Cancel previously defined <code>LIMIT</code> value</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Alter a sequence, resetting the start value to <code>1000</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">ALTER SEQUENCE idseq START 1000 CYCLE TRUE</code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="sql/SQL-Create-Sequence.html"><code>CREATE SEQUENCE</code></a></li>
<li><a href="sql/SQL-Drop-Sequence.html"><code>DROP SEQUENCE</code></a></li>
<li><a href="sql/Sequences-and-auto-increment.html">Sequences and Auto-increment</a></li>
<li><a href="sql/SQL-Commands.html">SQL Commands</a>.</li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---create-class"><a class="header" href="#sql---create-class">SQL - <code>CREATE CLASS</code></a></h1>
<p>Creates a new class in the schema.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">CREATE CLASS &lt;class&gt; 
[ IF NOT EXISTS ]
[EXTENDS &lt;super-class&gt;] [CLUSTER &lt;cluster-id&gt;*] [CLUSTERS &lt;total-cluster-number&gt;] [ABSTRACT]
</code></pre>
<ul>
<li><strong><code>&lt;class&gt;</code></strong> Defines the name of the class you want to create.  You must use a letter, underscore or dollar for the first character, for all other characters you can use alphanumeric characters, underscores and dollar.</li>
<li><strong>IF NOT EXISTS</strong> Specifying this option, the class creation will just be ignored if the class already exists (instead of failing with an error)</li>
<li><strong><code>&lt;super-class&gt;</code></strong> Defines the super-class you want to extend with this class.</li>
<li><strong><code>&lt;cluster-id&gt;</code></strong>  Defines in a comma-separated list the ID's of the clusters you want this class to use.</li>
<li><strong><code>&lt;total-cluster-number&gt;</code></strong> Defines the total number of clusters you want to create for this class.  The default value is <code>1</code>.  This feature was introduced in version 2.1.</li>
<li><strong><code>ABSTRACT</code></strong> Defines whether the class is abstract.  For abstract classes, you cannot create instances of the class.</li>
</ul>
<p>In the event that a cluster of the same name exists in the cluster, the new class uses this cluster by default.  If you do not define a cluster in the command and a cluster of this name does not exist, OrientDB creates one.  The new cluster has the same name as the class, but in lower-case.</p>
<p>When working with multiple cores, it is recommended that you use multiple clusters to improve concurrency during inserts.  To change the number of clusters created by default, <a href="sql/SQL-Alter-Database.html"><code>ALTER DATABASE</code></a> command to update the <code>minimumclusters</code> property.  Beginning with version 2.1, you can also define the number of clusters you want to create using the <code>CLUSTERS</code> option when you create the class.</p>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Create the class <code>Account</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE CLASS Account</code>
</pre>
</li>
<li>
<p>Create the class <code>Car</code> to extend <code>Vehicle</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE CLASS Car EXTENDS Vehicle</code>
</pre>
</li>
<li>
<p>Create the class <code>Car</code>, using the cluster ID of <code>10</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE CLASS Car CLUSTER 10</code>
</pre>
</li>
<li>
<p>Create the class <code>Person</code> as an <a href="sql/../datamodeling/Concepts.html#abstract-class">abstract class</a>:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE CLASS Person ABSTRACT</code>
</pre>
</li>
</ul>
<h2 id="cluster-selection-strategies"><a class="header" href="#cluster-selection-strategies">Cluster Selection Strategies</a></h2>
<p>When you create a class, it inherits the cluster selection strategy defined at the database-level.  By default this is set to round-robin.  You can change the database default using the <a href="sql/SQL-Alter-Database.html"><code>ALTER DATABASE</code></a> command and the selection strategy for the class using the <a href="sql/SQL-Alter-Class.html"><code>ALTER CLASS</code></a> command.</p>
<p>Supported Strategies:</p>
<div class="table-wrapper"><table><thead><tr><th>Strategy</th><th>Description</th></tr></thead><tbody>
<tr><td><code>default</code></td><td>Selects the cluster using the class property <code>defaultClusterId</code>.  This was the default selection strategy before version 1.7.</td></tr>
<tr><td><code>round-robin</code></td><td>Selects the next cluster in a circular order, restarting once complete.</td></tr>
<tr><td><code>balanced</code></td><td>Selects the smallest cluster.  Allows the class to have all underlying clusters balanced on size.  When adding a new cluster to an existing class, it fills the new cluster first.  When using a distributed database, this keeps the servers balanced with the same amount of data.  It calculates the cluster size every five seconds or more to avoid slow-downs on insertion.</td></tr>
</tbody></table>
</div>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="sql/SQL-Alter-Class.html"><code>ALTER CLASS</code></a></li>
<li><a href="sql/SQL-Drop-Class.html"><code>DROP CLASS</code></a></li>
<li><a href="sql/SQL-Create-Cluster.html"><code>CREATE CLUSTER</code></a></li>
<li><a href="sql/SQL-Commands.html">SQL Commands</a></li>
<li><a href="sql/../console/Console-Commands.html">Console Commands</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---create-cluster"><a class="header" href="#sql---create-cluster">SQL - <code>CREATE CLUSTER</code></a></h1>
<p>Creates a new cluster in the database.  Once created, you can use the cluster to save records by specifying its name during saves.  If you want to add the new cluster to a class, follow its creation with the <a href="sql/SQL-Alter-Class.html"><code>ALTER CLASS</code></a> command, using the <code>ADDCLUSTER</code> option.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">CREATE CLUSTER &lt;cluster&gt; [ID &lt;cluster-id&gt;]
</code></pre>
<ul>
<li><strong><code>&lt;cluster&gt;</code></strong> Defines the name of the cluster you want to create.  You must use a letter for the first character, for all other characters, you can use alphanumeric characters, underscores and dashes.</li>
<li><strong><code>&lt;cluster-id&gt;</code></strong> Defines the numeric ID you want to use for the cluster.</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Create the cluster <code>account</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE CLUSTER account</code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information see,</p>
<ul>
<li><a href="sql/SQL-Drop-Cluster.html"><code>DROP CLUSTER</code></a></li>
<li><a href="sql/SQL-Commands.html">SQL Commands</a></li>
<li><a href="sql/../console/Console-Commands.html">Console Commands</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---create-edge"><a class="header" href="#sql---create-edge">SQL - <code>CREATE EDGE</code></a></h1>
<p>Creates a new edge in the database.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">CREATE EDGE &lt;class&gt; [CLUSTER &lt;cluster&gt;] [UPSERT] FROM &lt;rid&gt;|(&lt;query&gt;)|[&lt;rid&gt;]* TO &lt;rid&gt;|(&lt;query&gt;)|[&lt;rid&gt;]*
                    [SET &lt;field&gt; = &lt;expression&gt;[,]*]|CONTENT {&lt;JSON&gt;}
                    [RETRY &lt;retry&gt; [WAIT &lt;pauseBetweenRetriesInMs]] [BATCH &lt;batch-size&gt;]
</code></pre>
<ul>
<li><strong><code>&lt;class&gt;</code></strong> Defines the class name for the edge.  Use the default edge class <code>E</code> in the event that you don't want to use sub-types.</li>
<li><strong><code>&lt;cluster&gt;</code></strong> Defines the cluster in which you want to store the edge.</li>
<li><strong><code>UPSERT</code></strong> (since v 3.0.1) allows to skip the creation of edges that already exist between two vertices (ie. a unique edge for a couple of vertices). This works only if the edge class has a UNIQUE index on <code>out, in</code> fields, otherwise the statement fails.</li>
<li><strong><code>JSON</code></strong> Provides JSON content to set as the record.  Use this instead of entering data field by field.</li>
<li><strong><code>RETRY</code></strong> Define the number of retries to attempt in the event of conflict, (optimistic approach).</li>
<li><strong><code>WAIT</code></strong> Defines the time to delay between retries in milliseconds.</li>
<li><strong><code>BATCH</code></strong> Defines whether it breaks the command down into smaller blocks and the size of the batches.  This helps to avoid memory issues when the number of vertices is too high.  By default, it is set to <code>100</code>.  This feature was introduced in version 2.1.3.</li>
</ul>
<p>Edges and Vertices form the main components of a Graph database.  OrientDB supports polymorphism on edges.  The base class for an edge is <code>E</code>.</p>
<p>Beginning with version 2.1, when no edges are created OrientDB throws a <code>OCommandExecutionException</code> error.  This makes it easier to integrate edge creation in transactions.  In such cases, if the source or target vertices don't exist, it rolls back the transaction.  (Prior to 2.1, no such error is thrown.)</p>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Create an edge of the class <code>E</code> between two vertices:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE EDGE FROM #10:3 TO #11:4</code>
</pre>
</li>
<li>
<p>Create a new edge type and an edge of the new type:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE CLASS E1 EXTENDS E</code>
orientdb> <code class="lang-sql userinput">CREATE EDGE E1 FROM #10:3 TO #11:4</code>
</pre>
</li>
<li>
<p>Create an edge in a specific cluster:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE EDGE E1 CLUSTER EuropeEdges FROM #10:3 TO #11:4</code>
</pre>
</li>
<li>
<p>Create an edge and define its properties:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE EDGE FROM #10:3 TO #11:4 SET brand = 'fiat'</code>
</pre>
</li>
<li>
<p>Create an edge of the type <code>E1</code> and define its properties:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE EDGE E1 FROM #10:3 TO #11:4 SET brand = 'fiat', name = 'wow'</code>
</pre>
</li>
<li>
<p>Create edges of the type <code>Watched</code> between all action movies in the database and the user Luca, using sub-queries:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE EDGE Watched FROM (SELECT FROM account WHERE name = 'Luca') TO 
          (SELECT FROM movies WHERE type.name = 'action')</code>
</pre>
</li>
<li>
<p>Create an edge using JSON content:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE EDGE E FROM #22:33 TO #22:55 CONTENT</code> <code class='lang-json userinput'>{ "name": "Jay", 
          "surname": "Miner" }</code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="sql/SQL-Create-Vertex.html"><code>CREATE VERTEX</code></a></li>
</ul>
</blockquote>
<h2 id="control-vertices-version-increment"><a class="header" href="#control-vertices-version-increment">Control Vertices Version Increment</a></h2>
<p>Creating and deleting edges causes OrientDB to update versions involved in the vertices.  To avoid this behavior, use the <a href="sql/../internals/RidBag.html">Bonsai Structure</a>.</p>
<p>By default, OrientDB uses Bonsai as soon as it reaches the threshold to optimize operation.  To always use Bonsai on your database, either set this configuration on the JVM or in the <code>orientdb-server-config.xml</code> configuration file.</p>
<pre>
$ <code class="userinput lang-sh">java -DridBag.embeddedToSbtreeBonsaiThreshold=-1</code>
</pre>
<p>Alternatively, in your Java application use the following call before opening the database:</p>
<pre><code class="language-java">OGlobalConfiguration.RID_BAG_EMBEDDED_TO_SBTREEBONSAI_THRESHOLD.setValue(-1);
</code></pre>
<blockquote>
<p>For more information, see <a href="sql/../general/Concurrency.html#concurrency-when-adding-edges">Concurrency on Adding Edges</a>.</p>
</blockquote>
<div class="table-wrapper"><table><thead><tr><th><img src="sql/../images/warning.png" alt="NOTE" /></th><th>When running a distributed database, edge creation can sometimes be done in two steps, (that is, create and update).  This can break some constraints defined in the Edge at the class-level.  To avoid such problems, disable the constraints in the Edge class.  Bear in mind that in distributed mode SB Tree index algorithm is not supported.  You must set <code>ridBag.embeddedToSbtreeBonsaiThreashold=Integer.Max\_VALUE</code> to avoid replication errors</th></tr></thead><tbody>
</tbody></table>
</div>
<h2 id="history-2"><a class="header" href="#history-2">History</a></h2>
<h3 id="20"><a class="header" href="#20">2.0</a></h3>
<ul>
<li>Disables <a href="sql/../java/Lightweight-Edges.html">Lightweight Edges</a> in new databases by default.  This command now creates a regular edge.</li>
</ul>
<h3 id="14"><a class="header" href="#14">1.4</a></h3>
<ul>
<li>
<p>Command uses the Blueprints API.  If you are in Java using the <code>OGraphDatabase</code> API, you may experience some differences in how OrientDB manages edges.</p>
<blockquote>
<p>To force the command to work with the older API, change the GraphDB settings, as described in <a href="sql/SQL-Alter-Database.html">Graph backwards compatibility</a>.</p>
</blockquote>
</li>
</ul>
<h3 id="12"><a class="header" href="#12">1.2</a></h3>
<ul>
<li>Implements support for query and collection of Record ID's in the <code>FROM...TO</code> clause.</li>
</ul>
<h3 id="11"><a class="header" href="#11">1.1</a></h3>
<ul>
<li>Initial version.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---create-function"><a class="header" href="#sql---create-function">SQL - <code>CREATE FUNCTION</code></a></h1>
<p>Creates a new Server-side function.  You can execute <a href="sql/../admin/Functions.html">Functions</a> from SQL, HTTP and Java.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">CREATE FUNCTION &lt;name&gt; &lt;code&gt;
                [PARAMETERS [&lt;comma-separated list of parameters' name&gt;]]
                [IDEMPOTENT true|false]
                [LANGUAGE &lt;language&gt;]
</code></pre>
<ul>
<li><strong><code>&lt;name&gt;</code></strong> Defines the function name.</li>
<li><strong><code>&lt;code&gt;</code></strong> Defines the function code.</li>
<li><strong><code>PARAMETERS</code></strong> Defines a comma-separated list of parameters bound to the execution heap. You must wrap your parameters list in square brackets [].</li>
<li><strong><code>IDEMPOTENT</code></strong> Defines whether the function can change the database status.  This is useful given that HTTP GET can call <code>IDEMPOTENT</code> functions, while others are called by HTTP POST.  By default, it is set to <code>FALSE</code>.</li>
<li><strong><code>LANGUAGE</code></strong> Defines the language to use.  By default, it is set to JavaScript.</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Create a function <code>test()</code> in JavaScript, which takes no parameters:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE FUNCTION test "print('\nTest!')"</code>
</pre>
</li>
<li>
<p>Create a function <code>test(a,b)</code> in JavaScript, which takes 2 parameters:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE FUNCTION test "return a + b;" PARAMETERS [a,b]</code>
</pre>
</li>
<li>
<p>Create a function <code>allUsersButAdmin</code> in SQL, which takes with no parameters:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE FUNCTION allUsersButAdmin "SELECT FROM ouser WHERE name <> 
          'admin'" LANGUAGE SQL</code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="sql/../admin/Functions.html">Functions</a></li>
<li><a href="sql/SQL-Commands.html">SQL Commands</a></li>
<li><a href="sql/../console/Console-Commands.html">Console Commands</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---create-index"><a class="header" href="#sql---create-index">SQL - <code>CREATE INDEX</code></a></h1>
<p>Creates a new index.  Indexes can be</p>
<ul>
<li><strong>Unique</strong> Where they don't allow duplicates.</li>
<li><strong>Not Unique</strong> Where they allow duplicates.</li>
<li><strong>Full Text</strong> Where they index any single word of text.</li>
</ul>
<blockquote>
<p>There are several index algorithms available to determine how OrientDB indexes your database.  For more information on these, see <a href="sql/../indexing/Indexes.html">Indexes</a>.</p>
</blockquote>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">CREATE INDEX &lt;name&gt;
[ IF NOT EXISTS ]
[ ON &lt;class&gt; (&lt;property&gt;*) ] 
&lt;index-type&gt; [&lt;key-type&gt;]
METADATA [{&lt;json&gt;}]
</code></pre>
<ul>
<li>
<p><strong><code>&lt;name&gt;</code></strong> Defines the logical name for the index.  If a schema already exists, you can use <code>&lt;class&gt;.&lt;property&gt;</code> to create automatic indexes bound to the schema property.  Because of this, you cannot use the period "<code>.</code>" character in index names.</p>
</li>
<li>
<p><strong>IF NOT EXISTS</strong> Specifying this option, the index creation will just be ignored if the index already exists (instead of failing with an error)</p>
</li>
<li>
<p><strong><code>&lt;class&gt;</code></strong> Defines the class to create an automatic index for.  The class must already exist.</p>
</li>
<li>
<p><strong><code>&lt;property&gt;</code></strong> Defines the property you want to automatically index.  The property must already exist.</p>
<blockquote>
<p>If the property is one of the Map types, such as <code>LINKMAP</code> or <code>EMBEDDEDMAP</code>, you can specify the keys or values to use in index generation, using the <code>BY KEY</code> or <code>BY VALUE</code> clause.</p>
</blockquote>
</li>
<li>
<p><strong><code>&lt;index-type&gt;</code></strong> Defines the index type you want to use.  For a complete list, see <a href="sql/../indexing/Indexes.html">Indexes</a>.</p>
</li>
<li>
<p><strong><code>&lt;key-type&gt;</code></strong> Defines the key type.  With automatic indexes, the key type is automatically selected when the database reads the target schema property.  For manual indexes, when not specified, it selects the key at run-time during the first insertion by reading the type of the class.  In creating composite indexes, it uses a comma-separated list of types.</p>
</li>
<li>
<p><strong><code>METADATA</code></strong> Defines additional metadata through JSON.</p>
</li>
</ul>
<p>To create an automatic index bound to the schema property, use the <code>ON</code> clause, or use a <code>&lt;class&gt;.&lt;property&gt;</code> name for the index.  In order to create an index, the schema must already exist in your database.</p>
<p>In the event that the <code>ON</code> and <code>&lt;key-type&gt;</code> clauses both exist, the database validates the specified property types.  If the property types don't equal those specified in the key type list, it throws an exception.</p>
<blockquote>
<p>You can use list key types when creating manual composite indexes, but bear in mind that such indexes are not yet fully supported.</p>
</blockquote>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Create a manual index to store dates:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE INDEX mostRecentRecords UNIQUE DATE</code>
</pre>
</li>
<li>
<p>Create an automatic index bound to the new property <code>id</code> in the class <code>User</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE PROPERTY User.id BINARY</code>
orientdb> <code class="lang-sql userinput">CREATE INDEX User.id UNIQUE</code>
</pre>
</li>
<li>
<p>Create a series automatic indexes for the <code>thumbs</code> property in the class <code>Movie</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE INDEX thumbsAuthor ON Movie (thumbs) UNIQUE</code>
orientdb> <code class="lang-sql userinput">CREATE INDEX thumbsAuthor ON Movie (thumbs BY KEY) UNIQUE</code>
orientdb> <code class="lang-sql userinput">CREATE INDEX thumbsValue ON Movie (thumbs BY VALUE) UNIQUE</code>
</pre>
</li>
<li>
<p>Create a series of properties and on them create a composite index:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE PROPERTY Book.author STRING</code>
orientdb> <code class="lang-sql userinput">CREATE PROPERTY Book.title STRING</code>
orientdb> <code class="lang-sql userinput">CREATE PROPERTY Book.publicationYears EMBEDDEDLIST INTEGER</code>
orientdb> <code class="lang-sql userinput">CREATE INDEX books ON Book (author, title, publicationYears) UNIQUE</code>
</pre>
</li>
<li>
<p>Create an index on an edge's date range:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE CLASS File EXTENDS V</code>
orientdb> <code class="lang-sql userinput">CREATE CLASS Has EXTENDS E</code>
orientdb> <code class="lang-sql userinput">CREATE PROPERTY Has.started DATETIME</code>
orientdb> <code class="lang-sql userinput">CREATE PROPERTY Has.ended DATETIME</code>
orientdb> <code class="lang-sql userinput">CREATE INDEX Has.started_ended ON Has (started, ended) NOTUNIQUE</code>
</pre>
<blockquote>
<p>You can create indexes on edge classes only if they contain the begin and end date range of validity.  This is use case is very common with historical graphs, such as the example above.</p>
</blockquote>
</li>
<li>
<p>Using the above index, retrieve all the edges that existed in the year 2014:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM Has WHERE started >= '2014-01-01 00:00:00.000' AND 
          ended < '2015-01-01 00:00:00.000'</code>
</pre>
</li>
<li>
<p>Using the above index, retrieve all edges that existed in 2014 and write them to the parent file:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT outV() FROM Has WHERE started >= '2014-01-01 00:00:00.000' 
          AND ended < '2015-01-01 00:00:00.000'</code>
</pre>
</li>
<li>
<p>Using the above index, retrieve all the 2014 edges and connect them to children files:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT inV() FROM Has WHERE started >= '2014-01-01 00:00:00.000' 
          AND ended < '2015-01-01 00:00:00.000'</code>
</pre>
</li>
<li>
<p>Create an index that includes null values.</p>
<p>By default, indexes ignore null values.  Queries against null values that use an index returns no entries.  To index null values, see <code>{ ignoreNullValues: false }</code> as metadata.</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE INDEX addresses ON Employee (address) NOTUNIQUE
           METADATA { ignoreNullValues : false }</code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="sql/SQL-Drop-Index.html"><code>DROP INDEX</code></a></li>
<li><a href="sql/../indexing/Indexes.html">Indexes</a></li>
<li><a href="sql/SQL-Commands.html">SQL Commands</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---create-link"><a class="header" href="#sql---create-link">SQL - <code>CREATE LINK</code></a></h1>
<p>Creates a link between two simple values.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">CREATE LINK &lt;link&gt; TYPE [&lt;link-type&gt;] FROM &lt;source-class&gt;.&lt;source-property&gt; TO &lt;destination-class&gt;.&lt;destination-property&gt; [INVERSE]
</code></pre>
<ul>
<li><strong><code>&lt;link</code>&gt;</strong> Defines the property for the link.  When not expressed, the link overwrites the <code>&lt;destination-property&gt;</code> field.</li>
<li><strong><code>&lt;link-type&gt;</code></strong> Defines the type for the link.  In the event of an inverse relationship, (the most common), you can specify <code>LINKSET</code> or <code>LINKLIST</code> for 1-<em>n</em> relationships.</li>
<li><strong><code>&lt;source-class&gt;</code></strong> Defines the class to link from.</li>
<li><strong><code>&lt;source-property&gt;</code></strong> Defines the property to link from.</li>
<li><strong><code>&lt;destination-class&gt;</code></strong> Defines the class to link to.</li>
<li><strong><code>&lt;destination-property&gt;</code></strong> Defines the property to link to.</li>
<li><strong><code>INVERSE</code></strong> Defines whether to create a connection on the opposite direction.  This option is common when creating 1-<em>n</em> relationships from a Relational database, where they are mapped at the opposite direction.</li>
</ul>
<p><strong>Example</strong></p>
<ul>
<li>
<p>Create an inverse link between the classes <code>Comments</code> and <code>Post</code>:</p>
 <pre>
 orientdb> <code class="lang-sql userinput">CREATE LINK comments TYPE LINKSET FROM Comments.PostId TO Posts.Id 
           INVERSE</code>
 </pre>
</li>
</ul>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="sql/../datamodeling/Concepts.html#relationships">Relationships</a></li>
<li><a href="sql/../admin/Import-RDBMS-to-Document-Model.html">Importing from Relational Databases</a></li>
<li><a href="sql/SQL-Commands.html">SQL Commands</a></li>
</ul>
</blockquote>
<h2 id="conversion-from-relational-databases"><a class="header" href="#conversion-from-relational-databases">Conversion from Relational Databases</a></h2>
<p>You may find this useful when imported data from a Relational database.  In the Relational world, the database uses links to resolve foreign keys.  In general, this is not the way to create links, but rather a way to convert two values in two different classes into a link.</p>
<p>As an example, consider a Relational database where the table <code>Post</code> has a 1-<em>n</em> relationship with the table <code>Comment</code>.  That is <code>Post 1 ---&gt; * Comment</code>, such as:</p>
<pre>
reldb> <code class="lang-sql userinput">SELECT * FROM Post;</code>

+----+----------------+
| Id | Title          |
+----+----------------+
| 10 | NoSQL movement |
+----+----------------+
| 20 | New OrientDB   |
+----+----------------+

reldb> <code class="lang-sql userinput">SELECT * FROM Comment;</code>

+----+--------+--------------+
| Id | PostID | Text         |
+----+--------+--------------+
|  0 | 10     | First        |
+----+--------+--------------+
|  1 | 10     | Second       |
+----+--------+--------------+
| 21 | 10     | Another      |
+----+--------+--------------+
| 41 | 20     | First again  |
+----+--------+--------------+
| 82 | 20     | Second Again |
+----+--------+--------------+
</pre>
<p>In OrientDB, instead of a separate table for the relationship, you use a direct relationship as your object model.  Meaning that the database navigates from <code>Post</code> to <code>Comment</code> and not vice versa, as with Relational databases.  To do so, you would also need to create the link with the <code>INVERSE</code> option.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---create-property"><a class="header" href="#sql---create-property">SQL - <code>CREATE PROPERTY</code></a></h1>
<p>Creates a new property in the schema.  It requires that the class for the property already exist on the database.</p>
<p><strong>Syntax</strong></p>
<pre><code>CREATE PROPERTY 
&lt;class&gt;.&lt;property&gt; &lt;type&gt; 
[&lt;link-type&gt;|&lt;link-class&gt;] 
( &lt;property constraint&gt; [, &lt;property-constraint&gt;]* ) 
[UNSAFE]
</code></pre>
<ul>
<li><strong><code>&lt;class&gt;</code></strong> Defines the class for the new property.</li>
<li><strong><code>&lt;property&gt;</code></strong> Defines the logical name for the property.</li>
<li><strong><code>&lt;type&gt;</code></strong> Defines the property data type.  For supported types, see the table below.</li>
<li><strong><code>&lt;link-type&gt;</code></strong> Defines the contained type for container property data types.  For supported link types, see the table below.</li>
<li><strong><code>&lt;link-class&gt;</code></strong> Defines the contained class for container property data types.  For supported link types, see the table below.</li>
<li><strong><code>&lt;property-constraint&gt;</code></strong> See <a href="sql/SQL-Alter-Property.html"><code>ALTER PROPERTY</code></a> <code>&lt;attribute-name&gt; [ &lt;attribute-value&gt; ]</code> (since V2.2.3)</li>
<li><strong><code>UNSAFE</code></strong> Defines whether it checks existing records.  On larger databases, with millions of records, this could take a great deal of time.  Skip the check when you are sure the property is new.  Introduced in version 2.0.</li>
</ul>
<blockquote>
<p>When you create a property, OrientDB checks the data for property and type.  In the event that persistent data contains incompatible values for the specified type, the property creation fails.  It applies no other constraints on the persistent data.</p>
</blockquote>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Create the property <code>name</code> of the string type in the class <code>User</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE PROPERTY User.name STRING</code>
</pre>
</li>
<li>
<p>Create a property formed from a list of strings called <code>tags</code> in the class <code>Profile</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE PROPERTY Profile.tags EMBEDDEDLIST STRING</code>
</pre>
</li>
<li>
<p>Create the property <code>friends</code>, as an embedded map in a circular reference:</p>
<pre>
orientdb> <code class='lang-sql userinput'>CREATE PROPERTY Profile.friends EMBEDDEDMAP Profile</code>
</pre>
</li>
<li>
<p>Create the property <code>name</code> of the string type in the class <code>User</code>, mandatory, with minimum and maximum length (since V2.2.3):</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE PROPERTY User.name STRING (MANDATORY TRUE, MIN 5, MAX 25)  </code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="sql/SQL-Drop-Property.html"><code>DROP PROPERTY</code></a></li>
<li><a href="sql/SQL-Commands.html">SQL Commands</a></li>
<li><a href="sql/../console/Console-Commands.html">Console Commands</a></li>
</ul>
</blockquote>
<h2 id="supported-types"><a class="header" href="#supported-types">Supported Types</a></h2>
<p>OrientDB supports the following data types for standard properties:</p>
<div class="table-wrapper"><table><thead><tr><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody>
<tr><td><code>BOOLEAN</code></td><td><code>SHORT</code></td><td><code>DATE</code></td><td><code>DATETIME</code></td><td><code>BYTE</code></td></tr>
<tr><td><code>INTEGER</code></td><td><code>LONG</code></td><td><code>STRING</code></td><td><code>LINK</code></td><td><code>DECIMAL</code></td></tr>
<tr><td><code>DOUBLE</code></td><td><code>FLOAT</code></td><td><code>BINARY</code></td><td><code>EMBEDDED</code></td><td><code>LINKBAG</code></td></tr>
</tbody></table>
</div>
<p>It supports the following data types for container properties.</p>
<div class="table-wrapper"><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody>
<tr><td><code>EMBEDDEDLIST</code></td><td><code>EMBEDDEDSET</code></td><td><code>EMBEDDEDMAP</code></td></tr>
<tr><td><code>LINKLIST</code></td><td><code>LINKSET</code></td><td><code>LINKMAP</code></td></tr>
</tbody></table>
</div>
<p>For these data types, you can optionally define the contained type and class.  The supported link types are the same as the standard property data types above.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---create-security-policy"><a class="header" href="#sql---create-security-policy">SQL - <code>CREATE SECURITY POLICY</code></a></h1>
<p>Creates a security policy that can be bound to one or more security resources, for one or more roles.</p>
<p>A security resource is a set of SQL predicates, associated to basic operations (eg. CREATE, READ and so on), that are evaluated for each record to determine if the operation is allowed or not.</p>
<p><strong>Syntax</strong></p>
<pre><code>CREATE SECURITY POLICY &lt;name&gt; 
[
  SET
  ( [CREATE | READ | BEFORE UPDATE | AFTER UPDATE | DELETE | EXECUTE] = (&lt;sqlPredicate&gt;) )*
</code></pre>
<ul>
<li><strong><code>&lt;name&gt;</code></strong> The security policy name. It is used in the GRANT statement to bind it to a role and a resource</li>
<li><strong><code>&lt;sqlPredicate&gt;</code></strong> a valid SQL predicate</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Create an empty policy</p>
<pre>
<code class='lang-sql userinput'>CREATE SECURITY POLICY foo</code>
</pre>
</li>
<li>
<p>Create a security policy with all the predicates defined:</p>
<pre>
<code class='lang-sql userinput'>CREATE SECURITY POLICY foo SET CREATE = (name = 'foo'), READ = (TRUE), BEFORE UPDATE = (name = 'foo'), AFTER UPDATE = (name = 'foo'), DELETE = (name = 'foo'), EXECUTE = (name = 'foo')</code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="sql/SQL-Commands.html">SQL Commands</a>.</li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---create-sequence"><a class="header" href="#sql---create-sequence">SQL - <code>CREATE SEQUENCE</code></a></h1>
<p>Creates a new sequence.  Command introduced in version 2.2.</p>
<p><strong>Syntax</strong></p>
<pre><code>CREATE SEQUENCE &lt;sequence&gt; TYPE &lt;CACHED|ORDERED&gt; [START &lt;start&gt;] 
[INCREMENT &lt;increment&gt;] [CACHE &lt;cache&gt;]
</code></pre>
<ul>
<li><strong><code>&lt;sequence&gt;</code></strong> Logical name for the sequence to cache.</li>
<li><strong><code>TYPE</code></strong> Defines the sequence type.  Supported types are,
<ul>
<li><code>CACHED</code> For sequences where it caches N items on each node to improve performance when you require many calls to the <code>.next()</code> method.  (Bear in mind, this may create holes with numeration).</li>
<li><code>ORDERED</code> For sequences where it draws on a new value with each call to the <code>.next()</code> method.</li>
</ul>
</li>
<li><strong><code>START</code></strong> Defines the initial value of the sequence.</li>
<li><strong><code>INCREMENT</code></strong> Defines the increment for each call of the <code>.next()</code> method.</li>
<li><strong><code>CACHE</code></strong> Defines the number of value to pre-cache, in the event that you use the cached sequence type.</li>
<li><strong><code>CYCLE</code></strong> Defines if sequence will restart from <code>START</code> value after <code>LIMIT</code> value reached. Default value is <code>FALSE</code>.</li>
<li><strong><code>LIMIT</code></strong> Defines limit value sequence can reach. After limit value is reached cyclic sequences will restart from START value, while non cyclic sequences will throw message that limit is reached.</li>
<li><strong><code>ASC | DESC</code></strong> Defines order of the sequence. <code>ASC</code> defines that next sequence value will be <code class="lang-sql userinput">currentValue + incrementValue</code>, while <code>DESC</code> defines that next sequence value will be <code class="lang-sql userinput">currentValue - incrementValue</code> (assuming that limit is not reached). Default value is <code>ASC</code>.</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Create a new sequence to handle id numbers:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE SEQUENCE idseq TYPE ORDERED</code>
</pre>
</li>
<li>
<p>Use the new sequence to insert id values</p>
<pre>
orientdb> <code class="lang-sql userinput">INSERT INTO Account SET id = sequence('idseq').next()</code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="sql/SQL-Alter-Sequence.html"><code>ALTER SEQUENCE</code></a></li>
<li><a href="sql/SQL-Drop-Sequence.html">DROP SEQUENCE</a></li>
<li><a href="sql/Sequences-and-auto-increment.html">Sequences and Auto-increment</a></li>
<li><a href="sql/SQL-Commands.html">SQL commands</a>.</li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---create-user"><a class="header" href="#sql---create-user">SQL - <code>CREATE USER </code></a></h1>
<p>Creates a user in the current database, using the specified password and an optional role.  When the role is unspecified, it defaults to <code>writer</code>.</p>
<p>The command was introduced in version 2.2.  It is a simple wrapper around the <code>OUser</code> and <code>ORole</code> classes.  More information is available at <a href="sql/../security/Security.html">Security</a>.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">CREATE USER &lt;user&gt; IDENTIFIED BY &lt;password&gt; [ROLE &lt;role&gt;]
</code></pre>
<ul>
<li><strong><code>&lt;user&gt;</code></strong> Defines the logical name of the user you want to create.</li>
<li><strong><code>&lt;password&gt;</code></strong> Defines the password to use for this user.</li>
<li><strong><code>ROLE</code></strong> Defines the role you want to set for the user.  For multiple roles, use the following syntax: <code>['author', 'writer']</code>.</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Create a new admin user called <code>Foo</code> with the password <code>bar</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE USER Foo IDENTIFIED BY bar ROLE admin</code>
</pre>
</li>
<li>
<p>Create a new user called <code>Bar</code> with the password <code>foo</code>:</p>
<pre>
orientdb> <code class='lang-sql userinput'>CREATE USER Bar IDENTIFIED BY Foo</code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="sql/../security/Security.html">Security</a></li>
<li><a href="sql/SQL-Drop-User.html"><code>DROP USER</code></a></li>
<li><a href="sql/SQL-Commands.html">SQL Commands</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---create-vertex"><a class="header" href="#sql---create-vertex">SQL - <code>CREATE VERTEX</code></a></h1>
<p>Creates a new vertex in the database.</p>
<p>The Vertex and Edge are the main components of a Graph database.  OrientDB supports polymorphism on vertices.  The base class for a vertex is <code>V</code>.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">CREATE VERTEX [&lt;class&gt;] [CLUSTER &lt;cluster&gt;] [SET &lt;field&gt; = &lt;expression&gt;[,]*]
</code></pre>
<ul>
<li><strong><code>&lt;class&gt;</code></strong> Defines the class to which the vertex belongs.</li>
<li><strong><code>&lt;cluster&gt;</code></strong> Defines the cluster in which it stores the vertex.</li>
<li><strong><code>&lt;field&gt;</code></strong> Defines the field you want to set.</li>
<li><strong><code>&lt;expression&gt;</code></strong> Defines the express to set for the field.</li>
</ul>
<p>|----|----|
| <img src="sql/../images/warning.png" alt="NOTE" /> | <strong>NOTE</strong>: When using a distributed database, you can create vertexes through two steps (creation and update).  Doing so can break constraints defined at the class-level for vertices.  To avoid these issues, disable constraints in the vertex class.|</p>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Create a new vertex on the base class <code>V</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE VERTEX</code>
</pre>
</li>
<li>
<p>Create a new vertex class, then create a vertex in that class:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE CLASS V1 EXTENDS V</code>
orientdb> <code class="lang-sql userinput">CREATE VERTEX V1</code>
</pre>
</li>
<li>
<p>Create a new vertex within a particular cluster:</p>
<pre>
orientdb> <code class="userinput lang-sql">CREATE VERTEX V1 CLUSTER recent</code>
</pre>
</li>
<li>
<p>Create a new vertex, defining its properties:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE VERTEX SET brand = 'fiat'</code>
</pre>
</li>
<li>
<p>Create a new vertex of the class <code>V1</code>, defining its properties:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE VERTEX V1 SET brand = 'fiat', name = 'wow'</code>
</pre>
</li>
<li>
<p>Create a vertex using JSON content:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE VERTEX Employee CONTENT { "name" : "Jay", "surname" : "Miner" }</code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="sql/SQL-Create-Edge.html"><code>CREATE EDGE</code></a></li>
<li><a href="sql/SQL-Commands.html">SQL Commands</a></li>
</ul>
</blockquote>
<h2 id="history-3"><a class="header" href="#history-3">History</a></h2>
<h3 id="14-1"><a class="header" href="#14-1">1.4</a></h3>
<ul>
<li>
<p>Command begins using the Blueprints API.  When using Java with the OGraphDatabase API, you may experience unexpected results in how it manages edges.</p>
<p>To force the command to work with the older API, update the GraphDB settings, use the <a href="sql/SQL-Alter-Database.html"><code>ALTER DATABASE</code></a> command.</p>
</li>
</ul>
<h3 id="11-1"><a class="header" href="#11-1">1.1</a></h3>
<ul>
<li>Initial implementation of feature.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---create-view"><a class="header" href="#sql---create-view">SQL - <code>CREATE VIEW</code></a></h1>
<p>Creates a new materialized view in the schema.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">CREATE VIEW &lt;viewName&gt; 
FROM (&lt;query&gt;) 
[ 
   METADATA {
     [updateIntervalSeconds: &lt;number&gt; ],
     [watchClasses: ["className1", "classNameN"] ] 
     [nodes: ["nodeName1", "nodeNameN"] ],
     [indexes: [
        {
           type:"indexType", 
           [engine:"indexEngineName"], 
           properties: {propertyName1:"propertyType1", propertyNameN:"propertyTypeN"}
        }*
      ]
     ]
     [
        updatable: (true | false), 
        originRidField: "fieldName"
     ],
     

   } 
]
</code></pre>
<ul>
<li><strong><code>&lt;viewName&gt;</code></strong>: Defines the name of the view you want to create.  You must use a letter, underscore or dollar for the first character, for all other characters you can use alphanumeric characters, underscores and dollar.</li>
<li><strong><code>&lt;query&gt;</code></strong>: A SQL query whose results will be stored as the view content.</li>
<li><strong><code>updateIntervalSeconds</code></strong>: by default, a view content is updated at fixed intervals, re-executing the query.
You can change this interval, setting this parameter</li>
<li><strong><code>watchClasses</code></strong>: by default, a view is updated at fixed intervals, regardless of the fact that the original data changed or not.
By setting <code>watchClasses</code>, you give OrientDB some information to avoid that the view is updated when there is no need for that: if you
set this parameter, the view is updated only when one or more records in the watched classes are inserted/updated/deleted, otherwise the
view is not refreshed.</li>
<li><strong><code>nodes</code></strong>: in a distributed configuration, by default, the view is deployed on all the nodes. Setting the <code>nodes</code> attributes you can specify
in which nodes you want the view to be populated (in the other nodes the view will still be present, but it will be empty).</li>
<li><strong><code>indexes</code></strong>: you can define one or more indexes on a view, they will be used to optimize queries. <code>type</code> is the index type, eg. "NOTUNIQUE" or
"FULLTEXT"; <code>engine</code> (optional) is the index engine to be used (eg. "LUCENE"); <code>properties</code> is the set of properties (name:type, eg. <code>surname:"STRING"</code>) to be indexed, they have to
be defined in the exact order you want them to appear in the index definition.</li>
<li><strong><code>updatable</code> and <code>originRidField</code></strong>: By default, a view is a read-only object, that means that you cannot manually change its content directly.
You can configure a view to be updatable, so that you can change its content manually (updating records) and the changes are reflected to the original
records. <code>originRidField</code> is a field in the view that will contain the RID of the document that is the origin of a single entry in the view.
Updatable views cannot be created from aggregate queries.</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>create the view <code>Manager</code>: suppose you have a class called Employee, with a boolean property <code>isManager</code> that defines whether the
employee is a manager or not</li>
</ul>
<pre><code class="language-SQL">CREATE VIEW Manager FROM (SELECT FROM Employee WHERE isManager = true)
</code></pre>
<ul>
<li>create a view that is updated only every two hours</li>
</ul>
<pre><code class="language-SQL">CREATE VIEW Manager FROM (SELECT FROM Employee WHERE isManager = true) METADATA {updateIntervalSeconds:2*60*60}
</code></pre>
<ul>
<li>create a view with indexes</li>
</ul>
<pre><code class="language-SQL">CREATE VIEW Manager 
FROM (SELECT name, surname FROM Employee WHERE isManager = true) 
METADATA {
  indexes: [
    {type:"NOTUNIQUE", properties:{name:"STRING", surname:"STRING"}}
  ]
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---delete"><a class="header" href="#sql---delete">SQL - <code>DELETE</code></a></h1>
<p>Removes one or more records from the database.  You can refine the set of records that it removes using the <a href="sql/SQL-Where.html"><code>WHERE</code></a> clause.</p>
<blockquote>
<p><strong>NOTE</strong>: Don't use <a href="sql/SQL-Delete.html"><code>DELETE</code></a> to remove Vertices or Edges. Instead use the <a href="sql/SQL-Delete-Vertex.html"><code>DELETE VERTEX</code></a> or <a href="sql/SQL-Delete-Edge.html"><code>DELETE EDGE</code></a> commands, which ensures the integrity of the graph. If you must carry out a <code>DELETE</code> you can use the <code>UNSAFE</code> keyword to do so. However, if you do, you'll end up with orphaned edge pointers, which you'll have to manually clean up.</p>
</blockquote>
<p><strong>Syntax:</strong></p>
<pre><code class="language-sql">DELETE FROM &lt;Class&gt;|CLUSTER:&lt;cluster&gt;|INDEX:&lt;index&gt; [LOCK &lt;default|record&gt;] [RETURN &lt;returning&gt;]
  [WHERE &lt;Condition&gt;*] [LIMIT &lt;MaxRecords&gt;] [TIMEOUT &lt;timeout&gt;]
</code></pre>
<ul>
<li><strong><code>LOCK</code></strong> Determines how the database locks the record between load and delete.  It takes one of the following values:
<ul>
<li><code>DEFAULT</code> Defines no locks during the delete.  In the case of concurrent deletes, the MVCC throws an exception.</li>
<li><code>RECORD</code> Defines record locks during the delete.</li>
</ul>
</li>
<li><strong><code>RETURN</code></strong> Defines  what values the database returns.  It takes one of the following values:
<ul>
<li><code>COUNT</code> Returns the number of deleted records.  This is the default option.</li>
<li><code>BEFORE</code> Returns the number of records before the removal.</li>
</ul>
</li>
<li><strong><a href="sql/SQL-Where.html"><code>WHERE</code></a></strong> Filters to the records you want to delete.</li>
<li><strong><code>LIMIT</code></strong> Defines the maximum number of records to delete.</li>
<li><strong><code>TIMEOUT</code></strong> Defines the time period to allow the operation to run, before it times out.</li>
<li><strong><code>UNSAFE</code></strong> Allows for the processing of a DELETE on a Vertex or an Edge, without an exception error. It is not recommended to use this! If you must delete an Edge or a Vertex, use the corresponding commands DELETE EDGE or DELETE VERTEX.</li>
</ul>
<p><strong>Examples:</strong></p>
<ul>
<li>
<p>Delete all records with the surname <code>unknown</code>, ignoring case:</p>
<pre>
orientdb> <code class="lang-sql userinput">DELETE FROM Profile WHERE surname.toLowerCase() = 'unknown'</code>
</pre>
</li>
</ul>
<p>For more information, see <a href="sql/SQL-Commands.html">SQL Commands</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---delete-edge"><a class="header" href="#sql---delete-edge">SQL - <code>DELETE EDGE</code></a></h1>
<p>Removes edges from the database.  This is the equivalent of the <a href="sql/SQL-Delete.html"><code>DELETE</code></a> command, with the addition of checking and maintaining consistency with vertices by removing all cross-references to the edge from both the <code>in</code> and <code>out</code> vertex properties.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">DELETE EDGE 
	( &lt;rid&gt;
	  |
	  [&lt;rid&gt; (, &lt;rid&gt;)*]
	  |
	  ( [ FROM (&lt;rid&gt; | &lt;select_statement&gt; ) ] [ TO ( &lt;rid&gt; | &lt;select_statement&gt; ) ] )
	  |
	  [&lt;class&gt;] 
	(
	[WHERE &lt;conditions&gt;]
	[LIMIT &lt;MaxRecords&gt;] 
	[BATCH &lt;batch-size&gt;]
</code></pre>
<ul>
<li><strong><code>FROM</code></strong> Defines the starting point vertex of the edge to delete.</li>
<li><strong><code>TO</code></strong> Defines the ending point vertex of the edge to delete.</li>
<li><strong><a href="sql/SQL-Where.html"><code>WHERE</code></a></strong> Defines the filtering conditions.</li>
<li><strong><code>LIMIT</code></strong> Defines the maximum number of edges to delete.</li>
<li><strong><code>BATCH</code></strong> Defines the block size for the operation, allowing you to break large transactions down into smaller units to reduce resource demands.  Its default is <code>100</code>.  Feature introduced in 2.1.</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Delete an edge by its RID:</p>
<pre>
orientdb> <code class='lang-sql userinput'>DELETE EDGE #22:38482</code>
</pre>
</li>
<li>
<p>Delete edges by RIDs:</p>
<pre>
orientdb> <code class='lang-sql userinput'>DELETE EDGE [#22:38482,#23:232,#33:2332]</code>
</pre>
</li>
<li>
<p>Delete edges where the data is a property that might exist in one or more edges between two vertices:</p>
<pre>
orientdb> <code class='lang-sql userinput'>DELETE EDGE FROM #11:101 TO #11:117 WHERE date >= "2012-01-15"</code>
</pre>
</li>
<li>
<p>Delete edges filtering by the edge class:</p>
<pre>
orientdb> <code class="lang-sql userinput">DELETE EDGE FROM #11:101 TO #11:117 WHERE @class = 'Owns' AND comment 
          LIKE "regex of forbidden words"</code>
</pre>
</li>
<li>
<p>Delete edge filtering by the edge class and date:</p>
<pre>
orientdb> <code class="lang-sql userinput">DELETE EDGE Owns WHERE date < "2011-11"</code>
</pre>
<p>Note that this syntax is faster than filtering the class through the <a href="sql/SQL-Where.html"><code>WHERE</code></a> clause.</p>
</li>
<li>
<p>Delete edges where <code>in.price</code> shows the condition on the <code>to</code> vertex for the edge:</p>
<pre>
orientdb> <code class="lang-sql userinput">DELETE EDGE Owns WHERE date < "2011-11" AND in.price >= 202.43</code>
</pre>
</li>
<li>
<p>Delete edges in blocks of one thousand per transaction.</p>
<pre>
orientdb> <code class='lang-sql userinput'>DELETE EDGE Owns WHERE date < "2011-11" BATCH 1000</code>
</pre>
<p>This feature was introduced in version 2.1.</p>
</li>
<li>
<p>To delete edges from sub-query given a class:</p>
<pre>
orientdb> <code class="lang-sql userinput">DELETE EDGE E WHERE @rid IN (SELECT @rid FROM E)</code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="sql/SQL-Delete.html"><code>DELETE</code></a></li>
<li><a href="sql/SQL-Commands.html">SQL Commands</a></li>
</ul>
</blockquote>
<h2 id="use-cases"><a class="header" href="#use-cases">Use Cases</a></h2>
<h3 id="controlling-vertex-version-increments"><a class="header" href="#controlling-vertex-version-increments">Controlling Vertex Version Increments</a></h3>
<p>Creating and deleting edges causes OrientDB to increment versions on the involved vertices.  You can prevent this operation by implementing the <a href="sql/../internals/RidBag.html">Bonsai Structure</a>.</p>
<p>By default, OrientDB only uses Bonsai as soon as it reaches the threshold, in order to optimize operation.  To always use Bonsai, configure it on the JVM or in the <code>orientdb-server-config.xml</code> configuration file.</p>
<pre>
$ <code class="lang-sh userinput">javac ... -DridBag.embeddedToSbtreeBonsaiThreshold=-1</code>
</pre>
<p>To implement it in Java, add the following line to your application at a point before opening the database:</p>
<pre><code class="language-java">OGlobalConfiguration.RID_BAG_EMBEDDED_TO_SBTREEBONSAI_THRESHOLD.setValue(-1);
</code></pre>
<p>For more information, see <a href="sql/../general/Concurrency.html#concurrency-when-adding-edges">Concurrency on Adding Edges</a>.</p>
<div class="table-wrapper"><table><thead><tr><th><img src="sql/../images/warning.png" alt="NOTE" /></th><th><strong>NOTE</strong>: When using a distributed database, OrientDB does not support SBTree indexes.  In these environments, you must set <code>ridBag.embeddedToSbtreeBonsaiThreshold=Integer.MAX\_VALUE</code> to avoid replication errors._</th></tr></thead><tbody>
</tbody></table>
</div>
<h3 id="deleting-edges-from-a-sub-query"><a class="header" href="#deleting-edges-from-a-sub-query">Deleting Edges from a Sub-query</a></h3>
<p>Consider a situation where you have an edge with a Record ID of <code>#11:0</code> that you want to delete.  In attempting to do so, you run the following query:</p>
<pre>
orientdb> <code class='lang-sql userinput'>DELETE EDGE FROM (SELECT FROM #11:0)</code>
</pre>
<p>This does <strong>not</strong> delete the edge.  To delete edges using sub-queries, you have to use a somewhat different syntax.  For instance,</p>
<pre>
orientdb> <code class="lang-sql userinput">DELETE EDGE E WHERE @rid IN (SELECT FROM #11:0)</code>
</pre>
<p>This removes the edge from your database.</p>
<h3 id="deleting-edges-through-java"><a class="header" href="#deleting-edges-through-java">Deleting Edges through Java</a></h3>
<p>When a <code>User</code> node follows a <code>company</code> node, we create an edge between the user and the company of the type <code>followCompany</code> and <code>CompanyFollowedBy</code> classes.  We can then remove the relevant edges through Java.</p>
<pre><code class="language-java">node1 is User node,
node2 is company node

OGraphDatabase rawGraph = orientGraph.getRawGraph();
String[] arg={"followCompany,"CompanyFollowedBy"};
Set&lt;OIdentifiable&gt; edges=rawGraph.getEdgesBetweenVertexes(node1, node2,null,arg);
for (OIdentifiable oIdentifiable : edges) {
	**rawGraph.removeEdge(oIdentifiable);
}
</code></pre>
<h2 id="history-4"><a class="header" href="#history-4">History</a></h2>
<h2 id="21-1"><a class="header" href="#21-1">2.1</a></h2>
<ul>
<li>Implements support for the option <code>BATCH</code> clause</li>
</ul>
<h2 id="14-2"><a class="header" href="#14-2">1.4</a></h2>
<ul>
<li>Command implements the Blueprints API.  In the event that you are working in Java using the OGraphDatabase API, you may experience some unexpected results in how edges are managed between versions.  To force the command to use the older API, change the GraphDB settings, as described on the [<code>ALTER DATABASE</code>])SQL-Alter-Database.md) command examples.</li>
</ul>
<h2 id="11-2"><a class="header" href="#11-2">1.1</a></h2>
<ul>
<li>First implementation of the feature.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---delete-vertex"><a class="header" href="#sql---delete-vertex">SQL - <code>DELETE VERTEX</code></a></h1>
<p>Removes vertices from the database.  This is the equivalent of the <a href="sql/SQL-Delete.html"><code>DELETE</code></a> command, with the addition of checking and maintaining consistency with edges, removing all cross-references to the deleted vertex in all edges involved.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">DELETE VERTEX &lt;vertex&gt; [WHERE &lt;conditions&gt;] [LIMIT &lt;MaxRecords&gt;&gt;] [BATCH &lt;batch-size&gt;]
</code></pre>
<ul>
<li><strong><code>&lt;vertex&gt;</code></strong> Defines the vertex that you want to remove, using its Class, Record ID, or through a sub-query using the <code>FROM (&lt;sub-query)</code> clause.</li>
<li><strong><a href="sql/SQL-Where.html"><code>WHERE</code></a></strong> Filter condition to determine which records the command removes.</li>
<li><strong><code>LIMIT</code></strong> Defines the maximum number of records to remove.</li>
<li><strong><code>BATCH</code></strong> Defines how many records the command removes at a time, allowing you to break large transactions into smaller blocks to save on memory usage.  By default, it operates on blocks of 100.</li>
</ul>
<p><strong>Example</strong></p>
<ul>
<li>
<p>Remove the vertex and disconnect all vertices that point towards it:</p>
<pre>
orientdb> <code class="lang-sql userinput">DELETE VERTEX #10:231</code>
</pre>
</li>
<li>
<p>Remove all user accounts marked with an incoming edge on the class <code>BadBehaviorInForum</code>:</p>
<pre>
orientdb> <code class='lang-sql userinput'>DELETE VERTEX Account WHERE in.@Class CONTAINS 
          'BadBehaviorInForum'</code>
</pre>
</li>
<li>
<p>Remove all vertices from the class <code>EmailMessages</code> marked with the property <code>isSpam</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">DELETE VERTEX EMailMessage WHERE isSpam = TRUE</code>
</pre>
</li>
<li>
<p>Remove vertices of the class <code>Attachment</code>, where the vertex has an edge of the class <code>HasAttachment</code> where the property <code>date</code> is set before 1990 and the vertex <code>Email</code> connected to class <code>Attachment</code> with the condition that its property <code>from</code> is set to <code>bob@example.com</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">DELETE VERTEX Attachment WHERE in[@Class = 'HasAttachment'].date 
          &lt;= "1990" AND in.out[@Class = "Email"].from = 'some...@example.com'</code>
</pre>
</li>
<li>
<p>Remove vertices in blocks of one thousand:</p>
<pre>
orientdb> <code class="lang-sql userinput">DELETE VERTEX v BATCH 1000</code>
</pre>
<p>This feature was introduced in version 2.1.</p>
</li>
</ul>
<h2 id="quick-deletion-of-an-entire-class"><a class="header" href="#quick-deletion-of-an-entire-class">Quick deletion of an entire class</a></h2>
<p>In the case you want to delete one or more classes of vertices and all the connected edges resides only on particular classes, you could use the <code>TRUNCATE CLASS</code> command against both vertex and edge classes by specifying the <code>UNSAFE</code> keyword. <code>TRUNCATE CLASS</code> is much faster than <code>DELETE VERTEX</code>, because it doesn't take in consideration the removal of the edges. Use <code>TRUNCATE CLASS</code> only when you are certain that there will not be broken edges on other vertices instances. Example of deleting all the instances of vertices classes <code>Email</code> and <code>Attachment</code> and the edge class that connect them <code>HasAttachment</code>:</p>
  <pre>
  orientdb> <code class="lang-sql userinput">TRUNCATE CLASS Email UNSAFE</code>
  orientdb> <code class="lang-sql userinput">TRUNCATE CLASS HasAttachment UNSAFE</code>
  orientdb> <code class="lang-sql userinput">TRUNCATE CLASS Attachment UNSAFE</code>
  </pre>
<h2 id="history-5"><a class="header" href="#history-5">History</a></h2>
<h3 id="version-21"><a class="header" href="#version-21">Version 2.1</a></h3>
<ul>
<li>Introduces the optional <code>BATCH</code> clause for managing batch size on the operation.</li>
</ul>
<h3 id="version-14"><a class="header" href="#version-14">Version 1.4</a></h3>
<ul>
<li>Command begins using the Blueprints API.  When working in Java using the OGraphDatabase API, you may experience differences in how the database manages edges.  To force the command to work with the older API, change the Graph DB settings using <a href="sql/SQL-Alter-Database.html"><code>ALTER DATABASE</code></a>.</li>
</ul>
<h3 id="version-11"><a class="header" href="#version-11">Version 1.1</a></h3>
<ul>
<li>Initial version.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---drop-class"><a class="header" href="#sql---drop-class">SQL - <code>DROP CLASS</code></a></h1>
<p>Removes a class from the schema.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">DROP CLASS &lt;class&gt; [ UNSAFE ]
</code></pre>
<ul>
<li><strong><code>&lt;class&gt;</code></strong> Defines the class you want to remove.</li>
<li><strong><code>UNSAFE</code></strong> Defines whether the command drops non-empty edge and vertex classes.  Note, this can disrupt data consistency.  Be sure to create a backup before running it.</li>
</ul>
<blockquote>
<p><strong>NOTE</strong>: Bear in mind, that the schema must remain coherent.  For instance, avoid removing classes that are super-classes to others.  This operation won't delete the associated cluster.</p>
</blockquote>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Remove the class <code>Account</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">DROP CLASS Account</code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="sql/SQL-Create-Class.html"><code>CREATE CLASS</code></a></li>
<li><a href="sql/SQL-Alter-Class.html"><code>ALTER CLASS</code></a></li>
<li><a href="sql/SQL-Alter-Cluster.html"><code>ALTER CLUSTER</code></a></li>
<li><a href="sql/SQL-Commands.html">SQL Commands</a></li>
<li><a href="sql/../console/Console-Commands.html">Console Commands</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---drop-cluster"><a class="header" href="#sql---drop-cluster">SQL - <code>DROP CLUSTER</code></a></h1>
<p>Removes the cluster and all of its content.  This operation is permanent and cannot be rolled back.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">DROP CLUSTER &lt;cluster-name&gt;|&lt;cluster-id&gt;
</code></pre>
<ul>
<li><strong><code>&lt;cluster-name&gt;</code></strong> Defines the name of the cluster you want to remove.</li>
<li><strong><code>&lt;cluster-id&gt;</code></strong> Defines the ID of the cluster you want to remove.</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Remove the cluster <code>Account</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">DROP CLUSTER Account</code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="sql/SQL-Create-Cluster.html"><code>CREATE CLUSTER</code></a></li>
<li><a href="sql/SQL-Alter-Cluster.html"><code>ALTER CLUSTER</code></a></li>
<li><a href="sql/SQL-Drop-Class.html"><code>DROP CLASS</code></a></li>
<li><a href="sql/SQL-Commands.html">SQL Commands</a></li>
<li><a href="sql/../console/Console-Commands.html">Console Commands</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---drop-index"><a class="header" href="#sql---drop-index">SQL - <code>DROP INDEX</code></a></h1>
<p>Removes an index from a property defined in the schema.</p>
<p>If the index does not exist, this call just returns with no errors.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">DROP INDEX &lt;index&gt;|&lt;class&gt;.&lt;property&gt; [ IF EXISTS ]
</code></pre>
<ul>
<li><strong><code>&lt;index&gt;</code></strong> Defines the name of the index.</li>
<li><strong><code>&lt;class&gt;</code></strong> Defines the class the index uses.</li>
<li><strong><code>&lt;property&gt;</code></strong> Defines the property the index uses.</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Remove the index on the <code>Id</code> property of the <code>Users</code> class:</p>
<pre>
orientdb> <code class="lang-sql userinput">DROP INDEX Users.Id</code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="sql/SQL-Create-Index.html"><code>CREATE INDEX</code></a></li>
<li><a href="sql/../indexing/Indexes.html">Indexes</a></li>
<li><a href="sql/SQL-Commands.html">SQL Commands</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---drop-property"><a class="header" href="#sql---drop-property">SQL - <code>DROP PROPERTY</code></a></h1>
<p>Removes a property from the schema.  Does not remove the property values in the records, it just changes the schema information.  Records continue to have the property values, if any.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">DROP PROPERTY &lt;class&gt;.&lt;property&gt; [FORCE]
</code></pre>
<ul>
<li><strong><code>&lt;class&gt;</code></strong> Defines the class where the property exists.</li>
<li><strong><code>&lt;property&gt;</code></strong> Defines the property you want to remove.</li>
<li><strong>FORCE</strong> In case one or more indexes are defined on the property, the command will throw an exception. Use FORCE to drop indexes together with the property</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Remove the <code>name</code> property from the class <code>User</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">DROP PROPERTY User.name</code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="sql/SQL-Create-Property.html"><code>CREATE PROPERTY</code></a></li>
<li><a href="sql/SQL-Commands.html">SQL Commands</a></li>
<li><a href="sql/../console/Console-Commands.html">Console Commands</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---drop-sequence"><a class="header" href="#sql---drop-sequence">SQL - <code>DROP SEQUENCE</code></a></h1>
<p>Removes a sequence.  This feature was introduced in version 2.2.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">DROP SEQUENCE &lt;sequence&gt;
</code></pre>
<ul>
<li><strong><code>&lt;sequence&gt;</code></strong> Defines the name of the sequence you want to remove.</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Remove the sequence <code>idseq</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">DROP SEQUENCE idseq</code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="sql/SQL-Create-Sequence.html"><code>CREATE SEQUENCE</code></a></li>
<li><a href="sql/SQL-Drop-Sequence.html"><code>DROP SEQUENCE</code></a></li>
<li><a href="sql/Sequences-and-auto-increment.html">Sequences and auto increment</a></li>
<li><a href="sql/SQL-Commands.html">SQL Commands</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---drop-user"><a class="header" href="#sql---drop-user">SQL - <code>DROP USER</code></a></h1>
<p>Removes a user from the current database.  This feature was introduced in version 2.2</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">DROP USER &lt;user&gt;
</code></pre>
<ul>
<li><strong><code>&lt;user&gt;</code></strong> Defines the user you want to remove.</li>
</ul>
<blockquote>
<p><strong>NOTE</strong>: This is a wrapper on the class <code>OUser</code>.  For more information, see <a href="sql/../security/Security.html">Security</a>.</p>
</blockquote>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Remove the user <code>Foo</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">DROP USER Foo</code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information, see,</p>
<ul>
<li><a href="sql/SQL-Create-User.html"><code>CREATE USER</code></a></li>
<li><a href="sql/SQL-Commands.html">SQL commands</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---drop-view"><a class="header" href="#sql---drop-view">SQL - <code>DROP VIEW</code></a></h1>
<p>Removes a view from the schema.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">DROP VIEW &lt;viewName&gt;
</code></pre>
<ul>
<li><strong><code>&lt;viewName&gt;</code></strong> Defines the view you want to remove.</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Remove the class <code>Account</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">DROP VIEW Account</code>
</pre>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---explain"><a class="header" href="#sql---explain">SQL - <code>EXPLAIN</code></a></h1>
<p>EXPLAIN SQL command returns information about query execution planning of a specific statement, without executing the statement itself.</p>
<p><strong>Syntax</strong></p>
<pre><code>EXPLAIN &lt;command&gt;
</code></pre>
<ul>
<li><strong><code>&lt;command&gt;</code></strong> Defines the command that you want to profile, eg. a SELECT statement</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Profile a query that executes on a class filtering based on an attribute:</p>
<pre>
orientdb {db=foo}> <code class='lang-sql userinput'>explain select from v where name = 'a'</code>

Profiled command '[{

executionPlan:{...},

executionPlanAsString:

+ FETCH FROM CLASS v
  + FETCH FROM CLUSTER 9 ASC
  + FETCH FROM CLUSTER 10 ASC
  + FETCH FROM CLUSTER 11 ASC
  + FETCH FROM CLUSTER 12 ASC
  + FETCH FROM CLUSTER 13 ASC
  + FETCH FROM CLUSTER 14 ASC
  + FETCH FROM CLUSTER 15 ASC
  + FETCH FROM CLUSTER 16 ASC
  + FETCH NEW RECORDS FROM CURRENT TRANSACTION SCOPE (if any)
+ FILTER ITEMS WHERE 
  name = 'a'

}]' in 0,022000 sec(s):

</pre>
</li>
</ul>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="sql/SQL-Commands.html">SQL Commands</a></li>
<li><a href="sql/SQL-Profile.html">PROFILE</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---find-references"><a class="header" href="#sql---find-references">SQL - <code>FIND REFERENCES</code></a></h1>
<p>Searches records in the database that contain links to the given Record ID in the database or a subset of the specified class and cluster, returning the matching Record ID's.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">FIND REFERENCES &lt;record-id&gt;|(&lt;sub-query&gt;) [class-list]
</code></pre>
<ul>
<li><strong><code>&lt;record-id&gt;</code></strong> Defines the Record ID you want to find links to in the database.</li>
<li><strong><code>&lt;sub-query&gt;</code></strong> Defines a sub-query for the Record ID's you want to find links to in the database.  This feature was introduced in version 1.0rc9.</li>
<li><strong><code>&lt;class-list&gt;</code></strong> Defines a comma-separated list of classes or clusters that you want to search.</li>
</ul>
<p>This command returns a document containing two fields:</p>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody>
<tr><td><code>rid</code></td><td>Record ID searched.</td></tr>
<tr><td><code>referredBy</code></td><td>Set of Record ID's referenced by the Record ID searched, if any.  In the event that no records reference the searched Record ID, it returns an empty set.</td></tr>
</tbody></table>
</div>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Find records that contain a link to <code>#5:0</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">FIND REFERENCES 5:0</code>

RESULT:
------+-----------------
 rid  | referredBy      
------+-----------------
 #5:0 | [#10:23, #30:4] 
------+-----------------
</pre>
</li>
<li>
<p>Find references to the default cluster record</p>
<pre>
orientdb> <code class='lang-sql userinput'>FIND REFERENCES (SELECT FROM CLUSTER:default)</code>
</pre>
</li>
<li>
<p>Find all records in the classes <code>Profile</code> and <code>AnimalType</code> that contain a link to <code>#5:0</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput"> FIND REFERENCES 5:0 [Profile, AnimalType]</code>
</pre>
</li>
<li>
<p>Find all records in the cluster <code>profile</code> and class <code>AnimalType</code> that contain a link to <code>#5:0</code>:</p>
<pre>
orientdb> <code class='lang-sql userinput'>FIND REFERENCES 5:0 [CLUSTER:profile, AnimalType]</code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="sql/SQL-Commands.html">SQL Commands</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---grant"><a class="header" href="#sql---grant">SQL - <code>GRANT</code></a></h1>
<p>Changes the permission of a role, granting it access to one or more resources.  To remove access to a resource from the role, see the <a href="sql/SQL-Revoke.html"><code>REVOKE</code></a> command.</p>
<p><strong>Syntax</strong></p>
<pre><code>GRANT [ &lt;permission&gt; | POLICY &lt;policyName&gt; ] ON &lt;resource&gt; TO &lt;role&gt;
</code></pre>
<ul>
<li><strong><code>&lt;permission&gt;</code></strong> Defines the permission you want to grant to the role.</li>
<li><strong><code>&lt;policyName&gt;</code></strong> Defines the name of a security policy</li>
<li><strong><code>&lt;resource&gt;</code></strong> Defines the resource on which you want to grant the permissions.</li>
<li><strong><code>&lt;role&gt;</code></strong> Defines the role you want to grant the permissions.</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Grant permission to update any record in the cluster <code>account</code> to the role <code>backoffice</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">GRANT UPDATE ON database.cluster.account TO backoffice</code>
</pre>
</li>
<li>
<p>Bind a security policy called <code>policy1</code> to Person class records, for the role <code>backoffice</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">GRANT POLICY policy1 ON database.class.Person TO backoffice</code>
</pre>  
</li>
</ul>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="sql/SQL-Revoke.html">`REVOKE</a></li>
<li><a href="sql/SQL-Commands.html">SQL Commands</a></li>
</ul>
</blockquote>
<h2 id="supported-permissions"><a class="header" href="#supported-permissions">Supported Permissions</a></h2>
<p>Using this command, you can grant the following permissions to a role.</p>
<div class="table-wrapper"><table><thead><tr><th>Permission</th><th>Description</th></tr></thead><tbody>
<tr><td><code>NONE</code></td><td>Grants no permissions on the resource.</td></tr>
<tr><td><code>CREATE</code></td><td>Grants create permissions on the resource, such as the <a href="sql/SQL-Create-Class.html"><code>CREATE CLASS</code></a> or <a href="sql/SQL-Create-Cluster.html"><code>CREATE CLUSTER</code></a> commands.</td></tr>
<tr><td><code>READ</code></td><td>Grants read permissions on the resource, such as the <a href="sql/SQL-Query.html"><code>SELECT</code></a> query.</td></tr>
<tr><td><code>UPDATE</code></td><td>Grants update permissions on the resource, such as the <a href="sql/SQL-Update.html"><code>UPDATE</code></a> or <a href="sql/SQL-Update.html"><code>UPDATE EDGE</code></a> commands.</td></tr>
<tr><td><code>DELETE</code></td><td>Grants delete permissions on the resource, such as the <a href="sql/SQL-Drop-Index.html"><code>DROP INDEX</code></a> or <a href="sql/SQL-Drop-Sequence.html"><code>DROP SEQUENCE</code></a> commands.</td></tr>
<tr><td><code>ALL</code></td><td>Grants all permissions on the resource.</td></tr>
</tbody></table>
</div>
<h2 id="supported-resources"><a class="header" href="#supported-resources">Supported Resources</a></h2>
<p>Using this command, you can grant permissions on the following resources.</p>
<div class="table-wrapper"><table><thead><tr><th>Resource</th><th>Description</th></tr></thead><tbody>
<tr><td><code>database</code></td><td>Grants access on the current database.</td></tr>
<tr><td><code>database.class.&lt;class&gt;</code></td><td>Grants access on records contained in the indicated class.  Use <code>**</code> to indicate all classes.</td></tr>
<tr><td><code>database.class.&lt;class&gt;.&lt;property&gt;</code></td><td>Grants access on a single property in the indicated class.  Use <code>**</code> to indicate all classes and/or all properties (this is intended only for security policies)</td></tr>
<tr><td><code>database.cluster.&lt;cluster&gt;</code></td><td>Grants access to records contained in the indicated cluster.  Use <code>**</code> to indicate all clusters.</td></tr>
<tr><td><code>database.query</code></td><td>Grants the ability to execute a query, (<code>READ</code> is sufficient).</td></tr>
<tr><td><code>database.command.&lt;command&gt;</code></td><td>Grants the ability to execute the given command.  Use <code>CREATE</code> for <a href="sql/SQL-Insert.html"><code>INSERT</code></a>, <code>READ</code> for <a href="sql/SQL-Query.html"><code>SELECT</code></a>, <code>UPDATE</code> for <a href="sql/SQL-Update.html"><code>UPDATE</code></a> and <code>DELETE</code> for <a href="sql/SQL-Delete.html"><code>DELETE</code></a>.</td></tr>
<tr><td><code>database.config.&lt;permission&gt;</code></td><td>Grants access to the configuration.  Valid permissions are <code>READ</code> and <code>UPDATE</code>.</td></tr>
<tr><td><code>database.hook.record</code></td><td>Grants the ability to set hooks.</td></tr>
<tr><td><code>server.admin</code></td><td>Grants the ability to access server resources.</td></tr>
</tbody></table>
</div>
<p>Policy assignment is supported for records only, so you can assign security policies to <code>class</code> and <code>property</code> resources</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---ha-remove-server"><a class="header" href="#sql---ha-remove-server">SQL - <code>HA REMOVE SERVER</code></a></h1>
<p>(Since v2.2) Removes a server from distributed configuration. It returns <code>true</code> if the server was found, otherwise <code>false</code>.</p>
<p><strong>Syntax</strong></p>
<pre><code>HA REMOVE SERVER &lt;server-name&gt;
</code></pre>
<ul>
<li><strong><code>&lt;server-name&gt;</code></strong> Defines the name of the server to remove.</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Removes the server <code>europe</code> from the distributed configuration:</p>
<pre>
orientdb> <code class='lang-sql userinput'>HA REMOVE SERVER europe</code>
</pre>
</li>
</ul>
<p><strong>Upgrading</strong></p>
<p>Before v2.2, the list of servers running in HA configuration, was updated with the real situation. This could cause consistency problems in case of split brain network, because the two isolated network partitions could agree with a quorum based on the lower number of servers.</p>
<p>Example: if you have 5 servers with a <code>writeQuorum:"majority"</code>, means that if a node is unavailable (crash, network errors, etc.), the quorum is always on base 5, so 4 available nodes are ok. If you've lost also another node, you're still ok, because 3 is still the majority.</p>
<p>With OrientDB v2.2, if 3 nodes of 5 are out, you cannot reach the quorum, so all write operations are forbidden. Why? This is to keep the cluster consistent.</p>
<p>In facts, if you loose 3 servers of 5, it could happen a split brain network, so you have 2 networks with 2 servers and 3 servers. That's why in v2.2 we keep the servers in the distributed configuration, even if they are offline. Without such mechanism, both network would be able to write and as soon as both networks merge into one (the network problem is fixed), you could have tons of conflicts.</p>
<p>The correct way to remove a server from the configuration is running this command. In this way OrientDB HA will remove it from the list and the base for the quorum would not consider it anymore.</p>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="sql/../distributed/Distributed-Architecture.html">Distributed Architecture</a></li>
<li><a href="sql/SQL-Commands.html">SQL Commands</a></li>
<li><a href="sql/../console/Console-Commands.html">Console Commands</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---ha-status"><a class="header" href="#sql---ha-status">SQL - <code>HA STATUS</code></a></h1>
<p>(Since v2.2) Retrieves information about HA.</p>
<p><strong>Syntax</strong></p>
<pre><code>HA STATUS [-servers] [-db] [-latency] [-messages] [-all] [-output=text]
</code></pre>
<ul>
<li><strong><code>-servers</code></strong> Dumps the configuration of servers</li>
<li><strong><code>-db</code></strong> Dumps the configuration of the database</li>
<li><strong><code>-latency</code></strong> Dumps the replication latency between servers (since v2.2.6)</li>
<li><strong><code>-messages</code></strong> Dumps the statistics about replication messages between servers (since v2.2.6)</li>
<li><strong><code>-all</code></strong> Dumps all the information</li>
<li><strong><code>-output=text</code></strong> Write the output as text formatted in readable tables</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Display the configuration of servers</p>
<pre>
orientdb> <code class='lang-sql userinput'>HA STATUS -servers -output=text</code>

Executed '
+--------+------+------------------------+-----+---------+----------------+----------------+-----------------------+
|Name    |Status|Databases               |Conns|StartedOn|Binary          |HTTP            |UsedMemory             |
+--------+------+------------------------+-----+---------+----------------+----------------+-----------------------+
|europe1*|ONLINE|testdb01=ONLINE (MASTER)|0    |16:31:44 |192.168.1.5:2425|192.168.1.5:2481|183.06MB/3.56GB (5.03%)|
+--------+------+------------------------+-----+---------+----------------+----------------+-----------------------+
' in 0.002000 sec(s).
</pre>
</li>
<li>
<p>Display the configuration of the current database</p>
<pre>
orientdb> <code class='lang-sql userinput'>HA STATUS -db -output=text</code>
Executed '
LEGEND: X = Owner, o = Copy
+-----------+-----------+----------+-------+-------+
|           |           |          |MASTER |MASTER |
|           |           |          |ONLINE |ONLINE |
+-----------+-----------+----------+-------+-------+
|CLUSTER    |writeQuorum|readQuorum|europe1|europe0|
+-----------+-----------+----------+-------+-------+
|*          |     2     |    1     |   X   |       |
|data_1     |     2     |    1     |   o   |   X   |
|data_2     |     2     |    1     |   o   |   X   |
|data_3     |     2     |    1     |   o   |   X   |
|data_4     |     2     |    1     |   o   |   X   |
|e_4        |     2     |    1     |   o   |   X   |
|e_5        |     2     |    1     |   o   |   X   |
|e_6        |     2     |    1     |   o   |   X   |
|e_7        |     2     |    1     |   o   |   X   |
|internal   |     2     |    1     |       |       |
|ofunction_0|     2     |    1     |   o   |   X   |
|orole_0    |     2     |    1     |   o   |   X   |
|oschedule_0|     2     |    1     |   o   |   X   |
|osequence_0|     2     |    1     |   o   |   X   |
|ouser_0    |     2     |    1     |   o   |   X   |
|person     |     2     |    1     |   o   |   X   |
|person_1   |     2     |    1     |   o   |   X   |
|person_6   |     2     |    1     |   o   |   X   |
|person_7   |     2     |    1     |   o   |   X   |
|v_3        |     2     |    1     |   o   |   X   |
|v_5        |     2     |    1     |   o   |   X   |
|v_6        |     2     |    1     |   o   |   X   |
|v_7        |     2     |    1     |   o   |   X   |
+-----------+-----------+----------+-------+-------+
' in 0.050000 sec(s).
</pre>
</li>
<li>
<p>Display the replication latency between servers (Since v2.2.6)</p>
<pre>
orientdb> <code class='lang-sql userinput'>HA STATUS -latency -output=text</code>

Executed '
REPLICATION LATENCY AVERAGE (in milliseconds)
+-------+-----+------+-----+
|Servers|node1|node2*|node3|
+-------+-----+------+-----+
|node1  |     |  0.60| 0.43|
|node2* | 0.39|      | 0.38|
|node3  | 0.35|  0.53|     |
+-------+-----+------+-----+  
' in 0.023000 sec(s).
</pre>
</li>
<li>
<p>Display the statistics about replication messages between servers (Since v2.2.6)</p>
<pre>
orientdb> <code class='lang-sql userinput'>HA STATUS -messages -output=text</code>

Executed '
REPLICATION MESSAGE COUNTERS
+-------+------+------+------+
|Servers| node1|node2*| node3|
+-------+------+------+------+
|node1  |      |     9|     5|
|node2* |64,476|      |53,593|
|node3  |     5|     5|      |
+-------+------+------+------+
  
REPLICATION MESSAGE COORDINATOR STATS
+-------+------+---------+------------+---------------+
|Servers|tx    |heartbeat|tx-completed|deploy_delta_db|
+-------+------+---------+------------+---------------+
|node1  |2     |28       |1           |               |
|node3* |56,379|20       |56,379      |2              |
+-------+------+---------+------------+---------------+  
' in 0.005000 sec(s).
</pre>  
</li>
</ul>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="sql/../distributed/Distributed-Architecture.html">Distributed Architecture</a></li>
<li><a href="sql/SQL-Commands.html">SQL Commands</a></li>
<li><a href="sql/../console/Console-Commands.html">Console Commands</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---ha-sync-cluster"><a class="header" href="#sql---ha-sync-cluster">SQL - <code>HA SYNC CLUSTER</code></a></h1>
<p>(Since v2.2) Asks for a re-synchronization of a cluster when running in HA. OrientDB will select the best server to provide the cluster.</p>
<p><strong>Warning:</strong> starting from version 2.2.25, <code>HA SYNC CLUSTER &lt;cluster-name&gt;</code> will trigger an automatic rebuild of the indices defined on the Class the cluster <code>&lt;cluster-name&gt;</code> belongs to. Depending on the number of defined indices and amount of data included in the Class this operation can take some time. Furthermore it is important to wait that the sync cluster operation has finished before performing any database operations that involve that cluster.</p>
<p><strong>Syntax</strong></p>
<pre><code>HA SYNC CLUSTER &lt;cluster-name&gt;
</code></pre>
<ul>
<li><strong><code>&lt;cluster-name&gt;</code></strong> Defines the cluster name to re-synchronize.</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Re-synchronize the cluster <code>profile</code>:</p>
<pre>
orientdb> <code class='lang-sql userinput'>HA SYNC CLUSTER profile</code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="sql/SQL-HA-Sync-Database.html"><code>HA SYNC DATABASE</code></a></li>
<li><a href="sql/../distributed/Distributed-Architecture.html">Distributed Architecture</a></li>
<li><a href="sql/SQL-Commands.html">SQL Commands</a></li>
<li><a href="sql/../console/Console-Commands.html">Console Commands</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---ha-sync-database"><a class="header" href="#sql---ha-sync-database">SQL - <code>HA SYNC DATABASE</code></a></h1>
<p>(Since v2.2) Asks for a re-synchronization of the current database when running in HA. OrientDB will select the best server where to synchronize the database.</p>
<p><strong>Syntax</strong></p>
<pre><code>HA SYNC DATABASE
</code></pre>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Re-synchronize the database:</p>
<pre>
orientdb> <code class='lang-sql userinput'>HA SYNC DATABASE</code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="sql/SQL-HA-Sync-Cluster.html"><code>HA SYNC CLUSTER</code></a></li>
<li><a href="sql/../distributed/Distributed-Architecture.html">Distributed Architecture</a></li>
<li><a href="sql/SQL-Commands.html">SQL Commands</a></li>
<li><a href="sql/../console/Console-Commands.html">Console Commands</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---ha-set"><a class="header" href="#sql---ha-set">SQL - <code>HA SET</code></a></h1>
<p>(Since v2.2.22, Enterprise Edition only). Update the server configuration in High Availability setting.</p>
<p><strong>Syntax</strong></p>
<pre><code>HA SET [DBSTATUS &lt;server&gt;=&lt;status&gt;] [ROLE &lt;server&gt;=MASTER|REPLICA] [OWNER &lt;cluster&gt;=&lt;server&gt;]
</code></pre>
<p>NOTE: <em>the key/value pairs must not contain any space. This is valid <code>HA SET ROLE europe=REPLICA</code>, this is not: <code>HA SET ROLE europe = REPLICA</code></em></p>
<ul>
<li><strong>DBSTATUS</strong> Changes the status of the database. This operation must be executed only if recommended by OrientDB Support Team</li>
<li><strong><code>&lt;server&gt;</code></strong> Server name.</li>
<li><strong><code>&lt;status&gt;</code></strong> The new status to set between <code>[NOT_AVAILABLE, OFFLINE, SYNCHRONIZING, ONLINE, BACKUP]</code>.</li>
<li><strong>ROLE</strong> Changes the role of the server between <code>MASTER</code> and <code>REPLICA</code></li>
<li><strong><code>&lt;server&gt;</code></strong> Server name.</li>
<li><strong>OWNER</strong> Changes cluster's owner</li>
<li><strong><code>&lt;cluster&gt;</code></strong> The name of the cluster to change.</li>
<li><strong><code>&lt;server&gt;</code></strong> Name of the server to become the owner of the cluster. The server name must be already present in the server list for that cluster.</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Change the role of the server <code>europe</code> to be a <code>REPLICA</code> only:</p>
<pre>
orientdb> <code class='lang-sql userinput'>HA SET ROLE europe=REPLICA</code>
</pre>
</li>
<li>
<p>Set the server <code>usa0</code> as the owner of cluster "customer":</p>
<pre>
orientdb> <code class='lang-sql userinput'>HA SET OWNER customer=usa0</code>
</pre>
</li>
<li>
<p>Set the status of database <code>crm</code> to OFFLINE for server <code>china</code>:</p>
<pre>
orientdb> <code class='lang-sql userinput'>HA SET DBSTATUS china=OFFLINE</code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="sql/../distributed/Distributed-Architecture.html">Distributed Architecture</a></li>
<li><a href="sql/SQL-Commands.html">SQL Commands</a></li>
<li><a href="sql/../console/Console-Commands.html">Console Commands</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---insert"><a class="header" href="#sql---insert">SQL - <code>INSERT</code></a></h1>
<p>The <a href="sql/SQL-Insert.html"><code>INSERT</code></a> command creates a new record in the database.  Records can be schema-less or follow rules specified in your model.</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-sql">INSERT INTO [CLASS:]&lt;class&gt;|CLUSTER:&lt;cluster&gt;|INDEX:&lt;index&gt;
  [(&lt;field&gt;[,]*) VALUES (&lt;expression&gt;[,]*)[,]*]|
  [SET &lt;field&gt; = &lt;expression&gt;|&lt;sub-command&gt;[,]*]|
  [CONTENT {&lt;JSON&gt;}]
  [RETURN &lt;expression&gt;] 
  [FROM &lt;query&gt;]
</code></pre>
<ul>
<li><strong><code>CONTENT</code></strong> Defines JSON data as an option to set field values.</li>
<li><strong><code>RETURN</code></strong> Defines an expression to return instead of the number of inserted records.  You can use any valid SQL expression.  The most common use-cases,
<ul>
<li><code>@rid</code> Returns the Record ID of the new record.</li>
<li><code>@this</code> Returns the entire new record.</li>
</ul>
</li>
<li><strong><code>FROM</code></strong> Defines where you want to insert the result-set.  Introduced in version 1.7.</li>
</ul>
<p><strong>Examples</strong>:</p>
<ul>
<li>
<p>Inserts a new record with the name <code>Jay</code> and surname <code>Miner</code>.</p>
<p>As an example, in the SQL-92 standard, such as with a Relational database, you might use:</p>
<pre>
orientdb> <code class="lang-sql userinput">INSERT INTO Profile (name, surname) 
          VALUES ('Jay', 'Miner')</code>
</pre>
<p>Alternatively, in the OrientDB abbreviated syntax, the query would be written as,</p>
<pre>
orientdb> <code class="lang-sql userinput">INSERT INTO Profile SET name = 'Jay', surname = 'Miner'</code>
</pre>
<p>In JSON content syntax, it would be written as this,</p>
<pre>
orientdb> <code class="lang-sql userinput">INSERT INTO Profile CONTENT {"name": "Jay", "surname": "Miner"}</code>
</pre>
</li>
<li>
<p>Insert a new record of the class <code>Profile</code>, but in a different cluster from the default.</p>
<p>In SQL-92 syntax:</p>
<pre>
orientdb> <code class="lang-sql userinput">INSERT INTO Profile CLUSTER profile_recent (name, surname) VALUES 
          ('Jay', 'Miner')</code>
</pre>
<p>Alternative, in the OrientDB abbreviated syntax:</p>
<pre>
orientdb> <code class="lang-sql userinput">INSERT INTO Profile CLUSTER profile_recent SET name = 'Jay', 
          surname = 'Miner'</code>
</pre>
</li>
<li>
<p>Insert several records at the same time:</p>
<pre>
orientdb> <code class="lang-sql userinput">INSERT INTO Profile(name, surname) VALUES ('Jay', 'Miner'), 
          ('Frank', 'Hermier'), ('Emily', 'Sout')</code>
</pre>
</li>
<li>
<p>Insert a new record, adding a relationship.</p>
<p>In SQL-93 syntax:</p>
<pre>
orientdb> <code class="lang-sql userinput">INSERT INTO Employee (name, boss) VALUES ('jack', #11:09)</code>
</pre>
<p>In the OrientDB abbreviated syntax:</p>
<pre>
orientdb> <code class="lang-sql userinput">INSERT INTO Employee SET name = 'jack', boss = #11:99</code>
</pre>
</li>
<li>
<p>Insert a new record, add a collection of relationships.</p>
<p>In SQL-93 syntax:</p>
<pre>
orientdb> <code class="lang-sql userinput">INSERT INTO Profile (name, friends) VALUES ('Luca', [#10:3, #10:4])</code>
</pre>
<p>In the OrientDB abbreviated syntax:</p>
<pre>
orientdb> <code class="lang-sql userinput">INSERT INTO Profiles SET name = 'Luca', friends = [#10:3, #10:4]</code>
</pre>
</li>
<li>
<p>Inserts using <a href="sql/SQL-Query.html"><code>SELECT</code></a> sub-queries</p>
<pre>
orientdb> <code class="lang-sql userinput">INSERT INTO Diver SET name = 'Luca', buddy = (SELECT FROM Diver 
          WHERE name = 'Marko')</code>
</pre>
</li>
<li>
<p>Inserts using <a href="sql/SQL-Insert.html"><code>INSERT</code></a> sub-queries:</p>
<pre>
orientdb> <code class="lang-sql userinput">INSERT INTO Diver SET name = 'Luca', buddy = (INSERT INTO Diver 
          SET name = 'Marko')</code>
</pre>
</li>
<li>
<p>Inserting into a different cluster:</p>
<pre>
orientdb> <code class="lang-sql userinput">INSERT INTO CLUSTER:asiaemployee (name) VALUES ('Matthew')</code>
</pre>
<p>However, note that the document has no assigned class.  To create a document of a certain class, but in a different cluster than the default, instead use:</p>
<pre>
orientdb> <code class="lang-sql userinput">INSERT INTO CLUSTER:asiaemployee (@class, content) VALUES 
          ('Employee', 'Matthew')</code>
</pre>
<p>That inserts the document of the class <code>Employee</code> into the cluster <code>asiaemployee</code>.</p>
</li>
<li>
<p>Insert a new record, adding it as an embedded document:</p>
<pre>
orientdb> <code class="lang-sql userinput">INSERT INTO Profile (name, address) VALUES ('Luca', { "@type": "d", 
          "street": "Melrose Avenue", "@version": 0 })</code>
</pre>
</li>
<li>
<p>Insert from a query.</p>
<p>To copy records from another class, use:</p>
<pre>
orientdb> <code class="lang-sql userinput">INSERT INTO GermanyClient FROM SELECT FROM Client WHERE 
          country = 'Germany'</code>
</pre>
<p>This inserts all the records from the class <code>Client</code> where the country is Germany, in the class <code>GermanyClient</code>.</p>
<p>To copy records from one class into another, while adding a field:</p>
<pre>
orientdb> <code class="lang-sql userinput">INSERT INTO GermanyClient FROM SELECT *, true AS copied FROM Client 
          WHERE country = 'Germany'</code>
</pre>
<p>This inserts all records from the class <code>Client</code> where the country is Germany into the class <code>GermanClient</code>, with the addition field <code>copied</code> to the value <code>true</code>.</p>
</li>
</ul>
<p>For more information on SQL, see <a href="sql/SQL-Commands.html">SQL Commands</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---live-select"><a class="header" href="#sql---live-select">SQL - <code>LIVE SELECT</code></a></h1>
<p>Enables a Live Query.  Your application will receive updates whenever <a href="sql/SQL-Insert.html"><code>INSERT</code></a>, <a href="sql/SQL-Delete.html"><code>DELETE</code></a>, or <a href="sql/SQL-Update.html"><code>UPDATE</code></a> commands are issued against the given records.  This feature was introduced in version 2.1 of OrientDB, but the corresponding Java API was refactored in v 3.0</p>
<blockquote>
<p><strong>NOTE</strong>: Currently, Live Queries are only supported in Java through the <a href="sql/../java/Java-API.html">Java API</a>, and in Node.js through the <a href="sql/../orientjs/OrientJS.html">OrientJS Driver</a>.  It is not currently supported through the Console.  For more general information, see <a href="sql/../java/Live-Query.html">Live Queries</a>.</p>
</blockquote>
<p><strong>Syntax</strong></p>
<pre><code>SELECT FROM &lt;target&gt; WHERE &lt;filters&gt;
</code></pre>
<ul>
<li><strong><code>FROM &lt;target&gt;</code></strong> Designates the object to register for live queries.  THis can be a class, cluster, single Record ID, set of Record ID's, or index values sorted by ascending or descending key order.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---live-unsubscribe"><a class="header" href="#sql---live-unsubscribe">SQL - <code>LIVE UNSUBSCRIBE</code></a></h1>
<p>Disables a Live Query token so that it no longer receives updates from OrientDB.  To enable Live Queries, use <a href="sql/SQL-Live-Select.html"><code>LIVE SELECT</code></a>.  This feature was introduced in version 2.1 of OrientDB.</p>
<blockquote>
<p><strong>NOTE</strong>: Currently, Live Queries are only supported in Java through the <a href="sql/../java/Java-API.html">Java API</a> and in Node.js through the <a href="sql/../orientjs/OrientJS.html">OrientJS Driver</a>.  The commands are not available through the Console.  For more general information, see <a href="sql/../java/Live-Query.html">Live Queries</a>.</p>
</blockquote>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">LIVE UNSUBSCRIBE &lt;token&gt;
</code></pre>
<ul>
<li><strong><code>&lt;token&gt;</code></strong> Unique identifier for the Live Query you want to disable.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---match"><a class="header" href="#sql---match">SQL - <code>MATCH</code></a></h1>
<p>Queries the database in a declarative manner, using pattern matching.  This feature was introduced in version 2.2.</p>
<p><strong>Simplified Syntax</strong></p>
<pre><code>MATCH 
  {
    [class: &lt;class&gt;], 
    [as: &lt;alias&gt;], 
    [where: (&lt;whereCondition&gt;)]
  }
  .&lt;functionName&gt;(){
    [class: &lt;className&gt;], 
    [as: &lt;alias&gt;], 
    [where: (&lt;whereCondition&gt;)], 
    [while: (&lt;whileCondition&gt;)],
    [maxDepth: &lt;number&gt;],    
    [depthAlias: &lt;identifier&gt; ], 
    [pathAlias: &lt;identifier&gt; ],     
    [optional: (true | false)]
  }*
  [,
    [NOT]
    {
      [as: &lt;alias&gt;], 
      [class: &lt;class&gt;], 
      [where: (&lt;whereCondition&gt;)]
    }
    .&lt;functionName&gt;(){
      [class: &lt;className&gt;], 
      [as: &lt;alias&gt;], 
      [where: (&lt;whereCondition&gt;)], 
      [while: (&lt;whileCondition&gt;)],
      [maxDepth: &lt;number&gt;],    
      [depthAlias: &lt;identifier&gt; ], 
      [pathAlias: &lt;identifier&gt; ],     
      [optional: (true | false)]
    }*
  ]*
RETURN [DISTINCT] &lt;expression&gt; [ AS &lt;alias&gt; ] [, &lt;expression&gt; [ AS &lt;alias&gt; ]]*
GROUP BY &lt;expression&gt; [, &lt;expression&gt;]*
ORDER BY &lt;expression&gt; [, &lt;expression&gt;]*
SKIP &lt;number&gt;
LIMIT &lt;number&gt;
</code></pre>
<ul>
<li><strong><code>&lt;class&gt;</code></strong> Defines a valid target class.</li>
<li><strong><code>as: &lt;alias&gt;</code></strong> Defines an alias for a node in the pattern.</li>
<li><strong><code>&lt;whereCondition&gt;</code></strong> Defines a filter condition to match a node in the pattern.  It supports the normal SQL <a href="sql/SQL-Where.html"><code>WHERE</code></a> clause.  You can also use the <code>$currentMatch</code> and <code>$matched</code> <a href="sql/SQL-Match.html#context-variables">context variables</a>.</li>
<li><strong><code>&lt;functionName&gt;</code></strong> Defines a graph function to represent the connection between two nodes.  For instance, <code>out()</code>, <code>in()</code>, <code>outE()</code>, <code>inE()</code>, etc.
For out(), in(), both() also a shortened <em>arrow</em> syntax is supported:
<ul>
<li><code>{...}.out(){...}</code> can be written as <code>{...}--&gt;{...}</code></li>
<li><code>{...}.out("EdgeClass"){...}</code> can be written as <code>{...}-EdgeClass-&gt;{...}</code></li>
<li><code>{...}.in(){...}</code> can be written as <code>{...}&lt;--{...}</code></li>
<li><code>{...}.in("EdgeClass"){...}</code> can be written as <code>{...}&lt;-EdgeClass-{...}</code></li>
<li><code>{...}.both(){...}</code> can be written as <code>{...}--{...}</code></li>
<li><code>{...}.both("EdgeClass"){...}</code> can be written as <code>{...}-EdgeClass-{...}</code></li>
</ul>
</li>
<li><strong><code>&lt;whileCondition&gt;</code></strong> Defines a condition that the statement must meet to allow the traversal of this path.  It supports the normal SQL <a href="sql/SQL-Where.html"><code>WHERE</code></a> clause.  You can also use the <code>$currentMatch</code>, <code>$matched</code> and <code>$depth</code> <a href="sql/SQL-Match.html#context-variables">context variables</a>.  For more information, see <a href="sql/SQL-Match.html#deep-traversal">Deep Traversal While Condition</a>, below.</li>
<li><strong><code>&lt;maxDepth&gt;</code></strong> Defines the maximum depth for this single path.</li>
<li><strong><code>&lt;depthAlias&gt;</code></strong> (since 3.0M3) This is valid only if you have a <code>while</code> or a <code>maxDepth</code>. It defines the alias to be used to store the depth of this traversal. This alias can be used in the <code>RETURN</code> block to retrieve the depth of current traversal.</li>
<li><strong><code>&lt;pathAlias&gt;</code></strong> (since 3.0M3) This is valid only if you have a <code>while</code> or a <code>maxDepth</code>. It defines the alias to be used to store the elements traversed to reach this alias. This alias can be used in the <code>RETURN</code> block to retrieve the elements traversed to reach this alias.</li>
<li><strong><code>RETURN &lt;expression&gt; [ AS &lt;alias&gt; ]</code></strong> Defines elements in the pattern that you want returned.  It can use one of the following:
<ul>
<li>Aliases defined in the <code>as:</code> block.</li>
<li><code>$matches</code> Indicating all defined aliases.</li>
<li><code>$paths</code> Indicating the full traversed paths.</li>
<li><code>$elements</code> (since 2.2.1) Indicating that all the elements that would be returned by the $matches have to be returned flattened, without duplicates.</li>
<li><code>$pathElements</code> (since 2.2.1) Indicating that all the elements that would be returned by the $paths have to be returned flattened, without duplicates.</li>
</ul>
</li>
<li><strong><code>optional</code></strong> (since 2.2.4) if set to true, allows to evaluate and return a pattern even if that particular node does not match the pattern itself (ie. there is no value for that node in the pattern). In current version, optional nodes are allowed only on right terminal nodes, eg. <code>{} --&gt; {optional:true}</code> is allowed, <code>{optional:true} &lt;-- {}</code> is not.</li>
<li><strong><code>NOT</code> patterns</strong> (since 3.0.3 - experimental) Together with normal patterns, you can also define negative patterns. A result will be returned only if it also DOES NOT match any of the negative patterns, ie. if it matches at least one of the negative patterns it won't be returned.</li>
</ul>
<p><strong>Examples</strong></p>
<p>The following examples are based on this sample data-set from the class <code>People</code>:</p>
<p><img src="sql/../images/match-example-table.png" alt="" /></p>
<p><img src="sql/../images/match-example-graph.png" alt="" /></p>
<ul>
<li>
<p>Find all people with the name John:</p>
<pre>
orientdb> <code class="lang-sql userinput">MATCH 
              {class: Person, as: people, where: (name = 'John')} 
          RETURN people</code>

---------
  people 
---------
  #12:0
  #12:1
---------
</pre>
</li>
<li>
<p>Find all people with the name John and the surname Smith:</p>
<pre>
orientdb> <code class="lang-sql userinput">MATCH 
              {class: Person, as: people, where: (name = 'John' AND surname = 'Smith')} 
      RETURN people</code>

-------
people
-------
 #12:1
-------
</pre>
</li>
<li>
<p>Find people named John with their friends:</p>
<pre>
orientdb> <code class="lang-sql userinput">MATCH 
                {class: Person, as: person, where: (name = 'John')}.both('Friend') {as: friend} 
          RETURN person, friend</code>

--------+---------
 person | friend 
--------+---------
 #12:0  | #12:1
 #12:0  | #12:2
 #12:0  | #12:3
 #12:1  | #12:0
 #12:1  | #12:2
--------+---------
</pre>
</li>
<li>
<p>Find friends of friends:</p>
<pre>
orientdb> <code class="lang-sql userinput">MATCH 
                  {class: Person, as: person, where: (name = 'John' AND surname = 'Doe')}
  	    .both('Friend').both('Friend') {as: friendOfFriend} 
  	RETURN person, friendOfFriend</code>

--------+----------------
 person | friendOfFriend 
--------+----------------
 #12:0  | #12:0
 #12:0  | #12:1
 #12:0  | #12:2
 #12:0  | #12:3
 #12:0  | #12:4
--------+----------------
</pre>
</li>
<li>
<p>Find people, excluding the current user:</p>
<pre>
orientdb> <code class="lang-sql userinput">MATCH {class: Person, as: person, where: (name = 'John' AND 
          surname = 'Doe')}.both('Friend').both('Friend'){as: friendOfFriend,
  		where: ($matched.person != $currentMatch)} 
  		RETURN person, friendOfFriend</code>

--------+----------------
 person | friendOfFriend
--------+----------------
 #12:0  | #12:1
 #12:0  | #12:2
 #12:0  | #12:3
 #12:0  | #12:4
--------+----------------
</pre>
</li>
<li>
<p>Find friends of friends to the sixth degree of separation:</p>
<pre>
orientdb> <code class="lang-sql userinput">MATCH {class: Person, as: person, where: (name = 'John' AND 
          surname = 'Doe')}.both('Friend'){as: friend, 
  		where: ($matched.person != $currentMatch) while: ($depth < 6)} 
  		RETURN person, friend</code>

--------+---------
 person | friend
--------+---------
 #12:0  | #12:0
 #12:0  | #12:1
 #12:0  | #12:2
 #12:0  | #12:3
 #12:0  | #12:4
--------+---------
</pre>
</li>
<li>
<p>Finding friends of friends to six degrees of separation, since a particular date:</p>
<pre>
orientdb> <code class="lang-sql userinput">MATCH {class: Person, as: person, 
          where: (name = 'John')}.(bothE('Friend'){
  		where: (date < ?)}.bothV()){as: friend, 
  		while: ($depth < 6)} RETURN person, friend</code>
</pre>
<p>In this case, the condition <code>$depth &lt; 6</code> refers to traversing the block <code>bothE('Friend')</code> six times.</p>
</li>
<li>
<p>Find friends of my friends who are also my friends, using multiple paths:</p>
<pre>
orientdb> <code class="lang-sql userinput">MATCH {class: Person, as: person, where: (name = 'John' AND 
          surname = 'Doe')}.both('Friend').both('Friend'){as: friend},
  		{ as: person }.both('Friend'){ as: friend } 
  		RETURN person, friend</code>

--------+--------
 person | friend
--------+--------
 #12:0  | #12:1
 #12:0  | #12:2
--------+--------
</pre>
<p>In this case, the statement matches two expression: the first to friends of friends, the second to direct friends.  Each expression shares the common aliases (<code>person</code> and <code>friend</code>). To match the whole statement, the result must match both expressions, where the alias values for the first expression are the same as that of the second.</p>
</li>
<li>
<p>Find common friends of John and Jenny:</p>
<pre>
orientdb> <code class="lang-sql userinput">MATCH {class: Person, where: (name = 'John' AND 
          surname = 'Doe')}.both('Friend'){as: friend}.both('Friend')
  		{class: Person, where: (name = 'Jenny')} RETURN friend</code>

--------
 friend
--------
 #12:1
--------
</pre>
<p>The same, with two match expressions:</p>
<pre>
orientdb> <code class="lang-sql userinput">MATCH {class: Person, where: (name = 'John' AND 
          surname = 'Doe')}.both('Friend'){as: friend}, 
  		{class: Person, where: (name = 'Jenny')}.both('Friend')
  		{as: friend} RETURN friend</code>
</pre>
</li>
</ul>
<h2 id="distinct-1"><a class="header" href="#distinct-1">DISTINCT</a></h2>
<p>In v 3.0 the MATCH statement returns all the occurrences of a pattern, even if they are duplicated. To have unique, distinct records
as a result, you have to specify the DISTINCT keyword in the RETURN statement.</p>
<p>Example: suppose you have a dataset made like following:</p>
<p>INSERT INTO V SET name = 'John', surname = 'Smith';
INSERT INTO V SET name = 'John', surname = 'Harris'
INSERT INTO V SET name = 'Jenny', surname = 'Rose'</p>
<p>This is the result of the query without a DISTINCT clause:</p>
  <pre>
  orientdb> <code class="lang-sql userinput">MATCH {class: Person, as:p} RETURN p.name as name</code>

  --------
   name
  --------
   John
  --------
   John
  --------
   Jenny
  --------
  </pre>
<p>And this is the result of the query with a DISTINCT clause:</p>
  <pre>
  orientdb> <code class="lang-sql userinput">MATCH {class: Person, as:p} RETURN DISTINCT p.name as name</code>

  --------
   name
  --------
   John
  --------
   Jenny
  --------
  </pre>
<blockquote>
<p>IMPORTANT: in V 2.2 it was not possible to specify DISTINCT keyword in the RETURN block and the DISTINCT was implicit.</p>
</blockquote>
<blockquote>
<p>IMPORTANT: in V 3.0, using the <strong>legacy Java API</strong>, the behavior will be the same as in v 2.2</p>
</blockquote>
<h2 id="context-variables"><a class="header" href="#context-variables">Context Variables</a></h2>
<p>When running these queries, you can use any of the following context variables:</p>
<div class="table-wrapper"><table><thead><tr><th>Variable</th><th>Description</th></tr></thead><tbody>
<tr><td><code>$matched</code></td><td>Gives the current matched record.  You must explicitly define the attributes for this record in order to access them.  You can use this in the <code>where:</code> and <code>while:</code> conditions to refer to current partial matches or as part of the <code>RETURN</code> value.</td></tr>
<tr><td><code>$currentMatch</code></td><td>Gives the current complete node during the match.</td></tr>
<tr><td><code>$depth</code></td><td>Gives the traversal depth, following a single path item where a <code>while:</code> condition is defined.</td></tr>
</tbody></table>
</div>
<h2 id="use-cases-1"><a class="header" href="#use-cases-1">Use Cases</a></h2>
<h3 id="expanding-attributes"><a class="header" href="#expanding-attributes">Expanding Attributes</a></h3>
<p>You can run this statement as a sub-query inside of another statement.  Doing this allows you to obtain details and aggregate data from the inner <a href="sql/SQL-Query.html"><code>SELECT</code></a> query.</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT person.name AS name, person.surname AS surname,
          friend.name AS friendName, friend.surname AS friendSurname
		  FROM (MATCH {class: Person, as: person,
		  where: (name = 'John')}.both('Friend'){as: friend}
		  RETURN person, friend)</code>

--------+----------+------------+---------------
 name   | surname  | friendName | friendSurname
--------+----------+------------+---------------
 John   | Doe      | John       | Smith
 John   | Doe      | Jenny      | Smith
 John   | Doe      | Frank      | Bean
 John   | Smith    | John       | Doe
 John   | Smith    | Jenny      | Smith
--------+----------+------------+---------------
</pre>
<p>As an alternative, you can use the following:</p>
<pre>
orientdb> <code class="lang-sql userinput">MATCH {class: Person, as: person,
		  where: (name = 'John')}.both('Friend'){as: friend}
		  RETURN 
		  person.name as name, person.surname as surname, 
		  friend.name as friendName, friend.surname as friendSurname</code>

--------+----------+------------+---------------
 name   | surname  | friendName | friendSurname
--------+----------+------------+---------------
 John   | Doe      | John       | Smith
 John   | Doe      | Jenny      | Smith
 John   | Doe      | Frank      | Bean
 John   | Smith    | John       | Doe
 John   | Smith    | Jenny      | Smith
--------+----------+------------+---------------
</pre>
<h3 id="incomplete-hierarchy"><a class="header" href="#incomplete-hierarchy">Incomplete Hierarchy</a></h3>
<p>Consider building a database for a company that shows a hierarchy of departments within the company.  For instance,</p>
<pre><code>           [manager] department        
          (employees in department)    
                                       
                                       
                [m0]0                   
                 (e1)                  
                 /   \                 
                /     \                
               /       \               
           [m1]1        [m2]2
          (e2, e3)     (e4, e5)        
             / \         / \           
            3   4       5   6          
          (e6) (e7)   (e8)  (e9)       
          /  \                         
      [m3]7    8                       
      (e10)   (e11)                    
       /                               
      9                                
  (e12, e13)                         
</code></pre>
<p>This loosely shows that,</p>
<ul>
<li>Department <code>0</code> is the company itself, manager 0 (<code>m0</code>) is the CEO</li>
<li><code>e10</code> works at department <code>7</code>, his manager is <code>m3</code></li>
<li><code>e12</code> works at department <code>9</code>, this department has no direct manager, so <code>e12</code>'s manager is <code>m3</code> (the upper manager)</li>
</ul>
<p>In this case, you would use the following query to find out who's the manager to a particular employee:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT EXPAND(manager) FROM (MATCH {class:Employee, 
          where: (name = ?)}.out('WorksAt').out('ParentDepartment')
		  {while: (out('Manager').size() == 0), 
		  where: (out('Manager').size() > 0)}.out('Manager')
		  {as: manager} RETURN manager)</code>
</pre>
<h3 id="deep-traversal"><a class="header" href="#deep-traversal">Deep Traversal</a></h3>
<p>Match path items act in a different manners, depending on whether or not you use <code>while:</code> conditions in the statement.</p>
<p>For instance, consider the following graph:</p>
<pre><code>[name='a'] -FriendOf-&gt; [name='b'] -FriendOf-&gt; [name='c']
</code></pre>
<p>Running the following statement on this graph only returns <code>b</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">MATCH {class: Person, where: (name = 'a')}.out("FriendOf")
          {as: friend} RETURN friend</code>

--------
 friend 
--------
 b
--------
</pre>
<p>What this means is that it traverses the path item <code>out("FriendOf")</code> exactly once.  It only returns the result of that traversal.</p>
<p>If you add a <code>while</code> condition:</p>
<pre>
orientdb> <code class="lang-sql userinput">MATCH {class: Person, where: (name = 'a')}.out("FriendOf")
          {as: friend, while: ($depth < 2)} RETURN friend</code>

---------
 friend 
---------
 a
 b
---------
</pre>
<p>Including a <code>while:</code> condition on the match path item causes OrientDB to evaluate this item as zero to <em>n</em> times.  That means that it returns the starting node, (<code>a</code>, in this case), as the result of zero traversal.</p>
<p>To exclude the starting point, you need to add a <code>where:</code> condition, such as:</p>
<pre>
orientdb> <code class="lang-sql userinput">MATCH {class: Person, where: (name = 'a')}.out("FriendOf")
          {as: friend, while: ($depth < 2) where: ($depth > 0)} 
		  RETURN friend</code>
</pre>
<p>As a general rule,</p>
<ul>
<li><strong><code>while</code> Conditions:</strong> Define this if it must execute the next traversal, (it evaluates at level zero, on the origin node).</li>
<li><strong><code>where</code> Condition:</strong> Define this if the current element, (the origin node at the zero iteration the right node on the iteration is greater than zero), must be returned as a result of the traversal.</li>
</ul>
<p>For instance, suppose that you have a genealogical tree.  In the tree, you want to show a person, grandparent and the grandparent of that grandparent, and so on.  The result: saying that the person is at level zero, parents at level one, grandparents at level two, etc., you would see all ancestors on even levels.  That is, <code>level % 2 == 0</code>.</p>
<p>To get this, you might use the following query:</p>
<pre>
orientdb> <code class="lang-sql userinput">MATCH {class: Person, where: (name = 'a')}.out("Parent")
          {as: ancestor, while: (true) where: ($depth % 2 = 0)} 
		  RETURN ancestor</code>
</pre>
<h2 id="best-practices"><a class="header" href="#best-practices">Best practices</a></h2>
<p>Queries can involve multiple operations, based on the domain model and use case.  In some cases, like projection and aggregation, you can easily manage them with a <a href="sql/SQL-Query.html"><code>SELECT</code></a> query.  With others, such as pattern matching and deep traversal, <a href="sql/SQL-Match.html"><code>MATCH</code></a> statements are more appropriate.</p>
<p>Use <a href="sql/SQL-Query.html"><code>SELECT</code></a> and <a href="sql/SQL-Match.html"><code>MATCH</code></a> statements together (that is, through sub-queries), to give each statement the correct responsibilities.  Here,</p>
<h3 id="filtering-record-attributes-for-a-single-class"><a class="header" href="#filtering-record-attributes-for-a-single-class">Filtering Record Attributes for a Single Class</a></h3>
<p>Filtering based on record attributes for a single class is a trivial operation through both statements.  That is, finding all people named John can be written as:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM Person WHERE name = 'John'</code>
</pre>
<p>You can also write it as,</p>
<pre>
orientdb> <code class="lang-sql userinput">MATCH {class: Person, as: person, where: (name = 'John')} 
          RETURN person</code>
</pre>
<p>The efficiency remains the same.  Both queries use an index.  With <a href="sql/SQL-Query.html"><code>SELECT</code></a>, you obtain expanded records, while with <a href="sql/SQL-Match.html"><code>MATCH</code></a>, you only obtain the Record ID's.</p>
<h3 id="filtering-on-record-attributes-of-connected-elements"><a class="header" href="#filtering-on-record-attributes-of-connected-elements">Filtering on Record Attributes of Connected Elements</a></h3>
<p>Filtering based on the record attributes of connected elements, such as neighboring vertices, can grow trick when using <a href="sql/SQL-Query.html"><code>SELECT</code></a>, while with <a href="sql/SQL-Match.html"><code>MATCH</code></a> it is simple.</p>
<p>For instance, find all people living in Rome that have a friend called John.  There are three different ways you can write this,  using <a href="sql/SQL-Query.html"><code>SELECT</code></a>:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM Person WHERE BOTH('Friend').name CONTAINS 'John'
          AND out('LivesIn').name CONTAINS 'Rome'</code>

orientdb> <code class="lang-sql userinput">SELECT FROM (SELECT BOTH('Friend') FROM Person WHERE name
          'John') WHERE out('LivesIn').name CONTAINS 'Rome'</code>

orientdb> <code class="lang-sql userinput">SELECT FROM (SELECT in('LivesIn') FROM City WHERE name = 'Rome')
          WHERE BOTH('Friend').name CONTAINS 'John'</code>
</pre>
<p>In the first version, the query is more readable, but it does not use indexes, so it is less optimal in terms of execution time.  The second and third use indexes if they exist, (on <code>Person.name</code> or <code>City.name</code>, both in the sub-query), but they're harder to read.  Which index they use depends only on the way you write the query.  That is, if you only have an index on <code>City.name</code> and not <code>Person.name</code>, the second version doesn't use an index.</p>
<p>Using a <a href="sql/SQL-Match.html"><code>MATCH</code></a> statement, the query becomes:</p>
<pre>
orientdb> <code class="lang-sql userinput">MATCH {class: Person, where: (name = 'John')}.both("Friend")
          {as: result}.out('LivesIn'){class: City, where: (name = 'Rome')}
		  RETURN result</code>
</pre>
<p>Here, the query executor optimizes the query for you, choosing indexes where they exist.  Moreover, the query becomes more readable, especially in complex cases, such as multiple nested <a href="sql/SQL-Query.html"><code>SELECT</code></a> queries.</p>
<h3 id="traverse-alternative"><a class="header" href="#traverse-alternative"><code>TRAVERSE</code> Alternative</a></h3>
<p>There are similar limitations to using <a href="sql/SQL-Traverse.html"><code>TRAVERSE</code></a>.  You may benefit from using <a href="sql/SQL-Match.html"><code>MATCH</code></a> as an alternative.</p>
<p>For instance, consider a simple <a href="sql/SQL-Traverse.html"><code>TRAVERSE</code></a> statement, like:</p>
<pre>
orientdb> <code class="lang-sql userinput">TRAVERSE out('Friend') FROM (SELECT FROM Person WHERE name = 'John') 
          WHILE $depth < 3</code>
</pre>
<p>Using a <a href="sql/SQL-Match.html"><code>MATCH</code></a> statement, you can write the same query as:</p>
<pre>
orientdb> <code class="lang-sql userinput">MATCH {class: Person, where: (name = 'John')}.both("Friend")
          {as: friend, while: ($depth < 3)} RETURN friend</code>
</pre>
<p>Consider a case where you have a <code>since</code> date property on the edge <code>Friend</code>.  You want to traverse the relationship only for edges where the <code>since</code> value is greater than a given date.  In a <a href="sql/SQL-Traverse.html"><code>TRAVERSE</code></a> statement, you might write the query as:</p>
<pre>
orientdb> <code class="lang-sql userinput">TRAVERSE bothE('Friend')[since > date('2012-07-02', 'yyyy-MM-dd')].bothV()
          FROM (SELECT FROM Person WHERE name = 'John') WHILE $depth < 3</code>
</pre>
<p>Unfortunately, this statement DOESN'T WORK in the current release.  However, you can get the results you want using a <a href="sql/SQL-Match.html"><code>MATCH</code></a> statement:</p>
<pre>
orientdb> <code class="lang-sql userinput">MATCH {class: Person, where: (name = 'John')}.(bothE("Friend")
          {where: (since > date('2012-07-02', 'yyyy-MM-dd'))}.bothV())
		  {as: friend, while: ($depth < 3)} RETURN friend</code>
</pre>
<h3 id="projections-and-grouping-operations"><a class="header" href="#projections-and-grouping-operations">Projections and Grouping Operations</a></h3>
<p>Projections and grouping operations are better expressed with a <a href="sql/SQL-Query.html"><code>SELECT</code></a> query.  If you need to filter and do projection or aggregation in the same query, you can use <a href="sql/SQL-Query.html"><code>SELECT</code></a> and <a href="sql/SQL-Match.html"><code>MATCH</code></a> in the same statement.</p>
<p>This is particular important when you expect a result that contains attributes from different connected records (cartesian product).  For instance, to retrieve names, their friends and the date since they became friends:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT person.name AS name, friendship.since AS since, friend.name 
          AS friend FROM (MATCH {class: Person, as: person}.bothE('Friend')
		  {as: friendship}.bothV(){as: friend, 
		  where: ($matched.person != $currentMatch)} 
		  RETURN person, friendship, friend)</code>
</pre>
<p>The same can be also achieved with the MATCH only:</p>
<pre>
orientdb> <code class="lang-sql userinput">MATCH {class: Person, as: person}.bothE('Friend')
		  {as: friendship}.bothV(){as: friend, 
		  where: ($matched.person != $currentMatch)} 
		  RETURN person.name as name, friendship.since as since, friend.name as friend</code>
</pre>
<h3 id="return-expressions"><a class="header" href="#return-expressions">RETURN expressions</a></h3>
<p>In the RETURN section you can use:</p>
<p><strong>multiple expressions</strong>, with or without an alias (if no alias is defined, OrientDB will generate a default alias for you), comma separated</p>
<pre><code>MATCH 
  {class: Person, as: person}
  .bothE('Friend'){as: friendship}
  .bothV(){as: friend, where: ($matched.person != $currentMatch)} 
RETURN person, friendship, friend

result: 

| person | friendship | friend |
--------------------------------
| #12:0  | #13:0      | #12:2  |
| #12:0  | #13:1      | #12:3  |
| #12:1  | #13:2      | #12:3  |
</code></pre>
<pre><code>MATCH 
  {class: Person, as: person}
  .bothE('Friend'){as: friendship}
  .bothV(){as: friend, where: ($matched.person != $currentMatch)} 
RETURN person.name as name, friendship.since as since, friend.name as friend

result: 

| name | since | friend |
-------------------------
| John | 2015  | Frank  |
| John | 2015  | Jenny  |
| Joe  | 2016  | Jenny  |

</code></pre>
<pre><code>MATCH 
  {class: Person, as: person}
  .bothE('Friend'){as: friendship}
  .bothV(){as: friend, where: ($matched.person != $currentMatch)} 
RETURN person.name + " is a friend of " + friend.name as friends

result: 

| friends                    |
------------------------------
| John is a friend of Frank  |
| John is a friend of Jenny  |
| Joe is a friend of Jenny   |

</code></pre>
<p><strong>$matches</strong>, to return all the patterns that match current statement. Each row in the result set will be a single pattern, containing only nodes in the statement that have an <code>as:</code> defined</p>
<pre><code>MATCH 
  {class: Person, as: person}
  .bothE('Friend'){}                                                  // no 'as:friendship' in this case
  .bothV(){as: friend, where: ($matched.person != $currentMatch)} 
RETURN $matches

result: 

| person |  friend | 
--------------------
| #12:0  |  #12:2  |
| #12:0  |  #12:3  |
| #12:1  |  #12:3  |

</code></pre>
<p><strong>$paths</strong>, to return all the patterns that match current statement. Each row in the result set will be a single pattern, containing all th nodes in the statement. For nodes that have an <code>as:</code>, the alias will be returned, for the others a default alias is generated (automatically generated aliases start with <code>$ORIENT_DEFAULT_ALIAS_</code>)</p>
<pre><code>MATCH 
  {class: Person, as: person}
  .bothE('Friend'){}                                                  // no 'as:friendship' in this case
  .bothV(){as: friend, where: ($matched.person != $currentMatch)} 
RETURN $paths

result: 

| person | friend | $ORIENT_DEFAULT_ALIAS_0 |
---------------------------------------------
| #12:0  | #12:2  | #13:0                   |
| #12:0  | #12:3  | #13:1                   |
| #12:1  | #12:3  | #13:2                   |
</code></pre>
<p><strong>$elements</strong> (since 2.2.1), the same as <code>$matches</code>, but for each node present in the pattern, a single row is created in the result set (no duplicates)</p>
<pre><code>MATCH 
  {class: Person, as: person}
  .bothE('Friend'){}                                                  // no 'as:friendship' in this case
  .bothV(){as: friend, where: ($matched.person != $currentMatch)} 
RETURN $elements

result: 

| @rid   |  @class | name   |  .....   |
----------------------------------------
| #12:0  |  Person | John   |  .....   |
| #12:1  |  Person | Joe    |  .....   |
| #12:2  |  Person | Frank  |  .....   |
| #12:3  |  Person | Jenny  |  .....   |

</code></pre>
<p><strong>$pathElements</strong> (since 2.2.1), the same as <code>$paths</code>, but for each node present in the pattern, a single row is created in the result set (no duplicates)</p>
<pre><code>MATCH 
  {class: Person, as: person}
  .bothE('Friend'){}                                                  // no 'as:friendship' in this case
  .bothV(){as: friend, where: ($matched.person != $currentMatch)} 
RETURN $pathElements

result: 

| @rid   |  @class | name   | since  |  .....   |
-------------------------------------------------
| #12:0  |  Person | John   |        |  .....   |
| #12:1  |  Person | Joe    |        |  .....   |
| #12:2  |  Person | Frank  |        |  .....   |
| #12:3  |  Person | Jenny  |        |  .....   |
| #13:0  |  Friend |        |  2015  |  .....   |
| #13:1  |  Friend |        |  2015  |  .....   |
| #13:2  |  Friend |        |  2016  |  .....   |

</code></pre>
<p><strong>IMPORTANT</strong>: When using MATCH statement in OrientDB Studio Graph panel you have to use $elements or $pathElements as return type, to let the Graph panel render the matched patterns correctly</p>
<h3 id="arrow-notation"><a class="header" href="#arrow-notation">Arrow notation</a></h3>
<p><code>out()</code>, <code>in()</code> and <code>both()</code> operators can be replaced with arrow notation <code>--&gt;</code>, <code>&lt;--</code> and <code>--</code></p>
<p>Eg. the query</p>
<pre>
<code class="lang-sql userinput">
MATCH {class: V, as: a}.out(){}.out(){}.out(){as:b}
RETURN a, b
</code>
</pre>
<p>can be written as</p>
<pre>
<code class="lang-sql userinput">
MATCH {class: V, as: a} --> {} --> {} --> {as:b}
RETURN a, b
</code>
</pre>
<p>Eg. the query (things that belong to friends)</p>
<pre>
<code class="lang-sql userinput">
MATCH {class: Person, as: a}.out('Friend'){as:friend}.in('BelongsTo'){as:b}
RETURN a, b
</code>
</pre>
<p>can be written as</p>
<pre>
<code class="lang-sql userinput">
MATCH {class: Person, as: a}  -Friend-> {as:friend} <-BelongsTo- {as:b}
RETURN a, b
</code>
</pre>
<p>Using arrow notation the curly braces are mandatory on both sides. eg:</p>
<pre>
<code class="lang-sql userinput">
MATCH {class: Person, as: a} --> {} --> {as:b} RETURN a, b  //is allowed

MATCH {class: Person, as: a} --> --> {as:b} RETURN a, b  //is NOT allowed

MATCH {class: Person, as: a}.out().out(){as:b} RETURN a, b  //is allowed

MATCH {class: Person, as: a}.out(){}.out(){as:b} RETURN a, b  //is allowed
</code>
</pre>
<h3 id="negative-not-patterns"><a class="header" href="#negative-not-patterns">Negative (NOT) patterns</a></h3>
<p>(since 3.0.3 - experimental)</p>
<p>Together with normal patterns, you can also define negative patterns. A result will be returned only if it also DOES NOT match any of the negative patterns, ie. if the result matches at least one of the negative patterns it won't be returned.</p>
<p>As an example, consider the following problem: given a social network, choose a single person and return all the people that are friends of their friends, but that are not their direct friends.</p>
<p>The pattern can be calculated as follows:</p>
<pre>
<code class="lang-sql userinput">
MATCH
  {class:Person, as:a, where:(name = "John")} -FriendOf-> {as:b} -FriendOf-> {as:c},
  NOT {as:a} -FriendOf-> {as:c}
RETURN c.name
</code>
</pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---move-vertex"><a class="header" href="#sql---move-vertex">SQL - <code>MOVE VERTEX</code></a></h1>
<p>Moves one or more vertices into a different class or cluster.</p>
<p>Following the move, the vertices use a different Record ID.  The command updates all edges to use the moved vertices.  When using a distributed database, if you specify a cluster, it moves the vertices to the server owner of the target cluster.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">MOVE VERTEX &lt;source&gt; TO &lt;destination&gt; [SET [&lt;field&gt;=&lt;value&gt;]* [,]] [MERGE &lt;JSON&gt;] 
[BATCH &lt;batch-size&gt;]
</code></pre>
<ul>
<li><strong><code>&lt;source&gt;</code></strong> Defines the vertex you want to move. It supports the following values,
<ul>
<li><em>Vertex</em> Using the Record ID of a single vertex.</li>
<li><em>Array</em> Using an array of record ID's for vertices you want to move.</li>
</ul>
</li>
<li><strong><code>&lt;destination&gt;</code></strong> Defines where you want to move the vertex to.  It supports the following values,
<ul>
<li><em>Class</em> Using <code>CLASS:&lt;class&gt;</code> with the class you want to move the vertex into.</li>
<li><em>Cluster</em> Using <code>CLUSTER:&lt;cluster&gt;</code> with the cluster you want to move the vertex into.</li>
</ul>
</li>
<li><strong><code>SET</code></strong> Clause to set values on fields during the transition.</li>
<li><strong><code>MERGE</code></strong> Clause to set values on fields during the transition, through JSON.</li>
<li><strong><code>BATCH</code></strong> Defines the batch size, allowing you to execute the command in smaller blocks to avoid memory problems when moving a large number of vertices.</li>
</ul>
<div class="table-wrapper"><table><thead><tr><th><img src="sql/../images/warning.png" alt="WARNING" /></th><th><strong>WARNING</strong>: This command updates all connected edges, but not the <a href="sql/../datamodeling/Concepts.html#relationships">links</a>.  When using the Graph API, it is recommend that you always use edges connected to vertices and never links.</th></tr></thead><tbody>
</tbody></table>
</div>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Move a single vertex from its current position to the class <code>Provider</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">MOVE VERTEX #34:232 TO CLASS:Provider</code>
</pre>
</li>
<li>
<p>Move an array of vertices by their record ID's to the class <code>Provider</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">MOVE VERTEX [#34:232,#34:444] TO CLASS:Provider</code>
</pre>
</li>
<li>
<p>Move a set of vertices to the class <code>Provider</code>, defining those you want to move with a subquery:</p>
<pre>
orientdb> <code class="lang-sql userinput">MOVE VERTEX (SELECT FROM V WHERE city = 'Rome') TO CLASS:Provider</code>
</pre>
</li>
<li>
<p>Move a vertex from its current position to the European cluster</p>
<pre>
orientdb> <code class="lang-sql userinput">MOVE VERTEX #3:33 TO CLUSTER:providers_europe</code>
</pre>
<p>You may find this useful when using a <a href="sql/../distributed/Distributed-Architecture.html">distributed database</a>, where you can move vertices onto different servers.</p>
</li>
<li>
<p>Move a set of vertices to the class <code>Provider</code>, while doing so update the property <code>movedOn</code> to the current date:</p>
<pre>
orientdb> <code class="lang-sql userinput">MOVE VERTEX (SELECT FROM V WHERE type = 'provider') TO CLASS:Provider 
          SET movedOn = Date()</code>
</pre>
<p>Note the similarities this syntax has with the <a href="sql/SQL-Update.html"><code>UPDATE</code></a> command.</p>
</li>
<li>
<p>Move the vertex using a subquery, using JSON update the properties during the transition:</p>
<pre>
orientdb> <code class="lang-sql userinput>MOVE VERTEX (SELECT FROM V WHERE type = 'provider') TO CLASS:Provider 
          MERGE { author : 'Jay Miner' }</code>
</pre>
</li>
<li>
<p>Move a large number of vertices by subquery in batches of fifty:</p>
<pre>
orientdb> <code class="lang-sql userinput">MOVE VERTEX (SELECT FROM User) TO CLUSTER:users_europe BATCH 50</code>
</pre>
</li>
<li>
<p>Move the same vertices as above using only one transaction:</p>
<pre>
orientdb> <code class="lang-sql userinput">MOVE VERTEX (SELECT FROM User) TO CLUSTER:users_europe BATCH -1</code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="sql/SQL-Create-Vertex.html"><code>CREATE VERTEX</code></a></li>
<li><a href="sql/SQL-Create-Edge.html"><code>CREATE EDGE</code></a></li>
<li><a href="sql/SQL-Commands.html">SQL Commands</a></li>
</ul>
</blockquote>
<h2 id="use-cases-2"><a class="header" href="#use-cases-2">Use Cases</a></h2>
<h3 id="refactoring-graphs-through-sub-types"><a class="header" href="#refactoring-graphs-through-sub-types">Refactoring Graphs through Sub-types</a></h3>
<p>It's a very common situation where you begin modeling your domain one way, but find later that you need more flexibility.</p>
<p>For instance, say that you start out with a vertex class called <code>Person</code>.  After using the database for several months, populating it with new vertices, you decide that you need to split these vertices into two new classes, or sub-types, called <code>Customer</code> and <code>Provider</code>, (rendering <code>Person</code> into an abstract class).</p>
<ul>
<li>
<p>Create the new classes for your sub-types:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE CLASS Customer EXTENDS Person</code>
orientdb> <code class="lang-sql userinput">CREATE CLASS Provider EXTENDS Person</code>
</pre>
</li>
<li>
<p>Move the providers and customers from <code>Person</code> into their respective sub-types:</p>
<pre>
orientdb> <code class="lang-sql userinput">MOVE VERTEX (SELECT FROM Person WHERE type = 'Customer') TO 
          CLASS:Customer</code>
orientdb> <code class="lang-sql userinput">MOVE VERTEX (SELECT FROM Person WHERE type = 'Provider') TO 
          CLASS:Provider</code>
</pre>
</li>
<li>
<p>Make the class <code>Person</code> an abstract class:</p>
<pre>
orientdb> <code class="lang-sql userinput">ALTER CLASS Person ABSTRACT TRUE</code>
</pre>
</li>
</ul>
<h3 id="moving-vertices-onto-different-servers"><a class="header" href="#moving-vertices-onto-different-servers">Moving Vertices onto Different Servers</a></h3>
<p>With OrientDB, you can scale your infrastructure up by adding new servers.  When you add a new server, OrientDB automatically creates a new cluster with the name of the class plus the node name.  For instance, <code>customer_europe</code>.</p>
<p>The best practice when you need to scale up is partitioning, especially on writes.  If you have a graph with <code>Customer</code> vertices and you want to move some of these onto a different server, you can move them to the cluster owned by the server.</p>
<p>For instance, move all customers that live in Italy, Germany or the United Kingdom onto the cluster <code>customer_europe</code>, which is assigned to the node <code>Europe</code>.  This means that access to European customers is faster with applications connected to the European node.</p>
<pre>
orientdb> <code class="lang-sql userinput">MOVE VERTEX (SELECT FROM Customer WHERE ['Italy', 'Germany', 'UK'] IN 
          out('city').out('country') ) TO CLUSTER:customer_europe</code>
</pre>
<h2 id="history-6"><a class="header" href="#history-6">History</a></h2>
<h3 id="20-1"><a class="header" href="#20-1">2.0</a></h3>
<ul>
<li>Initial implementation of the feature.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---optimize-database"><a class="header" href="#sql---optimize-database">SQL - <code>OPTIMIZE DATABASE</code></a></h1>
<p>Optimizes the database for particular operations.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">OPTIMIZE DATABASE [-lwedges] [-noverbose]
</code></pre>
<ul>
<li><strong><code>-lwedges</code></strong> Converts regular edges into Lightweight Edges.</li>
<li><strong><code>-noverbose</code></strong> Disables output.</li>
</ul>
<blockquote>
<p>Currently, this command only supports optimization for <a href="sql/../java/Lightweight-Edges.html">Lightweight Edges</a>.  Additional optimization options are planned for future releases of OrientDB.</p>
</blockquote>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Convert regular edges into Lightweight Edges:</p>
<pre>
orientdb> <code class="lang-sql userinput">OPTIMIZE DATABASE -lwedges</code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="sql/../java/Lightweight-Edges.html">Lightweight Edges</a></li>
<li><a href="sql/SQL-Commands.html">SQL Commands</a></li>
<li><a href="sql/../console/Console-Commands.html">Console Commands</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---profile"><a class="header" href="#sql---profile">SQL - <code>PROFILE</code></a></h1>
<p>PROFILE SQL command returns information about query execution planning and statistics for a specific statement.
The statement is actually executed to provide the execution stats.</p>
<p>The result is the execution plan of the query (like for <a href="sql/SQL-Explain.html">EXPLAIN</a> ) with additional information about execution time spent on each step, in microseconds.</p>
<p><strong>Syntax</strong></p>
<pre><code>PROFILE &lt;command&gt;
</code></pre>
<ul>
<li><strong><code>&lt;command&gt;</code></strong> Defines the command that you want to profile, eg. a SELECT statement</li>
</ul>
<p><strong>Examples</strong></p>
<pre><code class="language-sql">PROFILE SELECT sum(Amount), OrderDate 
FROM Orders 
WHERE OrderDate &gt; date("2012-12-09", "yyyy-MM-dd") 
GROUP BY OrderDate  
</code></pre>
<p>result:</p>
<pre><code>+ FETCH FROM INDEX Orders.OrderDate (1.445μs)
  OrderDate &gt; date("2012-12-09", "yyyy-MM-dd")
+ EXTRACT VALUE FROM INDEX ENTRY
+ FILTER ITEMS BY CLASS 
  Orders
+ CALCULATE PROJECTIONS (5.065μs)
  Amount AS _$$$OALIAS$$_1, OrderDate
+ CALCULATE AGGREGATE PROJECTIONS (3.182μs)
  sum(_$$$OALIAS$$_1) AS _$$$OALIAS$$_0, OrderDate
  GROUP BY OrderDate
+ CALCULATE PROJECTIONS (1.116μs)
  _$$$OALIAS$$_0 AS `sum(Amount)`, OrderDate
</code></pre>
<p>You can see the <code>(1.445μs)</code> at the end of the first line, it means that fetching from index <code>Orders.OrderDate</code> took 1.445 microseconds (1.4 milliseconds)</p>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="sql/SQL-Commands.html">SQL Commands</a></li>
<li><a href="sql/SQL-Explain.html">EXPLAIN</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---rebuild-indexes"><a class="header" href="#sql---rebuild-indexes">SQL - <code>REBUILD INDEXES</code></a></h1>
<p>Rebuilds automatic indexes.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">REBUILD INDEX &lt;index&gt;
</code></pre>
<ul>
<li><strong><code>&lt;index&gt;</code></strong> Defines the index that you want to rebuild.  Use <code>*</code> to rebuild all automatic indexes.</li>
</ul>
<blockquote>
<p><strong>NOTE</strong>: During the rebuild, any idempotent queries made against the index, skip the index and perform sequential scans.  This means that queries run slower during this operation.  Non-idempotent commands, such as <a href="sql/SQL-Insert.html"><code>INSERT</code></a>, <a href="sql/SQL-Update.html"><code>UPDATE</code></a>, and <a href="sql/SQL-Delete.html"><code>DELETE</code></a> are blocked waiting until the indexes are rebuilt.</p>
</blockquote>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Rebuild an index on the <code>nick</code> property on the class <code>Profile</code>:</p>
<pre>
orientdb> <code class='lang-sql userinput'>REBUILD INDEX Profile.nick</code>
</pre>
</li>
<li>
<p>Rebuild all indexes:</p>
<pre>
orientdb> <code class='lang-sql userinput'>REBUILD INDEX *</code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="sql/SQL-Create-Index.html"><code>CREATE INDEX</code></a></li>
<li><a href="sql/SQL-Drop-Index.html"><code>DROP INDEX</code></a></li>
<li><a href="sql/../indexing/Indexes.html">Indexes</a></li>
<li><a href="sql/SQL-Commands.html">SQL Commands</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---revoke"><a class="header" href="#sql---revoke">SQL - <code>REVOKE</code></a></h1>
<p>Changes permissions of a role, revoking access to one or more resources.  To give access to a resource to the role, see the <a href="sql/SQL-Grant.html"><code>GRANT</code></a> command.</p>
<p><strong>Syntax</strong></p>
<pre><code>REVOKE [ &lt;permission&gt; | POLICY &lt;policyName&gt; ] ON &lt;resource&gt; FROM &lt;role&gt;
</code></pre>
<ul>
<li><strong><code>&lt;permission&gt;</code></strong> Defines the permission you want to revoke from the role.</li>
<li><strong><code>&lt;policyName&gt;</code></strong> Defines the name of a security policy</li>
<li><strong><code>&lt;resource&gt;</code></strong> Defines the resource on which you want to revoke the permissions.</li>
<li><strong><code>&lt;role&gt;</code></strong> Defines the role you want to revoke the permissions.</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Revoke permission to delete records on any cluster to the role <code>backoffice</code>:</p>
<pre>
orientdb> <code class='lang-sql userinput'>REVOKE DELETE ON database.cluster.* FROM backoffice</code>
</pre>
</li>
<li>
<p>Revoke a security policy previously assigned to <code>backoffice</code> profile on Person class:</p>
<pre>
orientdb> <code class='lang-sql userinput'>REVOKE POLICY ON database.class.Person FROM backoffice</code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="sql/SQL-Commands.html">SQL Commands</a>.</li>
</ul>
</blockquote>
<h2 id="supported-permissions-1"><a class="header" href="#supported-permissions-1">Supported Permissions</a></h2>
<p>Using this command, you can grant the following permissions to a role.</p>
<div class="table-wrapper"><table><thead><tr><th>Permission</th><th>Description</th></tr></thead><tbody>
<tr><td><code>NONE</code></td><td>Revokes no permissions on the resource.</td></tr>
<tr><td><code>CREATE</code></td><td>Revokes create permissions on the resource, such as the <a href="sql/SQL-Create-Class.html"><code>CREATE CLASS</code></a> or <a href="sql/SQL-Create-Cluster.html"><code>CREATE CLUSTER</code></a> commands.</td></tr>
<tr><td><code>READ</code></td><td>Revokes read permissions on the resource, such as the <a href="sql/SQL-Query.html"><code>SELECT</code></a> query.</td></tr>
<tr><td><code>UPDATE</code></td><td>Revokes update permissions on the resource, such as the <a href="sql/SQL-Update.html"><code>UPDATE</code></a> or <a href="sql/SQL-Update.html"><code>UPDATE EDGE</code></a> commands.</td></tr>
<tr><td><code>DELETE</code></td><td>Revokes delete permissions on the resource, such as the <a href="sql/SQL-Drop-Index.html"><code>DROP INDEX</code></a> or <a href="sql/SQL-Drop-Sequence.html"><code>DROP SEQUENCE</code></a> commands.</td></tr>
<tr><td><code>ALL</code></td><td>Revokes all permissions on the resource.</td></tr>
</tbody></table>
</div>
<h2 id="supported-resources-1"><a class="header" href="#supported-resources-1">Supported Resources</a></h2>
<p>Using this command, you can grant permissions on the following resources.</p>
<div class="table-wrapper"><table><thead><tr><th>Resource</th><th>Description</th></tr></thead><tbody>
<tr><td><code>database</code></td><td>Revokes access on the current database.</td></tr>
<tr><td><code>database.class.&lt;class&gt;</code></td><td>Revokes access on records contained in the indicated class.  Use <code>**</code> to indicate all classes.</td></tr>
<tr><td><code>database.class.&lt;class&gt;.&lt;property&gt;</code></td><td>intended only for security policies. Revokes policies assigned to a specific class property for a role.  Use <code>**</code> to indicate all classes and/or all properties.</td></tr>
<tr><td><code>database.cluster.&lt;cluster&gt;</code></td><td>Revokes access to records contained in the indicated cluster.  Use <code>**</code> to indicate all clusters.</td></tr>
<tr><td><code>database.query</code></td><td>Revokes the ability to execute a query, (<code>READ</code> is sufficient).</td></tr>
<tr><td><code>database.command.&lt;command&gt;</code></td><td>Revokes the ability to execute the given command.  Use <code>CREATE</code> for <a href="sql/SQL-Insert.html"><code>INSERT</code></a>, <code>READ</code> for <a href="sql/SQL-Query.html"><code>SELECT</code></a>, <code>UPDATE</code> for <a href="sql/SQL-Update.html"><code>UPDATE</code></a> and <code>DELETE</code> for <a href="sql/SQL-Delete.html"><code>DELETE</code></a>.</td></tr>
<tr><td><code>database.config.&lt;permission&gt;</code></td><td>Revokes access to the configuration.  Valid permissions are <code>READ</code> and <code>UPDATE</code>.</td></tr>
<tr><td><code>database.hook.record</code></td><td>Revokes the ability to set hooks.</td></tr>
<tr><td><code>server.admin</code></td><td>Revokes the ability to access server resources.</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="sql---select"><a class="header" href="#sql---select">SQL - <code>SELECT</code></a></h1>
<p>OrientDB supports the SQL language to execute queries against the database engine.  For more information, see <a href="sql/SQL-Where.html#operators">operators</a> and <a href="sql/SQL-Where.html#functions">functions</a>.  For more information on the differences between this implementation and the SQL-92 standard, please refer to <a href="sql/SQL-Introduction.html">this</a> section.</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-sql">SELECT [ &lt;Projections&gt; ] [ FROM &lt;Target&gt; [ LET &lt;Assignment&gt;* ] ]
    [ WHERE &lt;Condition&gt;* ]
    [ GROUP BY &lt;Field&gt;* ]
    [ ORDER BY &lt;Fields&gt;* [ ASC|DESC ] * ]
    [ UNWIND &lt;Field&gt;* ]
    [ SKIP &lt;SkipRecords&gt; ]
    [ LIMIT &lt;MaxRecords&gt; ]
    [ FETCHPLAN &lt;FetchPlan&gt; ]
    [ TIMEOUT &lt;Timeout&gt; [ &lt;STRATEGY&gt; ]
    [ LOCK default|record ]
    [ PARALLEL ]
    [ NOCACHE ]
</code></pre>
<ul>
<li><strong><a href="sql/SQL-Query.html#projections"><code>&lt;Projections&gt;</code></a></strong> Indicates the data you want to extract from the query as the result-set.  Note: In OrientDB, this variable is optional.  In the projections you can define aliases for single fields, using the <code>AS</code> keyword; in current release aliases cannot be used in the WHERE condition, GROUP BY and ORDER BY (they will be evaluated to null)</li>
<li><strong><code>FROM</code></strong> Designates the object to query.  This can be a class, cluster, single <a href="sql/../datamodeling/Concepts.html#record-id">Record ID</a>, set of <a href="sql/../datamodeling/Concepts.html#record-id">Record ID's</a>, or (beginning in version 1.7.7) index values sorted by ascending or descending key order.
<ul>
<li>When querying a class, for <code>&lt;target&gt;</code> use the class name.</li>
<li>When querying a cluster, for <code>&lt;target&gt;</code> use <code>CLUSTER:&lt;cluster-name&gt;</code> (eg. <code>CLUSTER:person</code>) or <code>CLUSTER:&lt;cluster-id&gt;</code> (eg. <code>CLUSTER:12</code>).  This causes the query to execute only on records in that cluster.</li>
<li>When querying record ID's, you can specific one or a small set of records to query.  This is useful when you need to specify a starting point in navigating graphs.</li>
<li>When querying indexes, use the following prefixes:
<ul>
<li><code>INDEXVALUES:&lt;index&gt;</code> and <code>INDEXVALUESASC:&lt;index&gt;</code> sorts values into an ascending order of index keys.</li>
<li><code>INDEXVALUESDESC:&lt;index&gt;</code> sorts the values into a descending order of index keys.</li>
</ul>
</li>
</ul>
</li>
<li><strong><a href="sql/SQL-Where.html"><code>WHERE</code></a></strong> Designates conditions to filter the result-set.</li>
<li><strong><a href="sql/SQL-Query.html#let-block"><code>LET</code></a></strong> Binds context variables to use in projections, conditions or sub-queries.</li>
<li><strong><code>GROUP BY</code></strong> Designates field on which to group the result-set.</li>
<li><strong><code>ORDER BY</code></strong> Designates the field with which to order the result-set.  Use the optional <code>ASC</code> and <code>DESC</code> operators to define the direction of the order.  The default is ascending.  Additionally, if you are using a <a href="sql/SQL-Query.html#projections">projection</a>, you need to include the <code>ORDER BY</code> field in the projection. Note that ORDER BY works only on projection fields (fields that are returned in the result set) not on LET variables.</li>
<li><strong><a href="sql/SQL-Query.html#unwinding"><code>UNWIND</code></a></strong> Designates the field on which to unwind the collection.  Introduced in version 2.1.</li>
<li><strong><code>SKIP</code></strong> Defines the number of records you want to skip from the start of the result-set.  You may find this useful in <a href="sql/Pagination.html">pagination</a>, when using it in conjunction with <code>LIMIT</code>.</li>
<li><strong><code>LIMIT</code></strong> Defines the maximum number of records in the result-set.  You may find this useful in <a href="sql/Pagination.html">pagination</a>, when using it in conjunction with <code>SKIP</code>.</li>
<li><strong><code>FETCHPLAN</code></strong> Defines how you want it to fetch results.  For more information, see <a href="sql/../java/Fetching-Strategies.html">Fetching Strategy</a>.</li>
<li><strong><code>TIMEOUT</code></strong> Defines the maximum time in milliseconds for the query.  By default, queries have no timeouts.  If you don't specify a timeout strategy, it defaults to <code>EXCEPTION</code>.  These are the available timeout strategies:
<ul>
<li><code>RETURN</code> Truncate the result-set, returning the data collected up to the timeout.</li>
<li><code>EXCEPTION</code> Raises an exception.</li>
</ul>
</li>
<li><strong><code>LOCK</code></strong> Defines the locking strategy.  These are the available locking strategies:
<ul>
<li><code>DEFAULT</code> Locks the record for the read.</li>
<li><code>RECORD</code> Locks the record in exclusive mode for the current transaction, until the transaction commits or you perform a rollback operation.</li>
</ul>
</li>
<li><strong><code>PARALLEL</code></strong> Executes the query against <em>x</em> concurrent threads, where <em>x</em> refers to the number of processors or cores found on the host operating system of the query.  You may find <code>PARALLEL</code> execution useful on long running queries or queries that involve multiple cluster.  For simple queries, using <code>PARALLEL</code> may cause a slow down due to the overhead inherent in using multiple threads.</li>
<li><strong><code>NOCACHE</code></strong> Defines whether you want to avoid using the cache.</li>
</ul>
<blockquote>
<p><strong>NOTE</strong>: Beginning with version 1.0 rc 7, the <code>RANGE</code> operator was removed.  To execute range queries, instead use the <code>BETWEEN</code> operator against <code>@RID</code>.  For more information, see <a href="sql/Pagination.html">Pagination</a>.</p>
</blockquote>
<p><strong>Examples</strong>:</p>
<ul>
<li>
<p>Return all records of the class <code>Person</code>, where the name starts with <code>Luk</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM Person WHERE name LIKE 'Luk%'</code>
</pre>
<p>Alternatively, you might also use either of these queries:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM Person WHERE name.left(3) = 'Luk'</code>
orientdb> <code class="lang-sql userinput">SELECT FROM Person WHERE name.substring(0,3) = 'Luk'</code>
</pre>
</li>
<li>
<p>Return all records of the type <code>!AnimalType</code> where the collection <code>races</code> contains at least one entry where the first character is <code>e</code>, ignoring case:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM animaltype WHERE races CONTAINS( name.toLowerCase().subString(
          0, 1) = 'e' )</code>
</pre>
</li>
<li>
<p>Return all records of type <code>!AnimalType</code> where the collection <code>races</code> contains at least one entry with names <code>European</code> or <code>Asiatic</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT * FROM animaltype WHERE races CONTAINS(name in ['European',
          'Asiatic'])</code>
</pre>
</li>
<li>
<p>Return all records in the class <code>Profile</code> where any field contains the word <code>danger</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM Profile WHERE ANY() LIKE '%danger%'</code>
</pre>
</li>
<li>
<p>Return any record at any level that has the word <code>danger</code>:</p>
<p>DEPRECATED SYNTAX</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM Profile WHERE ANY() TRAVERSE( ANY() LIKE '%danger%' )</code>
</pre>
</li>
<li>
<p>Return any record where up to the third level of connections has some field that contains the word <code>danger</code>, ignoring case:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM Profile WHERE ANY() TRAVERSE(0, 3) ( 
          ANY().toUpperCase().indexOf('danger') > -1 )</code>
</pre>
</li>
<li>
<p>Return all results on class <code>Profile</code>, ordered by the field <code>name</code> in descending order:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM Profile ORDER BY name DESC</code>
</pre>
</li>
<li>
<p>Return the number of records in the class <code>Account</code> per city:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT SUM(*) FROM Account GROUP BY city</code>
</pre>
</li>
<li>
<p>Traverse records from a root node:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM 11:4 WHERE ANY() TRAVERSE(0,10) (address.city = 'Rome')</code>
</pre>
</li>
<li>
<p>Return only a limited set of records:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM [#10:3, #10:4, #10:5]</code>
</pre>
</li>
<li>
<p>Return three fields from the class <code>Profile</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT nick, followings, followers FROM Profile</code>
</pre>
</li>
<li>
<p>Return the field <code>name</code> in uppercase and the field country name of the linked city of the address:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT name.toUppercase(), address.city.country.name FROM Profile</code>
</pre>
</li>
<li>
<p>Return records from the class <code>Profile</code> in descending order of their creation:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM Profile ORDER BY @rid DESC</code>
</pre>
</li>
<li>
<p>Return value of <code>email</code> which is stored in a JSON field <code>data</code> (type EMBEDDED)  of the class <code>Person</code>, where the name starts with <code>Luk</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT data.email FROM Person WHERE name LIKE 'Luk%'</code>
</pre>
<p>Beginning in version 1.7.7, OrientDB can open an inverse cursor against clusters.  This is very fast and doesn't require the classic ordering resources, CPU and RAM.</p>
</li>
</ul>
<h2 id="projections-1"><a class="header" href="#projections-1">Projections</a></h2>
<p>In the standard implementations of SQL, projections are mandatory.  In OrientDB, the omission of projects translates to its returning the entire record.  That is, it reads no projection as the equivalent of the <code>*</code> wildcard.</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM Account</code>
</pre>
<p>For all projections except the wildcard <code>*</code>, it creates a new temporary document, which does not include the <code>@rid</code> and <code>@version</code> fields of the original record.</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT name, age FROM Account</code>
</pre>
<p>The naming convention for the returned document fields are:</p>
<ul>
<li>Field name for plain fields, like <code>invoice</code> becoming <code>invoice</code>.</li>
<li>First field name for chained fields, like <code>invoice.customer.name</code> becoming <code>invoice</code>.</li>
<li>Function name for functions, like <code>MAX(salary)</code> becoming <code>max</code>.</li>
</ul>
<p>In the event that the target field exists, it uses a numeric progression.  For instance,</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT MAX(incoming), MAX(cost) FROM Balance</code>

------+------
 max  | max2
------+------
 1342 | 2478
------+------
</pre>
<p>To override the display for the field names, use the <code>AS</code>.</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT MAX(incoming) AS max_incoming, MAX(cost) AS max_cost FROM Balance</code>

---------------+----------
 max_incoming  | max_cost
---------------+----------
 1342          | 2478
---------------+----------
</pre>
<p>With the dollar sign <code>$</code>, you can access the context variables.  Each time you run the command, OrientDB accesses the context to read and write the variables.  For instance, say you want to display the path and depth levels up to the fifth of a <a href="sql/SQL-Traverse.html"><code>TRAVERSE</code></a> on all records in the <code>Movie</code> class.</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT $path, $depth FROM ( TRAVERSE * FROM Movie WHERE $depth <= 5 )</code>
</pre>
<h2 id="let-block"><a class="header" href="#let-block"><code>LET</code> Block</a></h2>
<p>The <code>LET</code> block contains context variables to assign each time OrientDB evaluates a record.  It destroys these values once the query execution ends.  You can use context variables in projections, conditions, and sub-queries.</p>
<h3 id="assigning-fields-for-reuse"><a class="header" href="#assigning-fields-for-reuse">Assigning Fields for Reuse</a></h3>
<p>OrientDB allows for crossing relationships.  In single queries, you need to evaluate the same branch of the nested relationship.  This is better than using a context variable that refers to the full relationship.</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM Profile WHERE address.city.name LIKE '%Saint%"' AND 
          ( address.city.country.name = 'Italy' OR 
            address.city.country.name = 'France' )</code>
</pre>
<p>Using the <code>LET</code> makes the query shorter and faster, because it traverses the relationships only once:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM Profile LET $city = address.city WHERE $city.name LIKE 
          '%Saint%"' AND ($city.country.name = 'Italy' OR $city.country.name = 'France')</code>
</pre>
<p>In this case, it traverses the path till <code>address.city</code> only once.</p>
<h3 id="sub-query"><a class="header" href="#sub-query">Sub-query</a></h3>
<p>The <code>LET</code> block allows you to assign a context variable to the result of a sub-query.</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM Document LET $temp = ( SELECT @rid, $depth FROM (TRAVERSE 
          V.OUT, E.IN FROM $parent.current ) WHERE @class = 'Concept' AND 
          ( id = 'first concept' OR id = 'second concept' )) WHERE $temp.SIZE() > 0</code>
</pre>
<h3 id="let-block-in-projection"><a class="header" href="#let-block-in-projection"><code>LET</code> Block in Projection</a></h3>
<p>You can use context variables as part of a result-set in <a href="sql/SQL-Query.html#projections">projections</a>.  For instance, the query below displays the city name from the previous example:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT $temp.name FROM Profile LET $temp = address.city WHERE $city.name 
          LIKE '%Saint%"' AND ( $city.country.name = 'Italy' OR 
          $city.country.name = 'France' )</code>
</pre>
<h2 id="unwinding"><a class="header" href="#unwinding">Unwinding</a></h2>
<p>Beginning with version 2.1, OrientDB allows unwinding of collection fields and obtaining multiple records as a result, one for each element in the collection:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT name, OUT("Friend").name AS friendName FROM Person</code>

--------+-------------------
 name   | friendName
--------+-------------------
 'John' | ['Mark', 'Steve']
--------+-------------------
</pre>
<p>In the event if you want one record for each element in <code>friendName</code>, you can rewrite the query using <code>UNWIND</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT name, OUT("Friend").name AS friendName FROM Person UNWIND friendName</code>

--------+-------------
 name   | friendName
--------+-------------
 'John' | 'Mark'
 'John' | 'Steve'
--------+-------------
</pre>
<blockquote>
<p><strong>NOTE</strong>: For more information on other SQL commands, see <a href="sql/SQL-Commands.html">SQL Commands</a>.</p>
</blockquote>
<h2 id="execution-planning"><a class="header" href="#execution-planning">Execution planning</a></h2>
<p>For details about query execution planning, please refer to <a href="sql/SQL-Select-Execution.html">SQL SELECT Execution</a></p>
<h2 id="history-7"><a class="header" href="#history-7">History</a></h2>
<ul>
<li><strong>1.7.7</strong>: New target prefixes <code>INDEXVALUES:</code>, <code>INDEXVALUESASC:</code> and <code>INDEXVALUESDESC:</code> added.</li>
<li><strong>1.7</strong>: <code>PARALLEL</code> keyword added to execute the query against <em>x</em> concurrent threads, where <em>x</em> is the number of processors or cores found on the operating system where the query runs.  <code>PARALLEL</code> execution is useful on long running queries or queries that involve multiple clusters.  On simple queries, using <code>PARALLEL</code> can cause a slow down due to the overhead of using multiple threads.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---traverse"><a class="header" href="#sql---traverse">SQL - <code>TRAVERSE</code></a></h1>
<p>Retrieves connected records crossing relationships.  This works with both the Document and Graph API's, meaning that you can traverse relationships between say invoices and customers on a graph, without the need to model the domain using the Graph API.</p>
<div class="table-wrapper"><table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td><img src="sql/../images/warning.png" alt="" /></td><td>In many cases, you may find it more efficient to use <a href="sql/SQL-Query.html"><code>SELECT</code></a>, which can result in shorter and faster queries.  For more information, see <a href="sql/SQL-Traverse.html#traverse-versus-select"><code>TRAVERSE</code> versus <code>SELECT</code></a> below.</td></tr>
</tbody></table>
</div>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">TRAVERSE &lt;[class.]field&gt;|*|any()|all()
         [FROM &lt;target&gt;]
         [
           MAXDEPTH &lt;number&gt;
           |
           WHILE &lt;condition&gt; 
         ]
         [LIMIT &lt;max-records&gt;]
         [STRATEGY &lt;strategy&gt;]
</code></pre>
<ul>
<li><strong><a href="sql/SQL-Traverse.html#fields"><code>&lt;fields&gt;</code></a></strong> Defines the fields you want to traverse.</li>
<li><strong><a href="sql/SQL-Traverse.html#target"><code>&lt;target&gt;</code></a></strong> Defines the target you want to traverse.  This can be a class, one or more clusters, a single Record ID, set of Record ID's, or a sub-query.</li>
<li><strong><code>MAXDEPTH</code></strong> Defines the maximum depth of the traversal.  <code>0</code> indicates that you only want to traverse the root node.  Negative values are invalid.</li>
<li><strong><code>WHILE</code></strong> Defines the condition for continuing the traversal while it is true.</li>
<li><strong><code>LIMIT</code></strong> Defines the maximum number of results the command can return.</li>
<li><strong><a href="sql/../java/Java-Traverse.html#traversal-strategies"><code>STRATEGY</code></a></strong> Defines strategy for traversing the graph.</li>
</ul>
<blockquote>
<p><strong>NOTE</strong>: The use of the <a href="sql/SQL-Where.html"><code>WHERE</code></a> clause has been deprecated for this command.</p>
</blockquote>
<blockquote>
<p><strong>NOTE</strong>: There is a difference between <code>MAXDEPTH N</code> and <code>WHILE DEPTH &lt;= N</code>: the <code>MAXDEPTH</code> will evaluate exactly N levels, while the <code>WHILE</code> will evaluate N+1 levels and will discard the N+1th, so the <code>MAXDEPTH</code> in general has better performance.</p>
</blockquote>
<p><strong>Examples</strong></p>
<p>In a social network-like domain, a user profile is connected to friends through links.  The following examples consider common operations on a user with the record ID <code>#10:1234</code>.</p>
<ul>
<li>
<p>Traverse all fields in the root record:</p>
<pre>
orientdb> <code class="lang-sql userinput">TRAVERSE * FROM #10:1234</code>
</pre>
</li>
<li>
<p>Specify fields and depth up to the third level, using the <a href="sql/../java/Java-Traverse.html#traversal-strategies"><code>BREADTH_FIRST</code></a> strategy:</p>
<pre>
orientdb> <code class="lang-sql userinput">TRAVERSE out("Friend") FROM #10:1234 MAXDEPTH 3 
          STRATEGY BREADTH_FIRST</code>
</pre>
</li>
<li>
<p>Execute the same command, this time filtering for a minimum depth to exclude the first target vertex:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM (TRAVERSE out("Friend") FROM #10:1234 MAXDEPTH 3) 
          WHERE $depth >= 1</code>
</pre>
<blockquote>
<p><strong>NOTE</strong>: You can also define the maximum depth in the <a href="sql/SQL-Query.html"><code>SELECT</code></a> command, but it's much more efficient to set it at the inner <a href="sql/SQL-Traverse.html"><code>TRAVERSE</code></a> statement because the returning record sets are already filtered by depth.</p>
</blockquote>
</li>
<li>
<p>Combine traversal with <a href="sql/SQL-Query.html"><code>SELECT</code></a> command to filter the result-set.  Repeat the above example, filtering for users in Rome:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM (TRAVERSE out("Friend") FROM #10:1234 MAXDEPTH 3) 
          WHERE city = 'Rome'</code>
</pre>
</li>
<li>
<p>Extract movies of actors that have worked, at least once, in any movie produced by J.J. Abrams:</p>
<pre>
orientdb> <code class='lang-sql userinput'>SELECT FROM (TRAVERSE out("Actors"), out("Movies") FROM (SELECT FROM 
          Movie WHERE producer = "J.J. Abrams") MAXDEPTH 3) WHERE 
          @class = 'Movie'</code>
</pre>
</li>
<li>
<p>Display the current path in the traversal:</p>
<pre>
orientdb> <code class='lang-sql userinput'>SELECT $path FROM ( TRAVERSE out() FROM V MAXDEPTH 10 )</code>
</pre>
</li>
</ul>
<h2 id="supported-variables"><a class="header" href="#supported-variables">Supported Variables</a></h2>
<h3 id="fields"><a class="header" href="#fields">Fields</a></h3>
<p>Defines the fields that you want to traverse.  If set to <code>*</code>, <code>any()</code> or <code>all()</code> then it traverses all fields.  This can prove costly to performance and resource usage, so it is recommended that you optimize the command to only traverse the pertinent fields.</p>
<p>In addition to his, you can specify the fields at a class-level.  <a href="sql/../general/Inheritance.html">Polymorphism</a> is supported.  By specifying <code>Person.city</code> and the class <code>Customer</code> extends person, you also traverse fields in <code>Customer</code>.</p>
<p>Field names are case-sensitive, classes not.</p>
<h3 id="target"><a class="header" href="#target">Target</a></h3>
<p>Targets for traversal can be,</p>
<ul>
<li><strong><code>&lt;class&gt;</code></strong> Defines the class that you want to traverse.</li>
<li><strong><code>CLUSTER:&lt;cluster&gt;</code></strong> Defines the cluster you want to traverse.</li>
<li><strong><code>&lt;record-id&gt;</code></strong> Individual root Record ID that you want to traverse.</li>
<li><strong><code>[&lt;record-id&gt;,&lt;record-id&gt;,...]</code></strong> Set of Record ID's that you want to traverse.  This is useful when navigating graphs starting from the same root nodes.</li>
</ul>
<h3 id="context-variables-1"><a class="header" href="#context-variables-1">Context Variables</a></h3>
<p>In addition to the above, you can use the following context variables in traversals:</p>
<ul>
<li><strong><code>$parent</code></strong> Gives the parent context, if any.  You may find this useful when traversing from a sub-query.</li>
<li><strong><code>$current</code></strong> Gives the current record in the iteration.  To get the upper-level record in nested queries, you can use <code>$parent.$current</code>.</li>
<li><strong><code>$depth</code></strong> Gives the current depth of nesting.</li>
<li><strong><code>$path</code></strong> Gives a string representation of the current path.  For instance, <code>#5:0#.out</code>.  You can also display it through <a href="sql/SQL-Query.html"><code>SELECT</code></a>:<pre>
orientdb> <code class="lang-sql userinput">SELECT $path FROM (TRAVERSE * FROM V)</code>
</pre>
</li>
</ul>
<h2 id="use-cases-3"><a class="header" href="#use-cases-3">Use Cases</a></h2>
<h3 id="traverse-versus-select"><a class="header" href="#traverse-versus-select"><code>TRAVERSE</code> versus <code>SELECT</code></a></h3>
<p>When you already know traversal information, such as relationship names and depth-level, consider using <a href="sql/SQL-Query.html"><code>SELECT</code></a> instead of <a href="sql/SQL-Traverse.html"><code>TRAVERSE</code></a> as it is faster in some cases.</p>
<p>For example, this query traverses the <code>follow</code> relationship on Twitter accounts, getting the second level of friendship:</p>
<pre>
orientdb> <code class='lang-sql userinput'>SELECT FROM (TRAVERSE out('follow') FROM TwitterAccounts MAXDEPTH 2 )
          WHERE $depth = 2</code>
</pre>
<p>But, you could also express this same query using <a href="sql/SQL-Query.html"><code>SELECT</code></a> operation, in a way that is also shorter and faster:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT out('follow').out('follow') FROM TwitterAccounts</code>
</pre>
<h3 id="traverse-with-the-graph-model-and-api"><a class="header" href="#traverse-with-the-graph-model-and-api"><code>TRAVERSE</code> with the Graph Model and API</a></h3>
<p>While you can use the <a href="sql/SQL-Traverse.html"><code>TRAVERSE</code></a> command with any domain model, it provides the greatest utility in [Graph Databases[(Graph-Database-Tinkerpop.md) model.</p>
<p>This model is based on the concepts of the Vertex (or Node) as the class <code>V</code> and the Edge (or Arc, Connection, Link, etc.) as the class <code>E</code>.  If you want to traverse in a direction, you have to use the class name when declaring the traversing fields.  The supported directions are:</p>
<ul>
<li><strong>Vertex to outgoing edges</strong>  Using <code>outE()</code> or <code>outE('EdgeClassName')</code>.  That is, going out from a vertex and into the outgoing edges.</li>
<li><strong>Vertex to incoming edges</strong>  Using <code>inE()</code> or <code>inE('EdgeClassName')</code>.  That is, going from a vertex and into the incoming edges.</li>
<li><strong>Vertex to all edges</strong>  Using <code>bothE()</code> or <code>bothE('EdgeClassName')</code>.  That is, going from a vertex and into all the connected edges.</li>
<li><strong>Edge to Vertex (end point)</strong> Using <code>inV()</code> .  That is, going out from an edge and into a vertex.</li>
<li><strong>Edge to Vertex (starting point)</strong> Using <code>outV()</code> .  That is, going back from an edge and into a vertex.</li>
<li><strong>Edge to Vertex (both sizes)</strong> Using <code>bothV()</code> .  That is, going from an edge and into connected vertices.</li>
<li><strong>Vertex to Vertex (outgoing edges)</strong> Using <code>out()</code> or <code>out('EdgeClassName')</code>. This is the same as  <code>outE().inV()</code></li>
<li><strong>Vertex to Vertex (incoming edges)</strong> Using <code>in()</code> or <code>in('EdgeClassName')</code>. This is the same as  <code>outE().inV()</code></li>
<li><strong>Vertex to Vertex (all directions)</strong> Using <code>both()</code> or <code>both('EdgeClassName')</code>.</li>
</ul>
<p>For instance, traversing outgoing edges on the record <code>#10:3434</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">TRAVERSE out() FROM #10:3434</code>
</pre>
<p>In a domain for emails, to find all messages sent on January 1, 2012 from the user Luca, assuming that they are stored in the vertex class <code>User</code> and that the messages are contained in the vertex class <code>Message</code>.  Sent messages are stored as <code>out</code> connections on the edge class <code>SentMessage</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM (TRAVERSE outE(), inV() FROM (SELECT FROM User WHERE 
          name = 'Luca') MAXDEPTH 2 AND (@class = 'Message' or 
          (@class = 'SentMessage' AND sentOn = '01/01/2012') )) WHERE 
          @class = 'Message'</code>
</pre>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="sql/../java/Java-Traverse.html">Java-Traverse</a> page.</li>
<li><a href="sql/SQL-Commands.html">SQL Commands</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---truncate-class"><a class="header" href="#sql---truncate-class">SQL - <code>TRUNCATE CLASS</code></a></h1>
<p>Deletes records of all clusters defined as part of the class.</p>
<p>By default, every class has an associated cluster with the same name.  This command operates at a lower level than <a href="sql/SQL-Delete.html"><code>DELETE</code></a>.  This commands ignores sub-classes, (That is, their records remain in their clusters).  If you want to also remove all records from the class hierarchy, you need to use the <code>POLYMORPHIC</code> keyword.</p>
<p>Truncation is not permitted on vertex or edge classes, but you can force its execution using the <code>UNSAFE</code> keyword.  Forcing truncation is strongly discouraged, as it can leave the graph in an inconsistent state.</p>
<p><strong>Syntax</strong></p>
<pre><code>TRUNCATE CLASS &lt;class&gt; [ POLYMORPHIC ] [ UNSAFE ] 
</code></pre>
<ul>
<li><strong><code>&lt;class&gt;</code></strong> Defines the class you want to truncate.</li>
<li><strong><code>POLYMORPHIC</code></strong> Defines whether the command also truncates the class hierarchy.</li>
<li><strong><code>UNSAFE</code></strong> Defines whether the command forces truncation on vertex or edge classes, (that is, sub-classes that extend the classes <code>V</code> or <code>E</code>).</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Remove all records of the class <code>Profile</code>:</p>
<pre>
orientdb> <code class='lang-sql userinput'>TRUNCATE CLASS Profile</code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="sql/SQL-Delete.html"><code>DELETE</code></a></li>
<li><a href="sql/SQL-Truncate-Cluster.html"><code>TRUNCATE CLUSTER</code></a></li>
<li><a href="sql/SQL-Create-Class.html"><code>CREATE CLASS</code></a></li>
<li><a href="sql/SQL-Commands.html">SQL Commands</a></li>
<li><a href="sql/../console/Console-Commands.html">Console Commands</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---truncate-cluster"><a class="header" href="#sql---truncate-cluster">SQL - <code>TRUNCATE CLUSTER</code></a></h1>
<p>Deletes all records of a cluster.  This command operates at a lower level than the standard <a href="sql/SQL-Delete.html"><code>DELETE</code></a> command.</p>
<p>Truncation is not permitted on vertex or edge classes, but you can force its execution using the <code>UNSAFE</code> keyword.  Forcing truncation is strongly discouraged, as it can leave the graph in an inconsistent state.</p>
<p><strong>Syntax</strong></p>
<pre><code>TRUNCATE CLUSTER &lt;cluster&gt;
</code></pre>
<ul>
<li><strong><code>&lt;cluster&gt;</code></strong> Defines the cluster to delete.</li>
<li><strong><code>UNSAFE</code></strong> Defines whether the command forces truncation on vertex or edge classes, (that is, sub-classes that extend the classes <code>V</code> or <code>E</code>).</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Remove all records in the cluster <code>profile</code>:</p>
<pre>
orientdb> <code class='lang-sql userinput'>TRUNCATE CLUSTER profile</code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="sql/SQL-Delete.html"><code>DELETE</code></a></li>
<li><a href="sql/SQL-Truncate-Class.html"><code>TRUNCATE CLASS</code></a></li>
<li><a href="sql/SQL-Commands.html">SQL Commands</a></li>
<li><a href="sql/../console/Console-Commands.html">Console Commands</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---truncate-record"><a class="header" href="#sql---truncate-record">SQL - <code>TRUNCATE RECORD</code></a></h1>
<p>Deletes a record or records without loading them.  Useful in cases where the record is corrupted in a way that prevents OrientDB from correctly loading it.</p>
<p><strong>Syntax</strong></p>
<pre><code>TRUNCATE RECORD &lt;record-id&gt;*
</code></pre>
<ul>
<li><strong><code>&lt;record-id&gt;</code></strong> Defines the Record ID you want to truncate.  You can also truncate multiple records using a comma-separated list within brackets.</li>
</ul>
<p>This command returns the number of records it truncates.</p>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Truncate a record:</p>
<pre>
orientdb> <code class='lang-sql userinput'>TRUNCATE RECORD 20:3</code>
</pre>
</li>
<li>
<p>Truncate three records together:</p>
<pre>
orientdb> <code class="lang-sql userinput">TRUNCATE RECORD [20:0, 20:1, 20:2]</code>
</pre>
</li>
</ul>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="sql/SQL-Delete.html"><code>DELETE</code></a></li>
<li><a href="sql/SQL-Commands.html">SQL Commands</a></li>
<li><a href="sql/../console/Console-Commands.html">Console Commands</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---update"><a class="header" href="#sql---update">SQL - <code>UPDATE</code></a></h1>
<p>Update one or more records in the current database.  Remember: OrientDB can work in schema-less mode, so you can create any field on-the-fly.  Furthermore, the command also supports extensions to work on collections.</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-sql">UPDATE &lt;class&gt;|CLUSTER:&lt;cluster&gt;|&lt;recordID&gt;
  [SET|REMOVE &lt;field-name&gt; = &lt;field-value&gt;[,]*]|[CONTENT|MERGE &lt;JSON&gt;]
  [UPSERT]
  [RETURN &lt;returning&gt; [&lt;returning-expression&gt;]]
  [WHERE &lt;conditions&gt;]
  [LOCK default|record]
  [LIMIT &lt;max-records&gt;] [TIMEOUT &lt;timeout&gt;]
</code></pre>
<ul>
<li>
<p><strong><code>SET</code></strong> Defines the fields to update.</p>
</li>
<li>
<p><strong><code>REMOVE</code></strong> Removes an item in collection and map fields.</p>
</li>
<li>
<p><strong><code>CONTENT</code></strong> Replaces the record content with a JSON document.</p>
</li>
<li>
<p><strong><code>MERGE</code></strong> Merges the record content with a JSON document.</p>
</li>
<li>
<p><strong><code>LOCK</code></strong> Specifies how to lock the record between the load and update.  You can use one of the following lock strategies:</p>
<ul>
<li><code>DEFAULT</code> No lock.  Use in the event of concurrent updates, the MVCC throws an exception.</li>
<li><code>RECORD</code> Locks the record during the update.</li>
</ul>
</li>
<li>
<p><strong><code>UPSERT</code></strong> Updates a record if it exists or inserts a new record if it doesn't.  This avoids the need to execute two commands, (one for each condition, inserting and updating).</p>
<p><code>UPSERT</code> requires a <a href="sql/SQL-Where.html"><code>WHERE</code></a> clause and a class target.  There are further limitations on <code>UPSERT</code>, explained below.</p>
</li>
<li>
<p><strong><code>RETURN</code></strong> Specifies an expression to return instead of the record and what to do with the result-set returned by the expression.  The available return operators are:</p>
<ul>
<li><code>COUNT</code> Returns the number of updated records.  This is the default return operator.</li>
<li><code>BEFORE</code> Returns the records before the update.</li>
<li><code>AFTER</code> Return the records after the update.</li>
</ul>
</li>
<li>
<p><a href="sql/SQL-Where.html"><code>WHERE</code></a></p>
</li>
<li>
<p><code>LIMIT</code> Defines the maximum number of records to update.</p>
</li>
<li>
<p><code>TIMEOUT</code> Defines the time you want to allow the update run before it times out.</p>
</li>
</ul>
<blockquote>
<p><strong>NOTE</strong>: The <a href="sql/../datamodeling/Concepts.html#record-id">Record ID</a> must have a <code>#</code> prefix.  For instance, <code>#12:3</code>.</p>
</blockquote>
<p><strong>Examples</strong>:</p>
<ul>
<li>
<p>Update to change the value of a field:</p>
<pre>
orientdb> <code class="lang-sql userinput">UPDATE Profile SET nick = 'Luca' WHERE nick IS NULL</code>

Updated 2 record(s) in 0.008000 sec(s).
</pre>
</li>
<li>
<p>Update to remove a field from all records:</p>
<pre>
orientdb> <code class="lang-sql userinput">UPDATE Profile REMOVE nick</code>
</pre>
</li>
<li>
<p>Update to remove a value from a collection, if you know the exact value that you want to remove:</p>
<p>Remove an element from a link list or set:</p>
<pre>
orientdb> <code class="lang-sql userinput">UPDATE Account REMOVE address = #12:0</code>
</pre>
<p>Remove an element from a list or set of strings:</p>
<pre>
orientdb> <code class="lang-sql userinput">UPDATE Account REMOVE addresses = 'Foo'</code>
</pre>
</li>
<li>
<p>Update to remove a value, filtering on value attributes.</p>
<p>Remove addresses based in the city of Rome:</p>
<pre>
orientdb> <code class="lang-sql userinput">UPDATE Account REMOVE addresses = addresses[city = 'Rome']</code>
</pre>
</li>
<li>
<p>Update to remove a value, filtering based on position in the collection.</p>
<pre>
orientdb> <code class="lang-sql userinput">UPDATE Account REMOVE addresses = addresses[1]</code>
</pre>
<p>This remove the second element from a list, (position numbers start from <code>0</code>, so <code>addresses[1]</code> is the second elelment).</p>
</li>
<li>
<p>Update to remove a value from a map</p>
<pre>
orientdb> <code class="lang-sql userinput">UPDATE Account REMOVE addresses = 'Luca'</code>
</pre>
</li>
<li>
<p>Update an embedded document.  The <a href="sql/SQL-Update.html"><code>UPDATE</code></a> command can take JSON as a value to update.</p>
<pre>
orientdb> <code class="lang-sql userinput">UPDATE Account SET address={ "street": "Melrose Avenue", "city": { 
          "name": "Beverly Hills" } }</code>

</pre>
</li>
<li>
<p>Update the first twenty records that satisfy a condition:</p>
<pre>
orientdb> <code class="lang-sql userinput">UPDATE Profile SET nick = 'Luca' WHERE nick IS NULL LIMIT 20</code>
</pre>
</li>
<li>
<p>Update a record or insert if it doesn't already exist:</p>
<pre>
orientdb> <code class="lang-sql userinput">UPDATE Profile SET nick = 'Luca' UPSERT WHERE nick = 'Luca'</code>
</pre>
</li>
<li>
<p>Updates using the <code>RETURN</code> keyword:</p>
<pre>
orientdb> <code class="lang-sql userinput">UPDATE ♯7:0 SET gender='male' RETURN AFTER @rid</code>
orientdb> <code class="lang-sql userinput">UPDATE ♯7:0 SET gender='male' RETURN AFTER @version</code>
orientdb> <code class="lang-sql userinput">UPDATE ♯7:0 SET gender='male' RETURN AFTER @this</code>
orientdb> <code class="lang-sql userinput">UPDATE ♯7:0 SET gender='male' RETURN AFTER $current.exclude(
          "really_big_field")</code>
</pre>
</li>
</ul>
<p>In the event that a single field is returned, OrientDB wraps the result-set in a record storing the value in the field <code>result</code>.  This avoids introducing a new serialization, as there is no primitive values collection serialization in the binary protocol.  Additionally, it provides useful fields like <code>version</code> and <code>rid</code> from the original record in corresponding fields.  The new syntax allows for optimization of client-server network traffic.</p>
<p>For more information on SQL syntax, see <a href="sql/SQL-Query.html"><code>SELECT</code></a>.</p>
<h2 id="limitations-of-the-upsert-clause"><a class="header" href="#limitations-of-the-upsert-clause">Limitations of the <code>UPSERT</code> Clause</a></h2>
<p>The <code>UPSERT</code> clause only guarantees atomicity when you use a <code>UNIQUE</code> index and perform the look-up on the index through the <a href="sql/SQL-Where.html"><code>WHERE</code></a> condition.</p>
<pre>
orientdb> <code class="lang-sql userinput">UPDATE Client SET id = 23 UPSERT WHERE id = 23</code>
</pre>
<p>Here, you must have a unique index on <code>Client.id</code> to guarantee uniqueness on concurrent operations.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---update-edge"><a class="header" href="#sql---update-edge">SQL - <code>UPDATE EDGE</code></a></h1>
<p>Updates edge records in the current database.  This is the equivalent of the <a href="sql/SQL-Update.html"><code>UPDATE</code></a> command, with the addition of checking and maintaining graph consistency with vertices, in the event that you update the <code>out</code> and <code>in</code> properties.</p>
<p>Bear in mind that OrientDB can also work in schema-less mode, allowing you to create fields on the fly.  Furthermore, that it works on collections and necessarily includes some extensions to the standard SQL for handling collections.</p>
<p>This command was introduced in version 2.2.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-sql">UPDATE EDGE &lt;edge&gt; 
  [SET|INCREMENT|ADD|REMOVE|PUT &lt;field-name&gt; = &lt;field-value&gt;[,]*]|[CONTENT|MERGE &lt;JSON&gt;]
  [UPSERT]
  [RETURN &lt;returning&gt; [&lt;returning-expression&gt;]]
  [WHERE &lt;conditions&gt;]
  [LOCK default|record]
  [LIMIT &lt;max-records&gt;] [TIMEOUT &lt;timeout&gt;]
</code></pre>
<ul>
<li><strong><code>&lt;edge&gt;</code></strong> Defines the edge that you want to update.  You can choose between:
<ul>
<li><em>Class</em> Updating edges by class.</li>
<li><em>Cluster</em> Updating edges by cluster, using <code>CLUSTER</code> prefix.</li>
<li><em>Record ID</em> Updating edges by Record ID.</li>
</ul>
</li>
<li><strong><code>SET</code></strong> Updates the field to the given value.</li>
<li><strong><code>REMOVE</code></strong> Defines an item to remove from a collection of fields.</li>
<li><strong><code>RETURN</code></strong> Defines the expression you want to return after running the update.
<ul>
<li><code>COUNT</code> Returns the number of updated records.  This is the default operator.</li>
<li><code>BEFORE</code> Returns the records before the update.</li>
<li><code>AFTER</code> Returns the records after the update.</li>
</ul>
</li>
<li><strong><a href="sql/SQL-Where.html"><code>WHERE</code></a></strong> Defines the filter conditions.</li>
<li><strong><code>LOCK</code></strong> Defines how the record locks between the load and update.  You can choose between the following lock strategies:
<ul>
<li><code>DEFAULT</code> Disables locking.  Use this in the event of concurrent updates.  It throws an exception in the event of conflict.</li>
<li><code>RECORD</code> Locks the record during the update.</li>
</ul>
</li>
<li><strong><code>UPSERT</code></strong> Updates a record if it exists or inserts a new record if it doesn't.  This avoids the need to execute two commands, (one for each condition, inserting and updating).</li>
<li><strong><code>LIMIT</code></strong> Defines the maximum number of records to update.</li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Change the edge endpoint:</p>
<pre>
orientdb> <code class="lang-sql userinput">UPDATE EDGE Friend SET out = (SELECT FROM Person WHERE name = 'John') 
          WHERE foo = 'bar'</code>
</pre>
</li>
</ul>
<h2 id="limitations-of-the-upsert-clause-1"><a class="header" href="#limitations-of-the-upsert-clause-1">Limitations of the <code>UPSERT</code> Clause</a></h2>
<p>The <code>UPSERT</code> clause only guarantees atomicity when you use a <code>UNIQUE</code> index and perform the look-up on the index through the <a href="sql/SQL-Where.html"><code>WHERE</code></a> condition.</p>
<pre>
orientdb> <code class="lang-sql userinput">UPDATE EDGE hasAssignee SET foo = 'bar' UPSERT WHERE id = 56</code>
</pre>
<p>Here, you must have a unique index on <code>id</code> to guarantee uniqueness on concurrent operations.</p>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="sql/SQL-Update.html"><code>UPDATE</code></a></li>
<li><a href="sql/SQL-Commands.html">SQL Commands</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---filtering"><a class="header" href="#sql---filtering">SQL - Filtering</a></h1>
<p>The Where condition is shared among many SQL commands.</p>
<h2 id="syntax-5"><a class="header" href="#syntax-5">Syntax</a></h2>
<p><code>[&lt;item&gt;] &lt;operator&gt; &lt;item&gt;</code></p>
<h2 id="items"><a class="header" href="#items">Items</a></h2>
<p>And <code>item</code> can be:</p>
<div class="table-wrapper"><table><thead><tr><th><strong>What</strong></th><th><strong>Description</strong></th><th><strong>Example</strong></th><th><strong>Available since</strong></th></tr></thead><tbody>
<tr><td>field</td><td>Document field</td><td>where <em>price</em> &gt; 1000000</td><td>0.9.1</td></tr>
<tr><td>field&lt;indexes&gt;</td><td>Document field part. To know more about field part look at the full syntax: <a href="sql/../java/Document-API-Property.html">properties</a></td><td>where tags[name='Hi'] or tags[0-3] IN ('Hello') and employees IS NOT NULL</td><td>1.0rc5</td></tr>
<tr><td>record attribute</td><td>Record attribute name with @ as prefix</td><td>where <em>@class</em> = 'Profile'</td><td>0.9.21</td></tr>
<tr><td>column</td><td>The number of the column. Useful in Column Database</td><td>where <em>column(1)</em> &gt; 300</td><td>0.9.1</td></tr>
<tr><td>any()</td><td>Represents any field of the Document. The condition is true if ANY of the fields matches the condition</td><td>where <em>any()</em> like 'L%'</td><td>0.9.10</td></tr>
<tr><td>all()</td><td>Represents all the fields of the Document. The condition is true if ALL the fields match the condition</td><td>where <em>all()</em> is null</td><td>0.9.10</td></tr>
<tr><td><a href="sql/SQL-Functions.html">functions</a></td><td>Any <a href="sql/SQL-Functions.html">function</a> between the defined ones</td><td>where distance(x, y, 52.20472, 0.14056 ) &lt;= 30</td><td>0.9.25</td></tr>
<tr><td><a href="sql/SQL-Where.html#variables">$variable</a></td><td>Context variable prefixed with $</td><td>where $depth &lt;= 3</td><td>1.2.0</td></tr>
</tbody></table>
</div>
<h3 id="record-attributes"><a class="header" href="#record-attributes">Record attributes</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Description</th><th>Example</th><th>Available since</th></tr></thead><tbody>
<tr><td>@this</td><td>returns the record it self</td><td>select <strong>@this.toJSON()</strong> from Account</td><td>0.9.25</td></tr>
<tr><td>@rid</td><td>returns the <a href="sql/../datamodeling/Concepts.html#record-id">Record ID</a> in the form &lt;cluster:position&gt;. It's null for embedded records. *NOTE: using @rid in where condition slow down queries. Much better to use the <a href="sql/../datamodeling/Concepts.html#record-id">Record ID</a> as target. Example: change this: select from Profile where @rid = #10:44 with this: select from #10:44 *</td><td><strong>@rid</strong> = #11:0</td><td>0.9.21</td></tr>
<tr><td>@class</td><td>returns Class name only for record of type Schema Aware. It's null for the others</td><td><strong>@class</strong> = 'Profile'</td><td>0.9.21</td></tr>
<tr><td>@version</td><td>returns the record version as integer. Version starts from 0. Can't be null</td><td><strong>@version</strong> &gt; 0</td><td>0.9.21</td></tr>
<tr><td>@size</td><td>returns the record size in bytes</td><td><strong>@size</strong> &gt; 1024</td><td>0.9.21</td></tr>
<tr><td>@fields</td><td>returns the number of fields in document</td><td>select @fields from V</td><td>-</td></tr>
<tr><td>@type</td><td>returns the record type between: 'document', 'column', 'flat', 'bytes'</td><td><strong>@type</strong> = 'flat'</td><td>0.9.21</td></tr>
</tbody></table>
</div>
<h2 id="operators-1"><a class="header" href="#operators-1">Operators</a></h2>
<h3 id="conditional-operators"><a class="header" href="#conditional-operators">Conditional Operators</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Apply to</th><th>Operator</th><th>Description</th><th>Example</th><th>Available since</th></tr></thead><tbody>
<tr><td>any</td><td>=</td><td>Equals to</td><td>name <strong>=</strong> 'Luke'</td><td>0.9.1</td></tr>
<tr><td>string</td><td>like</td><td>Similar to equals, but allow the wildcard '%' that means 'any'</td><td>name <strong>like</strong> 'Luk%'</td><td>0.9.1</td></tr>
<tr><td>any</td><td>&lt;</td><td>Less than</td><td>age <strong>&lt;</strong> 40</td><td>0.9.1</td></tr>
<tr><td>any</td><td>&lt;=</td><td>Less than or equal to</td><td>age <strong>&lt;=</strong> 40</td><td>0.9.1</td></tr>
<tr><td>any</td><td>&gt;</td><td>Greater than</td><td>age <strong>&gt;</strong> 40</td><td>0.9.1</td></tr>
<tr><td>any</td><td>&gt;=</td><td>Greater than or equal to</td><td>age <strong>&gt;=</strong> 40</td><td>0.9.1</td></tr>
<tr><td>any</td><td>&lt;&gt;</td><td>Not equals (same of !=)</td><td>age <strong>&lt;&gt;</strong> 40</td><td>0.9.1</td></tr>
<tr><td>any</td><td>BETWEEN</td><td>The value is between a range. It's equivalent to &lt;field&gt; &gt;= &lt;from-value&gt; AND &lt;field&gt; &lt;= &lt;to-value&gt;</td><td>price BETWEEN 10 and 30</td><td>1.0rc2</td></tr>
<tr><td>any</td><td>IS</td><td>Used to test if a value is NULL</td><td>children <strong>is</strong> null</td><td>0.9.6</td></tr>
<tr><td>record, string (as class name)</td><td>INSTANCEOF</td><td>Used to check if the record extends a class</td><td>@this <strong>instanceof</strong> 'Customer' or @class <strong>instanceof</strong> 'Provider'</td><td>1.0rc8</td></tr>
<tr><td>collection</td><td>IN</td><td>contains any of the elements listed</td><td>name <strong>in</strong> ['European','Asiatic']</td><td></td></tr>
<tr><td>collection</td><td>CONTAINS</td><td>true if the collection contains at least one element that satisfy the next condition. Condition can be a single item: in this case the behaviour is like the IN operator</td><td>children <strong>contains</strong> (name = 'Luke') - map.values() <strong>contains</strong> (name = 'Luke')</td><td>0.9.7</td></tr>
<tr><td>collection</td><td>CONTAINSALL</td><td>true if all the elements of the collection satisfy the next condition</td><td>children <em>containsAll</em> (name = 'Luke')</td><td>0.9.7</td></tr>
<tr><td>collection</td><td>CONTAINSANY</td><td>true if any the elements of the collection satisfy the next condition</td><td>children <em>containsAny</em> (name = 'Luke')</td><td></td></tr>
<tr><td>map</td><td>CONTAINSKEY</td><td>true if the map contains at least one key equals to the requested. You can also use map.keys() CONTAINS in place of it</td><td>connections <em>containsKey</em> 'Luke'</td><td>0.9.22</td></tr>
<tr><td>map</td><td>CONTAINSVALUE</td><td>true if the map contains at least one value equals to the requested. You can also use map.values() CONTAINS in place of it</td><td>connections <em>containsValue</em> 10:3</td><td>0.9.22</td></tr>
<tr><td>string</td><td>CONTAINSTEXT</td><td>When used against an indexed field, a lookup in the index will be performed with the text specified as key. When there is no index a simple Java indexOf will be performed. So the result set could be different if you have an index or not on that field</td><td>text <em>containsText</em> 'jay'</td><td>0.9.22</td></tr>
<tr><td>string</td><td>MATCHES</td><td>Matches the string using a [http://www.regular-expressions.info/ Regular Expression]</td><td>text matches '\b[A-Z0-9.%+-]+@[A-Z0-9.-]+.[A-Z]{2,4}\b'</td><td>0.9.6</td></tr>
<tr><td>any</td><td>TRAVERSE[(&lt;minDepth&gt; [,&lt;maxDepth&gt; [,&lt;fields&gt;]]</td><td><em>This function was born before the SQL Traverse statement and today it's pretty limited. Look at <a href="sql/../java/Java-Traverse.html">Traversing graphs</a> to know more about traversing in better ways.</em> <br>true if traversing the declared field(s) at the level from &lt;minDepth&gt; to &lt;maxDepth&gt; matches the condition. A minDepth = 0 means the root node, maxDepth = -1 means no limit: traverse all the graph recursively. If &lt;minDepth&gt; and &lt;maxDepth&gt; are not used, then (0, -1) will be taken. If &lt;fields&gt; is not passed, than any() will be used.</td><td>select from profile where any() <strong>traverse(0,7,'followers,followings')</strong> ( address.city.name = 'Rome' )</td><td>0.9.10 and 0.9.24 for &lt;fields&gt; parameter</td></tr>
</tbody></table>
</div>
<h3 id="logical-operators"><a class="header" href="#logical-operators">Logical Operators</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Operator</th><th>Description</th><th>Example</th><th>Available since</th></tr></thead><tbody>
<tr><td>AND</td><td>true if both the conditions are true</td><td>name = 'Luke' <strong>and</strong> surname like 'Sky%'</td><td>0.9.1</td></tr>
<tr><td>OR</td><td>true if at least one of the condition is true</td><td>name = 'Luke' <strong>or</strong> surname like 'Sky%'</td><td>0.9.1</td></tr>
<tr><td>NOT</td><td>true if the condition is false. NOT needs parenthesis on the right with the condition to negate</td><td><strong>not</strong> ( name = 'Luke')</td><td>1.2</td></tr>
</tbody></table>
</div>
<h3 id="mathematics-operators"><a class="header" href="#mathematics-operators">Mathematics Operators</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Apply to</th><th>Operator</th><th>Description</th><th>Example</th><th>Available since</th></tr></thead><tbody>
<tr><td>Numbers</td><td>+</td><td>Plus</td><td>age + 34</td><td>1.0rc7</td></tr>
<tr><td>Numbers</td><td>-</td><td>Minus</td><td>salary - 34</td><td>1.0rc7</td></tr>
<tr><td>Numbers</td><td>*</td><td>Multiply</td><td>factor * 1.3</td><td>1.0rc7</td></tr>
<tr><td>Numbers</td><td>/</td><td>Divide</td><td>total / 12</td><td>1.0rc7</td></tr>
<tr><td>Numbers</td><td>%</td><td>Mod</td><td>total % 3</td><td>1.0rc7</td></tr>
</tbody></table>
</div>
<p>Starting from v1.4 OrientDB supports the <code>eval()</code> function to execute complex operations. Example:</p>
<pre><code class="language-sql">select eval( "amount * 120 / 100 - discount" ) as finalPrice from Order
</code></pre>
<h3 id="methods"><a class="header" href="#methods">Methods</a></h3>
<p>Also called "Field Operators", are <a href="sql/SQL-Methods.html">are treated on a separate page</a>.</p>
<h2 id="functions-3"><a class="header" href="#functions-3">Functions</a></h2>
<p>All the <a href="sql/SQL-Functions.html">SQL functions are treated on a separate page</a>.</p>
<h2 id="variables"><a class="header" href="#variables">Variables</a></h2>
<p>OrientDB supports variables managed in the context of the command/query. By default some variables are created. Below the table with the available variables:</p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Description</th><th>Command(s)</th><th>Since</th></tr></thead><tbody>
<tr><td>$parent</td><td>Get the parent context from a sub-query. Example: select from V let $type = ( traverse * from $parent.$current.children )</td><td><a href="sql/SQL-Query.html">SELECT</a> and <a href="sql/SQL-Traverse.html">TRAVERSE</a></td><td>1.2.0</td></tr>
<tr><td>$current</td><td>Current record to use in sub-queries to refer from the parent's variable</td><td><a href="sql/SQL-Query.html">SELECT</a> and <a href="sql/SQL-Traverse.html">TRAVERSE</a></td><td>1.2.0</td></tr>
<tr><td>$depth</td><td>The current depth of nesting</td><td><a href="sql/SQL-Traverse.html">TRAVERSE</a></td><td>1.1.0</td></tr>
<tr><td>$path</td><td>The string representation of the current path. Example:  #6:0.in.#5:0#.out. You can also display it with -&gt; select $path from (traverse * from V)</td><td><a href="sql/SQL-Traverse.html">TRAVERSE</a></td><td>1.1.0</td></tr>
<tr><td>$stack</td><td>The List of operation in the stack. Use it to access to the history of the traversal</td><td><a href="sql/SQL-Traverse.html">TRAVERSE</a></td><td>1.1.0</td></tr>
<tr><td>$history</td><td>The set of all the records traversed as a Set&lt;ORID&gt;</td><td><a href="sql/SQL-Traverse.html">TRAVERSE</a></td><td>1.1.0</td></tr>
</tbody></table>
</div>
<p>To set custom variable use the <a href="sql/SQL-Query.html#let-block">LET</a> keyword.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql---functions"><a class="header" href="#sql---functions">SQL - Functions</a></h1>
<h2 id="bundled-functions"><a class="header" href="#bundled-functions">Bundled functions</a></h2>
<h3 id="functions-by-category"><a class="header" href="#functions-by-category">Functions by category</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Graph</th><th>Math</th><th>Collections</th><th>Misc</th></tr></thead><tbody>
<tr><td><a href="sql/SQL-Functions.html#out">out()</a></td><td><a href="sql/SQL-Functions.html#eval">eval()</a></td><td><a href="sql/SQL-Functions.html#set">set()</a></td><td><a href="sql/SQL-Functions.html#date">date()</a></td></tr>
<tr><td><a href="sql/SQL-Functions.html#in">in()</a></td><td><a href="sql/SQL-Functions.html#min">min()</a></td><td><a href="sql/SQL-Functions.html#map">map()</a></td><td><a href="sql/SQL-Functions.html#sysdate">sysdate()</a></td></tr>
<tr><td><a href="sql/SQL-Functions.html#both">both()</a></td><td><a href="sql/SQL-Functions.html#max">max()</a></td><td><a href="sql/SQL-Functions.html#list">list()</a></td><td><a href="sql/SQL-Functions.html#format">format()</a></td></tr>
<tr><td><a href="sql/SQL-Functions.html#oute">outE()</a></td><td><a href="sql/SQL-Functions.html#sum">sum()</a></td><td><a href="sql/SQL-Functions.html#difference">difference()</a></td><td><a href="sql/SQL-Functions.html#distance">distance()</a></td></tr>
<tr><td><a href="sql/SQL-Functions.html#ine">inE()</a></td><td><a href="sql/SQL-Functions.html#abs">abs()</a></td><td><a href="sql/SQL-Functions.html#first">first()</a></td><td><a href="sql/SQL-Functions.html#ifnull">ifnull()</a></td></tr>
<tr><td><a href="sql/SQL-Functions.html#bothe">bothE()</a></td><td><a href="sql/SQL-Functions.html#abs">decimal()</a></td><td><a href="sql/SQL-Functions.html#intersect">intersect()</a></td><td><a href="sql/SQL-Functions.html#coalesce">coalesce()</a></td></tr>
<tr><td><a href="sql/SQL-Functions.html#outv">outV()</a></td><td><a href="sql/SQL-Functions.html#avg">avg()</a></td><td><a href="sql/SQL-Functions.html#distinct">distinct()</a></td><td><a href="sql/SQL-Functions.html#uuid">uuid()</a></td></tr>
<tr><td><a href="sql/SQL-Functions.html#inv">inV()</a></td><td><a href="sql/SQL-Functions.html#count">count()</a></td><td><a href="sql/SQL-Functions.html#expand">expand()</a></td><td><a href="sql/SQL-Functions.html#if">if()</a></td></tr>
<tr><td><a href="sql/SQL-Functions.html#traversedelement">traversedElement()</a></td><td><a href="sql/SQL-Functions.html#mode">mode()</a></td><td><a href="sql/SQL-Functions.html#unionall">unionall()</a></td><td></td></tr>
<tr><td><a href="sql/SQL-Functions.html#traversedvertex">traversedVertex()</a></td><td><a href="sql/SQL-Functions.html#median">median()</a></td><td><a href="sql/SQL-Functions.html#flatten">flatten()</a></td><td></td></tr>
<tr><td><a href="sql/SQL-Functions.html#traversededge">traversedEdge()</a></td><td><a href="sql/SQL-Functions.html#percentile">percentile()</a></td><td><a href="sql/SQL-Functions.html#last">last()</a></td><td></td></tr>
<tr><td><a href="sql/SQL-Functions.html#shortestpath">shortestPath()</a></td><td><a href="sql/SQL-Functions.html#variance">variance()</a></td><td><a href="sql/SQL-Functions.html#symmetricdifference">symmetricDifference()</a></td><td>-</td></tr>
<tr><td><a href="sql/SQL-Functions.html#dijkstra">dijkstra()</a></td><td><a href="sql/SQL-Functions.html#stddev">stddev()</a></td><td></td><td></td></tr>
<tr><td><a href="sql/SQL-Functions.html#astar">astar()</a></td><td></td><td></td><td></td></tr>
<tr><td><a href="sql/SQL-Functions.html#astar">bothV()</a></td><td></td><td></td><td></td></tr>
</tbody></table>
</div>
<p>SQL Functions are all the functions bundled with OrientDB SQL engine. You can create your own <a href="sql/../admin/Functions.html">Database Functions</a> in any language supported by JVM. Look also to <a href="sql/SQL-Methods.html">SQL Methods</a>.</p>
<p>SQL Functions can work in 2 ways based on the fact that they can receive 1 or more parameters:</p>
<h2 id="aggregated-mode"><a class="header" href="#aggregated-mode">Aggregated mode</a></h2>
<p>When only one parameter is passed, the function aggregates the result in only one record. The classic example is the <code>sum()</code> function:</p>
<pre><code class="language-sql">SELECT SUM(salary) FROM employee
</code></pre>
<p>This will always return one record: the sum of salary fields across every employee record.</p>
<h2 id="inline-mode"><a class="header" href="#inline-mode">Inline mode</a></h2>
<p>When two or more parameters are passed:</p>
<pre><code class="language-sql">SELECT SUM(salary, extra, benefits) AS total FROM employee
</code></pre>
<p>This will return the sum of the field "salary", "extra" and "benefits" as "total".</p>
<p>In case you need to use a function inline, when you only have one parameter, then add "null" as the second parameter:</p>
<pre><code class="language-sql">SELECT first( out('friends').name, null ) as firstFriend FROM Profiles
</code></pre>
<p>In the above example, the <code>first()</code> function doesn't aggregate everything in only one record, but rather returns one record per <code>Profile</code>, where the <code>firstFriend</code> is the first item of the collection received as the parameter.</p>
<p>##Function Reference</p>
<h3 id="out"><a class="header" href="#out">out()</a></h3>
<p>Get the adjacent outgoing vertices starting from the current record as Vertex.</p>
<p>Syntax: <code>out([&lt;label-1&gt;][,&lt;label-n&gt;]*)</code></p>
<p>Available since: 1.4.0</p>
<h4 id="example-6"><a class="header" href="#example-6">Example</a></h4>
<p>Get all the outgoing vertices from all the Vehicle vertices:</p>
<pre><code class="language-sql">SELECT out() FROM V
</code></pre>
<p>Get all the incoming vertices connected with edges with label (class) "Eats" and "Favorited" from all the Restaurant vertices in Rome:</p>
<pre><code class="language-sql">SELECT out('Eats','Favorited') FROM Restaurant WHERE city = 'Rome'
</code></pre>
<hr />
<h3 id="in"><a class="header" href="#in">in()</a></h3>
<p>Get the adjacent incoming vertices starting from the current record as Vertex.</p>
<p>Syntax:</p>
<pre><code>in([&lt;label-1&gt;][,&lt;label-n&gt;]*)
</code></pre>
<p>Available since: 1.4.0</p>
<h4 id="example-7"><a class="header" href="#example-7">Example</a></h4>
<p>Get all the incoming vertices from all the V vertices:</p>
<pre><code class="language-sql">SELECT in() FROM V
</code></pre>
<p>Get all the incoming vertices connected with edges with label (class) "Friend" and "Brother":</p>
<pre><code class="language-sql">SELECT in('Friend','Brother') FROM V
</code></pre>
<hr />
<h3 id="both"><a class="header" href="#both">both()</a></h3>
<p>Get the adjacent outgoing and incoming vertices starting from the current record as Vertex.</p>
<p>Syntax:</p>
<pre><code>both([&lt;label1&gt;][,&lt;label-n&gt;]*)
</code></pre>
<p>Available since: 1.4.0</p>
<h4 id="example-8"><a class="header" href="#example-8">Example</a></h4>
<p>Get all the incoming and outgoing vertices from vertex with rid #13:33:</p>
<pre><code class="language-sql">SELECT both() FROM #13:33
</code></pre>
<p>Get all the incoming and outgoing vertices connected by edges with label (class) "Friend" and "Brother":</p>
<pre><code class="language-sql">SELECT both('Friend','Brother') FROM V
</code></pre>
<hr />
<h3 id="oute"><a class="header" href="#oute">outE()</a></h3>
<p>Get the adjacent outgoing edges starting from the current record as Vertex.</p>
<p>Syntax:</p>
<pre><code>outE([&lt;label1&gt;][,&lt;label-n&gt;]*)
</code></pre>
<p>Available since: 1.4.0</p>
<h4 id="example-9"><a class="header" href="#example-9">Example</a></h4>
<p>Get all the outgoing edges from all the vertices:</p>
<pre><code class="language-sql">SELECT outE() FROM V
</code></pre>
<p>Get all the outgoing edges of type "Eats" from all the SocialNetworkProfile vertices:</p>
<pre><code class="language-sql">SELECT outE('Eats') FROM SocialNetworkProfile
</code></pre>
<hr />
<h3 id="ine"><a class="header" href="#ine">inE()</a></h3>
<p>Get the adjacent incoming edges starting from the current record as Vertex.</p>
<p>Syntax:</p>
<pre><code>inE([&lt;label1&gt;][,&lt;label-n&gt;]*)
</code></pre>
<h4 id="example-10"><a class="header" href="#example-10">Example</a></h4>
<p>Get all the incoming edges from all the vertices:</p>
<pre><code class="language-sql">SELECT inE() FROM V
</code></pre>
<p>Get all the incoming edges of type "Eats" from the Restaurant 'Bella Napoli':</p>
<pre><code class="language-sql">SELECT inE('Eats') FROM Restaurant WHERE name = 'Bella Napoli'
</code></pre>
<hr />
<h3 id="bothe"><a class="header" href="#bothe">bothE()</a></h3>
<p>Get the adjacent outgoing and incoming edges starting from the current record as Vertex.</p>
<p>Syntax: <code>bothE([&lt;label1&gt;][,&lt;label-n&gt;]*)</code></p>
<p>Available since: 1.4.0</p>
<h4 id="example-11"><a class="header" href="#example-11">Example</a></h4>
<p>Get both incoming and outgoing edges from all the vertices:</p>
<pre><code class="language-sql">SELECT bothE() FROM V
</code></pre>
<p>Get all the incoming and outgoing edges of type "Friend" from the Profiles with nickname 'Jay'</p>
<pre><code class="language-sql">SELECT bothE('Friend') FROM Profile WHERE nickname = 'Jay'
</code></pre>
<hr />
<h3 id="bothv"><a class="header" href="#bothv">bothV()</a></h3>
<p>Get the adjacent outgoing and incoming vertices starting from the current record as Edge.</p>
<p>Syntax: <code>bothV()</code></p>
<p>Available since: 1.4.0</p>
<h4 id="example-12"><a class="header" href="#example-12">Example</a></h4>
<p>Get both incoming and outgoing vertices from all the edges:</p>
<pre><code class="language-sql">SELECT bothV() FROM E
</code></pre>
<h3 id="outv"><a class="header" href="#outv">outV()</a></h3>
<p>Get outgoing vertices starting from the current record as Edge.</p>
<p>Syntax:</p>
<pre><code>outV()
</code></pre>
<p>Available since: 1.4.0</p>
<h4 id="example-13"><a class="header" href="#example-13">Example</a></h4>
<p>Get outgoing vertices from all edges</p>
<pre><code class="language-sql">SELECT outV() FROM E
</code></pre>
<h3 id="inv"><a class="header" href="#inv">inV()</a></h3>
<p>Get incoming vertices starting from the current record as Edge.</p>
<p>Syntax:</p>
<pre><code>inV()
</code></pre>
<p>Available since: 1.4.0</p>
<h4 id="example-14"><a class="header" href="#example-14">Example</a></h4>
<p>Get incoming vertices from all edges</p>
<pre><code class="language-sql">SELECT inV() FROM E
</code></pre>
<h3 id="eval"><a class="header" href="#eval">eval()</a></h3>
<p>Syntax: <code>eval('&lt;expression&gt;')</code></p>
<p>Evaluates the expression between quotes (or double quotes).</p>
<p>Available since: 1.4.0</p>
<h4 id="example-15"><a class="header" href="#example-15">Example</a></h4>
<pre><code class="language-sql">SELECT eval('price * 120 / 100 - discount') AS finalPrice FROM Order
</code></pre>
<h3 id="coalesce"><a class="header" href="#coalesce">coalesce()</a></h3>
<p>Returns the first field/value not null parameter. If no field/value is not null, returns null.</p>
<p>Syntax:</p>
<pre><code>coalesce(&lt;field|value&gt; [, &lt;field-n|value-n&gt;]*)
</code></pre>
<p>Available since: 1.3.0</p>
<h4 id="example-16"><a class="header" href="#example-16">Example</a></h4>
<pre><code class="language-sql">SELECT coalesce(amount, amount2, amount3) FROM Account
</code></pre>
<h3 id="if"><a class="header" href="#if">if()</a></h3>
<p>Syntax:</p>
<pre><code>if(&lt;expression&gt;, &lt;result-if-true&gt;, &lt;result-if-false&gt;)
</code></pre>
<p>Evaluates a condition (first parameters) and returns the second parameter if the condition is true, and the third parameter otherwise.</p>
<h4 id="example-17"><a class="header" href="#example-17">Example:</a></h4>
<pre><code>SELECT if(eval("name = 'John'"), "My name is John", "My name is not John") FROM Person
</code></pre>
<h3 id="ifnull"><a class="header" href="#ifnull">ifnull()</a></h3>
<p>Returns the passed field/value (or optional parameter <em>return_value_if_not_null</em>). If field/value is not null, otherwise it returns <em>return_value_if_null</em>.</p>
<p>Syntax:</p>
<pre><code class="language-java">ifnull(&lt;field/value&gt;, &lt;return_value_if_null&gt;)
</code></pre>
<p>Available since: 1.3.0</p>
<h4 id="example-18"><a class="header" href="#example-18">Example</a></h4>
<pre><code class="language-sql">SELECT ifnull(salary, 0) FROM Account
</code></pre>
<hr />
<h3 id="expand"><a class="header" href="#expand">expand()</a></h3>
<p>Available since: 1.4.0</p>
<p>This function has two meanings:</p>
<ul>
<li>When used on a collection field, it unwinds the collection in the field <field> and use it as result.</li>
<li>When used on a link (RID) field, it expands the document pointed by that link.</li>
</ul>
<p>Syntax: <code>expand(&lt;field&gt;)</code></p>
<p>Since version 2.1 the preferred operator to unwind collections is <a href="sql/SQL-Query.html#unwinding">UNWIND</a>. Expand usage for this use case will probably be deprecated in next releases</p>
<h4 id="example-19"><a class="header" href="#example-19">Example</a></h4>
<p>on collections:</p>
<pre><code class="language-sql">SELECT EXPAND( addresses ) FROM Account. 
</code></pre>
<p>on RIDs</p>
<pre><code class="language-sql">SELECT EXPAND( addresses ) FROM Account. 
</code></pre>
<p>This replaces the flatten() now deprecated</p>
<hr />
<h3 id="flatten"><a class="header" href="#flatten">flatten()</a></h3>
<blockquote>
<p>Deprecated, use the EXPAND() instead.</p>
</blockquote>
<p>Extracts the collection in the field <field> and use it as result.</p>
<p>Syntax:</p>
<pre><code>flatten(&lt;field&gt;)
</code></pre>
<p>Available since: 1.0rc1</p>
<h4 id="example-20"><a class="header" href="#example-20">Example</a></h4>
<pre><code class="language-sql">SELECT flatten( addresses ) FROM Account
</code></pre>
<hr />
<h3 id="first"><a class="header" href="#first">first()</a></h3>
<p>Retrieves only the first item of multi-value fields (arrays, collections and maps). For non multi-value types just returns the value.</p>
<p>Syntax: <code>first(&lt;field&gt;)</code></p>
<p>Available since: 1.2.0</p>
<h4 id="example-21"><a class="header" href="#example-21">Example</a></h4>
<pre><code class="language-sql">select first( addresses ) from Account
</code></pre>
<hr />
<h3 id="last"><a class="header" href="#last">last()</a></h3>
<p>Retrieves only the last item of multi-value fields (arrays, collections and maps). For non multi-value types just returns the value.</p>
<p>Syntax: <code>last(&lt;field&gt;)</code></p>
<p>Available since: 1.2.0</p>
<h4 id="example-22"><a class="header" href="#example-22">Example</a></h4>
<pre><code class="language-sql">SELECT last( addresses ) FROM Account
</code></pre>
<hr />
<h3 id="count"><a class="header" href="#count">count()</a></h3>
<p>Counts the records that match the query condition. If * is not used as a field, then the record will be counted only if the field content is not null.</p>
<p>Syntax: <code>count(&lt;field&gt;)</code></p>
<p>Available since: 0.9.25</p>
<h4 id="example-23"><a class="header" href="#example-23">Example</a></h4>
<pre><code class="language-sql">SELECT COUNT(*) FROM Account
</code></pre>
<hr />
<h3 id="min"><a class="header" href="#min">min()</a></h3>
<p>Returns the minimum value. If invoked with more than one parameter, the function doesn't aggregate but returns the minimum value between all the arguments.</p>
<p>Syntax: <code>min(&lt;field&gt; [, &lt;field-n&gt;]* )</code></p>
<p>Available since: 0.9.25</p>
<h4 id="example-24"><a class="header" href="#example-24">Example</a></h4>
<p>Returns the minimum salary of all the Account records:</p>
<pre><code class="language-sql">SELECT min(salary) FROM Account
</code></pre>
<p>Returns the minimum value between 'salary1', 'salary2' and 'salary3' fields.</p>
<pre><code class="language-sql">SELECT min(salary1, salary2, salary3) FROM Account
</code></pre>
<hr />
<h3 id="max"><a class="header" href="#max">max()</a></h3>
<p>Returns the maximum value. If invoked with more than one parameter, the function doesn't aggregate, but returns the maximum value between all the arguments.</p>
<p>Syntax: <code>max(&lt;field&gt; [, &lt;field-n&gt;]* )</code></p>
<p>Available since: 0.9.25</p>
<h4 id="example-25"><a class="header" href="#example-25">Example</a></h4>
<p>Returns the maximum salary of all the Account records:</p>
<pre><code class="language-sql">SELECT max(salary) FROM Account.
</code></pre>
<p>Returns the maximum value between 'salary1', 'salary2' and 'salary3' fields.</p>
<pre><code class="language-sql">SELECT max(salary1, salary2, salary3) FROM Account
</code></pre>
<hr />
<h3 id="abs"><a class="header" href="#abs">abs()</a></h3>
<p>Returns the absolute value. It works with Integer, Long, Short, Double, Float, BigInteger, BigDecimal, null.</p>
<p>Syntax: <code>abs(&lt;field&gt;)</code></p>
<p>Available since: 2.2</p>
<h4 id="example-26"><a class="header" href="#example-26">Example</a></h4>
<pre><code class="language-sql">SELECT abs(score) FROM Account
SELECT abs(-2332) FROM Account
SELECT abs(999) FROM Account
</code></pre>
<hr />
<h3 id="avg"><a class="header" href="#avg">avg()</a></h3>
<p>Returns the average value.</p>
<p>Syntax: <code>avg(&lt;field&gt;)</code></p>
<p>Available since: 0.9.25</p>
<h4 id="example-27"><a class="header" href="#example-27">Example</a></h4>
<pre><code class="language-sql">SELECT avg(salary) FROM Account
</code></pre>
<hr />
<h3 id="sum"><a class="header" href="#sum">sum()</a></h3>
<p>Syntax: <code>sum(&lt;field&gt;)</code></p>
<p>Returns the sum of all the values returned.</p>
<p>Available since: 0.9.25</p>
<h4 id="example-28"><a class="header" href="#example-28">Example</a></h4>
<pre><code class="language-sql">SELECT sum(salary) FROM Account
</code></pre>
<hr />
<h3 id="date"><a class="header" href="#date">date()</a></h3>
<p>Returns a date formatting a string. &lt;date-as-string&gt; is the date in string format, and &lt;format&gt; is the date format following these <a href="http://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html">rules</a>. If no format is specified, then the default database format is used. To know more about it, look at <a href="sql/../general/Managing-Dates.html">Managing Dates</a>.</p>
<p>Syntax: <code>date( &lt;date-as-string&gt; [&lt;format&gt;] [,&lt;timezone&gt;] )</code></p>
<p>Available since: 0.9.25</p>
<h4 id="example-29"><a class="header" href="#example-29">Example</a></h4>
<pre><code class="language-sql">SELECT FROM Account WHERE created &lt;= date('2012-07-02', 'yyyy-MM-dd')
</code></pre>
<hr />
<h3 id="sysdate"><a class="header" href="#sysdate">sysdate()</a></h3>
<p>Returns the current date time. If executed with no parameters, it returns a Date object, otherwise a string with the requested format/timezone. To know more about it, look at <a href="sql/../general/Managing-Dates.html">Managing Dates</a>.</p>
<p>Syntax: <code>sysdate( [&lt;format&gt;] [,&lt;timezone&gt;] )</code></p>
<p>Available since: 0.9.25</p>
<h4 id="example-30"><a class="header" href="#example-30">Example</a></h4>
<pre><code class="language-sql">SELECT sysdate('dd-MM-yyyy') FROM Account
</code></pre>
<hr />
<h3 id="format"><a class="header" href="#format">format()</a></h3>
<p>Formats a value using the <a href="http://download.oracle.com/javase/1.5.0/docs/api/java/lang/String.html">String.format()</a> conventions. Look <a href="http://download.oracle.com/javase/1.5.0/docs/api/java/util/Formatter.html#syntax">here for more information</a>.</p>
<p>Syntax: <code>format( &lt;format&gt; [,&lt;arg1&gt; ](,&lt;arg-n&gt;]*.md)</code></p>
<p>Available since: 0.9.25</p>
<h4 id="example-31"><a class="header" href="#example-31">Example</a></h4>
<pre><code class="language-sql">SELECT format("%d - Mr. %s %s (%s)", id, name, surname, address) FROM Account
</code></pre>
<hr />
<h4 id="decimal"><a class="header" href="#decimal">decimal()</a></h4>
<p>Converts a number or a String in an absolute precision, decimal number.</p>
<p>Syntax: <code>decimal( &lt;number&gt; | &lt;string&gt; )</code></p>
<h4 id="example-32"><a class="header" href="#example-32">Example</a></h4>
<pre><code class="language-sql">SELECT decimal('99.999999999999999999') FROM Account
</code></pre>
<hr />
<h3 id="astar"><a class="header" href="#astar">astar()</a></h3>
<p>A*'s algorithm describes how to find the cheapest path from one node to another node in a directed weighted graph with heuristic function.</p>
<p>The first parameter is source record. The second parameter is destination record. The third parameter is a name of property that
represents 'weight' and fourth represents the map of options.</p>
<p>If property is not defined in edge or is null, distance between vertexes are 0 .</p>
<p>Syntax: <code>astar(&lt;sourceVertex&gt;, &lt;destinationVertex&gt;, &lt;weightEdgeFieldName&gt;, [&lt;options&gt;]) </code></p>
<p>options:</p>
<pre><code>{
  direction:"OUT", //the edge direction (OUT, IN, BOTH)
  edgeTypeNames:[],  
  vertexAxisNames:[], 
  parallel : false, 
  tieBreaker:true,
  maxDepth:99999,
  dFactor:1.0,
  customHeuristicFormula:'custom_Function_Name_here'  // (MANHATAN, MAXAXIS, DIAGONAL, EUCLIDEAN, EUCLIDEANNOSQR, CUSTOM)
}
</code></pre>
<h4 id="example-33"><a class="header" href="#example-33">Example</a></h4>
<pre><code class="language-sql">SELECT astar($current, #8:10, 'weight') FROM V
</code></pre>
<hr />
<h3 id="dijkstra"><a class="header" href="#dijkstra">dijkstra()</a></h3>
<p>Returns the cheapest path between two vertices using the [http://en.wikipedia.org/wiki/Dijkstra's_algorithm Dijkstra algorithm] where the <strong>weightEdgeFieldName</strong> parameter is the field containing the weight. Direction can be OUT (default), IN or BOTH.</p>
<p>Syntax: <code>dijkstra(&lt;sourceVertex&gt;, &lt;destinationVertex&gt;, &lt;weightEdgeFieldName&gt; [, &lt;direction&gt;])</code></p>
<p>Available since: 1.3.0</p>
<h4 id="example-34"><a class="header" href="#example-34">Example</a></h4>
<pre><code class="language-sql">SELECT dijkstra($current, #8:10, 'weight') FROM V
</code></pre>
<hr />
<h3 id="shortestpath"><a class="header" href="#shortestpath">shortestPath()</a></h3>
<p>Returns the shortest path between two vertices. Direction can be OUT (default), IN or BOTH.</p>
<p>Available since: 1.3.0</p>
<p>Syntax: <code>shortestPath( &lt;sourceVertex&gt;, &lt;destinationVertex&gt; [, &lt;direction&gt; [, &lt;edgeClassName&gt; [, &lt;additionalParams&gt;]]])</code></p>
<p>Where:</p>
<ul>
<li><code>sourceVertex</code> is the source vertex where to start the path</li>
<li><code>destinationVertex</code> is the destination vertex where the path ends</li>
<li><code>direction</code>, optional, is the direction of traversing. By default is "BOTH" (in+out). Supported values are "BOTH" (incoming and outgoing), "OUT" (outgoing) and "IN" (incoming)</li>
<li><code>edgeClassName</code>, optional, is the edge class to traverse. By default all edges are crossed. Since 2.0.9 and 2.1-rc2. This can also be a list of edge class names (eg. <code>["edgeType1", "edgeType2"]</code>)</li>
<li><code>additionalParams</code> (since v 2.1.12), optional, here you can pass a map of additional parameters (Map&lt;String, Object&gt; in Java, JSON from SQL). Currently allowed parameters are
<ul>
<li>'maxDepth': integer, maximum depth for paths (ignore path longer that 'maxDepth')</li>
</ul>
</li>
</ul>
<h4 id="example-on-finding-the-shortest-path-between-vertices-832-and-810"><a class="header" href="#example-on-finding-the-shortest-path-between-vertices-832-and-810">Example on finding the shortest path between vertices #8:32 and #8:10</a></h4>
<pre><code class="language-sql">SELECT shortestPath(#8:32, #8:10)
</code></pre>
<h4 id="example-on-finding-the-shortest-path-between-vertices-832-and-810-only-crossing-outgoing-edges"><a class="header" href="#example-on-finding-the-shortest-path-between-vertices-832-and-810-only-crossing-outgoing-edges">Example on finding the shortest path between vertices #8:32 and #8:10 only crossing outgoing edges</a></h4>
<pre><code class="language-sql">SELECT shortestPath(#8:32, #8:10, 'OUT')
</code></pre>
<h4 id="example-on-finding-the-shortest-path-between-vertices-832-and-810-only-crossing-incoming-edges-of-type-friend"><a class="header" href="#example-on-finding-the-shortest-path-between-vertices-832-and-810-only-crossing-incoming-edges-of-type-friend">Example on finding the shortest path between vertices #8:32 and #8:10 only crossing incoming edges of type 'Friend'</a></h4>
<pre><code class="language-sql">SELECT shortestPath(#8:32, #8:10, 'IN', 'Friend')
</code></pre>
<h4 id="example-on-finding-the-shortest-path-between-vertices-832-and-810-only-crossing-incoming-edges-of-type-friend-or-colleague"><a class="header" href="#example-on-finding-the-shortest-path-between-vertices-832-and-810-only-crossing-incoming-edges-of-type-friend-or-colleague">Example on finding the shortest path between vertices #8:32 and #8:10 only crossing incoming edges of type 'Friend' or 'Colleague'</a></h4>
<pre><code class="language-sql">SELECT shortestPath(#8:32, #8:10, 'IN', ['Friend', 'Colleague'])
</code></pre>
<h4 id="example-on-finding-the-shortest-path-between-vertices-832-and-810-long-at-most-five-hops"><a class="header" href="#example-on-finding-the-shortest-path-between-vertices-832-and-810-long-at-most-five-hops">Example on finding the shortest path between vertices #8:32 and #8:10, long at most five hops</a></h4>
<pre><code class="language-sql">SELECT shortestPath(#8:32, #8:10, null, null, {"maxDepth": 5})
</code></pre>
<hr />
<h3 id="distance"><a class="header" href="#distance">distance()</a></h3>
<p>Syntax: <code>distance( &lt;x-field&gt;, &lt;y-field&gt;, &lt;x-value&gt;, &lt;y-value&gt; )</code></p>
<p>Returns the distance between two points in the globe using the Haversine algorithm. Coordinates must be as degrees.</p>
<p>Available since: 0.9.25</p>
<h4 id="example-35"><a class="header" href="#example-35">Example</a></h4>
<pre><code class="language-sql">SELECT FROM POI WHERE distance(x, y, 52.20472, 0.14056 ) &lt;= 30
</code></pre>
<hr />
<h3 id="distinct-2"><a class="header" href="#distinct-2">distinct()</a></h3>
<p>Syntax: <code>distinct(&lt;field&gt;)</code></p>
<p>Retrieves only unique data entries depending on the field you have specified as argument. The main difference compared to standard SQL DISTINCT is that with OrientDB, a function with parenthesis and only one field can be specified.</p>
<p>Available since: 1.0rc2</p>
<h4 id="example-36"><a class="header" href="#example-36">Example</a></h4>
<pre><code class="language-sql">SELECT distinct(name) FROM City
</code></pre>
<hr />
<h3 id="unionall"><a class="header" href="#unionall">unionall()</a></h3>
<p>Syntax: <code>unionall(&lt;field&gt; [,&lt;field-n&gt;]*)</code></p>
<p>Works as aggregate or inline. If only one argument is passed then aggregates, otherwise executes and returns a UNION of all the collections received as parameters. Also works with no collection values.</p>
<p>Available since: 1.7</p>
<h4 id="example-37"><a class="header" href="#example-37">Example</a></h4>
<pre><code class="language-sql">SELECT unionall(friends) FROM profile
</code></pre>
<pre><code class="language-sql">select unionall(inEdges, outEdges) from OGraphVertex where label = 'test'
</code></pre>
<hr />
<h3 id="intersect"><a class="header" href="#intersect">intersect()</a></h3>
<p>Syntax: <code>intersect(&lt;field&gt; [,&lt;field-n&gt;]*)</code></p>
<p>Works as aggregate or inline. If only one argument is passed then it aggregates, otherwise executes and returns the INTERSECTION of the collections received as parameters.</p>
<p>Available since: 1.0rc2</p>
<h4 id="example-38"><a class="header" href="#example-38">Example</a></h4>
<pre><code class="language-sql">SELECT intersect(friends) FROM profile WHERE jobTitle = 'programmer'
</code></pre>
<pre><code class="language-sql">SELECT intersect(inEdges, outEdges) FROM OGraphVertex
</code></pre>
<hr />
<h3 id="difference"><a class="header" href="#difference">difference()</a></h3>
<p>Syntax: <code>difference(&lt;field&gt; [,&lt;field-n&gt;]*)</code></p>
<p>Works as aggregate or inline. If only one argument is passed then it aggregates, otherwise it executes and returns the DIFFERENCE between the collections received as parameters.</p>
<p>Available since: 1.0rc2</p>
<h4 id="example-39"><a class="header" href="#example-39">Example</a></h4>
<pre><code class="language-sql">SELECT difference(tags) FROM book
</code></pre>
<pre><code class="language-sql">SELECT difference(inEdges, outEdges) FROM OGraphVertex
</code></pre>
<hr />
<h3 id="symmetricdifference"><a class="header" href="#symmetricdifference">symmetricDifference()</a></h3>
<p>Syntax: <code>symmetricDifference(&lt;field&gt; [,&lt;field-n&gt;]*)</code></p>
<p>Works as aggregate or inline. If only one argument is passed then it aggregates, otherwise executes and returns the SYMMETRIC DIFFERENCE between the collections received as parameters.</p>
<p>Available since: 2.0.7</p>
<h4 id="example-40"><a class="header" href="#example-40">Example</a></h4>
<pre><code class="language-sql">SELECT difference(tags) FROM book
</code></pre>
<pre><code class="language-sql">SELECT difference(inEdges, outEdges) FROM OGraphVertex
</code></pre>
<hr />
<h3 id="set"><a class="header" href="#set">set()</a></h3>
<p>Adds a value to a set. The first time the set is created. If <code>&lt;value&gt;</code> is a collection, then is merged with the set, otherwise <code>&lt;value&gt;</code> is added to the set.</p>
<p>Syntax: <code>set(&lt;field&gt;)</code></p>
<p>Available since: 1.2.0</p>
<h4 id="example-41"><a class="header" href="#example-41">Example</a></h4>
<pre><code class="language-sql">SELECT name, set(roles.name) AS roles FROM OUser
</code></pre>
<hr />
<h3 id="list"><a class="header" href="#list">list()</a></h3>
<p>Adds a value to a list. The first time the list is created. If <code>&lt;value&gt;</code> is a collection, then is merged with the list, otherwise <code>&lt;value&gt;</code> is added to the list.</p>
<p>Syntax: <code>list(&lt;field&gt;)</code></p>
<p>Available since: 1.2.0</p>
<h4 id="example-42"><a class="header" href="#example-42">Example</a></h4>
<pre><code class="language-sql">SELECT name, list(roles.name) AS roles FROM OUser
</code></pre>
<hr />
<h3 id="map"><a class="header" href="#map">map()</a></h3>
<p>Adds a value to a map. The first time the map is created. If <code>&lt;value&gt;</code> is a map, then is merged with the map, otherwise the pair <code>&lt;key&gt;</code> and <code>&lt;value&gt;</code> is added to the map as new entry.</p>
<p>Syntax: <code>map(&lt;key&gt;, &lt;value&gt;)</code></p>
<p>Available since: 1.2.0</p>
<h4 id="example-43"><a class="header" href="#example-43">Example</a></h4>
<pre><code class="language-sql">SELECT map(name, roles.name) FROM OUser
</code></pre>
<hr />
<h3 id="traversedelement"><a class="header" href="#traversedelement">traversedElement()</a></h3>
<p>Returns the traversed element(s) in Traverse commands.</p>
<p>Syntax: <code>traversedElement(&lt;index&gt; [,&lt;items&gt;])</code></p>
<p>Where:</p>
<ul>
<li><code>&lt;index&gt;</code> is the starting item to retrieve. Value &gt;= 0 means absolute position in the traversed stack. 0 means the first record. Negative values are counted from the end: -1 means last one, -2 means the record before last one, etc.</li>
<li><code>&lt;items&gt;</code>, optional, by default is 1. If &gt;1 a collection of items is returned</li>
</ul>
<p>Available since: 1.7</p>
<h4 id="example-44"><a class="header" href="#example-44">Example</a></h4>
<p>Returns last traversed item of TRAVERSE command:</p>
<pre><code class="language-sql">SELECT traversedElement(-1) FROM ( TRAVERSE out() FROM #34:3232 WHILE $depth &lt;= 10 )
</code></pre>
<p>Returns last 3 traversed items of TRAVERSE command:</p>
<pre><code class="language-sql">SELECT traversedElement(-1, 3) FROM ( TRAVERSE out() FROM #34:3232 WHILE $depth &lt;= 10 )
</code></pre>
<hr />
<h3 id="traversededge"><a class="header" href="#traversededge">traversedEdge()</a></h3>
<p>Returns the traversed edge(s) in Traverse commands.</p>
<p>Syntax: <code>traversedEdge(&lt;index&gt; [,&lt;items&gt;])</code></p>
<p>Where:</p>
<ul>
<li><code>&lt;index&gt;</code> is the starting edge to retrieve. Value &gt;= 0 means absolute position in the traversed stack. 0 means the first record. Negative values are counted from the end: -1 means last one, -2 means the edge before last one, etc.</li>
<li><code>&lt;items&gt;</code>, optional, by default is 1. If &gt;1 a collection of edges is returned</li>
</ul>
<p>Available since: 1.7</p>
<h4 id="example-45"><a class="header" href="#example-45">Example</a></h4>
<p>Returns last traversed edge(s) of TRAVERSE command:</p>
<pre><code class="language-sql">SELECT traversedEdge(-1) FROM ( TRAVERSE outE(), inV() FROM #34:3232 WHILE $depth &lt;= 10 )
</code></pre>
<p>Returns last 3 traversed edge(s) of TRAVERSE command:</p>
<pre><code class="language-sql">SELECT traversedEdge(-1, 3) FROM ( TRAVERSE outE(), inV() FROM #34:3232 WHILE $depth &lt;= 10 )
</code></pre>
<hr />
<h3 id="traversedvertex"><a class="header" href="#traversedvertex">traversedVertex()</a></h3>
<p>Returns the traversed vertex(es) in Traverse commands.</p>
<p>Syntax: <code>traversedVertex(&lt;index&gt; [,&lt;items&gt;])</code></p>
<p>Where:</p>
<ul>
<li><code>&lt;index&gt;</code> is the starting vertex to retrieve. Value &gt;= 0 means absolute position in the traversed stack. 0 means the first vertex. Negative values are counted from the end: -1 means last one, -2 means the vertex before last one, etc.</li>
<li><code>&lt;items&gt;</code>, optional, by default is 1. If &gt;1 a collection of vertices is returned</li>
</ul>
<p>Available since: 1.7</p>
<h4 id="example-46"><a class="header" href="#example-46">Example</a></h4>
<p>Returns last traversed vertex of TRAVERSE command:</p>
<pre><code class="language-sql">SELECT traversedVertex(-1) FROM ( TRAVERSE out() FROM #34:3232 WHILE $depth &lt;= 10 )
</code></pre>
<p>Returns last 3 traversed vertices of TRAVERSE command:</p>
<pre><code class="language-sql">SELECT traversedVertex(-1, 3) FROM ( TRAVERSE out() FROM #34:3232 WHILE $depth &lt;= 10 )
</code></pre>
<hr />
<h3 id="mode"><a class="header" href="#mode">mode()</a></h3>
<p>Returns the values that occur with the greatest frequency. Nulls are ignored in the calculation.</p>
<p>Syntax: <code>mode(&lt;field&gt;)</code></p>
<p>Available since: 2.0-M1</p>
<h4 id="example-47"><a class="header" href="#example-47">Example</a></h4>
<pre><code class="language-sql">SELECT mode(salary) FROM Account
</code></pre>
<hr />
<h3 id="median"><a class="header" href="#median">median()</a></h3>
<p>Returns the middle value or an interpolated value that represent the middle value after the values are sorted. Nulls are ignored in the calculation.</p>
<p>Syntax: <code>median(&lt;field&gt;)</code></p>
<p>Available since: 2.0-M1</p>
<h4 id="example-48"><a class="header" href="#example-48">Example</a></h4>
<pre><code class="language-sql">select median(salary) from Account
</code></pre>
<hr />
<h3 id="percentile"><a class="header" href="#percentile">percentile()</a></h3>
<p>Returns the nth percentiles (the values that cut off the first n percent of the field values when it is sorted in ascending order). Nulls are ignored in the calculation.</p>
<p>Syntax: <code>percentile(&lt;field&gt; [, &lt;quantile-n&gt;]*)</code></p>
<p>The quantiles have to be in the range 0-1</p>
<p>Available since: 2.0-M1</p>
<h4 id="examples-4"><a class="header" href="#examples-4">Examples</a></h4>
<pre><code class="language-sql">SELECT percentile(salary, 0.95) FROM Account
SELECT percentile(salary, 0.25, 0.75) AS IQR FROM Account
</code></pre>
<hr />
<h3 id="variance"><a class="header" href="#variance">variance()</a></h3>
<p>Returns the middle variance: the average of the squared differences from the mean. Nulls are ignored in the calculation.</p>
<p>Syntax: <code>variance(&lt;field&gt;)</code></p>
<p>Available since: 2.0-M1</p>
<h4 id="example-49"><a class="header" href="#example-49">Example</a></h4>
<pre><code class="language-sql">SELECT variance(salary) FROM Account
</code></pre>
<hr />
<h3 id="stddev"><a class="header" href="#stddev">stddev()</a></h3>
<p>Returns the standard deviation: the measure of how spread out values are. Nulls are ignored in the calculation.</p>
<p>Syntax: <code>stddev(&lt;field&gt;)</code></p>
<p>Available since: 2.0-M1</p>
<h4 id="example-50"><a class="header" href="#example-50">Example</a></h4>
<pre><code class="language-sql">SELECT stddev(salary) FROM Account
</code></pre>
<hr />
<h3 id="uuid"><a class="header" href="#uuid">uuid()</a></h3>
<p>Generates a UUID as a 128-bits value using the Leach-Salz variant. For more information look at: http://docs.oracle.com/javase/6/docs/api/java/util/UUID.html.</p>
<p>Available since: 2.0-M1</p>
<p>Syntax: <code>uuid()</code></p>
<h4 id="example-51"><a class="header" href="#example-51">Example</a></h4>
<p>Insert a new record with an automatic generated id:</p>
<pre><code class="language-sql">INSERT INTO Account SET id = UUID()
</code></pre>
<hr />
<h3 id="strcmpci"><a class="header" href="#strcmpci">strcmpci()</a></h3>
<p>Compares two string ignoring case. Return value is -1 if first string ignoring case is less than second, 0 if strings ignoring case are equals, 1 if second string ignoring case is less than first one. Before comparison both strings are transformed to lowercase and then compared.</p>
<p>Available since: 3.1.0</p>
<p>Syntax: <code>strcmpci(&lt;first_string&gt;, &lt;second_string&gt;)</code></p>
<h4 id="example-52"><a class="header" href="#example-52">Example</a></h4>
<p>Select all records where state name ignoring case is equal to "washington"</p>
<pre><code class="language-sql">SELECT * from State where strcmpci("washington", name) = 0
</code></pre>
<hr />
<h2 id="custom-functions"><a class="header" href="#custom-functions">Custom functions</a></h2>
<p>The SQL engine can be extended with custom functions written with a Scripting language or via Java.</p>
<h3 id="databases-function"><a class="header" href="#databases-function">Database's function</a></h3>
<p>Look at the <a href="sql/../admin/Functions.html">Functions</a> page.</p>
<h3 id="custom-functions-in-java"><a class="header" href="#custom-functions-in-java">Custom functions in Java</a></h3>
<p>Before to use them in your queries you need to register:</p>
<pre><code class="language-java">// REGISTER 'BIGGER' FUNCTION WITH FIXED 2 PARAMETERS (MIN/MAX=2)
OSQLEngine.getInstance().registerFunction("bigger",
                                          new OSQLFunctionAbstract("bigger", 2, 2) {
  public String getSyntax() {
    return "bigger(&lt;first&gt;, &lt;second&gt;)";
  }

  public Object execute(Object[] iParameters) {
    if (iParameters[0] == null || iParameters[1] == null)
      // CHECK BOTH EXPECTED PARAMETERS
      return null;

    if (!(iParameters[0] instanceof Number) || !(iParameters[1] instanceof Number))
      // EXCLUDE IT FROM THE RESULT SET
      return null;

    // USE DOUBLE TO AVOID LOSS OF PRECISION
    final double v1 = ((Number) iParameters[0]).doubleValue();
    final double v2 = ((Number) iParameters[1]).doubleValue();

    return Math.max(v1, v2);
  }

  public boolean aggregateResults() {
    return false;
  }
});
</code></pre>
<p>Now you can execute it:</p>
<pre><code class="language-java">List&lt;ODocument&gt; result = database.command(
  new OSQLSynchQuery&lt;ODocument&gt;("SELECT FROM Account WHERE bigger( salary, 10 ) &gt; 10") )
  .execute();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql-methods"><a class="header" href="#sql-methods">SQL Methods</a></h1>
<p>SQL Methods are similar to <a href="sql/SQL-Functions.html">SQL functions</a> but they apply to values. In Object Oriented paradigm they are called "methods", as functions related to a class. So what's the difference between a function and a method?</p>
<p>This is a <a href="sql/SQL-Functions.html">SQL function</a>:</p>
<pre><code class="language-sql">SELECT FROM sum( salary ) FROM employee
</code></pre>
<p>This is a SQL method:</p>
<pre><code class="language-sql">SELECT FROM salary.toJSON() FROM employee
</code></pre>
<p>As you can see the method is executed against a field/value. Methods can receive parameters, like functions. You can concatenate N operators in sequence.</p>
<blockquote>
<p><strong>Note</strong>: operators are case-insensitive.</p>
</blockquote>
<h2 id="bundled-methods"><a class="header" href="#bundled-methods">Bundled methods</a></h2>
<h3 id="methods-by-category"><a class="header" href="#methods-by-category">Methods by category</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Conversions</th><th>String manipulation</th><th>Collections</th><th>Misc</th></tr></thead><tbody>
<tr><td><a href="sql/SQL-Methods.html#convert">convert()</a></td><td><a href="sql/SQL-Methods.html#append">append()</a></td><td><a href="sql/SQL-Methods.html">[]</a></td><td><a href="sql/SQL-Methods.html#exclude">exclude()</a></td></tr>
<tr><td><a href="sql/SQL-Methods.html#asboolean">asBoolean()</a></td><td><a href="sql/SQL-Methods.html#charat">charAt()</a></td><td><a href="sql/SQL-Methods.html#size">size()</a></td><td><a href="sql/SQL-Methods.html#include">include()</a></td></tr>
<tr><td><a href="sql/SQL-Methods.html#asdate">asDate()</a></td><td><a href="sql/SQL-Methods.html#indexof">indexOf()</a></td><td><a href="sql/SQL-Methods.html#remove">remove()</a></td><td><a href="sql/SQL-Methods.html#javatype">javaType()</a></td></tr>
<tr><td><a href="sql/SQL-Methods.html#asdatetime">asDatetime()</a></td><td><a href="sql/SQL-Methods.html#left">left()</a></td><td><a href="sql/SQL-Methods.html#removeall">removeAll()</a></td><td><a href="sql/SQL-Methods.html#tojson">toJSON()</a></td></tr>
<tr><td><a href="sql/SQL-Methods.html#asdecimal">asDecimal()</a></td><td><a href="sql/SQL-Methods.html#right">right()</a></td><td><a href="sql/SQL-Methods.html#keys">keys()</a></td><td><a href="sql/SQL-Methods.html#type">type()</a></td></tr>
<tr><td><a href="sql/SQL-Methods.html#asfloat">asFloat()</a></td><td><a href="sql/SQL-Methods.html#prefix">prefix()</a></td><td><a href="sql/SQL-Methods.html#values">values()</a></td><td></td></tr>
<tr><td><a href="sql/SQL-Methods.html#asinteger">asInteger()</a></td><td><a href="sql/SQL-Methods.html#trim">trim()</a></td><td></td><td></td></tr>
<tr><td><a href="sql/SQL-Methods.html#aslist">asList()</a></td><td><a href="sql/SQL-Methods.html#replace">replace()</a></td><td></td><td></td></tr>
<tr><td><a href="sql/SQL-Methods.html#aslong">asLong()</a></td><td><a href="sql/SQL-Methods.html#length">length()</a></td><td></td><td></td></tr>
<tr><td><a href="sql/SQL-Methods.html#asmap">asMap()</a></td><td><a href="sql/SQL-Methods.html#substring">subString()</a></td><td></td><td></td></tr>
<tr><td><a href="sql/SQL-Methods.html#asset">asSet()</a></td><td><a href="sql/SQL-Methods.html#tolowercase">toLowerCase()</a></td><td></td><td></td></tr>
<tr><td><a href="sql/SQL-Methods.html#asstring">asString()</a></td><td><a href="sql/SQL-Methods.html#touppercase">toUpperCase()</a></td><td></td><td></td></tr>
<tr><td><a href="sql/SQL-Methods.html#normalize">normalize()</a></td><td><a href="sql/SQL-Methods.html#hash">hash()</a></td><td></td><td></td></tr>
<tr><td></td><td><a href="sql/SQL-Methods.html#format">format()</a></td><td></td><td></td></tr>
</tbody></table>
</div>
<h3 id="methods-by-name"><a class="header" href="#methods-by-name">Methods by name</a></h3>
<div class="table-wrapper"><table><thead><tr><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody>
<tr><td><a href="sql/SQL-Methods.html">[]</a></td><td><a href="sql/SQL-Methods.html#append">append()</a></td><td><a href="sql/SQL-Methods.html#asboolean">asBoolean()</a></td><td><a href="sql/SQL-Methods.html#asdate">asDate()</a></td><td><a href="sql/SQL-Methods.html#asdatetime">asDatetime()</a></td></tr>
<tr><td><a href="sql/SQL-Methods.html#asdecimal">asDecimal()</a></td><td><a href="sql/SQL-Methods.html#asfloat">asFloat()</a></td><td><a href="sql/SQL-Methods.html#asinteger">asInteger()</a></td><td><a href="sql/SQL-Methods.html#aslist">asList()</a></td><td><a href="sql/SQL-Methods.html#aslong">asLong()</a></td></tr>
<tr><td><a href="sql/SQL-Methods.html#asset">asSet()</a></td><td><a href="sql/SQL-Methods.html#asstring">asString()</a></td><td><a href="sql/SQL-Methods.html#charat">charAt()</a></td><td><a href="sql/SQL-Methods.html#convert">convert()</a></td><td><a href="sql/SQL-Methods.html#exclude">exclude()</a></td></tr>
<tr><td><a href="sql/SQL-Methods.html#hash">hash()</a></td><td><a href="sql/SQL-Methods.html#include">include()</a></td><td><a href="sql/SQL-Methods.html#indexof">indexOf()</a></td><td><a href="sql/SQL-Methods.html#javatype">javaType()</a></td><td><a href="sql/SQL-Methods.html#keys">keys()</a></td></tr>
<tr><td><a href="sql/SQL-Methods.html#length">length()</a></td><td><a href="sql/SQL-Methods.html#normalize">normalize()</a></td><td><a href="sql/SQL-Methods.html#prefix">prefix()</a></td><td><a href="sql/SQL-Methods.html#remove">remove()</a></td><td><a href="sql/SQL-Methods.html#removeall">removeAll()</a></td></tr>
<tr><td><a href="sql/SQL-Methods.html#right">right()</a></td><td><a href="sql/SQL-Methods.html#size">size()</a></td><td><a href="sql/SQL-Methods.html#substring">subString()</a></td><td><a href="sql/SQL-Methods.html#trim">trim()</a></td><td><a href="sql/SQL-Methods.html#tojson">toJSON()</a></td></tr>
<tr><td><a href="sql/SQL-Methods.html#touppercase">toUpperCase()</a></td><td><a href="sql/SQL-Methods.html#type">type()</a></td><td><a href="sql/SQL-Methods.html#values">values()</a></td><td></td><td></td></tr>
</tbody></table>
</div>
<h3 id=""><a class="header" href="#"><code>[]</code></a></h3>
<p>Execute an expression against the item. An item can be a multi-value object like a map, a list, an array or a document. For documents and maps, the item must be a string. For lists and arrays, the index is a number.</p>
<p>Syntax: <code>&lt;value&gt;[&lt;expression&gt;]</code></p>
<p>Applies to the following types:</p>
<ul>
<li>document,</li>
<li>map,</li>
<li>list,</li>
<li>array</li>
</ul>
<h4 id="examples-5"><a class="header" href="#examples-5">Examples</a></h4>
<p>Get the item with key "phone" in a map:</p>
<pre><code class="language-sql">SELECT FROM Profile WHERE '+39' IN contacts[phone].left(3)
</code></pre>
<p>Get the first 10 tags of posts:</p>
<pre><code class="language-sql">SELECT FROM tags[0-9] FROM Posts
</code></pre>
<p>#### History</p>
<ul>
<li>1.0rc5: First version</li>
</ul>
<hr />
<h3 id="append"><a class="header" href="#append">.append()</a></h3>
<p>Appends a string to another one.</p>
<p>Syntax: <code>&lt;value&gt;.append(&lt;value&gt;)</code></p>
<p>Applies to the following types:</p>
<ul>
<li>string</li>
</ul>
<h4 id="examples-6"><a class="header" href="#examples-6">Examples</a></h4>
<pre><code class="language-sql">SELECT name.append(' ').append(surname) FROM Employee
</code></pre>
<p>#### History</p>
<ul>
<li>1.0rc1: First version</li>
</ul>
<hr />
<h3 id="asboolean"><a class="header" href="#asboolean">.asBoolean()</a></h3>
<p>Transforms the field into a Boolean type. If the origin type is a string, then "true" and "false" is checked. If it's a number then 1 means TRUE while 0 means FALSE.</p>
<p>Syntax: <code>&lt;value&gt;.asBoolean()</code></p>
<p>Applies to the following types:</p>
<ul>
<li>string,</li>
<li>short,</li>
<li>int,</li>
<li>long</li>
</ul>
<h4 id="examples-7"><a class="header" href="#examples-7">Examples</a></h4>
<pre><code class="language-sql">SELECT FROM Users WHERE online.asBoolean() = true
</code></pre>
<p>#### History</p>
<ul>
<li>0.9.15: First version</li>
</ul>
<hr />
<h3 id="asdate"><a class="header" href="#asdate">.asDate()</a></h3>
<p>Transforms the field into a Date type. To know more about it, look at <a href="sql/../general/Managing-Dates.html">Managing Dates</a>.</p>
<p>Syntax: <code>&lt;value&gt;.asDate()</code></p>
<p>Applies to the following types:</p>
<ul>
<li>string,</li>
<li>long</li>
</ul>
<h4 id="examples-8"><a class="header" href="#examples-8">Examples</a></h4>
<p>Time is stored as long type measuring milliseconds since a particular day. Returns all the records where time is before the year 2010:</p>
<pre><code class="language-sql">SELECT FROM Log WHERE time.asDateTime() &lt; '01-01-2010 00:00:00' 
</code></pre>
<p>#### History</p>
<ul>
<li>0.9.14: First version</li>
</ul>
<hr />
<h3 id="asdatetime"><a class="header" href="#asdatetime">.asDateTime()</a></h3>
<p>Transforms the field into a Date type but parsing also the time information. To know more about it, look at <a href="sql/../general/Managing-Dates.html">Managing Dates</a>.</p>
<p>Syntax: <code>&lt;value&gt;.asDateTime()</code></p>
<p>Applies to the following types:</p>
<ul>
<li>string,</li>
<li>long</li>
</ul>
<h4 id="examples-9"><a class="header" href="#examples-9">Examples</a></h4>
<p>Time is stored as long type measuring milliseconds since a particular day. Returns all the records where time is before the year 2010:</p>
<pre><code class="language-sql">SELECT FROM Log WHERE time.asDateTime() &lt; '01-01-2010 00:00:00' 
</code></pre>
<p>#### History</p>
<ul>
<li>0.9.14: First version</li>
</ul>
<hr />
<h3 id="asdecimal"><a class="header" href="#asdecimal">.asDecimal()</a></h3>
<p>Transforms the field into an Decimal type. Use Decimal type when treat currencies.</p>
<p>Syntax: <code>&lt;value&gt;.asDecimal()</code></p>
<p>Applies to the following types:</p>
<ul>
<li>any</li>
</ul>
<h4 id="examples-10"><a class="header" href="#examples-10">Examples</a></h4>
<pre><code class="language-sql">SELECT salary.asDecimal() FROM Employee
</code></pre>
<p>#### History</p>
<ul>
<li>1.0rc1: First version</li>
</ul>
<hr />
<h3 id="asfloat"><a class="header" href="#asfloat">.asFloat()</a></h3>
<p>Transforms the field into a float type.</p>
<p>Syntax: <code>&lt;value&gt;.asFloat()</code></p>
<p>Applies to the following types:</p>
<ul>
<li>any</li>
</ul>
<h4 id="examples-11"><a class="header" href="#examples-11">Examples</a></h4>
<pre><code class="language-sql">SELECT ray.asFloat() &gt; 3.14
</code></pre>
<p>#### History</p>
<ul>
<li>0.9.14: First version</li>
</ul>
<hr />
<h3 id="asinteger"><a class="header" href="#asinteger">.asInteger()</a></h3>
<p>Transforms the field into an integer type.</p>
<p>Syntax: <code>&lt;value&gt;.asInteger()</code></p>
<p>Applies to the following types:</p>
<ul>
<li>any</li>
</ul>
<h4 id="examples-12"><a class="header" href="#examples-12">Examples</a></h4>
<p>Converts the first 3 chars of 'value' field in an integer:</p>
<pre><code class="language-sql">SELECT value.left(3).asInteger() FROM Log
</code></pre>
<p>#### History</p>
<ul>
<li>0.9.14: First version</li>
</ul>
<hr />
<h3 id="aslist"><a class="header" href="#aslist">.asList()</a></h3>
<p>Transforms the value in a List. If it's a single item, a new list is created.</p>
<p>Syntax: <code>&lt;value&gt;.asList()</code></p>
<p>Applies to the following types:</p>
<ul>
<li>any</li>
</ul>
<h4 id="examples-13"><a class="header" href="#examples-13">Examples</a></h4>
<pre><code class="language-sql">SELECT tags.asList() FROM Friend
</code></pre>
<p>#### History</p>
<ul>
<li>1.0rc2: First version</li>
</ul>
<hr />
<h3 id="aslong"><a class="header" href="#aslong">.asLong()</a></h3>
<p>Transforms the field into a Long type. To know more about it, look at <a href="sql/../general/Managing-Dates.html">Managing Dates</a>.</p>
<p>Syntax: <code>&lt;value&gt;.asLong()</code></p>
<p>Applies to the following types:</p>
<ul>
<li>any</li>
</ul>
<h4 id="examples-14"><a class="header" href="#examples-14">Examples</a></h4>
<pre><code class="language-sql">SELECT date.asLong() FROM Log
</code></pre>
<p>#### History</p>
<ul>
<li>1.0rc1: First version</li>
</ul>
<hr />
<h3 id="asmap"><a class="header" href="#asmap">.asMap()</a></h3>
<p>Transforms the value in a Map where even items are the keys and odd items are values.</p>
<p>Syntax: <code>&lt;value&gt;.asMap()</code></p>
<p>Applies to the following types:</p>
<ul>
<li>collections</li>
</ul>
<h4 id="examples-15"><a class="header" href="#examples-15">Examples</a></h4>
<pre><code class="language-sql">SELECT tags.asMap() FROM Friend
</code></pre>
<p>#### History</p>
<ul>
<li>1.0rc2: First version</li>
</ul>
<hr />
<h3 id="asset"><a class="header" href="#asset">.asSet()</a></h3>
<p>Transforms the value in a Set. If it's a single item, a new set is created. Sets doesn't allow duplicates.</p>
<p>Syntax: <code>&lt;value&gt;.asSet()</code></p>
<p>Applies to the following types:</p>
<ul>
<li>any</li>
</ul>
<h4 id="examples-16"><a class="header" href="#examples-16">Examples</a></h4>
<pre><code class="language-sql">SELECT tags.asSet() FROM Friend
</code></pre>
<p>#### History</p>
<ul>
<li>1.0rc2: First version</li>
</ul>
<hr />
<h3 id="asstring"><a class="header" href="#asstring">.asString()</a></h3>
<p>Transforms the field into a string type.</p>
<p>Syntax: <code>&lt;value&gt;.asString()</code></p>
<p>Applies to the following types:</p>
<ul>
<li>any</li>
</ul>
<h4 id="examples-17"><a class="header" href="#examples-17">Examples</a></h4>
<p>Get all the salaries with decimals:</p>
<pre><code class="language-sql">SELECT salary.asString().indexOf('.') &gt; -1
</code></pre>
<p>#### History</p>
<ul>
<li>0.9.14: First version</li>
</ul>
<hr />
<h3 id="charat"><a class="header" href="#charat">.charAt()</a></h3>
<p>Returns the character of the string contained in the position 'position'. 'position' starts from 0 to string length.</p>
<p>Syntax: <code>&lt;value&gt;.charAt(&lt;position&gt;)</code></p>
<p>Applies to the following types:</p>
<ul>
<li>string</li>
</ul>
<h4 id="examples-18"><a class="header" href="#examples-18">Examples</a></h4>
<p>Get the first character of the users' name:</p>
<pre><code class="language-sql">SELECT FROM User WHERE name.charAt( 0 ) = 'L'
</code></pre>
<p>#### History</p>
<ul>
<li>0.9.7: First version</li>
</ul>
<hr />
<h3 id="convert"><a class="header" href="#convert">.convert()</a></h3>
<p>Convert a value to another type.</p>
<p>Syntax: <code>&lt;value&gt;.convert(&lt;type&gt;)</code></p>
<p>Applies to the following types:</p>
<ul>
<li>any</li>
</ul>
<h4 id="examples-19"><a class="header" href="#examples-19">Examples</a></h4>
<pre><code class="language-sql">SELECT dob.convert( 'date' ) FROM User
</code></pre>
<p>#### History</p>
<ul>
<li>1.0rc2: First version</li>
</ul>
<hr />
<h3 id="exclude"><a class="header" href="#exclude">.exclude()</a></h3>
<p>Excludes some properties in the resulting document.</p>
<p>Syntax: <code>&lt;value&gt;.exclude(&lt;field-name&gt;[,]*)</code></p>
<p>Applies to the following types:</p>
<ul>
<li>document record</li>
</ul>
<h4 id="examples-20"><a class="header" href="#examples-20">Examples</a></h4>
<pre><code class="language-sql">SELECT EXPAND( @this.exclude( 'password' ) ) FROM OUser
</code></pre>
<p>Starting from 2.2.19 you can specify a wildcard as ending character to exclude all the fields that start with a certain string. Example to exclude all the outgoing and incoming edges:</p>
<pre><code class="language-sql">SELECT EXPAND( @this.exclude( 'out_*', 'in_*' ) ) FROM V
</code></pre>
<hr />
<h3 id="format-1"><a class="header" href="#format-1">.format()</a></h3>
<p>Returns the value formatted using the common "printf" syntax. For the complete reference goto <a href="http://java.sun.com/j2se/1.5.0/docs/api/java/util/Formatter.html#syntax">Java Formatter JavaDoc</a>.  To know more about it, look at <a href="sql/../general/Managing-Dates.html">Managing Dates</a>.</p>
<p>Syntax: <code>&lt;value&gt;.format(&lt;format&gt;)</code></p>
<p>Applies to the following types:</p>
<ul>
<li>any</li>
</ul>
<h4 id="examples-21"><a class="header" href="#examples-21">Examples</a></h4>
<p>Formats salaries as number with 11 digits filling with 0 at left:</p>
<pre><code class="language-sql">SELECT salary.format("%-011d") FROM Employee
</code></pre>
<p>#### History</p>
<ul>
<li>0.9.8: First version</li>
</ul>
<hr />
<h3 id="hash"><a class="header" href="#hash">.hash()</a></h3>
<p>Returns the hash of the field. Supports all the algorithms available in the JVM.</p>
<p>Syntax: <code>&lt;value&gt;</code>.hash([<algorithm>])```</p>
<p>Applies to the following types:</p>
<ul>
<li>string</li>
</ul>
<h4 id="example-53"><a class="header" href="#example-53">Example</a></h4>
<p>Get the SHA-512 of the field "password" in the class User:</p>
<pre><code class="language-sql">SELECT password.hash('SHA-512') FROM User
</code></pre>
<h4 id="history-8"><a class="header" href="#history-8">History</a></h4>
<ul>
<li>1.7: First version</li>
</ul>
<hr />
<h3 id="include"><a class="header" href="#include">.include()</a></h3>
<p>Include only some properties in the resulting document.</p>
<p>Syntax: <code>&lt;value&gt;.include(&lt;field-name&gt;[,]*)</code></p>
<p>Applies to the following types:</p>
<ul>
<li>document record</li>
</ul>
<h4 id="examples-22"><a class="header" href="#examples-22">Examples</a></h4>
<pre><code class="language-sql">SELECT EXPAND( @this.include( 'name' ) ) FROM OUser
</code></pre>
<p>Starting from 2.2.19 you can specify a wildcard as ending character to include all the fields that start with a certain string. Example to include all the fields that starts with <code>amount</code>:</p>
<pre><code class="language-sql">SELECT EXPAND( @this.exclude( 'amount*' ) ) FROM V
</code></pre>
<p>#### History</p>
<ul>
<li>1.0rc2: First version</li>
</ul>
<hr />
<h3 id="indexof"><a class="header" href="#indexof">.indexOf()</a></h3>
<p>Returns the position of the 'string-to-search' inside the value. It returns -1 if no occurrences are found. 'begin-position' is the optional position where to start, otherwise the beginning of the string is taken (=0).</p>
<p>Syntax: <code>&lt;value&gt;.indexOf(&lt;string-to-search&gt; [, &lt;begin-position&gt;)</code></p>
<p>Applies to the following types:</p>
<ul>
<li>string</li>
</ul>
<h4 id="examples-23"><a class="header" href="#examples-23">Examples</a></h4>
<p>Returns all the UK numbers:</p>
<pre><code class="language-sql">SELECT FROM Contact WHERE phone.indexOf('+44') &gt; -1
</code></pre>
<p>#### History</p>
<ul>
<li>0.9.10: First version</li>
</ul>
<hr />
<h3 id="javatype"><a class="header" href="#javatype">.javaType()</a></h3>
<p>Returns the corresponding Java Type.</p>
<p>Syntax: <code>&lt;value&gt;.javaType()</code></p>
<p>Applies to the following types:</p>
<ul>
<li>any</li>
</ul>
<h4 id="examples-24"><a class="header" href="#examples-24">Examples</a></h4>
<p>Prints the Java type used to store dates:</p>
<pre><code class="language-sql">SELECT FROM date.javaType() FROM Events
</code></pre>
<p>#### History</p>
<ul>
<li>1.0rc1: First version</li>
</ul>
<hr />
<h3 id="keys"><a class="header" href="#keys">.keys()</a></h3>
<p>Returns the map's keys as a separate set. Useful to use in conjunction with IN, CONTAINS and CONTAINSALL operators.</p>
<p>Syntax: <code>&lt;value&gt;.keys()</code></p>
<p>Applies to the following types:</p>
<ul>
<li>maps</li>
<li>documents</li>
</ul>
<h4 id="examples-25"><a class="header" href="#examples-25">Examples</a></h4>
<pre><code class="language-sql">SELECT FROM Actor WHERE 'Luke' IN map.keys()
</code></pre>
<p>#### History</p>
<ul>
<li>1.0rc1: First version</li>
</ul>
<hr />
<h3 id="left"><a class="header" href="#left">.left()</a></h3>
<p>Returns a substring of the original cutting from the begin and getting 'len' characters.</p>
<p>Syntax: <code>&lt;value&gt;.left(&lt;length&gt;)</code></p>
<p>Applies to the following types:</p>
<ul>
<li>string</li>
</ul>
<h4 id="examples-26"><a class="header" href="#examples-26">Examples</a></h4>
<pre><code class="language-sql">SELECT FROM Actors WHERE name.left( 4 ) = 'Luke'
</code></pre>
<p>#### History</p>
<ul>
<li>0.9.7: First version</li>
</ul>
<hr />
<h3 id="length"><a class="header" href="#length">.length()</a></h3>
<p>Returns the length of the string. If the string is null 0 will be returned.</p>
<p>Syntax: <code>&lt;value&gt;.length()</code></p>
<p>Applies to the following types:</p>
<ul>
<li>string</li>
</ul>
<h4 id="examples-27"><a class="header" href="#examples-27">Examples</a></h4>
<pre><code class="language-sql">SELECT FROM Providers WHERE name.length() &gt; 0
</code></pre>
<p>#### History</p>
<ul>
<li>0.9.7: First version</li>
</ul>
<hr />
<h3 id="normalize"><a class="header" href="#normalize">.normalize()</a></h3>
<p>Form can be NDF, NFD, NFKC, NFKD. Default is NDF. pattern-matching if not defined is "\p{InCombiningDiacriticalMarks}+". For more information look at <a href="http://www.unicode.org/reports/tr15/tr15-23.html">Unicode Standard</a>.</p>
<p>Syntax: <code>&lt;value&gt;.normalize( [&lt;form&gt;] [,&lt;pattern-matching&gt;] )</code></p>
<p>Applies to the following types:</p>
<ul>
<li>string</li>
</ul>
<h4 id="examples-28"><a class="header" href="#examples-28">Examples</a></h4>
<pre><code class="language-sql">SELECT FROM V WHERE name.normalize() AND name.normalize('NFD')
</code></pre>
<p>#### History</p>
<ul>
<li>1.4.0: First version</li>
</ul>
<hr />
<h3 id="prefix"><a class="header" href="#prefix">.prefix()</a></h3>
<p>Prefixes a string to another one.</p>
<p>Syntax: <code>&lt;value&gt;.prefix('&lt;string&gt;')</code></p>
<p>Applies to the following types:</p>
<ul>
<li>string</li>
</ul>
<h4 id="examples-29"><a class="header" href="#examples-29">Examples</a></h4>
<pre><code class="language-sql">SELECT name.prefix('Mr. ') FROM Profile
</code></pre>
<p>#### History</p>
<ul>
<li>1.0rc1: First version</li>
</ul>
<hr />
<h3 id="remove"><a class="header" href="#remove">.remove()</a></h3>
<p>Removes the first occurrence of the passed items.</p>
<p>Syntax: <code>&lt;value&gt;.remove(&lt;item&gt;*)</code></p>
<p>Applies to the following types:</p>
<ul>
<li>collection</li>
</ul>
<h4 id="examples-30"><a class="header" href="#examples-30">Examples</a></h4>
<pre><code class="language-sql">SELECT out().in().remove( @this ) FROM V
</code></pre>
<p>#### History</p>
<ul>
<li>1.0rc1: First version</li>
</ul>
<hr />
<h3 id="removeall"><a class="header" href="#removeall">.removeAll()</a></h3>
<p>Removes all the occurrences of the passed items.</p>
<p>Syntax: <code>&lt;value&gt;.removeAll(&lt;item&gt;*)</code></p>
<p>Applies to the following types:</p>
<ul>
<li>collection</li>
</ul>
<h4 id="examples-31"><a class="header" href="#examples-31">Examples</a></h4>
<pre><code class="language-sql">SELECT out().in().removeAll( @this ) FROM V
</code></pre>
<p>#### History</p>
<ul>
<li>1.0rc1: First version</li>
</ul>
<hr />
<h3 id="replace"><a class="header" href="#replace">.replace()</a></h3>
<p>Replace a string with another one.</p>
<p>Syntax: <code>&lt;value&gt;.replace(&lt;to-find&gt;, &lt;to-replace&gt;)</code></p>
<p>Applies to the following types:</p>
<ul>
<li>string</li>
</ul>
<h4 id="examples-32"><a class="header" href="#examples-32">Examples</a></h4>
<pre><code class="language-sql">SELECT name.replace('Mr.', 'Ms.') FROM User
</code></pre>
<p>#### History</p>
<ul>
<li>1.0rc1: First version</li>
</ul>
<hr />
<h3 id="right"><a class="header" href="#right">.right()</a></h3>
<p>Returns a substring of the original cutting from the end of the string 'length' characters.</p>
<p>Syntax: <code>&lt;value&gt;.right(&lt;length&gt;)</code></p>
<p>Applies to the following types:</p>
<ul>
<li>string</li>
</ul>
<h4 id="examples-33"><a class="header" href="#examples-33">Examples</a></h4>
<p>Returns all the vertices where the name ends by "ke".</p>
<pre><code class="language-sql">SELECT FROM V WHERE name.right( 2 ) = 'ke'
</code></pre>
<p>#### History</p>
<ul>
<li>0.9.7: First version</li>
</ul>
<hr />
<h3 id="size"><a class="header" href="#size">.size()</a></h3>
<p>Returns the size of the collection.</p>
<p>Syntax: <code>&lt;value&gt;.size()</code></p>
<p>Applies to the following types:</p>
<ul>
<li>collection</li>
</ul>
<h4 id="examples-34"><a class="header" href="#examples-34">Examples</a></h4>
<p>Returns all the items in a tree with children:</p>
<pre><code class="language-sql">SELECT FROM TreeItem WHERE children.size() &gt; 0
</code></pre>
<p>#### History</p>
<ul>
<li>0.9.7: First version</li>
</ul>
<hr />
<h3 id="substring"><a class="header" href="#substring">.subString()</a></h3>
<p>Returns a substring of the original cutting from 'begin' index up to 'end' index (not included).</p>
<p>Syntax: <code>&lt;value&gt;.subString(&lt;begin&gt; [,&lt;end&gt;] )</code></p>
<p>Applies to the following types:</p>
<ul>
<li>string</li>
</ul>
<h4 id="examples-35"><a class="header" href="#examples-35">Examples</a></h4>
<p>Get all the items where the name begins with an "L":</p>
<pre><code class="language-sql">SELECT name.substring( 0, 1 ) = 'L' FROM StockItems
</code></pre>
<p>Substring of <code>OrientDB</code></p>
<pre><code class="language-sql">SELECT "OrientDB".substring(0,6)
</code></pre>
<p>returns <code>Orient</code></p>
<p>#### History</p>
<ul>
<li>0.9.7: First version</li>
</ul>
<hr />
<h3 id="trim"><a class="header" href="#trim">.trim()</a></h3>
<p>Returns the original string removing white spaces from the begin and the end.</p>
<p>Syntax: <code>&lt;value&gt;.trim()</code></p>
<p>Applies to the following types:</p>
<ul>
<li>string</li>
</ul>
<h4 id="examples-36"><a class="header" href="#examples-36">Examples</a></h4>
<pre><code class="language-sql">SELECT name.trim() == 'Luke' FROM Actors
</code></pre>
<p>#### History</p>
<ul>
<li>0.9.7: First version</li>
</ul>
<hr />
<h3 id="tojson"><a class="header" href="#tojson">.toJSON()</a></h3>
<p>Returns the record in JSON format.</p>
<p>Syntax: <code>&lt;value&gt;.toJSON([&lt;format&gt;])</code></p>
<p>Where:</p>
<ul>
<li><strong>format</strong> optional, allows custom formatting rules (separate multiple options by comma). Rules are the following:</li>
<li><strong>type</strong> to include the fields' types in the "@fieldTypes" attribute</li>
<li><strong>rid</strong> to include records's RIDs as attribute "@rid"</li>
<li><strong>version</strong> to include records' versions in the attribute "@version"</li>
<li><strong>class</strong> to include the class name in the attribute "@class"</li>
<li><strong>attribSameRow</strong> put all the attributes in the same row</li>
<li><strong>indent</strong> is the indent level as integer. By Default no ident is used</li>
<li><strong>fetchPlan</strong> is the <a href="sql/../java/Fetching-Strategies.html">FetchPlan</a> to use while fetching linked records</li>
<li><strong>alwaysFetchEmbedded</strong> to always fetch embedded records (without considering the fetch plan)</li>
<li><strong>dateAsLong</strong> to return dates (Date and Datetime types) as long numbers</li>
<li><strong>prettyPrint</strong> indent the returning JSON in readable (pretty) way</li>
</ul>
<p>Applies to the following types:</p>
<ul>
<li>record</li>
</ul>
<h4 id="examples-37"><a class="header" href="#examples-37">Examples</a></h4>
<pre><code class="language-sql">create class Test extends V
insert into Test content {"attr1": "value 1", "attr2": "value 2"}

select @this.toJson('rid,version,fetchPlan:in_*:-2 out_*:-2') from Test
</code></pre>
<p>#### History</p>
<ul>
<li>0.9.8: First version</li>
</ul>
<hr />
<h3 id="tolowercase"><a class="header" href="#tolowercase">.toLowerCase()</a></h3>
<p>Returns the string in lower case.</p>
<p>Syntax: <code>&lt;value&gt;.toLowerCase()</code></p>
<p>Applies to the following types:</p>
<ul>
<li>string</li>
</ul>
<h4 id="examples-38"><a class="header" href="#examples-38">Examples</a></h4>
<pre><code class="language-sql">SELECT name.toLowerCase() == 'luke' FROM Actors
</code></pre>
<p>#### History</p>
<ul>
<li>0.9.7: First version</li>
</ul>
<hr />
<h3 id="touppercase"><a class="header" href="#touppercase">.toUpperCase()</a></h3>
<p>Returns the string in upper case.</p>
<p>Syntax: <code>&lt;value&gt;.toUpperCase()</code></p>
<p>Applies to the following types:</p>
<ul>
<li>string</li>
</ul>
<h4 id="examples-39"><a class="header" href="#examples-39">Examples</a></h4>
<pre><code class="language-sql">SELECT name.toUpperCase() == 'LUKE' FROM Actors
</code></pre>
<p>#### History</p>
<ul>
<li>0.9.7: First version</li>
</ul>
<hr />
<h3 id="type"><a class="header" href="#type">.type()</a></h3>
<p>Returns the value's OrientDB Type.</p>
<p>Syntax: <code>&lt;value&gt;.type()</code></p>
<p>Applies to the following types:</p>
<ul>
<li>any</li>
</ul>
<h4 id="examples-40"><a class="header" href="#examples-40">Examples</a></h4>
<p>Prints the type used to store dates:</p>
<pre><code class="language-sql">SELECT FROM date.type() FROM Events
</code></pre>
<p>#### History</p>
<ul>
<li>1.0rc1: First version</li>
</ul>
<hr />
<h3 id="values"><a class="header" href="#values">.values()</a></h3>
<p>Returns the map's values as a separate collection. Useful to use in conjunction with IN, CONTAINS and CONTAINSALL operators.</p>
<p>Syntax: <code>&lt;value&gt;.values()</code></p>
<p>Applies to the following types:</p>
<ul>
<li>maps</li>
<li>documents</li>
</ul>
<h4 id="examples-41"><a class="header" href="#examples-41">Examples</a></h4>
<pre><code class="language-sql">SELECT FROM Clients WHERE map.values() CONTAINSALL ( name is not null)
</code></pre>
<p>#### History</p>
<ul>
<li>1.0rc1: First version</li>
</ul>
<hr />
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql-batch"><a class="header" href="#sql-batch">SQL Batch</a></h1>
<p>OrientDB allows execution of arbitrary scripts written in Javascript or any scripting language installed in the JVM. OrientDB supports a minimal SQL engine to allow a batch of commands.</p>
<p>Batch of commands are very useful when you have to execute multiple things at the server side avoiding the network roundtrip for each command.</p>
<p>SQL Batch supports all the OrientDB <a href="sql/SQL-Commands.html">SQL Commands</a>, plus the following:</p>
<ul>
<li><code>begin [isolation &lt;isolation-level&gt;]</code>, where <code>&lt;isolation-level&gt;</code> can be <code>READ_COMMITTED</code>, <code>REPEATABLE_READ</code>. By default is <code>READ_COMMITTED</code></li>
<li><code>commit [retry &lt;retry&gt;]</code>, where:</li>
<li><retry> is the number of retries in case of concurrent modification exception</li>
<li><code>let &lt;variable&gt; = &lt;SQL&gt;</code>, to assign the result of a SQL command to a variable. To reuse the variable prefix it with the dollar sign $</li>
<li><code>IF(&lt;condition&gt;){ &lt;statement&gt;; [&lt;statement&gt;;]* }</code>. Look at <a href="sql/SQL-batch.html#conditional-execution">Conditional execution</a>.</li>
<li><code>WHILE(&lt;condition&gt;){ &lt;statement&gt;; [&lt;statement&gt;;]* }</code>. Look at <a href="sql/SQL-batch.html#loops">Conditional execution</a>.</li>
<li><code>FOREACH(&lt;variable&gt; IN &lt;expression&gt;){ &lt;statement&gt;; [&lt;statement&gt;;]* }</code>. Look at <a href="sql/SQL-batch.html#loops">Conditional execution</a>.</li>
<li><code>SLEEP &lt;ms&gt;</code>, put the batch in wait for <code>&lt;ms&gt;</code> milliseconds.</li>
<li><code>console.log &lt;text&gt;</code>, logs a message in the console. Context variables can be used with <code>${&lt;variable&gt;}</code>. Since 2.2.</li>
<li><code>console.error &lt;text&gt;</code>, writes a message in the console's standard output. Context variables can be used with <code>${&lt;variable&gt;}</code>. Since 2.2.</li>
<li><code>console.output &lt;text&gt;</code>, writes a message in the console's standard error. Context variables can be used with <code>${&lt;variable&gt;}</code>. Since 2.2.</li>
<li><code>return</code> <value>, where value can be:</li>
<li>any value. Example: <code>return 3</code></li>
<li>any variable with $ as prefix. Example: <code>return $a</code></li>
<li>arrays (HTTP protocol only, see below). Example: <code>return [ $a, $b ]</code></li>
<li>maps (HTTP protocol only, see below). Example: <code>return { 'first' : $a, 'second' : $b }</code></li>
<li>a query. Example: <code>return (SELECT FROM Foo)</code></li>
</ul>
<p>NOTE: to return arrays and maps (eg. Java or Node.js driver) it's strongly recommended to use a RETURN SELECT, eg.</p>
<pre><code>return (SELECT $a as first, $b as second)
</code></pre>
<p>This will work on any protocol and driver.</p>
<h2 id="optimistic-transaction-1"><a class="header" href="#optimistic-transaction-1">Optimistic transaction</a></h2>
<p>Example to create a new vertex in a <a href="sql/../internals/Transactions.html">Transaction</a> and attach it to an existent vertex by creating a new edge between them. If a concurrent modification occurs, repeat the transaction up to 100 times:</p>
<pre><code class="language-sql">begin;
let account = create vertex Account set name = 'Luke';
let city = select from City where name = 'London';
let e = create edge Lives from $account to $city;
commit retry 100;
return $e;
</code></pre>
<p>Note the usage of $account and $city in further SQL commands.</p>
<h2 id="pessimistic-transaction-1"><a class="header" href="#pessimistic-transaction-1">Pessimistic transaction</a></h2>
<p>This script above used an Optimistic approach: in case of conflict it retries up top 100 times by re-executing the entire transaction (commit retry 100). To follow a Pessimistic approach by locking the records, try this:</p>
<pre><code class="language-sql">BEGIN;
let account = CREATE VERTEX Account SET name = 'Luke';
let city = SELECT FROM City WHERE name = 'London' LOCK RECORD;
let e = CREATE EDGE Lives FROM $account TO $city;
COMMIT;
return $e;
</code></pre>
<p>Note the "lock record" after the select. This means the returning records will be locked until commit (or rollback). In this way concurrent updates against London will wait for this <a href="sql/../internals/Transactions.html">transaction</a> to complete.</p>
<p><em>NOTE: locks inside transactions works ONLY against MEMORY storage, we're working to provide such feature also against plocal. Stay tuned (Issue https://github.com/orientechnologies/orientdb/issues/1677)</em></p>
<h2 id="conditional-execution-1"><a class="header" href="#conditional-execution-1">Conditional execution</a></h2>
<p>(since 2.1.7)
SQL Batch provides IF constructor to allow conditional execution.
The syntax is</p>
<pre><code class="language-sql">if(&lt;sql-predicate&gt;){
   &lt;statement&gt;;
   &lt;statement&gt;;
   ...
}
</code></pre>
<p><code>&lt;sql-predicate&gt;</code> is any valid SQL predicate (any condition that can be used in a WHERE clause).
In current release it's mandatory to have <code>IF(){</code>, <code>&lt;statement&gt;</code> and <code>}</code> on separate lines, eg. the following is not a valid script</p>
<pre><code class="language-sql">if($a.size() &gt; 0) {
  ROLLBACK;
}
</code></pre>
<p>The right syntax is following:</p>
<pre><code class="language-sql">if($a.size() &gt; 0) { 
   ROLLBACK;
}
</code></pre>
<h2 id="loops"><a class="header" href="#loops">Loops</a></h2>
<p>SQL Batch provides two different loop blocks: FOREACH and WHILE</p>
<h4 id="foreach"><a class="header" href="#foreach">FOREACH</a></h4>
<p>(since v 3.0.3 - experimental)</p>
<p>Loops on all the items of a collection and, for each of them, executes a set of SQL statements</p>
<p>The syntax is</p>
<pre><code class="language-sql">FOREACH(&lt;variable&gt; IN &lt;expression&gt;){
   &lt;statement&gt;;
   &lt;statement&gt;;
   ...
}
</code></pre>
<p>Example</p>
<pre><code class="language-sql">FOREACH ($i IN [1, 2, 3]){
  INSERT INTO Foo SET value = $i;
}
</code></pre>
<h4 id="while"><a class="header" href="#while">WHILE</a></h4>
<p>(since v 3.0.3 - experimental)</p>
<p>Loops while a condition is true</p>
<p>The syntax is</p>
<pre><code class="language-sql">WHILE(&lt;condition&gt;){
   &lt;statement&gt;;
   &lt;statement&gt;;
   ...
}
</code></pre>
<p>Example</p>
<pre><code class="language-sql">LET $i = 0;
WHILE ($i &lt; 10){
  INSERT INTO Foo SET value = $i;
  LET $i = $i + 1;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pagination"><a class="header" href="#pagination">Pagination</a></h1>
<p>OrientDB supports pagination natively. Pagination doesn't consume server side resources because no cursors are used. Only <a href="sql/../datamodeling/Concepts.html#record-id">Record ID's</a> are used as pointers to the physical position in the cluster.</p>
<p>There are 2 ways to achieve pagination:</p>
<h2 id="use-the-skip-limit"><a class="header" href="#use-the-skip-limit">Use the SKIP-LIMIT</a></h2>
<p>The first and simpler way to do pagination is to use the <code>SKIP</code>/<code>LIMIT</code> approach. This is the slower way because OrientDB repeats the query and just skips the first X records from the result.
Syntax:</p>
<pre><code class="language-sql">SELECT FROM &lt;target&gt; [WHERE ...] SKIP &lt;records-to-skip&gt; LIMIT &lt;max-records&gt;
</code></pre>
<p>Where:</p>
<ul>
<li><strong>records-to-skip</strong> is the number of records to skip before starting to collect them as the result set</li>
<li><strong>max-records</strong> is the maximum number of records returned by the query</li>
</ul>
<p>Example</p>
<h2 id="use-the-rid-limit"><a class="header" href="#use-the-rid-limit">Use the RID-LIMIT</a></h2>
<p>This method is faster than the <code>SKIP</code>-<code>LIMIT</code> because OrientDB will begin the scan from the starting RID. OrientDB can seek the first record in about O(1) time. The downside is that it's more complex to use.</p>
<p>The trick here is to execute the query multiple times setting the <code>LIMIT</code> as the page size and using the greater than <code>&gt;</code> operator against <code>@rid</code>. The <strong>lower-rid</strong> is the starting point to search, for example <code>#10:300</code>.</p>
<p>Syntax:</p>
<pre><code class="language-sql">SELECT FROM &lt;target&gt; WHERE @rid &gt; &lt;lower-rid&gt; ... [LIMIT &lt;max-records&gt;]
</code></pre>
<p>Where:</p>
<ul>
<li><strong>lower-rid</strong> is the exclusive lower bound of the range as <a href="sql/../datamodeling/Concepts.html#record-id">Record ID</a></li>
<li><strong>max-records</strong> is the maximum number of records returned by the query</li>
</ul>
<p>In this way, OrientDB will start to scan the cluster from the given position <strong>lower-rid</strong> + 1. After the first call, the <strong>lower-rid</strong> will be the rid of the last record returned by the previous call. To scan the cluster from the beginning, use <code>#-1:-1</code> as <strong>lower-rid</strong> .</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sequences-and-auto-increment"><a class="header" href="#sequences-and-auto-increment">Sequences and auto increment</a></h1>
<p>Starting from v2.2, OrientDB supports sequences like most of RDBMS. What's a sequence? It's a structure that manage counters. Sequences are mostly used when you need a number that always increments. Sequence types can be:</p>
<ul>
<li><strong>ORDERED</strong>: each call to <code>.next()</code> will result in a new value.</li>
<li><strong>CACHED</strong>: the sequence will cache N items on each node, thus improving the performance if many <code>.next()</code> calls are required. However, this may create holes. Also in distributed environment cached sequences may not be synchronized.</li>
</ul>
<p>To manipulate sequences you can use the Java API or SQL commands.</p>
<h2 id="create-a-sequence"><a class="header" href="#create-a-sequence">Create a sequence</a></h2>
<pre><code class="language-sql">CREATE SEQUENCE idseq
INSERT INTO account SET id = sequence('idseq').next()
</code></pre>
<p>For more information look at <a href="sql/SQL-Create-Sequence.html">SQL CREATE SEQUENCE</a>.</p>
<h3 id="using-a-sequence-from-sql"><a class="header" href="#using-a-sequence-from-sql">Using a sequence from SQL</a></h3>
<p>You can use a sequence from SQL with the following syntax:</p>
<pre><code class="language-sql">sequence('&lt;sequence&gt;').&lt;method&gt;
</code></pre>
<p>Where:</p>
<ul>
<li><code>method</code> can be:</li>
<li><code>next()</code> retrieves the next value</li>
<li><code>current()</code> gets the current value</li>
<li><code>reset()</code> resets the sequence value to it's initial value</li>
</ul>
<p>Example</p>
<pre><code class="language-sql">INSERT INTO Account SET id = sequence('mysequence').next()
</code></pre>
<h2 id="alter-a-sequence"><a class="header" href="#alter-a-sequence">Alter a sequence</a></h2>
<pre><code class="language-sql">ALTER SEQUENCE idseq START 1000
</code></pre>
<p>For more information look at <a href="sql/SQL-Alter-Sequence.html">SQL ALTER SEQUENCE</a>.</p>
<h2 id="drop-a-sequence"><a class="header" href="#drop-a-sequence">Drop a sequence</a></h2>
<pre><code class="language-sql">DROP SEQUENCE idseq
</code></pre>
<p>For more information look at <a href="sql/SQL-Drop-Sequence.html">SQL DROP SEQUENCE</a>.</p>
<h1 id="orientdb-before-v22"><a class="header" href="#orientdb-before-v22">OrientDB before v2.2</a></h1>
<p>OrientDB before v2.2 doesn't support sequences (autoincrement), so you can manage your own counter in this way (example using SQL):</p>
<pre><code class="language-sql">CREATE CLASS counter
INSERT INTO counter SET name='mycounter', value=0
</code></pre>
<p>And then every time you need a new number you can do:</p>
<pre><code class="language-sql">UPDATE counter INCREMENT value = 1 WHERE name = 'mycounter'
</code></pre>
<p>This works in a SQL batch in this way:</p>
<pre><code class="language-sql">BEGIN
let $counter = UPDATE counter INCREMENT value = 1 return after $current WHERE name = 'mycounter'
INSERT INTO items SET id = $counter.value[0], qty = 10, price = 1000
COMMIT
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><p>When planning an OrientDB <a href="sql/SQL-Query.html">SELECT</a> query, it is important to determine the model class that will be used as the pivot class of the query.  This class is expressed in the FROM clause. It affects other elements in the query as follows:</p>
<ul>
<li>projections will be relative to the pivot class. It is possible to traverse within a projection to refer to neighboring classes by chaining edge syntax expressions  (i.e. <code>in[label='office'].out.out[label='office'].size()</code>). However, consider that multiple results from a projection traversed from the pivot class will be returned as a collection within the result set (unless there is only a single value).</li>
<li>filtering conditions in the WHERE clause are also relative to the pivot class. It is also possible to traverse to neighboring classes in order to compose advanced conditions by using edge syntax expressions (e.g. <code>and in()[type='company'].out().out()[type='employee'].in().id IN '0000345'</code>).</li>
<li>the ORDER BY clause will be relative to one of the projections and must be returned as a single value per record (i.e. an attribute of the pivot class or a single attribute of a neighboring class). It will not be possible to order by traversed projections in a single query if they return multiple results (as a collection). Therefore, in queries using an ORDER BY clause, there is only one possible choice for the pivot class as it must be the class containing the attribute to order by.</li>
</ul>
<p>Additionally, there are performance considerations that should be considered on selecting the pivot class. Assuming 2 classes as follows:</p>
<pre><code>+--------------------+           +-------------------+
| Class: CountryType | --------&gt; | Class: PersonType |
| attr: name         |           |  attr: name       |
| atr: code          |           |  attr: lat        |
|                    |           |  attr: long       |
+--------------------+           +-------------------+
  (tens of vertices)             (millions of vertices)
</code></pre>
<p>Queries:</p>
<pre><code class="language-sql"> SELECT [...] FROM CountryType WHERE [...]

 SELECT [...] FROM PersonType WHERE [...]
</code></pre>
<p>The first query will apply the WHERE filtering and projections to fewer vertices, and as a result will perform faster that the second query. Therefore, it is advisable to assign the pivot class to the class that contains the most relevant items for the query to avoid unnecessary loops from the evaluation, i.e. usually the one with lower multiplicity.</p>
<h1 id="switching-the-pivot-class-within-a-query"><a class="header" href="#switching-the-pivot-class-within-a-query">Switching the pivot class within a query</a></h1>
<p>Based on the previous discussion, there may be conflicting requirements on determining the pivot class. Take the case where we need to ORDER BY a class with a very high multiplicity (say, millions of vertices), but most of these vertices are not relevant for the outcome of our query.</p>
<p>On one hand, according to the requirements of the ORDER BY clause, we are forced to choose the class containing the attribute to order by as the pivot class. But, as we also saw, this class can not be an optimal choice from a performance point of view if only a small subset of vertices is relevant to the query. In this case, we have a choice between poor performance resulting from setting the pivot class as the class containing the attribute to order by even though it has a higher multiplicity, or good performance by taking out the ORDER BY clause and ordering results after the fact in the invoking Java code, which is more work. If we choose to execute the full operation in one query, indices can be used to improve the poor performance, but it would be usually an overkill as a consequence of a bad query planning.</p>
<p>A more elegant solution can be achieved by using the nested query technique, as shown below:</p>
<pre><code class="language-sql">SELECT                                                              -- outer query
  in()[type='city'].out().name AS name,
  in()[type='city'].out().out()[type='city'].size() AS city_count,
  CityLat,
  CityLong,
  distance(CityLat, CityLong, 51.513363, -0.089178) AS distance     -- order by parameter
FROM (                                                              -- inner query
  SELECT expand( in()[type='region'].out().out()[type='city'].in() )
  FROM CountryType WHERE id IN '0032'
)
WHERE CityLat &lt;&gt; '' AND CityLong  &lt;&gt; ''
ORDER BY distance
</code></pre>
<p>This nested query represents a two-fold operation, taking the best of both worlds. The inner query uses the <code>CountryType</code> class which has lower multiplicity as pivot class, so the number of required loops is smaller, and as a result delivers better performance. The set of vertices resulting from the inner query is taken as pivot class for the outer query. The <code>flatten()</code> function is required to expose items from the inner query as a flat structure to the outer query. The higher the multiplicity and number of irrelevant records in the class with the parameter to order by, the more convenient using this approach becomes.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="command-cache"><a class="header" href="#command-cache">Command Cache</a></h1>
<p>Starting from release 2.2, OrientDB supports caching of commands results. Caching command results has been used by other DBMSs and proven to dramatically improve the following use cases:</p>
<ul>
<li>database is mostly read than write</li>
<li>there are a few heavy queries that result a small result set</li>
<li>you have available RAM to use or caching results</li>
</ul>
<p>By default, the command cache is disabled. To enable it, set <code>command.cache.enabled=true</code>. Look at the <a href="sql/../studio/server-management/Studio-Query-Profiler.html#command-cache">Studio page about Command Cache</a>.</p>
<h2 id="settings"><a class="header" href="#settings">Settings</a></h2>
<p>There are some settings to tune the command cache. Below find the table containing all the available settings.</p>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Type</th><th>Default value</th></tr></thead><tbody>
<tr><td>command.cache.enabled</td><td>Enable command cache</td><td>Boolean</td><td>false</td></tr>
<tr><td>command.cache.evictStrategy</td><td>Command cache strategy between: [INVALIDATE_ALL,PER_CLUSTER]</td><td>String.class</td><td>PER_CLUSTER</td></tr>
<tr><td>command.cache.minExecutionTime</td><td>Minimum execution time to consider caching result set</td><td>Integer.class</td><td>10</td></tr>
<tr><td>command.cache.maxResultsetSize</td><td>Maximum resultset time to consider caching result set</td><td>Integer</td><td>500</td></tr>
</tbody></table>
</div>
<h2 id="eviction-strategies"><a class="header" href="#eviction-strategies">Eviction strategies</a></h2>
<p>Using a cache that holds old data could be meaningless, unless you could accept eventual consistency. For this reason, the command cache supports 2 eviction strategies to keep the cache consistent:</p>
<ul>
<li><strong>INVALIDATE_ALL</strong> to remove all the query results at every Create, Update and Delete operation. This is faster than <strong>PER_CLUSTER</strong> if many writes occur.</li>
<li><strong>PER_CLUSTER</strong> to remove all the query results only related to the modified cluster. This operation is more expensive then <strong>INVALIDATE_ALL</strong></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="apis-and-drivers"><a class="header" href="#apis-and-drivers">APIs and Drivers</a></h1>
<p>OrientDB supports 3 kinds of drivers:</p>
<ul>
<li><strong>Native binary remote</strong>, that talks directly against the TCP/IP socket using the <a href="apis-and-drivers/../internals/Network-Binary-Protocol.html">binary protocol</a></li>
<li><strong>HTTP REST/JSON</strong>, that talks directly against the TCP/IP socket using the <a href="apis-and-drivers/../misc/OrientDB-REST.html">HTTP protocol</a></li>
<li><strong>Java wrapped</strong>, as a layer that links in some way the native Java driver. This is pretty easy for languages that run into the JVM like Scala, Groovy and JRuby</li>
</ul>
<p>Look also at the available integration with <a href="apis-and-drivers/../plugins/Plugins.html">Plugins and Frameworks</a>.</p>
<p>This is the list of the known drivers to use OrientDB through different languages:</p>
<table>
<tr>
    <th>Language</th>
    <th>Name</th>
    <th>Type</th>
    <th>Description</th>
</tr>
<tr>
    <td rowspan="3">
      <center><a href="https://en.wikipedia.org/wiki/Java_%28programming_language%29"><img src="http://orientdb.com/wp-content/uploads/2016/09/java.jpeg" alt="JAVA" height="50px"/></a></center>
    </td>
    <td><a href="apis-and-drivers/../java/Java-API.html">Java&nbsp;(native)&nbsp;API</a></td>
    <td>Native</td>
    <td>Native implementation.</td>
</tr>
<tr>
    <td><a href="apis-and-drivers/../jdbc-driver/">JDBC driver</a></td>
    <td>Native</td>
    <td>For legacy and reporting/Business Intelligence applications and <a href="https://github.com/kirpi4ik/orientdb-jca">JCA&nbsp;integration</a> for J2EE containers</td>
</tr>
<tr>
    <td><a href="https://github.com/orientechnologies/spring-data-orientdb">OrientDB Spring Data</a></td>
    <td>Native</td>
    <td>Official <a href="http://projects.spring.io/spring-data/">Spring Data Plugin</a> for both Graph and Document APIs</td>
</tr>
<tr>
    <td rowspan="3">
        <center><a href="http://nodejs.org"><img src="http://nodejs.org/images/logos/nodejs.png" alt="NodeJs" height="50px"/></a></center>
    </td>
    <td><a href="https://github.com/orientechnologies/orientjs">OrientJS</a></td>
    <td>Native</td>
    <td>Binary protocol, new branch that has been updated with the latest functionality. Tested on 1.7.0, 2.0.x and 2.1-rc*.</td>
</tr><tr>
    <td><a href="https://github.com/Havelaer/node-orientdb-http">node-orientdb-http</a></td>
    <td>HTTP</td>
    <td>RESTful HTTP protocol. Tested on 1.6.1</td>
</tr>
<tr>
    <td><a href="https://github.com/entrendipity/gremlin-node">Gremlin-Node</a></td>
    <td></td>
    <td>To execute Gremlin queries against a remote OrientDB server</td>
</tr>
<tr>
    <td rowspan="3">
        <center><a href="http://www.php.net/"><img src="http://static.php.net/www.php.net/images/php.gif" alt="PHP" height="50px"/></a></center>
    </td>
    <td><a href="https://github.com/orientechnologies/PhpOrient">PhpOrient</a></td>
    <td>Binary</td>
    <td><b>Official Driver</b></td>
</tr>
<tr>
    <td><a href="https://github.com/AntonTerekhov/OrientDB-PHP">OrientDB-PHP</a></td>
    <td>Binary</td>
    <td>This was the first PHP driver for OrientDB, but doesn't support all OrientDB features and it's slow to support new versions of driver protocol.</td>
</tr>
<tr>
    <td><a href="https://github.com/doctrine/orientdb-odm">Doctrine ODM</a></td>
    <td>Uses <a href="https://github.com/AntonTerekhov/OrientDB-PHP">OrientDB-PHP</a></td>
    <td>High level framework to use OrientDB from PHP</td>
</tr>
<tr>
    <td>
        <center><a href="http://www.microsoft.com">.NET</a></center>
    </td>
    <td><a href="https://github.com/orientechnologies/OrientDB-NET.binary">.NET driver for OrientDB</a></td>
    <td>Binary</td>
    <td><b>Official Driver</b></td>
</tr>
<tr>
    <td rowspan="3">
        <center><a href="http://www.python.org"><img src="http://www.python.org/images/python-logo.gif" alt="Python" height="35px"/></a></center>
    </td>
    <td><a href="https://github.com/orientechnologies/pyorient">PyOrient</a></td>
    <td>Binary</td>
    <td>Community driver for Python, compatible with OrientDB 1.7 and further.</td>
</tr>
<tr>
    <td><a href="http://bulbflow.com">Bulbflow project</a></td>
    <td>HTTP</td>
    <td>Uses <a href="https://github.com/tinkerpop/rexster/wiki">Rexter</a> Graph HTTP Server to access to OrientDB database <br/> <a href="https://github.com/tinkerpop/rexster/wiki/Rexster-Configuration">Configure Rexster for OrientDB</a></td>
</tr>
<tr>
    <td><a href="https://github.com/emehrkay/Compass">Compass</a></td>
    <td>HTTP</td>
    <td></td>
</tr>
<tr>
    <td rowspan="1">
        <center><a href="https://golang.org/"><img src="http://orientdb.com/wp-content/uploads/2016/09/golang.png" alt="Go-Lang" height="50px"/></a></center>
    </td>
    <td><a href="https://github.com/istreamdata/orientgo">OrientGO</a></td>
    <td>Binary</td>
    <td>OrientGo is a Go client for the OrientDB database.</td>
</tr>
<tr>
    <td rowspan="2">
        <center><a href="https://en.wikipedia.org/wiki/C_%28programming_language%29">C</a></center>
    </td>
    <td><a href="http://github.com/tglman/orientdb-c">OrientDB-C</a></td>
    <td>Binary</td>
    <td>Binary protocol compatibles with C++ and other languages that supports C calls</td>
</tr>
<tr>
    <td><a href="https://github.com/dam2k/liborient">LibOrient</a></td>
    <td>Binary</td>
    <td>As another Binary protocol driver</td>
</tr>
<tr>
    <td rowspan="2">
        <center><a href="http://en.wikipedia.org/wiki/JavaScript"><img src="http://upload.wikimedia.org/wikipedia/commons/thumb/9/99/Unofficial_JavaScript_logo_2.svg/150px-Unofficial_JavaScript_logo_2.svg.png" alt="JavaScript" height="50px"/></a></center>
    </td>
    <td><a href="https://github.com/orientechnologies/orientdb/wiki/Javascript-Driver">Javascript&nbsp;Driver</a></td>
    <td>HTTP</td>
    <td>This driver is the simpler way to use OrientDB from JS</td>
</tr>
<tr>
    <td><a href="https://github.com/orientechnologies/orientdb-js">Javascript Graph Driver</a></td>
    <td>HTTP</td>
    <td>This driver mimics the [Blueprints](https://github.com/orientechnologies/orientdb/wiki/Graph-Database-Tinkerpop) interface. Use this driver if you're working against graphs.</td>
</tr>
<tr>
    <td rowspan="4">
        <center><a href="http://www.ruby-lang.org"><img src="https://www.ruby-lang.org/images/header-ruby-logo.png" alt="Ruby" height="35px"/></a></center></td>
    </td>
    <td><a href="https://github.com/topofocus/active-orient">Active-Orient</a></td>
    <td>HTTP</td>
    <td>Use OrientDB to persistently store dynamic Ruby-Objects and use database queries to manage even very large datasets. The gem is  rails 5 compatible.</td>
</tr>
<tr>
    <td><a href="https://github.com/aemadrid/orientdb-jruby">OrientDB-JRuby</a></td>
    <td>Native</td>
    <td>Through Java driver</td>
</tr>
<tr>
    <td><a href="https://github.com/ryanfields/orient_db_client">OrientDB Client</a></td>
    <td>Binary</td>
    <td></td>
</tr>
<tr>
    <td><a href="https://github.com/veny/orientdb4r">OrientDB4R</a></td>
    <td>HTTP</td>
    <td></td>
</tr>
<tr>
    <td>
        <center><a href="http://www.groovy-lang.org/"><img src="https://upload.wikimedia.org/wikipedia/commons/3/36/Groovy-logo.svg" alt="Groovy" height="30px"/></a></center>
    </td>
    <td><a href="https://github.com/eugene-kamenev/orientdb-groovy">OrientDB Groovy</a></td>
    <td>Java wrapper</td>
    <td>This project contains Groovy AST Transformations trying to mimic grails-entity style. All useful information you can find in Spock tests dir. Document API and Graph API with gremlin are supported. Built with OrientDB 2.1.0 and Apache Groovy 2.4.4.</td>
</tr>
<tr>
    <td rowspan="3">
        <center><a href="https://en.wikipedia.org/wiki/Scala_%28programming_language%29">SCALA</a></center>
    </td>
    <td>Any&nbsp;Java&nbsp;driver</td>
    <td>Native</td>
    <td>Scala runs on top of JVM and it's fully compatible with Java applications like OrientDB</td>
</tr>
<tr>
    <td><a href="https://orientdb.org/docs/3.0.x/scala/Scala-Language.html">Scala Page</a></td>
    <td>Native</td>
    <td>Offers suggestions and examples to use it without pains</td>
</tr>
<tr>
    <td><a href="https://github.com/eptx/OrientDBScala">Scala&nbsp;utilities&nbsp;and&nbsp;tests</a></td>
    <td>Native</td>
    <td>To help Scala developers using OrientDB</td>
</tr>
<tr>
    <td rowspan="1">
        <center><a href="https://www.r-project.org/"><img src="https://www.r-project.org/Rlogo.png" alt="R" height="50px"/></a></center>
    </td>
    <td><a href="https://github.com/retrography/OrientR">R driver</a></td>
    <td>HTTP</td>
    <td>R Bridge to execute queries against OrientDB Server</td>
</tr>
<tr>
    <td rowspan="1">
        <center><a href="http://elixir-lang.org/"><img src="http://elixir-lang.org/images/logo/logo.png" alt="Elixir" height="50px"/></a></center>
    </td>
    <td><a href="https://github.com/MyMedsAndMe/marco_polo">MarcoPolo Elixir driver</a></td>
    <td>Binary</td>
    <td>This driver allows Elixir application to interact with OrientDB. Elixir language leverages the Erlang VM, known for running low-latency, distributed and fault-tolerant systems, while also being successfully used in web development and the embedded software domain.</td>
</tr>
<tr>
    <td rowspan="2">
        <center><a href="http://clojure.org"><img src="http://orientdb.com/wp-content/uploads/2016/09/clojure.png" alt="Clojure" height="50px"/></a></center>
    </td>
    <td><a href="https://github.com/eduardoejp/clj-orient">Clojure binding</a></td>
    <td>Native</td>
    <td>Through Java driver</td>
</tr>
<tr>
    <td><a href="https://github.com/eduardoejp/clj-blueprints">Clojure binding of Blueprints API</a></td>
    <td></td>
    <td></td>
</tr>
<tr>
    <td rowspan="1">
        <center><a href="http://wuman.github.com/orientdb-android"><img src="https://github.com/wuman/orientdb-android/raw/master/doc/images/orientdb-android-logo.png" alt="Android" height="35px"/></a></center>
    </td>
    <td><a href="http://wuman.github.com/orientdb-android">OrientDB Android</a></td>
    <td>Porting</td>
    <td>OrientDB-Android is a port/fork of OrientDB for the Android platform by <a href="http://blog.wu-man.com/">David Wu</a> </td>
</tr>
<tr>
    <td rowspan="1">
        <center><a href="https://github.com/a8wright/plorient">PERL</a></center>
    </td>
    <td><a href="https://github.com/a8wright/plorient">OrientDB Perl driver</a></td>
    <td>Binary</td>
    <td>PlOrient is a Perl binary interface for OrientDB</td>
</tr>
</table>
<h2 id="supported-standards"><a class="header" href="#supported-standards">Supported standards</a></h2>
<p>This is the list of the library to use OrientDB by using such standard:</p>
<p><a href="http://www.tinkerpop.com">Apache TinkerPop</a></p>
<h3 id="tinkerpop-blueprints"><a class="header" href="#tinkerpop-blueprints">TinkerPop Blueprints</a></h3>
<p><a href="https://github.com/tinkerpop/blueprints/wiki">TinkerPop Blueprints</a>, the standard for Graph Databases. OrientDB is 100% compliant with the latest version.</p>
<p>All the trademarks are property of their legal owners.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="java-api-1"><a class="header" href="#java-api-1">Java API</a></h1>
<p>OrientDB is written completely in the Java language.  This means that you can use its Java API's without needing to install any additional drivers or adapters.</p>
<blockquote>
<p>For more information, see the <a href="http://www.orientechnologies.com/javadoc/develop/">OrientDB Java Documentation</a></p>
</blockquote>
<h2 id="component-architecture"><a class="header" href="#component-architecture">Component Architecture</a></h2>
<p><img src="java/../images/java/orientdb-api-stack.png" alt="" /></p>
<p>OrientDB provides four different Java API's that allow you to work with OrientDB.</p>
<ul>
<li><a href="java/Java-API.html#multi-model-api"><strong>MultiModel API</strong></a> Java API with Document and Graph concepts with schema-less and schemaful structures.</li>
<li><a href="java/Java-API.html#tinkerpop-3x-graph-gremlin-api"><strong>TinkerPop 3.x Graph-Gremlin API</strong></a> Implementation of TinkerPop 3.x java API</li>
<li><a href="java/Java-API.html#object-api"><strong>Object API</strong></a> Use this Java API if you need a full Object Oriented abstraction that binds all database entities to POJO (that is, Plain Old Java Objects).</li>
<li><a href="java/Java-API.html#tinkerpop-26-graph-api-deprecated"><strong>TinkerPop 2.6 Graph API (deprecated)</strong></a> Use this Java API if you work with graphs and want portable code across TinkerPop Blueprints implementations.  It is easiest to switch to this when migrating from other Graph Databases, such as Neo4J or Titan.  If you used TinkerPop standard on these, you can use OrientDB as a drop-in replacement.</li>
</ul>
<h3 id="multi-model-api"><a class="header" href="#multi-model-api">Multi-Model API</a></h3>
<blockquote>
<p>(since v 3.0)</p>
</blockquote>
<p>With this Java API, you can use OrientDB as a Document-Graph Database, allowing you to work with Vertices, Edges or simple Documents.</p>
<p>API: <a href="java/Java-MultiModel-API.html">Multi-Model, Document-Graph API</a></p>
<p>API: <a href="java/Document-Database.html">Document API</a></p>
<p>Query API: <a href="java/Java-Query-API.html">Query API</a></p>
<h3 id="tinkerpop-3x-graph-gremlin-api"><a class="header" href="#tinkerpop-3x-graph-gremlin-api">TinkerPop 3.x Graph Gremlin API</a></h3>
<p>API: <a href="java/../tinkerpop3/OrientDB-TinkerPop3.html">Apache TinkerPop 3.x</a></p>
<h3 id="object-api"><a class="header" href="#object-api">Object API</a></h3>
<p>With this Java API, you can use OrientDB with JPA-like interfaces where POJO, (that is, Plain Old Java Objects), are automatically bound to the database as documents.  You can use this in schema-less or schema-full modes.</p>
<blockquote>
<p>Bear in mind that this Java API has not received improvements since OrientDB version 1.5.  Consider using the Document API or Graph API instead, with an additional layer to map to your POJO's.</p>
</blockquote>
<p>While you can use both the Graph API and Document API at the same time, the Object API is only compatible with the Document API.  It doesn't work well with the Graph API.  The main reason is that it requires you to create POJO's that mimic the Vertex and Edge classes, which provides sub-optimal performance in comparison with using the Graph API directly.  For this reason, it is recommended that you don't use the Object API with a Graph domain.  To evaluate Object Mapping on top of OrientDB Blueprints Graph API, see <a href="https://github.com/tinkerpop/frames/wiki">TinkerPop Frames</a>, <a href="https://github.com/Syncleus/Ferma">Ferma</a> and <a href="https://github.com/BrynCooke/totorom">Totorom</a>.</p>
<p>API: <a href="java/Object-Database.html">Object Database</a></p>
<h3 id="tinkerpop-26-graph-api-deprecated"><a class="header" href="#tinkerpop-26-graph-api-deprecated">TinkerPop 2.6 Graph API (Deprecated)</a></h3>
<p>With this Java API, you can use OrientDB as a Graph Database, allowing you to work with Vertices and Edges.  The Graph API is compliant with the <a href="http://www.tinkerpop.com">TinkerPop</a> standard.</p>
<p>API: <a href="java/Graph-Database-Tinkerpop.html">Graph API</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="java-multi-model-api"><a class="header" href="#java-multi-model-api">Java Multi-Model API</a></h1>
<p><strong>(since v 3.0)</strong></p>
<p>OrientDB was born as a Document database. The fact that it has physical links
(index-free adjacency) makes it a graph database, but still, the core API was
designed as a Document API; the Graph API was added later, as a separate component,
based on Apache TinkerPop 2.x standard.</p>
<p>This led to a big discrepancy between the two APIs. See these two examples:</p>
<pre><code class="language-java">// The Document API version

ODatabaseDocument db;
...
db.begin();
ODocument doc = db.newInstance("Person");
doc.field("name", "John");
doc.save();
db.commit()
db.close();

</code></pre>
<pre><code class="language-java">// The Graph API (Apache TinkerPop 2.6) version
Graph graph;
...
OrientVertex v = graph.addVertex("class:Person");
v.setProperty("name", "John");
graph.commit();
graph.shutdown();
</code></pre>
<p>You can easily see the differences:</p>
<ul>
<li>different class hierarchies: ODocument and OrientVertex have only a common parent interface - OIdentifiable -
that doesn't even have methods to retrieve and manipulate properties</li>
<li>different way to instantiate records: <code>db.newInstance("Person")</code> vs <code>graph.addVertex("class:Person")</code></li>
<li>different manipulation API: <code>doc.field("name", "John")</code> vs <code>v.setProperty("name", "John")</code></li>
<li>different object lifecycle: did you notice the <code>doc.save()</code>?</li>
</ul>
<p>In OrientDB is a MultiModel db, so in v 3.0 we decided it was time to provide a single, <strong>unified Multi-Model API</strong>.</p>
<p>This means that with <a href="java/ref/ODatabaseDocument.html"><code>ODatabaseDocument</code></a> instances you can query documents, but also graphs, without the need for an additional API.</p>
<p><em>Don't worry, Apache TinkerPop 2.6 - together with the new 3.x - is still there, just as a separate dependency, so if you
rely on that you will have no problems migrating</em></p>
<p>Before we give you a complete overview of the new Multi-Model API, here is a basic example that demonstrates how it works:</p>
<pre><code class="language-java">ODatabaseDocument db;
...
OElement d = db.newInstance("DocClass");
d.setProperty("foo", "Bar");
d.save();

OVertex v1 = db.newVertex("VertexClass");
v1.setProperty("foo", "One");
v1.save();

OVertex v2 = db.newVertex("VertexClass");
v2.setProperty("foo", "Two");
v2.save();

v1.addEdge(v2, "EdgeClass").save();

db.commit();
</code></pre>
<p>###Multi-Model Data Hierarchy</p>
<p>The picture below shows the interface hierarchy of the Multi-Model API</p>
<p><img src="java/../images/ORecordHierarchy.png" alt="AddVertex1" /></p>
<ul>
<li>
<p><strong>ORecord</strong>: this is a pre-existing interface, common to all the persistent records</p>
<p>Its main goal is to provide an abstraction to obtain low level information (eg. identity) and behavior
(eg. save and delete) for persistent entries</p>
</li>
<li>
<p><strong><code>OBlob</code></strong>: represents BLOB (binary) records</p>
</li>
<li>
<p><a href="java/ref/OElement.html"><strong><code>OElement</code></strong></a>: represents plain documents (so also vertices and edges). It includes methods
to manipulate properties and to check if current element is a vertex or an edge.</p>
<p><em>Attention: until v 2.2 the Document API relied on ODocument class only. ODocument is still there as the main implementation of <a href="java/ref/OElement.html"><code>OElement</code></a>, but please don't use it directly, always use <a href="java/ref/OElement.html"><code>OElement</code></a> instead</em></p>
</li>
<li>
<p><a href="java/ref/OVertex.html"><strong><code>OVertex</code></strong></a>: is the basic interface for vertices, it includes methods to manipulate and traverse connected edges and vertices</p>
</li>
<li>
<p><a href="java/ref/OEdge.html"><strong><code>OEdge</code></strong></a>: is the basic interface for edges, it includes methods to retrieve info regarding connected vertices</p>
</li>
</ul>
<h3 id="query-mechanisms-and-interfaces"><a class="header" href="#query-mechanisms-and-interfaces">Query Mechanisms and Interfaces</a></h3>
<p>In v.2.2 you needed the <em>orientdb-graphdb</em> module to perform graph queries (eg. queries that use <code>out()</code>/<code>in()</code> operators);
in V 3.0 we moved all the basic graph operators to the core module, basically you don't need <em>orientdb-graphdb</em> anymore, unless
you need explicit support for Apache TinkerPop API.</p>
<p>V 3.0 also includes a new <a href="java/Java-Query-API.html">query interface</a> that explicitly return elements that can be converted to the Multi-Model
interface hierarchy.</p>
<h3 id="summary"><a class="header" href="#summary">Summary</a></h3>
<!--- [Database creation and connection](Java-MultiModel-Database-API.md)-->
<ul>
<li><a href="java/Java-MultiModel-Data-API.html">Manipulating data in Java</a></li>
<li><a href="java/Java-Query-API.html">Running SQL statements in Java</a></li>
</ul>
<!--- [Defining Database Schema](Java-MultiModel-Schema-API.md)-->
<div style="break-before: page; page-break-before: always;"></div><h1 id="working-with-document-databases"><a class="header" href="#working-with-document-databases">Working with Document Databases</a></h1>
<p>Before you can execute any operation on a Document Database, you first need to create an instance of an OrientDB context, to do this you need a valid url and eventually an server username and password.</p>
<p>The URL defines where OrientDB looks for the database and what kind it should use.  For instance, <code>embedded</code> refers to a database that is in the current system instead <code>remote</code> to a database either on a remote server or accessed through localhost.  For more information, see <a href="java/../datamodeling/Concepts.html#database-url">Database URL</a>.</p>
<h2 id="managing-database-instances"><a class="header" href="#managing-database-instances">Managing Database Instances</a></h2>
<p>When you finish with a database instance, you must close it in order to free up the system resources that it uses.  To ensure this, the most common practice is to enclose the database operation within a <code>try</code>/<code>finally</code> block.  For instance,</p>
<pre><code class="language-java">// Open the /tmp/test Document Database
OrientDB orientDB = new OrientDB("embedded:/tm/", OrientDBConfig.defaultConfig());


try(ODatabaseSession db = orientDB.open("test","admin","admin");) {
     // Enter your code here...
}
</code></pre>
<blockquote>
<p>Remember, the <code>ODatabaseSession</code> class is not thread-safe.  When using multiple threads, use separate instances of this class.  This way, they share the same storage instance, (with the same Database URL), and the same level-2 cache.</p>
<p>For more information, see <a href="java/Java-Multi-Threading.html">Multi-Threading with Java</a>.</p>
</blockquote>
<h2 id="creating-new-databases"><a class="header" href="#creating-new-databases">Creating New Databases</a></h2>
<p>In the event that the database doesn't exist already, you can create one through the Java API.  From the local file system, this is relatively straight forward, using <code>plocal</code>:</p>
<pre><code class="language-java">OrientDB orientDB = new OrientDB("embedded:/tmp/",OrientDBConfig.defaultConfig());
orientDB.create("test",ODatabaseType.PLOCAL);
//....
orientDB.close();
</code></pre>
<p>For more information on how to add/remove users/roles, change roles to a user, change passwords, please refer to <a href="java/../security/Database-Security.html">Database-Security</a></p>
<p>For creating database instances on remote servers, You need the user and password to access the remote OrientDB Server instance.  By default, OrientDB creates the <code>root</code> user when the server asking the password at first starts.</p>
<p>Example:</p>
<pre><code class="language-java">OrientDB orientDB = new OrientDB("remote:localhost","root","root_passwd",OrientDBConfig.defaultConfig());
orientDB.create("test",ODatabaseType.PLOCAL);
//....
orientDB.close();
</code></pre>
<h3 id="using-database-pools"><a class="header" href="#using-database-pools">Using Database Pools</a></h3>
<p>It is not always the best practice to create database instances every time you need them.  In cases where your application needs to scale to many database connections, such as in the case of a web app, it's often better to pool the instances together to improve performance.  By default, OrientDB provides a pool implementation. for instance,</p>
<pre><code class="language-java">
OrientDB orientDB = new OrientDB("remote:localhost","root","root_passwd",OrientDBConfig.defaultConfig());

OrientDBConfigBuilder poolCfg = OrientDBConfig.builder();
poolCfg.addConfig(OGlobalConfiguration.DB_POOL_MIN, 5);
poolCfg.addConfig(OGlobalConfiguration.DB_POOL_MAX, 10);

ODatabasePool pool = new ODatabasePool(orientDB,"test","admin","admin", poolCfg.build());
// OPEN DATABASE
try (ODatabaseSession db = pool.acquire()) {
   // YOUR CODE
   ...
}
pool.close();
orientDB.close();
</code></pre>
<p>Remember to close the database instance using the <code>.close()</code> database method as you would with classic non-pooled databases.  In cases like the above example, closing the database instance does not actually close it.  Rather, closing it releases the instance back to the pool, where it's made available to future requests.</p>
<blockquote>
<p><strong>NOTE</strong>: It's best practice to use the <code>try</code> blocks here, as it helps you to ensure the database instances are returned to the pool rather than left open.</p>
</blockquote>
<h3 id="dropping-a-database"><a class="header" href="#dropping-a-database">Dropping a database</a></h3>
<pre><code>OrientDB orientDB = new OrientDB("remote:localhost","root","root_passwd",OrientDBConfig.defaultConfig());// use embedded url for embedded environment
orientDB.drop("test");
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="manipulating-multimodel-data-in-java"><a class="header" href="#manipulating-multimodel-data-in-java">Manipulating MultiModel Data in Java</a></h1>
<p><strong>(since v 3.0)</strong></p>
<h3 id="basic-data-model"><a class="header" href="#basic-data-model">Basic Data Model</a></h3>
<p>This is the basic data hierarchy in OrientDB. Each document, vertex, edge or BLOB in the database
will be represented in Java as an object in this hierarchy.</p>
<p><img src="java/../images/ORecordHierarchy.png" alt="AddVertex1" /></p>
<ul>
<li>
<p><strong>ORecord</strong>: this is a pre-existing interface, common to all the persistent records.
Its main goal is to provide an abstraction to obtain low level information (eg. identity) and behavior
(eg. save and delete) for persistent entries</p>
</li>
<li>
<p><strong>OBlob</strong>: represents BLOB (binary) records</p>
</li>
<li>
<p><a href="java/ref/OElement.html"><strong><code>OElement</code></strong></a>: represents plain documents (so also vertices and edges). It includes methods
to manipulate properties and to check if current element is a vertex or an edge.</p>
<p><em>Attention: until v 2.2 the Document API relied on ODocument class only. ODocument is still there as the main implementation of <a href="java/ref/OElement.html"><code>OElement</code></a>, but please don't use it directly, always use OElement instead</em></p>
</li>
<li>
<p><a href="java/ref/OVertex.html"><strong><code>OVertex</code></strong></a>: is the basic interface for vertices, it includes methods to manipulate and traverse connected edges and vertices</p>
</li>
<li>
<p><a href="java/ref/OEdge.html"><strong><code>OEdge</code></strong></a>: is the basic interface for edges, it includes methods to retrieve info regarding connected vertices</p>
</li>
</ul>
<p>An ORecord has an identity and a version number, for the basic details see <a href="java/../datamodeling/Concepts.html">Basic Concepts</a></p>
<h3 id="creating-a-document"><a class="header" href="#creating-a-document">Creating a document</a></h3>
<p><a href="java/ref/ODatabaseDocument.html"><code>ODatabaseDocument</code></a> class provides the following methods to create plain documents:</p>
<ul>
<li><code>newInstance(String)</code>: creates a basic <a href="java/ref/OElement.html"><code>OElement</code></a> of a given class.</li>
<li><code>newInstance()</code>: creates a basic <a href="java/ref/OElement.html"><code>OElement</code></a>, with no schema associated (no Class). This method should be used only to create embedded documents, not to create stand-alone documents.</li>
</ul>
<p>To make the element persistent, you have to invoke the save() method on it.</p>
<p>If you are NOT in a transaction, the document will be made persistent IMMEDIATELY when you call the <code>save()</code> method.</p>
<p>If you are in a transaction, you have to invoke <code>save()</code> and then <code>commit()</code> to make the document persistent.</p>
<h5 id="basic-usage"><a class="header" href="#basic-usage">Basic usage:</a></h5>
<pre><code class="language-java">ODatabaseSession db = ... 
OElement element = db.newInstance("Person");
element.setProperty("name", "John");
element.save();
</code></pre>
<h5 id="document-lifecycle---non-transactional"><a class="header" href="#document-lifecycle---non-transactional">Document lifecycle - non transactional:</a></h5>
<pre><code class="language-java">ODatabaseSession db = ... //transaction not begun

OElement element = db.newInstance("Person");

//at this stage the record is not yet persistent

System.out.println(element.getIdentity()); //this will print a temporary RID (negative cluster position)

element.save();

//the element is now persistent

System.out.println(element.getIdentity()); //this will print the valid, final RID for that document.

</code></pre>
<h5 id="document-lifecycle---transactional"><a class="header" href="#document-lifecycle---transactional">Document lifecycle - transactional:</a></h5>
<p>example 1:</p>
<pre><code class="language-java">ODatabaseSession db = ... 
db.begin()

OElement element = db.newInstance("Person");

//at this stage the record is not yet persistent

System.out.println(element.getIdentity()); //this will print a temporary RID (negative cluster position)

element.save();

//at this stage the record is not yet persistent

System.out.println(element.getIdentity()); //this will print a temporary RID 

db.commit();

//the element is now persistent

System.out.println(element.getIdentity()); //this will print the valid, final RID for that document.

</code></pre>
<p>example 2:</p>
<pre><code class="language-java">ODatabaseSession db = ... 
db.begin()

OElement element = db.newInstance("Person");

//at this stage the record is not yet persistent

System.out.println(element.getIdentity()); //this will print a temporary RID (negative cluster position)

// element.save(); FORGET TO SAVE

//at this stage the record is not yet persistent

System.out.println(element.getIdentity()); //this will print a temporary RID 

db.commit();

//The record is STILL NOT PERSISTENT, you forgot to invoke element.save();

System.out.println(element.getIdentity()); //This still returns a temporary RID

</code></pre>
<h5 id="links-document-trees-and-save"><a class="header" href="#links-document-trees-and-save">Links, document trees and save()</a></h5>
<p>Documents can be linked together, ie. a property of a document can be a link to another document:</p>
<pre><code class="language-java">OElement doc1 = db.newInstance("Person");
OElement doc2 = db.newInstance("Person");
doc1.setProperty("theLink", doc2);    
</code></pre>
<p>When doing save/commit operations, OrientDB manages a tree of connected documents as a single persistent entity.</p>
<p>When you invoke the <code>save()</code> method on a document, OrientDB will save all the documents that are in the same tree. In the example above both <code>doc1</code> and <code>doc2</code> will be saved. If you change the example as follows:</p>
<pre><code class="language-java">OElement doc1 = db.newInstance("Person");
OElement doc2 = db.newInstance("Person");
doc2.setProperty("theLink", doc2); //see doc2.save() instead of doc1.save()    
</code></pre>
<p>the result will be exactly the same, both documents will be saved</p>
<h3 id="loading-and-reloading-documents"><a class="header" href="#loading-and-reloading-documents">Loading and Reloading documents</a></h3>
<p>You can load one or more documents from the database in two different ways:</p>
<ul>
<li>executing a query (see <a href="java/Java-Query-API.html">Query API</a>)</li>
<li>using the <code>db.load(RID)</code> API</li>
</ul>
<p>If you know the RID of a document, you can load it from the DB as follows:</p>
<pre><code class="language-java">ORID theRid = new ORecordId("#12:0");
OElement doc = db.load(theRid);
</code></pre>
<p>Sometimes you can have a reference to a document that, in the meantime, was modified by another user/process.</p>
<p>You can reload the record from the database (ie. fetch its updated state) using the <code>reload()</code> method:</p>
<pre><code class="language-java">OElement doc =  ... // an old version of the record
doc.reload();
</code></pre>
<h3 id="properties-2"><a class="header" href="#properties-2">Properties</a></h3>
<p>A document can have properties. A property is a key/value pair, where the key is a string and the value is one of the <a href="java/../general/Types.html">Supported Types</a></p>
<p>OElement interface provides methods to set and retrieve property values and names.</p>
<h5 id="property-name-syntax"><a class="header" href="#property-name-syntax">Property name syntax</a></h5>
<p>Any string is a valid property name, except:</p>
<ul>
<li><code>@rid</code> (upper or lowercase)</li>
<li><code>@class</code> (upper or lowercase)</li>
<li><code>@version</code> (upper or lowercase)</li>
<li>empty string</li>
</ul>
<p>A string name can also contain numbers, blank spaces, punctuation and special characters.</p>
<blockquote>
<p>IMPORTANT: please refer to <a href="java/../sql/SQL-Syntax.html">SQL Syntax</a> for details on how to escape property names including special characters when
writing SQL statements</p>
</blockquote>
<p>The following are valid instructions:</p>
<pre><code class="language-java">OElement doc = db.newInstance("Person");
doc.setProperty("name", "John");
doc.setProperty("12", "foo");
doc.setProperty("foo.bar", "baz");
doc.setProperty("foo", "zzz");

System.out.println(doc.getProperty("name")); //prints "John"
</code></pre>
<blockquote>
<p>IMPORTANT: <strong>Legacy ODocument API</strong> and differences with current API.</p>
</blockquote>
<blockquote>
<p>Until v 2.2 ODocument had a different API to set and access property values:</p>
</blockquote>
<pre><code class="language-java">ODocument doc = ...
doc.field("name", "John");
String value = doc.field("name");
</code></pre>
<blockquote>
<p>That API did not allow to have special characters in property names, in particular, dot notation was used to traverse links
or to retrieve values from embedded documents.
See this example to understand the difference:</p>
</blockquote>
<pre><code class="language-java">//LEGACY API
ODocument doc = ...
doc.field("foo.bar", "value1");
System.out.println(doc.field("foo.bar")); // prints nothing - fails silently

ODocument embedded = new ODocument();
embedded.field("bar", "value2");
doc.field("foo", embedded);
System.out.println(doc.field("foo.bar")); // prints "value1"
</code></pre>
<pre><code class="language-java">// NEW API
OElement element = ...
element.setProperty("foo.bar", "value1");
System.out.println(doc.getProperty("foo.bar")); // "value1"

OElement embedded = db.newInstance();
embedded.setProperty("bar", "value2");
doc.setProperty("foo", embedded);

System.out.println(doc.getProperty("foo.bar")); // still prints "value1"
System.out.println(((OElement)doc.getProperty("foo")).getProperty("bar")); // prints "value2"
</code></pre>
<h5 id="setting-a-property-value"><a class="header" href="#setting-a-property-value">Setting a property value</a></h5>
<p>The basic way to set a property value on a document is using <code>setProperty(String, Object)</code> method:</p>
<pre><code class="language-java">OElement doc = db.newInstance("Person");
doc.setProperty("name", "John");
doc.setProperty("age", 35);
doc.setProperty("tags", new String[]{"foo", "bar", "baz"});
</code></pre>
<p>Setting a property value multiple times, just overwrites the property value.</p>
<p>When working schemaless (see <a href="java/../general/Schema.html">Schema</a>), property values are saved without conversion:</p>
<ul>
<li>basic types (numbers, strings, boolean) are save as is</li>
<li>document properties (eg. <code>doc1.setProperty("parent", doc2);</code>) are saved as links</li>
<li>collections and maps of basic types are saved as is</li>
<li>collections and maps of documents are saved as link lists or link sets (based on the collection type)</li>
</ul>
<p>When working schemaful, OrientDB will try to do a conversion of types to fit the schema type. Eg. if you have a property defined as
LONG in the schema and you set an Integer value on it, the Integer will be converted to Long. If a property is defined as EMBEDDED,
setting a document as its value will result in saving the document as an embedded document.
If for some reason the conversion cannot be applied, at save time OrientDB will throw an <code>OValidationException</code></p>
<h5 id="setting-a-property-value-with-explicit-type"><a class="header" href="#setting-a-property-value-with-explicit-type">Setting a property value with explicit type</a></h5>
<p><a href="java/ref/OElement.html"><code>OElement</code></a> also provides a method to explicitly control the type of the property value:  <code>setProperty(String, Object, OType)</code>.  This is particularly useful when you do not have a schema but you want to perform specific checks or you want to save embedded
documents.</p>
<p>For instance, to set a property value as an embedded document, without defining the schema, you have to do the following:</p>
<pre><code class="language-java">OElement doc = db.newInstance("Person");
doc.setProperty("name", "John");

OElement address = db.newInstance();
address.setProperty("city", "London");
address.setProperty("street", "Foo");

doc.setProperty("address", address, OType.EMBEDDED);
</code></pre>
<h5 id="getting-document-content"><a class="header" href="#getting-document-content">Getting document content</a></h5>
<p>You can retrieve document property values using <code>getProperty(String)</code> method. eg.</p>
<pre><code class="language-java">OElement doc = ...
String name = doc.getProperty("name");
</code></pre>
<p>If you don't know which properties are defined for a specific document, you can use <code>getPropertyNames()</code> to retrieve all their names.</p>
<pre><code class="language-java">OElement doc = ...
for(String propertyName: doc.getPropertyNames()){
  Object value = doc.getProperty(propertyName);
  ...
}  
</code></pre>
<p><code>getPropertyNames()</code> returns only the properties that are defined (ie. that have a value) for a specific document. It does not
rely on the schema, so if you have a property defined in the schema for that particular document, but that document does not have
a value for that specific property, it won't be returned by <code>getPropertyNames()</code>.</p>
<h3 id="vertices-and-edges"><a class="header" href="#vertices-and-edges">Vertices and Edges</a></h3>
<p>Vertices and Edges in OrientDB are just plain documents, with the addition of particular capabilities to enforce a graph structure.</p>
<p>An <a href="java/ref/OVertex.html"><code>OVertex</code></a> represents a node in the graph, while an <a href="java/ref/OEdge.html"><code>OEdge</code></a> represents a connection between exactly two vertices.</p>
<h5 id="creating-a-vertex"><a class="header" href="#creating-a-vertex">Creating a Vertex</a></h5>
<p>ODatabaseSession provides a specific API to create vertices, that is <code>newVertex(String)</code>. The String parameter represents a class name (the type of the vertex). There is also a short version,  <code>newVertex()</code>, that is an alias for <code>newVertex("V")</code>.</p>
<blockquote>
<p>IMPORTANT: the class passed as parameter to <code>newVertex()</code> has to be V or a subclass of V.</p>
</blockquote>
<p>Here is an example on how to create a vertex</p>
<pre><code class="language-java">ODatabaseSession db ...
OVertex v = db.newVertex("Person");
</code></pre>
<h5 id="creating-an-edge"><a class="header" href="#creating-an-edge">Creating an Edge</a></h5>
<p>Creating an edge means connecting two vertices together, so the entry point API to create an edge is <code>OVertex.addEdge()</code>.</p>
<p>Here is an example on how to use it:</p>
<pre><code class="language-java">OVertex v1 = ...
OVertex v2 = ...
v1.addEdge(v2);
</code></pre>
<p>This will create an edge of type <code>E</code>, that is the base class for edges. If you want to create an edge of a specific class, you can use <code>addEdge(OVertex, String)</code> where the String parameter is the class name, or <code>addEdge(OVertex, OClass)</code>, for instance,</p>
<pre><code class="language-java">OVertex v1 = ...
OVertex v2 = ...
v1.addEdge(v2, "FriendOf");
</code></pre>
<blockquote>
<p>IMPORTANT: the class passed as parameter to <code>addEdge()</code> has to be E or a subclass of E.</p>
</blockquote>
<h5 id="vertex-and-edge-lifecycle"><a class="header" href="#vertex-and-edge-lifecycle">Vertex and Edge lifecycle</a></h5>
<p>Vertices and edges are just plain documents; each vertex links to its edges and each edge links to the two connected vertices.  This said the normal document save lifecycle applies, ie. when you have a graph of vertices and edges connected together, if you invoke <code>save()</code> method on one of the elements, all the connected graph is saved.</p>
<h5 id="deleting-vertices-and-edges"><a class="header" href="#deleting-vertices-and-edges">Deleting vertices and edges</a></h5>
<p>A graph is considered consistent all the edges are connected to exactly two vertices (from/to). This means that you cannot have edges that have one or both ends disconnected from valid vertices.</p>
<p>OrientDB will manage graph consistency for you, that means that if you delete a vertex, all the connected edges will be deleted as well; if you delete an edge, all the connected vertices will be updated to remove the references to that edge.</p>
<p>To delete a graph element, you can just use the <a href="java/ref/OElement.html"><code>OElement</code></a>.<code>delete()</code> method.</p>
<h5 id="traversing-the-graph"><a class="header" href="#traversing-the-graph">Traversing the graph</a></h5>
<p><a href="java/ref/OVertex.html"><code>OVertex</code></a> and <a href="java/ref/OEdge.html"><code>OEdge</code></a> classes provide methods to traverse the graph, that is, to access adjacent vertices and edges.</p>
<p>Given an OVertex, you can retrieve all the connected <strong>edges</strong> using <code>getEdges(ODirection)</code>, <code>getEdges(ODirection, String...)</code> methods. The <code>ODirection</code> can be <code>ODirection.OUT</code> (outgoing edges), <code>ODirection.IN</code> (incoming edges), <code>ODirection.BOTH</code> (all the edges, regardless the direction). The String parameter allows to filter on <strong>edge</strong> class names; you can specify multiple edge class names, you will traverse all the edges that belong to at least one of the classes you specified.</p>
<pre><code class="language-java">OVertex v = ...

Iterable&lt;OEdge&gt; edges = v.getEdges(ODirection.OUT, "FriendOf");
for(OEdge friendship: edges){
  Date friendsSince = friendship.getProperty("since");
}
</code></pre>
<p>Given an <a href="java/ref/OVertex.html"><code>OVertex</code></a>, you can retrieve all the connected <strong>vertices</strong> using <code>getVertices(ODirection)</code>, <code>getVertices(ODirection, String...)</code> methods. The <code>ODirection</code> can be <code>ODirection.OUT</code> (traverse outgoing edges), <code>ODirection.IN</code> (traverse incoming edges), <code>ODirection.BOTH</code> (traverse all the edges, regardless the direction). The String parameter allows to filter on <strong>edge</strong> class names; you can specify multiple edge class names, you will traverse all the edges that belong to at least one of the classes you specified.</p>
<pre><code class="language-java">OVertex v = ...

Iterable&lt;OVertex&gt; friends = v.getVertices(ODirection.OUT, "FriendOf");
for(OVertex friend: friends){
  String friendName = friend.getProperty("name");
.md}
</code></pre>
<p>The <a href="java/ref/OEdge.html"><code>OEdge</code></a> interface provides methods to retrieve the connected vertices:</p>
<ul>
<li>the entry point of the edge: <code>getFrom()</code></li>
<li>the end point of the edge: <code>getTo()</code></li>
</ul>
<pre><code class="language-java">OEdge e = ...

OVertex from = e.getFrom();
OVertex to = e.getTo();

System.out.println("the edge starts from "+from+ " and ends to "+to);
</code></pre>
<h5 id="checking-documentgraph-type"><a class="header" href="#checking-documentgraph-type">Checking document/graph type</a></h5>
<p><a href="java/ref/OElement.html"><code>OElement</code></a> interface provides methods to check whether current document is also a vertex (<code>isVertex()</code>)or an edge (<code>isEdge()</code>). It also provides methods to obtain an <a href="java/ref/OVertex.html"><code>OVertex</code></a> (<code>asVertex()</code>) or <a href="java/ref/OEdge.html"><code>OEdge</code></a> (<code>asEdge()</code>) instance from an <a href="java/ref/OElement.html"><code>OElement</code></a>. These methods return a Java <code>Optional&lt;?&gt;</code> that is empty if the element is not a vertex or an edge.</p>
<pre><code class="language-java">OElement elem = ...
if(elem.isVertex()){
  Optional&lt;OVertex&gt; v = element.asVertex();
  System.out.println("The element "+v.get()+" is a vertex!");  
}

</code></pre>
<p>or, with a Java 8 lambda:</p>
<pre><code class="language-java">OElement elem = ...
elem.asVertex().ifPresent(v -&gt; System.out.println("The element "+v+" is a vertex!"));
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="java-query-api"><a class="header" href="#java-query-api">Java Query API</a></h1>
<p><strong>(since v 3.0)</strong></p>
<h3 id="querying-the-database-in-sql"><a class="header" href="#querying-the-database-in-sql">Querying the database in SQL</a></h3>
<p>ODatabaseSession provides some methods interact with the database via SQL statements and scripts:</p>
<pre><code class="language-java">  OResultSet query(String query, Object... positionalParams)
  OResultSet query(String query, Map namedParams);

  OResultSet command(String query, Object... positionalParams);
  OResultSet command(String query, Map namedParams);
  
  OResultSet execute(String language, String script, Object... positionalParams);
  OResultSet execute(String language, String script, Map namedParams);
</code></pre>
<p><code>query()</code> methods are intended to execute idempotent statements only (eg. SELECT, MATCH, TRAVERSE).</p>
<p><code>command()</code> methods can execute any type of statements, idempotent (SELECT, MATCH...), non idempotent (INSERT, UPDATE, DELETE...) and
DDL (CREATE CLASS, CREATE PROPERTY...)</p>
<h3 id="sample-usage"><a class="header" href="#sample-usage">Sample usage</a></h3>
<p>The typical usage can be described with an example</p>
<pre><code class="language-java">ODatabaseSession db;
...
String statement = "SELECT FROM V WHERE name = ? and surname = ?";
OResultSet rs = db.query(statement, "John", "Smith");
while(rs.hasNext()){
  OResult row = rs.next();
  Date birthDate = row.getProperty("birthDate");
  ...
}
rs.close();

</code></pre>
<h3 id="query-parameters"><a class="header" href="#query-parameters">Query parameters</a></h3>
<p>Building SQL statements as a string concatenation is universally recognized as a dangerous practice.</p>
<p>See an example:</p>
<pre><code class="language-java">String name = ...
String stm = "SELECT FROM V WHERE name = '"+name+"'";
OResultSet rs = db.query(statement);
</code></pre>
<p>Apart from being hard to read, this query could also lead to SQL injection, based on the value of the <code>name</code> variable.</p>
<p>OrientDB allows to avoid string concatenation for parameter values, using named or positional parameters.</p>
<h4 id="named-parameters"><a class="header" href="#named-parameters">Named Parameters</a></h4>
<p>A named parameter is defined as an identifier preceded by a colon, eg. <code>:parameter1</code></p>
<p>An example is following:</p>
<pre><code class="language-java">String stm = "SELECT FROM V WHERE name = :name and surname = :surname";
</code></pre>
<p>The named parameters have to passed to the query API (<code>command()</code> or <code>query()</code>) as a <code>Map&lt;String, Object&gt;</code>, where the key is the
parameter name (without the colon) and the value is the parameter value, eg.</p>
<pre><code class="language-java">Map&lt;String, Object&gt; params = new HashMap&lt;&gt;();
params.put("name", "John");
params.put("surname", "Smith");

String stm = "SELECT FROM V WHERE name = :name and surname = :surname";
OResultSet rs = db.query(stm, params);
</code></pre>
<p>The same named parameter can be used multiple times in the same statement, eg. the following is valid:</p>
<pre><code class="language-java">Map&lt;String, Object&gt; params = new HashMap&lt;&gt;();
params.put("name", "John");

String stm = "SELECT FROM V WHERE name = :name and surname = :name";
OResultSet rs = db.query(stm, params);
</code></pre>
<h4 id="positional-parameters"><a class="header" href="#positional-parameters">Positional Parameters</a></h4>
<p>A positional parameter is identified by a <code>?</code>, eg.</p>
<pre><code class="language-java">String stm = "SELECT FROM V WHERE name = ? and surname = ?";
</code></pre>
<p>Positional parameters are passed to the query API as an <code>Object[]</code> or simply as java varArgs, eg.</p>
<pre><code class="language-java">String stm = "SELECT FROM V WHERE name = ? and surname = ?";
OResultSet rs = db.query(stm, "John", "Smith");
</code></pre>
<p>The order of the parameters is defined as the exact order as they appear in the string.
If you have subqueries, the order of the parameters is still defined by the order in the string, eg.</p>
<pre><code class="language-java">String stm = "SELECT FROM V WHERE name = ? and city in (SELECT FROM CITY WHERE cityName = ?) and surname = ?";
OResultSet rs = db.query(stm, "John", "London", "Smith");
</code></pre>
<p>In this query the first parameter refers to <code>name = ?</code>, the second one refers to <code>cityName = ?</code> and the third one refers to
<code>surname = ?</code></p>
<h3 id="oresult"><a class="header" href="#oresult">OResult</a></h3>
<p>The <a href="java/ref/OResult.html"><code>OResult</code></a> interface represents a row in the result-set.</p>
<p>An <a href="java/ref/OResult.html"><code>OResult</code></a> instance can represent an element with an identity (a document, a vertex or an edge) or a projection.</p>
<p>The content (the properties) of an OResult can be retrieved using <code>getProperty(String)</code>. <a href="java/ref/OResult.html"><code>OResult</code></a> also provides a <code>getPropertyNames()</code> method that returns all the property names in current row.</p>
<p>You can extract a persistent entity from an <a href="java/ref/OResult.html"><code>OResult</code></a> (in case it actually represents a vertex, an edge or a document) using the following methods</p>
<pre><code class="language-java">Optional&lt;OElement&gt; getElement()
Optional&lt;OVertex&gt; getVertex()
Optional&lt;OEdge&gt; getEdge()
</code></pre>
<p>All these methods return a Java Optional that will be empty if the OResult does not represent the specified type.</p>
<p>You can also transform any <a href="java/ref/OResult.html"><code>OResult</code></a> in an <a href="java/ref/OElement.html"><code>OElement</code></a> invoking</p>
<pre><code class="language-java">OElement toElement()
</code></pre>
<p>There is an important difference between <code>getElement()</code> and <code>toElement()</code>:</p>
<ul>
<li><code>getElement()</code> returns a non-empty <code>Optional&lt;OElement&gt;</code> only if the <a href="java/ref/OResult.html"><code>OResult</code></a> represents a persistent entity</li>
<li><code>toElement()</code> acts the same as <code>getElement()</code> (apart from the Optional) when the result of <code>getElement()</code> is not empty. In case it's not true, it returns a new (not yet persisted) <a href="java/ref/OElement.html"><code>OElement</code></a> with the same properties as the <a href="java/ref/OResult.html"><code>OResult</code></a>.</li>
</ul>
<p>You can safely use <a href="java/ref/OElement.html"><code>OElement</code></a>, <a href="java/ref/OVertex.html"><code>OVertex</code></a> and <a href="java/ref/OEdge.html"><code>OEdge</code></a> instances to update data, as long as you have an open database connection, that is,</p>
<pre><code class="language-java">ODatabaseSession db;
...
String statement = "SELECT FROM V WHERE name = ? and surname = ?";
OResultSet rs = db.query(statement, "John", "Smith");
while(rs.hasNext()){
  rs.next().getVertex().ifPresent(x-&gt;{
                   x.setProperty("age", 40);
                   x.save();
                 });
}
rs.close();
</code></pre>
<h3 id="streaming-api"><a class="header" href="#streaming-api">Streaming API</a></h3>
<p><a href="java/ref/OResultSet.html"><code>OResultSet</code></a> provides an API to convert it to a Java 8 stream:</p>
<pre><code>Stream&lt;OResult&gt; stream() 
Stream&lt;OElement&gt; elementStream()
Stream&lt;OVertex&gt; vertexStream()
Stream&lt;OEdge&gt; edgeStream()
</code></pre>
<p>IMPORTANT: please consider that the resulting streams <strong>consume</strong> the <a href="java/ref/OResultSet.html"><code>OResultSet</code></a>.</p>
<p><code>elementStream()</code>, <code>vertexStream()</code> and <code>edgeStream()</code> filter the stream returning only
the elements for which the corresponding <code>isElement/Vertex/Edge()</code> returns true;</p>
<p>Sample usage:</p>
<pre><code class="language-java">ODatabaseSession db;
...
String statement = "SELECT FROM V WHERE name = ? and surname = ?";
OResultSet rs = db.query(statement, "John", "Smith");
rs.stream().forEach(x -&gt; System.out.println(x.getProperty("age")));
rs.close();
</code></pre>
<h3 id="closing-the-oresultset"><a class="header" href="#closing-the-oresultset">Closing the OResultSet</a></h3>
<p><a href="java/ref/OResultSet.html"><code>OResultSet</code></a> is implemented as a paginated structure, that holds some iterators open during the iteration.  This is true both in remote and in embedded usage.</p>
<p>You should always invoke <code>OResultSet.close()</code> at the end of the execution, to free resources.</p>
<p><a href="java/ref/OResultSet.html"><code>OResultSet</code></a> instances are automatically closed when you close the ODatabase that returned them.</p>
<p>It is important to always close result sets, even when they are converted to streams (after the stream is consumed).</p>
<p><a href="java/ref/OResultSet.html"><code>OResultSet</code></a> implements <code>java.lang.AutoCloseable</code>, so you can use it in a <a href="https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html">try-with-resources</a> block:</p>
<pre><code class="language-java">try(OResultSet rs = db.query("SELECT FROM Foo");) {
   while(rs.hasNext()){
      OResult row = rs.next();
      ...
   }
}
</code></pre>
<h3 id="batch-scripts"><a class="header" href="#batch-scripts">Batch Scripts</a></h3>
<p>The <code>db.execute()</code> API is intended to execute scripts (SQL by default, but it can be extended to other languages - like Gremlin - with external plugins).</p>
<p>Here is an example on how to run a SQL script from Java API:</p>
<pre><code class="language-java">ODatabaseSession db;
...
String script = 
"BEGIN;"+
"LET $a = CREATE VERTEX V SET name = 'a';"+
"LET $b = CREATE VERTEX V SET name = 'b';"+
"LET $edge = CREATE EDGE E from $a to $b;"+
"COMMIT;"+
"RETURN $edge;";

OResultSet rs = db.execute("sql", script);
while(rs.hasNext()){
  OResult row = rs.next();
  ...
}
rs.close();

</code></pre>
<blockquote>
<p>IMPORTANT: the semicolon (<code>;</code>) at the end of each SQL statement is <strong>mandatory</strong></p>
</blockquote>
<blockquote>
<p>IMPORTANT: if you are migrating from previous versions, please consider that until v 2.2 the newline was a valid delimiter for SQL statements in a script (the semicolon was not mandatory); in v 3.0 a single statement in a script can be split on multiple lines.</p>
</blockquote>
<h3 id="legacy-api"><a class="header" href="#legacy-api">Legacy API</a></h3>
<p>The legacy API is still there, but the methods are deprecated. It will be removed in
next versions.  It is available only in the <code>ODatabaseDocumentTx</code> implementation, with the following methods</p>
<pre><code class="language-java">@deprecated
public &lt;RET extends OCommandRequest&gt; RET command(OCommandRequest iCommand)
@deprecated
public &lt;RET extends List&lt;?&gt;&gt; RET query(OQuery&lt;?&gt; iCommand, Object... iArgs)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="schema-2"><a class="header" href="#schema-2">Schema</a></h1>
<p>While you can use OrientDB in schema-less mode, there are times in which you need to enforce your own data model using a schema.  OrientDB supports schema-full, schema-less and schema hybrid modes.</p>
<ul>
<li><strong>Schema Full</strong> Enables the strict-mode at a class-level defining all fields as mandatory.</li>
<li><strong>Schema Less</strong>: Enables the creation of classes with no properties.  This non-strict mode is the default in OrientDB and allows records to have arbitrary fields.</li>
<li><strong>Schema Hybrid</strong>: Enables a mix of classes that are schema-full and schema-less.</li>
</ul>
<blockquote>
<p>Bear in mind, changes made to the schema are not transactional.  You must execute these operations outside of a transaction.</p>
</blockquote>
<p>To access the schema through the Console, use <a href="java/../sql/SQL-Metadata.html#querying-the-schema"><code>SELECT</code></a>.</p>
<p>In order to access and work with the schema through the Java API, you need to get the <code>OMetadata</code> object from the database, then call the <code>getSchema()</code> method. For instance,</p>
<pre><code class="language-java">OSchema schema = database.getMetadata().getSchema();
</code></pre>
<p>This sets the object <code>schema</code>, which you can then use to further define classes and properties:</p>
<ul>
<li><a href="java/Document-API-Class.html"><strong>Document Database Classes</strong></a></li>
<li><a href="java/Document-API-Property.html"><strong>Document Database Properties</strong></a></li>
</ul>
<blockquote>
<p>For more information on how to access the schema through SQL or the Console, see <a href="java/../sql/SQL-Metadata.html#querying-the-schema">Querying the Schema</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="classes-in-the-document-database"><a class="header" href="#classes-in-the-document-database">Classes in the Document Database</a></h1>
<p>The Class is a concept taken from the Object-Oriented Programming paradigm.  In OrientDB, classes define types of records.  Conceptually, it's closest to the table in Relational Databases.  You can make classes schema-less, schema-full or schema-hybrid.</p>
<p>Classes can inherit from other classes.  Inheritance means that the sub-class extends the parent class, inheriting all its attributes as if they were its own.</p>
<p>Each class has its own clusters. A class must have at least one defined cluster as its default cluster, but can support multiple clusters.  OrientDB writes new records in the default cluster, but reads always involve all defined clusters.</p>
<p>When you create a new class, OrientDB creates a new physical cluster with it, which has the same name, but set in lowercase.</p>
<h2 id="creating-persistent-classes-1"><a class="header" href="#creating-persistent-classes-1">Creating Persistent Classes</a></h2>
<p>Each class contains one or more properties, (which are also called fields).  This mode is similar to the classical model of Relational Databases, where you define tables before storing records.</p>
<p>For instance, consider the use case of creating an <code>Account</code> class through the Java API.  By default, new <a href="java/../datamodeling/Concepts.html#cluster">Physical Clusters</a> are created to store the class instances.</p>
<pre><code class="language-java">OClass account = database.createClass("Account");
</code></pre>
<p>To create a new vertex or edge type, you need to extend the <code>V</code> or <code>E</code> classes, respectively.  For example,</p>
<pre><code class="language-java">OClass person = database.createVertexClass("Account");
</code></pre>
<p>For more information, see <a href="java/Graph-Schema.html">Graph Schema</a>.</p>
<h2 id="retrieving-persistent-classes"><a class="header" href="#retrieving-persistent-classes">Retrieving Persistent Classes</a></h2>
<p>To retrieve persistent classes, use the <code>.getClass(String)</code> method.  If the class does not exist, the method returns a null value.</p>
<pre><code class="language-java">OClass account = database.getClass("Account");
</code></pre>
<h2 id="dropping-persistent-classes-1"><a class="header" href="#dropping-persistent-classes-1">Dropping Persistent Classes</a></h2>
<p>To drop a persistent class use the <a href="java/ref/OSchema/dropClass.html"><code>OSchema.dropClass(String)</code></a> method, this will remove all persistent records of the class.  For instance,</p>
<pre><code class="language-java">database.getMetadata().getSchema().dropClass("Account");
</code></pre>
<h2 id="constraints-2"><a class="header" href="#constraints-2">Constraints</a></h2>
<p>To use constraints in schema-full mode, set the strict mode at the class-level.  You can do this by calling the <code>setStrictMode(true)</code> method.  In this case, you must pre-define all properties of the record.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="properties-in-the-document-database"><a class="header" href="#properties-in-the-document-database">Properties in the Document Database</a></h1>
<p>Properties are the fields in a class.  Generally, you can consider properties as synonymous with fields.</p>
<h2 id="working-with-properties"><a class="header" href="#working-with-properties">Working with Properties</a></h2>
<h3 id="creating-properties"><a class="header" href="#creating-properties">Creating Properties</a></h3>
<p>Once you have created a class, you can create properties on that class.  For instance,</p>
<pre><code class="language-java">OClass account = database.createClass("Account");
account.createProperty("id", OType.INTEGER);
account.createProperty("birthDate", OType.DATE);
</code></pre>
<p>Bear in mind, the property must belong to a <a href="java/../general/Types.html">Type</a>.</p>
<h3 id="dropping-properties"><a class="header" href="#dropping-properties">Dropping Properties</a></h3>
<p>To drop persistent class properties, use the <a href="java/ref/OClass/dropProperty.html"><code>OClass.dropProperty(String)</code></a> method.  For instance,</p>
<pre><code class="language-java">database.getClass("Account).dropProperty("name");
</code></pre>
<p>When you drop properties using this method, note that doing so does not result in your removing records unless you explicitly do so.  In order to do so, you need to issue an SQL command through the application to run an <a href="java/../sql/SQL-Update.html"><code>UPDATE...REMOVE</code></a> statement.  For instance,</p>
<pre><code class="language-java">database.getClass("Account").dropProperty("name");
database.command("UPDATE Account REMOVE name");
</code></pre>
<h2 id="working-with-relationships"><a class="header" href="#working-with-relationships">Working with Relationships</a></h2>
<p>OrientDB supports two types of relations:</p>
<ul>
<li>
<p>Referenced Relationships</p>
</li>
<li>
<p>Embedded Relationships</p>
</li>
</ul>
<h3 id="referenced-relationships-2"><a class="header" href="#referenced-relationships-2">Referenced Relationships</a></h3>
<p>In a referenced relationship, OrientDB uses a direct link to the referenced records.  This removes the need for the computationally costly <code>JOIN</code> operation common in Relational Databases.  For instance,</p>
<pre><code>            customer
 Record A  -----------&gt;  Record B
CLASS=Invoice          CLASS=Customer
 RID=5:23                RID=10:2
</code></pre>
<p>Here, <em>Record A</em> contains a reference to <em>Record B</em> in the property <code>customer</code>,  Note that both records are accessible through any other record.  Each has a <a href="java/../datamodeling/Concepts.html#record-id">Record ID</a>.</p>
<h4 id="1-1-and-n-1-referenced-relationships"><a class="header" href="#1-1-and-n-1-referenced-relationships">1-1 and n-1 Referenced Relationships</a></h4>
<p>In the case of one-to-one and many-to-one Referenced Relationships, you can express them through the <code>LINK</code> type.  For instance, using the Document API:</p>
<pre><code class="language-java">OCLass customer = database.createClass("Customer");
customer.createProperty("name", OType.STRING);

OClass invoice = database.createClass("Invoice");
invoice.createProperty("id", OType.INTEGER);
invoice.createProperty("date", OType.DATE);
invoice.createProperty("customer", OType.LINK, customer);
</code></pre>
<p>Here, records of the class <code>Invoice</code> link to records of the class <code>Customer</code> using the field <code>customer</code>.</p>
<h4 id="1-n-and-n-m-referenced-relationships"><a class="header" href="#1-n-and-n-m-referenced-relationships">1-n and n-M Referenced Relationships</a></h4>
<p>In one-to-many and many-to-many Referenced Relationships, you can express the relationship using collections of links, such as:</p>
<ul>
<li><strong><code>LINKLIST</code></strong> Ordered list of links, which can accept duplicates.</li>
<li><strong><code>LINKSET</code></strong> Unordered set of links, which doesn't accept duplicates.</li>
<li><strong><code>LINKMAP</code></strong> Ordered map of links, with a <em>String</em> key, which also doesn't accept duplicates.</li>
</ul>
<p>For instance, in the case of a one-to-many relationship between the classes <code>Order</code> and <code>OrderItem</code>:</p>
<pre><code class="language-java">OClass orderItem = db.createClass("OrderItem");
orderItem.createProperty("id", OType.INTEGER);
orderItem.createProperty("animal", Otype.LINK, animal);

OClass order = db.createClass("Order");
order.createProperty("id", OType.INTEGER);
order.createProperty("date", OType.DATE);
order.createProperty("item", OType.LINKLIST, orderItem);

</code></pre>
<h3 id="embedded-relationships-2"><a class="header" href="#embedded-relationships-2">Embedded Relationships</a></h3>
<p>In the case of Embedded Relationships, the relationships are defined inside the records that embed them.  The relationship is stronger than the <a href="java/Document-API-Property.html#referenced-relationships">Referenced Relationship</a>.  The embedded record does not have its own Record ID, which means that you cannot reference it directly through other records.  It's only accessible through the containing record.  If you delete the container record, the embedded record is removed with it.  For instance,</p>
<pre><code>               address
  Record A    &lt;&gt;--------&gt;   Record B
CLASS=Account             CLASS=Address
  RID=5:23                 NO RECORD ID
</code></pre>
<p>Here, <em>Record A</em> contains the whole of <em>Record B</em> in the property <code>address</code>.  You can reach <em>Record B</em> only by traversing the container record.  For instance,</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM account WHERE address.city = 'Rome'</code>
</pre>
<h4 id="1-1-and-n-1-embedded-relationships"><a class="header" href="#1-1-and-n-1-embedded-relationships">1-1 and N-1 Embedded Relationships</a></h4>
<p>In one-to-one and many-to-one relationships, use the <code>EMBEDDED</code> type.  For instance,</p>
<pre><code class="language-java">OClass address = database.createClass("Address");

OClass account = database.createClass("Account");
account.createProperty("id", OType.INTEGER);
account.createProperty("birthDate", OType.DATE);
account.createProperty("address", OType.EMBEDDED, address);
</code></pre>
<p>Here, records of the class <code>Account</code> embed records of the class <code>Address</code>.</p>
<h4 id="1-n-and-n-m-embedded-relationships"><a class="header" href="#1-n-and-n-m-embedded-relationships">1-n and n-M Embedded Relationships</a></h4>
<p>In the cases of one-to-many and many-to-many relationships , use embedded link collections types:</p>
<ul>
<li><strong><code>EMBEDDEDLIST</code></strong> Ordered list of embedded links to records.</li>
<li><strong><code>EMBEDDEDSET</code></strong> Unordered set of records, which doesn't accept duplicates.</li>
<li><strong><code>EMBEDDEDMAP</code></strong> Ordered map with records as the value and a String instance as the key, which doesn't accept duplicates.</li>
</ul>
<p>For instance, consider a one-to-many relationship between <code>Order</code> and <code>OrderItem</code>:</p>
<pre><code class="language-java">OClass orderItem = db.createClass("OrderItem");
orderItem.createProperty("id", OType.INTEGER);
orderITem.createProperty("animal", OType.LINK, animal);

OClass order = db.createClass("Order");
order.createProperty("id", OType.INTEGER);
order.createProperty("date", OType.DATE);
order.createProperty("items", OType.EMBEDDEDLIST, orderItem);
</code></pre>
<h2 id="working-with-constraints"><a class="header" href="#working-with-constraints">Working with Constraints</a></h2>
<p>OrientDB supports a number of constrains on each property:</p>
<ul>
<li><strong>Minimum Value</strong>: <code>setMin()</code> Defines the smallest acceptable value for the property.  Works with strings and in date ranges.</li>
<li><strong>Maximum Value</strong>: <code>setMax()</code> Defines the largest acceptable value for the property.  Works with strings and in date ranges.</li>
<li><strong>Mandatory</strong>: <code>setMandatory()</code> Defines a required property.</li>
<li><strong>Read Only</strong>: <code>setReadonly()</code> Defines whether you can update the property after creating it.</li>
<li><strong>Not Null</strong>: <code>setNotNull()</code> Defines whether property can receive null values.</li>
<li><strong>Unique</strong>: <code>setUnique()</code> Defines whether property rejects duplicate values.  Note: Using this constraint can speed up searches made against this property.</li>
<li><strong>Regular Expression</strong> <code>setRegexp()</code> Defines whether the property must satisfy the given regular expression.</li>
</ul>
<p>For instance, consider the properties you might set on the <code>Profile</code> class for a social networking service.</p>
<pre><code class="language-java">profile.createProperty("nick", OType.STRING).setMin("3")
   .setMax("30").setMandatory(true).setNotNull(true);
profile.createIndex("nickIdx", OClass.INDEX_TYPE
   .UNIQUE, "nick");

profile.createProperty("name", OType.STRING).setMin("3")
   .setMax("30");
profile.createProperty("surname", OType.STRING)
   .setMin("3").setMax("30");
profile.createProperty("registeredOn" OType.DATE)
   .setMin("2010-01-01 00:00:00");
profile.createProperty("lastAccessOn", OType.DATE)
   .setMin("2010-01-01 00:00:00");
</code></pre>
<h3 id="indexes-as-constraints"><a class="header" href="#indexes-as-constraints">Indexes as Constraints</a></h3>
<p>To ensure that a property value remains unique, use the <code>UNIQUE</code> index constraint:</p>
<pre><code class="language-java">profile.createIndex("EmployeeId", OClass.INDEX_TYPE
   .UNIQUE, "id");
</code></pre>
<p>To ensure that a group of properties remains unique, create a composite index from multiple fields:</p>
<pre><code class="language-java">profile.createIndex("compositeIdx", OClass.INDEX_TYPE
   .NOTUNIQUE, "name", "surname");
</code></pre>
<p>For more information on indexes, see <a href="java/../indexing/Indexes.html">Indexes</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="java-api---reference"><a class="header" href="#java-api---reference">Java API - Reference</a></h1>
<p>OrientDB is written in Java and as such you can utilize the Java API without the need for any additional drivers or adapters.  Instead, with the addition of a dependency you can import OrientDB's code directly into your application to either query or manipulate data from a running instance of OrientDB or to embed the OrientDB Server itself within your application.</p>
<p>This chapter provides reference documentation for the OrientDB Java API.  The list of classes and methods documented here is not exhaustive, but rather pragmatic: focusing on those developers are more likely to use in building applications around OrientDB.</p>
<h2 id="classes-3"><a class="header" href="#classes-3">Classes</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Class</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="java/ref/OClass.html"><strong><code>OClass</code></strong></a></td><td>Manages database classes</td></tr>
<tr><td><a href="java/ref/OCluster.html"><strong><code>OCluster</code></strong></a></td><td>Manages physical and memory clusters</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument.html"><strong><code>ODatabaseDocument</code></strong></a></td><td>Manages databases.  This is the unified multi-model API.  It works with all supported database models (i.e., graph, document, object and so on).</td></tr>
<tr><td><a href="java/ref/ODatabaseSession.html"><strong><code>ODatabaseSession</code></strong></a></td><td>Subclass of <a href="java/ref/ODatabaseDocument.html"><code>ODatabaseDocument</code></a>, used to manage database sessions.</td></tr>
<tr><td><a href="java/ref/OEdge.html"><strong><code>OEdge</code></strong></a></td><td>Handles edge records.  It is a subclass of <a href="java/ref/OElement.html"><code>OElement</code></a></td></tr>
<tr><td><a href="java/ref/OElement.html"><strong><code>OElement</code></strong></a></td><td>Handles document records, superclass to <a href="java/ref/OVertex.html"><code>OVertex</code></a> and <a href="java/ref/OEdge.html"><code>OEdge</code></a> records</td></tr>
<tr><td><a href="java/ref/OFunctionLibrary.html"><strong><code>OFunctionLibrary</code></strong></a></td><td>Manages the functions available in OrientDB SQL on the database</td></tr>
<tr><td><a href="java/ref/OIntent.html"><strong><code>OIntent</code></strong></a></td><td>Manages intents (server optimizations) for particular tasks</td></tr>
<tr><td><a href="java/ref/OLiveQueryResultListener.html"><strong><code>OLiveQueryResultListener</code></strong></a></td><td>Super class used to manage <a href="java/ref/../Live-Query.html">Live Queries</a></td></tr>
<tr><td><a href="java/ref/OMetadata.html"><strong><code>OMetadata</code></strong></a></td><td>Interface used to store database metadata, such as the function library, schema and security</td></tr>
<tr><td><a href="java/ref/OProperty.html"><strong><code>OProperty</code></strong></a></td><td>Manages properties on an <a href="java/ref/OClass.html"><code>OClass</code></a> instance</td></tr>
<tr><td><a href="java/ref/OResult.html"><strong><code>OResult</code></strong></a></td><td>Interface for operating on records in a result-set</td></tr>
<tr><td><a href="java/ref/OResultSet.html"><strong><code>OResultSet</code></strong></a></td><td>Result-set returned by queries</td></tr>
<tr><td><a href="java/ref/ORID.html"><strong><code>ORID</code></strong></a></td><td>Record ID for <a href="java/ref/OElement.html"><code>OElement</code></a>, <a href="java/ref/OEdge.html"><code>OEdge</code></a> and <a href="java/ref/OVertex.html"><code>OVertex</code></a> instances</td></tr>
<tr><td><a href="java/ref/OrientDB.html"><strong><code>OrientDB</code></strong></a></td><td>Connects to and interacts with the OrientDB Server</td></tr>
<tr><td><a href="java/ref/ORule.html"><strong><code>ORule</code></strong></a></td><td>Defines rule for resources that a user or role can access</td></tr>
<tr><td><a href="java/ref/OSchema.html"><strong><code>OSchema</code></strong></a></td><td>Defines a schema for the database to enforce</td></tr>
<tr><td><a href="java/ref/OSecurityRole.html"><strong><code>OSecurityRole</code></strong></a></td><td>Controls a role and the access it has to database resources</td></tr>
<tr><td><a href="java/ref/OSecurityUser.html"><strong><code>OSecurityUser</code></strong></a></td><td>Controls a user and the access it has to database resources</td></tr>
<tr><td><a href="java/ref/OServer.html"><strong><code>OServer</code></strong></a></td><td>Embeds the OrientDB Server</td></tr>
<tr><td><a href="java/ref/OTransaction.html"><strong><code>OTransaction</code></strong></a></td><td>Controls a transaction on the database</td></tr>
<tr><td><a href="java/ref/OType.html"><strong><code>OType</code></strong></a></td><td>Defines the data-types of properties</td></tr>
<tr><td><a href="java/ref/OVertex.html"><strong><code>OVertex</code></strong></a></td><td>Handles vertex records.  It is a subclass of <a href="java/ref/OElement.html"><code>OElement</code></a></td></tr>
</tbody></table>
</div>
<p>In the event that you don't find a page for the class or method you're looking for, see the <a href="https://orientdb.dev/javadocs/develop">Javadocs</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="java-api---oclass"><a class="header" href="#java-api---oclass">Java API - OClass</a></h1>
<p>This class provides a standard interface for handling database classes.</p>
<h2 id="managing-database-classes"><a class="header" href="#managing-database-classes">Managing Database Classes</a></h2>
<p>OrientDB draws from the Object Oriented programming paradigm in the concept of a <a href="java/ref/../../general/Schema.html#class">class</a>, which for the purposes of clarity is called a <em>database class</em> in this Reference guide, to avoid confusion with classes in Java.  Database classes are loosely comparable with tables in Relational databases.  But, unlike tables, database classes are not required to follow a schema unless you want them to follow a schema.  In Java, database classes implement the <code>OClass</code> class.</p>
<p>This class is available at <code>com.orientechnologies.orient.core.metadata.schema</code>.</p>
<pre><code class="language-java">import com.orientechnologies.orient.core.metadata.schema.OClass;
</code></pre>
<p>Once you've imported the class to your application, you can use to build particular instances in your code.</p>
<h2 id="methods-1"><a class="header" href="#methods-1">Methods</a></h2>
<h3 id="managing-classes"><a class="header" href="#managing-classes">Managing Classes</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Return Type</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="java/ref/OClass/addSuperClass.html"><strong><code>addSuperClass()</code></strong></a></td><td><code>OClass</code></td><td>Adds a superclass to the database class</td></tr>
<tr><td><a href="java/ref/OClass/count.html"><strong><code>count()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Long.html"><code>Long</code></a></td><td>Counts the number of records in the class</td></tr>
<tr><td><a href="java/ref/OClass/getAllSubclasses.html"><strong><code>getAllSubclasses()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Collection.html"><code>Collection</code></a><a href="java/ref/OClass.html"><code>&lt;OClass&gt;</code></a></td><td>Retrieves classes that use this class as their superclass, and subclasses of these classes, (the complete hierarchy)</td></tr>
<tr><td><a href="java/ref/OClass/getAllSuperClasses.html"><strong><code>getAllSuperClasses()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Collection.html"><code>Collection</code></a><a href="java/ref/OClass.html"><code>&lt;OClass&gt;</code></a></td><td>Retrieves all superclasses of this class</td></tr>
<tr><td><a href="java/ref/OClass/getSubclasses.html"><strong><code>getSubclasses()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Collection.html"><code>Collection</code></a><a href="java/ref/OClass.html"><code>&lt;OClass&gt;</code></a></td><td>Retrieves classes that use this class as their immediate superclass, (one level hierarchy)</td></tr>
<tr><td><a href="java/ref/OClass/getSuperClassesNames.html"><strong><code>getSuperClassesNames()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/List.html"><code>List</code></a><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>&lt;String&gt;</code></a></td><td>Retrieves the names of all superclasses for this class</td></tr>
<tr><td><a href="java/ref/OClass/hasSuperClasses.html"><strong><code>hasSuperClasses()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>boolean</code></a></td><td>Determines whether the class has superclasses</td></tr>
<tr><td><a href="java/ref/OClass/isEdgeType.html"><strong><code>isEdgeType()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>boolean</code></a></td><td>Determines whether the class is an edge</td></tr>
<tr><td><a href="java/ref/OClass/isVertexType.html"><strong><code>isVertexType()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>boolean</code></a></td><td>Determines whether the class is a vertex</td></tr>
<tr><td><a href="java/ref/OClass/removeSuperClass.html"><strong><code>removeSuperClass()</code></strong></a></td><td><code>OClass</code></td><td>Removes a superclass from the class</td></tr>
<tr><td><a href="java/ref/OClass/setName.html"><strong><code>setName()</code></strong></a></td><td><code>OClass</code></td><td>Sets the class name</td></tr>
</tbody></table>
</div>
<h3 id="managing-clusters"><a class="header" href="#managing-clusters">Managing Clusters</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Return Type</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="java/ref/OClass/addCluster.html"><strong><code>addCluster()</code></strong></a></td><td><code>OClass</code></td><td>Adds a cluster to the database class, by its name</td></tr>
<tr><td><a href="java/ref/OClass/addClusterId.html"><strong><code>addClusterId()</code></strong></a></td><td><code>OClass</code></td><td>Add a cluster to the database class, by its Cluster ID</td></tr>
<tr><td><a href="java/ref/OClass/getClusterIds.html"><strong><code>getClusterIds</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Array.html"><code>int[]</code></a></td><td>Retrieves ID's for clusters on the class</td></tr>
<tr><td><a href="java/ref/OClass/getDefaultClusterId.html"><strong><code>getDefaultClusterId()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Integer.html"><code>int</code></a></td><td>Retrieves the default Cluster ID</td></tr>
<tr><td><a href="java/ref/OClass/hasClusterId.html"><strong><code>hasClusterId()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>boolean</code></a></td><td>Determines whether the class uses the given Cluster ID</td></tr>
<tr><td><a href="java/ref/OClass/hasPolymorphicClusterId.html"><strong><code>hasPolymorphicClusterId()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>boolean</code></a></td><td>Determines whether the class or any superclasses of the class use the given Cluster ID</td></tr>
<tr><td><a href="java/ref/OClass/setDefaultClusterId.html"><strong><code>setDefaultClusterId()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Void.html"><code>void</code></a></td><td>Configures the default cluster, by Cluster ID</td></tr>
<tr><td><a href="java/ref/OClass/removeClusterId.html"><strong><code>removeClusterId()</code></strong></a></td><td><code>OClass</code></td><td>Removes a Cluster ID</td></tr>
<tr><td><a href="java/ref/OClass/truncate.html"><strong><code>truncate()</code></strong></a></td><td><code>void</code></td><td>Removes all data from all clusters on the class</td></tr>
<tr><td><a href="java/ref/OClass/truncateCluster.html"><strong><code>truncateCluster()</code></strong></a></td><td><code>OClass</code></td><td>Removes all data in cluster with the given name</td></tr>
</tbody></table>
</div>
<h3 id="managing-properties"><a class="header" href="#managing-properties">Managing Properties</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Return Type</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="java/ref/OClass/createProperty.html"><strong><code>createProperty()</code></strong></a></td><td><a href="java/ref/OProperty.html"><code>OProperty</code></a></td><td>Creates a property (that is, a field) on the class</td></tr>
<tr><td><a href="java/ref/OClass/dropProperty.html"><strong><code>dropProperty()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Void.html"><code>void</code></a></td><td>Removes property from class</td></tr>
<tr><td><a href="java/ref/OClass/existsProperty.html"><strong><code>existsProperty()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>boolean</code></a></td><td>Determines whether a property exists on the class</td></tr>
<tr><td><a href="java/ref/OClass/getIndexedProperties.html"><strong><code>getIndexedProperties()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Collection.html"><code>Collection</code></a> <a href="java/ref/OProperty.html"><code>&lt;OProperty&gt;</code></a></td><td>Retrieves a collection of properties that are indexed</td></tr>
<tr><td><a href="java/ref/OClass/getProperty.html"><strong><code>getProperty()</code></strong></a></td><td><a href="java/ref/OProperty.html"><code>OProperty</code></a></td><td>Retrieves the given property</td></tr>
<tr><td><a href="java/ref/OClass/properties.html"><strong><code>properties()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Collection.html"><code>Collection</code></a><a href="java/ref/OProperty.html"><code>&lt;OProperty&gt;</code></a></td><td>Retrieves properties on the class</td></tr>
<tr><td><a href="java/ref/OClass/propertiesMap.html"><strong><code>propertiesMap()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Map.html"><code>Map</code></a> <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>&lt;String, </code></a><code>OProperty&gt;</code></td><td>Retrieves properties on the class</td></tr>
</tbody></table>
</div>
<h3 id="managing-indexes"><a class="header" href="#managing-indexes">Managing Indexes</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Return Type</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="java/ref/OClass/areIndexed.html"><strong><code>areIndexed()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>Boolean</code></a></td><td>Determines whether the given fields are contained as first key fields in the database class indexes</td></tr>
<tr><td><a href="java/ref/OClass/createIndex.html"><strong><code>createIndex()</code></strong></a></td><td><code>OIndex&lt;?&gt;</code></td><td>Creates an index on the given property</td></tr>
<tr><td><a href="java/ref/OClass/getAutoShardingIndex.html"><strong><code>getAutoShardingIndex()</code></strong></a></td><td><code>OIndex&lt;?&gt;</code></td><td>Retrieves the auto sharding index configured for the class, if any</td></tr>
<tr><td><a href="java/ref/OClass/getClassIndex.html"><strong><code>getClassIndex()</code></strong></a></td><td><code>OIndex&lt;?&gt;</code></td><td>Retrieves the requested index instance</td></tr>
<tr><td><a href="java/ref/OClass/getClassIndexes.html"><strong><code>getClassIndexes()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Set.html"><code>Set</code></a><code>&lt;OIndex&lt;?&gt;&gt;</code></td><td>Retrieves indexes for the class</td></tr>
<tr><td><a href="java/ref/OClass/getClassInvolvedIndexes.html"><strong><code>getClassInvolvedIndexes()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Set.html"><code>Set</code></a><code>&lt;OIndex&lt;?&gt;&gt;</code></td><td>Retrieves indexes that include the given properties as first keys</td></tr>
<tr><td><a href="java/ref/OClass/getIndexedProperties.html"><strong><code>getIndexedProperties()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Collection.html"><code>Collection</code></a><a href="java/ref/OProperty.html"><code>&lt;OProperty&gt;</code></a></td><td>Retrieves a collection of properties that are indexed</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="oclass---addcluster"><a class="header" href="#oclass---addcluster">OClass - addCluster()</a></h1>
<p>This method adds a cluster to the database class.</p>
<h2 id="adding-clusters"><a class="header" href="#adding-clusters">Adding Clusters</a></h2>
<p>When OrientDB saves records, it stores then clusters, using either physical or in-memory storage.  With this method you can add a cluster to the class.</p>
<h3 id="syntax-6"><a class="header" href="#syntax-6">Syntax</a></h3>
<pre><code>OClass OClass().addCluster(String name)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>name</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the cluster name</td></tr>
</tbody></table>
</div>
<h4 id="return-type"><a class="header" href="#return-type">Return Type</a></h4>
<p>This method returns the updated <a href="java/ref/OClass/../OClass.html"><code>OClass</code></a> instance.</p>
<h3 id="examples-42"><a class="header" href="#examples-42">Examples</a></h3>
<p>Consider the use case of a method that provisions a database for your application.  You might run this as part of the installation process or to set up a new database for a particular process.</p>
<pre><code class="language-java">public ODatabaseDocument db;
private Logger logger;

// Provision Class with new Clusters
public void provisionClassClusters(OClass cls, List&lt;String&gt; clusters){

   // Log Operation
   logger.info("Adding clusters to class");

   // Iterator over List of Clusters
   for(String name : clusters){

      logger.debug(
	     String.format("Creating Cluster '%s' on class '%s'",
		    name,
			cls.getName());
      cls.addCluster(name);
   }
   logger.debug("Done");
}
</code></pre>
<p>This method takes an <a href="java/ref/OClass/../OClass.html"><code>OClass</code></a> instance and a <a href="https://docs.oracle.com/javase/8/docs/java/util/List.html"><code>List</code></a><a href="https://docs.oracle.com/javase/8/docs/java/lang/String.html"><code>&lt;String&gt;</code></a> instance, which contains a list of new cluster names.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oclass---addclusterid"><a class="header" href="#oclass---addclusterid">OClass - addClusterId()</a></h1>
<p>This method adds a cluster to the database class.</p>
<h2 id="adding-clusters-1"><a class="header" href="#adding-clusters-1">Adding Clusters</a></h2>
<p>When OrientDB saves records, it stores then clusters, using either physical or in-memory storage.  With this method you can add a cluster to the class, defining the cluster by the Cluster ID.</p>
<h3 id="syntax-7"><a class="header" href="#syntax-7">Syntax</a></h3>
<pre><code>OClass OClass().addClusterId(int name)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>name</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Integer.html"><code>Integer</code></a></td><td>Defines the Cluster ID</td></tr>
</tbody></table>
</div>
<h4 id="return-type-1"><a class="header" href="#return-type-1">Return Type</a></h4>
<p>This method returns the updated <a href="java/ref/OClass/../OClass.html"><code>OClass</code></a> instance.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oclass---addsuperclass"><a class="header" href="#oclass---addsuperclass">OClass - addSuperClass()</a></h1>
<p>This method adds a superclass to the database class.</p>
<h2 id="adding-superclasses"><a class="header" href="#adding-superclasses">Adding Superclasses</a></h2>
<p>OrientDB supports polymorphism in database classes.  This means that you can register an <a href="java/ref/OClass/../OClass.html"><code>OClass</code></a> instance to extend another <a href="java/ref/OClass/../OClass.html"><code>OClass</code></a> instance.  Using this method, you can assign the given database class as the superclass to this class.</p>
<h3 id="syntax-8"><a class="header" href="#syntax-8">Syntax</a></h3>
<pre><code>OClass OClass().addSuperClass(OClass superClass)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>superClass</code></strong></td><td><a href="java/ref/OClass/../OClass.html"><code>OClass</code></a></td><td>Defines the superclass</td></tr>
</tbody></table>
</div>
<h4 id="return-value"><a class="header" href="#return-value">Return Value</a></h4>
<p>This method returns an <a href="java/ref/OClass/../OClass.html"><code>OClass</code></a> instance.</p>
<h3 id="example-54"><a class="header" href="#example-54">Example</a></h3>
<p>Imagine you want a method to provision a database for your application.  You might want to add a series of classes in sequence and then add them to the relevant superclass.</p>
<pre><code class="language-java">private ODatabaseDocument db;
private Logger logger;

public void provisionSubClasses(OClass superCls, List&lt;OClass&gt; classes){

    // Log Operation
	logger.info(String.format( 
		"Adding subclasses to %s",
		superCls.getName()));

	// Iterate over subclasses 
	for(OClass cls : classes){

		// Log Debug Message
		logger.debug(String.format(
		   "Adding subclass '%s',
		   cls.getName()));

		// Add Superclass to Class
		cls.addSuperClass(superCls);
	}
	logger.debug("Done");
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oclass---count"><a class="header" href="#oclass---count">OClass - count()</a></h1>
<p>This method counts the number of the records of this class.  It also considers the records in subclasses.</p>
<h2 id="counting-records"><a class="header" href="#counting-records">Counting Records</a></h2>
<p>When you create records on the database, they're created as part of a database class.  Using this method you can retrieve a count of all records created on the given class.  By default, it includes all subclasses.  You can also pass it a <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>Boolean</code></a> instance to define whether you want it to exclude subclass records.</p>
<h3 id="syntax-9"><a class="header" href="#syntax-9">Syntax</a></h3>
<pre><code>// METHOD 1
Long OClass().count() 

// METHOD 2
Long OClass().count(Boolean isPolymorphic)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>isPolymorphic</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>Boolean</code></a></td><td>Determines whether method includes records of subclasses in the count</td></tr>
</tbody></table>
</div>
<h4 id="return-value-1"><a class="header" href="#return-value-1">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Long.html"><code>Long</code></a> instance, which provides the number of records in the database class or class and subclasses.</p>
<h3 id="example-55"><a class="header" href="#example-55">Example</a></h3>
<p>Imagine a social media application where the user accounts are defined by a dedicated class.  You might use the <code>count()</code> method to report membership on the webpage.</p>
<pre><code class="language-java">private ODatabaseDocument;
private Logger logger;

public Long getUserCount(){

   // Retrieve the User OClass
   OClass userCls = db.getClass("users");

   // Return User Count
   return userCls.count();
}
</code></pre>
<p>This method uses the <a href="java/ref/OClass/../ODatabaseDocument/getClass.html"><code>getClass()</code></a> method to retrieve the user class name, the executes the <code>count()</code> method to return the number of records on the class.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oclass---createindex"><a class="header" href="#oclass---createindex">OClass - createIndex()</a></h1>
<p>This method creates an index on the given fields.</p>
<h2 id="creating-indexes-1"><a class="header" href="#creating-indexes-1">Creating Indexes</a></h2>
<p>OrientDB provides support for several different types of indexes, which can help improve performance in retrieving records.  Using this method, you can create them on a particular class, indexing the given fields (that is, properties), on the class.</p>
<h3 id="syntax-10"><a class="header" href="#syntax-10">Syntax</a></h3>
<pre><code>// METHOD 1
OIndex&lt;?&gt; OClass().createIndex(String name,
	OClass.INDEX_TYPE type,
	String... fields)

// METHOD 2
OIndex&lt;?&gt; OClass().createIndex(String name, 
	String type-name, 
	OProgressListener listener,
	ODocument metadata, 
	String... fields)

// METHOD 3
OIndex&lt;?&gt; OClass().createIndex(String name, 
	String type-name,
	OProgressListener listener
	ODocument metadata,
	String algorithm,
	String... fields)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>name</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the index name</td></tr>
<tr><td><strong><code>type</code></strong></td><td><code>OClass.INDEX_TYPE</code></td><td>Defines the index type</td></tr>
<tr><td><strong><code>fields</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the fields to index</td></tr>
<tr><td><strong><code>type-name</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the index type, as a string</td></tr>
<tr><td><strong><code>listener</code></strong></td><td><code>OProgressListener</code></td><td>Defines the progress listener for the index</td></tr>
<tr><td><strong><code>metadata</code></strong></td><td><code>ODocument</code></td><td>Defines metadata for the index</td></tr>
<tr><td><strong><code>algorithm</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the algorithm to use</td></tr>
</tbody></table>
</div>
<h4 id="return-value-2"><a class="header" href="#return-value-2">Return Value</a></h4>
<p>This method creates an index on the given properties for the class.  It then returns the index as an <code>OIndex</code> instance.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oclass---createproperty"><a class="header" href="#oclass---createproperty">OClass - createProperty()</a></h1>
<p>This method creates a property on the class.</p>
<h2 id="creating-properties-1"><a class="header" href="#creating-properties-1">Creating Properties</a></h2>
<p>Classes in OrientDB can feature fields that contain particular types of data.  In the comparison to Relational databases, if the class is the table, the properties are the columns in the table.  Using this method, you can create new properties on the class, naming it and typing its contents.</p>
<h3 id="syntax-11"><a class="header" href="#syntax-11">Syntax</a></h3>
<pre><code>// METHOD 1
OProperty OClass().createProperty(
	String name, 
	OType type)

// METHOD 2
OProperty OClass().createProperty(
	String name, 
	OType type,
	OClass linkedClass)

// METHOD 3
OProperty OClass().createProperty(
	String name, 
	OType type,
	OType linkedType)

// METHOD 4
OProperty OClass().createProperty(
	String name, 
	OType type,
	OType linkedType, 
	Boolean isUnsafe)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>name</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the property name</td></tr>
<tr><td><strong><code>type</code></strong></td><td><a href="java/ref/OClass/../OType.html"><code>OType</code></a></td><td>Defines the property type</td></tr>
<tr><td><strong><code>linkedClass</code></strong></td><td><a href="java/ref/OClass/../OClass.html"><code>OClass</code></a></td><td>Defines the class to link to, for use with properties of the type <code>LINK</code>, <code>LINKLIST</code>, <code>LINKSET</code>, <code>LINKMAP</code>, <code>EMBEDDED</code>, <code>EMBEDDEDLIST</code>.  You can further specify the type for embedded classes.</td></tr>
<tr><td><strong><code>linkedType</code></strong></td><td><a href="java/ref/OClass/../OType.html"><code>OType</code></a></td><td>Defines the linked type, for use with properties of the types: <code>EMBEDDEDLIST</code>, <code>EMBEDDEDSET</code> or <code>EMBEDDEDMAP</code>.  Set this argument to <code>null</code> for all other cases.</td></tr>
<tr><td><strong><code>isUnsafe</code></strong></td><td>Defines whether it should check the persistent data for compatibility.  Only use if all persistent data is compatible with the property.</td><td></td></tr>
</tbody></table>
</div>
<h4 id="return-value-3"><a class="header" href="#return-value-3">Return Value</a></h4>
<p>This method returns the created property as an <a href="java/ref/OClass/../OProperty.html"><code>OProperty</code></a> instance.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oclass---dropproperty"><a class="header" href="#oclass---dropproperty">OClass - dropProperty()</a></h1>
<p>This method removes a property from the class.</p>
<h2 id="removing-properties"><a class="header" href="#removing-properties">Removing Properties</a></h2>
<p>Occasionally, you may encounter situations where you need to rework class instances from within your application.  Using this method you can remove properties from the <a href="java/ref/OClass/../OClass.html"><code>OClass</code></a> instance.</p>
<h3 id="syntax-12"><a class="header" href="#syntax-12">Syntax</a></h3>
<pre><code>void OClass().dropProperty(String name)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>name</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the property name</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="oclass---existsproperty"><a class="header" href="#oclass---existsproperty">OClass - existsProperty()</a></h1>
<p>This method determines whether the given property exists on the class.</p>
<h2 id="checking-properties"><a class="header" href="#checking-properties">Checking Properties</a></h2>
<p>In cases where your application operates on a database it didn't configure or when you suspect other clients or users might have modified the class schema, you may want to check that a given property exists before initiating an operation.  This method checks whether the given property name exists.  You can then use its return to decide whether or not you want to proceed.</p>
<h3 id="syntax-13"><a class="header" href="#syntax-13">Syntax</a></h3>
<pre><code>boolean OClass().existsProperty(String name)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>name</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the property name</td></tr>
</tbody></table>
</div>
<h4 id="return-value-4"><a class="header" href="#return-value-4">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>Boolean</code></a> result.  The return value is <code>true</code> when the given property name exists on the class.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oclass---getallsubclasses"><a class="header" href="#oclass---getallsubclasses">OClass - getAllSubclasses()</a></h1>
<p>This method retrieves all subclasses of the class.</p>
<h2 id="retrieving-subclasses"><a class="header" href="#retrieving-subclasses">Retrieving Subclasses</a></h2>
<p>OrientDB borrows the concept of a class from the Object Oriented programming paradigm.  This borrowing includes polymorphism, the idea that a database class can have subclasses.  Using this method, you can retrieve all subclasses of the given class and the subclasses of these subclasses.</p>
<p>Note, the method retrieves the complete hierarchy of the class, following inheritance of subclasses to the immediate subclasses.  In cases where you only want to retrieve the immediate subclasses to the class, use the <a href="java/ref/OClass/getSubclasses.html"><code>getSubclasses()</code></a> method.</p>
<h3 id="syntax-14"><a class="header" href="#syntax-14">Syntax</a></h3>
<pre><code>Collection&lt;OClass&gt; OClass().getAllSubclasses()
</code></pre>
<h4 id="return-value-5"><a class="header" href="#return-value-5">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Collection.html"><code>Collection</code></a> instance that contains a series of <a href="java/ref/OClass/../OClass.html"><code>OClass</code></a> instances for the retrieved subclasses.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oclass---getallsuperclasses"><a class="header" href="#oclass---getallsuperclasses">OClass - getAllSuperClasses()</a></h1>
<p>This method retrieves <a href="java/ref/OClass/../OClass.html"><code>OClass</code></a> instances for all classes registered as superclasses of this class.</p>
<h2 id="retrieving-super-classes"><a class="header" href="#retrieving-super-classes">Retrieving Super Classes</a></h2>
<p>OrientDB borrows the concept of a class from the Object Oriented programming paradigm.  This borrowing includes polymorphism, the idea that a database class can have subclasses.  Using this method, you can retrieve all superclasses of the given class.</p>
<h3 id="syntax-15"><a class="header" href="#syntax-15">Syntax</a></h3>
<pre><code>Collection&lt;OClass&gt; OClass().getAllSuperClasses()
</code></pre>
<h4 id="return-value-6"><a class="header" href="#return-value-6">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Collection.html"><code>Collection</code></a> instance that contains instances of <a href="java/ref/OClass/../OClass.html"><code>OClass</code></a> for each class that is a superclass of this class.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oclass---getautoshardingindex"><a class="header" href="#oclass---getautoshardingindex">OClass - getAutoShardingIndex()</a></h1>
<p>This method retrieves the auto sharding index configured for the class, if any.</p>
<h2 id="retrieving-auto-sharding-indexes"><a class="header" href="#retrieving-auto-sharding-indexes">Retrieving Auto Sharding Indexes</a></h2>
<h3 id="syntax-16"><a class="header" href="#syntax-16">Syntax</a></h3>
<pre><code>OIndex&lt;?&gt; OClass().getAutoShardingIndex()
</code></pre>
<h4 id="return-value-7"><a class="header" href="#return-value-7">Return Value</a></h4>
<p>This method returns an <code>OIndex&lt;?&gt;</code> instance for the auto-sharding index configured for the class.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oclass---getclassindex"><a class="header" href="#oclass---getclassindex">OClass - getClassIndex()</a></h1>
<p>This method retrieves the given index for the class.</p>
<h2 id="retrieving-indexes"><a class="header" href="#retrieving-indexes">Retrieving Indexes</a></h2>
<h3 id="syntax-17"><a class="header" href="#syntax-17">Syntax</a></h3>
<pre><code>OIndex&lt;?&gt; OClass().getClassIndex(String name)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>name</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the database index name</td></tr>
</tbody></table>
</div>
<h4 id="return-value-8"><a class="header" href="#return-value-8">Return Value</a></h4>
<p>This method returns an <code>OIndex&lt;?&gt;</code> instance for the requested index.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oclass---getclassindexes"><a class="header" href="#oclass---getclassindexes">OClass - getClassIndexes()</a></h1>
<p>This method retrieves indexes for the class.</p>
<h2 id="retrieving-indexes-1"><a class="header" href="#retrieving-indexes-1">Retrieving Indexes</a></h2>
<h3 id="syntax-18"><a class="header" href="#syntax-18">Syntax</a></h3>
<pre><code>Set&lt;OIndex&lt;?&gt;&gt; OClass().getClassIndexes()
</code></pre>
<h4 id="return-value-9"><a class="header" href="#return-value-9">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Set.html"><code>Set</code></a> instance, which contains the <code>OIndex&lt;?&gt;</code> instances for the class.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oclass---getclassinvolvedindexes"><a class="header" href="#oclass---getclassinvolvedindexes">OClass - getClassInvolvedIndexes()</a></h1>
<p>This method retrieves indexes that contain the given field names as their first keys.</p>
<h2 id="retrieving-class-involved-indexes"><a class="header" href="#retrieving-class-involved-indexes">Retrieving Class Involved Indexes</a></h2>
<h3 id="syntax-19"><a class="header" href="#syntax-19">Syntax</a></h3>
<pre><code>// METHOD 1
Set&lt;OIndex&lt;?&gt;&gt; OClass().getClassInvolvedIndexes(Collection&lt;String&gt; colFields)

// METHOD 2
Set&lt;OIndex&lt;?&gt;&gt; OClass().getClassInvolvedIndexes(String... strFields)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>colFields</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Collection.html"><code>Collection</code></a><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>&lt;String&gt;</code></a></td><td>Defines the fields to check</td></tr>
<tr><td><strong><code>strFields</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the fields to check</td></tr>
</tbody></table>
</div>
<h4 id="return-value-10"><a class="header" href="#return-value-10">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Set.html"><code>Set</code></a> instance that contains instances of <code>OIndex&lt;?&gt;</code> for each index that includes the given fields as first keys.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oclass---getclusterids"><a class="header" href="#oclass---getclusterids">OClass - getClusterIds()</a></h1>
<p>This method retrieves the ID's for all clusters registered with the class.</p>
<h2 id="retrieving-cluster-ids"><a class="header" href="#retrieving-cluster-ids">Retrieving Cluster ID's</a></h2>
<p>When OrientDB stores records it assigns each a Record ID, (for instance #5:24).  The first element of a Record ID provides the Cluster ID, the second the position of the record in the cluster. Using this method you can retrieve the ID's for all clusters registered with the <a href="java/ref/OClass/../OClass.html"><code>OClass</code></a> instance.</p>
<h3 id="syntax-20"><a class="header" href="#syntax-20">Syntax</a></h3>
<pre><code>int[] OClass().getClusterIds()
</code></pre>
<h4 id="return-value-11"><a class="header" href="#return-value-11">Return Value</a></h4>
<p>This method returns an <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Array.html"><code>Array</code></a> of <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Integer.html"><code>int</code></a> values.  Each integer provides the ID for a cluster registered to this <a href="java/ref/OClass/../OClass.html"><code>OClass</code></a> instance.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oclass---getdefaultclusterid"><a class="header" href="#oclass---getdefaultclusterid">OClass - getDefaultClusterId()</a></h1>
<p>This method retrieves the default Cluster ID for the class.</p>
<h2 id="retrieving-the-default-cluster-id"><a class="header" href="#retrieving-the-default-cluster-id">Retrieving the Default Cluster ID</a></h2>
<p>When OrientDB stores records it assigns each a Record ID, (for instance #5:24).  The first element of a Record ID provides the Cluster ID, the second the position of the record in the cluster.  Every class has a default cluster, which it uses to store records whenever the target cluster is left unspecified.  Using this method, you can retrieve the Cluster ID for the default cluster.</p>
<h3 id="syntax-21"><a class="header" href="#syntax-21">Syntax</a></h3>
<pre><code>int OClass().getDefaultClusterId()
</code></pre>
<h4 id="return-value-12"><a class="header" href="#return-value-12">Return Value</a></h4>
<p>This method returns an <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Integer.html"><code>int</code></a> instance.  It provides the identification number of the default cluster for the class.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oclass---getindexedproperties"><a class="header" href="#oclass---getindexedproperties">OClass - getIndexedProperties()</a></h1>
<p>This method returns the properties on the class that have indexes.</p>
<h2 id="retrieving-indexed-properties"><a class="header" href="#retrieving-indexed-properties">Retrieving Indexed Properties</a></h2>
<p>When you create an index in OrientDB, the index is applied to properties on the class.  Using this method, you can retrieve a collection of all properties that have indexes.  You might find this useful when optimizing queries or as an automated troubleshooting tool, that checks which properties have indexes in determining which need indexes.</p>
<h3 id="syntax-22"><a class="header" href="#syntax-22">Syntax</a></h3>
<pre><code>Collection&lt;OProperty&gt; OClass().getIndexedProperties()
</code></pre>
<h4 id="return-value-13"><a class="header" href="#return-value-13">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Collection.html"><code>Collection</code></a> instance that contains instances of <a href="java/ref/OClass/../OProperty.html"><code>OProperty</code></a> that correspond to properties that have indexes.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oclass---getname"><a class="header" href="#oclass---getname">OClass - getName()</a></h1>
<p>This method returns the logical name of the class.</p>
<h2 id="retrieving-class-names"><a class="header" href="#retrieving-class-names">Retrieving Class Names</a></h2>
<p>Internally, OrientDB manages classes as <a href="java/ref/OClass/../OClass.html"><code>OClass</code></a> instance.  But, each database class has a logical name that gets used in <a href="java/ref/OClass/../../../sql">OrientDB SQL</a> queries.  Using this method, you can retrieve the logical name as string.</p>
<h3 id="syntax-23"><a class="header" href="#syntax-23">Syntax</a></h3>
<pre><code>String OClass().getName()
</code></pre>
<h4 id="return-type-2"><a class="header" href="#return-type-2">Return Type</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/java/lang/String.html"><code>String</code></a> instance, which provides the logical name of the <a href="java/ref/OClass/../OClass.html"><code>OClass</code></a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oclass---getproperty"><a class="header" href="#oclass---getproperty">OClass - getProperty()</a></h1>
<p>This method retrieves the given property instance from the class.</p>
<h2 id="retrieving-properties"><a class="header" href="#retrieving-properties">Retrieving Properties</a></h2>
<p>In cases where you want to operate on properties rather than the values they contain, you can use this method to retrieve <a href="java/ref/OClass/../OProperty.html"><code>OProperty</code></a> instances for the given property on the class.</p>
<h3 id="syntax-24"><a class="header" href="#syntax-24">Syntax</a></h3>
<pre><code>OProperty OClass().getProperty(String name)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>name</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the property you want</td></tr>
</tbody></table>
</div>
<h4 id="return-value-14"><a class="header" href="#return-value-14">Return Value</a></h4>
<p>This method returns an <a href="java/ref/OClass/../OProperty.html"><code>OProperty</code></a> instance for the requested property on the class.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oclass---getsubclasses"><a class="header" href="#oclass---getsubclasses">OClass - getSubclasses()</a></h1>
<p>This method retrieves the immediate subclasses for the class.</p>
<h2 id="retrieving-subclasses-1"><a class="header" href="#retrieving-subclasses-1">Retrieving Subclasses</a></h2>
<p>OrientDB borrows the concept of a class from the Object Oriented programming paradigm.  This borrowing includes polymorphism, the idea that a database class can have subclasses.  Using this method, you can retrieve all subclasses of the given class.</p>
<p>Note, the method only retrieves those classes that use this class as their immediate superclass.  It does not follow the inheritance any deeper to subclasses of these subclasses.  To retrieve all subclasses, including subclasses of the immediate subclasses, use the <a href="java/ref/OClass/getAllSubclasses.html"><code>getAllSubclasses()</code></a> method.</p>
<h3 id="syntax-25"><a class="header" href="#syntax-25">Syntax</a></h3>
<pre><code>Collection&lt;OClass&gt; OClass().getSubclasses()
</code></pre>
<h4 id="return-value-15"><a class="header" href="#return-value-15">Return Value</a></h4>
<p>This method returns a <code>Collection</code> instance that contains <a href="java/ref/OClass/../OClass.html"><code>OClass</code></a> instances for each subclass registered to this class.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oclass---getsuperclassesnames"><a class="header" href="#oclass---getsuperclassesnames">OClass - getSuperClassesNames()</a></h1>
<p>This method retrieves the names of all classes registered as superclasses of this class.</p>
<h2 id="retrieving-super-classes-1"><a class="header" href="#retrieving-super-classes-1">Retrieving Super Classes</a></h2>
<p>OrientDB borrows the concept of class from the Object Oriented programming paradigm.  This borrowing includes polymorphism, the idea that a class can have subclasses that inherit features from it.In cases where the given <a href="java/ref/OClass/../OClass.html"><code>OClass</code></a> instance is itself a subclass, you can use this method to retrieve a list of all classes that are superclasses to this class.</p>
<h3 id="syntax-26"><a class="header" href="#syntax-26">Syntax</a></h3>
<pre><code>List&lt;String&gt; OClass().getSuperClassesNames()
</code></pre>
<h4 id="return-value-16"><a class="header" href="#return-value-16">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/List.html"><code>List</code></a> instance that contains instances of the <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a> class, providing names of all classes registered as superclasses of this class.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oclass---hasclusterid"><a class="header" href="#oclass---hasclusterid">OClass - hasClusterId()</a></h1>
<p>This method determines whether the class uses a cluster, as defined by the Cluster ID.</p>
<h2 id="checking-for-clusters"><a class="header" href="#checking-for-clusters">Checking for Clusters</a></h2>
<p>Where classes are used to organized what data you store, clusters define where and how you store data.  Using this method, you can determine whether the class uses the given cluster, identifying the cluster you want to check for by its Cluster ID, (the first number in a Record ID).</p>
<h3 id="syntax-27"><a class="header" href="#syntax-27">Syntax</a></h3>
<pre><code>boolean OClass().hasClusterId(int clusterId)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>clusterId</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Integer.html"><code>int</code></a></td><td>Defines the cluster you want to check for by its Cluster ID</td></tr>
</tbody></table>
</div>
<h4 id="return-value-17"><a class="header" href="#return-value-17">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>boolean</code></a> instance, where a <code>true</code> value indicates that the class does use the given cluster.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oclass---haspolymorphicclusterid"><a class="header" href="#oclass---haspolymorphicclusterid">OClass - hasPolymorphicClusterId()</a></h1>
<p>This method determines whether the class or any subclass of the class use the given cluster.</p>
<h2 id="checking-for-clusters-1"><a class="header" href="#checking-for-clusters-1">Checking for Clusters</a></h2>
<p>OrientDB borrows the concept of class from the Object Oriented programming paradigm.  This borrowing includes polymorphism, the idea that a class can have subclasses and superclasses.  Those superclasses and subclasses have their own clusters used in storing records.  This method determines whether any class that is a superclass or subclass of this class uses the given cluster, as defined by its Cluster ID (the first number in a Record ID).</p>
<h3 id="syntax-28"><a class="header" href="#syntax-28">Syntax</a></h3>
<pre><code>boolean OClass().hasPolymorphicClusterId(int clusterId)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>clusterId</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Integer.html"><code>int</code></a></td><td>Defines the cluster you want to check for, by its Cluster ID</td></tr>
</tbody></table>
</div>
<h4 id="return-value-18"><a class="header" href="#return-value-18">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>Boolean</code></a> instance, where a <code>true</code> value indicates that polymorphic classes of this class do use the given cluster.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oclass---hassuperclasses"><a class="header" href="#oclass---hassuperclasses">OClass - hasSuperClasses()</a></h1>
<p>This method determines whether the class is a subclass of another class.</p>
<h2 id="checking-for-superclasses"><a class="header" href="#checking-for-superclasses">Checking for Superclasses</a></h2>
<p>OrientDB borrows the concept of class from the Objected Oriented programming paradigm.  This borrowing includes polymorphism, or the idea that a class can be a subclass of and inherit from another class.  Using this method, you can determine whether your <a href="java/ref/OClass/../OClass.html"><code>OClass</code></a> instance inherits from any superclasses.</p>
<h3 id="syntax-29"><a class="header" href="#syntax-29">Syntax</a></h3>
<pre><code>boolean OClass().hasSuperClasses()
</code></pre>
<h4 id="return-value-19"><a class="header" href="#return-value-19">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>Boolean</code></a> instance, where a <code>true</code> value indicates that it is a subclass.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oclass---isedgetype"><a class="header" href="#oclass---isedgetype">OClass - isEdgeType()</a></h1>
<p>This method determines whether the class is an edge.</p>
<h2 id="checking-edges"><a class="header" href="#checking-edges">Checking Edges</a></h2>
<p>In a Graph database, certain records serve as vertices while others serve as edges connecting the vertices to each other.  Both of these each have their own database classes.  When a record serves as an edge it belongs either to the <code>E</code> database class or to a class that extends the <code>E</code> class.</p>
<p>Using this method, you can determine whether the given class functions as an edge on the database.  To determine whether the class is a vertex, see <a href="java/ref/OClass/isVertexType.html"><code>isVertexType()</code></a>.</p>
<h3 id="syntax-30"><a class="header" href="#syntax-30">Syntax</a></h3>
<pre><code>boolean OClass().isEdgeType()
</code></pre>
<h4 id="return-value-20"><a class="header" href="#return-value-20">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>Boolean</code></a> instance, where <code>true</code> indicates that the class is an edge.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oclass---isvertextype"><a class="header" href="#oclass---isvertextype">OClass - isVertexType()</a></h1>
<p>This method determines whether the class is a vertex.</p>
<h2 id="checking-edges-1"><a class="header" href="#checking-edges-1">Checking Edges</a></h2>
<p>In a Graph database, certain records serve as vertices while others serve as edges connecting the vertices to each other.  Both of these each have their own database classes.  When a record serves as a vertex it belongs either to the <code>V</code> database class or to a class that extends the <code>V</code> class.</p>
<p>Using this method, you can determine whether the given class functions as a vertex on the database.  To determine whether the class functions as an edge, see <a href="java/ref/OClass/isEdgeType.html"><code>isEdgeType()</code></a>.</p>
<h3 id="syntax-31"><a class="header" href="#syntax-31">Syntax</a></h3>
<pre><code>boolean OClass().isVertexType()
</code></pre>
<h4 id="return-value-21"><a class="header" href="#return-value-21">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>Boolean</code></a> instance, where <code>true</code> indicates that the class is a vertex.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oclass---properties"><a class="header" href="#oclass---properties">OClass - properties()</a></h1>
<p>This method retrieves the properties on the class.</p>
<h2 id="retrieving-properties-1"><a class="header" href="#retrieving-properties-1">Retrieving Properties</a></h2>
<p>Where the class allows you to organize groups of records by their particular purpose or usage, OrientDB uses properties to organize the data you store on records.  Using this method, you can retrieve the properties on a class, for situations where you need to operate on them collectively.</p>
<h3 id="syntax-32"><a class="header" href="#syntax-32">Syntax</a></h3>
<pre><code>Collection&lt;OProperty&gt; OClass().properties()
</code></pre>
<h4 id="return-value-22"><a class="header" href="#return-value-22">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Collection.html"><code>Collection</code></a> that contains <a href="java/ref/OClass/../OProperty.html"><code>OProperty</code></a> instances for each property configured on the class.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oclass---propertiesmap"><a class="header" href="#oclass---propertiesmap">OClass - propertiesMap()</a></h1>
<p>This method retrieves the properties on the class.</p>
<h2 id="retrieving-properties-2"><a class="header" href="#retrieving-properties-2">Retrieving Properties</a></h2>
<p>Where the class allows you to organize groups of records by their particular purpose or usage, OrientDB uses properties to organize the data you store on records.  Using this method, you can retrieve the properties on a class, for situations where you need to operate on them collectively.</p>
<h3 id="syntax-33"><a class="header" href="#syntax-33">Syntax</a></h3>
<pre><code>Map&lt;String, OProperty&gt; OClass().properties()
</code></pre>
<h4 id="return-value-23"><a class="header" href="#return-value-23">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Map.html"><code>Map</code></a> that contains a series of key/value entries, where the key is a <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a> providing the property name and the value is the <a href="java/ref/OClass/../OProperty.html"><code>OProperty</code></a> instance for each property on the class.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oclass---removeclusterid"><a class="header" href="#oclass---removeclusterid">OClass - removeClusterId()</a></h1>
<p>This method removes a Cluster ID from the class.</p>
<h2 id="removing-cluster-ids"><a class="header" href="#removing-cluster-ids">Removing Cluster ID's</a></h2>
<h3 id="syntax-34"><a class="header" href="#syntax-34">Syntax</a></h3>
<pre><code>OClass OClass().removeClusterId(int clusterId)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>clusterId</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Integer.html"><code>int</code></a></td><td>Defines the Cluster ID you want to remove</td></tr>
</tbody></table>
</div>
<h4 id="return-value-24"><a class="header" href="#return-value-24">Return Value</a></h4>
<p>This method returns an updated <a href="java/ref/OClass/../OClass.html"><code>OClass</code></a> instance.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oclass---removesuperclass"><a class="header" href="#oclass---removesuperclass">OClass - removeSuperClass()</a></h1>
<p>This method removes a superclass from a class.</p>
<h2 id="removing-superclasses"><a class="header" href="#removing-superclasses">Removing Superclasses</a></h2>
<p>OrientDB borrows the concept of a class from the Object Oriented programming paradigm.  This borrowing includes the idea that database classes can inherit from their superclasses.</p>
<h3 id="syntax-35"><a class="header" href="#syntax-35">Syntax</a></h3>
<pre><code>OClass OClass().removeSuperClass(OClass class)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>class</code></strong></td><td><a href="java/ref/OClass/../OClass.html"><code>OClass</code></a></td><td>Defines the superclass that you want to remove</td></tr>
</tbody></table>
</div>
<h4 id="return-value-25"><a class="header" href="#return-value-25">Return Value</a></h4>
<p>This method returns the updated <a href="java/ref/OClass/../OClass.html"><code>OClass</code></a> instance.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oclass---setdefaultclusterid"><a class="header" href="#oclass---setdefaultclusterid">OClass - setDefaultClusterId()</a></h1>
<p>This method configures the default cluster for the class.</p>
<h2 id="setting-the-default-cluster-id"><a class="header" href="#setting-the-default-cluster-id">Setting the Default Cluster ID</a></h2>
<p>When OrientDB stores records it assigns each a Record ID, (for instance #5:24).  The first element of a Record ID provides the Cluster ID, the second the position of the record in the cluster.  Every class has a default cluster, which it uses to store records whenever the target cluster is left unspecified.  This method allows you to configure which cluster you want to use as the default for the class.</p>
<h3 id="syntax-36"><a class="header" href="#syntax-36">Syntax</a></h3>
<pre><code>void OClass().setDefaultClusterId(int clusterId)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>clusterId</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Integer.html"><code>int</code></a></td><td>Defines the Cluster ID to set</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="oclass---setname"><a class="header" href="#oclass---setname">OClass - setName()</a></h1>
<p>This method sets the name for the class.</p>
<h2 id="setting-the-class-name"><a class="header" href="#setting-the-class-name">Setting the Class Name</a></h2>
<p>Database classes in OrientDB have names, allowing you to reference them and request the <a href="java/ref/OClass/../OClass.html"><code>OClass</code></a> instance using a simple string.  This method allows you to define the string OrientDB uses as its class name.</p>
<h3 id="syntax-37"><a class="header" href="#syntax-37">Syntax</a></h3>
<pre><code>OClass OClass().setName(String name)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>name</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the new class name</td></tr>
</tbody></table>
</div>
<h4 id="return-value-26"><a class="header" href="#return-value-26">Return Value</a></h4>
<p>This method returns the updated <a href="java/ref/OClass/../OClass.html"><code>OClass</code></a> instance.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oclass---truncate"><a class="header" href="#oclass---truncate">OClass - truncate()</a></h1>
<p>This method removes all data from all clusters the class uses.</p>
<h2 id="truncating-class"><a class="header" href="#truncating-class">Truncating Class</a></h2>
<p>Classes have one or more clusters that they use to store records on the database.  When your application has been running for a while, you may encounter issues that require basic or drastic housekeeping on the database.  Using this method you can truncate all clusters associated with the class, removing all data from each cluster.</p>
<h3 id="syntax-38"><a class="header" href="#syntax-38">Syntax</a></h3>
<pre><code>void OClass().truncate()
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oclass---truncatecluster"><a class="header" href="#oclass---truncatecluster">OClass - truncateCluster()</a></h1>
<p>This method removes all data from the given cluster.</p>
<h2 id="truncating-clusters"><a class="header" href="#truncating-clusters">Truncating Clusters</a></h2>
<p>Classes can have several clusters that they use to store records.  When your application has been running for a while, you may encounter issues that require basic or drastic housekeeping on class clusters.  Use this method when you need to remove all data from a cluster, such as when the records are obsolete or no longer necessary.</p>
<p>Note that after you call this method, OrientDB needs to rebuild indexes on the class.</p>
<h3 id="syntax-39"><a class="header" href="#syntax-39">Syntax</a></h3>
<pre><code>OClass OClass().truncateCluster(String name)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>name</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the cluster you want to truncate</td></tr>
</tbody></table>
</div>
<h4 id="return-value-27"><a class="header" href="#return-value-27">Return Value</a></h4>
<p>This method returns an updated <a href="java/ref/OClass/../OClass.html"><code>OClass</code></a> instance.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ocluster"><a class="header" href="#ocluster">OCluster</a></h1>
<p>This class provides an interface for interacting with clusters.</p>
<h2 id="managing-database-clusters"><a class="header" href="#managing-database-clusters">Managing Database Clusters</a></h2>
<p>Clusters in OrientDB are where the server actually stores data, whether on the physical disk or in memory.  They are comparable to the partition in Relational databases.  Using the <code>OCluster</code> interface, you can operate directly on clusters from your application.</p>
<pre><code class="language-java">import com.orientechnologies.orient.core.storage.OCluster;
</code></pre>
<h2 id="methods-2"><a class="header" href="#methods-2">Methods</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Return Type</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="java/ref/OCluster/close.html"><strong><code>close()</code></strong></a></td><td><code>void</code></td><td>Closes the cluster</td></tr>
<tr><td><a href="java/ref/OCluster/delete.html"><strong><code>delete()</code></strong></a></td><td><code>void</code></td><td>Removes the cluster</td></tr>
<tr><td><a href="java/ref/OCluster/deleteRecord.html"><strong><code>deleteRecord()</code></strong></a></td><td><code>boolean</code></td><td>Removes record from cluster</td></tr>
<tr><td><a href="java/ref/OCluster/exists.html"><strong><code>exists()</code></strong></a></td><td><code>boolean</code></td><td>Indicates whether the cluster exists</td></tr>
<tr><td><a href="java/ref/OCluster/getFileName.html"><strong><code>getFileName()</code></strong></a></td><td><code>String</code></td><td>Retrieves filename for the cluster</td></tr>
<tr><td><a href="java/ref/OCluster/getFirstPosition.html"><strong><code>getFirstPosition()</code></strong></a></td><td><code>long</code></td><td>Retrieves the position of the first record in the cluster</td></tr>
<tr><td><a href="java/ref/OCluster/getId.html"><strong><code>getId()</code></strong></a></td><td><code>int</code></td><td>Retrieves the Cluster ID</td></tr>
<tr><td><a href="java/ref/OCluster/getLastPosition.html"><strong><code>getLastPosition()</code></strong></a></td><td><code>long</code></td><td>Retrieves the position of the last record in the cluster</td></tr>
<tr><td><a href="java/ref/OCluster/getName.html"><strong><code>getName()</code></strong></a></td><td><code>String</code></td><td>Retrieves the logical name of the cluster</td></tr>
<tr><td><a href="java/ref/OCluster/getNextPosition.html"><strong><code>getNextPosition()</code></strong></a></td><td><code>long</code></td><td>Retrieves the position of the next record in the cluster</td></tr>
<tr><td><a href="java/ref/OCluster/getRecordsSize.html"><strong><code>getRecordSize()</code></strong></a></td><td><code>long</code></td><td>Retrieves the size of the records in bytes contained in this cluster</td></tr>
<tr><td><a href="java/ref/OCluster/getTombstonesCount.html"><strong><code>getTombstonesCount()</code></strong></a></td><td><code>long</code></td><td>Retrieves the number of hidden records in the cluster</td></tr>
<tr><td><a href="java/ref/OCluster/hideRecord.html"><strong><code>hideRecord()</code></strong></a></td><td><code>boolean</code></td><td>Hides the given record from queries</td></tr>
<tr><td><a href="java/ref/OCluster/open.html"><strong><code>open()</code></strong></a></td><td><code>void</code></td><td>Opens the cluster</td></tr>
<tr><td><a href="java/ref/OCluster/truncate.html"><strong><code>truncate()</code></strong></a></td><td><code>void</code></td><td>Truncates the cluster</td></tr>
<tr><td><a href="java/ref/OCluster/updateRecord.html"><strong><code>updateRecord()</code></strong></a></td><td><code>void</code></td><td>Updates the given record</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="ocluster---close"><a class="header" href="#ocluster---close">OCluster - close()</a></h1>
<p>Closes the cluster.</p>
<h2 id="closing-clusters"><a class="header" href="#closing-clusters">Closing Clusters</a></h2>
<p>Using this method you can close the <a href="java/ref/OCluster/../OCluster.html"><code>OCluster</code></a> instance.  To open the cluster, use the <a href="java/ref/OCluster/open.html"><code>open()</code></a> method.</p>
<h3 id="syntax-40"><a class="header" href="#syntax-40">Syntax</a></h3>
<pre><code>void OCluster().close()
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ocluster---delete"><a class="header" href="#ocluster---delete">OCluster - delete()</a></h1>
<p>Removes the cluster.</p>
<h2 id="removing-clusters"><a class="header" href="#removing-clusters">Removing Clusters</a></h2>
<p>Using this method you can remove the cluster from OrientDB with all its records.</p>
<h3 id="syntax-41"><a class="header" href="#syntax-41">Syntax</a></h3>
<pre><code>void OCluster().delete()
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ocluster---deleterecord"><a class="header" href="#ocluster---deleterecord">OCluster - deleteRecord()</a></h1>
<p>Removes the given Record ID from the cluster.</p>
<h2 id="removing-records"><a class="header" href="#removing-records">Removing Records</a></h2>
<p>In OrientDB, the Record ID is composed of two numeric values: the Cluster ID and the record's position in the cluster.  Using this method, you can remove records from the cluster by position.</p>
<h3 id="syntax-42"><a class="header" href="#syntax-42">Syntax</a></h3>
<pre><code>boolean OCluster().deleteRecord(long position)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>position</code></strong></td><td><code>long</code></td><td>Position of record to delete</td></tr>
</tbody></table>
</div>
<h4 id="return-value-28"><a class="header" href="#return-value-28">Return Value</a></h4>
<p>This method returns a <code>boolean</code> instance.  A value of <code>true</code> indicates that the record was successfully deleted.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ocluster---exists"><a class="header" href="#ocluster---exists">OCluster - exists()</a></h1>
<p>Indicates whether the cluster exists.</p>
<h2 id="checking-cluster-existence"><a class="header" href="#checking-cluster-existence">Checking Cluster Existence</a></h2>
<p>Using this method you can check whether a given <a href="java/ref/OCluster/../OCluster.html"><code>OCluster</code></a> instance exists on the database.</p>
<h3 id="syntax-43"><a class="header" href="#syntax-43">Syntax</a></h3>
<pre><code>boolean OCluster().exists()
</code></pre>
<h4 id="return-value-29"><a class="header" href="#return-value-29">Return Value</a></h4>
<p>This method returns a <code>boolean</code> instance.  A value of <code>true</code> indicates that the cluster exists.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ocluster---getfilename"><a class="header" href="#ocluster---getfilename">OCluster - getFileName()</a></h1>
<p>Retrieves the cluster filename.</p>
<h2 id="getting-filenames"><a class="header" href="#getting-filenames">Getting Filenames</a></h2>
<p>OrientDB stores physical clusters in a file on your system.  Using this method you can retrieve the filename for the cluster.</p>
<h3 id="syntax-44"><a class="header" href="#syntax-44">Syntax</a></h3>
<pre><code>String OCluster().getFileName()
</code></pre>
<h4 id="return-value-30"><a class="header" href="#return-value-30">Return Value</a></h4>
<p>This method returns a <code>String</code> instance.  The value is the filename of the cluster.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ocluster---getfirstposition"><a class="header" href="#ocluster---getfirstposition">OCluster - getFirstPosition()</a></h1>
<p>Retrieves the first Record ID position in the cluster.</p>
<h2 id="getting-record-positions"><a class="header" href="#getting-record-positions">Getting Record Positions</a></h2>
<p>When you query OrientDB, the records in the result-set each have a Record ID, which is composed of two numbers.  The first number is the Cluster ID, the second is the record's position in the cluster.  Using this method you can retrieve the first record position in this cluster.</p>
<h3 id="syntax-45"><a class="header" href="#syntax-45">Syntax</a></h3>
<pre><code>long OCluster().getFirstPosition()
</code></pre>
<h4 id="return-value-31"><a class="header" href="#return-value-31">Return Value</a></h4>
<p>This method returns a <code>long</code> value that represents the first record position in the cluster.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ocluster---getid"><a class="header" href="#ocluster---getid">OCluster - getId()</a></h1>
<p>Retrieves the Cluster ID.</p>
<h2 id="getting-cluster-ids"><a class="header" href="#getting-cluster-ids">Getting Cluster ID's</a></h2>
<p>When you retrieve a record from OrientDB, it displays a Record ID that is composed of two numbers.  The first number is the Cluster ID, a numeric value that identifies the Cluster within the database.  Using this method, you can retrieve the Cluster ID to use in your application.</p>
<h3 id="syntax-46"><a class="header" href="#syntax-46">Syntax</a></h3>
<pre><code>int OCluster().getId()
</code></pre>
<h4 id="return-value-32"><a class="header" href="#return-value-32">Return Value</a></h4>
<p>This method returns an <code>int</code> instance.  The value represents the Cluster ID.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ocluster---getlastposition"><a class="header" href="#ocluster---getlastposition">OCluster - getLastPosition()</a></h1>
<p>Retrieves the last Record ID position in the cluster.</p>
<h2 id="getting-record-positions-1"><a class="header" href="#getting-record-positions-1">Getting Record Positions</a></h2>
<p>When you query OrientDB, the records in the result-set each have a Record ID, which is composed of two numbers.  The first number is the Cluster ID, the second is the record's position in the cluster.  Using this method you can retrieve the last record position in this cluster.</p>
<h3 id="syntax-47"><a class="header" href="#syntax-47">Syntax</a></h3>
<pre><code>long OCluster().getLastPosition()
</code></pre>
<h4 id="return-value-33"><a class="header" href="#return-value-33">Return Value</a></h4>
<p>This method returns a <code>long</code> value that represents the last record position in the cluster.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ocluster---getname"><a class="header" href="#ocluster---getname">OCluster - getName()</a></h1>
<p>Retrieves the logical name of the cluster.</p>
<h2 id="retrieving-the-cluster-name"><a class="header" href="#retrieving-the-cluster-name">Retrieving the Cluster Name</a></h2>
<p>When you create a cluster on a database, OrientDB uses two reference values to identify it later: an integer that represents the Cluster ID and a string that provides its logical name.  Using this method you can retrieve the logical name for the cluster.</p>
<h3 id="syntax-48"><a class="header" href="#syntax-48">Syntax</a></h3>
<pre><code>String OCluster().getName()
</code></pre>
<h4 id="return-value-34"><a class="header" href="#return-value-34">Return Value</a></h4>
<p>This method returns a <code>String</code> value that provides the logical name for the cluster.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ocluster---getnextposition"><a class="header" href="#ocluster---getnextposition">OCluster - getNextPosition()</a></h1>
<p>Retrieves the next Record ID position in the cluster.</p>
<h2 id="getting-record-positions-2"><a class="header" href="#getting-record-positions-2">Getting Record Positions</a></h2>
<p>When you query OrientDB, the records in the result-set each have a Record ID, which is composed of two numbers.  The first number is the Cluster ID, the second is the record's position in the cluster.  Using this method you can retrieve the next record position in this cluster.</p>
<h3 id="syntax-49"><a class="header" href="#syntax-49">Syntax</a></h3>
<pre><code>long OCluster().getNextPosition()
</code></pre>
<h4 id="return-value-35"><a class="header" href="#return-value-35">Return Value</a></h4>
<p>This method returns a <code>long</code> value that represents the next record position in the cluster.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ocluster---getrecordssize"><a class="header" href="#ocluster---getrecordssize">OCluster - getRecordsSize()</a></h1>
<p>Retrieves the size of the records contained in the cluster.</p>
<h2 id="getting-record-sizes"><a class="header" href="#getting-record-sizes">Getting Record Sizes</a></h2>
<p>Using this method you can retrieve the size of the records in the cluster in bytes.</p>
<h3 id="syntax-50"><a class="header" href="#syntax-50">Syntax</a></h3>
<pre><code>long OCluster().getRecordSize()
</code></pre>
<h4 id="return-value-36"><a class="header" href="#return-value-36">Return Value</a></h4>
<p>This method returns a <code>long</code> instance.  The value provides the size of the records in the cluster in bytes.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ocluster---gettombstonescount"><a class="header" href="#ocluster---gettombstonescount">OCluster - getTombstonesCount()</a></h1>
<p>Retrieves the number of hidden records in the cluster.</p>
<h2 id="hidden-records"><a class="header" href="#hidden-records">Hidden Records</a></h2>
<p>In OrientDB it's possible to remove a record from queries without deleting the data from the cluster.  This is done by setting a 'tombstone' on the record.  You may find this useful in cases where you would like to implement a trashcan safety features, where deleted records are hidden for a time before they're permanently removed from the database.  Using this method, you can retrieve the number of tombstone records in the cluster.</p>
<h3 id="syntax-51"><a class="header" href="#syntax-51">Syntax</a></h3>
<pre><code>long OCluster().getTombstonesCount()
</code></pre>
<h4 id="return-value-37"><a class="header" href="#return-value-37">Return Value</a></h4>
<p>This method returns a <code>long</code> value, which indicates the number of hidden records in the cluster.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ocluster---hiderecord"><a class="header" href="#ocluster---hiderecord">OCluster - hideRecord()</a></h1>
<p>Removes a record from queries without deleting the record from the database.</p>
<h2 id="hiding-records"><a class="header" href="#hiding-records">Hiding Records</a></h2>
<p>In OrientDB you can remove a record from queries without actually removing the data from the database.  This is done by setting a 'tombstone' on the record, indicating to OrientDB that it should remain hidden.  You may find this useful when implementing a 'trashcan' safety feature, to prevent users from accidentally deleting data from the database.</p>
<h3 id="syntax-52"><a class="header" href="#syntax-52">Syntax</a></h3>
<pre><code>boolean OCluster().hideRecord(long pos)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>pos</code></strong></td><td><code>long</code></td><td>The position of the record in the cluster</td></tr>
</tbody></table>
</div>
<h4 id="return-type-3"><a class="header" href="#return-type-3">Return Type</a></h4>
<p>This method returns a <code>boolean</code> value, indicating whether the record was successfully hidden.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ocluster---open"><a class="header" href="#ocluster---open">OCluster - open()</a></h1>
<p>Opens the cluster.</p>
<h2 id="opening-clusters"><a class="header" href="#opening-clusters">Opening Clusters</a></h2>
<p>In order to access cluster data from your application, you need to open it.  In order to close it and free up resources later, use the <a href="java/ref/OCluster/close.html"><code>close()</code></a> method.</p>
<h3 id="syntax-53"><a class="header" href="#syntax-53">Syntax</a></h3>
<pre><code>void OCluster().open()
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ocluster---truncate"><a class="header" href="#ocluster---truncate">OCluster - truncate()</a></h1>
<p>Deletes cluster content without deleting the cluster.</p>
<h2 id="truncating-clusters-1"><a class="header" href="#truncating-clusters-1">Truncating Clusters</a></h2>
<p>Occasionally, you may find yourself in situations where you need to remove data from the cluster without removing the cluster itself.  Using this method, you can truncate the cluster, just as you would in OrientDB SQL using the <a href="java/ref/OCluster/../../../sql/SQL-Truncate-Cluster.html"><code>TRUNCATE CLUSTER</code></a> statement.</p>
<h3 id="syntax-54"><a class="header" href="#syntax-54">Syntax</a></h3>
<pre><code>void OCluster().truncate()
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ocluster---updaterecord"><a class="header" href="#ocluster---updaterecord">OCluster - updateRecord()</a></h1>
<p>Updates the given record with new data.</p>
<h2 id="updating-records"><a class="header" href="#updating-records">Updating Records</a></h2>
<p>When working with clusters, you can update a record through the <a href="java/ref/OCluster/../OCluster.html"><code>OCluster</code></a> instance using this method.</p>
<h3 id="syntax-55"><a class="header" href="#syntax-55">Syntax</a></h3>
<pre><code>void OCluster().updateRecord(
   long pos,
   byte[] content,
   int version,
   byte type)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>pos</code></strong></td><td><code>long</code></td><td>Position of record in cluster</td></tr>
<tr><td><strong><code>content</code></strong></td><td><code>byte[]</code></td><td>Content to set on the record</td></tr>
<tr><td><strong><code>version</code></strong></td><td><code>int</code></td><td>Version of record to update</td></tr>
<tr><td><strong><code>type</code></strong></td><td><code>byte</code></td><td>Record type</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="java-api---odatabasedocument"><a class="header" href="#java-api---odatabasedocument">Java API - ODatabaseDocument</a></h1>
<p>This class provides a unified Multi-Model interface for managing and administering OrientDB Document and Graph databases.</p>
<h2 id="managing-databases"><a class="header" href="#managing-databases">Managing Databases</a></h2>
<p>In previous versions of OrientDB, separate classes were used for Document and Graph databases.  This is because OrientDB began as a Document database and added support for Graph databases later, based on the Apache TinkerPop 2.x standard.  Beginning in version 3.0.x using this class, OrientDB provides a common interface for both database types.  It can be found at <code>com.orientechnologies.orient.core.db.document</code> .  For instance,</p>
<pre><code class="language-java">import com.orientechnologies.orient.core.db.document.ODatabaseDocument;
</code></pre>
<p>Once you've imported the class to your application, you can use one of the constructors to build a particular instance in your code.</p>
<h3 id="example-56"><a class="header" href="#example-56">Example</a></h3>
<p>In order to operate on an instance of this class, you need to create it on the OrientDB Server, then open it through an <a href="java/ref/OrientDB.html"><code>OrientDB()</code></a> or <a href="java/ref/OServer.html"><code>OServer</code></a> instance.  For example, in your own application you might want to streamline the startup process, so that it creates a working database in the event that one isn't ready, then opens it.</p>
<pre><code class="language-java">// INITIALIZE VARIABLES
private OrientDB orientdb;

// OPEN/CREATE DATABASE
public static ODatabaseDocument openDatabase(String name) {

   // Initialize Server Connection
   orientdb = new OrientDB("embedded:/tmp/", OrientDBConfig.defaultConfig());

   // Check if Database Exists
   if (!orientdb.exists(name)){
      orientdb.create(name, ODatabaseType.PLOCAL);
   }

   return orientdb.open(name, "admin", "admin");

}
</code></pre>
<p>Here, the method uses the <a href="java/ref/OrientDB/exists.html"><code>exists</code></a> method to determine of the database exists, runs the <a href="java/ref/OrientDB/create.html"><code>create()</code></a> if it doesn't, then uses <a href="java/ref/OrientDB/open.html"><code>open()</code></a> with default credentials to open the <code>ODatabaseDocument</code> instance in your application.</p>
<h2 id="methods-3"><a class="header" href="#methods-3">Methods</a></h2>
<!--
### Managing Databases
- checkSecurity
- freeze
- isPooled
- isValidationEnabled
- isRetainRecords
- release
- setRetainRecords
- setValidationEnabled
-->
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Return Type</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="java/ref/ODatabaseDocument/close.html"><strong><code>close()</code></strong></a></td><td><code>void</code></td><td>Closes the database</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/command.html"><strong><code>command()</code></strong></a></td><td><a href="java/ref/OResultSet.html"><code>OResultSet</code></a></td><td>Executes idempotent or non-idempotent query</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/execute.html"><strong><code>execute()</code></strong></a></td><td><a href="java/ref/OResultSet.html"><code>OResultSet</code></a></td><td>Executes a query</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/getMetadata.html"><strong><code>getMetadata()</code></strong></a></td><td><a href="java/ref/OMetadata.html"><code>OMetadata</code></a></td><td>Retrieves the database metadata</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/getName.html"><strong><code>getName()</code></strong></a></td><td><code>String</code></td><td>Retrieves the logical name of the database</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/getURL.html"><strong><code>getURL()</code></strong></a></td><td><code>String</code></td><td>Retrieves the database URL</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/getUser.html"><strong><code>getUser()</code></strong></a></td><td><a href="java/ref/OSecurityUser.html"><code>OSecurityUser</code></a></td><td>Retrieves the current user</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/incrementalBackup.html"><strong><code>incrementalBackup()</code></strong></a></td><td><code>String</code></td><td>Performs an incremental backup of the database to the given path</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/isActiveOnCurrentThread.html"><strong><code>isActiveOnCurrentThread()</code></strong></a></td><td><code>boolean</code></td><td>Checks whether the current database is active on the current thread</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/isClosed.html"><strong><code>isClosed()</code></strong></a></td><td><code>boolean</code></td><td>Checks whether the database is closed</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/live.html"><strong><code>live()</code></strong></a></td><td><a href="java/ref/OLiveQueryMonitor.html"><code>OLiveQueryMonitor</code></a></td><td>Subscribes query as a live query</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/load.html"><strong><code>load()</code></strong></a></td><td><code>&lt;RET extends T&gt; RET</code></td><td>Loads a record by its Record ID</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/query.html"><strong><code>query()</code></strong></a></td><td><a href="java/ref/OResultSet.html"><code>OResultSet</code></a></td><td>Queries the database</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/registerListener.html"><strong><code>registerListener()</code></strong></a></td><td><code>void</code></td><td>Subscribes the given listener to database events</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/save.html"><strong><code>save()</code></strong></a></td><td><code>T</code></td><td>Saves the given entity to the database</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/unregisterListener.html"><strong><code>unregisterListener()</code></strong></a></td><td><code>void</code></td><td>Unsubscribes the given listener from database events</td></tr>
</tbody></table>
</div>
<h3 id="managing-classes-and-clusters"><a class="header" href="#managing-classes-and-clusters">Managing Classes and Clusters</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Return Type</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="java/ref/ODatabaseDocument/addCluster.html"><strong><code>addCluster()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Integer.html"><code>int</code></a></td><td>Adds a cluster to the database.</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/browseClass.html"><strong><code>browseClass</code></strong></a></td><td><code>ORecordIteratorClass&lt;ODocument&gt;</code></td><td>Retrieves all records of the given database class</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/browseCluster.html"><strong><code>browseCluster()</code></strong></a></td><td><code>&lt;REC extends ORecord&gt; ORecordIteratorCluster&lt;REC&gt;</code></td><td>Retrieves all records of the given cluster</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/countClass.html"><strong><code>countClass()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Long.html"><code>long</code></a></td><td>Retrieves the number of records in the given database class</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/countClusterElements.html"><strong><code>countClusterElements()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Long.html"><code>long</code></a></td><td>Counts all entities in the specified cluster.</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/createClass.html"><strong><code>createClass()</code></strong></a></td><td><a href="java/ref/OClass.html"><code>OClass</code></a></td><td>Creates a new database class</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/createClassIfNotExists.html"><strong><code>createClassIfNotExists()</code></strong></a></td><td><a href="java/ref/OClass.html"><code>OClass</code></a></td><td>Creates a new database class, if not exists</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/createEdgeClass.html"><strong><code>createEdgeClass()</code></strong></a></td><td><a href="java/ref/OClass.html"><code>OClass</code></a></td><td>Creates a database class as an extension of the <code>E</code> edge class</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/createVertexClass.html"><strong><code>createVertexClass()</code></strong></a></td><td><a href="java/ref/OClass.html"><code>OClass</code></a></td><td>Creates a database class as an extension of the <code>V</code> vertex class</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/dropCluster.html"><strong><code>dropCluster()</code></strong></a></td><td><code>boolean</code></td><td>Removes cluster from database</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/existsCluster.html"><strong><code>existsCluster()</code></strong></a></td><td><code>boolean</code></td><td>Determines whether a cluster exists on the database</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/getClass.html"><strong><code>getClass()</code></strong></a></td><td><a href="java/ref/OClass.html"><code>OClass</code></a></td><td>Retrieves the given class from the database</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/getClusterIdByName.html"><strong><code>getClusterIdByName()</code></strong></a></td><td><code>int</code></td><td>Retrieves the Cluster ID for the given cluster name</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/getClusterNameById.html"><strong><code>getClusterNameById()</code></strong></a></td><td><code>String</code></td><td>Retrieves the cluster name for the given ID</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/getClusters.html"><strong><code>getClusters()</code></strong></a></td><td><code>int</code></td><td>Returns the number of clusters on the database</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/getDefaultClusterId.html"><strong><code>getDefaultClusterId()</code></strong></a></td><td><code>int</code></td><td>Returns the default Cluster ID</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/truncateCluster.html"><strong><code>truncateCluster()</code></strong></a></td><td><code>void</code></td><td>Removes all data from the given cluster</td></tr>
</tbody></table>
</div><!--
- addBlobCluster
-->
<h3 id="managing-records"><a class="header" href="#managing-records">Managing Records</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Return Type</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="java/ref/ODatabaseDocument/delete.html"><strong><code>delete()</code></strong></a></td><td><code>ODatabase&lt;T&gt;</code></td><td>Removes a record from the database</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/getRecord.html"><strong><code>getRecord()</code></strong></a></td><td><code>&lt;RET extends ORecord&gt; RET</code></td><td>Retrieves a record from the database</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/getRecordType.html"><strong><code>getRecordType()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Byte.html"><code>byte</code></a></td><td>Returns the default record type</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/newBlob.html"><strong><code>newBlob()</code></strong></a></td><td><code>OBlob</code></td><td>Creates a new instance of a binary blob containing the given bytes</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/newEdge.html"><strong><code>newEdge()</code></strong></a></td><td><a href="java/ref/OEdge.html"><code>OEdge</code></a></td><td>Creates a new edge between the given vertices</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/newElement.html"><strong><code>newElement()</code></strong></a></td><td><a href="java/ref/OElement.html"><code>OElement</code></a></td><td>Creates a new element (that is, a document, vertex or edge)</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/newInstance.html"><strong><code>newInstance()</code></strong></a></td><td><code>RET</code></td><td>Creates a new document, vertex or edge</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/newVertex.html"><strong><code>newVertex()</code></strong></a></td><td><a href="java/ref/OVertex.html"><code>OVertex</code></a></td><td>Creates a new vertex</td></tr>
</tbody></table>
</div>
<h3 id="managing-transactions"><a class="header" href="#managing-transactions">Managing Transactions</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Return Type</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="java/ref/ODatabaseDocument/begin.html"><strong><code>begin()</code></strong></a></td><td><code>ODatabase&lt;T&gt;</code></td><td>Initiates a transaction</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/commit.html"><strong><code>commit()</code></strong></a></td><td><code>ODatabase&lt;T&gt;</code></td><td>Commits a transaction</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/getTransaction.html"><strong><code>getTransaction()</code></strong></a></td><td><a href="java/ref/OTransaction.html"><code>OTransaction</code></a></td><td>Retrieves the current transaction</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/rollback.html"><strong><code>rollback()</code></strong></a></td><td><code>ODatabase&lt;T&gt;</code></td><td>Reverts changes</td></tr>
</tbody></table>
</div>
<h3 id="managing-intents"><a class="header" href="#managing-intents">Managing Intents</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Return Type</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="java/ref/ODatabaseDocument/declareIntent.html"><strong><code>declareIntent()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>boolean</code></a></td><td>Declares an intent for the database.</td></tr>
<tr><td><a href="java/ref/ODatabaseDocument/getActiveIntent.html"><strong><code>getActiveIntent()</code></strong></a></td><td><a href="java/ref/OIntent.html"><code>OIntent</code></a></td><td>Returns the Intent active for the current session</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---addcluster"><a class="header" href="#odatabasedocument---addcluster">ODatabaseDocument - addCluster()</a></h1>
<p>This method creates a new cluster for the database.</p>
<h2 id="adding-clusters-2"><a class="header" href="#adding-clusters-2">Adding Clusters</a></h2>
<p>When you create a class, OrientDB automatically generates a cluster in which to store the data for that class.  While this may be sufficient for many purposes, there is some benefit in creating additional clusters to better organize the data for the class.  For instance, in a class used to manage accounts, you might separate clusters by region.  Using this method you can create new cluster on the database.</p>
<h3 id="syntax-56"><a class="header" href="#syntax-56">Syntax</a></h3>
<pre><code>int ODatabaseDocument().addCluster(String clusterName, Object... parameters);
</code></pre>
<p>| Argument | Type | Description |
|--|---|
| <strong><code>clusterName</code></strong> | <a href="https://docs.oracle.com/javase/8/docs/java/lang/String.html"><code>String</code></a> | Defines the logical name of the cluster |
| <strong><code>parameters</code></strong> | <a href="https://docs.oracle.com/javase/8/docs/java/lang/Object.html"><code>Object</code></a> | Defines cluster creation options |</p>
<h4 id="return-type-4"><a class="header" href="#return-type-4">Return Type</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/java/lang/Integer.html"><code>int</code></a> instance, which represents the created cluster's Cluster ID.  That is, the numeric identifier that occurs in the first value of a Record ID.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---begin"><a class="header" href="#odatabasedocument---begin">ODatabaseDocument - begin()</a></h1>
<p>This method initiates a transaction on the database.</p>
<h2 id="beginning-transactions"><a class="header" href="#beginning-transactions">Beginning Transactions</a></h2>
<p>OrientDB supports the use of ACID transactions.   This allows you to isolate database operations into units of work that you can commit or rollback later, depending on whether later conditions are met.  Using this method you can initiate a transaction.  To save a transaction or revert the changes,  see <a href="java/ref/ODatabaseDocument/commit.html"><code>commit()</code></a> and <a href="java/ref/ODatabaseDocument/rollback.html"><code>rollback()</code></a> methods.</p>
<h3 id="syntax-57"><a class="header" href="#syntax-57">Syntax</a></h3>
<pre><code>ODatabase&lt;T&gt; ODatabaseDocument.begin()
</code></pre>
<h4 id="return-type-5"><a class="header" href="#return-type-5">Return Type</a></h4>
<p>This method returns the database instance itself, providing a fluent interface.  This is useful when calling multiple methods in a chain.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---browseclass"><a class="header" href="#odatabasedocument---browseclass">ODatabaseDocument - browseClass()</a></h1>
<p>This method returns all records in the given database class.  It also returns subclasses, where available.</p>
<h2 id="browsing-records-by-class"><a class="header" href="#browsing-records-by-class">Browsing Records by Class</a></h2>
<p>Records in OrientDB belong to a <a href="java/ref/ODatabaseDocument/../../../general/Schema.html#class">database class</a>, which internally is an implementation of <a href="java/ref/ODatabaseDocument/../OClass.html"><code>OClass</code></a>.  Using this method, you can retrieve all records that belong to a particular database class.</p>
<h3 id="syntax-58"><a class="header" href="#syntax-58">Syntax</a></h3>
<pre><code>// METHOD 1
ORecordIteratorClass&lt;ODocument&gt; ODatabaseDocument().browseClass(String name)

// METHOD 2
ORecordIteratorClass&lt;ODocument&gt; ODatabaseDocument().browseClass(String name, Boolean polymorphic)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>name</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the database class name</td></tr>
<tr><td><strong><code>polymorphic</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>Boolean</code></a></td><td>Defines whether the database class is polymorphic, (that is, whether it has sub-classes)</td></tr>
</tbody></table>
</div>
<h4 id="return-value-38"><a class="header" href="#return-value-38">Return Value</a></h4>
<p>This method returns an <code>ORecordIteratorClass</code> instance that contains the relevant <code>ODocument</code> instances.  <code>ODocument</code> is an subclass of <a href="java/ref/ODatabaseDocument/../OElement.html"><code>OElement</code></a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---browsecluster"><a class="header" href="#odatabasedocument---browsecluster">ODatabaseDocument - browseCluster()</a></h1>
<p>This method retrieves all records stored on the given cluster.</p>
<h2 id="browsing-records-by-cluster"><a class="header" href="#browsing-records-by-cluster">Browsing Records by Cluster</a></h2>
<p>When you save records to the database, OrientDB stores them in a cluster.  The cluster can be physical or in-memory.  Using this method, you can retrieve records by the cluster they're stored in.</p>
<h3 id="syntax-59"><a class="header" href="#syntax-59">Syntax</a></h3>
<pre><code>// METHOD 1
&lt;REC extends ORecord&gt; ORecordIteratorCluster&lt;REC&gt; ODatabaseDocument().browseCluster(
      String name)

// METHOD 2
&lt;REC extends ORecord&gt; ORecordIteratorCluster&lt;REC&gt; ODatabaseDocument().browseCluster(
      String name,
      long startPosition, 
	  long endPosition)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>name</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the cluster name</td></tr>
<tr><td><strong><code>startPosition</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Long.html"><code>long</code></a></td><td>Defines the starting position for the records you want to retrieve</td></tr>
<tr><td><strong><code>endPosition</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Long.html"><code>long</code></a></td><td>Defines the ending position for the record you want to retrieve</td></tr>
</tbody></table>
</div>
<h4 id="return-value-39"><a class="header" href="#return-value-39">Return Value</a></h4>
<p>This method returns an <code>ORecordIteratorCluster</code> instance, which contains instances of the generic, which can be any class that extends the <code>ORecord</code> class.  The <code>ORecord</code> class itself extends the <a href="java/ref/ODatabaseDocument/../OElement.html"><code>OElement</code></a> class.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---close"><a class="header" href="#odatabasedocument---close">ODatabaseDocument - close()</a></h1>
<p>This method closes the database.</p>
<h2 id="closing-databases"><a class="header" href="#closing-databases">Closing Databases</a></h2>
<p>Using this method, you can close an opened database, freeing up resources for other uses.  In the event that the database is already closed, this method does nothing.  When you close a database, any open transactions are closed, their changed rolled back.</p>
<h3 id="syntax-60"><a class="header" href="#syntax-60">Syntax</a></h3>
<pre><code>void ODatabaseDocument().close()
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---command"><a class="header" href="#odatabasedocument---command">ODatabaseDocument - command()</a></h1>
<p>This method executes a generic command.</p>
<h2 id="executing-commands"><a class="header" href="#executing-commands">Executing Commands</a></h2>
<p>Using this method you can issue a command to the OrientDB database.  The command can either be idempotent or non-idempotent.  The return value is an <a href="java/ref/ODatabaseDocument/../OResultSet.html"><code>OResultSet</code></a> instance.  Note that you need to close the result-set after usage to free up resources.</p>
<h3 id="syntax-61"><a class="header" href="#syntax-61">Syntax</a></h3>
<pre><code>OResultSet ODatabaseDocument().command(String query, Map args)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>query</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/java/lang/String.html"><code>String</code></a></td><td>Defines the query you want to execute.</td></tr>
<tr><td><strong><code>args</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/java/util/Map.html"><code>Map</code></a></td><td>Defines parameters for use in formatting the query.</td></tr>
</tbody></table>
</div>
<h3 id="return-value-40"><a class="header" href="#return-value-40">Return Value</a></h3>
<p>This method returns an <a href="java/ref/ODatabaseDocument/../OResultSet.html"><code>OResultSet</code></a> instance, which contains the result-set of your query.  Note that you need to close it when you're done to free up resources.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---commit"><a class="header" href="#odatabasedocument---commit">ODatabaseDocument - commit()</a></h1>
<p>This method saves changes made in a transaction onto the database.</p>
<h2 id="beginning-transactions-1"><a class="header" href="#beginning-transactions-1">Beginning Transactions</a></h2>
<p>OrientDB supports the use of ACID transactions.   This allows you to isolate database operations into units of work that you can commit or rollback later, depending on whether later conditions are met.  Using this method you can commit a transaction.  To initiate a transaction or revert the changes,  see <a href="java/ref/ODatabaseDocument/begin.html"><code>begin()</code></a> and <a href="java/ref/ODatabaseDocument/rollback.html"><code>rollback()</code></a> methods.</p>
<h3 id="syntax-62"><a class="header" href="#syntax-62">Syntax</a></h3>
<pre><code>ODatabase&lt;T&gt; ODatabaseDocument.commit()
</code></pre>
<h4 id="exceptions"><a class="header" href="#exceptions">Exceptions</a></h4>
<p>In the event of error, such as the transaction encountering a conflict, this method raises an <code>OTransactionException</code> exception.</p>
<h4 id="return-type-6"><a class="header" href="#return-type-6">Return Type</a></h4>
<p>This method returns the database instance itself, providing a fluent interface.  This is useful when calling multiple methods in a chain.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---countclass"><a class="header" href="#odatabasedocument---countclass">ODatabaseDocument - countClass()</a></h1>
<p>This method returns the number of records in a given database class.</p>
<h2 id="counting-records-by-class"><a class="header" href="#counting-records-by-class">Counting Records by Class</a></h2>
<p>OrientDB organizes data by a database class, which is an instance of the <a href="java/ref/ODatabaseDocument/../OClass.html"><code>OClass</code></a> class.  Using this method, you can retrieve a count of the number of records in a given database class.</p>
<h3 id="syntax-63"><a class="header" href="#syntax-63">Syntax</a></h3>
<pre><code>// METHOD 1
long ODatabaseDocument().countClass(String name)

// METHOD 2
long ODatabaseDocument().countClass(String name, Boolean isPolymorphic)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>name</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the database class name</td></tr>
<tr><td><strong><code>isPolymorphic</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>Boolean</code></a></td><td>Defines whether the class has sub-classes</td></tr>
</tbody></table>
</div>
<h4 id="return-value-41"><a class="header" href="#return-value-41">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Long.html"><code>Long</code></a> instance that represents the number of records on the given database class.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---countclusterelements"><a class="header" href="#odatabasedocument---countclusterelements">ODatabaseDocument - countClusterElements()</a></h1>
<p>This method counts all entities in the specified cluster.</p>
<h2 id="counting-cluster-elements"><a class="header" href="#counting-cluster-elements">Counting Cluster Elements</a></h2>
<p>A cluster is the physical or in-memory container in which records are stored.  Whenever you create an <a href="java/ref/ODatabaseDocument/../OClass.html"><code>OClass</code></a> instance, OrientDB simultaneously creates a default <a href="java/ref/ODatabaseDocument/../OCluster.html"><code>OCluster</code></a> in which to store data of that class.  Often a class will have several clusters, allowing you to better organize the data they contain.  Using this method you can determine the number of records stored in each cluster, as identified by its Cluster ID, (that is, the first number in the Record ID) or by an array of Cluster ID's.</p>
<h3 id="syntax-64"><a class="header" href="#syntax-64">Syntax</a></h3>
<pre><code>long ODatabaseDocument().countClusterElements(int clusterId)
long ODatabaseDocument().countClusterElements(int[] clusterIds)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>clusterId</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Integer.html"><code>int</code></a></td><td>Defines the identifier for an individual cluster.</td></tr>
<tr><td><strong><code>clusterIds</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/java/lang/reflect/Array.html"><code>int[]</code></a></td><td>Defines the identifiers for an array of clusters.</td></tr>
</tbody></table>
</div>
<h4 id="return-value-42"><a class="header" href="#return-value-42">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Long.html"><code>long</code></a> instance.  It represents the number of records counted in the cluster or clusters.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---createclass"><a class="header" href="#odatabasedocument---createclass">ODatabaseDocument - createClass()</a></h1>
<p>This method creates a database class on the database.</p>
<h2 id="creating-database-class"><a class="header" href="#creating-database-class">Creating Database Class</a></h2>
<p>OrientDB borrows from the Object Oriented programming paradigm the concept of classes, which in these Reference pages is called a <em>database class</em>, to avoid confusion with classes in Java.  Internally, each database class is an instance of <a href="java/ref/ODatabaseDocument/../OClass.html"><code>OClass</code></a>.  Using this method, you can create new database classes on the database.</p>
<p>This method is implemented through the superclass <code>ODatabase</code>.</p>
<h3 id="syntax-65"><a class="header" href="#syntax-65">Syntax</a></h3>
<pre><code>default OClass ODatabaseDocument().createClass(
      String name,
	  String... superclasses)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>name</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the database class name</td></tr>
<tr><td><strong><code>superclasses</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the superclass to which the new class belongs</td></tr>
</tbody></table>
</div>
<h4 id="return-value-43"><a class="header" href="#return-value-43">Return Value</a></h4>
<p>This method returns an <a href="java/ref/ODatabaseDocument/../OClass.html"><code>OClass</code></a> instance for the new database class.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---createclassifnotexists"><a class="header" href="#odatabasedocument---createclassifnotexists">ODatabaseDocument - createClassIfNotExists()</a></h1>
<p>This method creates a new database class if the given name does not already exist.</p>
<h2 id="creating-database-classes"><a class="header" href="#creating-database-classes">Creating Database Classes</a></h2>
<p>OrientDB borrows from the Object Oriented programming paradigm the concept of classes, which in these Reference pages is called a <em>database class</em>, to avoid confusion with classes in Java.  Internally, each database class is an instance of <a href="java/ref/ODatabaseDocument/../OClass.html"><code>OClass</code></a>.  Using this method, you can create new database classes on the database, when the given name doesn't exist already.</p>
<h3 id="syntax-66"><a class="header" href="#syntax-66">Syntax</a></h3>
<pre><code>default OClass ODatabaseDocument().createClassIfNotExist(
      String name,
	  String... superclasses)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>name</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the database class name</td></tr>
<tr><td><strong><code>superclasses</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the superclass the new class belongs to</td></tr>
</tbody></table>
</div>
<h4 id="return-value-44"><a class="header" href="#return-value-44">Return Value</a></h4>
<p>This method returns an <a href="java/ref/ODatabaseDocument/../OClass.html"><code>OClass</code></a> instance for the database class.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---createedgeclass"><a class="header" href="#odatabasedocument---createedgeclass">ODatabaseDocument - createEdgeClass()</a></h1>
<p>This method creates a database class, which extends the <code>E</code> class on the database.</p>
<h2 id="creating-edge-classes"><a class="header" href="#creating-edge-classes">Creating Edge Classes</a></h2>
<p>OrientDB borrows from the Object Oriented programming paradigm the concept of classes, which in these Reference pages is called a <em>database class</em>, to avoid confusion with classes in Java.  Internally, each database class is an instance of <a href="java/ref/ODatabaseDocument/../OClass.html"><code>OClass</code></a>.  Using this method, you can create new database classes on the database, which extend the <code>E</code> edge class.</p>
<p>To create a vertex class instead, see <a href="java/ref/ODatabaseDocument/createVertexClass.html"><code>createVertexClass()</code></a>.</p>
<h3 id="syntax-67"><a class="header" href="#syntax-67">Syntax</a></h3>
<pre><code>default OClass ODatabaseDocument().createEdgeClass(String name)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>name</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the database class name</td></tr>
</tbody></table>
</div>
<h4 id="return-value-45"><a class="header" href="#return-value-45">Return Value</a></h4>
<p>This method returns an <a href="java/ref/ODatabaseDocument/../OClass.html"><code>OClass</code></a> instance for the new database class.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---createvertexclass"><a class="header" href="#odatabasedocument---createvertexclass">ODatabaseDocument - createVertexClass()</a></h1>
<p>This method creates a new database class, which extends the <code>V</code> class.</p>
<h2 id="creating-vertex-classes"><a class="header" href="#creating-vertex-classes">Creating Vertex Classes</a></h2>
<p>OrientDB borrows from the Object Oriented programming paradigm the concept of classes, which in these Reference pages is called a <em>database class</em>, to avoid confusion with classes in Java.  Internally, each database class is an instance of <a href="java/ref/ODatabaseDocument/../OClass.html"><code>OClass</code></a>.  Using this method, you can create new database classes on the database, which extend the <code>V</code> edge class.</p>
<p>To create a edge class instead, see <a href="java/ref/ODatabaseDocument/createEdgeClass.html"><code>createEdgeClass()</code></a>.</p>
<h3 id="syntax-68"><a class="header" href="#syntax-68">Syntax</a></h3>
<pre><code>default OClass ODatabaseDocument().createVertexClass(String name)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>name</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the database class name</td></tr>
</tbody></table>
</div>
<h4 id="return-value-46"><a class="header" href="#return-value-46">Return Value</a></h4>
<p>This method returns an <a href="java/ref/ODatabaseDocument/../OClass.html"><code>OClass</code></a> instance that represents the new database class.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odtabasedocument---declareintent"><a class="header" href="#odtabasedocument---declareintent">ODtabaseDocument - declareIntent()</a></h1>
<p>Declares an intent for the database.  This defines common use-cases in order to optimize execution.</p>
<h2 id="declaring-intents"><a class="header" href="#declaring-intents">Declaring Intents</a></h2>
<p>OrientDB supports three intents: <code>OIntentMassiveInsert</code>, <code>OIntentMassiveRead</code>, <code>OIntentNoCache</code>.  They are all sub-classes of the <a href="java/ref/ODatabaseDocument/../OIntent.html"><code>OIntent</code></a> class.  Using this method, you can activate an intent for the database.</p>
<h3 id="syntax-69"><a class="header" href="#syntax-69">Syntax</a></h3>
<pre><code>boolean ODatabaseDocument().declareIntent(OIntent intent)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>intent</code></strong></td><td><a href="java/ref/ODatabaseDocument/../OIntent.html"><code>OIntent</code></a></td><td>Defines the intent you want to enable.</td></tr>
</tbody></table>
</div>
<h4 id="return-type-7"><a class="header" href="#return-type-7">Return Type</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>boolean</code></a> instance, indicating whether the intent was successfully enabled.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---delete"><a class="header" href="#odatabasedocument---delete">ODatabaseDocument - delete()</a></h1>
<p>This method removes the given record from the database.</p>
<h2 id="removing-records-1"><a class="header" href="#removing-records-1">Removing Records</a></h2>
<p>Using this method you can remove a record from the database, as defined by its Record ID.</p>
<h3 id="syntax-70"><a class="header" href="#syntax-70">Syntax</a></h3>
<pre><code>ODatabase&lt;T&gt; ODatabaseDocument().delete(ORID rid)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>rid</code></strong></td><td><a href="java/ref/ODatabaseDocument/../ORID.html"><code>ORID</code></a></td><td>Record ID to delete</td></tr>
</tbody></table>
</div>
<h4 id="return-type-8"><a class="header" href="#return-type-8">Return Type</a></h4>
<p>The method returns the database instance itself, providing a fluent interface, (which you may find useful when calling multiple methods in a chain).</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---dropcluster"><a class="header" href="#odatabasedocument---dropcluster">ODatabaseDocument - dropCluster()</a></h1>
<p>Removes cluster from the database.</p>
<h2 id="removing-clusters-1"><a class="header" href="#removing-clusters-1">Removing Clusters</a></h2>
<p>Clusters represent places on disk or in memory where OrientDB actually stores data.  Using this method, you can remove a cluster from the database.  With physical clusters this completely deletes the cluster and all its data.</p>
<h3 id="syntax-71"><a class="header" href="#syntax-71">Syntax</a></h3>
<pre><code>boolean ODatabaseDocument().dropCluster(int clusterId, boolean trunc)

boolean ODatabaseDocument().dropCluster(String name, boolean trunc)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>clusterId</code></strong></td><td><code>Integer</code></td><td>Defines the Cluster ID</td></tr>
<tr><td><strong><code>name</code></strong></td><td><code>String</code></td><td>Defines the cluster name</td></tr>
<tr><td><strong><code>trunc</code></strong></td><td><code>boolean</code></td><td>Defines whether you want to truncate the cluster</td></tr>
</tbody></table>
</div>
<h4 id="return-value-47"><a class="header" href="#return-value-47">Return Value</a></h4>
<p>This method returns a <code>boolean</code> value, which indicates whether the cluster was successfully removed.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---execute"><a class="header" href="#odatabasedocument---execute">ODatabaseDocument - execute()</a></h1>
<p>Runs the given script in the specified query language and returns a result-set.</p>
<h2 id="executing-queries-2"><a class="header" href="#executing-queries-2">Executing Queries</a></h2>
<p>Using this method you can execute queries on the OrientDB database.  You may find it useful when you need to construct an OrientDB SQL statement based on user input or runtime information.  Note that the method returns an <a href="java/ref/ODatabaseDocument/../OResultSet.html"><code>OResultSet</code></a> instance, which you need to close when done.</p>
<h3 id="syntax-72"><a class="header" href="#syntax-72">Syntax</a></h3>
<pre><code>OResultSet ODatabaseDocument().execute(String lang, String script, Object... args)
OResultSet ODatabaseDocument().execute(String lang, String script, Map&lt;String, ?&gt; args)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>lang</code></strong></td><td><code>String</code></td><td>Defines the language you want to use.  For instance, <code>sql</code> for OrientDB SQL</td></tr>
<tr><td><strong><code>script</code></strong></td><td><code>String</code></td><td>Provides the script you want to execute</td></tr>
<tr><td><strong><code>args</code></strong></td><td>`Object</td><td>Map&lt;String, ?&gt;`</td></tr>
</tbody></table>
</div>
<h4 id="return-value-48"><a class="header" href="#return-value-48">Return Value</a></h4>
<p>This method returns an <a href="java/ref/ODatabaseDocument/../OResultSet.html"><code>OResultSet</code></a> instance, containing the result-set of the query.  Note that you need to close the result-set when you're done using it in order to free up resources.</p>
<h3 id="example-57"><a class="header" href="#example-57">Example</a></h3>
<p>Imagine an application that stores account information on OrientDB.  You might create a method to connect to the database and add new client data, rolling the <a href="java/ref/ODatabaseDocument/../../../sql/SQL-Insert.html"><code>INSERT</code></a> statement with the data provided by the parameters.</p>
<pre><code class="language-java">private ODatabaseDocument db;

// Queries
private String addAccountSql = "INSERT INTO Account SET company = '?', contact = '?', email = '?'";
...

// Add New Client to Accounts Task
public void addAccounts(String company, String contact, String email){

     // Log Operation
	 System.out.println(String.format("Adding Client: %s", company));

	 // Execute Query
	 OResultSet results = db.execute("sql", addAccountSql, company, contact, email);

	 // Close Result-set
	 results.close();
}
</code></pre>
<p>You can also use the alternative syntax, where the data parameters are defined by a <code>Map</code> instance.</p>
<pre><code class="language-java">private ODatabaseDocument db;

// Queries
private String addAccountSql = "INSERT INTO Account SET company = ':company', contact = ':contact', email = ':email'";
...

// Add New Client to Accounts Task
public void addAccounts(Map&lt;String, String&gt; params){

     // Log Operation
	 System.out.println(String.format("Adding Client: %s", company));

	 // Execute Query
	 OResultSet results = db.execute("sql", addAccountSql, params);

	 // Close Result-set
	 results.close();
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---getactiveintent"><a class="header" href="#odatabasedocument---getactiveintent">ODatabaseDocument - getActiveIntent()</a></h1>
<p>Returns the active Intent for the current session.</p>
<h2 id="retrieving-intents"><a class="header" href="#retrieving-intents">Retrieving Intents</a></h2>
<p>OrientDB uses Intents to shift its internal configuration, optimizing the database for particular tasks, like huge reads or write operations.  Intents are all subclasses of the <a href="java/ref/ODatabaseDocument/../OIntent.html"><code>OIntent</code></a> class.  Using this method you can retrieve the current Intent, then check it against the operation you plan to perform or change it to another Intent, using the <a href="java/ref/ODatabaseDocument/declareIntent.html"><code>declareIntent</code></a> method.</p>
<h3 id="syntax-73"><a class="header" href="#syntax-73">Syntax</a></h3>
<pre><code>OIntent ODatabaseDocument().getActiveIntent()
</code></pre>
<h4 id="return-value-49"><a class="header" href="#return-value-49">Return Value</a></h4>
<p>This method returns an <a href="java/ref/ODatabaseDocument/../OIntent.html"><code>OIntent</code></a> instance, representing the current active Intent for the database.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---getclass"><a class="header" href="#odatabasedocument---getclass">ODatabaseDocument - getClass()</a></h1>
<p>This method retrieves the given class.</p>
<h2 id="retrieving-classes"><a class="header" href="#retrieving-classes">Retrieving Classes</a></h2>
<p>OrientDB has the concept of classes used to organize data of similar types.  Using this method, you can retrieve a particular <a href="java/ref/ODatabaseDocument/../OClass.html"><code>OClass</code></a> instance for the given class name.</p>
<h3 id="syntax-74"><a class="header" href="#syntax-74">Syntax</a></h3>
<pre><code>OClass ODatabaseDocument().getClass(String name)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>name</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the name of the class</td></tr>
</tbody></table>
</div>
<h4 id="return-value-50"><a class="header" href="#return-value-50">Return Value</a></h4>
<p>This method returns the <a href="java/ref/ODatabaseDocument/../OClass.html"><code>OClass</code></a> instance corresponding to the given name.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---getclusteridbyname"><a class="header" href="#odatabasedocument---getclusteridbyname">ODatabaseDocument - getClusterIdByName()</a></h1>
<p>Retrieves the Cluster ID for the given cluster.</p>
<h2 id="retrieving-cluster-ids-1"><a class="header" href="#retrieving-cluster-ids-1">Retrieving Cluster ID's</a></h2>
<p>OrientDB uses two systems to identify clusters.  The first is the Cluster ID, which is represented by the first set of digits in a Record ID.  The second is the logical cluster name.  Using this method, you can retrieve the Cluster ID for the given cluster name.  If you have the Cluster ID already and want the cluster name, use the <a href="java/ref/ODatabaseDocument/getClusterNameById.html"><code>getClusterNameById()</code></a> method.</p>
<h3 id="syntax-75"><a class="header" href="#syntax-75">Syntax</a></h3>
<pre><code>int ODatabaseDocument().getClusterIdByName(String name)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>name</code></strong></td><td><code>String</code></td><td>Defines the cluster name</td></tr>
</tbody></table>
</div>
<h4 id="return-value-51"><a class="header" href="#return-value-51">Return Value</a></h4>
<p>This method returns an <code>int</code> value, which corresponds to the Cluster ID of the given cluster.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---getclusternamebyid"><a class="header" href="#odatabasedocument---getclusternamebyid">ODatabaseDocument - getClusterNameById()</a></h1>
<p>Retrieves the cluster name for the given ID.</p>
<h2 id="retrieving-cluster-ids-2"><a class="header" href="#retrieving-cluster-ids-2">Retrieving Cluster ID's</a></h2>
<p>OrientDB uses two systems to identify clusters.  The first is the Cluster ID, which is represented by the first set of digits in a Record ID.  The second is the logical cluster name.  Using this method, you can retrieve the name for the given ID.  In the event that you have the cluster name and need the ID, use the <a href="java/ref/ODatabaseDocument/getClusterIdByName.html"><code>getClusterIdByName()</code></a> method.</p>
<h3 id="syntax-76"><a class="header" href="#syntax-76">Syntax</a></h3>
<pre><code>String ODatabaseDocument().getClusterNameById(int id)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>id</code></strong></td><td><code>int</code></td><td>Defines the Cluster ID</td></tr>
</tbody></table>
</div>
<h4 id="return-value-52"><a class="header" href="#return-value-52">Return Value</a></h4>
<p>This method returns a <code>String</code> value that corresponds to the logical name of the cluster.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---getclusters"><a class="header" href="#odatabasedocument---getclusters">ODatabaseDocument - getClusters()</a></h1>
<p>Returns the number of clusters on the database.</p>
<h2 id="counting-clusters"><a class="header" href="#counting-clusters">Counting Clusters</a></h2>
<p>OrientDB uses clusters to designate physical or in-memory spaces in which to store your data.  Using this method you can retrieve a count of the number of clusters on the database.</p>
<h3 id="syntax-77"><a class="header" href="#syntax-77">Syntax</a></h3>
<pre><code>int ODatabaseDocument().getClusters()
</code></pre>
<h4 id="return-value-53"><a class="header" href="#return-value-53">Return Value</a></h4>
<p>This method returns an <code>int</code> value, providing the number of clusters on the database.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---getdefaultclusterid"><a class="header" href="#odatabasedocument---getdefaultclusterid">ODatabaseDocument - getDefaultClusterId()</a></h1>
<p>Retrieves the default Cluster ID for the database.</p>
<h2 id="default-clusters"><a class="header" href="#default-clusters">Default Clusters</a></h2>
<p>While OrientDB does support the use of a schema, it can also be used without a schema or with a partially enforced schema.  In these cases, data that added without a specified class or cluster is stored on the database under the default cluster.  Using this method, you can retrieve the Cluster ID for the default cluster.</p>
<h3 id="syntax-78"><a class="header" href="#syntax-78">Syntax</a></h3>
<pre><code>int ODatabaseDocument().getDefaultClusterId()
</code></pre>
<h4 id="return-value-54"><a class="header" href="#return-value-54">Return Value</a></h4>
<p>This method returns an <code>int</code> value, which corresponds to the default Cluster ID.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---getmetadata"><a class="header" href="#odatabasedocument---getmetadata">ODatabaseDocument - getMetadata()</a></h1>
<p>Retrieves the database metadata.</p>
<h2 id="retrieving-metadata"><a class="header" href="#retrieving-metadata">Retrieving Metadata</a></h2>
<p>OrientDB stores general information, like the function library, schema and security information on an <a href="java/ref/ODatabaseDocument/../OMetadata.html"><code>OMetadata</code></a> instance of the database.  Using this method, you can retrieve the metadata to read it or operate on it.</p>
<h3 id="syntax-79"><a class="header" href="#syntax-79">Syntax</a></h3>
<pre><code>OMetadata ODatabaseDocument().getMetadata()
</code></pre>
<h4 id="return-value-55"><a class="header" href="#return-value-55">Return Value</a></h4>
<p>This method returns the <a href="java/ref/ODatabaseDocument/../OMetadata.html"><code>OMetadata</code></a> instance that corresponds to the current database.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---getname"><a class="header" href="#odatabasedocument---getname">ODatabaseDocument - getName()</a></h1>
<p>Retrieves the logical name of the database.</p>
<h2 id="database-names"><a class="header" href="#database-names">Database Names</a></h2>
<p>Each database you create in OrientDB has a logical name under which it can be accessed later.  This is the name you passed to the <a href="java/ref/ODatabaseDocument/../../../console/Console-Command-Create-Database.html"><code>CREATE DATABASE</code></a> statement when you created the database.  Using this method you can retrieve the logical name from OrientDB.</p>
<h3 id="syntax-80"><a class="header" href="#syntax-80">Syntax</a></h3>
<pre><code>String ODatabaseDocument().getName()
</code></pre>
<h4 id="return-value-56"><a class="header" href="#return-value-56">Return Value</a></h4>
<p>This method returns a <code>String</code> instance, which corresponds to the logical name of the database.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---getrecord"><a class="header" href="#odatabasedocument---getrecord">ODatabaseDocument - getRecord()</a></h1>
<p>This method retrieves a record from the database.</p>
<h2 id="retrieving-records"><a class="header" href="#retrieving-records">Retrieving Records</a></h2>
<p>This method takes an instance of the <code>OIdentifiable</code> interface and returns the corresponding record.</p>
<h3 id="syntax-81"><a class="header" href="#syntax-81">Syntax</a></h3>
<pre><code>&lt;RET extends ORecord&gt; RET ODatabaseDocument().getRecord(
   OIdentifiable id)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>id</code></strong></td><td><code>OIdentifiable</code></td><td>Defines the record you want</td></tr>
</tbody></table>
</div>
<h4 id="return-value-57"><a class="header" href="#return-value-57">Return Value</a></h4>
<p>This method returns a record instance, which extends the <code>ORecord</code> class.  The particular type depends on the record you have stored.  Possible types include,</p>
<ul>
<li><code>ODocument</code></li>
<li><a href="java/ref/ODatabaseDocument/../OEdge.html"><code>OEdge</code></a></li>
<li><a href="java/ref/ODatabaseDocument/../OElement.html"><code>OElement</code></a></li>
<li><code>ORecord</code></li>
<li><a href="java/ref/ODatabaseDocument/../OVertex.html"><code>OVertex</code></a></li>
</ul>
<h3 id="example-58"><a class="header" href="#example-58">Example</a></h3>
<p>In cases where you find you are frequently retrieving records by Record ID, you might find in convenient to write a method that streamlines the process, making it easier to call.  For instance,</p>
<pre><code class="language-java">// INITIALIZE VARIABLES
private ODatabaseDocument db;
...

// FETCH RECORD
public OElement fetchRecord(String rid){

   // Initialize Record ID
   id = ORecordId(rid);

   // Fetch Record
   return db.getRecord(id);
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---getrecordtype"><a class="header" href="#odatabasedocument---getrecordtype">ODatabaseDocument - getRecordType()</a></h1>
<p>This method returns the default record type for the database.</p>
<h2 id="retrieving-record-types"><a class="header" href="#retrieving-record-types">Retrieving Record Types</a></h2>
<p>The <a href="java/ref/ODatabaseDocument/../ODatabaseDocument.html"><code>ODatabaseDocument</code></a> class serves as a generic interface for operating on both Document and Graph databases.  Records are stored using different classes depending on which database-type you chose to use.  This method tells you which class is being used as the default on your database.</p>
<h3 id="syntax-82"><a class="header" href="#syntax-82">Syntax</a></h3>
<pre><code>public byte ODatabaseDocument().getRecordType()
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---gettransaction"><a class="header" href="#odatabasedocument---gettransaction">ODatabaseDocument - getTransaction()</a></h1>
<p>Retrieves the current transaction.</p>
<h2 id="fetching-transactions"><a class="header" href="#fetching-transactions">Fetching Transactions</a></h2>
<p>OrientDB is ACID compliant and supports the use of transactions.  Internally, transactions are tracked using an <a href="java/ref/ODatabaseDocument/../OTransaction.html"><code>OTransaction</code></a> instance.  Using this method, you can retrieve the active <a href="java/ref/ODatabaseDocument/../OTransaction.html"><code>OTransaction</code></a> instance.  In the event that no transaction is currently active on the database, this method returns an <code>OTransactionNoTx</code> instance.</p>
<h3 id="syntax-83"><a class="header" href="#syntax-83">Syntax</a></h3>
<pre><code>OTransaction ODatabaseDocument().getTransaction()
</code></pre>
<h4 id="return-value-58"><a class="header" href="#return-value-58">Return Value</a></h4>
<p>This method returns an <a href="java/ref/ODatabaseDocument/../OTransaction.html"><code>OTransaction</code></a> implementation.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---geturl"><a class="header" href="#odatabasedocument---geturl">ODatabaseDocument - getURL()</a></h1>
<p>Retrieves the database URL.</p>
<h2 id="database-url-1"><a class="header" href="#database-url-1">Database URL</a></h2>
<p>Each database in OrientDB has a URL that corresponds to the path needed to access it.  Database URL's are relative to the OrientDB home directory.  For instance, <code>plocal:../databases/GratefulDeadConcerts</code>.  Using this method you can retrieve the URL of the current database instance.</p>
<h3 id="syntax-84"><a class="header" href="#syntax-84">Syntax</a></h3>
<pre><code>String ODatabaseDocument().getURL()
</code></pre>
<h4 id="return-value-59"><a class="header" href="#return-value-59">Return Value</a></h4>
<p>This method returns a <code>String</code> value, which corresponds to the URL of the current database.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---getuser"><a class="header" href="#odatabasedocument---getuser">ODatabaseDocument - getUser()</a></h1>
<p>Retrieves the current user.</p>
<h2 id="getting-current-user"><a class="header" href="#getting-current-user">Getting Current User</a></h2>
<p>In order to connect to a database on OrientDB you need to provide specific user credentials.  Using this method, you can retrieve the user that's currently logged into the database.  You can then further operate on this instance to modify its privileges.</p>
<h3 id="syntax-85"><a class="header" href="#syntax-85">Syntax</a></h3>
<pre><code>OSecurityUser ODatabaseDocument().getUser()
</code></pre>
<h4 id="return-value-60"><a class="header" href="#return-value-60">Return Value</a></h4>
<p>This method returns an <a href="java/ref/ODatabaseDocument/../OSecurityUser.html"><code>OSecurityUser</code></a> instance that corresponds to the current user.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---incrementalbackup"><a class="header" href="#odatabasedocument---incrementalbackup">ODatabaseDocument - incrementalBackup()</a></h1>
<p>Performs an incremental backup to the given path.</p>
<h2 id="incremental-backups"><a class="header" href="#incremental-backups">Incremental Backups</a></h2>
<p>OrientDB can back up your database using full or incremental operations.  A full backup creates a complete copy of the database.  An incremental backup checks the backup in the target path and only writes to file the data that has changed since the last backup took place.  Using this method you can run an incremental backup on the current database instance.</p>
<p>This operation is thread safe and can be done in the normal operational mode.  When done the first time, OrientDB performs a full backup.  Otherwise it only writes the changes.</p>
<h3 id="syntax-86"><a class="header" href="#syntax-86">Syntax</a></h3>
<pre><code>String ODatabaseDocument().incrementalBackup(String path)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>path</code></strong></td><td><code>String</code></td><td>Path to backup</td></tr>
</tbody></table>
</div>
<h4 id="return-value-61"><a class="header" href="#return-value-61">Return Value</a></h4>
<p>This method returns a <code>String</code> instance, which corresponds to the filename of the backup.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---isactiveoncurrentthread"><a class="header" href="#odatabasedocument---isactiveoncurrentthread">ODatabaseDocument - isActiveOnCurrentThread()</a></h1>
<p>Determines whether the current database is active on the current thread.</p>
<h2 id="database-thread"><a class="header" href="#database-thread">Database Thread</a></h2>
<p>Using this method you can determine whether the current database is active on the current thread in your application.</p>
<h3 id="syntax-87"><a class="header" href="#syntax-87">Syntax</a></h3>
<pre><code>boolean ODatabaseDocument().isActiveOnCurrentThread()
</code></pre>
<h4 id="return-value-62"><a class="header" href="#return-value-62">Return Value</a></h4>
<p>This method returns a <code>boolean</code> value indicating whether the current database is active on the current thread.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---isclosed"><a class="header" href="#odatabasedocument---isclosed">ODatabaseDocument - isClosed()</a></h1>
<p>Determines whether the current database is closed or open.</p>
<h2 id="checking-database"><a class="header" href="#checking-database">Checking Database</a></h2>
<p>When you finish with an <a href="java/ref/ODatabaseDocument/../ODatabaseDocument.html"><code>ODatabaseDocument</code></a>  instance, you should close it to free up resources, using the <a href="java/ref/ODatabaseDocument/close.html"><code>close()</code></a> method.  In cases where you are uncertain as to whether the database instance is open or whether it was closed at this particular point in your application, you can check whether it is closed using this method.</p>
<h3 id="syntax-88"><a class="header" href="#syntax-88">Syntax</a></h3>
<pre><code>boolean ODatabaseDocument().isClosed()
</code></pre>
<h4 id="return-value-63"><a class="header" href="#return-value-63">Return Value</a></h4>
<p>This method returns a <code>boolean</code> value, if <code>true</code> it indicates that the database is closed.  Otherwise, it is currently open.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---live"><a class="header" href="#odatabasedocument---live">ODatabaseDocument - live()</a></h1>
<p>Subscribes a query as a live query for use with future create and update events.</p>
<h2 id="using-live-queries"><a class="header" href="#using-live-queries">Using Live Queries</a></h2>
<p>In OrientDB, a <a href="java/ref/ODatabaseDocument/../../Live-Query.html">Live Query</a> is essentially a <a href="java/ref/ODatabaseDocument/../../../sql/SQL-Query.html"><code>SELECT</code></a> statement with push functionality.  The database identifies the records that the query would return, anytime a record is added that fits the query and anytime the records returned by the query are changed, OrientDB pushes the changes through to the listener.  Using this method, you can subscribe a query as a live query then configure how your application receives updates from OrientDB.</p>
<h3 id="syntax-89"><a class="header" href="#syntax-89">Syntax</a></h3>
<pre><code>OLiveQueryMonitor ODatabaseDocument().live(
   String query,
   OLiveQueryResultListener listener
   Map&lt;String, ?&gt; args)
OLiveQueryMonitor ODatabaseDocument().live(
   String query,
   OLiveQueryResultListener listener
   Object... args)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>query</code></strong></td><td><code>String</code></td><td>Query to define the records you want to monitor</td></tr>
<tr><td><strong><code>listener</code></strong></td><td><a href="java/ref/ODatabaseDocument/../OLiveQueryResultListener.html"><code>OLiveQueryResultListener</code></a></td><td>Provides the listener to receive query results</td></tr>
<tr><td><strong><code>args</code></strong></td><td>`Map&lt;String, ?&gt;</td><td>Object...`</td></tr>
</tbody></table>
</div>
<h4 id="return-value-64"><a class="header" href="#return-value-64">Return Value</a></h4>
<p>This method returns an <a href="java/ref/ODatabaseDocument/../OLiveQueryMonitor.html"><code>OLiveQueryMonitor</code></a> instance.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---load"><a class="header" href="#odatabasedocument---load">ODatabaseDocument - load()</a></h1>
<p>Loads a record by its Record ID.</p>
<h2 id="loading-records"><a class="header" href="#loading-records">Loading Records</a></h2>
<p>In situations where you want to access a record on the database and you know its specific Record ID, you may find it more convenient and performant to call the record up directly rather than retrieving it through a query.  Using this method you can fetch the record using an <a href="java/ref/ODatabaseDocument/../ORID.html"><code>ORID</code></a> instance as an identifier.</p>
<p>You can also optionally define a <a href="java/ref/ODatabaseDocument/../../Fetching-Strategies.html">fetch plan</a> to define how OrientDB retrieves the record.</p>
<h3 id="syntax-90"><a class="header" href="#syntax-90">Syntax</a></h3>
<pre><code>&lt;RET extends T&gt; RET ODatabaseDocument().load(ORID recordId)
&lt;RET extends T&gt; RET ODatabaseDocument().load(
   ORID recordId, 
   String fetchPlan)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---query"><a class="header" href="#odatabasedocument---query">ODatabaseDocument - query()</a></h1>
<p>This method executes idempotent OrientDB SQL queries.</p>
<h2 id="querying-the-database"><a class="header" href="#querying-the-database">Querying the Database</a></h2>
<p>OrientDB makes a distinction between idempotent queries that read data from the database and non-idempotent commands that modify the records.  Using this method you can retrieve and operate on result-sets from OrientDB.</p>
<p>In the event that you need to execute a non-idempotent command on the database, see the <a href="java/ref/ODatabaseDocument/command.html"><code>command()</code></a> method.</p>
<h3 id="syntax-91"><a class="header" href="#syntax-91">Syntax</a></h3>
<pre><code>OResultSet ODatabaseDocument().query(String query, Map args)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>query</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/java/lang/String.html"><code>String</code></a></td><td>Defines the query you want to execute.</td></tr>
<tr><td><strong><code>args</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/java/util/Map.html"><code>Map</code></a></td><td>Defines a map of parameters to use in formatting the query.</td></tr>
</tbody></table>
</div>
<h3 id="return-value-65"><a class="header" href="#return-value-65">Return Value</a></h3>
<p>This method returns an <a href="java/ref/ODatabaseDocument/../OResultSet.html"><code>OResultSet</code></a> instance, that contains the result-set of your query.  Remember that you need to close a result-set when you're done with it, in order to free up resources.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---registerlistener"><a class="header" href="#odatabasedocument---registerlistener">ODatabaseDocument - registerListener()</a></h1>
<p>Subscribes the given listener to database events.</p>
<h2 id="using-listeners"><a class="header" href="#using-listeners">Using Listeners</a></h2>
<p>Listeners allow you to monitor the database for particular events.  For instance, if you would like certain methods to execute whenever the database closes, initiates or commits a transaction, and so on.  Using this method, you can register an <a href="java/ref/ODatabaseDocument/../ODatabaseListener.html"><code>ODatabaseListener</code></a> instance with the database.</p>
<h3 id="syntax-92"><a class="header" href="#syntax-92">Syntax</a></h3>
<pre><code>void ODatabaseDocument().registerListener(ODatabaseListener listener)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>listener</code></strong></td><td><a href="java/ref/ODatabaseDocument/../ODatabaseListener.html"><code>ODatabaseListener</code></a></td><td>Listener to register</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---newblob"><a class="header" href="#odatabasedocument---newblob">ODatabaseDocument - newBlob()</a></h1>
<p>This method creates a new binary blob instance containing the given bytes.</p>
<h2 id="creating-blobs"><a class="header" href="#creating-blobs">Creating Blobs</a></h2>
<p>In cases where you want to create binary blobs on the database rather than the standard records, edges or vertices, you can do using this method and an <code>OBlob</code> instance.</p>
<h3 id="syntax-93"><a class="header" href="#syntax-93">Syntax</a></h3>
<p>There are two versions available to this method.  One defines the bytes you want in the blob, the other creates an empty <code>OBlob</code> instance.</p>
<pre><code>// METHOD 1
public OBlob ODatabaseDocument.newBlob(bytes[] blobBytes)

// METHOD 2
public OBlob ODatabaseDocument.newBlob()
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>blobBytes</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Byte.html"><code>bytes[]</code></a></td><td>Defines the bytes to put in the blob</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---newedge"><a class="header" href="#odatabasedocument---newedge">ODatabaseDocument - newEdge()</a></h1>
<p>This method creates a new edge between the given vertices.</p>
<h2 id="creating-edges-2"><a class="header" href="#creating-edges-2">Creating Edges</a></h2>
<p>When using OrientDB as a Graph database, this method allows you to create new edges on the database and connect them to related vertices.  To create new vertices on the database, see the <a href="java/ref/ODatabaseDocument/newVertex.html"><code>newVertex()</code></a> method.</p>
<h3 id="syntax-94"><a class="header" href="#syntax-94">Syntax</a></h3>
<p>There are a few different versions available when using this method:</p>
<pre><code>// METHOD 1
default OEdge ODatabaseDocument().newEdge(OVertex fromV, OVertex toV)

// METHOD 2
OEdge ODatabaseDocument().newEdge(OVertex fromV, OVertex toV, OClass class)

// METHOD 3
OEdge ODatabaseDocument().newEdge(OVertex fromV, OVertex toV, String class-name)
</code></pre>
<p>Edges have their own classes in OrientDB.  When using the first method, the edge is created using the default <code>E</code> class.  The other methods allow you to set the specific edge class that you want to use.</p>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>fromV</code></strong></td><td><a href="java/ref/ODatabaseDocument/../OVertex.html"><code>OVertex</code></a></td><td>Defines the vertex this edge comes from</td></tr>
<tr><td><strong><code>toV</code></strong></td><td><a href="java/ref/ODatabaseDocument/../OVertex.html"><code>OVertex</code></a></td><td>Defines the vertex this edge points to</td></tr>
<tr><td><strong><code>class</code></strong></td><td><a href="java/ref/ODatabaseDocument/../OClass.html"><code>OClass</code></a></td><td>Defines the edge class</td></tr>
<tr><td><strong><code>class-name</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the edge class</td></tr>
</tbody></table>
</div>
<h4 id="return-value-66"><a class="header" href="#return-value-66">Return Value</a></h4>
<p>This method returns an <a href="java/ref/ODatabaseDocument/../OEdge.html"><code>OEdge</code></a> instance of the edge it creates.</p>
<h3 id="example-59"><a class="header" href="#example-59">Example</a></h3>
<p>Imagine an application that makes frequent use a particular edge class.  You might find it convenient to write a method that automatically calls that class by default when creating new edges.For instance, in a class handling social network accounts:</p>
<pre><code class="language-java">// INITIALIZE VARIABLES
private static String edgeClass = "subscription"; 
private ODatabaseDocument db;
...

// SUBSCRIBE TO USER'S BLOG
public void subscribe(OVertex subscriber, OVertex publisher){

   db.newEdge(subscriber, publisher, edgeClass); 

}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---newelement"><a class="header" href="#odatabasedocument---newelement">ODatabaseDocument - newElement()</a></h1>
<p>This method creates a new record on the database.</p>
<h2 id="creating-elements"><a class="header" href="#creating-elements">Creating Elements</a></h2>
<p>When you use OrientDB to host a Document database, the <a href="java/ref/ODatabaseDocument/../OElement.html"><code>OElement</code></a> class represents a document in the database.  With Graph databases, <a href="java/ref/ODatabaseDocument/../OElement.html"><code>OElement</code></a> is the superclass to <a href="java/ref/ODatabaseDocument/../OVertex.html"><code>OVertex</code></a> and <a href="java/ref/ODatabaseDocument/../OEdge.html"><code>OEdge</code></a>.  This method allows you to create a new element within your application.   You can then set data on the element and save it to the database.</p>
<blockquote>
<p><strong>NOTE</strong>: In version 2.2.x and earlier, OrientDB Document databases used the <code>ODocument</code> class to represent documents.  While it still exists as the main implementation of <a href="java/ref/ODatabaseDocument/../OElement.html"><code>OElement</code></a>, it is recommended that you no longer use it directly.  Instead, from now on use the <a href="java/ref/ODatabaseDocument/../OElement.html"><code>OElement</code></a> class for documents.</p>
</blockquote>
<h3 id="syntax-95"><a class="header" href="#syntax-95">Syntax</a></h3>
<p>There are two methods available to you, one creates an empty element and the other creates the new element using a particular OrientDB class.</p>
<pre><code>// METHOD 1
OElement ODatabaseDocument().newElement()

// METHOD 2
OElement ODatabaseDocument().newElement(String class)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>class</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the database class</td></tr>
</tbody></table>
</div>
<h4 id="return-value-67"><a class="header" href="#return-value-67">Return Value</a></h4>
<p>This method returns an <a href="java/ref/ODatabaseDocument/../OElement.html"><code>OElement</code></a> instance.  You can then call additional methods on the element to add and configure the data it contains.  When you are ready to make the changes persistent on OrientDB, call the <a href="java/ref/ODatabaseDocument/../OElement.html#saving-elements"><code>save()</code></a> method on the element.</p>
<h3 id="example-60"><a class="header" href="#example-60">Example</a></h3>
<p>Imagine that you have a web application hosting blogs.  You might want a method in the account management class to add new blog entries to OrientDB.</p>
<pre><code class="language-java">private ODatabaseDocument db;

// ADD NEW BLOG ENTRY
public void createBlogEntry(String title, String author, 
         String text, Boolean publish){

   // Log Operation
   logger.info("Creating New Blog Entry");

   // Initialize Entry
   OElement entry = db.newElement("BlogEntry");

   // Add Data
   entry.setProperty("title", title);
   entry.setProperty("author", author);
   entry.setProperty("text", text);
   entry.setProperty("publish", publish);

   // Update Database
   entry.save();

}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---newinstance"><a class="header" href="#odatabasedocument---newinstance">ODatabaseDocument - newInstance()</a></h1>
<p>This method creates a new record on the database.</p>
<h2 id="creating-elements-1"><a class="header" href="#creating-elements-1">Creating Elements</a></h2>
<p>Whether you are using OrientDB to how a Document or Graph database, this method provides you with a generic way to create new documents, vertices or edges in your application.</p>
<h3 id="syntax-96"><a class="header" href="#syntax-96">Syntax</a></h3>
<pre><code>&lt;RET&gt; RET ODatabaseDocument().newElement(String class)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>RET</code></strong></td><td></td><td>Defines the return value type</td></tr>
<tr><td><strong><code>class</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the database class</td></tr>
</tbody></table>
</div>
<h4 id="return-value-68"><a class="header" href="#return-value-68">Return Value</a></h4>
<p>This method returns an instance of the class given as a generic.  The particular class you choose depends on whether you're using OrientDB as a Graph or Document databases.  The recommended methods are:</p>
<ul>
<li><a href="java/ref/ODatabaseDocument/../OElement.html"><strong><code>OElement</code></strong></a> To represent documents in a Document database</li>
<li><a href="java/ref/ODatabaseDocument/../OVertex.html"><strong><code>OVertex</code></strong></a> To represent vertices in a Graph database</li>
<li><a href="java/ref/ODatabaseDocument/../OEdge.html"><strong><code>OEdge</code></strong></a> TO represent edges in a Graph database</li>
</ul>
<p>You can then take the return value and call additional methods on it to set data.  To make the document, graph or vertex persistent on the database, you must then call the <code>save()</code> method.</p>
<h3 id="example-61"><a class="header" href="#example-61">Example</a></h3>
<p>Imagine that you have a web application hosting blogs.  You might want a method in the account management class to add new blog entries to OrientDB.</p>
<pre><code class="language-java">private ODatabaseDocument db;

// ADD NEW BLOG ENTRY
public void createBlogEntry(String title, String author, 
         String text, Boolean publish){

   // Log Operation
   logger.info("Creating New Blog Entry");

   // Initialize Entry
   OElement entry = db.newInstance("BlogEntry");

   // Add Data
   entry.setProperty("title", title);
   entry.setProperty("author", author);
   entry.setProperty("text", text);
   entry.setProperty("publish", publish);

   // Update Database
   entry.save();

}

</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---newvertex"><a class="header" href="#odatabasedocument---newvertex">ODatabaseDocument - newVertex()</a></h1>
<p>This method creates a new vertex on the database.</p>
<h2 id="creating-vertices-1"><a class="header" href="#creating-vertices-1">Creating Vertices</a></h2>
<p>When using OrientDB to host a Graph database, this method allows you to create vertices on the database.  To create new edges, see the <a href="java/ref/ODatabaseDocument/newEdge.html"><code>newEdge()</code></a> method.</p>
<h3 id="syntax-97"><a class="header" href="#syntax-97">Syntax</a></h3>
<p>This method comes in three forms.  The first creates the vertex in the default OrientDB class <code>V</code>.  The others allow you to manually define what class the new vertex belongs to:</p>
<pre><code>// METHOD 1
default OVertex ODatabaseDocument().newVertex()

// METHOD 2
OVertex ODatabaseDocument().newVertex(OClass class)

// METHOD 3
OVertex ODatabaseDocument().newVertex(String class-name)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>class</code></strong></td><td><a href="java/ref/ODatabaseDocument/../OClass.html"><code>OClass</code></a></td><td>Defines the OrientDB class</td></tr>
<tr><td><strong><code>class-name</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the name of the OrientDBG class</td></tr>
</tbody></table>
</div>
<h4 id="return-value-69"><a class="header" href="#return-value-69">Return Value</a></h4>
<p>This method returns an <a href="java/ref/ODatabaseDocument/../OVertex.html"><code>OVertex</code></a> instance.  You can call additional methods on this instance to set data to it, then call <code>save()</code> to make that data persistent on OrientDB.</p>
<h3 id="example-62"><a class="header" href="#example-62">Example</a></h3>
<p>Imagine you have a social networking application.  The application stores users under the <code>User</code> class on OrientDB and content sources under the <code>Feed</code> class.  Whenever a new user sets up their account, they're automatically subscribed to a series of content sources, which provides news, popular feeds and sponsored results.</p>
<p>To accomplish this, you might use a method to create new user accounts and default subscriptions:</p>
<pre><code class="language-java">// INITIALIZE DEFAULT VARIABLES
private ODatabaseDocument db;
private List&lt;ORID&gt; defaultFeeds;
...

// CREATE NEW USER
public void newUser(String name, String email){

   // Log Operation
   logger.info("Creating New User");

   // Create New User
   OVertex user = db.newVertex("User");
   user.setProperty("name", name);
   user.setProperty("email", email);
   user.save();

   // Set Default Subscriptions
   for (int i = 0; i &lt; defaultFeeds.size(); i++){

      // Fetch Record ID
	  ORID rid = defaultFeeds.get(i);

      // Fetch Feed Vertex
	  OVertex feed = db.getRecord(rid);

	  // Create and Save Edge
	  OEdge edge = db.newEdge(user, feed);
	  edge.save();

   }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---rollback"><a class="header" href="#odatabasedocument---rollback">ODatabaseDocument - rollback()</a></h1>
<p>This method reverts changes in a transaction, rolling the database back to its previous state.</p>
<h2 id="beginning-transactions-2"><a class="header" href="#beginning-transactions-2">Beginning Transactions</a></h2>
<p>OrientDB supports the use of ACID transactions.   This allows you to isolate database operations into units of work that you can commit or rollback later, depending on whether later conditions are met.  Using this method you can revert changes in a transaction.  To initiate a transaction or commit the changes,  see <a href="java/ref/ODatabaseDocument/begin.html"><code>begin()</code></a> and <a href="java/ref/ODatabaseDocument/commit.html"><code>commit()</code></a> methods.</p>
<h3 id="syntax-98"><a class="header" href="#syntax-98">Syntax</a></h3>
<pre><code>ODatabase&lt;T&gt; ODatabaseDocument.rollback()
</code></pre>
<h4 id="exceptions-1"><a class="header" href="#exceptions-1">Exceptions</a></h4>
<p>In the event of error, such as the transaction encountering a conflict, this method raises an <code>OTransactionException</code> exception.</p>
<h4 id="return-type-9"><a class="header" href="#return-type-9">Return Type</a></h4>
<p>This method returns the database instance itself, providing a fluent interface.  This is useful when calling multiple methods in a chain.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---save"><a class="header" href="#odatabasedocument---save">ODatabaseDocument - save()</a></h1>
<p>This method saves the given object to the database.</p>
<h2 id="saving-data"><a class="header" href="#saving-data">Saving Data</a></h2>
<p>Using this method you can save objects in synchronous to the database.  If the given object is not dirty, (that is, changed from the state stored on the database), then OrientDB ignores the operation.  When saving records, you can optionally define the cluster in which you want to save it.  If the cluster doesn't exist, the method throws an error.</p>
<h3 id="syntax-99"><a class="header" href="#syntax-99">Syntax</a></h3>
<pre><code>&lt;RET extends T&gt; RET ODatabaseDocument().save(T obj)
&lt;RET extends T&gt; RET ODatabaseDocument().save(T obj, String cluster)
</code></pre>
<p>| Argument | Type | Description |
| <strong><code>obj</code></strong>  | <code>T</code> | Defines the object you want to save |
| <strong><code>cluster</code></strong> | <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a> | Defines the name of the cluster in which to add a record |</p>
<h4 id="return-value-70"><a class="header" href="#return-value-70">Return Value</a></h4>
<p>This method returns the saved object.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---truncatecluster"><a class="header" href="#odatabasedocument---truncatecluster">ODatabaseDocument - truncateCluster()</a></h1>
<p>Removes all data from the given cluster.</p>
<h2 id="truncating-cluster"><a class="header" href="#truncating-cluster">Truncating Cluster</a></h2>
<p>On occasion you may find yourself in a situation where you need to remove data from a cluster without removing the cluster itself.  This is common in cases where the cluster was loaded with data during testing and now needs to be cleared for use in production.  Using this method you can truncate the cluster, deleting data without deleting the cluster.</p>
<h3 id="syntax-100"><a class="header" href="#syntax-100">Syntax</a></h3>
<pre><code>void ODatabaseDocument().truncateCluster(String name)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>name</code></strong></td><td><code>String</code></td><td>Logical name of the cluster</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasedocument---unregisterlistener"><a class="header" href="#odatabasedocument---unregisterlistener">ODatabaseDocument - unregisterListener()</a></h1>
<p>Unsubscribes the given listener to database events.</p>
<h2 id="using-listeners-1"><a class="header" href="#using-listeners-1">Using Listeners</a></h2>
<p>Listeners allow you to monitor the database for particular events.  For instance, if you would like certain methods to execute whenever the database closes, initiates or commits a transaction, and so on.  Using this method, you can unregister an <a href="java/ref/ODatabaseDocument/../ODatabaseListener.html"><code>ODatabaseListener</code></a> instance with the database.</p>
<h3 id="syntax-101"><a class="header" href="#syntax-101">Syntax</a></h3>
<pre><code>void ODatabaseDocument().unregisterListener(ODatabaseListener listener)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>listener</code></strong></td><td><a href="java/ref/ODatabaseDocument/../ODatabaseListener.html"><code>ODatabaseListener</code></a></td><td>Listener to unregister</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="odatabasesession"><a class="header" href="#odatabasesession">ODatabaseSession</a></h1>
<p>Provides an interface for operating on database sessions.</p>
<h2 id="using-database-sessions"><a class="header" href="#using-database-sessions">Using Database Sessions</a></h2>
<p>In order to utilize the database session in your application, you first need to import it.</p>
<pre><code class="language-java">import com.orientechnologies.orient.core.db.ODatabaseSession;
</code></pre>
<h3 id="methods-4"><a class="header" href="#methods-4">Methods</a></h3>
<p>The <code>ODatabaseSession</code> class is a subclass of the <a href="java/ref/ODatabaseDocument.html"><code>ODatabaseDocument</code></a> class and has the same methods available to it.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="odatabaselistener"><a class="header" href="#odatabaselistener">ODatabaseListener</a></h1>
<p>Listener interface used in monitoring events on a database.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="java-api---oedge"><a class="header" href="#java-api---oedge">Java API - OEdge</a></h1>
<p>This class provides a standard interface for handling edges.</p>
<h2 id="managing-edges"><a class="header" href="#managing-edges">Managing Edges</a></h2>
<p>When using OrientDB as a Graph database, this class represents an edge record.  It extends the <a href="java/ref/OElement.html"><code>OElement</code></a> class.  Methods available to that class are also available to this class.</p>
<p>This class is available at <code>com.orientechnologies.orient.core.record</code>.  To import it, use the following line where necessary:</p>
<pre><code class="language-java">import com.orientechnologies.orient.core.record.OEdge;
</code></pre>
<p>Once you've imported the class to your application, you can use it to build instances in your code.</p>
<blockquote>
<p>For more information on vertices, see <a href="java/ref/OVertex.html"><code>OVertex</code></a></p>
</blockquote>
<h3 id="example-63"><a class="header" href="#example-63">Example</a></h3>
<p>To create a new instance of this class, it is recommended that you use either the <a href="java/ref/ODatabaseDocument/newInstance.html"><code>newInstance()</code></a> or <a href="java/ref/ODatabaseDocument/newEdge.html"><code>newEdge()</code></a> methods on the <a href="java/ref/ODatabaseDocument.html"><code>ODatabaseDocument</code></a> class interface.  This allows you to operate on the given record and to easily save it back to the database when you're ready.</p>
<p>[TBD]</p>
<h2 id="methods-5"><a class="header" href="#methods-5">Methods</a></h2>
<p>Once you've created or initialized an <code>OEdge</code> instance, you can begin to call methods on it to further define and read data from the edge.  This method extends the <a href="java/ref/OElement.html"><code>OElement</code></a> class.  Methods available to that class are also available to this one.</p>
<p>For information on methods specific to this class, see the table below.</p>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Return Type</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="java/ref/OEdge/getFrom.html"><strong><code>getFrom()</code></strong></a></td><td><a href="java/ref/OVertex.html"><code>OVertex</code></a></td><td>Retrieves the from vertex</td></tr>
<tr><td><a href="java/ref/OEdge/getTo.html"><strong><code>getTo()</code></strong></a></td><td><a href="java/ref/OVertex.html"><code>OVertex</code></a></td><td>Retrieves the to vertex</td></tr>
<tr><td><a href="java/ref/OEdge/isLightweight.html"><strong><code>isLightweight()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>Boolean</code></a></td><td>Determines whether the edge is a Lightweight Edge</td></tr>
<tr><td><a href="java/ref/OEdge.html#saving-edges"><strong><code>save()</code></strong></a></td><td><code>&lt;RET extends ORecord&gt; RET</code></td><td>Saves changes to the database</td></tr>
</tbody></table>
</div>
<h3 id="saving-edges"><a class="header" href="#saving-edges">Saving Edges</a></h3>
<p>When you create or retrieve an <code>OEdge</code> instance, you create a snapshot of the record.  Any changes you make to the record remain in your application.  In order to make these changes persistent on the database, you need to call the <code>save()</code> method on the element.  For instance,</p>
<pre><code class="language-java">// GLOBAL VARIABLES
private ODatabaseDocument db;

// CREATE NEW RECORD
public void newEdge(OVertex toPerson, OVertex fromPerson){

   // Initialize Document
   OEdge relationship = db.newEdge("Relationship");
   relationship.setProperty("out", toPerson);
   relationship.setProperty("in", fromPerson);

   // Add Relationship to Database 
   relationship.save();
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oedge---getfrom"><a class="header" href="#oedge---getfrom">OEdge - getFrom()</a></h1>
<p>This method retrieves the vertex that connects from this edge.</p>
<h2 id="retrieving-vertices"><a class="header" href="#retrieving-vertices">Retrieving Vertices</a></h2>
<p>Edges provide links between vertices.  The link connects from one vertex and to another.  This method allows you to retrieve the <a href="java/ref/OEdge/../OVertex.html"><code>OVertex</code></a> instance that links from the edge.  To access the vertex that links to the edge, see the <a href="java/ref/OEdge/getTo.html"><code>getTo()</code></a> method.</p>
<h3 id="syntax-102"><a class="header" href="#syntax-102">Syntax</a></h3>
<pre><code>OVertex OEdge().getFrom()
</code></pre>
<h4 id="return-value-71"><a class="header" href="#return-value-71">Return Value</a></h4>
<p>This method returns the <a href="java/ref/OEdge/../OVertex.html"><code>OVertex</code></a> instance that links from this edge.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oedge---getto"><a class="header" href="#oedge---getto">OEdge - getTo()</a></h1>
<p>This method retrieves the vertex that connects to this edge.</p>
<h2 id="retrieving-vertices-1"><a class="header" href="#retrieving-vertices-1">Retrieving Vertices</a></h2>
<p>Edges provide links between vertices.  The link connects from one vertex to another.  This method allows you to retrieve the <a href="java/ref/OEdge/../OVertex.html"><code>OVertex</code></a> instance that links to the edge.  To access the vertex that links from the edge, see the <a href="java/ref/OEdge/getFrom.html"><code>getFrom()</code></a> method.</p>
<h3 id="syntax-103"><a class="header" href="#syntax-103">Syntax</a></h3>
<pre><code>OVertex OEdge().getTo()
</code></pre>
<h4 id="return-value-72"><a class="header" href="#return-value-72">Return Value</a></h4>
<p>This method returns the <a href="java/ref/OEdge/../OVertex.html"><code>OVertex</code></a> instance that links to the edge.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oedge---islightweight"><a class="header" href="#oedge---islightweight">OEdge - isLightweight()</a></h1>
<p>This method determines whether an edge is a <a href="java/ref/OEdge/../../Lightweight-Edges.html">lightweight edge</a>.</p>
<h2 id="lightweight-edges-1"><a class="header" href="#lightweight-edges-1">Lightweight Edges</a></h2>
<p>When using OrientDB as a Graph database, there are two types of edges available.  The standard edge type is a Regular Edge, which extends the <code>E</code> class in the database and is stored as a separate record.  The newer edge type is the Lightweight Edge, which has no properties or identity on the database, since they exist only within vertex records.  This method allows you to determine whether an <a href="java/ref/OEdge/../OEdge.html"><code>OEdge</code></a> instance is a Lightweight or Regular edge.</p>
<h3 id="syntax-104"><a class="header" href="#syntax-104">Syntax</a></h3>
<pre><code>Boolean OEdge().isLightweight()
</code></pre>
<h4 id="return-value-73"><a class="header" href="#return-value-73">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>Boolean</code></a> instance.  If the return value is <code>true</code>, it indicates that the <a href="java/ref/OEdge/../OEdge.html"><code>OEdge</code></a> instance is a Lightweight Edge.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="java-api---oelement"><a class="header" href="#java-api---oelement">Java API - OElement</a></h1>
<p>This class provides a standard interface for handling documents, vertices and edges.</p>
<h2 id="managing-elements"><a class="header" href="#managing-elements">Managing Elements</a></h2>
<p>When using OrientDB as a Document database, this class represents a document record.  When using OrientDB as a Graph database, this is the superclass to the <a href="java/ref/OVertex.html"><code>OVertex</code></a> and <a href="java/ref/OEdge.html"><code>OEdge</code></a> classes, which represent vertices and edges in the database.</p>
<blockquote>
<p><strong>NOTE</strong>: In older versions of OrientDB, documents were represented using the <code>ODocument</code> class.  While this class is still around and is the primary implementation of <code>OElement</code>, it is recommended that you do not use it directly.  Instead, moving forward use <code>OElement</code> for your documents.</p>
</blockquote>
<p>This class is available at <code>com.orientechnologies.orient.core.record</code>.  To import it, use the following line where necessary:</p>
<pre><code class="language-java">import com.orientechnologies.orient.core.record.OElement;
</code></pre>
<p>Once you've imported the class to your application, you can use it to build particular instances in your code.</p>
<h3 id="example-64"><a class="header" href="#example-64">Example</a></h3>
<p>In order to create a new instance of this class, it is recommended that you use either <a href="java/ref/ODatabaseDocument/newInstance.html"><code>newInstance()</code></a> or <a href="java/ref/ODatabaseDocument/newElement.html"><code>newElement()</code></a> methods on the <a href="java/ref/ODatabaseDocument.html"><code>ODatabaseDocument</code></a> class interface.  This allows you to operate on the given record and easily save it back to the database when you're ready.</p>
<p>For instance, imagine you have a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Map.html"><code>Map</code></a> of variables containing a address book, where the key is the person's name and the value their email address, both as <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>string</code></a> values.  You might use a method like this to transfer that data into OrientDB documents.</p>
<pre><code class="language-java">// INITIALIZE GLOBAL VARIABLES
private ODatabaseDocument db;
...

// ADD ENTRIES TO ADDRESSBOOK DATABASE
public void initAddressBook(Map&lt;String, String&gt; addressBook){

   // Loop Over Map
   for (Map.Entry&lt;String, String&gt; entry : addressBook.entrySet()){

      // Initialize Variables
	  String name = entry.getKey();
	  String email = entry.getKey();

	  // Create Person 
	  OElement person = db.newElement("Person");
	  person.setProperty("name", name);
	  person.setProperty("email", email);
	  
	  // Make Person Persistent
	  person.save();

   }
}
</code></pre>
<h2 id="methods-6"><a class="header" href="#methods-6">Methods</a></h2>
<p>Once you've created or initialized an <code>OElement</code> instance, you can begin to call methods on the instance to further define and read data from the record.</p>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Return Type</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="java/ref/OElement/asEdge.html"><strong><code>asEdge()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html"><code>Optional</code></a><a href="java/ref/OEdge.html"><code>&lt;OEdge&gt;</code></a></td><td>Returns record as an edge</td></tr>
<tr><td><a href="java/ref/OElement/asVertex.html"><strong><code>asVertex()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html"><code>Optional</code></a><a href="java/ref/OVertex.html"><code>&lt;OVertex&gt;</code></a></td><td>Returns record as a vertex</td></tr>
<tr><td><a href="java/ref/OElement/getProperty.html"><strong><code>getProperty()</code></strong></a></td><td><code>&lt;RET&gt; RET</code></td><td>Retrieves record data by property name</td></tr>
<tr><td><a href="java/ref/OElement/getPropertyNames.html"><strong><code>getPropertyNames()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Set.html"><code>Set</code></a><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>&lt;String&gt;</code></a></td><td>Retrieves defined property names</td></tr>
<tr><td><a href="java/ref/OElement/getSchemaType.html"><strong><code>getSchemaType()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html"><code>Optional</code></a><a href="java/ref/OClass.html"><code>&lt;OClass&gt;</code></a></td><td>Retrieves the type of the current element, (that is, class in the schema, if any)</td></tr>
<tr><td><a href="java/ref/OElement/isEdge.html"><strong><code>isEdge()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>Boolean</code></a></td><td>Determines whether record is an edge</td></tr>
<tr><td><a href="java/ref/OElement/isVertex.html"><strong><code>isVertex()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>Boolean</code></a></td><td>Determines whether record is a vertex</td></tr>
<tr><td><a href="java/ref/OElement/removeProperty.html"><strong><code>removeProperty()</code></strong></a></td><td><code>&lt;RET&gt; RET</code></td><td>Removes a property from the record</td></tr>
<tr><td><a href="java/ref/OElement.html#saving-elements"><strong><code>save()</code></strong></a></td><td><code>&lt;RET extends ORecord&gt; RET</code></td><td>Saves changes to OrientDB record</td></tr>
<tr><td><a href="java/ref/OElement/setProperty.html"><strong><code>setProperty()</code></strong></a></td><td><code>void</code></td><td>Sets data on record property</td></tr>
</tbody></table>
</div>
<h3 id="saving-elements"><a class="header" href="#saving-elements">Saving Elements</a></h3>
<p>When you create or retrieve an <code>OElement</code> instance, you create a snapshot of the record.  Any changes you make to the record remain in your application.  In order to make these changes persistent on the database, you need to call the <code>save()</code> method on the element.  For instance,</p>
<pre><code class="language-java">// GLOBAL VARIABLES
private ODatabaseDocument db;

// CREATE NEW RECORD
public void newRecord(String name, String email){

   // Initialize Document
   OElement person = db.newElement("Person");
   person.setProperty("name", name);
   person.setProperty("email", email);

   // Add Person to Database
   person.save();
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oelement---asedge"><a class="header" href="#oelement---asedge">OElement - asEdge()</a></h1>
<p>This method returns the record as an <code>OEdge</code> instance.</p>
<h2 id="creating-edges-3"><a class="header" href="#creating-edges-3">Creating Edges</a></h2>
<p>The <a href="java/ref/OElement/../OElement.html"><code>OElement</code></a> class corresponds to a document record in a Document database.  When you use OrientDB as a Graph database, it serves as the superclass to both vertices and edges.  In the event that you want a record to serve as an edge, use this method to operate on it an <a href="java/ref/OElement/../OEdge.html"><code>OEdge</code></a> instance.</p>
<h3 id="syntax-105"><a class="header" href="#syntax-105">Syntax</a></h3>
<pre><code>Optional&lt;OEdge&gt; OElement().asEdge()
</code></pre>
<h4 id="return-value-74"><a class="header" href="#return-value-74">Return Value</a></h4>
<p>When the record corresponding to this <a href="java/ref/OElement/../OElement.html"><code>OElement</code></a> instance is an edge, this method returns an <a href="java/ref/OElement/../OEdge.html"><code>OEdge</code></a> instance.  In the event that the record is a document or vertex, (that is, not an edge), it returns an empty <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html"><code>Optional</code></a> instance.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oelement---asvertex"><a class="header" href="#oelement---asvertex">OElement - asVertex()</a></h1>
<p>This method returns the record as an <code>OVertex</code> instance.</p>
<h2 id="creating-vertices-2"><a class="header" href="#creating-vertices-2">Creating Vertices</a></h2>
<p>The <a href="java/ref/OElement/../OElement.html"><code>OElement</code></a> class corresponds to a document record in a Document database.  When you use OrientDB as a Graph database, it serves as the superclass to both vertices and edges.  In the event that you want a record to serve as a vertex, use this method to operate on it as an <a href="java/ref/OElement/../OVertex.html"><code>OVertex</code></a> instance.</p>
<h3 id="syntax-106"><a class="header" href="#syntax-106">Syntax</a></h3>
<pre><code>Optional&lt;OVertex&gt; OElement().asVertex()
</code></pre>
<h4 id="return-value-75"><a class="header" href="#return-value-75">Return Value</a></h4>
<p>When the record corresponding to this <a href="java/ref/OElement/../OElement.html"><code>OElement</code></a> instance is a vertex, this method returns an <a href="java/ref/OElement/../OVertex.html"><code>OVertex</code></a> instance.  In the event that the record is a document or edge, (that is, not a vertex), it returns an empty <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html"><code>Optional</code></a> instance.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oelement---getproperty"><a class="header" href="#oelement---getproperty">OElement - getProperty()</a></h1>
<p>This method retrieves the given property from a record.</p>
<h2 id="retrieving-properties-3"><a class="header" href="#retrieving-properties-3">Retrieving Properties</a></h2>
<p>OrientDB stores the particular data for each record in fields, also called properties.  Using this method you can retrieve data from the record to operate on it from within your Java application.  The method uses the property name and type to identify the data you want to retrieve.</p>
<h3 id="syntax-107"><a class="header" href="#syntax-107">Syntax</a></h3>
<pre><code>&lt;RET&gt; RET OElement().getProperty(String name)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>name</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the property name</td></tr>
</tbody></table>
</div>
<h4 id="return-value-76"><a class="header" href="#return-value-76">Return Value</a></h4>
<p>OrientDB stores typed data.  The return value this method returns is of the type that corresponds to the given property. For more information, see <a href="java/ref/OElement/../../../general/Types.html">Supported Data Types</a>.</p>
<h3 id="example-65"><a class="header" href="#example-65">Example</a></h3>
<p>Records often contain more data that you need to operate on in a particular instance.  For instance, imagine you have a web application that serves blogs.  You don't need the entire record when you're only rendering a link.  You might use a method like the one below to create a link from an <a href="java/ref/OElement/../OElement.html"><code>OElement</code></a>:</p>
<pre><code class="language-java">// GENERATE LINK
public String makeLink(OElement record){

	String title = record.getProperty("title");
	String url = record.getProperty("URL");

	return String.format("&lt;a href=\"%s\"&gt;%s&lt;/a&gt;", url, title);

}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oelement---getpropertynames"><a class="header" href="#oelement---getpropertynames">OElement - getPropertyNames()</a></h1>
<p>This method returns the property names set for the given record.</p>
<h2 id="retrieving-property-names"><a class="header" href="#retrieving-property-names">Retrieving Property Names</a></h2>
<p>In cases where you have a record and don't know what properties it provides, this method allows you retrieve a set of strings containing the property names.  You can then use <a href="java/ref/OElement/getProperty.html"><code>getProperty()</code></a> to retrieve the data you want.</p>
<h3 id="syntax-108"><a class="header" href="#syntax-108">Syntax</a></h3>
<pre><code>Set&lt;String&gt; OElement().getPropertyNames()
</code></pre>
<h4 id="return-value-77"><a class="header" href="#return-value-77">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Set.html"><code>Set</code></a> containing <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a> instances of each property name defined in the record.</p>
<h3 id="example-66"><a class="header" href="#example-66">Example</a></h3>
<p>Imagine an application in which you sometimes retrieve records with inconsistent data.  In the event of an error, you might want a method that reports the properties and contents for a record to use when debugging issues.</p>
<pre><code class="language-java">public void errorReadingRecord(OElement record){

   // Fetch Properties
   Set&lt;String&gt; names = record.getPropertyNames();

   // Report Error
   logger.warn(
      String.format("Error Reading Record, record keys: %s",
	     StringUtils.join(names, ", ")));
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oelement---getschematype"><a class="header" href="#oelement---getschematype">OElement - getSchemaType()</a></h1>
<p>This method retrieves the schema type for the record.</p>
<h2 id="retrieving-schema-types"><a class="header" href="#retrieving-schema-types">Retrieving Schema Types</a></h2>
<p>OrientDB can run schema-less, schema-full or it can use a schema in some cases and not use one in others.  In cases where the record has a schema, that is when it is defined as a particular class on the OrientDB database, this method retrieves the <a href="java/ref/OElement/../OClass.html"><code>OClass</code></a> instance to which it belongs.</p>
<h3 id="syntax-109"><a class="header" href="#syntax-109">Syntax</a></h3>
<pre><code>Optional&lt;OClass&gt; OElement.getSchemaType()
</code></pre>
<h4 id="return-value-78"><a class="header" href="#return-value-78">Return Value</a></h4>
<p>When the record corresponding to this <a href="java/ref/OElement/../OElement.html"><code>OElement</code></a> instance has a schema class, this method returns an <a href="java/ref/OElement/../OClass.html"><code>OClass</code></a> instance. In the event that the record does not enforce a schema, it returns an empty <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html"><code>Optional</code></a> instance.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oelement---isedge"><a class="header" href="#oelement---isedge">OElement - isEdge()</a></h1>
<p>This method determines whether the record is an edge.</p>
<h2 id="checking-edges-2"><a class="header" href="#checking-edges-2">Checking Edges</a></h2>
<p>When OrientDB is serving as a Graph database, <a href="java/ref/OElement/../OElement.html"><code>OElement</code></a> serves as the superclass to both edges and vertices.  Using this method you can check whether or not the element is an edge on the database.  To determine whether the record is a vertex, see <a href="java/ref/OElement/isVertex.html"><code>isVertex</code></a>.</p>
<h3 id="syntax-110"><a class="header" href="#syntax-110">Syntax</a></h3>
<pre><code>Boolean OElement().isEdge()
</code></pre>
<h4 id="return-value-79"><a class="header" href="#return-value-79">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>Boolean</code></a> instance.  If the return value is <code>true</code>, the element is an edge.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oelement---isvertex"><a class="header" href="#oelement---isvertex">OElement - isVertex()</a></h1>
<p>This method determines whether the record is a vertex.</p>
<h2 id="checking-vertices"><a class="header" href="#checking-vertices">Checking Vertices</a></h2>
<p>When OrientDB is serving as a Graph database, <a href="java/ref/OElement/../OElement.html"><code>OElement</code></a> serves as the superclass to both edges and vertices.  Using this method you can check whether or not the element is a vertex on the database.  To determine whether the element is an edge, see <a href="java/ref/OElement/isEdge.html"><code>isEdge()</code></a>.</p>
<h3 id="syntax-111"><a class="header" href="#syntax-111">Syntax</a></h3>
<pre><code>Boolean OElement().isVertex()
</code></pre>
<h4 id="return-value-80"><a class="header" href="#return-value-80">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>Boolean</code></a> instance.  If the return value is <code>true</code>, the element is a vertex.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oelement---removeproperty"><a class="header" href="#oelement---removeproperty">OElement - removeProperty()</a></h1>
<p>This method removes a property from the record.</p>
<h2 id="removing-properties-1"><a class="header" href="#removing-properties-1">Removing Properties</a></h2>
<p>In the event that you would like to remove a property from a record with the corresponding data, you can do so using this method.  If you would like instead to add or retrieve a property to the record, see <a href="java/ref/OElement/setProperty.html"><code>setProperty</code></a> or <a href="java/ref/OElement/getProperty.html"><code>getProperty()</code></a>.</p>
<h3 id="syntax-112"><a class="header" href="#syntax-112">Syntax</a></h3>
<pre><code>&lt;RET&gt; RET OElement().removeProperty(String name)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>name</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the property name</td></tr>
</tbody></table>
</div>
<h4 id="return-value-81"><a class="header" href="#return-value-81">Return Value</a></h4>
<p>This method returns the property that you removed from the record.  The return value is a generic and belongs to whatever type is set for the property.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oelement---setproperty"><a class="header" href="#oelement---setproperty">OElement - setProperty()</a></h1>
<p>This method sets data on a record property.</p>
<h2 id="setting-properties"><a class="header" href="#setting-properties">Setting Properties</a></h2>
<p>Data in a record is stored in a set of fields called properties.  Using this method you can add data to a record by its property name.</p>
<h3 id="syntax-113"><a class="header" href="#syntax-113">Syntax</a></h3>
<p>There are two methods available in setting properties:</p>
<pre><code>// METHOD 1
void OElement().setProperty(String name, Object value)

// METHOD 2
void OElement().setProperty(String name, Object value, OType field)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>name</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the property name</td></tr>
<tr><td><strong><code>value</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html"><code>Object</code></a></td><td>Defines the data you want to set on the property</td></tr>
<tr><td><strong><code>field</code></strong></td><td><a href="java/ref/OElement/../OType.html"><code>OType</code></a></td><td>Forced type for the property, (not auto-determined)</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="ofunction"><a class="header" href="#ofunction">OFunction</a></h1>
<p>Interface that controls a database function, which you can in turn use in OrientDB SQL on the database or within your applications.</p>
<h2 id="using-functions-1"><a class="header" href="#using-functions-1">Using Functions</a></h2>
<p>Functions in OrientDB are stored operations that you can call from the Console or through any of the database driver methods that use OrientDB SQL.  OrientDB provides a number of functions by default and the user can define a series of additional functions as need.  They are stored in the database as a series of <code>OFunction</code> instances accessible through <a href="java/ref/OMetadata.html"><code>OMetadata</code></a> and the <a href="java/ref/OFunctionLibrary.html"><code>OFunctionLibrary</code></a>.</p>
<p>In order to work with functions from your application, you first need to import the class into your code.</p>
<pre><code class="language-java">import com.orientechnologies.orient.core.metadata.function.OFunction;
</code></pre>
<h3 id="methods-7"><a class="header" href="#methods-7">Methods</a></h3>
<p>Each function supports the following methods.</p>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Return Type</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="java/ref/OFunction/getCode.html"><strong><code>getCode()</code></strong></a></td><td><code>String</code></td><td>Retrieves the function code</td></tr>
<tr><td><a href="java/ref/OFunction/getId.html"><strong><code>getId()</code></strong></a></td><td><a href="java/ref/ORID.html"><code>ORID</code></a></td><td>Retrieves the function Record ID</td></tr>
<tr><td><a href="java/ref/OFunction/getLanguage.html"><strong><code>getLanguage()</code></strong></a></td><td><code>String</code></td><td>Retrieves the name of the scripting language the function uses</td></tr>
<tr><td><a href="java/ref/OFunction/getName.html"><strong><code>getName()</code></strong></a></td><td><code>String</code></td><td>Retrieves the logical name of the function</td></tr>
<tr><td><a href="java/ref/OFunction/getParameters.html"><strong><code>getParameters()</code></strong></a></td><td><code>List&lt;String&gt;</code></td><td>Retrieves the parameters available for use in the function code</td></tr>
<tr><td><a href="java/ref/OFunction/isIdempotent.html"><strong><code>isIdempotent()</code></strong></a></td><td><code>boolean</code></td><td>Determines whether the function performs idempotent queries or executes non-idempotent commands</td></tr>
<tr><td><a href="java/ref/OFunction/setCode.html"><strong><code>setCode()</code></strong></a></td><td><code>OFunction</code></td><td>Defines the function code</td></tr>
<tr><td><a href="java/ref/OFunction/setIdempotent.html"><strong><code>setIdempotent()</code></strong></a></td><td><code>OFunction</code></td><td>Defines whether the function is idempotent or non-idempotent</td></tr>
<tr><td><a href="java/ref/OFunction/setLanguage.html"><strong><code>setLanguage()</code></strong></a></td><td><code>OFunction</code></td><td>Defines the scripting language the function uses</td></tr>
<tr><td><a href="java/ref/OFunction/setName.html"><strong><code>setName()</code></strong></a></td><td><code>OFunction</code></td><td>Defines the logical name of the function</td></tr>
<tr><td><a href="java/ref/OFunction/setParameters.html"><strong><code>setParameters()</code></strong></a></td><td><code>OFunction</code></td><td>Defines the parameters available to the function code</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><p>:wa</p>
<h1 id="ofunction---getcode"><a class="header" href="#ofunction---getcode">OFunction - getCode()</a></h1>
<p>Retrieves the function code.</p>
<h2 id="function-code"><a class="header" href="#function-code">Function Code</a></h2>
<p>Functions refer to stored operations written in JavaScript or OrientDB SQL that you can use on the Console or as part of an SQL operation from another client program.  Using this method, you can retrieve the code that the given function executes when it's called.  To check what language it's written in, see the <a href="java/ref/OFunction/getLanguage.html"><code>getLanguage()</code></a> method.  To set the code that the function executes, see the <a href="java/ref/OFunction/setCode.html"><code>setCode()</code></a> method.</p>
<h3 id="syntax-114"><a class="header" href="#syntax-114">Syntax</a></h3>
<pre><code>String OFunction().getCode()
</code></pre>
<h4 id="return-value-82"><a class="header" href="#return-value-82">Return Value</a></h4>
<p>This method returns a <code>String</code> instance, which contains the JavaScript or OrientDB SQL code that the function executes when called.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ofunction---getid"><a class="header" href="#ofunction---getid">OFunction - getId()</a></h1>
<p>Retrieves Record ID for the function.</p>
<h2 id="function-records"><a class="header" href="#function-records">Function Records</a></h2>
<p>Internally, OrientDB stores functions as records on the database, which you can in turn query and operate on with normal OrientDB SQL statements, rather than through dedicated syntax like <a href="java/ref/OFunction/../../../sql/SQL-Create-Function.html"><code>CREATE FUNCTION</code></a>.  This means that each function you create on your database has its own dedicated Record ID.  Using this method, you can retrieve this Record ID from the function.</p>
<h3 id="syntax-115"><a class="header" href="#syntax-115">Syntax</a></h3>
<pre><code>ORID OFunction().getId()
</code></pre>
<h4 id="return-value-83"><a class="header" href="#return-value-83">Return Value</a></h4>
<p>This method returns an <a href="java/ref/OFunction/../ORID.html"><code>ORID</code></a> instance that corresponds to the function Record ID.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ofunction---getlanguage"><a class="header" href="#ofunction---getlanguage">OFunction - getLanguage()</a></h1>
<p>Retrieves the language that the function uses.</p>
<h2 id="function-language"><a class="header" href="#function-language">Function Language</a></h2>
<p>Functions aren't just collections of OrientDB SQL statements.  They can also be written in JavaScript, which you may find more convenient for complex operations.  Using this method, you can retrieve the language that the function uses when it executes its code.  To set the language for the function, see the <a href="java/ref/OFunction/setLanguage.html"><code>setLanguage()</code></a> method.</p>
<h3 id="syntax-116"><a class="header" href="#syntax-116">Syntax</a></h3>
<pre><code>String OFunction().getLanguage()
</code></pre>
<h4 id="return-type-10"><a class="header" href="#return-type-10">Return Type</a></h4>
<p>This method returns a <code>String</code> instance, which contains the language that the function uses when it executes code.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ofunction---getname"><a class="header" href="#ofunction---getname">OFunction - getName()</a></h1>
<p>Retrieves the logical name of the function.</p>
<h2 id="function-names"><a class="header" href="#function-names">Function Names</a></h2>
<p>Functions are retrieved and operated on from within OrientDB SQL by their logical names.  If you query the functions available in a database, this is the name that OrientDB returns.  It is also the name used in calling the function within OrientDB SQL statements.  Using this method you can retrieve the function's logical name.  To set the logical name for the function, see the <a href="java/ref/OFunction/setName.html"><code>setName()</code></a> method.</p>
<h3 id="syntax-117"><a class="header" href="#syntax-117">Syntax</a></h3>
<pre><code>String OFunction().getName()
</code></pre>
<h4 id="return-type-11"><a class="header" href="#return-type-11">Return Type</a></h4>
<p>This method returns a <code>String</code> instance, which contains the logical name of the function.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ofunction---getparameters"><a class="header" href="#ofunction---getparameters">OFunction - getParameters()</a></h1>
<p>Retrieves the parameters used by the function.</p>
<h2 id="function-parameters"><a class="header" href="#function-parameters">Function Parameters</a></h2>
<p>Functions can take parameters and perform various operations based on the specific things you pass to them.  In order to call an parameter from your function code, you need to have the parameters defined for the <a href="java/ref/OFunction/../OFunction.html"><code>OFunction</code></a> instance.  Using this method you can retrieve a list of parameters available to the function.  To set the parameters for the function, see the <a href="java/ref/OFunction/setParameters.html"><code>setParameters()</code></a> method.</p>
<h3 id="syntax-118"><a class="header" href="#syntax-118">Syntax</a></h3>
<pre><code>List&lt;String&gt; OFunction().getParameters()
</code></pre>
<h4 id="return-type-12"><a class="header" href="#return-type-12">Return Type</a></h4>
<p>This method returns a <code>List</code> that contains a series of <code>String</code> instances.  Each <code>String</code> corresponds to a parameter the function expects to receive when it's called, which you can then use in your function code.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ofunction---isidempotent"><a class="header" href="#ofunction---isidempotent">OFunction - isIdempotent()</a></h1>
<p>Determines whether the function is idempotent.</p>
<h2 id="function-idempotence"><a class="header" href="#function-idempotence">Function Idempotence</a></h2>
<p>OrientDB differentiates between idempotent queries and non-idempotent commands.  That is, queries that always return the same results versus commands that write to the database.  In functions this is indicated by a simple boolean value set on the <a href="java/ref/OFunction/../OFunction.html"><code>OFunction</code></a> instance.  Using this method, you can check whether the function has been designated as idempotent.  To set idempotence for the function, see the <a href="java/ref/OFunction/setIdempotent.html"><code>setIdempotent()</code></a> method.</p>
<h3 id="syntax-119"><a class="header" href="#syntax-119">Syntax</a></h3>
<pre><code>boolean OFunction.isIdempotent()
</code></pre>
<h4 id="return-type-13"><a class="header" href="#return-type-13">Return Type</a></h4>
<p>This method returns a <code>boolean</code> instance.  A value of <code>true</code> indicates that the function is idempotent and only reads from the database.  A value of <code>false</code> indicates that the function is non-idempotent and modifies data on the database.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ofunction---getcode-1"><a class="header" href="#ofunction---getcode-1">OFunction - getCode()</a></h1>
<p>Defines the function code.</p>
<h2 id="function-code-1"><a class="header" href="#function-code-1">Function Code</a></h2>
<p>Functions refer to stored operations written in JavaScript or OrientDB SQL that you can use on the Console or as part of an SQL operation from another client program.  Using this method, you can set the code that the given function executes when it's called.  To set what language it's written in, see the <a href="java/ref/OFunction/setLanguage.html"><code>setLanguage()</code></a> method.  To retrieve the code from function, see the <a href="java/ref/OFunction/getCode.html"><code>getCode()</code></a> method.</p>
<h3 id="syntax-120"><a class="header" href="#syntax-120">Syntax</a></h3>
<pre><code>OFunction OFunction().setCode(String code)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>code</code></strong></td><td><code>String</code></td><td>Defines the code that you want to execute</td></tr>
</tbody></table>
</div>
<h4 id="return-value-84"><a class="header" href="#return-value-84">Return Value</a></h4>
<p>This method returns the updated <a href="java/ref/OFunction/../OFunction.html"><code>OFunction</code></a> instance.  You may find this useful when stringing several operations together.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ofunction---setidempotent"><a class="header" href="#ofunction---setidempotent">OFunction - setIdempotent()</a></h1>
<p>Sets whether the function is idempotent.</p>
<h2 id="function-idempotence-1"><a class="header" href="#function-idempotence-1">Function Idempotence</a></h2>
<p>OrientDB differentiates between idempotent queries and non-idempotent commands.  That is, queries that always return the same results versus commands that write to the database.  In functions this is indicated by a simple boolean value set on the <a href="java/ref/OFunction/../OFunction.html"><code>OFunction</code></a> instance.  Using this method you can set idempotence for the function.  To determine whether a function is set as idempotent, see the <a href="java/ref/OFunction/isIdempotent.html"><code>isIdempotent()</code></a> method.</p>
<h3 id="syntax-121"><a class="header" href="#syntax-121">Syntax</a></h3>
<pre><code>OFunction OFunction().setIdempotent(boolean idempotence)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>idempotence</code></strong></td><td><code>boolean</code></td><td>Indicates whether the function is idempotent</td></tr>
</tbody></table>
</div>
<h4 id="return-type-14"><a class="header" href="#return-type-14">Return Type</a></h4>
<p>This method returns the updated <a href="java/ref/OFunction/../OFunction.html"><code>OFunction</code></a> instance, which you may find useful when stringing several operations together.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ofunction---setlanguage"><a class="header" href="#ofunction---setlanguage">OFunction - setLanguage()</a></h1>
<p>Defines the language that the function uses.</p>
<h2 id="function-language-1"><a class="header" href="#function-language-1">Function Language</a></h2>
<p>Functions aren't just collections of OrientDB SQL statements.  They can also be written in JavaScript, which you may find more convenient for complex operations.  When not explicitly set, <a href="java/ref/OFunction/../OFunction.html"><code>OFunction</code></a> defaults to JavaScript.  Using this method, you can set the language that the function uses when it executes its code.  To determine what language the function uses, see the <a href="java/ref/OFunction/getLanguage.html"><code>getLanguage()</code></a> method.</p>
<h3 id="syntax-122"><a class="header" href="#syntax-122">Syntax</a></h3>
<pre><code>OFunction OFunction().setLanguage(String lang)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>lang</code></strong></td><td><code>String</code></td><td>Defines the language you want to use.</td></tr>
</tbody></table>
</div>
<h4 id="return-type-15"><a class="header" href="#return-type-15">Return Type</a></h4>
<p>This method returns the updated <a href="java/ref/OFunction/../OFunction.html"><code>OFunction</code></a> instance, which you may find useful when stringing several operations together.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ofunction---setname"><a class="header" href="#ofunction---setname">OFunction - setName()</a></h1>
<p>Defines the logical name of the function.</p>
<h2 id="function-names-1"><a class="header" href="#function-names-1">Function Names</a></h2>
<p>Functions are retrieved and operated on from within OrientDB SQL by their logical names.  If you query the functions available in a database, this is the name that OrientDB returns.  It is also the name used in calling the function within OrientDB SQL statements.  Using this method you can define the logical name of the function. To retrieve the logical name of the function, see the <a href="java/ref/OFunction/getName.html"><code>getName()</code></a> method.</p>
<h3 id="syntax-123"><a class="header" href="#syntax-123">Syntax</a></h3>
<pre><code>OFunction OFunction().setName(String name)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>name</code></strong></td><td><code>String</code></td><td>Logical name to set</td></tr>
</tbody></table>
</div>
<h4 id="return-type-16"><a class="header" href="#return-type-16">Return Type</a></h4>
<p>This method returns the updated <a href="java/ref/OFunction/../OFunction.html"><code>OFunction</code></a> instance.  You may find this useful when stringing several operations together.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ofunction---setparameters"><a class="header" href="#ofunction---setparameters">OFunction - setParameters()</a></h1>
<p>Defines the parameters used by the function.</p>
<h2 id="function-parameters-1"><a class="header" href="#function-parameters-1">Function Parameters</a></h2>
<p>Functions can take parameters and perform various operations based on the specific things you pass to them.  In order to call an parameter from your function code, you need to have the parameters defined for the <a href="java/ref/OFunction/../OFunction.html"><code>OFunction</code></a> instance.  Using this method you can define a list of parameters available to the function.  To determine what parameters are available to the function, see the <a href="java/ref/OFunction/getParameters.html"><code>getParameters()</code></a> method.</p>
<h3 id="syntax-124"><a class="header" href="#syntax-124">Syntax</a></h3>
<pre><code>OFunction OFunction().setParameters(List&lt;String&gt; params)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>params</code></strong></td><td><code>List&lt;String&gt;</code></td><td>Defines the parameters the function receives when called</td></tr>
</tbody></table>
</div>
<h4 id="return-type-17"><a class="header" href="#return-type-17">Return Type</a></h4>
<p>This method returns the updated <a href="java/ref/OFunction/../OFunction.html"><code>OFunction</code></a> instance, which you may find useful when stringing several operations together.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ofunctionlibrary"><a class="header" href="#ofunctionlibrary">OFunctionLibrary</a></h1>
<p>Interface used to store the available <a href="java/ref/OFunction.html"><code>OFunction</code></a> instances on a database.</p>
<h2 id="function-library"><a class="header" href="#function-library">Function Library</a></h2>
<p>OrientDB SQL supports the use of functions and user-defined functions, which are typically defined in JavaScript using a <a href="java/ref/../../sql/SQL-Create-Function.html"><code>CREATE FUNCTION</code></a> statement.  Internally, OrientDB stores functions as a series of <a href="java/ref/OFunction.html"><code>OFunction</code></a> instances.  When working in a Java, you can define series of new functions internally from your application code.</p>
<p>You can retrieve the function library from <a href="java/ref/ODatabaseSession.html"><code>ODatabaseSession</code></a> or <a href="java/ref/ODatabaseDocument.html"><code>ODatabaseDocument</code></a> by first retrieving the metadata with the <a href="java/ref/ODatabaseDocument/getMetadata.html"><code>getMetadata()</code></a> method and then retrieving the function library from the metadata with the <a href="java/ref/OMetadata/getFunctionLibrary.html"><code>getFunctionLibrary()</code></a> method.  In order to operate on the function library, you also need to import it into your code.</p>
<pre><code class="language-java">import com.orientechnologies.orient.core.metadata.function.OFunctionLibrary;
</code></pre>
<h3 id="methods-8"><a class="header" href="#methods-8">Methods</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Return Type</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="java/ref/OFunctionLibrary/createFunction.html"><strong><code>createFunction()</code></strong></a></td><td><a href="java/ref/OFunction.html"><code>OFunction</code></a></td><td>Creates a new function</td></tr>
<tr><td><a href="java/ref/OFunctionLibrary/dropFunction.html"><strong><code>dropFunction()</code></strong></a></td><td><code>void</code></td><td>Removes function</td></tr>
<tr><td><a href="java/ref/OFunctionLibrary/getFunction.html"><strong><code>getFunction()</code></strong></a></td><td><a href="java/ref/OFunction.html"><code>OFunction</code></a></td><td>Retrieves the given function</td></tr>
<tr><td><a href="java/ref/OFunctionLibrary/getFunctionNames.html"><strong><code>getFunctionNames()</code></strong></a></td><td><code>Set&lt;String&gt;</code></td><td>Retrieves the logical names for functions in the library</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="ofunctionlibrary---createfunction"><a class="header" href="#ofunctionlibrary---createfunction">OFunctionLibrary - createFunction()</a></h1>
<p>Creates a new function on the database.</p>
<h2 id="creating-functions-1"><a class="header" href="#creating-functions-1">Creating Functions</a></h2>
<p>OrientDB SQL supports the use of functions and user-defined functions, which are typically defined in JavaScript.   Using this method you can create a new function in the database.  The method takes the logical name of the function as an argument and then returns an <a href="java/ref/OFunctionLibrary/../OFunction.html"><code>OFunction</code></a> instance, from which you can further define its operation.</p>
<h3 id="syntax-125"><a class="header" href="#syntax-125">Syntax</a></h3>
<pre><code>OFunction OFunctionLibrary().createFunction(String name)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>name</code></strong></td><td><code>String</code></td><td>Defines the logical name of the function</td></tr>
</tbody></table>
</div>
<h4 id="return-type-18"><a class="header" href="#return-type-18">Return Type</a></h4>
<p>This method returns an <a href="java/ref/OFunctionLibrary/../OFunction.html"><code>OFunction</code></a> instance.  Note that this method does not configure the function, define arguments or what OrientDB should do in the event of a user calling the function.  You need to define that from the <a href="java/ref/OFunctionLibrary/../OFunction.html"><code>OFunction</code></a> instance.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ofunctionlibrary---dropfunction"><a class="header" href="#ofunctionlibrary---dropfunction">OFunctionLibrary - dropFunction()</a></h1>
<p>Removes the given function from the database.</p>
<h2 id="removing-functions"><a class="header" href="#removing-functions">Removing Functions</a></h2>
<p>OrientDB SQL supports the use of functions and user-defined functions from the console or application code.  Using this method, you can remove the given function from the function library.</p>
<h3 id="syntax-126"><a class="header" href="#syntax-126">Syntax</a></h3>
<pre><code>void OFunctionLibrary().dropFunction(OFunction func)
void OFunctionLibrary().dropFunction(String name)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>func</code></strong></td><td><a href="java/ref/OFunctionLibrary/../OFunction.html"><code>OFunction</code></a></td><td>Defines the function you want to remove</td></tr>
<tr><td><strong><code>name</code></strong></td><td><code>String</code></td><td>Defines the logical name of the function</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="ofunctionlibrary---getfunction"><a class="header" href="#ofunctionlibrary---getfunction">OFunctionLibrary - getFunction()</a></h1>
<p>Retrieves the specified database function from the function library.</p>
<h2 id="retrieving-functions"><a class="header" href="#retrieving-functions">Retrieving Functions</a></h2>
<p>OrientDB supports the use of functions and user-defined functions in OrientDB SQL. Internally these functions are stored as a series of <a href="java/ref/OFunctionLibrary/../OFunction.html"><code>OFunction</code></a>  instances on the database in the function library.  Using this method, you can retrieve the specified function from the function library, to further operate on it.</p>
<h3 id="syntax-127"><a class="header" href="#syntax-127">Syntax</a></h3>
<pre><code>OFunction OFunctionLibrary().getFunction(String name)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>name</code></strong></td><td><code>String</code></td><td>Defines the logical name of the function to retrieve</td></tr>
</tbody></table>
</div>
<h4 id="return-type-19"><a class="header" href="#return-type-19">Return Type</a></h4>
<p>This method returns an <a href="java/ref/OFunctionLibrary/../OFunction.html"><code>OFunction</code></a> instance that corresponds to the logical name requested.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ofunctionlibrary---getfunctionnames"><a class="header" href="#ofunctionlibrary---getfunctionnames">OFunctionLibrary - getFunctionNames()</a></h1>
<p>Retrieves a set of logical names for the functions available in the function library.</p>
<h2 id="retrieving-logical-names"><a class="header" href="#retrieving-logical-names">Retrieving Logical Names</a></h2>
<p>OrientDB supports the use of functions and user-defined functions, allowing you to do a little bit more on the database side than the standard OrientDB SQL provides.  These functions are stored internally as a series of <a href="java/ref/OFunctionLibrary/../OFunction.html"><code>OFunction</code></a> instances, but operated on from the Console using their logical names.  Using this method, you can retrieve the logical names for all functions defined in the function library.</p>
<h3 id="syntax-128"><a class="header" href="#syntax-128">Syntax</a></h3>
<pre><code>Set&lt;String&gt; OFunctionLibrary().getFunctionNames()
</code></pre>
<h4 id="return-value-85"><a class="header" href="#return-value-85">Return Value</a></h4>
<p>This method returns a <code>Set</code> instance that contains a series of <code>String</code> instances, corresponding to the logical name for each function in the database function library.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ointent"><a class="header" href="#ointent">OIntent</a></h1>
<p>Declaring an Intent allows you to optimize OrientDB in one call for a specific class of operations.  While these declaration won't offer you much benefit under general usage, they can dramatically speed up performance for a specific task, such as a large insert or complex read.</p>
<p>Currently, OrientDB supports the following intents:</p>
<div class="table-wrapper"><table><thead><tr><th>Intent</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>OIntentMassiveInsert</code></strong></td><td>Optimizes OrientDB for a large write operation</td></tr>
<tr><td><strong><code>OIntentMassiveRead</code></strong></td><td>Optimizes OrientDB for a large read operation</td></tr>
<tr><td><strong><code>OIntentNoCache</code></strong></td><td>Optimizes OrientDB to operate without a cache</td></tr>
</tbody></table>
</div>
<p>Each of these classes is a subclass of <code>OIntent</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="olivequerymonitor"><a class="header" href="#olivequerymonitor">OLiveQueryMonitor</a></h1>
<p>Provides an interface for monitoring live queries.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="olivequeryresultlistener"><a class="header" href="#olivequeryresultlistener">OLiveQueryResultListener</a></h1>
<p>Interface provides a listener interface for live queries.</p>
<h2 id="using-live-query-listeners"><a class="header" href="#using-live-query-listeners">Using Live Query Listeners</a></h2>
<p>In OrientDB, <a href="java/ref/../Live-Query.html">Live Queries</a> allows you to execute code in response to changes on the database.  It has two parts, a query that defines the records you want to monitor and a listener that controls what your application does in response to changes in these records.  Using this interface, you can implement your own listener with the specific code you want to run in response to changes.</p>
<p>To use <code>OLiveQueryListener</code> in your application, import it into your code:</p>
<pre><code class="language-java">import com.orientechnologies.orient.core.db.OLiveQueryResultListener;
</code></pre>
<h2 id="methods-9"><a class="header" href="#methods-9">Methods</a></h2>
<p>When your Live Query registers an event, such as a user running an <a href="java/ref/../../sql/SQL-Update.html"><code>UPDATE</code></a> or <a href="java/ref/../../sql/SQL-Delete.html"><code>DELETE</code></a> statement, OrientDB attempts to call methods on the listener.   You can define what actions your application takes by overriding the following methods, implementing your own code.</p>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="java/ref/OLiveQueryResultListener/onCreate.html"><strong><code>onCreate()</code></strong></a></td><td>Executes on record creation</td></tr>
<tr><td><a href="java/ref/OLiveQueryResultListener/onDelete.html"><strong><code>onDelete()</code></strong></a></td><td>Executes on record deletion</td></tr>
<tr><td><a href="java/ref/OLiveQueryResultListener/onEnd.html"><strong><code>onEnd()</code></strong></a></td><td>Executes on unsubscribe</td></tr>
<tr><td><a href="java/ref/OLiveQueryResultListener/onError.html"><strong><code>onError()</code></strong></a></td><td>Executes on errors</td></tr>
<tr><td><a href="java/ref/OLiveQueryResultListener/onUpdate.html"><strong><code>onUpdate()</code></strong></a></td><td>Executes on record updates</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="olivequeryresultlistener---oncreate"><a class="header" href="#olivequeryresultlistener---oncreate">OLiveQueryResultListener - onCreate()</a></h1>
<p>Executes when new records are added to a <a href="java/ref/OLiveQueryResultListener/../../Live-Query.html">Live Query</a>.</p>
<h2 id="live-queries-and-new-records"><a class="header" href="#live-queries-and-new-records">Live Queries and New Records</a></h2>
<p>In OrientDB, a Live Query is composed of a query that defines the records you want to monitor and a listener that controls what your application does in the event of changes to those records.  Using this method, you can define what happens when an <a href="java/ref/OLiveQueryResultListener/../../../sql/SQL-Insert.html"><code>INSERT</code></a> or <a href="java/ref/OLiveQueryResultListener/../../../sql/SQL-Update.html"><code>UPDATE</code></a> statement adds a new record to the Live Query result-set.</p>
<h3 id="syntax-129"><a class="header" href="#syntax-129">Syntax</a></h3>
<pre><code>void OLiveQueryResultListener().onCreate(
   ODatabaseDocument db,
   OResult data)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>db</code></strong></td><td><a href="java/ref/OLiveQueryResultListener/../ODatabaseDocument.html"><code>ODatabaseDocument</code></a></td><td>Provides the database in which the Live Query executes</td></tr>
<tr><td><strong><code>data</code></strong></td><td><a href="java/ref/OLiveQueryResultListener/../OResult.html"><code>OResult</code></a></td><td>Provides the data added</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="olivequeryresultlistener---ondelete"><a class="header" href="#olivequeryresultlistener---ondelete">OLiveQueryResultListener - onDelete()</a></h1>
<p>Executes when a record  is removed from a <a href="java/ref/OLiveQueryResultListener/../../Live-Query.html">Live Query</a>.</p>
<h2 id="live-queries-and-deleted-records"><a class="header" href="#live-queries-and-deleted-records">Live Queries and Deleted Records</a></h2>
<p>In OrientDB, a Live Query is composed of a query that defines the records you want to monitor and a listener that controls what your application does in the event of changes to those records.  Using this method, you can define what happens when a record is removed from a Live Query result-set.</p>
<h3 id="syntax-130"><a class="header" href="#syntax-130">Syntax</a></h3>
<pre><code>void OLiveQueryResultListener().onDelete(
   ODatabaseDocument db,
   OResult data)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>db</code></strong></td><td><a href="java/ref/OLiveQueryResultListener/../ODatabaseDocument.html"><code>ODatabaseDocument</code></a></td><td>Provides the database in which the Live Query executes</td></tr>
<tr><td><strong><code>data</code></strong></td><td><a href="java/ref/OLiveQueryResultListener/../OResult.html"><code>OResult</code></a></td><td>Provides the data</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="olivequeryresultlistener---onend"><a class="header" href="#olivequeryresultlistener---onend">OLiveQueryResultListener - onEnd()</a></h1>
<p>Executes when the database unsubscribes to a <a href="java/ref/OLiveQueryResultListener/../../Live-Query.html">Live Query</a>.</p>
<h2 id="live-queries"><a class="header" href="#live-queries">Live Queries</a></h2>
<p>In OrientDB, a Live Query is composed of a query that defines the records you want to monitor and a listener that controls what your application does in the event of changes to those records.  Using this method you can define what happens when a database unsubscribes to a Live Query result-set.</p>
<h3 id="syntax-131"><a class="header" href="#syntax-131">Syntax</a></h3>
<pre><code>void OLiveQueryResultListener().onCreate(
   ODatabaseDocument db)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>db</code></strong></td><td><a href="java/ref/OLiveQueryResultListener/../ODatabaseDocument.html"><code>ODatabaseDocument</code></a></td><td>Provides the database in which the Live Query executes</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="olivequeryresultlistener---onerror"><a class="header" href="#olivequeryresultlistener---onerror">OLiveQueryResultListener - onError()</a></h1>
<p>Executes whenever an error is generated by a <a href="java/ref/OLiveQueryResultListener/../../Live-Query.html">Live Query</a></p>
<h2 id="live-queries-1"><a class="header" href="#live-queries-1">Live Queries</a></h2>
<p>In OrientDB, a Live Query is composed of a query that defines the records you want to monitor and a listener that controls what your application does in the event of changes to those records.  Using this method you can define what happens when a Live Query encounters an error.</p>
<h3 id="syntax-132"><a class="header" href="#syntax-132">Syntax</a></h3>
<pre><code>void OLiveQueryResultListener().onError(
   ODatabaseDocument db,
   OException exception)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>db</code></strong></td><td><a href="java/ref/OLiveQueryResultListener/../ODatabaseDocument.html"><code>ODatabaseDocument</code></a></td><td>Provides the database in which the Live Query executes</td></tr>
<tr><td><strong><code>exception</code></strong></td><td><code>OException</code></td><td>Provides exception instance</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="olivequeryresultlistener---onupdate"><a class="header" href="#olivequeryresultlistener---onupdate">OLiveQueryResultListener - onUpdate()</a></h1>
<p>Executes when records are updated in a <a href="java/ref/OLiveQueryResultListener/../../Live-Query.html">Live Query</a>.</p>
<h2 id="live-queries-2"><a class="header" href="#live-queries-2">Live Queries</a></h2>
<p>In OrientDB, a Live Query is composed of a query that defines the records you want to monitor and a listener that controls what your application does in the event of changes to those records.  Using this method, you can define what happens when an <a href="java/ref/OLiveQueryResultListener/../../../sql/SQL-Update.html"><code>UPDATE</code></a> statement is run affecting the Live Query result-set.</p>
<h3 id="syntax-133"><a class="header" href="#syntax-133">Syntax</a></h3>
<pre><code>void OLiveQueryResultListener().onUpdate(
   ODatabaseDocument db,
   OResult before,
   OResult after)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>db</code></strong></td><td><a href="java/ref/OLiveQueryResultListener/../ODatabaseDocument.html"><code>ODatabaseDocument</code></a></td><td>Provides the database in which the Live Query executes</td></tr>
<tr><td><strong><code>before</code></strong></td><td><a href="java/ref/OLiveQueryResultListener/../OResult.html"><code>OResult</code></a></td><td>Provides the data as it existed before the change</td></tr>
<tr><td><strong><code>after</code></strong></td><td><a href="java/ref/OLiveQueryResultListener/../OResult.html"><code>OResult</code></a></td><td>Provides the data as it exists after the change</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="ometadata"><a class="header" href="#ometadata">OMetadata</a></h1>
<p>Interface used to store database metadata, such as the function library, schema and security.</p>
<h2 id="using-ometadata"><a class="header" href="#using-ometadata">Using OMetadata</a></h2>
<p>OrientDB stores metadata on the database.  You can retrieve it from <a href="java/ref/ODatabaseSession.html"><code>ODatabaseSession</code></a> or <a href="java/ref/ODatabaseDocument"><code>ODatabaseDocument</code></a> using the <a href="java/ref/ODatabaseDocument/getMetadata.html"><code>getMetadata()</code></a> method.  In order to use it in your code, you also need to import the class where relevant.</p>
<pre><code class="language-java">import com.orientechnologies.orient.core.metadata.OMetadata;
</code></pre>
<h3 id="methods-10"><a class="header" href="#methods-10">Methods</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Return Type</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="java/ref/OMetadata/getFunctionLibrary.html"><strong><code>getFunctionLibrary()</code></strong></a></td><td><a href="java/ref/OFunctionLibrary.html"><code>OFunctionLibrary</code></a></td><td>Retrieves the database function library</td></tr>
<tr><td><a href="java/ref/OMetadata/getSchema.html"><strong><code>getSchema()</code></strong></a></td><td><a href="java/ref/OSchema.html"><code>OSchema</code></a></td><td>Retrieves the database schema</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="ometadata---getfunctionlibrary"><a class="header" href="#ometadata---getfunctionlibrary">OMetadata - getFunctionLibrary()</a></h1>
<p>Retrieves the function library from the database metadata.</p>
<h2 id="orientdb-functions"><a class="header" href="#orientdb-functions">OrientDB Functions</a></h2>
<p>OrientDB SQL supports the use of functions and of user-defined functions.  These are represented internally as <a href="java/ref/OMetadata/../OFunction.html"><code>OFunction</code></a> instances.  They are stored at the database level in the function library, that is the <a href="java/ref/OMetadata/../OFunctionLibrary.html"><code>OFunctionLibrary</code></a>.  Using this method you can retrieve the function library from the database metadata, allowing you to operate on the available database functions or add new functions for your application to use.</p>
<h3 id="syntax-134"><a class="header" href="#syntax-134">Syntax</a></h3>
<pre><code>OFunctionLibrary OMetadata().getFunctionLibrary()
</code></pre>
<h4 id="return-type-20"><a class="header" href="#return-type-20">Return Type</a></h4>
<p>This method returns an <a href="java/ref/OMetadata/../OFunctionLibrary.html"><code>OFunctionLibrary</code></a> instance, which contains the database functions.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ometadata---getschema"><a class="header" href="#ometadata---getschema">OMetadata - getSchema()</a></h1>
<p>Retrieves the database schema from the database metadata.</p>
<h2 id="retrieving-schemas"><a class="header" href="#retrieving-schemas">Retrieving Schemas</a></h2>
<p>OrientDB supports multiple implementations of schemas.  A database can strictly enforce schema, not use schema or use a mix of the two.  The schema itself is stored in the database metadata as an <a href="java/ref/OMetadata/../OSchema.html"><code>OSchema</code></a> instance.  Using this method you can retrieve the schema from the database metadata to read or administer.</p>
<h3 id="syntax-135"><a class="header" href="#syntax-135">Syntax</a></h3>
<pre><code>OSchema OMetadata().getSchema()
</code></pre>
<h4 id="return-type-21"><a class="header" href="#return-type-21">Return Type</a></h4>
<p>This method returns an <a href="java/ref/OMetadata/../OSchema.html"><code>OSchema</code></a> instance, which represents the schema available on the database.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="java-api---oproperty"><a class="header" href="#java-api---oproperty">Java API - OProperty</a></h1>
<p>This class provides a standard interface for handling properties on database classes.</p>
<h2 id="managing-properties-1"><a class="header" href="#managing-properties-1">Managing Properties</a></h2>
<p>Where database classes allow you to organize records on your database, properties organize the data you store on the records.  You can manage this through an enforced schema, allowing you to apply constraints to the property.  You can also manage it through an implied schema, where you decide at the application level to use certain properties to store certain information on the record.</p>
<p>Each property you create on a class initializes an <code>OProperty</code> instance on OrientDB. You can then retrieve these instances to retrieve information or operate on them further.</p>
<p>This class is available at <code>com.orientechnologies.orient.core.metadata.schema</code>.</p>
<pre><code class="language-java">import com.orientechnologies.orient.core.metadata.schema.OProperty;
</code></pre>
<h2 id="methods-11"><a class="header" href="#methods-11">Methods</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Return Type</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="java/ref/OProperty/getDefaultValue.html"><strong><code>getDefaultValue()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Retrieves the default value</td></tr>
<tr><td><a href="java/ref/OProperty/getLinkedClass.html"><strong><code>getLinkedClass()</code></strong></a></td><td><a href="java/ref/OClass.html"><code>OClass</code></a></td><td>Retrieves the linked class in lazy mode</td></tr>
<tr><td><a href="java/ref/OProperty/getLinkedType.html"><strong><code>getLinkedType()</code></strong></a></td><td><a href="java/ref/OType.html"><code>OType</code></a></td><td>Retrieves the linked type</td></tr>
<tr><td><a href="java/ref/OProperty/getMax.html"><strong><code>getMax()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Retrieves the maximum allowed value</td></tr>
<tr><td><a href="java/ref/OProperty/getMin.html"><strong><code>getMin()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Retrieves the minimum allowed value</td></tr>
<tr><td><a href="java/ref/OProperty/getName.html"><strong><code>getName()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Retrieves the property name</td></tr>
<tr><td><a href="java/ref/OProperty/getType.html"><strong><code>getType()</code></strong></a></td><td><a href="java/ref/OType.html"><code>OType</code></a></td><td>Retrieves the property type</td></tr>
<tr><td><a href="java/ref/OProperty/isMandatory.html"><strong><code>isMandatory()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>Boolean</code></a></td><td>Determines whether the class requires you to set a value on this property</td></tr>
<tr><td><a href="java/ref/OProperty/isNotNull.html"><strong><code>isNotNull()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>Boolean</code></a></td><td>Determines whether the class permits <code>null</code> values</td></tr>
<tr><td><a href="java/ref/OProperty/isReadonly.html"><strong><code>isReadonly()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>Boolean</code></a></td><td>Determines whether you can write data to the property</td></tr>
<tr><td><a href="java/ref/OProperty/setDefaultValue.html"><strong><code>setDefaultValue()</code></strong></a></td><td><code>OProperty</code></td><td>Defines the default value</td></tr>
<tr><td><a href="java/ref/OProperty/setLinkedClass.html"><strong><code>setLinkedClass()</code></strong></a></td><td><code>OProperty</code></td><td>Defines the linked class</td></tr>
<tr><td><a href="java/ref/OProperty/setLinkedType.html"><strong><code>setLinkedType()</code></strong></a></td><td><code>OProperty</code></td><td>Defines the linked type</td></tr>
<tr><td><a href="java/ref/OProperty/setMax.html"><strong><code>setMax()</code></strong></a></td><td><code>OProperty</code></td><td>Defines the maximum allowed value</td></tr>
<tr><td><a href="java/ref/OProperty/setMin.html"><strong><code>setMin()</code></strong></a></td><td><code>OProperty</code></td><td>Defines the minimum allowed value</td></tr>
<tr><td><a href="java/ref/OProperty/setName.html"><strong><code>setName()</code></strong></a></td><td><code>OProperty</code></td><td>Defines the property name</td></tr>
<tr><td><a href="java/ref/OProperty/setType.html"><strong><code>setType()</code></strong></a></td><td><code>OProperty</code></td><td>Defines the property type</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="oproperty---getdefaultvalue"><a class="header" href="#oproperty---getdefaultvalue">OProperty - getDefaultValue()</a></h1>
<p>This method retrieves the default value for the given property.</p>
<h2 id="retrieving-default-values"><a class="header" href="#retrieving-default-values">Retrieving Default Values</a></h2>
<p>Normally, when you create a new record and save it to OrientDB, you define the values set on each property.  In cases where values are not set on each property, the undefined properties defaults to <code>null</code> values.  While this may be sufficient in most cases, you may at times want to have a default value on some properties.</p>
<p>For instance, imagine a class that records student information for a school.  Since each year the majority of new students are added to a particular class, (that is, the current class of incoming freshmen), you might set and each year update the default class for this property, saving yourself time in the long run.</p>
<p>Using this method, you can retrieve the current default value set on the property.</p>
<h3 id="syntax-136"><a class="header" href="#syntax-136">Syntax</a></h3>
<pre><code>String OProperty().getDefaultValue()
</code></pre>
<h4 id="return-value-86"><a class="header" href="#return-value-86">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a> instance, representing the default value for the property.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oproperty---getlinkedclass"><a class="header" href="#oproperty---getlinkedclass">OProperty - getLinkedClass()</a></h1>
<p>Retrieves the class linked to the property.</p>
<h2 id="retrieving-linked-classes"><a class="header" href="#retrieving-linked-classes">Retrieving Linked Classes</a></h2>
<p>Properties are generally created as fields in a database class, (that is, an <a href="java/ref/OProperty/../OClass.html"><code>OClass</code></a> instance).  Using this method, you can retrieve the database class to which the given <a href="java/ref/OProperty/../OProperty.html"><code>OProperty</code></a> instance is linked.</p>
<p>OrientDB retrieves this class in lazy mode, because while unmarshalling, the class could not be loaded.</p>
<h3 id="syntax-137"><a class="header" href="#syntax-137">Syntax</a></h3>
<pre><code>OClass OProperty.getLinkedClass()
</code></pre>
<h4 id="return-value-87"><a class="header" href="#return-value-87">Return Value</a></h4>
<p>This method returns the <a href="java/ref/OProperty/../OClass.html"><code>OClass</code></a> instance linked to the property.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oproperty---getlinkedtype"><a class="header" href="#oproperty---getlinkedtype">OProperty - getLinkedType()</a></h1>
<p>Retrieves the property type.</p>
<h2 id="retrieving-types"><a class="header" href="#retrieving-types">Retrieving Types</a></h2>
<p>OrientDB enforces typing for properties.  Each property in a database class is set to a particular type, which provide some constraint on the kinds of data set for the property. Using this method you can retrieve the property type for further operations.</p>
<h3 id="syntax-138"><a class="header" href="#syntax-138">Syntax</a></h3>
<pre><code>OType OProperty.getLinkedType()
</code></pre>
<h4 id="return-type-22"><a class="header" href="#return-type-22">Return Type</a></h4>
<p>This method returns an <a href="java/ref/OProperty/../OType.html"><code>OType</code></a> instance that corresponds to the property type.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oproperty---getmax"><a class="header" href="#oproperty---getmax">OProperty - getMax()</a></h1>
<p>This method retrieves the maximum allowed value for the property.</p>
<h2 id="retrieving-constraints"><a class="header" href="#retrieving-constraints">Retrieving Constraints</a></h2>
<p>Properties can enforce constraints on the data you store in them.  This can be limited to the data-type of the stored value.  It can also extend to constraints on the actual data.</p>
<p>OrientDB calculates the maximum allowed values in different ways, depending on what <a href="java/ref/OProperty/../OType.html"><code>OType</code></a> you have set for the property:</p>
<ul>
<li><strong>String</strong> The maximum value is the maximum allowed number of characters.</li>
<li><strong>Number</strong> The maximum value is the largest allowed number.</li>
<li><strong>Date</strong> The maximum value is the latest allowed date.</li>
<li><strong>Time</strong> The maximum value is the latest allowed time, measured in milliseconds.</li>
<li><strong>Binary</strong> The maximum value is the largest allowed size for a byte array.</li>
<li><strong>List</strong>, <strong>Set</strong> or <strong>Collection</strong> The maximum value is largest size of the collection.</li>
</ul>
<p>Using this method, you can retrieve the maximum allowed value for the property.</p>
<h3 id="syntax-139"><a class="header" href="#syntax-139">Syntax</a></h3>
<pre><code>String OProperty().getMax()
</code></pre>
<h4 id="return-value-88"><a class="header" href="#return-value-88">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a> instance, which provides the maximum value set on the property.  In the event that there is no maximum value set on the property, it returns <code>null</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oproperty---getmax-1"><a class="header" href="#oproperty---getmax-1">OProperty - getMax()</a></h1>
<p>This method retrieves the minimum allowed value for the property.</p>
<h2 id="retrieving-constraints-1"><a class="header" href="#retrieving-constraints-1">Retrieving Constraints</a></h2>
<p>Properties can enforce constraints on the data you store in them.  This can be limited to the data-type of the stored value.  It can also extend to constraints on the actual data.</p>
<p>OrientDB calculates the minimum allowed values in different ways, depending on what <a href="java/ref/OProperty/../OType.html"><code>OType</code></a> you have set for the property:</p>
<ul>
<li><strong>String</strong> The minimum value is the minimum allowed number of characters.</li>
<li><strong>Number</strong> The minimum value is the smallest allowed number.</li>
<li><strong>Date</strong> The minimum value is the earliest allowed date.</li>
<li><strong>Time</strong> The minimum value is the earliest allowed time, measured in milliseconds.</li>
<li><strong>Binary</strong> The minimum value is the smallest allowed size for a byte array.</li>
<li><strong>List</strong>, <strong>Set</strong> or <strong>Collection</strong> The minimum value is smallest size of the collection.</li>
</ul>
<p>Using this method, you can retrieve the minimum allowed value for the property.</p>
<h3 id="syntax-140"><a class="header" href="#syntax-140">Syntax</a></h3>
<pre><code>String OProperty().getMin()
</code></pre>
<h4 id="return-value-89"><a class="header" href="#return-value-89">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a> instance, which provides the minimum value set on the property.  In the event that there is no minimum value set on the property, it returns <code>null</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oproperty---getname"><a class="header" href="#oproperty---getname">OProperty - getName()</a></h1>
<p>This method retrieves the name of the property.</p>
<h2 id="retrieving-the-property-name"><a class="header" href="#retrieving-the-property-name">Retrieving the Property Name</a></h2>
<p>OrientDB differentiates between properties by the property name.  Using this method you can retrieve the name from an <a href="java/ref/OProperty/../OProperty.html"><code>OProperty</code></a> instance.</p>
<h3 id="syntax-141"><a class="header" href="#syntax-141">Syntax</a></h3>
<pre><code>String OProperty().getName()
</code></pre>
<h4 id="return-value-90"><a class="header" href="#return-value-90">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a> value that provides the name of the property.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oproperty---gettype"><a class="header" href="#oproperty---gettype">OProperty - getType()</a></h1>
<p>This method retrieves the type for the property.</p>
<h2 id="retrieving-property-types"><a class="header" href="#retrieving-property-types">Retrieving Property Types</a></h2>
<p>Properties on a database class have types and can enforce type-based constraints on the data the class allows for its records.  OrientDB uses the <a href="java/ref/OProperty/../OType.html"><code>OType</code></a> class to define the data-types for the property and to provide methods for common operations performed on data-types for the property.</p>
<p>Using this method, you can retrieve the property type.</p>
<h3 id="syntax-142"><a class="header" href="#syntax-142">Syntax</a></h3>
<pre><code>OType OProperty().getType()
</code></pre>
<h4 id="return-type-23"><a class="header" href="#return-type-23">Return Type</a></h4>
<p>This method returns an <a href="java/ref/OProperty/../OType.html"><code>OType</code></a> instance for the type.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oproperty---ismandatory"><a class="header" href="#oproperty---ismandatory">OProperty - isMandatory()</a></h1>
<p>This method determines whether records allow this property to be null.</p>
<h2 id="checking-mandatory"><a class="header" href="#checking-mandatory">Checking Mandatory</a></h2>
<p>When you want to enforce a schema on your database, setting some or all properties to mandatory forces the class to require values set on them.  Using this method, you can check whether the class requires a value set on the property.</p>
<h3 id="syntax-143"><a class="header" href="#syntax-143">Syntax</a></h3>
<pre><code>boolean OProperty().isMandatory()
</code></pre>
<h4 id="return-value-91"><a class="header" href="#return-value-91">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>Boolean</code></a> instance.  If the value is <code>true</code>, it indicates that the property is mandatory and requires all records have a value set on it.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oproperty---isnotnull"><a class="header" href="#oproperty---isnotnull">OProperty - isNotNull()</a></h1>
<p>This method determines whether a property permits <code>null</code> values.</p>
<h2 id="checking-constraints"><a class="header" href="#checking-constraints">Checking Constraints</a></h2>
<p>Properties can enforce a schema on the records you save to OrientDB.  This constraint defines whether the class allows <code>null</code> values for this property.  Using this method, you can determine whether the constraint has been configured for the property.</p>
<h3 id="syntax-144"><a class="header" href="#syntax-144">Syntax</a></h3>
<pre><code>Boolean OProperty().isNotNull()
</code></pre>
<h4 id="return-value-92"><a class="header" href="#return-value-92">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>Boolean</code></a> instance, which if <code>true</code> indicates that the property allows <code>null</code> values.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oproperty---isreadonly"><a class="header" href="#oproperty---isreadonly">OProperty - isReadonly()</a></h1>
<p>This method determines whether you can write to the property.</p>
<h2 id="checking-constraints-1"><a class="header" href="#checking-constraints-1">Checking Constraints</a></h2>
<p>You can enforce a schema on a class by applying constraints to some or all of the properties.  This constraint indicates whether the property allows you to update data.  When it is read only, you can only read data from the property after creating the record.</p>
<h3 id="syntax-145"><a class="header" href="#syntax-145">Syntax</a></h3>
<pre><code>Boolean OProperty().isReadonly()
</code></pre>
<h4 id="return-value-93"><a class="header" href="#return-value-93">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>Boolean</code></a> instance, which if <code>true</code> indicates that the property is currently set to 'read only'.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oproperty---getdefaultvalue-1"><a class="header" href="#oproperty---getdefaultvalue-1">OProperty - getDefaultValue()</a></h1>
<p>This method sets the default value for the given property.</p>
<h2 id="retrieving-default-values-1"><a class="header" href="#retrieving-default-values-1">Retrieving Default Values</a></h2>
<p>Normally, when you create a new record and save it to OrientDB, you define the values set on each property.  In cases where values are not set on each property, the undefined properties defaults to <code>null</code> values.  While this may be sufficient in most cases, you may at times want to have a default value on some properties.</p>
<p>For instance, imagine a class that records student information for a school.  Since each year the majority of new students are added to a particular class, (that is, the current class of incoming freshmen), you might set and each year update the default class for this property, saving yourself time in the long run.</p>
<p>Using this method, you can define the default value for the property.</p>
<h3 id="syntax-146"><a class="header" href="#syntax-146">Syntax</a></h3>
<pre><code>OProperty OProperty().setDefaultValue(String value)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>value</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the value to set</td></tr>
</tbody></table>
</div>
<h4 id="return-value-94"><a class="header" href="#return-value-94">Return Value</a></h4>
<p>This method returns the updated <a href="java/ref/OProperty/../OProperty.html"><code>OProperty</code></a> instance.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oproperty---setlinkedclass"><a class="header" href="#oproperty---setlinkedclass">OProperty - setLinkedClass()</a></h1>
<p>Defines the database class linked to this property.</p>
<h2 id="setting-linked-classes"><a class="header" href="#setting-linked-classes">Setting Linked Classes</a></h2>
<p>Ideally, new properties are created with their corresponding database classes.  For instance, after creating an instance of <a href="java/ref/OProperty/../OClass.html"><code>OClass</code></a> for your database, you would then use the <a href="java/ref/OProperty/../OClass/createProperty.html"><code>createProperty()</code></a> method to instantiate the properties on that class.</p>
<p>In cases where you create the database class and properties separately, you can use this method to link the property to the given class.</p>
<h3 id="syntax-147"><a class="header" href="#syntax-147">Syntax</a></h3>
<pre><code>OProperty OProperty.setLinkedClass(OClass &lt;class&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;class&gt;</code></strong> Defines the database class.</li>
</ul>
<h3 id="return-value-95"><a class="header" href="#return-value-95">Return Value</a></h3>
<p>This method returns the updated <a href="java/ref/OProperty/../OProperty"><code>OProperty</code></a> instance.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oproperty---setlinkedtype"><a class="header" href="#oproperty---setlinkedtype">OProperty - setLinkedType()</a></h1>
<p>Defines the property type.</p>
<h2 id="retrieving-types-1"><a class="header" href="#retrieving-types-1">Retrieving Types</a></h2>
<p>OrientDB enforces typing for properties.  Each property in a database class is set to a particular type, which provide some constraint on the kinds of data set for the property. Using this method you can set the property type.</p>
<h3 id="syntax-148"><a class="header" href="#syntax-148">Syntax</a></h3>
<pre><code>OProperty OProperty.setLinkedType(OType &lt;type&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;type&gt;</code></strong> Defines the <a href="java/ref/OProperty/../OType.html"><code>OType</code></a> instance.</li>
</ul>
<h4 id="return-type-24"><a class="header" href="#return-type-24">Return Type</a></h4>
<p>This method returns an <a href="java/ref/OProperty/../OProperty.html"><code>OProperty</code></a> instance that corresponds to the property type.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oproperty---getmax-2"><a class="header" href="#oproperty---getmax-2">OProperty - getMax()</a></h1>
<p>This method sets the maximum allowed value for the property.</p>
<h2 id="setting-constraints"><a class="header" href="#setting-constraints">Setting Constraints</a></h2>
<p>Properties can enforce constraints on the data you store in them.  This can be limited to the data-type of the stored value.  It can also extend to constraints on the actual data.</p>
<p>OrientDB calculates the maximum allowed values in different ways, depending on what <a href="java/ref/OProperty/../OType.html"><code>OType</code></a> you have set for the property:</p>
<ul>
<li><strong>String</strong> The maximum value is the maximum allowed number of characters.</li>
<li><strong>Number</strong> The maximum value is the largest allowed number.</li>
<li><strong>Date</strong> The maximum value is the latest allowed date.</li>
<li><strong>Time</strong> The maximum value is the latest allowed time, measured in milliseconds.</li>
<li><strong>Binary</strong> The maximum value is the largest allowed size for a byte array.</li>
<li><strong>List</strong>, <strong>Set</strong> or <strong>Collection</strong> The maximum value is largest size of the collection.</li>
</ul>
<p>Using this method, you can set the maximum allowed value for the property.</p>
<h3 id="syntax-149"><a class="header" href="#syntax-149">Syntax</a></h3>
<pre><code>OProperty OProperty().setMax(String max)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>max</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Define the maximum allowed value</td></tr>
</tbody></table>
</div>
<h4 id="return-value-96"><a class="header" href="#return-value-96">Return Value</a></h4>
<p>This method returns the updated <a href="java/ref/OProperty/../OProperty.html"><code>OProperty</code></a> instance.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oproperty---getmax-3"><a class="header" href="#oproperty---getmax-3">OProperty - getMax()</a></h1>
<p>This method sets the minimum allowed value for the property.</p>
<h2 id="retrieving-constraints-2"><a class="header" href="#retrieving-constraints-2">Retrieving Constraints</a></h2>
<p>Properties can enforce constraints on the data you store in them.  This can be limited to the data-type of the stored value.  It can also extend to constraints on the actual data.</p>
<p>OrientDB calculates the minimum allowed values in different ways, depending on what <a href="java/ref/OProperty/../OType.html"><code>OType</code></a> you have set for the property:</p>
<ul>
<li><strong>String</strong> The minimum value is the minimum allowed number of characters.</li>
<li><strong>Number</strong> The minimum value is the smallest allowed number.</li>
<li><strong>Date</strong> The minimum value is the earliest allowed date.</li>
<li><strong>Time</strong> The minimum value is the earliest allowed time, measured in milliseconds.</li>
<li><strong>Binary</strong> The minimum value is the smallest allowed size for a byte array.</li>
<li><strong>List</strong>, <strong>Set</strong> or <strong>Collection</strong> The minimum value is smallest size of the collection.</li>
</ul>
<p>Using this method, you can set the minimum allowed value for the property.</p>
<h3 id="syntax-150"><a class="header" href="#syntax-150">Syntax</a></h3>
<pre><code>OProperty OProperty().setMin(String min)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>min</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the new minimum value</td></tr>
</tbody></table>
</div>
<h4 id="return-value-97"><a class="header" href="#return-value-97">Return Value</a></h4>
<p>This method returns the updated <a href="java/ref/OProperty/../OProperty.html"><code>OProperty</code></a> instance.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oproperty---setname"><a class="header" href="#oproperty---setname">OProperty - setName()</a></h1>
<p>This method defines the name of the property.</p>
<h2 id="retrieving-the-property-name-1"><a class="header" href="#retrieving-the-property-name-1">Retrieving the Property Name</a></h2>
<p>OrientDB differentiates between properties by the property name.  Using this method you can set the name from an <a href="java/ref/OProperty/../OProperty.html"><code>OProperty</code></a> instance.</p>
<h3 id="syntax-151"><a class="header" href="#syntax-151">Syntax</a></h3>
<pre><code>OProperty OProperty().setName(String name)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>name</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the new property name</td></tr>
</tbody></table>
</div>
<h4 id="return-value-98"><a class="header" href="#return-value-98">Return Value</a></h4>
<p>This method returns an updated <code>OProperty</code> instance.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oproperty---settype"><a class="header" href="#oproperty---settype">OProperty - setType()</a></h1>
<p>This method sets the type for the property.</p>
<h2 id="retrieving-property-types-1"><a class="header" href="#retrieving-property-types-1">Retrieving Property Types</a></h2>
<p>Properties on a database class have types and can enforce type-based constraints on the data the class allows for its records.  OrientDB uses the <code>OType</code> class to define the data-types for the property and to provide methods for common operations performed on data-types for the property.</p>
<p>Using this method, you can set the property type.</p>
<h3 id="syntax-152"><a class="header" href="#syntax-152">Syntax</a></h3>
<pre><code>OProperty OProperty().setType(OType type)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>type</code></strong></td><td><a href="java/ref/OProperty/../OType.html"><code>OType</code></a></td><td>Defines the new type for the property</td></tr>
</tbody></table>
</div>
<h4 id="return-type-25"><a class="header" href="#return-type-25">Return Type</a></h4>
<p>This method returns the updated <a href="java/ref/OProperty/../OProperty.html"><code>OProperty</code></a> instance.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orecordoperation"><a class="header" href="#orecordoperation">ORecordOperation</a></h1>
<p>Provides an object for interacting with record operations in a transaction.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oresult-1"><a class="header" href="#oresult-1">OResult</a></h1>
<p>Provides an interface for interacting with records in a result-set.</p>
<h2 id="managing-results"><a class="header" href="#managing-results">Managing Results</a></h2>
<p>Results are the records that OrientDB returns from queries.  You typically get them from the <a href="java/ref/OResultSet.html"><code>OResultSet</code></a> interface.  In order to use <code>OResult</code> you need to import the class into your code.</p>
<pre><code class="language-java">import com.orientechnologies.orient.core.sql.executor.OResult;
</code></pre>
<h2 id="methods-12"><a class="header" href="#methods-12">Methods</a></h2>
<h3 id="typing-results"><a class="header" href="#typing-results">Typing Results</a></h3>
<p><code>OResult</code> provides a series of methods to determine whether the result is of one type or another.  All of these methods return <code>boolean</code> values.</p>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>isBlob()</code></strong></td><td>Returns <code>true</code> if the result is an <code>OBlob</code> instance</td></tr>
<tr><td><strong><code>isEdge()</code></strong></td><td>Returns <code>true</code> if the result is an <a href="java/ref/OEdge.html"><code>OEdge</code></a> instance</td></tr>
<tr><td><strong><code>isElement()</code></strong></td><td>Returns <code>true</code> if the result is an <a href="java/ref/OElement.html"><code>OElement</code></a> instance</td></tr>
<tr><td><strong><code>isRecord()</code></strong></td><td>Returns <code>true</code> if the result is a record</td></tr>
<tr><td><strong><code>isVertex()</code></strong></td><td>Returns <code>true</code> if the result is an <a href="java/ref/OVertex.html"><code>OVertex</code></a> element</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="oresultset"><a class="header" href="#oresultset">OResultSet</a></h1>
<p>This class provides an interface for operating on data returned by OrientDB queries and commands.</p>
<h2 id="managing-result-sets"><a class="header" href="#managing-result-sets">Managing Result-sets</a></h2>
<p>Whenever you issue a query or command to an OrientDB database, (through the <a href="java/ref/ODatabaseDocument.html"><code>ODatabaseDocument</code></a> class, for instance), OrientDB returns results as an <code>OResultSet</code> instance.  You can then operate on this instance to retrieve data or further process it before returning it to the user.</p>
<p>To use <code>OResultSet</code>, you need to import it to your code.</p>
<pre><code class="language-java">import com.orientechnologies.orient.core.sql.executor.OResultSet;
</code></pre>
<p>Once you've imported it, you can set variables with this class and retrieve results.</p>
<h3 id="example-67"><a class="header" href="#example-67">Example</a></h3>
<pre><code class="language-java">private ODatabaseDocument db;
...

// Return Count of Accounts 
public long fetchAccountCount(){

	// Fetch Data
	OResultSet data = db.query("SELECT FROM Accounts");

	return data.elementStream().count();
}
</code></pre>
<h2 id="methods-13"><a class="header" href="#methods-13">Methods</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Return Type</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="java/ref/OResultSet/close.html"><code>close()</code></a></td><td><code>void</code></td><td>Closes the result-set</td></tr>
<tr><td><a href="java/ref/OResultSet/edgeStream.html"><code>edgeStream</code></a></td><td><a href="https://docs.oracle.com/javase/8/docs/java/util/Stream.html"><code>Stream</code></a><a href="java/ref/OEdge.html"><code>&lt;OEdge&gt;</code></a></td><td>Returns a stream of edges from the result-set</td></tr>
<tr><td><a href="java/ref/OResultSet/elementStream.html"><code>elementStream()</code></a></td><td><a href="https://docs.oracle.com/javase/8/docs/java/util/Stream.html"><code>Stream</code></a><a href="java/ref/OElement.html"><code>&lt;OElement&gt;</code></a></td><td>Returns a stream of elements from the result-set</td></tr>
<tr><td><a href="java/ref/OResultSet/estimateSize.html"><code>estimateSize()</code></a></td><td><code>long</code></td><td>Estimates the number of records in the result-set</td></tr>
<tr><td><a href="java/ref/OResultSet/hasNext.html"><code>hasNext()</code></a></td><td><code>boolean</code></td><td>Determines whether the <code>Iterator</code> contains additional values</td></tr>
<tr><td><a href="java/ref/OResultSet/next.html"><code>next()</code></a></td><td><a href="java/ref/OResult.html"><code>OResult</code></a></td><td>Returns the next result in the result-set</td></tr>
<tr><td><a href="java/ref/OResultSet/remove.html"><code>remove()</code></a></td><td><code>void</code></td><td>Removes the last value returned by the <code>Iterator</code></td></tr>
<tr><td><a href="java/ref/OResultSet/stream.html"><code>stream()</code></a></td><td><a href="https://docs.oracle.com/javase/8/docs/java/util/Stream.html"><code>Stream</code></a><a href="java/ref/OResult.html"><code>&lt;OResult&gt;</code></a></td><td>Streams the results in the result-set</td></tr>
<tr><td><a href="java/ref/OResultSet/vertexStream.html"><code>vertexStream()</code></a></td><td><a href="https://docs.oracle.com/javase/8/docs/java/util/Stream.html"><code>Stream</code></a><a href="java/ref/OVertex.html"><code>&lt;OVertex&gt;</code></a></td><td>Streams vertices from the result-set</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="oresultset---close"><a class="header" href="#oresultset---close">OResultSet - close()</a></h1>
<p>Closes the result-set.</p>
<h2 id="closing-result-sets"><a class="header" href="#closing-result-sets">Closing Result-sets</a></h2>
<p>When you're finished using an <a href="java/ref/OResultSet/../OResultSet.html"><code>OResultSet</code></a> instance, close it to free up resources for other operations.</p>
<h3 id="syntax-153"><a class="header" href="#syntax-153">Syntax</a></h3>
<pre><code>void OResultSet().close()
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oresultset---edgestream"><a class="header" href="#oresultset---edgestream">OResultSet - edgeStream()</a></h1>
<p>Retrieves a stream of edges from the result-set.</p>
<h2 id="streaming-edges"><a class="header" href="#streaming-edges">Streaming Edges</a></h2>
<p>In cases where your result-set contains a number of elements, some of which are vertices and some of which are edges, you can use this method to filter <a href="java/ref/OResultSet/../OResultSet.html"><code>OResultSet</code></a> to only return those records that are <a href="java/ref/OResultSet/../OEdge.html"><code>OEdge</code></a> instances.</p>
<h3 id="syntax-154"><a class="header" href="#syntax-154">Syntax</a></h3>
<pre><code>default Stream&lt;OEdge&gt; OResultSet().edgeStream()
</code></pre>
<h4 id="return-value-99"><a class="header" href="#return-value-99">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/java/util/Stream.html"><code>Stream</code></a> of <a href="java/ref/OResultSet/../OEdge.html"><code>OEdge</code></a> instances contained in the result-set.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oresultset---elementstream"><a class="header" href="#oresultset---elementstream">OResultSet - elementStream()</a></h1>
<p>Retrieves a stream of elements from the result-set.</p>
<h2 id="streaming-edges-1"><a class="header" href="#streaming-edges-1">Streaming Edges</a></h2>
<p>In cases where your result-set contains a number of elements, some of which are vertices and some of which are edges, you can use this method to filter <a href="java/ref/OResultSet/../OResultSet.html"><code>OResultSet</code></a> to only return those records that are <a href="java/ref/OResultSet/../OElement.html"><code>OElement</code></a> instances.</p>
<h3 id="syntax-155"><a class="header" href="#syntax-155">Syntax</a></h3>
<pre><code>default Stream&lt;OElement&gt; OResultSet().elementStream()
</code></pre>
<h4 id="return-value-100"><a class="header" href="#return-value-100">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/java/util/Stream.html"><code>Stream</code></a> of <a href="java/ref/OResultSet/../OElement.html"><code>OElement</code></a> instances contained in the result-set.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oresultset---estimatesize"><a class="header" href="#oresultset---estimatesize">OResultSet - estimateSize()</a></h1>
<p>Estimates the size of the result-set.</p>
<h2 id="size-estimates"><a class="header" href="#size-estimates">Size Estimates</a></h2>
<p>Using this method you can estimate the number of records contained in this instance of <a href="java/ref/OResultSet/../OResultSet.html"><code>OResultSet</code></a>.</p>
<h3 id="syntax-156"><a class="header" href="#syntax-156">Syntax</a></h3>
<pre><code>default long OResultSet().estimateSize()
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oresultset---hasnext"><a class="header" href="#oresultset---hasnext">OResultSet - hasNext()</a></h1>
<p>Determines whether the result-set contains any additional values.</p>
<h2 id="iterating-through-result-sets"><a class="header" href="#iterating-through-result-sets">Iterating through Result-sets</a></h2>
<p>Using this method you can determine whether any results remain in the result-set.  It is useful to check before calling operators like <a href="java/ref/OResultSet/next.html"><code>next()</code></a> or <a href="java/ref/OResultSet/remove.html"><code>remove()</code></a>.</p>
<h3 id="syntax-157"><a class="header" href="#syntax-157">Syntax</a></h3>
<pre><code>boolean OResultSet().hasNext()
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oresultset---next"><a class="header" href="#oresultset---next">OResultSet - next()</a></h1>
<p>Returns the next result in the result-set.</p>
<h2 id="retrieving-results"><a class="header" href="#retrieving-results">Retrieving Results</a></h2>
<p>When iterating through an <a href="java/ref/OResultSet/../OResultSet.html"><code>OResultSet</code></a> instance, you can use the <code>next()</code> method to retrieve the next <a href="java/ref/OResultSet/../OResult.html"><code>OResult</code></a> instance in the iterator.</p>
<h3 id="syntax-158"><a class="header" href="#syntax-158">Syntax</a></h3>
<pre><code>OResult OResultSet().next()
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oresultset---remove"><a class="header" href="#oresultset---remove">OResultSet - remove()</a></h1>
<p>Removes the next element from the result-set.</p>
<h2 id="removing-elements"><a class="header" href="#removing-elements">Removing Elements</a></h2>
<p>Using this method you can remove a record from the result-set.  Specifically, this method calls the <code>remove()</code> method on the underlying <a href="https://docs.oracle.com/javase/8/docs/java/util/Iterator.html"><code>Iterator</code></a><a href="java/ref/OResultSet/../OResult.html"><code>&lt;OResult&gt;</code></a> instance.  Doing so removes the last element returned by the iterator from a <a href="java/ref/OResultSet/next.html"><code>next()</code></a> call.</p>
<h3 id="syntax-159"><a class="header" href="#syntax-159">Syntax</a></h3>
<pre><code>default void OResultSet().remove()
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oresultset---stream"><a class="header" href="#oresultset---stream">OResultSet - stream()</a></h1>
<p>Streams records in the result-set.</p>
<h2 id="streaming-records"><a class="header" href="#streaming-records">Streaming Records</a></h2>
<p>When you want to operate on all records in the result-set in a <a href="https://docs.oracle.com/javase/8/docs/java/util/stream/Stream.html"><code>Stream</code></a>, you can do so using this method.</p>
<h3 id="syntax-160"><a class="header" href="#syntax-160">Syntax</a></h3>
<pre><code>Stream&lt;OResult&gt; OResultSet().stream()
</code></pre>
<h4 id="return-value-101"><a class="header" href="#return-value-101">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/java/util/stream/Stream.html"><code>Stream</code></a><a href="java/ref/OResultSet/../OResult.html"><code>&lt;OResult&gt;</code></a> instance representing the results in the result-set.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oresultset---vertexstream"><a class="header" href="#oresultset---vertexstream">OResultSet - vertexStream()</a></h1>
<p>Retrieves a stream of vertices from the result-set.</p>
<h2 id="retrieving-vertices-2"><a class="header" href="#retrieving-vertices-2">Retrieving Vertices</a></h2>
<p>When you have a result-set that contains elements, vertices and edges all together and only want the vertices, you can use this method to filter them out.  It returns a stream of <a href="java/ref/OResultSet/../OVertex.html"><code>OVertex</code></a> instances from the result-set.</p>
<h3 id="syntax-161"><a class="header" href="#syntax-161">Syntax</a></h3>
<pre><code>Stream&lt;OVertex&gt; OResultSet().vertexStream()
</code></pre>
<h4 id="return-value-102"><a class="header" href="#return-value-102">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/java/util/stream/Stream.html"><code>Stream</code></a><a href="java/ref/OResultSet/../OVertex.html"><code>&lt;OVertex&gt;</code></a> instance representing the results in the result-set.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orid"><a class="header" href="#orid">ORID</a></h1>
<p>This class provides the Record ID for a particular <a href="java/ref/OElement.html"><code>OElement</code></a>, <a href="java/ref/OVertex.html"><code>OVertex</code></a>, or <a href="java/ref/OEdge.html"><code>OEdge</code></a> instance.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="java-api---orientdb"><a class="header" href="#java-api---orientdb">Java API - OrientDB</a></h1>
<p>This class provides a management environment between your application and the OrientDB Server.</p>
<h2 id="managing-servers"><a class="header" href="#managing-servers">Managing Servers</a></h2>
<p>In order to operate on an OrientDB database, you first need to establish a connection with the server.  You have two options in this: you can embed the server within your application using the <a href="java/ref/OServer.html"><code>OServer</code></a> class or you can connect to a running server using this class.  It can be found at <code>com.orientechnologies.orient.core.db</code>.  For instance,</p>
<pre><code class="language-java">import com.orientechnologies.orient.core.db.OrientDB;
</code></pre>
<p>Once you've imported the class to your application, you can use one of the constructors to build a particular instance in your code.</p>
<h3 id="constructors"><a class="header" href="#constructors">Constructors</a></h3>
<p>This class provides two constructors to create instances of <code>OrientDB</code> in your application.</p>
<pre><code>// CONSTRUCTOR 1
OrientDB(String url, OrientDBConfig config)

// CONSTRUCTOR 2
OrientDB(String url, String serverUser, 
      String serverPasswd, OrientDBConfig config)
</code></pre>
<ul>
<li><strong><code>url</code></strong> Defines the database URL, as a string.  It supports embedded and remote URL's.</li>
<li><strong><code>config</code></strong> Defines the database config, as an <code>OrientDBConfig</code> instance.</li>
<li><strong><code>serverUser</code></strong> Defines the user name.</li>
<li><strong><code>serverPasswd</code></strong> Defines the user password.</li>
</ul>
<h3 id="example-68"><a class="header" href="#example-68">Example</a></h3>
<p>Using this class you can create a new OrientDB instance in your application, which you can then use to operate on multiple databases on the connected server.  This class supports two types of connections: embedded and remote.  With embedded connections, you're connecting to an instance running on your current machine.  With remote connections, you're using the remote port to connect to a server either running on localhost or a remote IP address.</p>
<p>For instance, creating a database on a remote host:</p>
<pre><code class="language-java">OrientDB orientdb = new OrientDB("remote:191.168.1.100", "root", "root_passwd");
orientdb.create("musicdb", ODatabaseType.PLOCAL);
ODatabaseDocument session = orientdb.open("musicdb", "admin", "admin");
...

session.close();
orientdb.close();
</code></pre>
<p>Alternatively, you could connect to an embedded host:</p>
<pre><code class="language-java">OrientDB orientdb = new OrientDB("embedded:./databases/", null, null);
orientdb.create("musicdb", ODatabaseType.MEMORY);
ODatabaseDocument session = orientdb.open("musicdb", "admin", "admin");
...

session.close();
orientdb.close();
</code></pre>
<h2 id="methods-14"><a class="header" href="#methods-14">Methods</a></h2>
<p>Once you've instantiated the class in your application, you can call the following methods on it to perform further operations.</p>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Return Type</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="java/ref/OrientDB.html#closing-databases"><strong><code>close()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Void.html"><code>void</code></a></td><td>Closes the current context with all related databases and pools.</td></tr>
<tr><td><a href="java/ref/OrientDB/create.html"><strong><code>create()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Void.html"><code>void</code></a></td><td>Creates a new database.</td></tr>
<tr><td><a href="java/ref/OrientDB/createIfNotExists.html"><strong><code>createIfNotExists()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>boolean</code></a></td><td>Creates a new database if it doesn't exist.</td></tr>
<tr><td><a href="java/ref/OrientDB/drop.html"><strong><code>drop()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Void.html"><code>void</code></a></td><td>Removes a database from the server.</td></tr>
<tr><td><a href="java/ref/OrientDB/exists.html"><strong><code>exists()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>boolean</code></a></td><td>Checks whether database exists.</td></tr>
<tr><td><a href="java/ref/OrientDB/list.html"><strong><code>list()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/List.html"><code>List&lt;</code></a> <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String&gt;</code></a></td><td>Returns a list of databases on the server</td></tr>
<tr><td><a href="java/ref/OrientDB/open.html"><strong><code>open()</code></strong></a></td><td><a href="java/ref/ODatabaseDocument.html"><code>ODatabaseDocument</code></a></td><td>Opens and returns a Document database.</td></tr>
</tbody></table>
</div>
<h4 id="closing-databases-1"><a class="header" href="#closing-databases-1">Closing Databases</a></h4>
<p>When you've finished operating on a database or server, you can close the current context with all related databases and pools using the <code>close()</code> method.  For instance,</p>
<pre><code class="language-java">// OPEN DOCUMENT DATABASE
OrientDB orientdb =  new OrientDB("embedded:/tmp/", OrientDBConfig.defaultConfig());

try(ODatabaseDocumentTx db = orientdb.open("test", "admin", "admin");) {

	// Enter your code here
	...

} finally { 

   // CLOSE DATABASE
   orientdb.close();
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb---create"><a class="header" href="#orientdb---create">OrientDB - create()</a></h1>
<p>This method lets you create a new database on the connected OrientDB Server.</p>
<h2 id="creating-databases"><a class="header" href="#creating-databases">Creating Databases</a></h2>
<p>Using this method, you can create new databases on the OrientDB Server.  In the event that you want to connect to an existing database, use the <a href="java/ref/OrientDB/open.html"><code>open()</code></a> method.  If you want to only create the database if it does not exist already, use the <a href="java/ref/OrientDB/createIfNotExists.html"><code>createIfNotExists()</code></a> method.</p>
<h3 id="syntax-162"><a class="header" href="#syntax-162">Syntax</a></h3>
<p>There are two methods available in creating databases (<code>OrientDB</code> class):</p>
<pre><code>// METHOD 1
public void create(String name, ODatabaseType type)

// METHOD 2
public void create(String name, ODatabaseType type, OrientDBConfig config)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>name</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>java.lang.String</code></a></td><td>Defines the database name</td></tr>
<tr><td><strong><code>type</code></strong></td><td><code>ODatabaseType</code></td><td>Defines the database type, can be PLocal or in-memory</td></tr>
<tr><td><strong><code>config</code></strong></td><td><code>OrientDBConfig</code></td><td>Defines the database configuration</td></tr>
</tbody></table>
</div>
<h3 id="example-69"><a class="header" href="#example-69">Example</a></h3>
<p>Consider the use case of an installation process for your application.  The user needs an embedded OrientDB database installed on their system whenever they start a new project in your application.  You might use a method like the one below to initialize the database and perform any other routine tasks needed whenever they create a new project.</p>
<pre><code class="language-java">private OrientDB orientdb = new OrientDB("embedded:/data", null, null);

// START NEW PROJECT
public void createNewProject(String name){

	// Create Project Name
	String db = "project-" + name;

	// Create Database
	orientdb.create(db, ODatabaseType.PLOCAL);
		
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb---createifnotexists"><a class="header" href="#orientdb---createifnotexists">OrientDB - createIfNotExists()</a></h1>
<p>This method creates a new database on the OrientDB Server.  If the database already exists on the server, it does nothing.</p>
<h2 id="creating-databases-1"><a class="header" href="#creating-databases-1">Creating Databases</a></h2>
<p>On occasion you may have several processes operating on a given OrientDB Server and not know for certain whether the given database exists already on the server.  This method allows you to ensure that a given database exists before you attempt further operations.</p>
<h3 id="syntax-163"><a class="header" href="#syntax-163">Syntax</a></h3>
<p>There are two methods available in performing this operation:</p>
<pre><code>// METHOD 1
public boolean OrientDB().createIfNotExists(
      String name, ODatabaseType type)

// METHOD 2
public boolean OrientDB().createIfNotExists(
      String name, ODatabaseType type,
	  OrientDBConfig config)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>name</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>java.lang.String</code></a></td><td>Defines the database name</td></tr>
<tr><td><strong><code>type</code></strong></td><td><code>ODatabaseType</code></td><td>Defines the database type, (PLocal or in-memory)</td></tr>
<tr><td><strong><code>config</code></strong></td><td><code>OrientDBConfig</code></td><td>defines the database configuration</td></tr>
</tbody></table>
</div>
<h4 id="return-value-103"><a class="header" href="#return-value-103">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>boolean</code></a> value.  If the return value is <code>true</code>, it indicates that it has created a new database.  If the return value is <code>false</code>, it indicates that a database of that name already exists on the server.</p>
<h3 id="example-70"><a class="header" href="#example-70">Example</a></h3>
<p>In the event that you need to create a database before attempting further operations, you might want to use this method to avoid conflict in the event that the database already exists on your OrientDB Server.  Then, in the event that the database does already exist, you can log the finding for debugging purposes later.</p>
<pre><code class="language-java">// INITIALIZE VARIABLES 
private static final Logger logger = Logger.getLogger(App.class.getName());
private OrientDB orientdb;

// CREATE DATABASE METHOD
public void createDatabase(String name){

	// Log Operation
	logger.info("Creating Database: " + name);

	// Create Database
	Boolean dbExists = orientdb.createIfNotExists(name, ODatabaseType.PLOCAL);

	if (dbExists) { 
		logger.debug("Database Created");
	} else {
	    logger.debug("Database Already Exists");
	}
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb---drop"><a class="header" href="#orientdb---drop">OrientDB - drop()</a></h1>
<p>This method removes a database from the OrientDB Server.</p>
<h2 id="dropping-databases"><a class="header" href="#dropping-databases">Dropping Databases</a></h2>
<p>On occasion, you may need to remove databases from within your application.  For instance, as part of a maintenance application, or to remove temporary in-memory databases when they're no longer needed.</p>
<h3 id="syntax-164"><a class="header" href="#syntax-164">Syntax</a></h3>
<pre><code>public void OrientDB().drop(String name)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>name</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>java.lang.String</code></a></td><td>Defines the database name</td></tr>
</tbody></table>
</div>
<h3 id="example-71"><a class="header" href="#example-71">Example</a></h3>
<p>Imagine an application that makes use of in-memory databases to perform complex operations.  Whenever you need one for a specific task, you create it, run the process, then remove the database once the job is complete.</p>
<pre><code class="language-java">
public void runInMemOperation(String name){

	// Log Operation
	logger.info("Creating In-Memory Database");

	orientdb.create(name, ODatabaseType.MEMORY);

	try {
	   // Your Code Here
	   ...

    } finally {
       // Remove Database When Done
	   orientdb.drop(name);

   }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb---exists"><a class="header" href="#orientdb---exists">OrientDB - exists()</a></h1>
<p>This method determines whether a database exists on the OrientDB Server.</p>
<h2 id="checking-databases"><a class="header" href="#checking-databases">Checking Databases</a></h2>
<p>In situations where your application is one of several connecting to a given OrientDB Server, you may find it useful to check whether a database exists before attempting to open or operate on it.  This method checks if the OrientDB Server has a database of the given name available.</p>
<h3 id="syntax-165"><a class="header" href="#syntax-165">Syntax</a></h3>
<pre><code>public boolean OrientDB().exists(String name)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>name</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>java.lang.String</code></a></td><td>Defines the database name</td></tr>
</tbody></table>
</div>
<h4 id="return-value-104"><a class="header" href="#return-value-104">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>boolean</code></a> value.  If the return value is <code>true</code>, it indicates that a database of that name exists on the OrientDB Server.  If the return value is <code>false</code>, it indicates that a database of that name does not exist on the server.</p>
<h3 id="example-72"><a class="header" href="#example-72">Example</a></h3>
<p>Consider the use case of an application that uses multiple in-memory databases for short-term operations.  Whenever you call the method to create the database, you want a new database.  If the OrientDB Server already contains a database of that name, you want to increment the name and start fresh.</p>
<pre><code class="language-java">private OrientDB orientdb;

// Create New In-Memory Database
public ODatabaseDocumentTx createDatabase(String name){

   // Check If Database Exists
   if (orientdb.exists(name){
      name = name + "1";
   }

   // Create Database
   orientdb.create(name, ODatabaseType.MEMORY);

   // Return Opened Database
   return orientdb.open(name, "admin", "admin");

}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb---list"><a class="header" href="#orientdb---list">OrientDB - list()</a></h1>
<p>This method returns a list of databases on the OrientDB Server.</p>
<h2 id="listing-databases"><a class="header" href="#listing-databases">Listing Databases</a></h2>
<p>Occasionally, you may want to read or operating on every database in an OrientDB Server.  This method returns a list of string values giving the name for each database on the server.  You can then log the list for debugging or pass the name to other methods to perform further operations.</p>
<h3 id="syntax-166"><a class="header" href="#syntax-166">Syntax</a></h3>
<pre><code>public List&lt;String&gt; OrientDB().list()
</code></pre>
<h4 id="return-value-105"><a class="header" href="#return-value-105">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/List.html"><code>List</code></a> of <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a> values.  Each element in the list provides the name of a database found on the OrientDB Server.</p>
<h3 id="example-73"><a class="header" href="#example-73">Example</a></h3>
<p>Default login credentials for an OrientDB database uses the user <code>admin</code> with the password <code>admin</code>.  Given that this is not a good security practice for production instance, you might want a method that checks each database on the OrientDB Server for default credentials and reports the issue to logs.</p>
<pre><code class="language-java">private OrientDB orientdb;
private Logger logger;
...

// Check for Default Credentials
public void checkDbCredentials(){

   // Init Variables 
   List&lt;String&gt; reportList;
   List&lt;String&gt; dbs = orientdb.list();

   for (int i = 0; i &lt; dbs.size(); i++){

      // Get Database Name
      String name = dbs.get(i);	

	  // Check Credentials
	  try {

	     // Open Database
         ODatabaseDocumentTx db = orientdb.open(name, "admin", "admin");

		 // Check If Open
		 if (db.isOpen()) {
            reportList.add(name);
		 }

	  } finally {
	     // Close Database
		 db.close();

	  }

   }

   // Report Default Logins to Log
   if (reportList.size() &gt; 0){

      logger.warn("Databases Found with Default Credentials: " +
	     String.join(", ", reportList);

   }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb---open"><a class="header" href="#orientdb---open">OrientDB - open()</a></h1>
<p>This method opens the given database on the OrientDB Server.</p>
<h2 id="opening-databases"><a class="header" href="#opening-databases">Opening Databases</a></h2>
<p>The <a href="java/ref/OrientDB/../OrientDB.html"><code>OrientDB</code></a> class allows you to operate on an OrientDB Server, but eventually you're going to want to start working with an actual database.  This method allows you to open a Document database on the server.</p>
<h3 id="syntax-167"><a class="header" href="#syntax-167">Syntax</a></h3>
<p>There are two methods available to use in opening databases:</p>
<pre><code>// METHOD 1
public ODatabaseDocument OrientDB().open(String name, String user, 
   String passwd)

// METHOD 2
public ODatabaseDocument OrientDB().open(String name, String user,
   String passwd, OrientDBConfig config)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>name</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the database name</td></tr>
<tr><td><strong><code>user</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the database user</td></tr>
<tr><td><strong><code>passwd</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the user password</td></tr>
</tbody></table>
</div>
<h4 id="return-value-106"><a class="header" href="#return-value-106">Return Value</a></h4>
<p>Both methods return an <a href="java/ref/OrientDB/../ODatabaseDocument.html"><code>ODatabaseDocument</code></a> instance.</p>
<h3 id="example-74"><a class="header" href="#example-74">Example</a></h3>
<p>Imagine the use case of an application to operates on several databases that share common login credentials.  You might create a management class to streamline database access within your code.</p>
<pre><code class="language-java">// INITIALIZE VARIABLES
private String rootUser;
private String rootPasswd;
private String baseUser;
private String basePasswd;
private OrientDB orientdb;
...

// OPEN DATABASE
public ODatabaseDocument openDb(String name, Boolean asRoot){

   // Log Operation
   logger.info("Opening Database: " + name);

   // Initialize Variables
   String user;
   String passwd;

   if (asRoot){
      user = rootUser;
	  passwd = rootPasswd;

   } else { 
      user = baseUser;
	  passwd = basePasswd;
   }

   // Open and Return Database
   return orientdb.open(name, user, passwd);

}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orule"><a class="header" href="#orule">ORule</a></h1>
<p>Provides an interface for defines resources and account access to them.</p>
<h2 id="using-rules"><a class="header" href="#using-rules">Using Rules</a></h2>
<p>To use <code>ORule</code>, first import it to your application.</p>
<pre><code class="language-java">import com.orientechnologies.orient.core.metadata.security.ORule;
</code></pre>
<h3 id="resources-2"><a class="header" href="#resources-2">Resources</a></h3>
<p><code>ORule</code> contains a nested subclass <code>ORule.ResourceGeneric</code> that defines the specific resource that the rule grants access to.</p>
<ul>
<li><strong><code>BYPASS_RESTRICTED</code></strong></li>
<li><strong><code>CLASS</code></strong></li>
<li><strong><code>CLUSTER</code></strong></li>
<li><strong><code>COMMAND</code></strong></li>
<li><strong><code>COMMAND_GREMLIN</code></strong></li>
<li><strong><code>DATABASE</code></strong></li>
<li><strong><code>DATABASE_COPY</code></strong></li>
<li><strong><code>DATABASE_CREATE</code></strong></li>
<li><strong><code>DATABASE_DROP</code></strong></li>
<li><strong><code>DATABASE_EXISTS</code></strong></li>
<li><strong><code>DATABASE_FREEZE</code></strong></li>
<li><strong><code>DATABASE_PASSTHROUGH</code></strong></li>
<li><strong><code>DATABASE_RELEASE</code></strong></li>
<li><strong><code>FUNCTION</code></strong></li>
<li><strong><code>RECORD_HOOK</code></strong></li>
<li><strong><code>SCHEMA</code></strong></li>
<li><strong><code>SERVER</code></strong></li>
<li><strong><code>SYSTEM_CLUSTERS</code></strong></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="java-api---oschema"><a class="header" href="#java-api---oschema">Java API - OSchema</a></h1>
<p>Provides an interface for operating on schemas in OrientDB.</p>
<h2 id="working-with-schemas"><a class="header" href="#working-with-schemas">Working with Schemas</a></h2>
<p>In order to operate on schemas in your Java application, you first need to import it.</p>
<pre><code class="language-java">import com.orientechnologies.orient.core.db.OSchema;
</code></pre>
<h3 id="methods-15"><a class="header" href="#methods-15">Methods</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Return Type</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="java/ref/OSchema/createClass.html"><strong><code>createClass()</code></strong></a></td><td><code>int</code></td><td>Counts the number of classes associated with the schema</td></tr>
<tr><td><a href="java/ref/OSchema/createAbstractClass.html"><strong><code>createAbstractClass()</code></strong></a></td><td><a href="java/ref/OClass.html"><code>OClass</code></a></td><td>Creates an abstract class in the schema</td></tr>
<tr><td><a href="java/ref/OSchema/createClass.html"><strong><code>createClass()</code></strong></a></td><td><a href="java/ref/OClass.html"><code>OClass</code></a></td><td>Creates a class in the schema</td></tr>
<tr><td><a href="java/ref/OSchema/dropClass.html"><strong><code>dropClass()</code></strong></a></td><td><code>void</code></td><td>Removes a class from the schema</td></tr>
<tr><td><a href="java/ref/OSchema/existsClass.html"><strong><code>existsClass()</code></strong></a></td><td><code>boolean</code></td><td>Checks whether the class exists in the schema</td></tr>
<tr><td><a href="java/ref/OSchema/getClass.html"><strong><code>getClass()</code></strong></a></td><td><a href="java/ref/OClass.html"><code>OClass</code></a></td><td>Retrieves class from the schema</td></tr>
<tr><td><a href="java/ref/OSchema/getClassByClusterId.html"><strong><code>getClassByClusterId()</code></strong></a></td><td><a href="java/ref/OClass.html"><code>OClass</code></a></td><td>Retrieves class by associated Cluster ID</td></tr>
<tr><td><a href="java/ref/OSchema/getClasses.html"><strong><code>getClasses()</code></strong></a></td><td><a href="java/ref/OClass.html"><code>Set&lt;OClass&gt;</code></a></td><td>Retrieves all classes associated with schema</td></tr>
<tr><td><a href="java/ref/OSchema/getClassesRelyOnCluster.html"><strong><code>getClassesRelyOnCluster()</code></strong></a></td><td><a href="java/ref/OClass.html"><code>Set&lt;OClass&gt;</code></a></td><td>Retrieves all classes associated with the given cluster</td></tr>
<tr><td><a href="java/ref/OSchema/getOrCreateClass.html"><strong><code>getOrCreateClass()</code></strong></a></td><td><a href="java/ref/OClass.html"><code>OClass</code></a></td><td>Retrieves class from the schema and create the class if it does not already exist</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="oschema---countclasses"><a class="header" href="#oschema---countclasses">OSchema - countClasses()</a></h1>
<p>Returns the number of classes in the schema.</p>
<h2 id="classes-4"><a class="header" href="#classes-4">Classes</a></h2>
<p>OrientDB has the concept of class within the database, as defined by an <a href="java/ref/OSchema/../OClass.html"><code>OClass</code></a> instance.  Using this method, you can retrieve the number of classes created in the given schema.</p>
<h3 id="syntax-168"><a class="header" href="#syntax-168">Syntax</a></h3>
<pre><code>int OSchema().countClasses()
</code></pre>
<h4 id="return-type-26"><a class="header" href="#return-type-26">Return Type</a></h4>
<p>This method returns an <code>int</code> instance, with a value representing the number of <a href="java/ref/OSchema/../OClass.html"><code>OClass</code></a> instances created on the schema.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oschema---createabstractclass"><a class="header" href="#oschema---createabstractclass">OSchema - createAbstractClass()</a></h1>
<p>Creates a new class in the schema.</p>
<h2 id="creating-classes-1"><a class="header" href="#creating-classes-1">Creating Classes</a></h2>
<p>OrientDB has the concept of class within the database, which represents a broad grouping of records, similar to the table in relational contexts.  Internally, OrientDB represents a class as an <a href="java/ref/OSchema/../OClass.html"><code>OClass</code></a> instance.  Using this method you can create a new class in the schema.  Database classes are also polymorphic, you can assign an existing class as a superclass to the new class.</p>
<h3 id="syntax-169"><a class="header" href="#syntax-169">Syntax</a></h3>
<pre><code>OClass OSchema().createAbstractClass(String class)

OClass OSchema().createAbstractClass(String class, OClass superClass)

OClass OSchema().createAbstractClass(
   String class, OClass superClass, OClass superclass ...)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>class</code></strong></td><td><code>String</code></td><td>Defines the name of the new database class</td></tr>
<tr><td><strong><code>superClass</code></strong></td><td><a href="java/ref/OSchema/../OClass.html"><code>OClass</code></a></td><td>Defines superclass</td></tr>
</tbody></table>
</div>
<h4 id="return-type-27"><a class="header" href="#return-type-27">Return Type</a></h4>
<p>This method returns the newly created <a href="java/ref/OSchema/../OClass.html"><code>OClass</code></a> instance.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oschema---createclass"><a class="header" href="#oschema---createclass">OSchema - createClass()</a></h1>
<p>Creates a new class in the schema.</p>
<h2 id="creating-classes-2"><a class="header" href="#creating-classes-2">Creating Classes</a></h2>
<p>OrientDB has the concept of class within the database, which represents a broad grouping of records, similar to the table in relational contexts.  Internally, OrientDB represents a class as an <a href="java/ref/OSchema/../OClass.html"><code>OClass</code></a> instance.  Using this method you can create a new class in the schema.  Database classes are also polymorphic, you can assign an existing class as a superclass to the new class.</p>
<h3 id="syntax-170"><a class="header" href="#syntax-170">Syntax</a></h3>
<pre><code>OClass OSchema().createClass(String class)

OClass OSchema().createClass(String class, OClass... superclasses)

OClass OSchema().createClass(String class, int[] clusterIds, OClass... superClasses)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>class</code></strong></td><td><code>String</code></td><td>Defines the name of the new database class</td></tr>
<tr><td><strong><code>superClasses</code></strong></td><td><a href="java/ref/OSchema/../OClass.html"><code>OClass</code></a></td><td>Defines superclass</td></tr>
<tr><td><strong><code>clusterIds</code></strong></td><td><code>int[]</code></td><td>Defines the Cluster ID's for clusters you want the class to use</td></tr>
</tbody></table>
</div>
<h4 id="return-type-28"><a class="header" href="#return-type-28">Return Type</a></h4>
<p>This method returns the newly created <a href="java/ref/OSchema/../OClass.html"><code>OClass</code></a> instance.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oschema---dropclass"><a class="header" href="#oschema---dropclass">OSchema - dropClass()</a></h1>
<p>Removes class from the schema.</p>
<h2 id="removing-classes"><a class="header" href="#removing-classes">Removing Classes</a></h2>
<p>OrientDB has the concept of class within the database, which represents a broad grouping of records, similar to the table in relational contexts.  Internally, OrientDB represents a class as an <a href="java/ref/OSchema/../OClass.html"><code>OClass</code></a> instance.  Using this method, you can remove the given class from the schema.</p>
<h3 id="syntax-171"><a class="header" href="#syntax-171">Syntax</a></h3>
<pre><code>void OSchema().dropClass(String class)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>class</code></strong></td><td><code>String</code></td><td>Defines name of class you want to remove</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="oschema---existsclass"><a class="header" href="#oschema---existsclass">OSchema - existsClass()</a></h1>
<p>Checks whether the given class exists in the schema.</p>
<h2 id="checking-class-existence"><a class="header" href="#checking-class-existence">Checking Class Existence</a></h2>
<p>OrientDB has the concept of class within the database, which represents a broad grouping of records, similar to the table in relational contexts.  Internally, OrientDB represents a class as an <a href="java/ref/OSchema/../OClass.html"><code>OClass</code></a> instance.   Using this method you can check whether the given class exists in the schema.</p>
<h3 id="syntax-172"><a class="header" href="#syntax-172">Syntax</a></h3>
<pre><code>boolean OSchema().existsClass(String class)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>class</code></strong></td><td><code>String</code></td><td>Defines name of class you want to check</td></tr>
</tbody></table>
</div>
<h4 id="return-type-29"><a class="header" href="#return-type-29">Return Type</a></h4>
<p>This method returns a <code>boolean</code> instance.  A value of <code>true</code> indicates that the given class exists in the schema.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oschema---getclass"><a class="header" href="#oschema---getclass">OSchema - getClass()</a></h1>
<p>Retrieves the class from the schema.</p>
<h2 id="getting-classes"><a class="header" href="#getting-classes">Getting Classes</a></h2>
<p>OrientDB has the concept of class within the database, which represents a broad grouping of records, similar to the table in relational contexts.  Internally, OrientDB represents a class as an <a href="java/ref/OSchema/../OClass.html"><code>OClass</code></a> instance.   Using this method you can retrieve the given class from the schema.</p>
<h3 id="syntax-173"><a class="header" href="#syntax-173">Syntax</a></h3>
<pre><code>OClass OSchema().getClass(String class)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>class</code></strong></td><td><code>String</code></td><td>Defines name of class you want to get</td></tr>
</tbody></table>
</div>
<h4 id="return-type-30"><a class="header" href="#return-type-30">Return Type</a></h4>
<p>This method returns the request <a href="java/ref/OSchema/../OClass.html"><code>OClass</code></a> instance.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oschema---getclassbyclusterid"><a class="header" href="#oschema---getclassbyclusterid">OSchema - getClassByClusterId()</a></h1>
<p>Retrieves a class from the schema by its associated cluster.</p>
<h2 id="retrieving-classes-1"><a class="header" href="#retrieving-classes-1">Retrieving Classes</a></h2>
<p>OrientDB has the concept of class within the database, which represents a broad grouping of records, similar to the table in relational contexts.  Internally, OrientDB represents a class as an <a href="java/ref/OSchema/../OClass.html"><code>OClass</code></a> instance.   Using this method you can retrieve a class from the schema by it associated cluster.</p>
<h3 id="syntax-174"><a class="header" href="#syntax-174">Syntax</a></h3>
<pre><code>OClass OSchema().getClassByClusterId(int clusterId)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>clusterId</code></strong></td><td><code>int</code></td><td>Defines the Cluster ID</td></tr>
</tbody></table>
</div>
<h4 id="return-value-107"><a class="header" href="#return-value-107">Return Value</a></h4>
<p>This method returns the <a href="java/ref/OSchema/../OClass.html"><code>OClass</code></a> instance that corresponds to the given Cluster ID.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oschema---getclasses"><a class="header" href="#oschema---getclasses">OSchema - getClasses()</a></h1>
<p>Retrieves the classes from the schema.</p>
<h2 id="getting-classes-1"><a class="header" href="#getting-classes-1">Getting Classes</a></h2>
<p>OrientDB has the concept of class within the database, which represents a broad grouping of records, similar to the table in relational contexts.  Internally, OrientDB represents a class as an <a href="java/ref/OSchema/../OClass.html"><code>OClass</code></a> instance.   Using this method you can retrieve a set of all the classes in the schema.</p>
<h3 id="syntax-175"><a class="header" href="#syntax-175">Syntax</a></h3>
<pre><code>Set&lt;OClass&gt; OSchema().getClasses()
</code></pre>
<h4 id="return-type-31"><a class="header" href="#return-type-31">Return Type</a></h4>
<p>This method returns a <code>Set</code> of the given <a href="java/ref/OSchema/../OClass.html"><code>OClass</code></a> instances in the schema.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oschema---getclassesrelyoncluster"><a class="header" href="#oschema---getclassesrelyoncluster">OSchema - getClassesRelyOnCluster()</a></h1>
<p>Retrieves all the classes that rely on the given cluster.</p>
<h2 id="retrieving-classes-2"><a class="header" href="#retrieving-classes-2">Retrieving Classes</a></h2>
<p>OrientDB has the concept of class within the database, which represents a broad grouping of records, similar to the table in relational contexts.  Internally, OrientDB represents a class as an <a href="java/ref/OSchema/../OClass.html"><code>OClass</code></a> instance.   Using this method you can retrieve all the classes in the schema that rely on the given cluster.</p>
<h3 id="syntax-176"><a class="header" href="#syntax-176">Syntax</a></h3>
<pre><code>Set&lt;OClass&gt; OSchema().getCLassesRelyOnCluster(String cluster)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>cluster</code></strong></td><td><code>String</code></td><td>Defines the cluster name</td></tr>
</tbody></table>
</div>
<h4 id="return-value-108"><a class="header" href="#return-value-108">Return Value</a></h4>
<p>This method returns a <code>Set</code> of <a href="java/ref/OSchema/../OClass.html"><code>OClass</code></a> instances that rely on the given cluster.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oschema---getorcreteclass"><a class="header" href="#oschema---getorcreteclass">OSchema - getOrCreteClass()</a></h1>
<p>Retrieves the given class or creates and retrieves it from the schema.</p>
<h2 id="retrieving-or-creating-classes"><a class="header" href="#retrieving-or-creating-classes">Retrieving or Creating Classes</a></h2>
<p>OrientDB has the concept of class within the database, which represents a broad grouping of records, similar to the table in relational contexts.  Internally, OrientDB represents a class as an <a href="java/ref/OSchema/../OClass.html"><code>OClass</code></a> instance.   Using this method you can retrieve the given class if exists in the schema, if it does not exist it create the class and returns it.</p>
<h3 id="syntax-177"><a class="header" href="#syntax-177">Syntax</a></h3>
<pre><code>OClass OSchema().getOrCreateClass(String class)

OClass OSchema().getOrCreateClass(String class, OClass... superClass)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>class</code></strong></td><td><code>String</code></td><td>Defines the logical name of the class</td></tr>
<tr><td><strong><code>superClass</code></strong></td><td><a href="java/ref/OSchema/../OClass.html"><code>OClass</code></a></td><td>Defines the superclass</td></tr>
</tbody></table>
</div>
<h4 id="return-type-32"><a class="header" href="#return-type-32">Return Type</a></h4>
<p>This method returns the requested <a href="java/ref/OSchema/../OClass.html"><code>OClass</code></a> instance.  It returns an existing class if it already existed in the database and the newly created class if it did not exist in the database.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="osecurityrole"><a class="header" href="#osecurityrole">OSecurityRole</a></h1>
<p>Provides an interface for working with and operating on roles.</p>
<h2 id="using-roles"><a class="header" href="#using-roles">Using Roles</a></h2>
<p>In OrientDB, roles allow you to assign privileges to a user in bulk rather than individually.  For instance, an account that needs to manage a blog would need read and write permissions on certain classes.  Roles allow you to give a new account the privileges it needs to function in one command, rather than through a series of individual grants.</p>
<p>To operate on roles in your application, import the class:</p>
<pre><code class="language-java">import com.orientechnologies.orient.core.metadata.security.OSecurityRole;
</code></pre>
<h3 id="methods-16"><a class="header" href="#methods-16">Methods</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Return Type</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="java/ref/OSecurityRole/addRule.html"><strong><code>addRule()</code></strong></a></td><td><code>OSecurityRole</code></td><td>Grants privilege on the given resource</td></tr>
<tr><td><a href="java/ref/OSecurityRole/allow.html"><strong><code>allow()</code></strong></a></td><td><code>boolean</code></td><td>Determines whether role can perform the given operation on the given resource</td></tr>
<tr><td><a href="java/ref/OSecurityRole/getDocument.html"><strong><code>getDocument()</code></strong></a></td><td><code>ODocument</code></td><td>Retrieves the internal document of the role</td></tr>
<tr><td><a href="java/ref/OSecurityRole/getName.html"><strong><code>getName()</code></strong></a></td><td><code>String</code></td><td>Retrieves the logical name of the role</td></tr>
<tr><td><a href="java/ref/OSecurityRole/getParentRole.html"><strong><code>getParentRole()</code></strong></a></td><td><code>OSecurityRole</code></td><td>Retrieves the parent role</td></tr>
<tr><td><a href="java/ref/OSecurityRole/getRuleSet.html"><strong><code>getRuleSet</code></strong></a></td><td><a href="java/ref/ORule.html"><code>Set&lt;ORule&gt;</code></a></td><td>Retrieves the rules assigned to the role</td></tr>
<tr><td><a href="java/ref/OSecurityRole/grant.html"><strong><code>grant()</code></strong></a></td><td><code>OSecurityRole</code></td><td>Grants privileges on the given resource</td></tr>
<tr><td><a href="java/ref/OSecurityRole/hasRule.html"><strong><code>hasRule()</code></strong></a></td><td><code>boolean</code></td><td>Determines whether the role can access the given resource</td></tr>
<tr><td><a href="java/ref/OSecurityRole/revoke.html"><strong><code>revoke()</code></strong></a></td><td><code>OSecurityRole</code></td><td>Revokes access to the given resource</td></tr>
<tr><td><a href="java/ref/OSecurityRole/setParentRole.html"><strong><code>setParentRole()</code></strong></a></td><td><code>OSecurityRole</code></td><td>Sets the parent role</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="osecurityrole---addrule"><a class="header" href="#osecurityrole---addrule">OSecurityRole - addRule()</a></h1>
<p>Grants access to the given resource to the role.</p>
<h2 id="adding-rules"><a class="header" href="#adding-rules">Adding Rules</a></h2>
<p>OrientDB defines resources and the user or role's access to the resource defined using <a href="java/ref/OSecurityRole/../ORule.html"><code>ORule</code></a> instances.  Using this method, you can add a rule to the role.</p>
<h3 id="syntax-178"><a class="header" href="#syntax-178">Syntax</a></h3>
<pre><code>OSecurityRole OSecurityRole().addRule(
	ORule.ResourceGeneric resourceGeneric,
	String resourceSpecific,
	int operation)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>resourceGeneric</code></strong></td><td><a href="java/ref/OSecurityRole/../ORule.html"><code>ORule.ResourceGeneric</code></a></td><td>Defines the generic resource</td></tr>
<tr><td><strong><code>resourceSpecific</code></strong></td><td><code>String</code></td><td>Defines the specific resource</td></tr>
<tr><td><strong><code>operation</code></strong></td><td><code>int</code></td><td>Defines the allowed operation</td></tr>
</tbody></table>
</div>
<h4 id="return-value-109"><a class="header" href="#return-value-109">Return Value</a></h4>
<p>This method returns an <a href="java/ref/OSecurityRole/../OSecurityRole.html"><code>OSecurityRule</code></a> instance.  You may find this useful in chaining several operations together.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="osecurityrole---allow"><a class="header" href="#osecurityrole---allow">OSecurityRole - allow()</a></h1>
<p>Determines whether the role is allowed to access the given resource.</p>
<h2 id="checking-access"><a class="header" href="#checking-access">Checking Access</a></h2>
<p>OrientDB defines resources and the user or role's access to the resource defined using <a href="java/ref/OSecurityRole/../ORule.html"><code>ORule</code></a> instances.   Using this method, you can determine whether the given role is allowed to access the given resource.</p>
<h3 id="syntax-179"><a class="header" href="#syntax-179">Syntax</a></h3>
<pre><code>boolean OSecurityRole().allow(
	ORule.ResourceGeneric resourceGeneric,
	String resourceSpecific,
	int operation)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>resourceGeneric</code></strong></td><td><a href="java/ref/OSecurityRole/../ORule.html"><code>ORule.ResourceGeneric</code></a></td><td>Defines the generic resource</td></tr>
<tr><td><strong><code>resourceSpecific</code></strong></td><td><code>String</code></td><td>Defines the specific resource</td></tr>
<tr><td><strong><code>operation</code></strong></td><td><code>int</code></td><td>Defines the operation you want to check</td></tr>
</tbody></table>
</div>
<h4 id="return-value-110"><a class="header" href="#return-value-110">Return Value</a></h4>
<p>This method returns a <code>boolean</code> instance.  A value of <code>true</code> indicates that the role does have permission to operate on the resource.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="osecurityrole---getdocument"><a class="header" href="#osecurityrole---getdocument">OSecurityRole - getDocument()</a></h1>
<p>Retrieves the document of the role.</p>
<h2 id="role-document"><a class="header" href="#role-document">Role Document</a></h2>
<p>Internally, OrientDB stores the role as a document in the database.  Using this method, you can retrieve the document for further operation.</p>
<h3 id="syntax-180"><a class="header" href="#syntax-180">Syntax</a></h3>
<pre><code>ODocument OSecurityRole().getDocument()
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="osecurityrole---getname"><a class="header" href="#osecurityrole---getname">OSecurityRole - getName()</a></h1>
<p>Retrieves the logical name for the role.</p>
<h2 id="logical-names"><a class="header" href="#logical-names">Logical Names</a></h2>
<p>OrientDB provides logical names to easily reference roles from the console or in other applications.  Using this method, you can retrieve the logical name for the role from the database.</p>
<h3 id="syntax-181"><a class="header" href="#syntax-181">Syntax</a></h3>
<pre><code>String OSecurityRole().getName()
</code></pre>
<h4 id="return-value-111"><a class="header" href="#return-value-111">Return Value</a></h4>
<p>This method returns a <code>String</code> instance.  It contains the logical name for the role.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="osecurityrole---getparentrole"><a class="header" href="#osecurityrole---getparentrole">OSecurityRole - getParentRole()</a></h1>
<p>Retrieves the parent of this role.</p>
<h2 id="roles"><a class="header" href="#roles">Roles</a></h2>
<p>Rather than creating a new role and assigning to it each and every privilege needed, you can instead assign it a parent role with all the privileges that come with it.  Using this method, you can retrieve the parent <a href="java/ref/OSecurityRole/../OSecurityRole.html"><code>OSecurityRole</code></a> instance.</p>
<h3 id="syntax-182"><a class="header" href="#syntax-182">Syntax</a></h3>
<pre><code>OSecurityRole OSecurityRole().getParentRole()
</code></pre>
<h4 id="return-value-112"><a class="header" href="#return-value-112">Return Value</a></h4>
<p>This method returns the parent role, an <a href="java/ref/OSecurityRole/../OSecurityRole.html"><code>OSecurityRole</code></a> instance.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="osecurityrole---getruleset"><a class="header" href="#osecurityrole---getruleset">OSecurityRole - getRuleSet()</a></h1>
<p>Retrieves the rules assigned to this role.</p>
<h2 id="rule-sets"><a class="header" href="#rule-sets">Rule Sets</a></h2>
<p>OrientDB defines the role's access to resources using a series of <a href="java/ref/OSecurityRole/../ORule.html"><code>ORule</code></a> instances.  Using this method, you can retrieve a set of all rules assigned to this account.</p>
<h3 id="syntax-183"><a class="header" href="#syntax-183">Syntax</a></h3>
<pre><code>Set&lt;ORule&gt; OSecurityRole().getRuleSet()
</code></pre>
<h4 id="return-value-113"><a class="header" href="#return-value-113">Return Value</a></h4>
<p>This method returns a <code>Set</code> instance containing all of the <a href="java/ref/OSecurityRole/../ORule.html"><code>ORule</code></a> instances connected to this role.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="osecurityrole---grant"><a class="header" href="#osecurityrole---grant">OSecurityRole - grant()</a></h1>
<p>Grants privileges to users with this role.</p>
<h2 id="granting-privileges"><a class="header" href="#granting-privileges">Granting Privileges</a></h2>
<p>Privileges in OrientDB are defined as a series of rules set on the user or role.  Using this method, you can add privileges to the role.</p>
<h3 id="syntax-184"><a class="header" href="#syntax-184">Syntax</a></h3>
<pre><code>OSecurityRole OSecurityRole().grant(
	ORule.ResourceGeneric resourceGeneric,
	String resourceSpecific,
	int operation)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>resourceGeneric</code></strong></td><td><a href="java/ref/OSecurityRole/../ORule.html"><code>ORule.ResourceGeneric</code></a></td><td>Defines the generic resource</td></tr>
<tr><td><strong><code>resourceSpecific</code></strong></td><td><code>String</code></td><td>Defines the specific resource</td></tr>
<tr><td><strong><code>operation</code></strong></td><td><code>int</code></td><td>Defines the operation you want to enable</td></tr>
</tbody></table>
</div>
<h4 id="return-value-114"><a class="header" href="#return-value-114">Return Value</a></h4>
<p>This method returns the updated <a href="java/ref/OSecurityRole/../OSecurityRole.html"><code>OSecurityRole</code></a> instance.  You may find this useful when chaining several operations together.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="osecurityrole---hasrule"><a class="header" href="#osecurityrole---hasrule">OSecurityRole - hasRule()</a></h1>
<p>Determines whether the role can access the given resources.</p>
<h2 id="rules"><a class="header" href="#rules">Rules</a></h2>
<p>OrientDB stores the privileges granted to a given user account or role as a set of rules, granting access to various resources.  Using this method, you can determine whether a role can access the given resource.</p>
<h3 id="syntax-185"><a class="header" href="#syntax-185">Syntax</a></h3>
<pre><code>boolean OSecurityRole().hasRule(
	ORule.ResourceGeneric resourceGeneric,
	String resourceSpecific)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>resourceGeneric</code></strong></td><td><a href="java/ref/OSecurityRole/../ORule.html"><code>ORule.ResourceGeneric</code></a></td><td>Defines the generic resource to check</td></tr>
<tr><td><strong><code>resourceSpecific</code></strong></td><td><code>String</code></td><td>Defines the specific resource to check</td></tr>
</tbody></table>
</div>
<h4 id="return-value-115"><a class="header" href="#return-value-115">Return Value</a></h4>
<p>This method returns a <code>boolean</code> instance.  A value of <code>true</code> indicates that the role can access the given resource.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="osecurityrole---revoke"><a class="header" href="#osecurityrole---revoke">OSecurityRole - revoke()</a></h1>
<p>Removes access to the given resource from the role.</p>
<h2 id="revoking-access"><a class="header" href="#revoking-access">Revoking Access</a></h2>
<p>OrientDB defines the resources that the role can access and what privileges they have on that resource using a set of rules.  Using this method, you can remove a rule from the set, effectively revoking the role's access to the resource.</p>
<h3 id="syntax-186"><a class="header" href="#syntax-186">Syntax</a></h3>
<pre><code>OSecurityRole OSecurityRole().revoke(
	ORule.ResourceGeneric resourceGeneric,
	String resourceSpecific,
	int operation)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>resourceGeneric</code></strong></td><td><a href="java/ref/OSecurityRole/../ORule.html"><code>ORule.ResourceGeneric</code></a></td><td>Defines the generic resource to remove</td></tr>
<tr><td><strong><code>resourceSpecific</code></strong></td><td><code>String</code></td><td>Defines the specific resource to remove</td></tr>
<tr><td><strong><code>operation</code></strong></td><td><code>int</code></td><td>Defines the operation to revoke</td></tr>
</tbody></table>
</div>
<h4 id="return-value-116"><a class="header" href="#return-value-116">Return Value</a></h4>
<p>This method returns the updated <a href="java/ref/OSecurityRole/../OSecurityRole.html"><code>OSecurityRole</code></a> instance.  You may find this useful in chaining several operations together.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="osecurityrole---setparentrole"><a class="header" href="#osecurityrole---setparentrole">OSecurityRole - setParentRole()</a></h1>
<p>Defines the parent of this role.</p>
<h2 id="roles-1"><a class="header" href="#roles-1">Roles</a></h2>
<p>Rather than creating a new role and assigning to it each and every privilege needed, you can instead assign it a parent role with all the privileges that come with it.  Using this method, you can set the parent <a href="java/ref/OSecurityRole/../OSecurityRole.html"><code>OSecurityRole</code></a> instance.</p>
<h3 id="syntax-187"><a class="header" href="#syntax-187">Syntax</a></h3>
<pre><code>OSecurityRole OSecurityRole().setParentRole(
	OSecurityRole parentRole)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>parentRole</code></strong></td><td><a href="java/ref/OSecurityRole/../OSecurityRole.html"><code>OSecurityRole</code></a></td><td>Defines the parent role to set</td></tr>
</tbody></table>
</div>
<h4 id="return-value-117"><a class="header" href="#return-value-117">Return Value</a></h4>
<p>This method returns the updated role, an <a href="java/ref/OSecurityRole/../OSecurityRole.html"><code>OSecurityRole</code></a> instance.  You may find this useful when chaining several operations together.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="osecurityuser"><a class="header" href="#osecurityuser">OSecurityUser</a></h1>
<p>Provides an interface for working with or operating on particular users of the OrientDB Server or databases.</p>
<h2 id="working-with-users"><a class="header" href="#working-with-users">Working with Users</a></h2>
<p>OrientDB maintains an internal set of users with various privileges assigned to these users, granting them access to the Server itself or to particular databases on the Server.  Using this class you can work with or operate on an individual user.</p>
<p>To use the <code>OSecurityUser</code> interface in your code, you need to import it.</p>
<pre><code class="language-java">import com.orientechnologies.orient.core.metadata.security.OSecurityUser;
</code></pre>
<h3 id="methods-17"><a class="header" href="#methods-17">Methods</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Return Type</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="java/ref/OSecurityUser/addRole.html"><strong><code>addRole()</code></strong></a></td><td><code>OSecurityUser</code></td><td>Adds a role to the user</td></tr>
<tr><td><a href="java/ref/OSecurityUser/checkPassword.html"><strong><code>checkPassword()</code></strong></a></td><td><code>OSecurityUser</code></td><td>Authenticates user password</td></tr>
<tr><td><a href="java/ref/OSecurityUser/getAccountStatus.html"><strong><code>getAccountStatus()</code></strong></a></td><td><code>OSecurityUser.STATUSES</code></td><td>Retrieves the status of the user account</td></tr>
<tr><td><a href="java/ref/OSecurityUser/getName.html"><strong><code>getName()</code></strong></a></td><td><code>String</code></td><td>Retrieves the logical name for the user</td></tr>
<tr><td><a href="java/ref/OSecurityUser/getPassword.html"><strong><code>getPassword()</code></strong></a></td><td><code>String</code></td><td>Retrieves the user password</td></tr>
<tr><td><a href="java/ref/OSecurityUser/getRoles.html"><strong><code>getRoles</code></strong></a></td><td><a href="java/ref/OSecurityRole.html"><code>Set&lt;? extends OSecurityRole&gt;</code></a></td><td>Retrieves the roles assigned to this user</td></tr>
<tr><td><a href="java/ref/OSecurityUser/hasRole.html"><strong><code>hasRole()</code></strong></a></td><td><code>boolean</code></td><td>Determines whether the user has the given role</td></tr>
<tr><td><a href="java/ref/OSecurityUser/removeRole.html"><strong><code>removeRole()</code></strong></a></td><td><code>boolean</code></td><td>Removes the given role from the user</td></tr>
<tr><td><a href="java/ref/OSecurityUser/setAccountStatus.html"><strong><code>setAccountStatus()</code></strong></a></td><td><code>void</code></td><td>Defines the status for the user account</td></tr>
<tr><td><a href="java/ref/OSecurityUser/setName.html"><strong><code>setName()</code></strong></a></td><td><code>OSecurityUser</code></td><td>Defines the logical name for the user</td></tr>
<tr><td><a href="java/ref/OSecurityUser/setPassword.html"><strong><code>setPassword()</code></strong></a></td><td><code>OSecurityUser</code></td><td>Defines the user password</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="osecurityuser---addrole"><a class="header" href="#osecurityuser---addrole">OSecurityUser - addRole()</a></h1>
<p>Adds the given role to the user account.</p>
<h2 id="roles-2"><a class="header" href="#roles-2">Roles</a></h2>
<p>Rather than creating a series of users and apply permissions to those users individually, OrientDB allows you to define roles for the user.   A role provides a series of permissions, granting the user access to whatever resources they may require to perform the given action on the database.  Using this method, you can add a role to the user account.</p>
<h3 id="syntax-188"><a class="header" href="#syntax-188">Syntax</a></h3>
<pre><code>OSecurityUser OSecurityUser().addRole(OSecurityRole role)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>role</code></strong></td><td><a href="java/ref/OSecurityUser/../OSecurityRole.html"><code>OSecurityRole</code></a></td><td>Defines the role you want to add</td></tr>
</tbody></table>
</div>
<h4 id="return-value-118"><a class="header" href="#return-value-118">Return Value</a></h4>
<p>This method returns the updated <a href="java/ref/OSecurityUser/../OSecurityUser.html"><code>OSecurityUser</code></a> instance.  You can then use the return value to chain several operations together in preparing a user to operate on the database.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="osecurityuser---allow"><a class="header" href="#osecurityuser---allow">OSecurityUser - allow()</a></h1>
<p>Determines whether the user is allowed to access the given resource.</p>
<h2 id="checking-access-1"><a class="header" href="#checking-access-1">Checking Access</a></h2>
<p>OrientDB defines resources and the user or role's access to the resource defined using <a href="java/ref/OSecurityUser/../ORule.html"><code>ORule</code></a> instances.   Using this method, you can determine whether the user is allowed to access the given resource.</p>
<h3 id="syntax-189"><a class="header" href="#syntax-189">Syntax</a></h3>
<pre><code>boolean OSecurityUser().allow(
	ORule.ResourceGeneric resourceGeneric,
	String resourceSpecific,
	int operation)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>resourceGeneric</code></strong></td><td><a href="java/ref/OSecurityUser/../ORule.html"><code>ORule.ResourceGeneric</code></a></td><td>Defines the generic resource</td></tr>
<tr><td><strong><code>resourceSpecific</code></strong></td><td><code>String</code></td><td>Defines the specific resource</td></tr>
<tr><td><strong><code>operation</code></strong></td><td><code>int</code></td><td>Defines the operation you want to check</td></tr>
</tbody></table>
</div>
<h4 id="return-value-119"><a class="header" href="#return-value-119">Return Value</a></h4>
<p>This method returns a <code>boolean</code> instance.  A value of <code>true</code> indicates that the role does have permission to operate on the resource.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="osecurityuser---checkpassword"><a class="header" href="#osecurityuser---checkpassword">OSecurityUser - checkPassword()</a></h1>
<p>Authenticates the given password.</p>
<h2 id="passwords"><a class="header" href="#passwords">Passwords</a></h2>
<p>OrientDB allows you to secure users through the use of passwords.  Using this method, you can authenticate the password given for this user.</p>
<h3 id="syntax-190"><a class="header" href="#syntax-190">Syntax</a></h3>
<pre><code>boolean OSecurityUser().checkPassword(String password)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>password</code></strong></td><td><code>String</code></td><td>Provides password for the user</td></tr>
</tbody></table>
</div>
<h4 id="return-value-120"><a class="header" href="#return-value-120">Return Value</a></h4>
<p>This method returns a <code>boolean</code> instance.  A value of <code>true</code> indicates that the password is authentic.  A value of <code>false</code> indicates that the password is wrong.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="osecurityuser---getaccountstatus"><a class="header" href="#osecurityuser---getaccountstatus">OSecurityUser - getAccountStatus()</a></h1>
<p>Retrieves the status of the user account.</p>
<h2 id="user-account-status"><a class="header" href="#user-account-status">User Account Status</a></h2>
<p>OrientDB supports the use of a general status, which is either <code>ACTIVE</code> or <code>SUSPENDED</code> to determine whether the user can access resources.  This makes it relatively straightforward to quickly disable account should the need arise.  Using this method, you can retrieve the current account status.  To set the account status, see the <a href="java/ref/OSecurityUser/setAccountStatus.html"><code>setAccountStatus()</code></a> method.</p>
<h3 id="syntax-191"><a class="header" href="#syntax-191">Syntax</a></h3>
<pre><code>OSecurityUser.STATUSES OSecurityUser().getAccountStatus()
</code></pre>
<h4 id="return-value-121"><a class="header" href="#return-value-121">Return Value</a></h4>
<p>This method returns <code>OSecurityUser.STATUSES</code> instance, which is either <code>ACTIVE</code> or <code>SUSPENDED</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="osecurityuser---getdocument"><a class="header" href="#osecurityuser---getdocument">OSecurityUser - getDocument()</a></h1>
<p>Retrieves the document of the user.</p>
<h2 id="role-document-1"><a class="header" href="#role-document-1">Role Document</a></h2>
<p>Internally, OrientDB stores the user as a document in the database.  Using this method, you can retrieve the document for further operation.</p>
<h3 id="syntax-192"><a class="header" href="#syntax-192">Syntax</a></h3>
<pre><code>ODocument OSecurityUser().getDocument()
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="osecurityuser---getname"><a class="header" href="#osecurityuser---getname">OSecurityUser - getName()</a></h1>
<p>Retrieves the logical name of the user.</p>
<h2 id="logical-names-1"><a class="header" href="#logical-names-1">Logical Names</a></h2>
<p>Where your Java application interacts with users through the <a href="java/ref/OSecurityUser/../OSecurityUser.html"><code>OSecurityUser</code></a> interface, in OrientDB SQL the users are identified by their logical names.  Using this method, you can retrieve the logical name for the user, which you may find useful for logging and authentication purposes.</p>
<h3 id="syntax-193"><a class="header" href="#syntax-193">Syntax</a></h3>
<pre><code>String OSecurityUser().getName()
</code></pre>
<h4 id="return-value-122"><a class="header" href="#return-value-122">Return Value</a></h4>
<p>This method returns a <code>String</code> value, which provides the logical name of the user.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="osecurityuser---getpassword"><a class="header" href="#osecurityuser---getpassword">OSecurityUser - getPassword()</a></h1>
<p>Retrieves the user password.</p>
<h2 id="passwords-1"><a class="header" href="#passwords-1">Passwords</a></h2>
<p>Users in OrientDB have passwords, allowing you to authenticate their access to the Server.  Using this method you can retrieve the password from the user instance.</p>
<h3 id="syntax-194"><a class="header" href="#syntax-194">Syntax</a></h3>
<pre><code>String OSecurityUser().getPassword()
</code></pre>
<h4 id="return-value-123"><a class="header" href="#return-value-123">Return Value</a></h4>
<p>This method returns a <code>String</code> instance, which represents the password for the account.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="osecurityuser---getroles"><a class="header" href="#osecurityuser---getroles">OSecurityUser - getRoles()</a></h1>
<p>Returns the set of roles assigned to this user.</p>
<h2 id="user-roles"><a class="header" href="#user-roles">User Roles</a></h2>
<p>OrientDB provides a convenient way of granting users access to multiple resources in the form of roles.  For instance, in developing a web application to serve blogs, authors would need write privileges on certain parts of the database.  Administrators need other kinds of privileges.  Developing a role for these users allows you to grant them all the required privileges in one command.</p>
<p>Using this method, you can retrieve all the roles assigned to the user account.</p>
<h3 id="syntax-195"><a class="header" href="#syntax-195">Syntax</a></h3>
<pre><code>Set&lt;? extends OSecurityRole&gt; OSecurityUser().getRoles()
</code></pre>
<h4 id="return-value-124"><a class="header" href="#return-value-124">Return Value</a></h4>
<p>This method returns a <code>Set</code> instance.  The set contains the roles assigned to the user.  Each role is a class that extends the <a href="java/ref/OSecurityUser/../OSecurityRole.html"><code>OSecurityRole</code></a> class.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="osecurityuser---isruledefined"><a class="header" href="#osecurityuser---isruledefined">OSecurityUser - isRuleDefined()</a></h1>
<p>Determines whether the given rule is defined for the user.</p>
<h2 id="rules-1"><a class="header" href="#rules-1">Rules</a></h2>
<p>OrientDB defines a user's access to various resources through a set of rules, defined as <a href="java/ref/OSecurityUser/../ORule.html"><code>ORule</code></a> instances.  Using this method, you can determine if a rule has been defined for a specific resource for this user.</p>
<h3 id="syntax-196"><a class="header" href="#syntax-196">Syntax</a></h3>
<pre><code>boolean OSecurityUser().isRuleDefined(
   ORule.ResourceGeneric resourceGeneric,
   String resourceSpecific)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>resourceGeneric</code></strong></td><td><a href="java/ref/OSecurityUser/../ORule.html"><code>ORule.ResourceGeneric</code></a></td><td>Defines the generic resource for the rule</td></tr>
<tr><td><strong><code>resourceSpecific</code></strong></td><td><code>String</code></td><td>Defines the specific resource to check</td></tr>
</tbody></table>
</div>
<h4 id="return-value-125"><a class="header" href="#return-value-125">Return Value</a></h4>
<p>This method returns a <code>boolean</code> instance.  A value of <code>true</code>, indicates that the user does have a rule to access the given resource.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="osecurityuser---hasrole"><a class="header" href="#osecurityuser---hasrole">OSecurityUser - hasRole()</a></h1>
<p>Determines whether the user has the given role.</p>
<h2 id="roles-3"><a class="header" href="#roles-3">Roles</a></h2>
<p>OrientDB provides a convenient way of granting users access to multiple resources in the form of roles.  For instance, in developing a web application to serve blogs, authors would need write privileges on certain parts of the database.  Administrators need other kinds of privileges.  Developing a role for these users allows you to grant them all the required privileges in one command.</p>
<p>Using this method you can determine whether the user account has access to the given role.</p>
<h3 id="syntax-197"><a class="header" href="#syntax-197">Syntax</a></h3>
<pre><code>boolean OSecurityUser().hasRole(
	String role,
	boolean includeInherited)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>role</code></strong></td><td><code>String</code></td><td>Defines the logical name of the role</td></tr>
<tr><td><strong><code>includeInherited</code></strong></td><td>Defines whether to include roles that inherit from the given role</td><td></td></tr>
</tbody></table>
</div>
<h4 id="return-value-126"><a class="header" href="#return-value-126">Return Value</a></h4>
<p>This method returns a <code>boolean</code> instance.  A value of <code>true</code> indicates that the user account has the given role.  A value of <code>false</code> indicates that it doesn't have the given role.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="osecurityuser---removerole"><a class="header" href="#osecurityuser---removerole">OSecurityUser - removeRole()</a></h1>
<p>Removes the given role from the user account.</p>
<h2 id="roles-4"><a class="header" href="#roles-4">Roles</a></h2>
<p>OrientDB provides a convenient way of granting users access to multiple resources in the form of roles.  For instance, in developing a web application to serve blogs, authors would need write privileges on certain parts of the database.  Administrators need other kinds of privileges.  Developing a role for these users allows you to grant them all the required privileges in one command.</p>
<p>Using this method you can remove the given role from the user account.</p>
<h3 id="syntax-198"><a class="header" href="#syntax-198">Syntax</a></h3>
<pre><code>boolean OSecurityUser().removeRole(String role)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>role</code></strong></td><td><code>String</code></td><td>Defines the logical name for the role</td></tr>
</tbody></table>
</div>
<h4 id="return-value-127"><a class="header" href="#return-value-127">Return Value</a></h4>
<p>This method returns a <code>boolean</code> instance.  A value of <code>true</code> indicates whether the role was successfully removed.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="osecurityuser---setaccountstatus"><a class="header" href="#osecurityuser---setaccountstatus">OSecurityUser - setAccountStatus()</a></h1>
<p>Sets the user account status.</p>
<h2 id="account-status"><a class="header" href="#account-status">Account Status</a></h2>
<p>OrientDB supports the use of a general status, which is either <code>ACTIVE</code> or <code>SUSPENDED</code> to determine whether the user can access resources.  This makes it relatively straightforward to quickly disable account should the need arise.  Using this method, you can set the status account.  To retrieve the current status, see the <a href="java/ref/OSecurityUser/getAccountStatus.html"><code>getAccountStatus()</code></a> method.</p>
<h3 id="syntax-199"><a class="header" href="#syntax-199">Syntax</a></h3>
<pre><code>void OSecurityUser().setAccountStatus(OSecurityUser.STATUSES status)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>status</code></strong></td><td><code>OSecurityUser.STATUSES</code></td><td>Indicates the status that you want to set, which is either <code>ACTIVE</code> or <code>SUSPENDED</code></td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="osecurityuser---setname"><a class="header" href="#osecurityuser---setname">OSecurityUser - setName()</a></h1>
<p>Defines the logical name for the user.</p>
<h2 id="logical-user-names"><a class="header" href="#logical-user-names">Logical User Names</a></h2>
<p>Where your Java application interacts with users through the <a href="java/ref/OSecurityUser/../OSecurityUser.html"><code>OSecurityUser</code></a> interface, in OrientDB SQL the users are identified by their logical names.  Using this method, you can set the logical name for the user.</p>
<h3 id="syntax-200"><a class="header" href="#syntax-200">Syntax</a></h3>
<pre><code>OSecurityUser OSecurityUser().setName(String name)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>name</code></strong></td><td><code>String</code></td><td>Defines the logical name for the user</td></tr>
</tbody></table>
</div>
<h4 id="return-value-128"><a class="header" href="#return-value-128">Return Value</a></h4>
<p>This method returns the updated <a href="java/ref/OSecurityUser/../OSecurityUser.html"><code>OSecurityUser</code></a> instance, which you can then use in chaining several operations together.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="osecurityuser---setpassword"><a class="header" href="#osecurityuser---setpassword">OSecurityUser - setPassword()</a></h1>
<p>Defines the password for the user account.</p>
<h2 id="setting-passwords"><a class="header" href="#setting-passwords">Setting Passwords</a></h2>
<p>Users in OrientDB have passwords, allowing you to authenticate their access to the Server.  Using this method you can set the password for the user account.</p>
<h3 id="syntax-201"><a class="header" href="#syntax-201">Syntax</a></h3>
<pre><code>OSecurityUser OSecurityUser().setPassword(String password)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>password</code></strong></td><td><code>String</code></td><td>Defines the new password</td></tr>
</tbody></table>
</div>
<h4 id="return-value-129"><a class="header" href="#return-value-129">Return Value</a></h4>
<p>This method returns the updated <a href="java/ref/OSecurityUser/../OSecurityUser.html"><code>OSecurityUser</code></a> instance. You may find this useful in chaining several user operations together.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="java-api---oserver"><a class="header" href="#java-api---oserver">Java API - OServer</a></h1>
<p>This class allows you to embed and manage a server instance within your application.  Once you start the server, you can interact with it and manage data the same as you would standard instances of the OrientDB Server.</p>
<blockquote>
<p>For more information, see <a href="java/ref/../../internals/Embedded-Server.html">Embedding the Server</a>.  For the complete <code>OServer</code> documentation, see the <a href="https://orientdb.dev/javadocs/develop/com/orientechnologies/orient/server/OServer.html">Javadocs</a>.</p>
</blockquote>
<h2 id="working-with-oserver"><a class="header" href="#working-with-oserver">Working with <code>OServer</code></a></h2>
<p>In order to operate on an OrientDB database, you first need to establish a connection with the server.  You have two options in this: you can connect to a running OrientDB Server using <a href="java/ref/OrientDB.html"><code>OrientDB</code></a> or you can embed the server within your application using this class.  It can be found at <code>com.orientechnologies.orient.server</code>. For instance,</p>
<pre><code class="language-java">/* Import OrientDB Classes */
import com.orientechnologies.orient.server.OServer;
</code></pre>
<p>Once you've imported the class to your application, you can use one of the constructors to build a particular instance in your code.</p>
<h3 id="constructors-1"><a class="header" href="#constructors-1">Constructors</a></h3>
<p>This class provides two constructors to create instances of <code>OServer</code> in your application. The first takes no arguments and the second takes a single boolean argument, which defines whether you want to shut the server down on exit.</p>
<pre><code>// CONSTRUCTOR 1
OServer()

// CONSTRUCTOR 2
OServer(boolean shutdownEngineOnExit)
</code></pre>
<h3 id="exception"><a class="header" href="#exception">Exception</a></h3>
<p>This class throws the following exceptions.</p>
<ul>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/ClassNotFoundException.html"><code>ClassNotFoundException</code></a></li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/javax/management/MalformedObjectNameException.html"><code>MalformedObjectNameException</code></a></li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/NullPointerException.html"><code>NullPointerException</code></a></li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/javax/management/InstanceAlreadyExistsException.html"><code>InstanceAlreadyExistsException</code></a></li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/javax/management/MBeanRegistrationException.html"><code>MBeanRegistrationException</code></a></li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/javax/management/NotCompliantMBeanException.html"><code>NotCompliantMBeanException</code></a></li>
</ul>
<h3 id="methods-18"><a class="header" href="#methods-18">Methods</a></h3>
<p>Once you've initialized the class in your application, you can call the following methods on your instance.</p>
<h4 id="managing-server-instances"><a class="header" href="#managing-server-instances">Managing Server Instances</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Return Type</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="java/ref/OServer/getInstance.html"><strong><code>getInstance()</code></strong></a></td><td><a href="java/ref/OServer.html"><code>OServer</code></a></td><td>Retrieves a server instance by ID.</td></tr>
<tr><td><a href="java/ref/OServer/getInstanceByPath.html"><strong><code>getInstanceByPath()</code></strong></a></td><td><a href="java/ref/OServer.html"><code>OServer</code></a></td><td>Retrieve a server instance by its path.</td></tr>
<tr><td><a href="java/ref/OServer/isActive.html"><strong><code>isActive()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>boolean</code></a></td><td>Checks whether server is active.</td></tr>
<tr><td><a href="java/ref/OServer/restart.html"><strong><code>restart()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Void.html"><code>void</code></a></td><td>Restarts the server.</td></tr>
<tr><td><a href="java/ref/OServer/shutdown.html"><strong><code>shutdown()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>boolean</code></a></td><td>Shuts down the server.</td></tr>
<tr><td><a href="java/ref/OServer/startup.html"><strong><code>startup()</code></strong></a></td><td><a href="java/ref/OServer.html"><code>OServer</code></a></td><td>Starts the server.</td></tr>
</tbody></table>
</div><!--
# Managing Server
serverLogin - 
registerServerInstance
registerLifecycleListener
unregisterLifecycleListener
setServerRootDirectory
getSecurity
-->
<h4 id="managing-databases-1"><a class="header" href="#managing-databases-1">Managing Databases</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Return Type</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="java/ref/OServer/getDatabaseDirectory.html"><strong><code>getDatabaseDirectory()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>java.lang.String</code></a></td><td>Retrieves the root database directory.</td></tr>
<tr><td><a href="java/ref/OServer/openDatabase.html"><strong><code>openDatabase()</code></strong></a></td><td><code>ODatabase&lt;T&gt;</code></td><td>Opens the given database.</td></tr>
</tbody></table>
</div><!-- Methods
getSystemDatabase
openDatabaseBypassingSecurity
getDatabasePoolFactory
-->
<h4 id="managing-storage"><a class="header" href="#managing-storage">Managing Storage</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Return Type</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="java/ref/OServer/existsStoragePath.html"><strong><code>existsStoragePath()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>boolean</code></a></td><td>Determines whether storage path exists.</td></tr>
<tr><td><a href="java/ref/OServer/getAvailableStorageNames.html"><strong><code>getAvailableStorageNames()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Map.html"><code>Map</code></a><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>&lt;String,</code></a><a href="https://docs.oracle.com/javase/8/docs/api/java/lang.String.html"><code> String&gt;</code></a></td><td>Retrieves a map of available storage types.</td></tr>
<tr><td><a href="java/ref/OServer/getStoragePath.html"><strong><code>getStoragePath()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>java.lang.String</code></a></td><td>Retrieves the storage path.</td></tr>
</tbody></table>
</div>
<h4 id="user-management"><a class="header" href="#user-management">User Management</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Return Type</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="java/ref/OServer/addTemporaryUser.html"><strong><code>addTemporaryUser()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Void.html"><code>void</code></a></td><td>Adds a temporary user to the server.</td></tr>
<tr><td><a href="java/ref/OServer/addUser.html"><strong><code>addUser()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Void.html"><code>void</code></a></td><td>Adds a user to the server.</td></tr>
<tr><td><a href="java/ref/OServer/authenticate.html"><strong><code>authenticate()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>boolean</code></a></td><td>Authenticates a user on the server.</td></tr>
<tr><td><a href="java/ref/OServer/dropUser.html"><strong><code>dropUser()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Void.html"><code>void</code></a></td><td>Removes user from the server.</td></tr>
<tr><td><a href="java/ref/OServer/isAllowed.html"><strong><code>isAllowed()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>boolean</code></a></td><td>Checks whether user can access a given resource.</td></tr>
</tbody></table>
</div><!--

# User Management
getUser
-->
<h4 id="configuration-6"><a class="header" href="#configuration-6">Configuration</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Return Type</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="java/ref/OServer/getConfiguration.html"><strong><code>getConfiguration()</code></strong></a></td><td><code>OServerConfiguration</code></td><td>Retrieves the server configuration.</td></tr>
<tr><td><a href="java/ref/OServer/saveConfiguration.html"><strong><code>saveConfiguration()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Void.html"><code>void</code></a></td><td>Saves the server configuration to disk.</td></tr>
</tbody></table>
</div><!--

# Configuration
getContextConfiguration
-->
<!--

# Class Loader
setExtensionClassLoader
getExtensionClassLoader


# Network
getClientConnectionManager
getNetworkProtocols
getNetworkListeners

# Plugins
getPlugins
getPluginByClass
getPluginManager

# Other
getServerThreadGroup
getVariable
setVariable
getDistributedManager
getTokenHandler

-->
<div style="break-before: page; page-break-before: always;"></div><h1 id="oserver---addtemporaryuser"><a class="header" href="#oserver---addtemporaryuser">OServer - addTemporaryUser()</a></h1>
<p>This method adds a temporary user on the OrientDB Server.</p>
<h2 id="adding-temporary-users"><a class="header" href="#adding-temporary-users">Adding Temporary Users</a></h2>
<h3 id="syntax-202"><a class="header" href="#syntax-202">Syntax</a></h3>
<pre><code>public void OServer().addTemporaryUser(String user, String passwd, String permission)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>user</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>java.lang.String</code></a></td><td>Defines the user name.</td></tr>
<tr><td><strong><code>passwd</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>java.lang.String</code></a></td><td>Defines the user password.</td></tr>
<tr><td><strong><code>permission</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>java.lang.String</code></a></td><td>Defines the user permissions.</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="oserver---adduser"><a class="header" href="#oserver---adduser">OServer - addUser()</a></h1>
<p>This method adds a user to the OrientDB Server.</p>
<h2 id="adding-users"><a class="header" href="#adding-users">Adding Users</a></h2>
<p>OrientDB differentiates between users with access to the server and users with access to the database.  This method relates to adding users to the server.</p>
<h3 id="syntax-203"><a class="header" href="#syntax-203">Syntax</a></h3>
<pre><code>public void OServer().addUser(String user, 
		String passwd,
		String permission)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>user</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>java.lang.String</code></a></td><td>Defines the user name.</td></tr>
<tr><td><strong><code>passwd</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>java.lang.String</code></a></td><td>Defines the password for the new user.</td></tr>
<tr><td><strong><code>permission</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>java.lang.String</code></a></td><td>Defines the permission-level for the new user.</td></tr>
</tbody></table>
</div>
<h4 id="exception-1"><a class="header" href="#exception-1">Exception</a></h4>
<p>This method throws the following exception,</p>
<ul>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/io/IOException.html"><code>IOException</code></a></li>
</ul>
<h3 id="example-75"><a class="header" href="#example-75">Example</a></h3>
<p>Imagine you have a web application running on a distributed deployment.  You may want a method in the class that manages your OrientDB Server instances to use in creating server users.</p>
<pre><code class="language-java">
/**
 * Create New User
 */
public Boolean createUser(OServer oserver, 
      String user, String passwd, String permission){ 
    
   // Log Operation
   logger.info("Creating New User: " + user);

   try {
      // Create User 
      oserver.addUser(user, passwd, permission);
	  return true;

   } catch(IOException err){
      logger.warn("Error Creating User: " +
	     err.getMessage());
      return false;

   }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oserver---authenticate"><a class="header" href="#oserver---authenticate">OServer - authenticate()</a></h1>
<p>This method authenticates a user on the OrientDB Server.</p>
<h2 id="authenticating-users"><a class="header" href="#authenticating-users">Authenticating Users</a></h2>
<p>OrientDB differentiates between users that operate on the server and users that operate on the database.  This method allows you to authenticate the given user for server operations.</p>
<h3 id="syntax-204"><a class="header" href="#syntax-204">Syntax</a></h3>
<pre><code>public boolean OServer().authenticate(String user, String passwd, String resource)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>user</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>java.lang.String</code></a></td><td>Defines the user to authenticate.</td></tr>
<tr><td><strong><code>passwd</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>java.lang.String</code></a></td><td>Defines the password for the user.</td></tr>
<tr><td><strong><code>resource</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>java.lang.String</code></a></td><td>Defines the resource to authenticate on.</td></tr>
</tbody></table>
</div>
<h4 id="return-value-130"><a class="header" href="#return-value-130">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>boolean</code></a> value.  If the return value is <code>true</code>, it indicates that you have successfully authenticated the user.</p>
<h3 id="example-76"><a class="header" href="#example-76">Example</a></h3>
<p>Imagine you have a web application running on a distributed deployment.  You may want a method in the class that manages your OrientDB Server instances to use in authenticating server users.</p>
<pre><code class="language-java">
/**
 * Authenticate User
 */
public Boolean authUser(OServer oserver, 
      String user, String passwd, String resource){ 
    
   // Log Operation
   logger.info("Authenticating User: " + user);

   return oserver.authenticate(ser, passwd, resource);
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oserver---dropuser"><a class="header" href="#oserver---dropuser">OServer - dropUser()</a></h1>
<p>This method removes a user from the OrientDB Server.</p>
<h2 id="removing-users"><a class="header" href="#removing-users">Removing Users</a></h2>
<p>OrientDB differentiates between users with access to the server and users with access to the database.  Occasionally, you may need to manage users on your server instances.  This method allows you to remove them.</p>
<h3 id="syntax-205"><a class="header" href="#syntax-205">Syntax</a></h3>
<pre><code>public void OServer().dropUser(String iUser)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>iUser</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>java.lang.String</code></a></td><td>Defines the user you want to remove</td></tr>
</tbody></table>
</div>
<h4 id="exceptions-2"><a class="header" href="#exceptions-2">Exceptions</a></h4>
<p>This method throws the following exception:</p>
<ul>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/io/IOException.html"><code>IOException</code></a></li>
</ul>
<h3 id="example-77"><a class="header" href="#example-77">Example</a></h3>
<p>Consider the use case of a web application.  You may want to provide administrators and scripts access to manage server users, such as remove credentials when an administrator leaves the company.</p>
<p>In the class that manages your <a href="java/ref/OServer/../OServer.html"><code>OServer</code></a> instances, you might want a method to streamline this process and log the event for you.</p>
<pre><code class="language-java">/**
 * Remove OServer User
 */
public Boolean removeUser(OServer oserver, String user){

   // Log Operation
   logger.info("Removing User: " + user);

   try {

      // Remove USer
      oserver.dropUser(user);
	  return true;

   } catch(IOException err){

      // Report Exception
      logger.warn("Unable to Remove User: " +
	     err.getMessage());
      return false;
   }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oserver---existsstoragepath"><a class="header" href="#oserver---existsstoragepath">OServer - existsStoragePath()</a></h1>
<p>This method determines whether the given storage path exists.</p>
<h2 id="checking-storage-path"><a class="header" href="#checking-storage-path">Checking Storage Path</a></h2>
<h3 id="syntax-206"><a class="header" href="#syntax-206">Syntax</a></h3>
<pre><code>public Boolean OServer().existsStoragePath(String iURL)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>iURL</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>java.lang.String</code></a></td><td>Defines the storage path.</td></tr>
</tbody></table>
</div>
<h4 id="return-value-131"><a class="header" href="#return-value-131">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>boolean</code></a> value.  If the return value is <code>true</code>, it indicates that the given storage path exists.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oserver---getavailablestoragenames"><a class="header" href="#oserver---getavailablestoragenames">OServer - getAvailableStorageNames()</a></h1>
<p>This method returns a map of storage types available on the OrientDB Server.</p>
<h2 id="retrieving-storage-names"><a class="header" href="#retrieving-storage-names">Retrieving Storage Names</a></h2>
<p>OrientDB supports two storage types: in-memory and PLocal.  In the event that you want to check for others that might become available or otherwise test the feature, this method allows you to retrieve a map of those available.</p>
<h3 id="syntax-207"><a class="header" href="#syntax-207">Syntax</a></h3>
<pre><code>public Map&lt;String, String&gt; OServer().getAvailableStorageNames()
</code></pre>
<h3 id="example-78"><a class="header" href="#example-78">Example</a></h3>
<p>In the event that you want to pull the available storage names to operate on in some other method, you might use something like the following:</p>
<pre><code class="language-java">/**
 * Report Available Storage to Stdout
 */
public void reportStorage(OServer oserver){

   // Log Operation
   logger.info("Reporting Storage");

   // Initialize Variables
   private Map&lt;String, String&gt; storage;
   private Iterator it;

   // Prepare Iterator 
   storage = oserver.getAvailableStorage();
   it = storage.entrySet().iterator();

   // Loop Over Storage
   System.out.println("OServer Storage:");
   while (it.hasNext()){
      Map.Entry pair = (Map.Entry)it.next();
	  System.out.println(pair.getKey() + ": " + pair.getValue());
	  it.remove();
   }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="server---getconfiguration"><a class="header" href="#server---getconfiguration">[Server - getConfiguration()</a></h1>
<p>This method retrieves the OrientDB Server configuration.</p>
<h2 id="retrieving-server-configuration"><a class="header" href="#retrieving-server-configuration">Retrieving Server Configuration</a></h2>
<p>On occasion you may need to review or otherwise operation on configuration values of a given <a href="java/ref/OServer/../OServer.html"><code>OServer</code></a> instance.  This method allows you to retrieve the current configuration as an <code>OServerConfiguration</code> instance.</p>
<h3 id="syntax-208"><a class="header" href="#syntax-208">Syntax</a></h3>
<pre><code>public OServerConfiguration OServer().getConfiguration()
</code></pre>
<h4 id="return-value-132"><a class="header" href="#return-value-132">Return Value</a></h4>
<p>This method returns an <code>OServerConfiguration</code> value, which provides the current configuration of the OrientDB Server.</p>
<h3 id="example-79"><a class="header" href="#example-79">Example</a></h3>
<p>In cases where you need to operate on an instance of the <code>OServerConfiguration</code> class, you can retrieve the current configuration from the OrientDB Server.  You might use a method such as this in the class that manages your <a href="java/ref/OServer/../OServer.html"><code>OServer</code></a> instance.</p>
<pre><code class="language-java">/**
 * Retrieve OrientDB Server Configuration
 */
public OServerConfiguration fetchConfig(OServer oserver){

   // Log Operation
   logger.info("Retrieving OServer Configuration");

   return oserver.getConfiguration();
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oserver---getdatabasedirectory"><a class="header" href="#oserver---getdatabasedirectory">OServer - getDatabaseDirectory()</a></h1>
<p>This method returns the root directory for databases handled by the OrientDB Server.</p>
<h2 id="retrieving-database-directories"><a class="header" href="#retrieving-database-directories">Retrieving Database Directories</a></h2>
<p>When using the PLocal storage-type, OrientDB writes persistent data to the file system, with one directory for each database.  This method returns the root directory that the given <a href="java/ref/OServer/../OServer.html"><code>OServer</code></a> instance uses in storing databases.</p>
<h3 id="syntax-209"><a class="header" href="#syntax-209">Syntax</a></h3>
<pre><code>public String OServer().getDatabaseDirectory()
</code></pre>
<h4 id="return-value-133"><a class="header" href="#return-value-133">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a> value.  It provides the path to where the OrientDB Server stores its databases.</p>
<h3 id="example-80"><a class="header" href="#example-80">Example</a></h3>
<p>When OrientDB writes to PLocal storage, it writes the database to the file system in a particular directory.  Occasionally, you may need to operate on this directory or otherwise reference it elsewhere in your application.</p>
<pre><code class="language-java">/**
 * Retrieve and Log the Database Directory
 */
public String fetchDbDir(OServer oserver){

   // Log Operation
   logger.info("Retrieving Database Directory");

   // Fetch Database Directory
   String path = oserver.getDatabaseDirectory();

   // Report Location for Debugging
   logger.debug("Database Directory: " + path);

   // Return Directory Path
   return path;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oserver---getinstance"><a class="header" href="#oserver---getinstance">OServer - getInstance()</a></h1>
<p>This method retrieves the given instance of an OrientDB Server by its Server ID.</p>
<h2 id="retrieving-oserver-instances"><a class="header" href="#retrieving-oserver-instances">Retrieving <code>OServer</code> Instances</a></h2>
<p>In addition to starting an embedded instance of the OrientDB Server, you can also retrieve a particular <a href="java/ref/OServer/../OServer.html"><code>OServer</code></a> instance, as identified by its Server ID.  If you want to retrieve the server instance by its path, see the <a href="java/ref/OServer/getInstanceByPath.html"><code>getInstanceByPath()</code></a> method.</p>
<h3 id="syntax-210"><a class="header" href="#syntax-210">Syntax</a></h3>
<pre><code>public static OServer OServer().getInstance(String iServerId)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>iServerId</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>java.lang.String</code></a></td><td>Defines the Server ID you want to retrieve.</td></tr>
</tbody></table>
</div>
<h4 id="return-value-134"><a class="header" href="#return-value-134">Return Value</a></h4>
<p>This method returns an <a href="java/ref/OServer/../OServer.html"><code>OServer</code></a> instance.</p>
<h3 id="example-81"><a class="header" href="#example-81">Example</a></h3>
<p>Imagine you have OrientDB running in a distributed deployment and have an operation that you need to run on several servers in sequence.  You might use a method such as this to convert a list of Server ID's into one of active <a href="java/ref/OServer/../OServer.html"><code>OServer</code></a> instances.</p>
<pre><code class="language-java">/**
 * Retrieve OServer Instances by ID
 */
public List&lt;OServer&gt; fetchOServers(OServer oserver, List&lt;String&gt; ids){

   // Log Operation
   logger.info("Fetching OrientDB Servers");

   // Initialize Variables
   List&lt;OServer&gt; oservers;

   // Loop Over Server ID's
   for (int i = 0; i &lt; ids.size(); i++){

      // Retrieve ID
      String id = ids.get(i);

	  // Retrieve OServer
	  oservers.add(oserver.getInstance(id));

   }

   // Return OServer List
   return oservers;

}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oserver---getinstancebypath"><a class="header" href="#oserver---getinstancebypath">OServer - getInstanceByPath()</a></h1>
<p>This method retrieves the given instance of an OrientDB Server by its path.</p>
<h2 id="retrieving-oserver-instances-1"><a class="header" href="#retrieving-oserver-instances-1">Retrieving <code>OServer</code> Instances</a></h2>
<p>In addition to starting an embedded instance of the OrientDB Server, you can also retrieve a particular <a href="java/ref/OServer/../OServer.html"><code>OServer</code></a> instance, as identified by its path.  If you want to retrieve the server instance by its ID, see the <a href="java/ref/OServer/getInstance.html"><code>getInstance()</code></a> method.</p>
<h3 id="syntax-211"><a class="header" href="#syntax-211">Syntax</a></h3>
<pre><code>public static OServer OServer().getInstanceByPath(String iPath)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>iPath</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>java.lang.String</code></a></td><td>Defines the sever path you want to retrieve.</td></tr>
</tbody></table>
</div>
<h4 id="return-value-135"><a class="header" href="#return-value-135">Return Value</a></h4>
<p>This method returns an <a href="java/ref/OServer/../OServer.html"><code>OServer</code></a> value.  It provides you with an instance of the OrientDB Server running on the given path.</p>
<h3 id="example-82"><a class="header" href="#example-82">Example</a></h3>
<p>Imagine you have OrientDB running in a distributed deployment and have an operation that you need to run on several servers in sequence.  You might use a method such as this to convert a list of server paths into one of active <a href="java/ref/OServer/../OServer.html"><code>OServer</code></a> instances.</p>
<pre><code class="language-java">/**
 * Retrieve OServer Instances by Path 
 */
public List&lt;OServer&gt; fetchOServers(OServer oserver, List&lt;String&gt; paths){

   // Log Operation
   logger.info("Fetching OrientDB Servers");

   // Initialize Variables
   List&lt;OServer&gt; oservers;

   // Loop Over Server ID's
   for (int i = 0; i &lt; paths.size(); i++){

      // Retrieve ID
      String path = path.get(i);

	  // Retrieve OServer
	  oservers.add(oserver.getInstanceByPath(path));

   }

   // Return OServer List
   return oservers;

}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oserver---getstoragepath"><a class="header" href="#oserver---getstoragepath">OServer - getStoragePath()</a></h1>
<p>Retrieves the path to the storage-type used by the OrientDB Server.</p>
<h2 id="retrieving-storage-path"><a class="header" href="#retrieving-storage-path">Retrieving Storage Path</a></h2>
<p>In cases where you need the storage-path used by the OrientDB Server, such as to log it for debugging or as part of a larger operation, this method retrieves it for you.</p>
<h3 id="syntax-212"><a class="header" href="#syntax-212">Syntax</a></h3>
<pre><code>public String OServer().getStoragePath(String iName)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>iName</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>java.lang.String</code></a></td><td>Defines the name of the storage-type.</td></tr>
</tbody></table>
</div>
<h4 id="return-value-136"><a class="header" href="#return-value-136">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a> value.  It provides the path to OrientDB storages.</p>
<h3 id="example-83"><a class="header" href="#example-83">Example</a></h3>
<p>Consider a use case where you need to retrieve the storage path to pass it to some other method as part of a larger operation.  You might use a method like this in the class managing the OrientDB Server to retrieve the storage path and log it for debugging purposes before returning the value.</p>
<pre><code class="language-java">/**
 * Retrieve and Log the Storage Path 
 */
public String fetchStoragePath(OServer oserver){

   // Log Operation
   logger.info("Retrieving Storage Path");

   // Fetch Storage Path 
   String path = oserver.getStoragePath();

   // Report Location for Debugging
   logger.debug("Storage Path" + path);

   // Return Sotrage Path 
   return path;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oserver---isactive"><a class="header" href="#oserver---isactive">OServer - isActive()</a></h1>
<p>This method tests whether the server instance is currently active.</p>
<h2 id="checking-server-active"><a class="header" href="#checking-server-active">Checking Server Active</a></h2>
<p>You may find occasions where your application receives an <a href="java/ref/OServer/../OServer.html"><code>OServer</code></a> instance as a return value from other operations or threads.  This method provides you with a simple check to determine whether the server instance is currently active using the boolean return value.</p>
<h3 id="syntax-213"><a class="header" href="#syntax-213">Syntax</a></h3>
<pre><code>public boolean OServer().isActive()
</code></pre>
<h4 id="return-value-137"><a class="header" href="#return-value-137">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>boolean</code></a> value.  If the return value is <code>true</code>, it indicates that the OrientDB Server instance is active.</p>
<h3 id="example-84"><a class="header" href="#example-84">Example</a></h3>
<p>Imagine you that you have created a basic handler in your application that takes an <a href="java/ref/OServer/../OServer.html"><code>OServer</code></a> instance as a constructor argument.  When it receives the server instance, it checks whether it is active and activates it in the event that it is not.</p>
<pre><code class="language-java">// IMPORTS
import com.orientechnologies.orient.server.OServer;
import java.util.logging.Logger;
/*
 * Handler class for OrientDB Databases
 * @author: Some Dev &lt;some.dev@example.com&gt;
 * @version: 10.4
 * @since: 1.0
 */
class DatabaseHandler {

	// INIT LOGGER
	private static final Logger logger = Logger.getLogger(
		DatabaseHandler.class.getName());

	/*
	 * Constructor Method
	 * @param server: OServer instance
	 */
	public void DatabaseHandler(OServer server) {

		// CHECK THAT SERVER IS ACTIVE
		if !(server.isActive()) {
			logger.info("Server inactive, activating");
		
			// ACTIVATE SERVER
			server.activate();

		}
	
	}
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oserver---isallowed"><a class="header" href="#oserver---isallowed">OServer - isAllowed()</a></h1>
<p>This method determines whether a user is allowed to operate the given resource.</p>
<h2 id="checking-users"><a class="header" href="#checking-users">Checking Users</a></h2>
<p>Different users have different levels of access to the OrientDB Server.  When a user attempts an operation that exceeds their access, it raises an exception.  Rather than providing all options and letting the user fail, you can use this method to perform a basic check, determining what they can do before giving the option.</p>
<h3 id="syntax-214"><a class="header" href="#syntax-214">Syntax</a></h3>
<pre><code>public boolean OServer().isAllowed(String user, String resource)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>user</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>java.lang.String</code></a></td><td>Defines the user you want to check.</td></tr>
<tr><td><strong><code>resource</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>java.lang.String</code></a></td><td>Defines the resource you want to check.</td></tr>
</tbody></table>
</div>
<h4 id="return-value-138"><a class="header" href="#return-value-138">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>boolean</code></a> value.  If the return value is <code>true</code>, it indicates that the user has permission to access the given resource.</p>
<h3 id="example-85"><a class="header" href="#example-85">Example</a></h3>
<p>Consider the use case of an application that needs to perform several operations on various OrientDB Servers.  In the class that manages the server, you might want to create a method to streamline these operations into a basic check that can be called wherever you need it in the class.</p>
<pre><code class="language-java">private OServer oserver;
private String currentUser;
private String currentResource;
...

/**
 * Check Permission
 */
public Boolean checkResource(){
   return oserver.isAllowed(currentUser, currentResource);
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oserver---opendatabase"><a class="header" href="#oserver---opendatabase">OServer - openDatabase()</a></h1>
<p>This method opens a database on the OrientDB Server.</p>
<h2 id="opening-databases-1"><a class="header" href="#opening-databases-1">Opening Databases</a></h2>
<p>In order to operate on databases on a given <a href="java/ref/OServer/../OServer.html"><code>OServer</code></a> instance, you first need to open the database.  Databases have separate login credentials from the OrientDB Server.</p>
<h3 id="syntax-215"><a class="header" href="#syntax-215">Syntax</a></h3>
<p>There are several methods available, depending on which arguments you want to use in opening the given database and what you would like the method to return.</p>
<pre><code>public ODatabase&lt;T&gt; OServer().openDatabase(String iDbURL,
		OToken iToken)

public ODatabase&lt;T&gt; OServer().openDatabase(String iDbURL,
		String user, String passwd)

public ODatabase&lt;T&gt; OServer().openDatabase(String iDbURL,
		String user, String passwd, ONetworkProtocolData data)

public ODatabaseDocumentTx OServer().openDatabase(String iDbURL,
		String user, String passwd, ONetworkProtocolData data,
		Boolean iBypassAccess)

public ODatabaseDocumentTx OServer().openDatabase(ODatabaseDocumentTx database,
		String user, String passwd, ONetworkProtocolData data,
		Boolean iBypassAccess)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>iDbURL</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>java.lang.String</code></a></td><td>Defines the URL to the database.</td></tr>
<tr><td><strong><code>user</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>java.lang.String</code></a></td><td>Defines the user to open the database.</td></tr>
<tr><td><strong><code>passwd</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>java.lang.String</code></a></td><td>Defines the password for the user.</td></tr>
<tr><td><strong><code>data</code></strong></td><td><code>ONetworkProtocolData</code></td><td>Defines the network protocol for the connection.</td></tr>
<tr><td><strong><code>iBypassAccess</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>java.lang.Boolean</code></a></td><td>Defines whether to bypass authentication in opening the database.</td></tr>
<tr><td><strong><code>database</code></strong></td><td><a href="java/ref/OServer/../ODatabaseDocument.html"><code>ODatabaseDocument</code></a></td><td>Defines the database to open.</td></tr>
</tbody></table>
</div>
<h4 id="return-value-139"><a class="header" href="#return-value-139">Return Value</a></h4>
<p>This method returns an <code>ODatabase&lt;T&gt;</code> value, where <code>T</code> is a generic for any OrientDB database types.</p>
<ul>
<li><code>ODatabaseDocumentTx</code></li>
<li><code>OrientGraph</code></li>
<li><code>OObjectDatabaseTx</code></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oserver---restart"><a class="header" href="#oserver---restart">OServer - restart()</a></h1>
<p>This method restarts the OrientDB Server instance.</p>
<h2 id="restarting-the-server"><a class="header" href="#restarting-the-server">Restarting the Server</a></h2>
<p>When you have an instance of <a href="java/ref/OServer/../OServer.html"><code>OServer</code></a> that's already running, calling this method lets you stop the server and restart it.</p>
<h3 id="syntax-216"><a class="header" href="#syntax-216">Syntax</a></h3>
<pre><code>public void OServer().restart()
</code></pre>
<h4 id="exceptions-3"><a class="header" href="#exceptions-3">Exceptions</a></h4>
<p>This method throws the following exceptions:</p>
<ul>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/ClassNotFoundException.html"><code>ClassNotFoundException</code></a></li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/InvocationTargetException.html"><code>InvocationTargetException</code></a></li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/InstantiationException.html"><code>InstantiationException</code></a></li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/NoSuchMethodException.html"><code>NoSuchMethodException</code></a></li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/IllegalAccessException.html"><code>IllegalAccessException</code></a></li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/io/IOException.html"><code>IOException</code></a></li>
</ul>
<h3 id="example-86"><a class="header" href="#example-86">Example</a></h3>
<p>Imagine you have a handler class for the <a href="java/ref/OServer/../OServer.html"><code>OServer</code></a> instances that you use in managing common operations with the OrientDB Server.  You might want to pass additional information to your logs when restarting the server, like the user or process calling for the restart.</p>
<pre><code class="language-java">// IMPORTS 
import com.orientechnologies.orient.server.OServer;
import java.util.logging.Logger;

/*
 * Handler Class for OrientDB Database 
 * @author: Some Dev &lt;some.dev@example.com&gt;
 * @version: 10.4
 * @since: 1.0
 */
class DatabaseHandler {

	// INIT LOGGER
	private static final Logger logger = Logger.getLogger(
		DatabaseHandler.class.getname());

	// CLASS VARIABLES
	private static OServer oserver;
	...

	/*
	 * Command to restart the OrientDB Server
	 * @param user: Defines the user requesting the restart
	 */
	public void restart(String user){

		// LOG OPERATION
		logger.info("OrientDB Server restart, (requested by ", user, ")");

		// RESTART ORIENTDB SERVER
		oserver.restart()
	
	}
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oserver---saveconfiguration"><a class="header" href="#oserver---saveconfiguration">OServer - saveConfiguration()</a></h1>
<p>This method saves the current server configuration to disk.</p>
<h2 id="saving-configuration"><a class="header" href="#saving-configuration">Saving Configuration</a></h2>
<p>Occasionally, you may want to operate on the OrientDB Server configuration from within your application.  When you modify the configuration, those changes remain volatile until you save them using this method.</p>
<h3 id="syntax-217"><a class="header" href="#syntax-217">Syntax</a></h3>
<pre><code>public void OServer().saveConfiguration()
</code></pre>
<h4 id="exceptions-4"><a class="header" href="#exceptions-4">Exceptions</a></h4>
<p>This method throws the following exception:</p>
<ul>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/io/IOException.html"><code>IOException</code></a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oserver---shutdown"><a class="header" href="#oserver---shutdown">OServer - shutdown()</a></h1>
<p>This method shuts down the OrientDB Server instance.</p>
<h2 id="shutting-down-the-server"><a class="header" href="#shutting-down-the-server">Shutting Down the Server</a></h2>
<p>When you finish working with the given <a href="java/ref/OServer/../OServer.html"><code>OServer</code></a> instance, you need to shut it down in order to free up resources.  This method lets you shutdown an embedded server from within your application.</p>
<h3 id="syntax-218"><a class="header" href="#syntax-218">Syntax</a></h3>
<pre><code>public boolean OServer().shutdown()
</code></pre>
<h4 id="return-value-140"><a class="header" href="#return-value-140">Return Value</a></h4>
<p>This method returns a <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html"><code>boolean</code></a> value. If the value is <code>true</code>, it indicates that the server was successfully shut down.</p>
<h3 id="example-87"><a class="header" href="#example-87">Example</a></h3>
<p>Imagine you have a handler class for the <a href="java/ref/OServer/../OServer.html"><code>OServer</code></a> instances that you use in managing common operations with the OrientDB Server.  You might want to pass additional information to your logs when shutting down the server, like the user or process calling for the restart.</p>
<pre><code class="language-java">// IMPORTS 
import com.orientechnologies.orient.server.OServer;
import java.util.logging.Logger;

/*
 * Handler Class for OrientDB Database 
 * @author: Some Dev &lt;some.dev@example.com&gt;
 * @version: 10.4
 * @since: 1.0
 */
class DatabaseHandler {

	// INIT LOGGER
	private static final Logger logger = Logger.getLogger(
		DatabaseHandler.class.getname());

	// CLASS VARIABLES
	private static OServer oserver;
	...

	/*
	 * Command to shut down the OrientDB Server
	 * @param user: Defines the user requesting the restart
	 */
	public void shutdown(String user){

		// LOG OPERATION
		logger.info("OrientDB Server shutting down, (requested by ", user, ")");

		// SHUTDOWN ORIENTDB SERVER
		oserver.shutdown()
	
	}
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="oserver---startup"><a class="header" href="#oserver---startup">OServer - startup()</a></h1>
<p>This method starts the given server instance.</p>
<h2 id="starting-the-server"><a class="header" href="#starting-the-server">Starting the Server</a></h2>
<p>When you initialize an instance of <a href="java/ref/OServer/../OServer.html"><code>OServer</code></a>, it prepares the server within your application, but does not start it until you tell it you're ready to start.</p>
<h3 id="syntax-219"><a class="header" href="#syntax-219">Syntax</a></h3>
<p>There are several methods available in starting the embedded OrientDB server instance, which you use depends on what information you have available.  Bear in mind, that these methods do not all throw the same exceptions.</p>
<pre><code>public OServer OServer().startup()

public OServer OServer().startup(File iConfigurationFile)

public OServer OServer().startup(String iConfiguration)

public OServer OServer().startup(InputStream iInputStream)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>iConfigurationFile</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html"><code>java.io.File</code></a></td><td>Defines the server configuration file, as a file instance.</td></tr>
<tr><td><strong><code>iConfiguration</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>java.lang.String</code></a></td><td>Defines the server configuration, as a string.</td></tr>
<tr><td><strong><code>iInputStream</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/io/InputStream.html"><code>java.io.InputStream</code></a></td><td>Defines the server configuration, as an input stream.</td></tr>
</tbody></table>
</div>
<h4 id="return-value-141"><a class="header" href="#return-value-141">Return Value</a></h4>
<p>This method returns an <a href="java/ref/OServer/../OServer.html"><code>OServer</code></a> instance, which provides the started OrientDB embedded server.</p>
<h4 id="exceptions-5"><a class="header" href="#exceptions-5">Exceptions</a></h4>
<p>This method throws a number of exceptions.  The common exceptions to all methods are,</p>
<ul>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/InstantiationException.html"><code>InstantiationException</code></a></li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/IllegalAccessException.html"><code>IllegalAccessException</code></a></li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/ClassNotFoundException.html"><code>ClassNotFoundException</code></a></li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/IllegalArgumentException.html"><code>IllegalArgumentException</code></a></li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/SecurityException.html"><code>SecurityException</code></a></li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/InvocationTargetException.html"><code>InvocationTargetException</code></a></li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/NoSuchMethodException.html"><code>NoSuchMethodException</code></a></li>
</ul>
<p>Additionally, when you pass the server configuration as a string or input stream, the following exception can be thrown.</p>
<ul>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/io/IOException.html"><code>IOException</code></a></li>
</ul>
<h3 id="example-88"><a class="header" href="#example-88">Example</a></h3>
<p>Imagine your application has its own configuration file, which among other things contains a parameter in which the user can define the path to the OrientDB Server configuration they want to use.  Rather than accepting this value without issue, you may want to catch <code>IOException</code> exceptions, starting the server with its default configuration in the event that the given argument fails.  This ensures that the OrientDB Server always starts.</p>
<pre><code class="language-java">// IMPORTS
import com.orientechnologies.orient.server.OServer;
import java.util.logging.Logger;
import java.io.IOException;

/*
 * Handler Class for OrientDB Database 
 * @author: Some Dev &lt;some.dev@example.com&gt;
 * @version: 10.4
 * @since: 1.0
 */
class DatabaseHandler {

	// INIT LOGGER
	private static final Logger logger = Logger.getLogger(
		DatabaseHandler.class.getName());

	/* 
	 * Constructor
	 * @param server: OServer instance
	 * @param myConfig: Path to configuration file for OrientDB Server
	 */
	public void DatabaseHandler(OServer server, String myConfig) {

		// Log Operation
		logger.info("Initializing DatabaseHandler class");

		try {
			// TRY GIVEN CONFIG
			server.startup(myConfig);
		} catch IOException {
			logger.warning(
				"Unable to start with given configuration, loading default");

			// START WITH DEFAULT CONFIG
			server.startup();
		
		}
	}
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="otransaction"><a class="header" href="#otransaction">OTransaction</a></h1>
<p>This method provides an interface for working with transactions.</p>
<h2 id="using-transactions"><a class="header" href="#using-transactions">Using Transactions</a></h2>
<p>In order to operate on the transaction within your application, you need to import it into your application.</p>
<pre><code class="language-java">import com.orientechnologies.orient.core.tx.OTransaction;
</code></pre>
<h3 id="methods-19"><a class="header" href="#methods-19">Methods</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Return Type</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="java/ref/OTransaction/amountOfNestedTxs.html"><strong><code>amountOfNestedTxs()</code></strong></a></td><td><code>int</code></td><td>Returns the number of transactions attached to this instance</td></tr>
<tr><td><a href="java/ref/OTransaction/begin.html"><strong><code>begin()</code></strong></a></td><td><code>void</code></td><td>Initiates the transaction</td></tr>
<tr><td><a href="java/ref/OTransaction/close.html"><strong><code>close()</code></strong></a></td><td><code>void</code></td><td>Closes the transaction</td></tr>
<tr><td><a href="java/ref/OTransaction/commit.html"><strong><code>commit()</code></strong></a></td><td><code>void</code></td><td>Commits the transaction</td></tr>
<tr><td><a href="java/ref/OTransaction/getDatabase.html"><strong><code>getDatabase()</code></strong></a></td><td><a href="java/ref/ODatabaseDocument.html"><code>ODatabaseDocument</code></a></td><td>Retrieves the database</td></tr>
<tr><td><a href="java/ref/OTransaction/getEntryCount.html"><strong><code>getEntryCount()</code></strong></a></td><td><code>int</code></td><td>Retrieves the number of entries in the transaction</td></tr>
<tr><td><a href="java/ref/OTransaction/getInvolvedIndexes.html"><strong><code>getInvolvedIndexes()</code></strong></a></td><td><code>List&lt;String&gt;</code></td><td>Retrieves indexes used in the transaction</td></tr>
<tr><td><a href="java/ref/OTransaction/getIsolationLevel.html"><strong><code>getIsolationLevel()</code></strong></a></td><td><code>OTransaction.ISOLATION_LEVEL</code></td><td>Retrieves the transaction Isolation Level</td></tr>
<tr><td><a href="java/ref/OTransaction/getNewRecordEntriesByClass.html"><strong><code>getNewRecordEntriesByClass()</code></strong></a></td><td><a href="java/ref/ORecordOperation.html"><code>List&lt;ORecordOperation&gt;</code></a></td><td>Retrieves a list of record operations by <a href="java/ref/OClass.html"><code>OClass</code></a> from the transaction</td></tr>
<tr><td><a href="java/ref/OTransaction/getNewRecordEntriesByCluster.html"><strong><code>getNewRecordEntriesByCluster()</code></strong></a></td><td><a href="java/ref/ORecordOperation.html"><code>List&lt;ORecordOperation&gt;</code></a></td><td>Retrieves a list of record operation by <a href="java/ref/OCluster.html"><code>OCluster</code></a> from the transaction</td></tr>
<tr><td><a href="java/ref/OTransaction/getRecordEntry.html"><strong><code>getRecordEntry()</code></strong></a></td><td><a href="java/ref/ORecordOperation.html"><code>ORecordOperation</code></a></td><td>Retrieves a record operation from the transaction</td></tr>
<tr><td><a href="java/ref/OTransaction/getRecordOperations.html"><strong><code>getRecordOperations()</code></strong></a></td><td><a href="java/ref/ORecordOperation.html"><code>Iterable&lt;? extends ORecordOperation&gt;</code></a></td><td>Retrieves record operations from the transaction</td></tr>
<tr><td><a href="java/ref/OTransaction/getStatus.html"><strong><code>getStatus()</code></strong></a></td><td><code>OTransaction.TXSTATUS</code></td><td>Retrieves the transaction status</td></tr>
<tr><td><a href="java/ref/OTransaction/hasRecordCreation.html"><strong><code>hasRecordCreation()</code></strong></a></td><td><code>boolean</code></td><td>Indicates whether any records were created in the transaction</td></tr>
<tr><td><a href="java/ref/OTransaction/rollback.html"><strong><code>rollback()</code></strong></a></td><td><code>void</code></td><td>Reverts changes from the transaction</td></tr>
<tr><td><a href="java/ref/OTransaction/setIsolationLevel.html"><strong><code>setIsolationLevel()</code></strong></a></td><td><code>OTransaction</code></td><td>Sets the transaction Isolation Level</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="otransaction---amountofnestedtxs"><a class="header" href="#otransaction---amountofnestedtxs">OTransaction - amountOfNestedTxs()</a></h1>
<p>Returns the number of transactions nested in the current instance.</p>
<h2 id="nesting-transactions"><a class="header" href="#nesting-transactions">Nesting Transactions</a></h2>
<p>OrientDB does not support nested transactions.  Instead, further calls to <a href="java/ref/OTransaction/begin.html"><code>begin()</code></a> are applied to the current transaction, which keeps track of the call stack to let the final <a href="java/ref/OTransaction/commit.html"><code>commit()</code></a> commit the transaction.  Using this method, you can see how many transactions have been set on this <a href="java/ref/OTransaction/../OTransaction.html"><code>OTransaction</code></a> instance.</p>
<h3 id="syntax-220"><a class="header" href="#syntax-220">Syntax</a></h3>
<pre><code>int OTransaction().amountOfNestedTxs()
</code></pre>
<h4 id="return-value-142"><a class="header" href="#return-value-142">Return Value</a></h4>
<p>This method returns an <code>int</code>, which represents the number of nested transactions.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="otransaction---begin"><a class="header" href="#otransaction---begin">OTransaction - begin()</a></h1>
<p>Initiates the transaction.</p>
<h2 id="beginning-transactions-3"><a class="header" href="#beginning-transactions-3">Beginning Transactions</a></h2>
<p>OrientDB supports the use of transactions to isolate database operations and roll back or save changes once the task is complete. Using this method, you can begin a transaction. To roll it back later, see the <a href="java/ref/OTransaction/rollback.html"><code>rollback()</code></a> method.  To save it to the database, see <a href="java/ref/OTransaction/commit.html"><code>commit()</code></a> method.</p>
<h3 id="syntax-221"><a class="header" href="#syntax-221">Syntax</a></h3>
<pre><code>void OTransaction().begin()
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="otransaction---close"><a class="header" href="#otransaction---close">OTransaction - close()</a></h1>
<p>Closes the transaction.</p>
<h2 id="closing-transactions"><a class="header" href="#closing-transactions">Closing Transactions</a></h2>
<p>Using this method, you can close the transaction in your application, freeing up resources for other purposes.</p>
<h3 id="syntax-222"><a class="header" href="#syntax-222">Syntax</a></h3>
<pre><code>void OTransaction().close()
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="otransaction---commit"><a class="header" href="#otransaction---commit">OTransaction - commit()</a></h1>
<p>Commits the transaction to the database.</p>
<h2 id="beginning-transactions-4"><a class="header" href="#beginning-transactions-4">Beginning Transactions</a></h2>
<p>OrientDB supports the use of transactions to isolate database operations and roll back or save changes once the task is complete. Using this method, you can commit a transaction. To roll it back later, see the <a href="java/ref/OTransaction/rollback.html"><code>rollback()</code></a> method.  To initiate it, see <a href="java/ref/OTransaction/begin.html"><code>begin()</code></a> method.</p>
<h3 id="syntax-223"><a class="header" href="#syntax-223">Syntax</a></h3>
<pre><code>void OTransaction().commit()

void OTransaction().commit)(boolean force)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>force</code></strong></td><td><code>boolean</code></td><td>Defines whether to force the commit</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="otransaction---getdatabase"><a class="header" href="#otransaction---getdatabase">OTransaction - getDatabase()</a></h1>
<p>Retrieves the database on which the transaction is running.</p>
<h2 id="getting-databases"><a class="header" href="#getting-databases">Getting Databases</a></h2>
<p>Transactions run on particular databases, or more specifically within an <a href="java/ref/OTransaction/../ODatabaseDocument.html"><code>ODatabaseDocument</code></a> instance.  In the event that you need to operate on the database currently running the transaction, you can use this method to retrieve it.</p>
<h3 id="syntax-224"><a class="header" href="#syntax-224">Syntax</a></h3>
<pre><code>ODatabaseDocument OTransaction().getDatabase()
</code></pre>
<h4 id="return-value-143"><a class="header" href="#return-value-143">Return Value</a></h4>
<p>This method returns an <a href="java/ref/OTransaction/../ODatabaseDocument.html"><code>ODatabaseDocument</code></a> instance, which represents the database on which the transaction is running.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="otransaction---getentrycount"><a class="header" href="#otransaction---getentrycount">OTransaction - getEntryCount()</a></h1>
<p>Retrieves the number of entries in the transaction.</p>
<h2 id="counting-entries"><a class="header" href="#counting-entries">Counting Entries</a></h2>
<p>Whenever you execute a statement in a running transaction, the transaction records the entry.  Using this method, you can retrieve a count of the number of entries in the given transaction.</p>
<h3 id="syntax-225"><a class="header" href="#syntax-225">Syntax</a></h3>
<pre><code>int OTransaction().getEntryCount()
</code></pre>
<h4 id="return-value-144"><a class="header" href="#return-value-144">Return Value</a></h4>
<p>This method returns an <code>int</code> value, which represents the number of entries in the current transaction.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="otransaction---getinvolvedindexes"><a class="header" href="#otransaction---getinvolvedindexes">OTransaction - getInvolvedIndexes()</a></h1>
<p>Retrieves a list of indexes involved in the transaction.</p>
<h2 id="getting-indexes"><a class="header" href="#getting-indexes">Getting Indexes</a></h2>
<p>When you add a query or command to a transaction, the transaction keeps a record of the indexes called.  Using this method you can retrieve a list of all the indexes involved in the transaction.</p>
<h3 id="syntax-226"><a class="header" href="#syntax-226">Syntax</a></h3>
<pre><code>List&lt;String&gt; OTransaction().getInvolvedIndexes()
</code></pre>
<h4 id="return-value-145"><a class="header" href="#return-value-145">Return Value</a></h4>
<p>This method returns a <code>List</code> of <code>String</code> values, each <code>String</code> representing an involved index.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="otransaction---getisolationlevel"><a class="header" href="#otransaction---getisolationlevel">OTransaction - getIsolationLevel()</a></h1>
<p>Retrieves the isolation level of the transaction.</p>
<h2 id="isolation-levels-in-orientdb"><a class="header" href="#isolation-levels-in-orientdb">Isolation Levels in OrientDB</a></h2>
<p>OrientDB supports the use of different levels of isolation based on settings and configuration.  Using this method you can retrieve the current isolation level on the transaction.</p>
<h3 id="syntax-227"><a class="header" href="#syntax-227">Syntax</a></h3>
<pre><code>OTransaction.ISOLATION_LEVEL OTransaction().getIsolationLevel()
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="otransaction---getnewrecordentriesbyclass"><a class="header" href="#otransaction---getnewrecordentriesbyclass">OTransaction - getNewRecordEntriesByClass()</a></h1>
<p>Retrieves a list of records of the given class added to the database by this transaction.</p>
<h2 id="retrieving-records-1"><a class="header" href="#retrieving-records-1">Retrieving Records</a></h2>
<p>During transactions you may occasionally or often need to write to the database.  Using this method you can retrieve a list of records modified by the current transaction that belong to the given class.</p>
<h3 id="syntax-228"><a class="header" href="#syntax-228">Syntax</a></h3>
<pre><code>List&lt;ORecordOperation&gt; OTransaction().getNewRecordEntriesByClass(
   OClass class,
   boolean isPolymorphic)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>class</code></strong></td><td><a href="java/ref/OTransaction/../OClass.html"><code>OClass</code></a></td><td>Defines the class you want to check for new records</td></tr>
<tr><td><strong><code>isPolymorphic</code></strong></td><td><code>boolean</code></td><td>Defines whether to check subclasses as well as the given class</td></tr>
</tbody></table>
</div>
<h4 id="return-value-146"><a class="header" href="#return-value-146">Return Value</a></h4>
<p>This method returns a <code>List</code> of <a href="java/ref/OTransaction/../ORecordOperation.html"><code>ORecordOperation</code></a> instances.  Each instance represents a record updated within the transaction.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="otransaction---getnewrecordentriesbycluster"><a class="header" href="#otransaction---getnewrecordentriesbycluster">OTransaction - getNewRecordEntriesByCluster()</a></h1>
<p>Retrieves a list of records of the given class added to the database by this transaction.</p>
<h2 id="retrieving-records-2"><a class="header" href="#retrieving-records-2">Retrieving Records</a></h2>
<p>During transactions you may occasionally or often need to write to the database.  Using this method you can retrieve a list of records modified by the current transaction that belong to the given cluster.</p>
<h3 id="syntax-229"><a class="header" href="#syntax-229">Syntax</a></h3>
<pre><code>List&lt;ORecordOperation&gt; OTransaction().getNewRecordEntriesByClass(
   int[] ids
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>ids</code></strong></td><td><code>int[]</code></td><td>Defines an array of Cluster ID's to check</td></tr>
</tbody></table>
</div>
<h4 id="return-value-147"><a class="header" href="#return-value-147">Return Value</a></h4>
<p>This method returns a <code>List</code> of <a href="java/ref/OTransaction/../ORecordOperation.html"><code>ORecordOperation</code></a> instances.  Each instance represents a record updated within the transaction.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="otransaction---getrecordentry"><a class="header" href="#otransaction---getrecordentry">OTransaction - getRecordEntry()</a></h1>
<p>Returns a record from the transaction.</p>
<h2 id="retrieving-records-3"><a class="header" href="#retrieving-records-3">Retrieving Records</a></h2>
<p>Using this method you can retrieve records from this transaction to further operate on them.  The record you want is identified by the given Record ID.</p>
<h3 id="syntax-230"><a class="header" href="#syntax-230">Syntax</a></h3>
<pre><code>ORecordOperation OTransaction().getRecordEntry(ORID rid)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>rid</strong></td><td><a href="java/ref/OTransaction/../ORID.html"><code>ORID</code></a></td><td>Defines the record you want.</td></tr>
</tbody></table>
</div>
<h4 id="return-type-33"><a class="header" href="#return-type-33">Return Type</a></h4>
<p>This method returns an <a href="java/ref/OTransaction/../ORecordOperation.html"><code>ORecordOperation</code></a> instance for the requested record.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="otransaction---getrecordoperations"><a class="header" href="#otransaction---getrecordoperations">OTransaction - getRecordOperations()</a></h1>
<p>Retrieves all the records from the transaction.</p>
<h2 id="retrieving-record-operations"><a class="header" href="#retrieving-record-operations">Retrieving Record Operations</a></h2>
<p>The transaction keeps track of the operations you perform on database records.  Using this method, you can retrieve all the record operations in the given transaction to further operate on them.</p>
<h3 id="syntax-231"><a class="header" href="#syntax-231">Syntax</a></h3>
<pre><code>Iterable&lt;? extends ORecordOperation&gt; OTransaction().getRecordOperations()
</code></pre>
<h4 id="return-value-148"><a class="header" href="#return-value-148">Return Value</a></h4>
<p>This method returns an <code>Iterable</code> instance that contains an <a href="java/ref/OTransaction/../ORecordOperation.html"><code>ORecordOperation</code></a> for the records modified by the transaction.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="otransaction---getstatus"><a class="header" href="#otransaction---getstatus">OTransaction - getStatus()</a></h1>
<p>Retrieves the status of the transaction.</p>
<h2 id="transaction-status"><a class="header" href="#transaction-status">Transaction Status</a></h2>
<p>Transactions have status, indicating where they are in the process.  That is, started, committing, rolling back, and so on.  Using this method, you can retrieve the current status of the transaction.</p>
<h3 id="syntax-232"><a class="header" href="#syntax-232">Syntax</a></h3>
<pre><code>OTransaction.TXSTATUS OTransaction().getStatus()
</code></pre>
<h4 id="return-type-34"><a class="header" href="#return-type-34">Return Type</a></h4>
<p>This method returns an <code>OTransaction.TXSTATUS</code> object, which is one of the following:</p>
<div class="table-wrapper"><table><thead><tr><th>Enum Constants</th><th>Description</th></tr></thead><tbody>
<tr><td><code>BEGUN</code></td><td>The transaction has started</td></tr>
<tr><td><code>COMMITTING</code></td><td>The transaction is being committed to the database</td></tr>
<tr><td><code>COMPLETED</code></td><td>The transaction is committed</td></tr>
<tr><td><code>INVALID</code></td><td>The transaction has encountered an error</td></tr>
<tr><td><code>ROLLBACKING</code></td><td>The transaction is being rolled back</td></tr>
<tr><td><code>ROLLED_BACK</code></td><td>The transaction has been reverted</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="otransaction---hasrecordcreation"><a class="header" href="#otransaction---hasrecordcreation">OTransaction - hasRecordCreation()</a></h1>
<p>Determines whether the transaction has created records.</p>
<h2 id="checking-records"><a class="header" href="#checking-records">Checking Records</a></h2>
<p>Using this method you can check whether any records have been created as part of the transaction.</p>
<h3 id="syntax-233"><a class="header" href="#syntax-233">Syntax</a></h3>
<pre><code>boolean OTransaction().hasRecordCreation()
</code></pre>
<h4 id="return-value-149"><a class="header" href="#return-value-149">Return Value</a></h4>
<p>This method returns a <code>boolean</code> value.  A value of <code>true</code> indicates that the transaction includes record creation.  <code>false</code> indicates that no records are created in the transaction.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="otransaction---rollback"><a class="header" href="#otransaction---rollback">OTransaction - rollback()</a></h1>
<p>Reverts the transaction to earlier state.</p>
<h2 id="beginning-transactions-5"><a class="header" href="#beginning-transactions-5">Beginning Transactions</a></h2>
<p>OrientDB supports the use of transactions to isolate database operations and roll back or save changes once the task is complete. Using this method, you can roll a transaction back.  To initiate it, see the <a href="java/ref/OTransaction/begin.html"><code>begin()</code></a> method.  To save it to the database, see the <a href="java/ref/OTransaction/commit.html"><code>commit()</code></a> method.</p>
<h3 id="syntax-234"><a class="header" href="#syntax-234">Syntax</a></h3>
<pre><code>void OTransaction().rollback()

void OTransaction().rollback(boolean force)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>force</code></strong></td><td><code>boolean</code></td><td>Defines whether to force the rollback</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="otransaction---setisolationlevel"><a class="header" href="#otransaction---setisolationlevel">OTransaction - setIsolationLevel()</a></h1>
<p>Retrieves the isolation level of the transaction.</p>
<h2 id="isolation-levels-in-orientdb-1"><a class="header" href="#isolation-levels-in-orientdb-1">Isolation Levels in OrientDB</a></h2>
<p>OrientDB supports the use of different levels of isolation based on settings and configuration.  Using this method you can set the isolation level for the transaction.</p>
<h3 id="syntax-235"><a class="header" href="#syntax-235">Syntax</a></h3>
<pre><code>OTransaction OTransaction().setIsolationLevel(OTransaction.ISOLATION_LEVEL level)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>level</code></strong></td><td><code>OTransaction.ISOLATION_LEVEL</code></td><td>Defines the isolation level</td></tr>
</tbody></table>
</div>
<p>The given Isolation Level belongs to one of the enumerated constants: <code>READ_COMMITTED</code> or <code>REPEATABLE_READ</code>.</p>
<h4 id="return-value-150"><a class="header" href="#return-value-150">Return Value</a></h4>
<p>This method returns the <a href="java/ref/OTransaction/../OTransaction.html"><code>OTransaction</code></a> instance.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="java-api---otype"><a class="header" href="#java-api---otype">Java API - OType</a></h1>
<p>This class provides a standard interface for handling data-types within the database.</p>
<h2 id="managing-types"><a class="header" href="#managing-types">Managing Types</a></h2>
<p>Properties on a database class have types and can enforce type-based constraints on the data the class allows for its records.  OrientDB uses the <code>OType</code> class to define the data-types for the property and to provide methods for common operations performed on data-types for the property.</p>
<p>This class is available at <code>com.orientechnologies.orient.core.metadata.schema</code>:</p>
<pre><code class="language-java">import com.orientechnologies.orient.core.metadata.schema.OType;
</code></pre>
<p>For more information on types, see <a href="java/ref/../../general/Types.html">Types</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="java-api---overtex"><a class="header" href="#java-api---overtex">Java API - OVertex</a></h1>
<p>This class provides a standard interface for handling vertices.</p>
<h2 id="managing-vertices"><a class="header" href="#managing-vertices">Managing Vertices</a></h2>
<p>When using OrientDB as a Graph database, this class represents a vertex record.  It extends the <a href="java/ref/OElement.html"><code>OElement</code></a> class.  Methods available to that class are also available to this class.</p>
<p>This class is available at <code>com.orientechnologies.orient.core.record</code>.  To import it, use the following line where necessary:</p>
<pre><code class="language-java">import com.orientechnologies.orient.core.record.OVertex;
</code></pre>
<p>Once you've imported the class to your application, you can use it to build instances in your code.</p>
<blockquote>
<p>For more information on edges, see <a href="java/ref/OEdge.html"><code>OEdge</code></a></p>
</blockquote>
<h3 id="example-89"><a class="header" href="#example-89">Example</a></h3>
<p>To create a new instance of this class, it is recommended that you use either the <a href="java/ref/ODatabaseDocument/newInstance.html"><code>newInstance()</code></a> or <a href="java/ref/ODatabaseDocument/newVertex.html"><code>newVertex()</code></a> methods on the <a href="java/ref/ODatabaseDocument.html"><code>ODatabaseDocument</code></a> class interface.  This allows you to operate on the given record and to easily save it back to the database when you're ready.</p>
<p>[TBD]</p>
<h2 id="methods-20"><a class="header" href="#methods-20">Methods</a></h2>
<p>Once you've created or initialized an <code>OVertex</code> instance, you can begin to call methods on it to further define and read data from the vertex.  This method extends the <a href="java/ref/OElement.html"><code>OElement</code></a> class.  Methods available to that class are also available to this one.</p>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Return Type</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="java/ref/OVertex/addEdge.html"><strong><code>addEdge()</code></strong></a></td><td><a href="java/ref/OEdge.html"><code>OEdge</code></a></td><td>Adds an edge to the vertex</td></tr>
<tr><td><a href="java/ref/OVertex/getEdges.html"><strong><code>getEdges()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Iterable.html"><code>Iterable</code></a><a href="java/ref/OEdge.html"><code>&lt;OEdge&gt;</code></a></td><td>Retrieve connected edges</td></tr>
<tr><td><a href="java/ref/OVertex/getVertices.html"><strong><code>getVertices()</code></strong></a></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Iterable.html"><code>Iterable</code></a><code>&lt;OVertex&gt;</code></td><td>Retrieve connected vertices</td></tr>
<tr><td><a href="java/ref/OVertex.html#saving-vertices"><strong><code>save()</code></strong></a></td><td><code>&lt;RET extends ORecord&gt; RET</code></td><td>Saves changes to the database</td></tr>
</tbody></table>
</div>
<h3 id="saving-vertices"><a class="header" href="#saving-vertices">Saving Vertices</a></h3>
<p>When you create or retrieve an <code>OVertex</code> instance, you create a snapshot of the record.  Any changes you make to the record remain in your application.  In order to make these changes persistent on the database, you need to call the <code>save()</code> method on the element.  For instance,</p>
<pre><code class="language-java">// GLOBAL VARIABLES
private ODatabaseDocument db;

// CREATE NEW RECORD
public void newRecord(String name, String email){

   // Initialize Document
   OVertex person = db.newVertex("Person");
   person.setProperty("name", name);
   person.setProperty("email", email);

   // Add Person to Database
   person.save();
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="overtex---addedge"><a class="header" href="#overtex---addedge">OVertex - addEdge()</a></h1>
<p>This method adds an edge linking this vertex to another.</p>
<h2 id="adding-edges"><a class="header" href="#adding-edges">Adding Edges</a></h2>
<p>In a Graph database, edges function as relationships linking different vertices together.  Using this method, you can link one <a href="java/ref/OVertex/../OVertex.html"><code>OVertex</code></a> instance to another.  You can create the edge as either a Lightweight Edge or a Regular Edge.</p>
<h3 id="syntax-236"><a class="header" href="#syntax-236">Syntax</a></h3>
<p>Records in OrientDB have their own classes on the database, which extend the <a href="java/ref/OVertex/../OClass.html"><code>OClass</code></a> class.  All edges are extensions of the <code>E</code> database class.  The first method creates the edge as an instance of the default <code>E</code> class.  The remaining methods allow you to define the class to which the new edge belongs.</p>
<pre><code>// METHOD 1 
OEdge OVertex().addEdge(OVertex toVertex)

// METHOD 2 
OEdge OVertex().addEdge(OVertex toVertex, OClass type)

// METHOD 3 
OEdge OVertex.addEdge(OVertex toVertex, String name)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>toVertex</code></strong></td><td><a href="java/ref/OVertex/../OVertex.html"><code>OVertex</code></a></td><td>Defines the vertex the edge connects to</td></tr>
<tr><td><strong><code>type</code></strong></td><td><a href="java/ref/OVertex/../OClass.html"><code>OClass</code></a></td><td>Defines the OrientDB database class the edge belongs to</td></tr>
<tr><td><strong><code>name</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the OrientDB database class the edge belongs to</td></tr>
</tbody></table>
</div>
<h4 id="return-value-151"><a class="header" href="#return-value-151">Return Value</a></h4>
<p>This method returns an <a href="java/ref/OVertex/../OEdge.html"><code>OEdge</code></a> instance, which represents the edge you've added to the vertex.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="overtex---getedges"><a class="header" href="#overtex---getedges">OVertex - getEdges()</a></h1>
<p>This method retrieves all connected edges to or from this vertex.</p>
<h2 id="retrieving-edges"><a class="header" href="#retrieving-edges">Retrieving Edges</a></h2>
<p>In a Graph database, edges represent relationships between vertices.  These relationships have a direction, leading from one vertex to another.  Using this method, you can retrieve all edges that connect to this vertex or connect from this vertex.</p>
<h3 id="syntax-237"><a class="header" href="#syntax-237">Syntax</a></h3>
<p>Edges in OrientDB have direction and class.  In the case of direction, the edge is created pointing from one vertex to another.  This direction is implemented as the <code>ODirection</code> class.  Additionally, edges like all records have classes internal to the database, which are implemented as <a href="java/ref/OVertex/../OClass.html"><code>OClass</code></a> instance.   On the database they either belong to the <code>E</code> class, or a class that extends the <code>E</code> class.</p>
<p>The first method uses the <code>E</code> class, and thus retrieves all edges that connect to or from the vertex.  The remaining methods allow you to define which database class of edges you want to retrieve.</p>
<pre><code>// METHOD 1
Iterable&lt;OEdge&gt; OVertex().getEdges(ODirection dir)

// METHOD 2
Iterable&lt;OEdge&gt; OVertex().getEdges(ODirection dir, OClass... type)

// METHOD 3
Iterable&lt;OEdge&gt; OVertex().getEdges(ODirection dir), String... name
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>dir</code></strong></td><td><code>ODirection</code></td><td>Defines the direction</td></tr>
<tr><td><strong><code>type</code></strong></td><td><a href="java/ref/OVertex/../OClass.html"><code>OClass</code></a></td><td>Defines the database class</td></tr>
<tr><td><strong><code>name</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the database class name</td></tr>
</tbody></table>
</div>
<h4 id="return-value-152"><a class="header" href="#return-value-152">Return Value</a></h4>
<p>This method returns an <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Iterable.html"><code>Iterable</code></a> instance that contains a series of <a href="java/ref/OVertex/../OEdge.html"><code>OEdge</code></a> instances representing the connected edges.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="overtex---getvertices"><a class="header" href="#overtex---getvertices">OVertex - getVertices()</a></h1>
<p>This method retrieves all vertices connected by edges to this vertex.</p>
<h2 id="retrieving-vertices-3"><a class="header" href="#retrieving-vertices-3">Retrieving Vertices</a></h2>
<p>In a Graph database, a vertex connects to other vertices through edges.  Using this method you can follow the given edges to retrieve the connected <a href="java/ref/OVertex/../OVertex.html"><code>OVertex</code></a> instances.</p>
<h3 id="syntax-238"><a class="header" href="#syntax-238">Syntax</a></h3>
<p>Edges in OrientDB have direction and all records are defined by a database class.  In the case of direction, the edge is created pointing from one vertex to another.  This direction is implemented as the <code>ODirection</code> class.  Records have classes internal to the database, which are implemented as the <a href="java/ref/OVertex/../OClass.html"><code>OClass</code></a> class.  Vertices on the database belong either to the <code>V</code> class or as a class that extends the <code>V</code> class.</p>
<p>The first method uses the default <code>V</code> class.  The other methods allow you to define what database class of vertices you want to retrieve.</p>
<pre><code>// METHOD 1
Iterable&lt;OVertex&gt; OVertex().getVertices(ODirection dir)

// METHOD 2
Iterable&lt;OVertex&gt; OVertex().getVertices(ODirection dir, OClass... type)

// METHOD 3
Iterable&lt;OVertex&gt; OVertex().getVertices(ODirection dir, String... name)
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>dir</code></strong></td><td><code>ODirection</code></td><td>Defines the direction to search</td></tr>
<tr><td><strong><code>type</code></strong></td><td><a href="java/ref/OVertex/../OClass.html"><code>OClass</code></a></td><td>Defines the database class</td></tr>
<tr><td><strong><code>name</code></strong></td><td><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html"><code>String</code></a></td><td>Defines the name of the database class</td></tr>
</tbody></table>
</div>
<h4 id="return-value-153"><a class="header" href="#return-value-153">Return Value</a></h4>
<p>This method returns an <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Iterable.html"><code>Iterable</code></a> instance that contains a series of <a href="java/ref/OVertex/../OVertex.html"><code>OVertex</code></a> instances representing the connected vertices.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="graph-api"><a class="header" href="#graph-api">Graph API</a></h1>
<blockquote>
<p>GroupId: <strong>com.orientechnologies</strong>  ArtifactId: <strong>orientdb-graphdb</strong></p>
</blockquote>
<h2 id="introduction-7"><a class="header" href="#introduction-7">Introduction</a></h2>
<p><a href="http://www.tinkerpop.com">Tinkerpop</a> provides a complete stack to handle Graph Databases:</p>
<ul>
<li>
<p><a href="http://wiki.github.com/tinkerpop/blueprints"><strong>Blueprints</strong></a> Provides a collection of interfaces and implementations to common, complex data structures.</p>
<p>In short, Blueprints provides a one-stop shop for implemented interfaces to help developers create software without getting tied down to the particular, underlying data management systems.</p>
</li>
<li>
<p><a href="http://pipes.tinkerpop.com"><strong>Pipes</strong></a> Provides a graph-based data flow framework for Java 1.6+.</p>
<p>Process graphs are composed of a set of process vertices connected to one another by a set of communication edges.  Pipes supports the splitting, merging, and transformation of data from input to output/</p>
</li>
<li>
<p><a href="http://wiki.github.com/tinkerpop/gremlin"><strong>Gremlin</strong></a> Provides a Turing-complete graph-based programming language designed for key/value pairs in multi-relational graphs.  Gremlin makes use of an XPath-like syntax to support complex graph traversals.  This language has applications in the areas of graph query, analysis, and manipulation.</p>
</li>
<li>
<p><a href="http://rexster.tinkerpop.com"><strong>Rexster</strong></a> Provides a RESTful graph shell that exposes any Blueprints graph as a standalone server.</p>
<p>Extensions support standard traversal goals such as search, score, rank, and (in concert) recommendation.  Rexster makes extensive use of Blueprints, Pipes, and Gremlin.  In this way it's possible to run Rexster over various graph systems.  to configure Rexster to work with OrientDB, see the guide <a href="java/../plugins/Rexster.html">Rexster Configuration</a>.</p>
</li>
<li>
<p><a href="https://github.com/tinkerpop/blueprints/wiki/Sail-Ouplementation"><strong>Sail Ouplementation</strong></a> Provides support for using OrientDB as an RDF Triple Store.</p>
</li>
</ul>
<h2 id="getting-started-with-blueprints"><a class="header" href="#getting-started-with-blueprints">Getting Started with Blueprints</a></h2>
<p>OrientDB supports three different kinds of storages, depending on the <a href="java/../datamodeling/Concepts.html#database-url">Database URL</a> used:</p>
<ul>
<li><strong>Persistent Embedded Graph Database</strong>: Links to the application as a JAR, (that is, with no network transfer).  Use <a href="java/../internals/Paginated-Local-Storage.html">PLocal</a> with the <code>plocal</code> prefix.  For instance, <code>plocal:/tmp/graph/test</code>.</li>
<li><strong>In-Memory Embedded Graph Database</strong>: Keeps all data in memory.  Use the <code>memory</code> prefix, for instance <code>memory:test</code>.</li>
<li><strong>Persistent Remote Graph Database</strong> Uses a binary protocol to send and receive data from a remote OrientDB server.  Use the <code>remote</code> prefix, for instance <code>remote:localhost/test</code> Note that this requires an OrientDB server instance up and running at the specific address, (in this case, localhost).  Remote databases can be persistent or in-memory as well.</li>
</ul>
<p>In order to use the Graph API, you need to create an instance of the <a href="http://www.orientechnologies.com/javadoc/latest/com/tinkerpop/blueprints/impls/orient/OrientGraph.html"><code>OrientGraph</code></a> class.  The constructor receives a <a href="java/../datamodeling/Concepts.html#database-url">Database URL</a> that is the location of the database.  If the database already exists, the Graph API opens it.  If it doesn't exist, the Graph API creates it.</p>
<blockquote>
<p><strong>NOTE</strong>: When creating a database through the Graph API, you can only create PLocal and Memory databases.  Remote databases must already exist.</p>
</blockquote>
<blockquote>
<p><strong>NOTE</strong>: In v. 2.2 and following releases, when using PLocal or Memory,please set MaxDirectMemorySize (JVM setting) to a high value, like 512g <code>-XX:MaxDirectMemorySize=512g</code></p>
</blockquote>
<p>When building multi-threaded application, use one instance of <a href="http://www.orientechnologies.com/javadoc/latest/com/tinkerpop/blueprints/impls/orient/OrientGraph.html"><code>OrientGraph</code></a> per thread.  Bear in mind that all graph components, such as vertices and edges, are not thread safe.  So, sharing them between threads may result in unpredictable results.</p>
<p>Remember to always close the graph instance when you are done with it, using the <code>.shutdown()</code> method.  For instance:</p>
<pre><code class="language-java">OrientGraph graph = new OrientGraph("plocal:C:/temp/graph/db");
try {
  ...
} finally {
  graph.shutdown();
}
</code></pre>
<h3 id="using-the-factory"><a class="header" href="#using-the-factory">Using the Factory</a></h3>
<p>Beginning with version 1.7, OrientDB introduces the <a href="http://www.orientechnologies.com/javadoc/latest/com/tinkerpop/blueprints/impls/orient/OrientGraphFactory.html"><code>OrientGraphFactory</code></a> class as new method for creating graph database instances through the API.</p>
<pre><code class="language-java">// AT THE BEGINNING
OrientGraphFactory factory = new OrientGraphFactory("plocal:/tmp/graph/db").setupPool(1,10);

// EVERY TIME YOU NEED A GRAPH INSTANCE
OrientGraph graph = factory.getTx();
try {
  ...

} finally {
   graph.shutdown();
}
</code></pre>
<blockquote>
<p>For more information, see <a href="java/Graph-Factory.html">Graph Factory</a>.</p>
</blockquote>
<h2 id="transactions-2"><a class="header" href="#transactions-2">Transactions</a></h2>
<p>Prior to version 2.1.7, whenever you modify the graph database instance, OrientDB automatically starts an implicit transaction, in the event that no previous transactions are running.  When you close the graph instance, it commits the transaction automatically by calling the <code>.shutdown()</code> method or through <code>.commit()</code>.  This allows you to roll changes back where necessary, using the <code>.rollback()</code> method.</p>
<p>Beginning in version 2.1.8, you can set the <a href="java/Graph-Consistency.html">Consistency Level</a>.  Changes within the transaction remain temporary until the commit or the closing of the graph database instance.  Concurrent threads or external clients can only see the changes after you fully commit the transaction.</p>
<p>For instance,</p>
<pre><code class="language-java">try{
  Vertex luca = graph.addVertex(null); // 1st OPERATION: IMPLICITLY BEGINS TRANSACTION
  luca.setProperty( "name", "Luca" );
  Vertex marko = graph.addVertex(null);
  marko.setProperty( "name", "Marko" );
  Edge lucaKnowsMarko = graph.addEdge(null, luca, marko, "knows");
  graph.commit();
} catch( Exception e ) {
  graph.rollback();
}
</code></pre>
<p>By surrounding the transaction in <code>try</code> and <code>catch</code>, you ensure that any errors that occur roll the transaction back to its previous state for all relevant elements.  For more information, see <a href="java/../general/Concurrency.html">Concurrency</a>.</p>
<blockquote>
<p><strong>NOTE</strong>: Prior to version 2.1.7, to work with a graph always use transactional <a href="http://www.orientechnologies.com/javadoc/latest/com/tinkerpop/blueprints/impls/orient/OrientGraph.html"><code>OrientGraph</code></a> instances and never the non-transactional instances to avoid graph corruption from multi-threaded updates.</p>
<p>Non-transactional graph instances are created with</p>
<pre><code class="language-java">OrientGraphNoTx graph = factor.getNoTx();
</code></pre>
<p>This instance is only useful when you don't work with data, but want to define the <a href="java/Graph-Schema.html">database schema</a> or for <a href="java/Graph-Database-Tinkerpop.html#using-non-transactional-graphs">bulk inserts</a>.</p>
</blockquote>
<h3 id="optimistic-transactions"><a class="header" href="#optimistic-transactions">Optimistic Transactions</a></h3>
<p>OrientDB supports optimistic transactions.  This means that no lock is kept when a transaction runs, but at commit time each graph element version is checked to see if there has been an update by another client.</p>
<p>For this reason, write your code to handle the concurrent updating case:</p>
<pre><code class="language-java">for (int retry = 0; retry &lt; maxRetries; ++retry) {
    try {
        // LOOKUP FOR THE INVOICE VERTEX
        Iterable&lt;Vertex&gt; invoices = graph.getVertices("invoiceId", 2323);
        Vertex invoice = invoices.iterator().next();
        
        // CREATE A NEW ITEM
        Vertex invoiceItem = graph.addVertex("class:InvoiceItem");
        invoiceItem.field("price", 1000);
        // ADD IT TO THE INVOICE
        invoice.addEdge(invoiceItem);
        graph.commit();

        // OK, EXIT FROM RETRY LOOP
        break;
    } catch( ONeedRetryException e ) {
        // SOMEONE HAVE UPDATE THE INVOICE VERTEX AT THE SAME TIME, RETRY IT
    }
}
</code></pre>
<h3 id="using-non-transactional-graphs"><a class="header" href="#using-non-transactional-graphs">Using Non-Transactional Graphs</a></h3>
<p>In cases such as massive insertions, you may find the standard transactional graph <code>OrientGraph</code> is too slow for your needs.  You can speed the operations up by using the non-transactional <code>OrientGraphNoTx</code> graph.</p>
<p>With the non-transactional graph, each operation is <em>atomic</em> and it updates data on each operation.  When the method returns, the underlying storage updates.  This works best for bulk inserts and massive operations, or for schema definitions.</p>
<blockquote>
<p><strong>NOTE</strong>: Using non-transactional graphs may cause corruption in the graph in cases where changes are made through multiple threads at the same time.  It is recommended that you only use non-transactional graph instances for single-threaded operations.</p>
</blockquote>
<h2 id="graph-configuration"><a class="header" href="#graph-configuration">Graph Configuration</a></h2>
<p>Beginning in version 1.6 of OrientDB, you can configure the graph by setting all of its properties during construction:</p>
<ul>
<li>
<p><strong><code>blueprints.orientdb.url</code></strong>	Defines the database URL.</p>
</li>
<li>
<p><strong><code>blueprints.orientdb.username</code></strong> Defines the username</p>
<p>Default: <code>admin</code></p>
</li>
<li>
<p><strong><code>blueprints.orientdb.password</code></strong> Defines the user password.</p>
<p>Default: <code>admin</code></p>
</li>
<li>
<p><strong><code>blueprints.orientdb.saveOriginalIds</code></strong> Defines whether it saves the original element ID's by using the property <code>id</code>.  You may find this useful when importing a graph to preserve original ID's.</p>
<p>Default: <code>false</code></p>
</li>
<li>
<p><strong><code>blueprints.orientdb.keepInMemoryReferences</code></strong> Defines whether it avoids keeping records in memory, by using only Record ID's.</p>
<p>Default: <code>false</code></p>
</li>
<li>
<p><strong><code>blueprints.orientdb.useCustomClassesForEdges</code></strong> Defines whether it uses the edge label as the OrientDB class.  If the class doesn't exist, it creates it for you.</p>
<p>Default: <code>true</code></p>
</li>
<li>
<p><strong><code>blueprints.orientdb.useCustomClassesForVertex</code></strong> Defines whether it uses the vertex label as the OrientDB class.  If the class doesn't exist, it creates it for you.</p>
<p>Default: <code>true</code></p>
</li>
<li>
<p><strong><code>blueprints.orientdb.useVertexFieldsForEdgeLabels</code></strong> Defines whether it stores the edge relationship in the vertex by using the edge class.  This allows you to use multiple fields and makes traversals by the edge label (class) faster.</p>
<p>Default: <code>true</code></p>
</li>
<li>
<p><strong><code>blueprints.orientdb.lightweightEdges</code></strong> Defines whether it uses <a href="java/Lightweight-Edges.html">Lightweight Edges</a>.  This allows you to avoid creating a physical document per edge.  Documents are only created when edges have properties.</p>
<p>Default: <code>false</code></p>
</li>
<li>
<p><strong><code>blueprints.orientdb.autoStartTx</code></strong> Defines whether it auto-starts transactions when the graph is changed by adding or removing vertices, edges and properties.</p>
<p>Default: <code>true</code></p>
</li>
</ul>
<h2 id="using-gremlin"><a class="header" href="#using-gremlin">Using Gremlin</a></h2>
<p>You can also use the Gremlin language with OrientDB.  To do so, initialize it, using <code>OGremlinHelper</code>:</p>
<pre><code class="language-java">OGremlinHelper.global().create()
</code></pre>
<blockquote>
<p>For more information on Gremlin usage, see:</p>
<ul>
<li><a href="java/../gremlin/Gremlin.html">How to use the Gremlin language with OrientDB</a></li>
<li><a href="http://github.com/tinkerpop/gremlin/wiki/Getting-Started">Getting started with Gremlin</a></li>
<li><a href="https://github.com/tinkerpop/rexster/wiki/Using-Gremlin">Usage of Gremlin through HTTP/RESTful API using the Rexter project</a>.</li>
</ul>
</blockquote>
<h2 id="multi-threaded-applications"><a class="header" href="#multi-threaded-applications">Multi-Threaded Applications</a></h2>
<p>In order to use the OrientDB Graph API with multi-threaded applications, you must use one <code>OrientGraph</code> instance per thread.</p>
<p>For more information about multi-threading look at <a href="java/Java-Multi-Threading.html">Java Multi Threading</a>. Bear in mind, graph components (such as, Vertices and Edges) are not thread-safe.  Sharing them between threads could cause unpredictable errors.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="java-api-tutorial-legacy"><a class="header" href="#java-api-tutorial-legacy">Java API Tutorial (LEGACY)</a></h1>
<p>In the event that you have only used Relational database systems, you may find much of OrientDB very unfamiliar.  Given that OrientDB supports Document, Graph and Object Oriented modes, it requires that you use different Java API's, but there are some similarities between them.</p>
<p>Similar to the JDBC, the TinkerPop produces the <a href="https://github.com/tinkerpop/blueprints">Blueprints API</a>, which provides support for basic operations on Graph databases.  Using the OrientDB adapter, you can operate on a database without needing to manage OrientDB classes.  This makes the resulting code more portable, given that Blueprints offers adapters for other Graph database system.</p>
<p>Tweaking the database configuration itself requires that you use the OrientDB API's directly.  It is recommended in these situations that you use a mix, (that is, Blueprints when you can and the OrientDB API's where necessary).</p>
<h2 id="orientdb-java-apis"><a class="header" href="#orientdb-java-apis">OrientDB Java API's</a></h2>
<p>OrientDB provides three different Java API's that allow you to work with OrientDB.  Choose the Java API that supports the mode in which you want to work:</p>
<ul>
<li><a href="java/Graph-Database-Tinkerpop.html">Graph API</a></li>
<li><a href="java/Document-Database.html">Document API</a></li>
<li><a href="java/Object-Database.html">Object API</a></li>
</ul>
<blockquote>
<p>For more information on the API's in general, see <a href="java/Java-API.html">Java API</a></p>
</blockquote>
<h3 id="use-case-graph-api"><a class="header" href="#use-case-graph-api">Use Case: Graph API</a></h3>
<p>Consider as an example setting up a Graph Database using the Java API with Blueprint.</p>
<h4 id="connecting-to-a-graph-database"><a class="header" href="#connecting-to-a-graph-database">Connecting to a Graph Database</a></h4>
<p>In order to use the Graph API, you need to create an <code>OrientGraph</code> object first:</p>
<pre><code class="language-java">import com.tinkerpop.blueprints.impls.orient.OrientGraph;

OrientGraph graph = new OrientGraph("embedded:./test",
        "username", "password");
</code></pre>
<p>When your application runs, these lines initialize the <code>graph</code> object to your OrientDB database using the Graph API.</p>
<h4 id="inserting-vertices"><a class="header" href="#inserting-vertices">Inserting Vertices</a></h4>
<p>While you can work with the generic vertex class <code>V</code>, you gain much more power by defining custom types for vertices.  For instance,</p>
<pre><code class="language-java">graph.createVertexType("Person");
graph.createVertexType("Address");
</code></pre>
<p>The Blueprint adapter for OrientDB is thread-safe and where necessary automatically creates transactions.  That is, it creates a transaction at the first operation, in the event that you have not yet explicitly started one.  You have to specify where these transactions end, for commits or rollbacks.</p>
<p>To add vertices into the database with the Blueprints API:</p>
<pre><code class="language-java">Vertex vPerson = graph.addVertex("class:Person");
vPerson.setProperty("firstName", "John");
vPerson.setProperty("lastName", "Smith");

Vertex vAddress = graph.addVertex("class:Address");
vAddress.setProperty("street", "Van Ness Ave.");
vAddress.setProperty("city", "San Francisco");
vAddress.setProperty("state", "California");
</code></pre>
<p>When using the Blueprint API, keep in mind that the specific syntax to use is <code>class:&lt;class-name&gt;</code>.  You must use this syntax when creating an object in order to specify its class.  Note that this is not mandatory.  It is possible to specify a null value, (which means that the vertex uses the default <code>V</code> vertex class, as it is the super-class for all vertices in OrientDB).  For instance,</p>
<pre><code class="language-java">Vertex vPerson = graph.addVertex(null);
</code></pre>
<p>However, when creating vertices in this way, you cannot distinguish them from other vertices in a query.</p>
<h4 id="inserting-edges"><a class="header" href="#inserting-edges">Inserting Edges</a></h4>
<p>While you can work with the generic edge class <code>E</code>, you gain much more power by defining custom types for edges.  The method for adding edges is similar to that of vertices:</p>
<pre><code class="language-java">OrientEdge eLives = graph.addEdge(null, vPerson, vAddress, "lives");
</code></pre>
<p>OrientDB binds the Blueprint label concept to the edge class.  That is, you can create an edge of the class <code>lives</code> by passing it as a label or as a class name.</p>
<pre><code class="language-java">OrientEdge eLives = graph.addEdge("class:lives", vPerson, vAddress, null);
</code></pre>
<p>You have now created:</p>
<pre><code>[John Smith:Person] --[lives]--&gt; [Van Ness Ave:Address]
</code></pre>
<p>Bear in mind that, in this example, you have used a partially schema-full mode, given that you defined the vertex types, but not their properties.  By default, OrientDB dynamically accepts everything and works in a schema-less mode.</p>
<h3 id="use-case-sql-queries"><a class="header" href="#use-case-sql-queries">Use Case: SQL Queries</a></h3>
<p>While the Tinkerpop interfaces do allow you to execute fluent queries in SQL or Gremlin, you can also utilize the power of OrientDB SQL through the <code>.command()</code> method.  For instance,</p>
<pre><code class="language-java">for (Vertex v : (Iterable&lt;Vertex&gt;) graph.command(
        new OCommandSQL(
		    "SELECT EXPAND(OUT('bough')) FROM Customer"
          + "WHERE name='Jay'")).execute()) {
    System.out.println("- Bought: " + v);
}
</code></pre>
<p>In addition to queries, you can also execute any SQL command, such as <a href="java/../sql/SQL-Create-Vertex.html"><code>CREATE VERTEX</code></a>, <a href="java/../sql/SQL-Update.html"><code>UPDATE</code></a>, or <a href="java/../sql/SQL-Delete-Vertex.html"><code>DELETE VERTEX</code></a>.  For instance,</p>
<pre><code class="language-java">int modified = graph.command(
        new OCommandSQL(
		    "UPDATE Customer SET local = TRUE" 
		  + "WHERE 'Rome' IN out('lives').name")).execute());
</code></pre>
<p>Running this command sets a new property called <code>local</code> to <code>TRUE</code> on all instances in the class <code>Customer</code> where these customers live in Rome.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="vertices-and-edges-1"><a class="header" href="#vertices-and-edges-1">Vertices and Edges</a></h1>
<p>Similar to the Console interface, you can also create, manage and control vertices and edges through the Graph API.</p>
<h2 id="vertices"><a class="header" href="#vertices">Vertices</a></h2>
<p>To create a new vertex in the current Graph Database instance, call the [<code>Vertex OrientGraph.addVertex(Object id)</code>](http://www.orientechnologies.com/javadoc/latest/com/tinkerpop/blueprints/impls/orient/OrientBaseGraph.html#addVertex(java.lang.Object) method.  Note that this ignores the <code>id</code> parameter, given that the OrientDB implementation assigns a unique ID once it creates the vertex.  To return the unique ID, run the [<code>Vertex.getId()</code>](http://www.orientechnologies.com/javadoc/latest/com/tinkerpop/blueprints/impls/orient/OrientElement.html#getId() method on the object.</p>
<p>For instance,</p>
<pre><code class="language-java">Vertex v = graph.addVertex(null);
System.out.println("Created vertex: " + v.getId());
</code></pre>
<h3 id="retrieving-vertices-4"><a class="header" href="#retrieving-vertices-4">Retrieving Vertices</a></h3>
<p>To retrieve all vertices on the object, use the <code>getVertices()</code> method.  For instance,</p>
<pre><code class="language-java">for (Vertex v : graph.getVertices()) {
    System.out.println(v.getProperty("name"));
}
</code></pre>
<p>To lookup vertices by a key, call the <code>getVertices()</code> method by passing the field name and the value to match. Remember that in order to use indexes, you should use the "class" dot (.) "property name" as field name. Example:</p>
<pre><code class="language-java">for( Vertex v : graph.getVertices("Account.id", "23876JS2") ) {
  System.out.println("Found vertex: " + v );
}
</code></pre>
<p>To know more about how to define indexes look at: <a href="http://orientdb.dev/docs/3.2.x/Performance-Tuning-Graph.html#use-indexes-to-lookup-vertices-by-an-id">Using Graph Indexes</a>.</p>
<h3 id="removing-vertices"><a class="header" href="#removing-vertices">Removing Vertices</a></h3>
<p>To remove a vertex from the current Graph Database, call the [<code>OrientGraph.removeVertex(Vertex vertex)</code>](http://www.orientechnologies.com/javadoc/latest/com/tinkerpop/blueprints/impls/orient/OrientBaseGraph.html#removeVertex(Vertex) method.  This disconnects the vertex from the graph database and then removes it.  Disconnection deletes all vertex edges as well.</p>
<p>For instance,</p>
<pre><code class="language-java">graph.removeVertex(luca);
</code></pre>
<p>Disconnects and removes the vertex <code>luca</code>.</p>
<h2 id="edges"><a class="header" href="#edges">Edges</a></h2>
<p>Edges link two vertices in the database.  The vertices must exist already.  To create a new edge in the current Graph Database, call the [<code>Edge OrientGraph.addEdge(Object id, Vertex outVertex, Vertex inVertex, String label )</code>](http://www.orientechnologies.com/javadoc/latest/com/tinkerpop/blueprints/impls/orient/OrientBaseGraph.html#addEdge(java.lang.Object,-Vertex,-Vertex,-java.lang.String) method.</p>
<p>Bear in mind that OrientDB ignores the <code>id</code> parameter, given that it assigns a unique ID when it creates the edge.  To access this ID, use the [<code>Edge.getId()</code>](http://www.orientechnologies.com/javadoc/latest/com/tinkerpop/blueprints/impls/orient/OrientElement.html#getId() method.  <code>outVertex</code> refers to the vertex instance where the edge starts and <code>inVertex</code> refers to where the edge ends.  <code>label</code> indicates the edge label.  Specify it as <code>null</code> if you don't want to assign a label.</p>
<p>For instance,</p>
<pre><code class="language-java">Vertex luca = graph.addVertex(null);
luca.setProperty("name", "Luca");

Vertex marko = graph.addVertex(null);
marko.setProperty("name", "Marko");

Edge lucaKnowsMarko = graph.addEdge(null, luca, marko, "knows");
System.out.println("Created edge: " + lucaKnowsMarko.getId());
</code></pre>
<p>For more information on optimizing edge creation through concurrent threads and clients, see <a href="java/../general/Concurrency.html#concurrency-when-adding-edges">Concurrency on Adding Edges</a>.</p>
<h3 id="retrieving-edges-1"><a class="header" href="#retrieving-edges-1">Retrieving Edges</a></h3>
<p>To retrieve all edges use the [getEdges()](http://www.orientechnologies.com/javadoc/latest/com/tinkerpop/blueprints/impls/orient/OrientBaseGraph.html#getEdges() method:</p>
<pre><code class="language-java">for (Edge e : graph.getEdges()) {
    System.out.println(e.getProperty("age"));
}
</code></pre>
<p>When using <a href="java/Lightweight-Edges.html">Lightweight Edges</a>, OrientDB stores edges as links rather than records.  This improves performance, but as a consequence, the <code>.getEdges()</code> method only retrieves records of the class <code>E</code>.  When using Lightweight Edges, OrientDB only creates records in class <code>E</code> under certain circumstances, such as when the edge has properties.  Otherwise, the edges exist as links on the in and out vertices.</p>
<p>If you want to use <code>.getEdges()</code> to return all edges, disable the Lightweight Edges feature by executing the following command:</p>
<pre>
orientdb> <code class="lang-sql userinput">ALTER DATABASE my_db useLightweightEdges=FALSE</code>
</pre>
<p>You only need to run this command once to disable Lightweight Edges.  The change only takes effect on edges you create after running it.  For existing edges, you need to convert them from links to actual edges before the <code>.getEdges()</code> method returns all edges.  For more information, see <a href="java/../misc/Troubleshooting.html#why-cant-i-see-all-the-edges">Troubleshooting</a>.</p>
<blockquote>
<p><strong>NOTE</strong>: Since version 2.0 of OrientDB, the Lightweight Edges feature is disabled by default.</p>
</blockquote>
<h3 id="removing-edges"><a class="header" href="#removing-edges">Removing Edges</a></h3>
<p>To remove an edge from the current Graph Database, call the [<code>OrientGraph.removeEdge(Edge edge)</code>](http://www.orientechnologies.com/javadoc/latest/com/tinkerpop/blueprints/impls/orient/OrientBaseGraph.html#removeEdge(Edge) method.  It removes the edge connecting two vertices.</p>
<p>For instance,</p>
<pre><code class="language-java">graph.removeEdge(lucaKnowsMarko);
</code></pre>
<h2 id="vertex-and-edge-properties"><a class="header" href="#vertex-and-edge-properties">Vertex and Edge Properties</a></h2>
<p>Vertices and Edges can have multiple properties.  The key to this property is a String, the value any <a href="java/../general/Types.html">Types</a> supported by OrientDB.</p>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Description</th></tr></thead><tbody>
<tr><td>[<strong><code>setProperty(String key, Object value)</code></strong>](http://www.orientechnologies.com/javadoc/latest/com/tinkerpop/blueprints/impls/orient/OrientElement.html#setProperty(java.lang.String,-java.lang.Object)</td><td>Sets the property.</td></tr>
<tr><td>[<strong><code>Object getProperty(String key)</code></strong>](http://www.orientechnologies.com/javadoc/latest/com/tinkerpop/blueprints/impls/orient/OrientElement.html#getProperty(java.lang.String)</td><td>Retrieves the property.</td></tr>
<tr><td>[<strong><code>void removeProperty(String key)</code></strong>](http://www.orientechnologies.com/javadoc/latest/com/tinkerpop/blueprints/impls/orient/OrientElement.html#removeProperty(java.lang.String)</td><td>Removes the property.</td></tr>
</tbody></table>
</div>
<p>For instance,</p>
<pre><code class="language-java">vertex2.setProperty("x", 30.0f);
vertex2.setProperty("y", ((float) vertex1.getProperty( "y" )) / 2);

for (String property : vertex2.getPropertyKeys()) {
      System.out.println("Property: " + property + "=" + vertex2.getProperty(property));
}

vertex1.removeProperty("y");
</code></pre>
<h3 id="setting-multiple-properties"><a class="header" href="#setting-multiple-properties">Setting Multiple Properties</a></h3>
<p>The OrientDB implementation of the Blueprints extension supports setting multiple properties in one command against vertices and edges, using the [<code>setProperties(Object ...)</code>](http://www.orientechnologies.com/javadoc/latest/com/tinkerpop/blueprints/impls/orient/OrientElement.html#setProperties(java.lang.Object...) method.  This improves performance by allowing you to avoid saving the graph element each time you set a property.</p>
<p>For instance,</p>
<pre><code class="language-java">vertex.setProperties( "name", "Jill", "age", 33, "city", "Rome", "born", "Victoria, TX" );
</code></pre>
<p>You can also pass a Map of values as the first argument.  In this case all map entries are set as element properties:</p>
<pre><code class="language-java">Map&lt;String,Object&gt; props = new HashMap&lt;String,Object&gt;();
props.put("name", "Jill");
props.put("age", 33);
props.put("city", "Rome");
props.put("born", "Victoria, TX");
vertex.setProperties(props);
</code></pre>
<h3 id="creating-element-and-properties-together"><a class="header" href="#creating-element-and-properties-together">Creating Element and Properties Together</a></h3>
<p>In addition to the above methods, using the OrientDB Blueprint implementation, you can also set the initial properties while creating vertices or edges.</p>
<p>For instance,</p>
<ul>
<li>
<p>To create a vertex and set the initial properties:</p>
<pre><code class="language-java">graph.addVertex("class:Customer", "name", "Jill", 
    "age", 33, "city", "Rome", "born", "Victoria, TX");
</code></pre>
<p>This line creates a new vertex of the class <code>Customer</code>.  It sets the initial properties for <code>name</code>, <code>age</code>, <code>city</code>, and <code>born</code>.</p>
</li>
<li>
<p>The same procedure also works for edges.</p>
<pre><code class="language-java">person1.addEdge("class:Friend", person1, person2, null, 
    "since", "2013-07-30");
</code></pre>
<p>This creates an edge of the class <code>Friend</code> between the vertices <code>person1</code> and <code>person2</code> with the property <code>since</code>.</p>
</li>
</ul>
<p>Both methods accept <code>Map&lt;String, Object&gt;</code> as a parameter, allowing you to set one property per map entry, such as in the above example.</p>
<h2 id="using-indices"><a class="header" href="#using-indices">Using Indices</a></h2>
<p>OrientDB allows query execution against any field of a vertex or edge, indexed or non-indexed.  To speed up queries, set up indices on key properties that use in the query.</p>
<ul>
<li>For instance, say that you have a query that looks for all vertices with the name <code>OrientDB</code>.  For instance,</li>
</ul>
<pre><code class="language-java">graph.getVertices("name", "OrientDB");
</code></pre>
<ul>
<li>
<p>Without an index against the property <code>name</code>, this query can take up a lot of time.  You can improve performance by creating a new index against the <code>name</code> property:</p>
<pre><code class="language-java">graph.createKeyIndex("name", Vertex.class);
</code></pre>
</li>
<li>
<p>In cases where the name must be unique, you can enforce this constraint by setting the index as <code>UNIQUE</code>.  (This feature is only available in OrientDB).</p>
<pre><code class="language-java">graph.createKeyIndex("name", Vertex.class, new Parameter("type", "UNIQUE"));
</code></pre>
<p>It applies this constraint to vertices and sub-type instances.</p>
</li>
<li>
<p>To create an index against a custom type, such as the <code>Customer</code> vertex, use the additional <code>class</code> parameter:</p>
</li>
</ul>
<pre><code class="language-java">graph.createKeyIndex("name", Vertex.class, new Parameter("class", "Customer"));
</code></pre>
<ul>
<li>
<p>You can also have both unique indices against custom types:</p>
<pre><code class="language-java">graph.createKeyIndex("name", Vertex.class, new Parameter("type", "UNIQUE"), new Parameter("class", "Customer"));
</code></pre>
</li>
<li>
<p>To create a case-insensitive index, use the <code>collate</code> parameter:</p>
<pre><code class="language-java">graph.createKeyIndex("name", Vertex.class, new Parameter("type", "UNIQUE"), new Parameter("class", "Customer"),new Parameter("collate", "ci"));
</code></pre>
</li>
<li>
<p>To get a vertex or edge by key prefix, use the class name before the property.  For example above, you would use <code>Customer.name</code> instead of just <code>name</code> to create the index against the field of that class:</p>
<pre><code class="language-java">for (Vertex v : graph.getVertices("Customer.name", "Jay")) {
    System.out.println("Found vertex: " + v);
}
</code></pre>
</li>
<li>
<p>In the event that the class name is not passed, it uses <code>V</code> for vertices and <code>E</code> for edges:</p>
<pre><code class="language-java">graph.getVertices("name", "Jay");
graph.getEdges("age", 20);
</code></pre>
</li>
</ul>
<blockquote>
<p>For more information, see <a href="java/../indexing/Indexes.html">Indexes</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="using-the-blueprints-extensions"><a class="header" href="#using-the-blueprints-extensions">Using the Blueprints Extensions</a></h1>
<p>OrientDB is a graph database that merges graph, document and object-oriented worlds together.  Below are some of the features exclusive to OrientDB through the Blueprints Extensions.</p>
<blockquote>
<p>For information on tuning your graph database, see <a href="java/../tuning/Performance-Tuning-Graph.html">Performance Tuning Blueprints</a>.</p>
</blockquote>
<h2 id="custom-types"><a class="header" href="#custom-types">Custom Types</a></h2>
<p>OrientDB supports custom types for vertices and edges in an Object Oriented manner.  This feature is not supported directly through Blueprints, but there is a way to implement them.  If you want to create a schema to work with custom types, see <a href="java/Graph-Schema.html">Graph Schema</a>.</p>
<p>Additionally, OrientDB introduces a few variants to Blueprint methods for working with types.</p>
<h3 id="creating-vertices-and-edges-in-specific-clusters"><a class="header" href="#creating-vertices-and-edges-in-specific-clusters">Creating Vertices and Edges in Specific Clusters</a></h3>
<p>By default, each class has one cluster with the same name.  You can add multiple clusters to the class, allowing OrientDB to write vertices and edges on multiple files.</p>
<p>For instance,</p>
<pre><code class="language-java">// SAVE THE VERTEX INTO THE CLUSTER 'PERSON_USA' 
// ASSIGNED TO THE NODE 'USA'
graph.addVertex("class:Person,cluster:Person_usa");
</code></pre>
<h3 id="retrieving-vertices-and-edges-by-type"><a class="header" href="#retrieving-vertices-and-edges-by-type">Retrieving Vertices and Edges by Type</a></h3>
<p>To retrieve all vertices of the <code>Person</code> class, use the special <code>getVerticesOfClass(String className)</code> method.</p>
<p>For instance,</p>
<pre><code class="language-java">for (Vertex v : graph.getVerticesOfClass("Person")) {
    System.out.println(v.getProperty("name"));
}
</code></pre>
<p>Here, it retrieves all vertices of the class <code>Person</code> as well as all sub-classes.  It does this because OrientDB uses polymorphism by default.  If you would like to retrieve only those vertices of the <code>Person</code> class, excluding sub-types, use the <code>getVerticesOfClass(String className, boolean polymorphic)</code> method, specifying <code>false</code> in the <code>polymorphic</code> argument.  For instance,</p>
<pre><code class="language-java">for (Vertex v : graph.getVerticesOfClass("Person", false)) {
    System.out.println(v.getProperty("name"));
}
</code></pre>
<p>You can also use variations on these with the <code>.getEdges()</code> method:</p>
<ul>
<li><code>getEdgesOfClass(String className)</code></li>
<li><code>getEdgesOfClass(String, className, boolean polymorphic)</code></li>
</ul>
<h2 id="ordered-edges"><a class="header" href="#ordered-edges">Ordered Edges</a></h2>
<p>By default, OrientDB uses a set to handle edge collection.  But, sometimes it's better to have an ordered list to access the edge by an offset.</p>
<ul>
<li>
<p>For instance,</p>
<pre><code class="language-java">person.createEdgeProperty(Direction.OUT, "Photos").setOrdered(true);
</code></pre>
</li>
<li>
<p>Whenever you access the edge collection, it orders the edges.  Consider the example below, which prints all photos in the database in an ordered way:</p>
<pre><code class="language-java">for (Edge e : loadedPerson.getEdges(Direction.OUT, "Photos")) {
  System.out.println( "Photo name: " + e.getVertex(Direction.IN).getProperty("name") );
}
</code></pre>
</li>
<li>
<p>To access the underlying edge list, you need to use the Document Database API.  Consider this example, which swaps the tenth photo with the last:</p>
<pre><code class="language-java">// REPLACE EDGE Photos
List&lt;ODocument&gt; photos = loadedPerson.getRecord().field("out_Photos");
photos.add(photos.remove(9));
</code></pre>
</li>
<li>
<p>You can get the same result through SQL by executing the following commands in the terminal:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE PROPERTY out_Photos LINKLIST</code>
orientdb> <code class="lang-sql userinput">ALTER PROPERTY User.out_Photos CUSTOM ORDERED=TRUE</code>
</pre>
</li>
</ul>
<h2 id="detached-elements"><a class="header" href="#detached-elements">Detached Elements</a></h2>
<p>When working with web applications, it is very common to query elements and render them to the user, allowing them to apply changes.</p>
<p>Consider what happens when the user changes some fields and saves.  Previously, the developer had to track the changes in a separate structure, load the vertex or edge from the database, and then apply the changes to the element.  Beginning in version 1.7 OrientDB, there are two new methods in the Graph API on the <code>OrientElement</code> and <code>OrientBaseGraph</code> classes:</p>
<ul>
<li><code>OrientElement.detach()</code> and <code>OrientBaseGraph.detach(OrientElement)</code> methods fetch all record content in memory and resets the connection to the Graph instance.</li>
<li><code>OrientElement.attach()</code> and <code>OrientBaseGraph.attach(OrientElement)</code> methods save the detached element back into the database and restores the connection between the Graph Element and the Graph instance.</li>
</ul>
<p>For instance, to use these begin by loading a vertex and detaching it:</p>
<pre><code class="language-java">OrientGraph g = OrientGraph("plocal:/temp/db");
try {
    Iterable&lt;OrientVertex&gt; results = g.query().has("name", EQUALS, "fast");
    for (OrientVertex v : results)
        v.detach();
} finally {
    g.shutdown();
}
</code></pre>
<p>Update the element, either from the GUI or by application:</p>
<pre><code class="language-java">v.setProperty("name", "super fast!");
</code></pre>
<p>When the user saves, re-attach the element and save it to the database:</p>
<pre><code class="language-java">OrientGraph g = OrientGraph("plocal:/temp/db");
try {
    v.attach(g);
    v.save();
} finally {
    g.shutdown();
}
</code></pre>
<h3 id="faq-1"><a class="header" href="#faq-1">FAQ</a></h3>
<p><strong>Do <code>detach()</code> methods work recursively to detach all connected elements?</strong>
No, it only works on the current element.</p>
<p><strong>Can you add an edge against detached elements?</strong>
No, you can only get, set or remove a property while it's detached.  Any other operation that requires the database it throws an <code>IllegalStateException</code> exception.</p>
<h2 id="executing-commands-1"><a class="header" href="#executing-commands-1">Executing Commands</a></h2>
<p>The OrientDB Blueprints implementation allows you to execute commands using SQL, JavaScript and all other supported languages.</p>
<h3 id="sql-queries"><a class="header" href="#sql-queries">SQL Queries</a></h3>
<p>It is possible to have parameters in a query using <a href="java/Document-API-Documents.html#prepared-queries">prepared queries</a>.</p>
<pre><code class="language-java">for (Vertex v : (Iterable&lt;Vertex&gt;) graph.command(new OCommandSQL(
			"SELECT EXPAND( out('bought') ) FROM Customer WHERE name = 'Jay'")).execute()) {
    System.out.println("- Bought: " + v);
}
</code></pre>
<p>To execute an asynchronous query:</p>
<pre><code class="language-java">graph.command(
          new OSQLAsynchQuery&lt;Vertex&gt;("SELECT FROM Member",
            new OCommandResultListener() {
              int resultCount =0;
              @Override
              public boolean result(Object iRecord) {
                resultCount++;
                Vertex doc = graph.getVertex( iRecord );
               return resultCount &lt; 100;
              }
            } ).execute();
</code></pre>
<h3 id="sql-commands-2"><a class="header" href="#sql-commands-2">SQL Commands</a></h3>
<p>In addition to queries, you can also execute any SQL command, such as <a href="java/../sql/SQL-Create-Vertex.html"><code>CREATE VERTEX</code></a>, <a href="java/../sql/SQL-Update.html"><code>UPDATE</code></a>, or <a href="java/../sql/SQL-Delete-Vertex.html"><code>DELETE VERTEX</code></a>.  For instance, consider a case where you want to set a new property called <code>local</code> to <code>true</code> on all the customers that live in Rome.</p>
<pre><code class="language-java">int modified = graph.command(
          new OCommandSQL("UPDATE Customer SET local = true WHERE 'Rome' IN out('lives').name")).execute());
</code></pre>
<p>If the command modifies the schema, (such as in cases like <a href="java/../sql/SQL-Create-Class.html"><code>CREATE CLASS</code></a>, <a href="java/../sql/SQL-Alter-Class.html"><code>ALTER CLASS</code></a>, <a href="java/../sql/SQL-Drop-Class.html"><code>DROP CLASS</code></a>, <a href="java/../sql/SQL-Create-Property.html"><code>CREATE PROPERTY</code></a>, <a href="java/../sql/SQL-Alter-Property.html"><code>ALTER PROPERTY</code></a>, and <a href="java/../sql/SQL-Drop-Property.html"><code>DROP PROPERTY</code></a>, remember you need to force the schema update of the database instance you're using by calling the <code>.reload()</code> method.</p>
<pre><code class="language-java">graph.getRawGraph().getMetadata().getSchema().reload();
</code></pre>
<blockquote>
<p>For more information, see <a href="java/../sql/SQL-Commands.html">SQL Commands</a></p>
</blockquote>
<h3 id="sql-batch-1"><a class="header" href="#sql-batch-1">SQL Batch</a></h3>
<p>To execute multiple SQL commands in a batch, use the <code>OCommandScript</code> and SQL as the language.  This is recommended when creating edges on the server-side, to minimize the network roundtrip.</p>
<pre><code class="language-java">String cmd = "BEGIN;";
cmd += "LET a = CREATE VERTEX SET script = true;";
cmd += "LET b = SELECT FROM V LIMIT 1;";
cmd += "LET e = CREATE EDGE FROM $a TO $b RETRY 100;";
cmd += "COMMIT;";
cmd += "return $e;";

OIdentifiable edge = graph.command(new OCommandScript("sql", cmd)).execute();
</code></pre>
<blockquote>
<p>For more information, see <a href="java/../sql/SQL-batch.html">SQL Batch</a></p>
</blockquote>
<h3 id="database-functions"><a class="header" href="#database-functions">Database Functions</a></h3>
<p>To execute database functions, you must write it in JavaScript or any other supported languages.  For the examples, consider a function called <code>updateAllTheCustomersInCity(cityName)</code> that executes the same update as above.  Note the <code>'Rome'</code> attribute passed in the <code>execute()</code> method:</p>
<pre><code class="language-java">graph.command(new OCommandFunction(
	"updateAllTheCustomersInCity")).execute("Rome"));
</code></pre>
<h3 id="executing-code"><a class="header" href="#executing-code">Executing Code</a></h3>
<p>To execute code on the server side, you can select between the supported language, (which by default is JavaScript):</p>
<pre><code class="language-java">graph.command(
          new OCommandScript("javascript", "for(var i=0;i&lt;10;++i){ print('\nHello World!'); }")).execute());
</code></pre>
<p>This prints the line "Hello World!" ten times in the server console, or in the local console, if the database has been opened in PLocal mode.</p>
<h2 id="accessing-the-graph"><a class="header" href="#accessing-the-graph">Accessing the Graph</a></h2>
<p>The TinkerPop Blueprints API is quite raw and doesn't provide ad hoc methods for very common use cases.  To get around this, you may need to access the <code>ODatabaseGraphTx</code> object to extend what you can do through the underlying graph engine.  Common operations are:</p>
<ul>
<li>Counting incoming and outgoing edges without browsing them.</li>
<li>Getting incoming and outgoing vertices without browsing the edges.</li>
<li>Executing a query using an SQL-like language integrated in the engine.</li>
</ul>
<p>The <a href="https://orientdb.dev/javadocs/develop/com/tinkerpop/blueprints/impls/orient/OrientGraph.html"><code>OrientGraph</code></a> class provides the method <code>.getRawGraph()</code> to return the underlying Document database. For instance,</p>
<pre><code class="language-java">final OrientGraph graph = new OrientGraph("plocal:C:/temp/graph/db");
try {
  OResultSet result = graph.getRawGraph().query("SELECT FROM V WHERE color = 'red'");
} finally {
  graph.shutdown();
}
</code></pre>
<h3 id="security-4"><a class="header" href="#security-4">Security</a></h3>
<p>If you want to use OrientDB security, use the construction that retrieves the Database URL, user and password.  For more information on OrientDB security, see <a href="java/../security/Security.html">Security</a>.  By default, it uses the <code>admin</code> user.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="graph-factory"><a class="header" href="#graph-factory">Graph Factory</a></h1>
<p>The <a href="https://github.com/tinkerpop/blueprints/wiki">TinkerPop Blueprints</a> standard does not implement a proper "factory" method for creating and pooling Graph Database instances.  In applications based on OrientDB, you may occasionally encounter legacy workarounds that attempt to implement this feature by mixing the Graph and Document API's.</p>
<p>With the introduction of the <code>OrientGraphFactory</code> class, managing graphs is much simpler.</p>
<ul>
<li>By default, the class acts as a factory, creating new Graph Database instances every time.</li>
<li>You can configure it to work as a pool, recycling Graph Database instances as need.</li>
<li>When running in PLocal mode, if the database itself doesn't exist, the class creates it for you.</li>
<li>It returns both transactional and non-transactional Graph Database instances.</li>
<li>When you call the <code>shutdown()</code> method, it returns the pooled instance so that you can reuse the pool.</li>
</ul>
<h2 id="using-graph-factories"><a class="header" href="#using-graph-factories">Using Graph Factories</a></h2>
<p>Using a Graph Factory in your application is relatively straightforward.  First, create and configure a factory instance using the <code>OrientGraphFactory</code> class.  Then, use the factory whenever you need to create an <code>OrientGraph</code> instance and shut it down to return it to the pool.  When you're done with the factory, close it to release all instances and free up system resources.</p>
<h3 id="creating-factories"><a class="header" href="#creating-factories">Creating Factories</a></h3>
<p>The basic way to create the factory with the default user <code>admin</code>, (which passes the password <code>admin</code>, by default):</p>
<pre><code class="language-java">OrientGraphFactory factory = new OrientGraphFactory("plocal:/temp/mydb");
</code></pre>
<p>In the event that you have implemented basic security housekeeping on your database, like changing the default <code>admin</code> password or if you want to use a different user, you can pass the username and password as arguments to <code>OrientGraphFactory</code>:</p>
<pre><code class="language-java">OrientGraphFactory factory = new OrientGraphFactory("plocal:/temp/mydb", "jayminer", "amigarocks");
</code></pre>
<h4 id="recycling-pools"><a class="header" href="#recycling-pools">Recycling Pools</a></h4>
<p>In addition to creating new Graph Database instances, the factory can also create recyclable pools, by using the <code>setPool()</code> method:</p>
<pre><code class="language-java">OrientGraphFactory factory = new OrientGraphFactory("plocal:/temp/mydb").setupPool(1, 10);
</code></pre>
<p>This sets the pool up to use a minimum of 1 and a maximum of 10 Graph Database instances.</p>
<h3 id="using-graph-instances"><a class="header" href="#using-graph-instances">Using Graph Instances</a></h3>
<p>Once you create and configure the factory, you can get the Graph Database instance to start using it with your application.  OrientDB provides three methods for getting this instance.  Which you use depends on preference and whether you want a transactional instance.</p>
<ul>
<li>
<p>To retrieve a transactional instance, use the <code>getTx()</code> method on your factory object:</p>
<pre><code class="language-java">OrientGraph txGraph = factory.getTx();
</code></pre>
</li>
<li>
<p>To retrieve a non-transactional instance, use the <code>getNoTx()</code> method on your factory object:</p>
<pre><code class="language-java">OrientGraphNoTx noTxGraph = factory.getNoTx();
</code></pre>
</li>
<li>
<p>Alternatively, if you plan to get several Graph Database instances of the same type, you can use the <code>setTransactional()</code> method to define the kind you want, then use the <code>get()</code> method for each instance you retrieve:</p>
<pre><code class="language-java">factory.setTransactional(false);
OrientGraphNoTx noTxGraph = (OrientGraphNoTx) factory.get();
</code></pre>
</li>
</ul>
<h3 id="shutting-down-graph-instances"><a class="header" href="#shutting-down-graph-instances">Shutting Down Graph Instances</a></h3>
<p>When you're done with a Graph Database instance, you can return it to the pool by calling the <code>shutdown()</code> method on the instance.  This method does not close the instance.  The instance remains open and available for the next requester:</p>
<pre><code class="language-java">graph.shutdown();
</code></pre>
<h3 id="releasing-the-graph-factory"><a class="header" href="#releasing-the-graph-factory">Releasing the Graph Factory</a></h3>
<p>When you're ready to release all instances, call the <code>close()</code> method on the factory.  In the case of pool usage, this also frees up the system resources claimed by the pool:</p>
<pre><code class="language-java">factory.close();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="graph-schema"><a class="header" href="#graph-schema">Graph Schema</a></h1>
<p>In OrientDB you can use a Graph Database in schema-less mode, or you can enforce strict data model through a schema.  When using a schema, you can use it on all data or only define constraints on certain fields, allowing users to add custom fields to records.</p>
<p>The schema mode you use is defined at a class-level.  So, for instance you might have a class <code>Employee</code> that is schema-full with a class <code>EmployeeInformation</code> that is schema-less.</p>
<ul>
<li><strong>Schema-Full</strong>: Enables the strict-mode at a class level and sets all fields to mandatory.</li>
<li><strong>Schema-Less</strong>: Creates classes with no properties.  By default, this is non-strict-mode, allowing records to have arbitrary fields.</li>
<li><strong>Schema-Hybrid</strong>: Creates classes and defines some of the fields, while leaving the records to define custom fields.  Sometimes, this is also called <strong>Schema-Hybrid</strong>.</li>
</ul>
<blockquote>
<p><strong>NOTE</strong>: Bear in mind that any changes you make to the class schema are not transactional.  You must execute them outside of a transaction.</p>
</blockquote>
<p>To access the schema, you can use either <a href="java/../sql/SQL-Metadata.html#querying-the-schema">SQL</a> or the API.  The examples in the following pages use the Java API.</p>
<ul>
<li><a href="java/Graph-Schema-Class.html"><strong>Graph Database Classes</strong></a></li>
<li><a href="java/Graph-Schema-Property.html"><strong>Graph Database Properties</strong></a></li>
</ul>
<blockquote>
<p>For more information, see <a href="http://orientechnologies.blogspot.it/2013/08/orientdb-using-schema-with-graphs.html">Blog: Using Schema with Graphs</a></p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="classes-in-the-graph-database"><a class="header" href="#classes-in-the-graph-database">Classes in the Graph Database</a></h1>
<p>Classes are a concept drawn from the Object-Oriented Programming paradigm.  OrientDB defines it as a record-type.  In the Relational Model, it is nearest the concept of the table.  Classes can be schema-less, schema-full or mixed.  Classes can inherit from another class, shaping a tree of classes.  Due to inheritance, the subclass extends the parent class, inheriting all the attributes as though they were its own.</p>
<p>Each class has one cluster defined as its default cluster, but it can support multiple clusters.  In this case by default, OrientDB writes new records in the default cluster, but reads always occur on defined clusters.  When you create a new class, it creates a default physical cluster with the same name as the class, changed to lowercase.</p>
<p>In Graph Databases, the structure follows tow classes: <code>V</code> as the base class for vertices and <code>E</code> as the base class for edges.  OrientDB builds these classes automatically when you create the graph database.  In the event that you don't have these classes, create them, (see below).</p>
<h2 id="working-with-vertex-and-edge-classes"><a class="header" href="#working-with-vertex-and-edge-classes">Working with Vertex and Edge Classes</a></h2>
<p>While you can build graphs using <code>V</code> and <code>E</code> class instances, it is strongly recommended that you create custom types for vertices and edges.</p>
<p>To create a custom vertex class (or type) use the <code>createVertexType(&lt;name&gt;)</code>:</p>
<pre><code class="language-java">// Create Custom Vertex Class
OrientVertexType account = graph.createVertexType("Account");
</code></pre>
<p>To create a vertex of that class <code>Account</code>, pass a string with the format <code>"class:&lt;name&gt;"</code>:</p>
<pre><code class="language-java">// Add Vertex Instance
Vertex v = graph.addVertex("class:Account");
</code></pre>
<p>In Blueprints, edges have the concept of labels used in distinguishing between edge types.  OrientDB binds the concept of edge labels to edge classes.  There is a similar method in creating custom edge types, using <code>createEdgeType(&lt;name)</code>:</p>
<pre><code class="language-java">// Create Graph Database Instance
OrientGraph graph = new OrientGraph("plocal:/tmp/db");

// Create Custom Vertex Classes
OrientVertexType accountVertex = graph.createVertexType("Account");
OrientVertexType addressVertex = graph.createVertexType("Address");

// Create Custom Edge Class
OrientEdgeType livesedge = graph.createEdgeType("Lives");

// Create Vertices
Vertex account = graph.addVertex("class:Account");
Vertex address = graph.addVertex("class:Address");

// Create Edge
Edge e = account.addEdge("Lives", address);
</code></pre>
<h2 id="inheritance-tree"><a class="header" href="#inheritance-tree">Inheritance Tree</a></h2>
<p>Classes can extend other classes.  To create a class that extend a class different from <code>V</code> or <code>E</code>, pass the class name in the construction:</p>
<pre><code class="language-java">graph.createVertexType(&lt;class&gt;, &lt;super-class&gt;); // Vertex
graph.createEdgeType(&lt;class&gt;, &lt;super-class&gt;); // Edge
</code></pre>
<p>For instance, create the base class <code>Account</code>, then create two subclasses: <code>Provider</code> and <code>Customer</code>:</p>
<pre><code class="language-java">// Create Vertex Base Class
graph.createVertexType("Account");

// Create Vertex Subclasses
graph.createVertexType("Customer", "Account");
graph.createVertexType("Provider", "Account");
</code></pre>
<h2 id="retrieve-types"><a class="header" href="#retrieve-types">Retrieve Types</a></h2>
<p>Classes are polymorphic.  If you search for generic vertices, you also receive all custom vertex instances:</p>
<pre><code class="language-java">// Retrieve Vertices
Iterable&lt;Vertex&gt; allVertices = graph.getVertices();
</code></pre>
<p>To retrieve custom classes, use the <code>getVertexType()</code> and the <code>getEdgeType</code> methods.  For instance, retrieving from the <code>graph</code> database instance:</p>
<pre><code class="language-java">OrientVertexType accountVertex = graph.getVertexType("Account");
OrientEdgeType livesEdge = graph.getEdgeType("Lives");
</code></pre>
<h2 id="drop-persistent-types"><a class="header" href="#drop-persistent-types">Drop Persistent Types</a></h2>
<p>To drop a persistent class, use the <code>dropVertexType()</code> and <code>dropVertexType()</code> methods.  For instance, dropping from the <code>graph</code> database instance:</p>
<pre><code class="language-java">graph.dropVertexType("Address");
graph.dropEdgeType("Lives");
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="graph-database-properties"><a class="header" href="#graph-database-properties">Graph Database Properties</a></h1>
<p>Fields in classes are called properties.  In this guide, you can consider properties synonymous with fields.</p>
<h2 id="working-with-properties-1"><a class="header" href="#working-with-properties-1">Working with Properties</a></h2>
<p>In order to use properties in your application, you first need to create the class and set an instance.  Once you have the class set, you can begin to work with properties on that class.</p>
<h3 id="creating-properties-2"><a class="header" href="#creating-properties-2">Creating Properties</a></h3>
<p>You can define properties for that class.  For instance,</p>
<pre><code class="language-java">// Retrieve Vertex
OrientVertexType accountVertex = graph.getVertexType("Account");

// Create Properties
accountVertex.createProperty("id", OType.INTEGER);
accountVertex.createProperty("birthDate", OType.DATE);
</code></pre>
<p>Bear in mind, each field must belong to a <a href="java/../general/Types.html">Type</a>.</p>
<h3 id="dropping-properties-1"><a class="header" href="#dropping-properties-1">Dropping Properties</a></h3>
<p>To drop a persistent class property, use the <a href="java/ref/OClass/dropProperty.html"><code>OClass.dropProperty()</code></a> method.  For instance,</p>
<pre><code class="language-java">accountVertex.dropProperty("name");
</code></pre>
<p>This drops the property <code>name</code>.  OrientDB does not remove dropped properties from the record unless you delete them explicitly using the SQL <a href="java/../sql/SQL-Update.html"><code>UPDATE</code></a> command with the <code>REMOVE</code> clause.</p>
<pre><code class="language-java">// Drop the Property
accountVertex.dropProperty("name");

// Remove the Records
database.command(new OCommandSQL("UPDATE Account REMOVE name").execute();
</code></pre>
<h2 id="using-constraints"><a class="header" href="#using-constraints">Using Constraints</a></h2>
<div class="table-wrapper"><table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td><img src="java/../images/warning.png" alt="" /></td><td>Using constraints with a distributed database may cause unexpected results.  Some operations execute in two steps: create and update, such as when creating an edge and then updating the vertex.  Constraints like <code>MANDATORY</code> and <code>NOTNULL</code> against fields would fail on distributed databases during the creation phase.</td></tr>
</tbody></table>
</div>
<p>OrientDB supports a number of constraints for each field:</p>
<div class="table-wrapper"><table><thead><tr><th>Constraint</th><th>Method</th><th>Description</th></tr></thead><tbody>
<tr><td><strong>Minimum Value</strong></td><td><code>setMin()</code></td><td>Defines the minimum value.  Property accepts strings and also works on date ranges.</td></tr>
<tr><td><strong>Maximum Value</strong></td><td><code>setMax()</code></td><td>Defines the maximum value.  Property accepts strings and also works on date ranges.</td></tr>
<tr><td><strong>Mandatory</strong></td><td><code>setMandatory()</code></td><td>Defines whether the property must be specified.</td></tr>
<tr><td><strong>Read Only</strong></td><td><code>setReadonly()</code></td><td>Defines whether you can update the property after creating the record.</td></tr>
<tr><td><strong>Not Null</strong></td><td><code>setNotNull()</code></td><td>Defines whether the property accepts null values.</td></tr>
<tr><td><strong>Unique</strong></td><td></td><td>Defines whether the property must be unique.</td></tr>
<tr><td><strong>Regex</strong></td><td></td><td>Defines whether the property must satisfy a Regular Expressions value.</td></tr>
<tr><td><strong>Ordered</strong></td><td><code>setOrdered()</code></td><td>Defines whether the edge list must be ordered, ensuring that a <code>List</code> is not used in place of a <code>Set</code>.</td></tr>
</tbody></table>
</div>
<p>For example,</p>
<pre><code class="language-java">// Create Unique Nickname
profile.createProperty("nick", OType.STRING).setMin("3").setMax("30")
	.setMandatory(true).setNotNull(true);
profile.createIndex("nickIdx", OClass.INDEX_TYPE.UNIQUE, "nick");

// Create User Properties
profile.createProperty("name", OType.STRING).setMin("3").setMax("30");
profile.createProperty("surname", OType.STRING).setMin("3").setMax("30");
profile.createProperty("registeredOn", OType.DATE).setMin("2010-01-01 00:00:00");
profile.createProperty("lastAccessOn", OType.DATE).setMin("2010-01-01 00:00:00");
</code></pre>
<h3 id="indexes-as-constraints-1"><a class="header" href="#indexes-as-constraints-1">Indexes as Constraints</a></h3>
<p>In order to set the property value to unique, use the <code>UNIQUE</code> index as a constraint by passing a <code>Parameter</code> object with the key <code>type</code>.  For instance,</p>
<pre><code class="language-java">graph.createKeyIndex("id", Vertex.class, new Parameter("type", "UNIQUE"));
</code></pre>
<p>OrientDB applies this constraint to all vertex and subclass instances.  To specify an index against a custom type, use the <code>class</code> parameter.</p>
<pre><code class="language-java">graph.createKeyIndex("name", Vertex.class, new Parameter("class", "Member"));
</code></pre>
<p>You can also define a unique index against a custom type:</p>
<pre><code class="language-java">graph.createKeyIndex("id", Vertex.class, new Parameter("type", "UNIQUE"), 
	new Parameter("class", "Member"));
</code></pre>
<p>You can then retrieve a vertex or an edge by key prefixing the class name to the field.  For instance, using the about <code>Member.name</code> in place of only <code>name</code>, which allows you to use the index created against the filed <code>name</code> in the class <code>Member</code>.</p>
<pre><code class="language-java">for( Vertex v : graph.getVertices("Member.name", "Jay")) {
	System.out.println("Found vertex: " + v)
}
</code></pre>
<p>If the class name is not passed, then it uses <code>V</code> for the vertices and <code>E</code> for edges.</p>
<pre><code class="language-java">graph.getVertices("name", "Jay");
graph.getEdges("age", 20);
</code></pre>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="java/../indexing/Indexes.html">Indexes</a></li>
<li><a href="java/Graph-Schema.html">Graph Schema</a></li>
<li><a href="java/Graph-Database-Tinkerpop.html">Graph Database</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="partitioned-graphs"><a class="header" href="#partitioned-graphs">Partitioned Graphs</a></h1>
<p>You can partition graphs using the <a href="java/../security/Database-Security.html#record-level-security">Record-level Security</a> feature.  This allows you to separate database records as sandboxes, where "restricted" records are inaccessible to unauthorized users. For more information about other solution for Multi-Tenant applications, look at <a href="java/../datamodeling/Multi-Tenant.html">Multi-Tenant</a>.</p>
<p>This tutorial provides a demonstration of sandboxing with the Graph API and the <a href="java/Graph-Database-Tinkerpop.html">TinkerPop</a> stack.  Partitioned Graph Databases allow you to build <a href="http://en.wikipedia.org/wiki/Multitenancy">Multi-tenant</a> applications.</p>
<blockquote>
<p><strong>Requirements</strong>:</p>
<ul>
<li>OrientDB 1.2.0-SNAPSHOT or higher</li>
<li>TinkerPop Blueprints 2.2.0 or higher</li>
</ul>
</blockquote>
<h2 id="creating-a-graph-database"><a class="header" href="#creating-a-graph-database">Creating a Graph Database</a></h2>
<p>To create a Partitioned Graph Database, you first need to create a database in which to partition.  For instance, the example below covers creating a <code>blog</code> database of the Graph type on the local file system:</p>
<pre>
$ <code class="lang-sh userinput">cd $ORIENTDB_HOME/bin</code>
$ <code class="lang-sh userinput">./console.sh</code>
OrientDB console v.1.2.0-SNAPSHOT www.orientechnologies.com
Type 'help' to display all the commands supported.

Installing extensions for GREMLIN language v.2.2.0-SNAPSHOT

orientdb> <code class="lang-sql userinput">CREATE DATABASE local::../databases/blog 
          admin admin_passwd local graph</code>
Creating database [local:../databases/blog] using the storage type [local]...
Database created successfully.

Current database is: local:../databases/blog
</pre>
<h2 id="enabling-partitioned-graphs"><a class="header" href="#enabling-partitioned-graphs">Enabling Partitioned Graphs</a></h2>
<p>Once you have created the Graph Database instance, you need to enable partitioning.  Alter the <code>V</code> and <code>E</code> classes to extend the <code>ORestricted</code>.  Doing so allows you to restrict vertex and edge instances.</p>
<pre>
orientdb {db=blog}> <code class="lang-sql userinput">ALTER CLASS V SUPERCLASS ORestricted</code>
Class updated successfully

orientdb {db=blog}> <code class="lang-sql userinput">ALTER CLASS E SUPERCLASS ORestricted</code>
Class updated successfully
</pre>
<h2 id="create-users"><a class="header" href="#create-users">Create Users</a></h2>
<p>With the database online and the vertex and edge classes altered to restricted, create two test users, (<code>luca</code> and <code>steve</code>), to use in exploring how sandboxing works on a Partitioned Graph Database.</p>
<p>These users represent users who blog on the application you're building.  Their level of permissions and authorization relates to the <code>writer</code> role.  First, ensure that the <code>writer</code> role exists on your database:</p>
<pre>
orientdb {db=blog}> <code class="lang-sql userinput">SELECT RID, name, rules FROM ORole 
                    WHERE name = "writer"</code>

---+------+--------+-----------------------------------------------
 # | RID  | name   | rules
---+------+--------+-----------------------------------------------
 0 | #4:2 | writer | {database=2, database.schema=7, 
   |      |        | database.cluster.internal=2,
   |      |        | database.cluster.orole=2, 
   |      |        | database.cluster.ouser=2,
   |      |        | database.class.*=15, database.cluster.*=15,
   |      |        | database.command=15, database.hook.record=15}
---+------+--------+-----------------------------------------------

3 item(s) found. Query executed in 0.045 sec(s).
</pre>
<p>Running these commands shows that you do in fact have a <code>writer</code> role configured on your database and that it uses a Record ID of <code>#4:2</code>.  You can now create the users.  There are two methods available to you, depending on which version of OrientDB you use.</p>
<h3 id="creating-users"><a class="header" href="#creating-users">Creating Users</a></h3>
<p>Beginning with version 2.1, OrientDB now features a <a href="java/../sql/SQL-Create-User.html"><code>CREATE USER</code></a> command. This allows you to create a new user in the current database, as opposed to inserting the credentials into the <code>OUser</code> and <code>ORole</code> classes.</p>
<p>To create users for Luca and Steve, run the following commands:</p>
<pre>
orientdb {db=blog}> <code class="lang-sql userinput">CREATE USER luca IDENTIFIED BY luca_passwd
                    ROLE writer</code>

orientdb {db=blog}> <code class="lang-sql userinput">CREATE USER steve IDENTIFIED BY steve_passwd 
                    ROLE writer</code>
</pre>
<p>The users are now active on your database as <code>luca</code> and <code>steve</code>.</p>
<h3 id="inserting-users"><a class="header" href="#inserting-users">Inserting Users</a></h3>
<p>For older implementations of OrientDB, there is no <a href="java/../sql/SQL-Create-User.html"><code>CREATE USER</code></a> command available to you.  To add users before version 2.1, you need to use <a href="java/../sql/SQL-Insert.html"><code>INSERT</code></a> statements to add the new values into the <code>OUser</code> class, using the record ID for the <code>writer</code> role, which you found above as <code>#4:2</code>:</p>
<pre>
orientdb {db=blog}> <code class="lang-sql userinput">INSERT INTO OUser SET name = 'luca', 
                    status = 'ACTIVE', password = 'luca_passwd', 
					roles = [#4:2]</code>

Inserted record 'OUser#5:4{name:luca,password: {SHA-256}D70F47790F
689414789EEFF231703429C7F88A10210775906460EDBF38589D90,roles:[1]} 
v1' in 0,001000 sec(s).

orientdb {db=blog}> <code class="lang-sql userinput">INSERT INTO OUser SET name = 'steve', 
                    status = 'ACTIVE', password = 'steve_passwd', 
					roles = [#4:2]</code>

Inserted record 'OUser#5:3{name:steve,password: {SHA-256}F148389D0
80CFE85952998A8A367E2F7EAF35F2D72D2599A5B0412FE4094D65C,roles:[1]}
v1' in 0,001000 sec(s).
</pre>
<h2 id="creating-graphs"><a class="header" href="#creating-graphs">Creating Graphs</a></h2>
<p>In order to work with the partition, you need to create graphs for each user on the database.  This requires that you log out from the <code>admin</code> user and log back in as Luca and then Steve, then create vertexes and edges with which to work.</p>
<h3 id="create-a-graph-for-luca"><a class="header" href="#create-a-graph-for-luca">Create a Graph for Luca</a></h3>
<p>First, using <a href="java/../console/Console-Command-Disconnect.html"><code>DISCONNECT</code></a> and <a href="java/../console/Console-Command-Connect.html"><code>CONNECT</code></a> disconnect from your admin session on the <code>blog</code> database and reconnect as Luca's user.</p>
<pre>
orientdb {db=blog}> <code class="lang-sql userinput">DISCONNECT</code>
Disconnecting from the database [blog]...OK

orientdb> <code class="lang-sql userinput">CONNECT local:../databases/blog luca luca_passwd</code>
Connecting to database [local:../databases/blog] with user 'luca'...OK

orientdb {db=blog}>
</pre>
<p>Now that you're logged in under Luca's user, using the <a href="java/../sql/SQL-Create-Vertex.html"><code>CREATE VERTEX</code></a> command, create two vertices: one for restaurants and one for pizza.</p>
<pre>
orientdb {db=blog}> <code class="lang-sql userinput">CREATE VERTEX SET label = 'food', 
                    name = 'Pizza'</code>
Created vertex 'V#9:0{label:food,name:Pizza,_allow:[1]} v0' in 0,001000 sec(s).

orientdb {db=blog}> <code class="lang-sql userinput">CREATE VERTEX SET label = 'restaurant', 
                    name = "Dante's Pizza"</code>
Created vertex 'V#9:1{label:restaurant,name:Dante's Pizza,_allow:[1]} v0' in 0,000000 sec(s).
</pre>
<p>Connect these vertices with an edge for menus, using <a href="java/../sql/SQL-Create-Edge.html"><code>CREATE EDGE</code></a>:</p>
<pre>
orientdb {db=blog}> <code class="lang-sql userinput">CREATE EDGE FROM #9:0 TO #9:1 SET label = 'menu'</code>
Created edge '[E#10:0{out:#9:0,in:#9:1,label:menu,_allow:[1]} 
v1]' in 0,003000 sec(s).
</pre>
<p>You can check the status using <a href="java/../sql/SQL-Query.html"><code>SELECT</code></a> against these vertices:</p>
<pre>
orientdb {db=blog}> <code class="lang-sql userinput">SELECT FROM V</code>

 ---+------+------------+---------------+-----------------
  # | RID  | label      | name          | _allow | out
 ---+------+------------+---------------+--------+--------
  0 | #9:0 | food       | Pizza         | [1]    | [1]
  1 | #9:1 | restaurant | Dante's Pizza | [1]    | null
 ---+------+------------+---------------+--------+--------
 2 item(s) found. Query executed in 0.034 sec(s).
</pre>
<h3 id="creating-a-graph-for-steve"><a class="header" href="#creating-a-graph-for-steve">Creating a Graph for Steve</a></h3>
<p>Now let's connect to the database using the 'Steve' user and check if there are vertices:</p>
<pre>
orientdb {db=blog}> <code class="lang-sql userinput">DISCONNECT</code>
Disconnecting from the database [blog]...OK

orientdb> <code class="lang-sql userinput">CONNECT local:../databases/blog steve steve_passwd</code>
Connecting to database [local:../databases/blog] with user 'steve'...OK

orientdb {db=blog}> <code class="lang-sql userinput">SELECT FROM V</code>

0 item(s) found. Query executed in 0.0 sec(s).
</pre>
<p>This confirms that the user Steve does not have access to vertices created by Luca.  Now, create some as Steve:</p>
<pre>
orientdb {db=blog}> <code class="lang-sql userinput">CREATE VERTEX SET label = 'car', 
                    name = 'Ferrari Modena'</code>

Created vertex 'V#9:2{label:car,name:Ferrari Modena,_allow:[1]} v0' in 0,000000 sec(s).

orientdb {db=blog}> <code class="lang-sql userinput">CREATE VERTEX SET label = 'driver', 
                    name = 'steve'</code>

Created vertex 'V#9:3{label:driver,name:steve,_allow:[1]} v0' in 0,000000 sec(s).

orientdb {db=blog}> <code class="lang-sql userinput">CREATE EDGE FROM #9:2 TO #9:3 
                    SET label = 'drive'</code>
					
Created edge '[E#10:1{out:#9:2,in:#9:3,label:drive,_allow:[1]} v1]' in 0,002000 sec(s).
</pre>
<p>Run the <a href="java/../sql/SQL-Query.html"><code>SELECT</code></a> query from earlier to see the vertices you've created:</p>
<pre>
orientdb {db=blog}> <code class="lang-sql userinput">SELECT FROM V</code>

---+------+--------+----------------+--------+------
 # | RID  | label  | name           | _allow | out
---+------+--------+----------------+--------+------
 0 | #9:2 | car    | Ferrari Modena | [1]    | [1]
 1 | #9:3 | driver | steve          | [1]    | null
---+------+--------+----------------+--------+------

2 item(s) found. Query executed in 0.034 sec(s).
</pre>
<p>As you can see, Steve's user still can't see vertices and edged that were created by other users. For the sake of example, see what happens when you try to create an edge that connects vertices from different users:</p>
<pre>
orientdb {db=blog}> <code class="lang-sql userinput">CREATE EDGE FROM #9:2 TO #9:0 
                    SET label = 'security-test'</code>

Error: com.orientechnologies.orient.core.exception.OCommandExecutionException: 
Error on execution of command: OCommandSQL [text=create edge from #9:2 to #
9:0 set label = 'security-test'] 
Error: java.lang.IllegalArgumentException: Source vertex '#9:0' does not exist
</pre>
<p>The partition used by Luca remains totally isolated from the one used by Steve.  OrientDB operates on the assumption that the other partition doesn't exist, it remains invisible to the current user while still present in the database.</p>
<h2 id="tinkerpop-stack"><a class="header" href="#tinkerpop-stack">TinkerPop Stack</a></h2>
<p>The <a href="java/../security/Database-Security.html#record-level-security">Record-level Security</a> feature is very powerful because it acts at a low-level within the OrientDB engine.  This allows for better integration of security features with the Java API and the <a href="java/Graph-Database-Tinkerpop.html">TinkerPop</a> stack.</p>
<p>For instance, try to display all vertices and edges using <a href="java/../gremlin/Gremlin.html">Gremlin</a>:</p>
<pre>
gremlin> <code class="lang-javascript userinput">g.V</code>
==> [v[#9:2], v[#9:3]]
Script executed in 0,448000 sec(s).

gremlin> <code class="lang-javascript userinput">g.E</code>
==> e[#10:1][#9:2-drive->#9:3]
Script executed in 0,123000 sec(s).
</pre>
<blockquote>
<p>This feature works with other technologies that rely on TinkerPop Blueprints:</p>
<ul>
<li><a href="https://github.com/tinkerpop/rexster/wiki">TinkerPop Rexter</a></li>
<li><a href="https://github.com/tinkerpop/pipes/wiki">TinkerPop Pipes</a></li>
<li><a href="https://github.com/tinkerpop/furnace/wiki">TinkerPop Furnace</a></li>
<li><a href="https://github.com/tinkerpop/frames/wiki">TinkerPop Frames</a></li>
<li><a href="http://thinkaurelius.github.com/faunus/">ThinkAurelius Faunus</a></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="lightweight-edges-2"><a class="header" href="#lightweight-edges-2">Lightweight Edges</a></h1>
<p>In OrientDB Graph databases, there are two types of edges available:</p>
<ul>
<li><a href="java/Lightweight-Edges.html#regular-edge-representation"><strong>Regular Edges</strong></a>, which are instances or extensions of the <code>E</code> class and have their own records on the database.</li>
<li><a href="java/Lightweight-Edges.html#lightweight-edge-representation"><strong>Lightweight Edges</strong></a>, which have no properties and have no identity on the database, since they only exist within the vertex records.</li>
</ul>
<p>The advantage of Lightweight Edges lies in performance and disk usage.  Similar to <a href="java/../datamodeling/Concepts.html#relationships">links</a>, because it doesn't create the underlying document it runs faster and saves on space, with the addition of allowing for bidirectional connections.  This allows you to use the <a href="java/../sql/SQL-Move-Vertex.html"><code>MOVE VERTEX</code></a> command to refactor your graph without breaking any links.</p>
<blockquote>
<p><strong>NOTE</strong>: Beginning in version 2.0, OrientDB disables Lightweight Edges by default.</p>
</blockquote>
<h2 id="edge-representations"><a class="header" href="#edge-representations">Edge Representations</a></h2>
<p>In order to better understand edges and their use, consider the differences in how OrientDB handles and stores them in records.  The examples below show a Graph Database built to form a social network where you need to connect to <code>Account</code> vertices by an edge to indicate that one user is friends with another.</p>
<h3 id="regular-edge-representation"><a class="header" href="#regular-edge-representation">Regular Edge Representation</a></h3>
<p>When building a social network using regular edges, the edge exists as a separate record, which is either an instance of <code>E</code> or an extension of that class.</p>
<pre><code>+---------------------+    +---------------------+    +---------------------+  
|   Account Vertex    |    |     Friend Edge     |    |    Account Vertex   |
|       #10:33        |    |       #17:11        |    |       #10:12        |
+---------------------+    +---------------------+    +---------------------+
|out_Friend: [#17:11] |&lt;--&gt;|out: [#10:33]        |    |                     |
+---------------------+    |         in: [#10:12]|&lt;--&gt;|in_Friend: [#17:11]  |
                           +---------------------+    +---------------------+
</code></pre>
<p>When using regular edges, the vertices are connected through an edge document.  Here, the account vertices for users #10:33 and #10:12 are connected by the edge class instance #17:11, which indicates that the first user is friends with the second.  The outgoing <code>out_Friend</code> property on #10:33 and the incoming <code>in_Friend</code> property on #10:12 each take #17:11 as a link to that edge.</p>
<p>When you cross this relationship, OrientDB loads the edge document #17:11  to resolve the other side of the relationship.</p>
<h3 id="lightweight-edge-representation"><a class="header" href="#lightweight-edge-representation">Lightweight Edge Representation</a></h3>
<p>When building a social network using Lightweight Edges, the edge doesn't exist as a document, but rather are connected directly to each other through properties on the relevant vertices.</p>
<pre><code>+---------------------+    +---------------------+
|   Account Vertex    |    |    Account Vertex   |
|       #10:33        |    |       #10:12        |
+---------------------+    +---------------------+
|out_Friend: [#10:12] |&lt;--&gt;|in_Friend: [#10:33]  |
+---------------------+    +---------------------+
</code></pre>
<p>When using Lightweight Edges, instead of an edge document, each vertex (here, #10:33 and #10:12), are connected directly to each other.  The outgoing <code>out_Friend</code> property in the #10:30 document contains the direct link to the vertex #10:12.  The occurs in #10:12, where the incoming <code>in_Friend</code> property contains a direct link to #10:30.</p>
<p>When you cross this relationship, OrientDB can register the relationship without needing to load a third record to resolve the relationship, thus it doesn't create an edge document.</p>
<h4 id="enabling-lightweight-edges"><a class="header" href="#enabling-lightweight-edges">Enabling Lightweight Edges</a></h4>
<p>Beginning in version 2.0, OrientDB disables Lightweight Edges by default on new databases.  The reasoning behind this decision is that it is easier for users and applications to operate on OrientDB from SQL when the edges are regular edges.  Enabling it by default created a number of issues with beginners just starting out with OrientDB who were unprepared for how it handles Lightweight Edges.</p>
<p>In the event that you would like to restore Lightweight Edges as the default, you can do so by updating the database.  From the Java API, add the following lines:</p>
<pre><code class="language-java">OrientGraph g = new OrientGraph("mygraph");
g.setUseLightweightEdges(true);
</code></pre>
<p>You can do the same from the Console using the <a href="java/../sql/SQL-Alter-Database.html"><code>ALTER DATABASE</code></a> command:</p>
<pre>
orientdb> <code class="lang-sql userinput">ALTER DATABASE custom useLightweightEdges=true</code>
</pre>
<p>Note that changing the <code>useLightweightEdges</code> to <code>true</code> does not update or transform any existing edges on the database.  They remain in the same state they held before you issued the command.  That said, all new edges you create after running the above commands are Lightweight Edges.</p>
<h2 id="lightweight-edges-vs-regular-edges"><a class="header" href="#lightweight-edges-vs-regular-edges">Lightweight Edges vs. Regular Edges</a></h2>
<p>There are advantages and disadvantages to using Lightweight Edges.  You should consider these before switching your application over to one or the other:</p>
<p><strong>Advantages</strong></p>
<ul>
<li><em>Faster Creation and Traversal</em>: Given that OrientDB can operate on the relationship between two vertices without needing to load any additional documents, it's able to create and traverse relationships faster with Lightweight Edges than it can with Regular Edges.</li>
</ul>
<p><strong>Disadvantages</strong></p>
<ul>
<li><em>Edge Properties</em>: Given that Lightweight Edges do not have records of their own, you cannot assign properties to the edge.</li>
<li><em>SQL Issues</em>: It is more difficult to interact with OrientDB through SQL given that there is no document underlying the edges.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="graph-batch-insert"><a class="header" href="#graph-batch-insert">Graph Batch Insert</a></h1>
<p>Creating big graphs in OrientDB is a common operation, so OrientDB provides some APIs to make it fast and easy.</p>
<h2 id="basic-use-case"><a class="header" href="#basic-use-case">Basic use case</a></h2>
<p>For a basic use case, where your graph fits in the following constraints:</p>
<ul>
<li>a single vertex class</li>
<li>a single edge class</li>
<li>vertices are identified by a numeric (Long) id</li>
<li>no properties on vertices and edges</li>
</ul>
<p>OrientDB provides an API called <a href="https://orientdb.dev/javadocs/develop/com/orientechnologies/orient/graph/batch/OGraphBatchInsertBasic.html">OGraphBatchInsertBasic</a>.</p>
<p>This API is designed for fast batch import of simple graphs, starting from an empty (or non existing) DB.</p>
<p>These limitations are intended to have best performance on a very simple use case. If these limitations do not fit your requirements you can rely on other implementations.</p>
<h3 id="typical-usage"><a class="header" href="#typical-usage">Typical usage:</a></h3>
<pre><code>   OGraphBatchInsertSimple batch = new OGraphBatchInsertSimple("plocal:your/db", "admin", "admin");
   batch.begin();
   batch.createEdge(0L, 1L);
   batch.createEdge(0L, 2L);
   ...
   batch.end();
</code></pre>
<p>There is no need to create vertices before connecting them:</p>
<pre><code>   batch.createVertex(0L);
   batch.createVertex(1L);
   batch.createEdge(0L, 1L);
</code></pre>
<p>is equivalent to (but less performing than):</p>
<pre><code>   batch.createEdge(0L, 1L);
</code></pre>
<p><code>batch.createVertex()</code> is needed only if you want to create unconnected vertices.</p>
<h2 id="slightly-more-complex-use-case"><a class="header" href="#slightly-more-complex-use-case">Slightly more complex use case</a></h2>
<p>For a use case, where your graph fits in the following constraints:</p>
<ul>
<li>a single vertex class</li>
<li>a single edge class</li>
<li>vertices are identified by a numeric (Long) id</li>
<li>edges and/or vertices have properties</li>
</ul>
<p>OrientDB provides an API called <a href="https://orientdb.dev/javadocs/develop/com/orientechnologies/orient/graph/batch/OGraphBatchInsert.html">OGraphBatchInsert</a>.</p>
<p>This API is designed for fast batch import of simple graphs, starting from an empty (or non existing) DB.</p>
<p>This batch insert procedure is made of four phases, that have to be executed in the correct order:</p>
<ol>
<li>begin(): initializes the database</li>
<li>create edges (with or without properties) and vertices</li>
<li>set properties on vertices</li>
<li>end(): flushes data to db</li>
</ol>
<h3 id="typical-usage-1"><a class="header" href="#typical-usage-1">Typical usage:</a></h3>
<pre><code>OGraphBatchInsert batch = new OGraphBatchInsert("plocal:your/db", "admin", "admin");
 
//phase 1: begin
batch.begin();
  
//phase 2: create edges
Map&lt;String, Object&gt; edgeProps = new HashMap&lt;String, Object&gt;();
edgeProps.put("foo", "bar");
batch.createEdge(0L, 1L, edgeProps);
batch.createVertex(2L);
batch.createEdge(3L, 4L, null);
...
  
//phase 3: set properties on vertices, THIS CAN BE DONE ONLY AFTER EDGE AND VERTEX CREATION
Map&lt;String, Object&gt; vertexProps = new HashMap&lt;String, Object&gt;();
 vertexProps.put("foo", "bar");
batch.setVertexProperties(0L, vertexProps);
...
  
//phase 4: end
batch.end();
</code></pre>
<p>There is no need to create vertices before connecting them:</p>
<pre><code>    batch.createVertex(0L);
    batch.createVertex(1L);
    batch.createEdge(0L, 1L, props);
</code></pre>
<p>is equivalent to (but less performing than):</p>
<pre><code>    batch.createEdge(0L, 1L, props);
</code></pre>
<p><code>batch.createVertex(Long)</code> is needed only if you want to create unconnected vertices.</p>
<div style="break-before: page; page-break-before: always;"></div><p>#OrientDB with Apache TinkerPop 3
<strong>(since v 3.0)</strong></p>
<p>OrientDB adheres to the <a href="http://tinkerpop.apache.org">Apache TinkerPop</a> standard and implements TinkerPop Stack interfaces.</p>
<p>In versions prior to 3.0, OrientDB uses the <a href="https://github.com/tinkerpop/blueprints">TinkerPop 2.x</a> implementation as the default for <a href="tinkerpop3/../java/Graph-Database-Tinkerpop.html">Java Graph API</a>.</p>
<p>Starting from version 3.0, OrientDB ships its own
APIs for handling Graphs (<a href="tinkerpop3/../java/Java-MultiModel-API.html">Multi-Model API</a>). Those APIs are used to implement the TinkerPop 3 interfaces.</p>
<p>The OrientDB TinkerPop development happens <a href="https://github.com/orientechnologies/orientdb-gremlin">here</a></p>
<ul>
<li><a href="tinkerpop3/OrientDB-TinkerPop3.html#installation">Installation</a></li>
<li><a href="tinkerpop3/">Gremlin Console</a></li>
<li><a href="tinkerpop3/">Gremlin Server</a></li>
<li><a href="tinkerpop3/">Graph API</a></li>
</ul>
<h2 id="installation-6"><a class="header" href="#installation-6">Installation</a></h2>
<p>Since TinkerPop stack has been removed as a dependency from the OrientDB Community Edition, starting with version 3.0 it will be available for <a href="http://orientdb.dev/downloads">download</a> as an Apache TinkerPop 3 enabled edition of OrientDB based on the Community Edition.</p>
<p>It contains all the features of the OrientDB Community Edition plus the integration with the Tinkerpop stack:</p>
<ul>
<li><a href="tinkerpop3/OrientDB-TinkerPop3.html#gremlin-console">Gremlin Console</a></li>
<li><a href="tinkerpop3/OrientDB-TinkerPop3.html#gremlin-server">Gremlin Server</a></li>
<li><a href="tinkerpop3/OrientDB-TinkerPop3.html#gremlin-server">Gremlin Driver</a></li>
</ul>
<h3 id="source-code-installation-1"><a class="header" href="#source-code-installation-1">Source Code Installation</a></h3>
<p>In addition to the binary packages, you can compile the OrientDB TinkerPop enabled distribution from the source code.
This process requires that you install <a href="http://www.git-scm.com/">Git</a> and <a href="https://maven.apache.org/">Apache Maven</a> on your system.</p>
<p>As a pre-requirement, you have to build the same branch for OrientDB core distribution:</p>
<pre><code class="language-sh">$ git clone https://github.com/orientechnologies/orientdb
$ cd orientdb
$ git checkout develop
$ mvn clean install -DskipTests
$ cd ..
</code></pre>
<p>Then you can proceed and build <code>orientdb-gremlin</code></p>
<pre><code class="language-sh">$ git clone https://github.com/orientechnologies/orientdb-gremlin
$ cd orientdb-gremlin
$ git checkout develop
$ mvn clean install
</code></pre>
<p>It is possible to skip tests:</p>
<pre><code class="language-sh">$ mvn clean install -DskipTests
</code></pre>
<p>This project follows the branching system of <a href="tinkerpop3/../admin/installation/Installation-from-Source.html">OrientDB</a>.</p>
<p>The build process installs all jars in the local maven repository and creates archives under the <code>distribution</code> module inside the <code>target</code> directory. At the time of writing, building from branch <code>develop</code> gave:</p>
<pre><code class="language-sh">$ls -l distribution/target/
total 266640
drwxr-xr-x   2 staff  staff    68B Mar 21 13:07 archive-tmp/
drwxr-xr-x   3 staff  staff   102B Mar 21 13:07 dependency-maven-plugin-markers/
drwxr-xr-x  12 staff  staff   408B Mar 21 13:07 orientdb-community-3.0.0-SNAPSHOT/
drwxr-xr-x   3 staff  staff   102B Mar 21 13:07 orientdb-gremlin-community-3.0.0-SNAPSHOT.dir/
-rw-r--r--   1 staff  staff    65M Mar 21 13:08 orientdb-gremlin-community-3.0.0-SNAPSHOT.tar.gz
-rw-r--r--   1 staff  staff    65M Mar 21 13:08 orientdb-gremlin-community-3.0.0-SNAPSHOT.zip
$
</code></pre>
<p>The directory <code>orientdb-gremlin-community-3.0.0-SNAPSHOT.dir</code> contains the OrientDB Gremlin distribution uncompressed.</p>
<h2 id="gremlin-console"><a class="header" href="#gremlin-console">Gremlin Console</a></h2>
<p>The Gremlin Console is an interactive terminal or REPL that can be used to traverse graphs and interact with the data that they contain. For more information about it see the documentation <a href="http://tinkerpop.apache.org/docs/current/reference/#gremlin-console">here</a></p>
<p>To start the Gremlin console run <strong>the gremlin.sh</strong> (or gremlin.bat on Windows OS) script located in the <strong>bin</strong> directory of the OrientDB Gremlin Distribution</p>
<pre><code>$ ./gremlin.sh 

         \,,,/
         (o o)
-----oOOo-(3)-oOOo-----
plugin activated: tinkerpop.orientdb
gremlin&gt; 
</code></pre>
<p>Alternatively if you downloaded the Gremlin Console from the Apache Tinkerpop <a href="https://tinkerpop.apache.org/">Site</a>, just install the OrientDB Gremlin Plugin with</p>
<pre><code>gremlin&gt; :install com.orientechnologies orientdb-gremlin {version}
</code></pre>
<p>and then activate it</p>
<pre><code>gremlin&gt; :plugin use tinkerpop.orientdb
</code></pre>
<h3 id="open-the-graph-database"><a class="header" href="#open-the-graph-database">Open the graph database</a></h3>
<p>Before playing with <a href="http://gremlindocs.com">Gremlin</a> you need a valid <a href="tinkerpop3/../java/Tutorial-Java.html#use-case-graph-api"><strong>OrientGraph</strong></a> instance that points to an OrientDB database. To know all the database types look at <a href="tinkerpop3/../datamodeling/Concepts.html#database-url">Storage types</a>.</p>
<p>When you're working with a local or an in-memory database, if the database does not exist it's created for you automatically. Using the remote connection you need to create the database on the target server before using it. This is due to security restrictions.</p>
<p>Once created the <strong><a href="tinkerpop3/OrientDB-TinkerPop3.html#orientdb-tinkerpop-graph-api">OrientGraph</a></strong> instance with a proper URL is necessary to assign it to a variable. <a href="https://tinkerpop.apache.org/gremlin.html">Gremlin</a> is written in Groovy, so it supports all the Groovy syntax, and both can be mixed to create very powerful scripts!</p>
<p>Example with a memory database (see below for more information about it):</p>
<pre><code class="language-java">gremlin&gt; graph = OrientGraph.open();
==&gt;orientgraph[memory:orientdb-0.5772652169975153]
</code></pre>
<p>Some useful links:</p>
<ul>
<li><a href="http://tinkerpop.apache.org/docs/current/reference/#graph">The Graph</a></li>
<li><a href="http://tinkerpop.apache.org/docs/current/reference/#traversal">All available steps</a></li>
</ul>
<h4 id="working-with-in-memory-database"><a class="header" href="#working-with-in-memory-database">Working with in-memory database</a></h4>
<p>In this mode the database is volatile and all the changes will be not persistent. Use this in a clustered configuration (the database life is assured by the cluster itself) or just for test.</p>
<pre><code class="language-java">gremlin&gt; graph = OrientGraph.open()
==&gt;orientgraph[memory:orientdb-0.4274754723616194]
</code></pre>
<h4 id="working-with-local-database"><a class="header" href="#working-with-local-database">Working with local database</a></h4>
<p>This is the most often used mode. The console opens and locks the database for exclusive use. This doesn't require starting an OrientDB server.</p>
<pre><code class="language-java">gremlin&gt; graph = OrientGraph.open("embedded:/tmp/gremlin/demo");
==&gt;orientgraph[plocal:/tmp/gremlin/demo]
</code></pre>
<h4 id="working-with-a-remote-database"><a class="header" href="#working-with-a-remote-database">Working with a remote database</a></h4>
<p>To open a database on a remote server be sure the server is up and running first. To start the server just launch <strong>server.sh</strong> (or server.bat on Windows OS) script. For more information look at <a href="tinkerpop3/../internals/DB-Server.html">OrientDB Server</a></p>
<pre><code class="language-java">gremlin&gt; graph = OrientGraph.open("remote:localhost/demodb");
==&gt;orientgraph[remote:localhost/demodb]
</code></pre>
<h4 id="use-security"><a class="header" href="#use-security">Use security</a></h4>
<p>OrientDB supports security by creating multiple users and roles associated with certain privileges. To know more look at <a href="tinkerpop3/../security/Security.html">Security</a>. To open the graph database with a different user than the default, pass the user and password as additional parameters:</p>
<pre><code class="language-java">gremlin&gt; graph = OrientGraph.open("remote:localhost/demodb","reader","reader");
==&gt;orientgraph[remote:localhost/demodb]
</code></pre>
<h4 id="with-configuration"><a class="header" href="#with-configuration">With Configuration</a></h4>
<pre><code>gremlin&gt; config = new BaseConfiguration()
==&gt;org.apache.commons.configuration.BaseConfiguration@2d38edfd
gremlin&gt; config.setProperty("orient-url","remote:localhost/demodb")
==&gt;null
gremlin&gt; graph = OrientGraph.open(config)
==&gt;orientgraph[remote:localhost/demodb]
</code></pre>
<p>Available configurations are :</p>
<ul>
<li><strong>orient-url</strong>: Connection URL.</li>
<li><strong>orient-user</strong>: Database User.</li>
<li><strong>orient-pass</strong>: Database Password.</li>
<li><strong>orient-transactional</strong>: Transactional. Configuration. If true the <code>OrientGraph</code> instance will support transactions (Disabled by default).</li>
</ul>
<h3 id="mutating-the-graph"><a class="header" href="#mutating-the-graph">Mutating the Graph</a></h3>
<h4 id="create-a-new-vertex"><a class="header" href="#create-a-new-vertex">Create a new Vertex</a></h4>
<p>To create a new vertex, use the <strong>addVertex()</strong> method. The vertex will be created and a unique id will be displayed as the return value.</p>
<pre><code class="language-java">graph.addVertex();
==&gt;v[#5:0]
</code></pre>
<h4 id="create-an-edge"><a class="header" href="#create-an-edge">Create an edge</a></h4>
<p>To create a new edge between two vertices, use the <strong>v1.addEdge(label, v2)</strong> method. The edge will be created with the label specified.</p>
<p>In the example below two vertices are created and assigned to a variable (Gremlin is based on Groovy), then an edge is created between them.</p>
<pre><code class="language-java">gremlin&gt;  v1 = graph.addVertex();
==&gt;v[#10:0]

gremlin&gt;  v2 = graph.addVertex();
==&gt;v[#11:0]

gremlin&gt; e = v1.addEdge('friend',v2)
==&gt;e[#17:0][#10:0-friend-&gt;#11:0]
</code></pre>
<h4 id="close-the-database"><a class="header" href="#close-the-database">Close the database</a></h4>
<p>To close a graph use the <strong>close()</strong> method:</p>
<pre><code class="language-java">gremlin&gt; graph.close()
==&gt;null
</code></pre>
<p>This is not strictly necessary because OrientDB always closes the database when the Gremlin Console quits.</p>
<h4 id="transactions-3"><a class="header" href="#transactions-3">Transactions</a></h4>
<p>OrientGraph supports Transactions. By default Tx are disabled. Use configuration to enable it.</p>
<pre><code>gremlin&gt; config = new BaseConfiguration()
==&gt;org.apache.commons.configuration.BaseConfiguration@2d38edfd
gremlin&gt; config.setProperty("orient-url","remote:localhost/demodb")
==&gt;null
gremlin&gt; config.setProperty("orient-transactional",true)
==&gt;null
gremlin&gt; graph = OrientGraph.open(config)
==&gt;orientgraph[remote:localhost/demodb]
</code></pre>
<p>When using transactions OrientDB assigns a temporary identifier to each vertex and edge that is created.
use <code>graph.tx().commit()</code> to save them.</p>
<p>Transaction Example</p>
<pre><code>gremlin&gt; config = new BaseConfiguration()
==&gt;org.apache.commons.configuration.BaseConfiguration@6b7d1df8
gremlin&gt; config.setProperty("orient-url","remote:localhost/demodb")
==&gt;null
gremlin&gt; config.setProperty("orient-transactional",true)
==&gt;null
gremlin&gt; graph = OrientGraph.open(config)
==&gt;orientgraph[remote:localhost/demodb]
gremlin&gt; graph.tx().isOpen()
==&gt;true
gremlin&gt; v1 = graph.addVertex()
==&gt;v[#-1:-2]
gremlin&gt; v2 = graph.addVertex()
==&gt;v[#-1:-3]
gremlin&gt; e = v1.addEdge("friends",v2)
==&gt;e[#-1:-4][#-1:-2-friends-&gt;#-1:-3]
gremlin&gt; graph.tx().commit()
==&gt;null
</code></pre>
<h3 id="traversal"><a class="header" href="#traversal">Traversal</a></h3>
<p>The power of Gremlin is in traversal. Once you have a graph loaded in your database you can traverse it in many different ways. For more info about traversal with Gremlin see <a href="http://tinkerpop.apache.org/docs/current/reference/#traversal">here</a></p>
<p>The entry point for traversal is a TraversalSource that can be easily obtained by an opened OrientGraph instance with:</p>
<pre><code>gremlin&gt; graph = OrientGraph.open()
==&gt;orientgraph[memory:orientdb-0.41138060448051794]
gremlin&gt; g = graph.traversal()
==&gt;graphtraversalsource[orientgraph[memory:orientdb-0.41138060448051794], standard]
</code></pre>
<h4 id="retrieve-a-vertex"><a class="header" href="#retrieve-a-vertex">Retrieve a vertex</a></h4>
<p>To retrieve a vertex by its ID, use the <strong>V(id)</strong> method passing the <a href="tinkerpop3/../datamodeling/Concepts.html#record-id">RecordId</a> as an argument (with or without the prefix '#'). This example retrieves the first vertex created in the above example.</p>
<pre><code class="language-java">gremlin&gt; g.V('#33:0')
==&gt;v[#33:0]
</code></pre>
<h4 id="get-all-the-vertices"><a class="header" href="#get-all-the-vertices">Get all the vertices</a></h4>
<p>To retrieve all the vertices in the opened graph use <strong>.V()</strong> (V in upper-case):</p>
<pre><code class="language-java">gremlin&gt; g.V()
==&gt;v[#33:0]
==&gt;v[#33:1]
==&gt;v[#33:2]
==&gt;v[#33:3]
</code></pre>
<h4 id="retrieve-an-edge"><a class="header" href="#retrieve-an-edge">Retrieve an edge</a></h4>
<p>Retrieving an edge is very similar to retrieving a vertex.  Use the <code>E(id)</code> method passing the <a href="tinkerpop3/../datamodeling/Concepts.html#record-id">RecordId</a> as an argument (with or without the prefix '#'). This example retrieves the first edge created in the previous example.</p>
<pre><code class="language-java">gremlin&gt; g.E('145:0')
==&gt;e[#145:0][#121:0-IsFromCountry-&gt;#33:29]
</code></pre>
<h4 id="get-all-the-edges"><a class="header" href="#get-all-the-edges">Get all the edges</a></h4>
<p>To retrieve all the edges in the opened graph use <code>.E()</code> (E in upper-case):</p>
<pre><code class="language-java">gremlin&gt; g.E()
==&gt;e[#145:0][#121:0-IsFromCountry-&gt;#33:29]
==&gt;e[#145:1][#121:1-IsFromCountry-&gt;#40:11]
==&gt;e[#145:2][#121:2-IsFromCountry-&gt;#37:0]
</code></pre>
<h4 id="basic-traversal"><a class="header" href="#basic-traversal">Basic Traversal</a></h4>
<p>To display all the outgoing edges of a vertex use <code>.outE(&lt;label&gt;)</code> .
Label is optional and if passed the outgoing edges will be filtered by that label</p>
<p>Example:</p>
<pre><code class="language-java">gremlin&gt; g.V('#41:1').outE()
==&gt;e[#221:6][#41:1-HasFriend-&gt;#42:1]
==&gt;e[#222:6][#41:1-HasFriend-&gt;#43:1]
</code></pre>
<p>To display all the incoming edges of a vertex use <code>.inE(&lt;label&gt;)</code>. Example:</p>
<pre><code class="language-java">gremlin&gt; g.V('#41:1').inE()
==&gt;e[#224:0][#41:0-HasFriend-&gt;#41:1]
==&gt;e[#217:2][#42:0-HasFriend-&gt;#41:1]
==&gt;e[#217:3][#43:0-HasFriend-&gt;#41:1]
==&gt;e[#224:3][#44:0-HasFriend-&gt;#41:1]
==&gt;e[#222:4][#45:0-HasFriend-&gt;#41:1]
==&gt;e[#219:5][#46:0-HasFriend-&gt;#41:1]
==&gt;e[#223:5][#47:0-HasFriend-&gt;#41:1]
==&gt;e[#218:6][#48:0-HasFriend-&gt;#41:1]
==&gt;e[#185:0][#121:0-HasProfile-&gt;#41:1]
</code></pre>
<p>For more information look at the <a href="http://tinkerpop.apache.org/docs/current/reference/#traversal">Gremlin Traversal</a>.</p>
<h4 id="filter-results"><a class="header" href="#filter-results">Filter results</a></h4>
<p>This example returns all the outgoing edges of all the vertices with label equal to 'friend'.</p>
<pre><code class="language-java">gremlin&gt; g.V('#41:1').inE('HasProfile')
==&gt;e[#185:0][#121:0-HasProfile-&gt;#41:1]
gremlin&gt; 
</code></pre>
<h4 id="create-complex-paths"><a class="header" href="#create-complex-paths">Create complex paths</a></h4>
<p><a href="https://tinkerpop.apache.org/gremlin.html">Gremlin</a> allows you to concatenate expressions to create more complex traversals in a single line:</p>
<pre><code class="language-java">g.V().in().out()
</code></pre>
<p>Of course this could be much more complex. Below is an example with the graph taken from the official documentation:</p>
<pre><code class="language-java">gremlin&gt; g.V('44:0').out('HasFriend').out('HasFriend').values('Name').dedup()
==&gt;Frank
==&gt;Emanuele
==&gt;Paolo
==&gt;Colin
==&gt;Andrey
==&gt;Sergey
gremlin&gt; 
</code></pre>
<h2 id="gremlin-server"><a class="header" href="#gremlin-server">Gremlin Server</a></h2>
<p>There are two ways to use OrientDB inside the Gremlin Server</p>
<ul>
<li>Use the OrientDB-TP3 distribution that embed the Gremlin Server</li>
<li>Install the OrientDB-Gremlin Driver into a GremlinServer</li>
</ul>
<h3 id="orientdb-tp3"><a class="header" href="#orientdb-tp3">OrientDB-TP3</a></h3>
<p>Download the latest version of OrientDB-TP3 <a href="https://orientdb.dev/downloads/">here</a>.
and start OrientDB to automatically start the embedded Gremlin Server.
The configuration of the Gremlin Server is in <code>$ORIENTDB_HOME/config</code>.</p>
<p>When using the embedded version by default the Authentication manager authenticate the users against OrientDB server user
with permission <code>gremlin.server</code>.</p>
<h3 id="install-orientdb-gremlin"><a class="header" href="#install-orientdb-gremlin">Install OrientDB-Gremlin</a></h3>
<p>Download the latest Gremlin Server distribution <a href="https://tinkerpop.apache.org/">here</a></p>
<p>and then install the OrientDB Gremlin driver with</p>
<pre><code class="language-sh">bin/gremlin-server.sh -i com.orientechnologies orientdb-gremlin ${version}
</code></pre>
<h4 id="orientdb-gremlin-server-configuration"><a class="header" href="#orientdb-gremlin-server-configuration">OrientDB Gremlin Server configuration</a></h4>
<p>YAML configuration example (save as <code>gremlin-server.yaml</code>)</p>
<pre><code>host: localhost
port: 8182
scriptEvaluationTimeout: 30000
channelizer: org.apache.tinkerpop.gremlin.server.channel.WebSocketChannelizer
graphs: {
  graph : conf/orientdb-empty.properties
}
scriptEngines: {
  gremlin-groovy: {
    plugins: { org.apache.tinkerpop.gremlin.server.jsr223.GremlinServerGremlinPlugin: {},
               org.apache.tinkerpop.gremlin.orientdb.jsr223.OrientDBGremlinPlugin: {},
               org.apache.tinkerpop.gremlin.jsr223.ImportGremlinPlugin: {classImports: [java.lang.Math], methodImports: [java.lang.Math#*]},
               org.apache.tinkerpop.gremlin.jsr223.ScriptFileGremlinPlugin: {files: [ scripts/empty-sample.groovy]}}}}
serializers:
  - { className: org.apache.tinkerpop.gremlin.driver.ser.GryoMessageSerializerV3d0, config: { ioRegistries: [org.apache.tinkerpop.gremlin.orientdb.io.OrientIoRegistry] }}             # application/vnd.gremlin-v3.0+gryo
  - { className: org.apache.tinkerpop.gremlin.driver.ser.GryoMessageSerializerV3d0, config: { serializeResultToString: true }}                                                                       # application/vnd.gremlin-v3.0+gryo-stringd
  - { className: org.apache.tinkerpop.gremlin.driver.ser.GraphSONMessageSerializerV3d0, config: { ioRegistries: [org.apache.tinkerpop.gremlin.orientdb.io.OrientIoRegistry] }}         # application/json
processors:
  - { className: org.apache.tinkerpop.gremlin.server.op.session.SessionOpProcessor, config: { sessionTimeout: 28800000 }}
  - { className: org.apache.tinkerpop.gremlin.server.op.traversal.TraversalOpProcessor, config: { cacheExpirationTime: 600000, cacheMaxSize: 1000 }}
metrics: {
  consoleReporter: {enabled: true, interval: 180000},
  csvReporter: {enabled: true, interval: 180000, fileName: /tmp/gremlin-server-metrics.csv},
  jmxReporter: {enabled: true},
  slf4jReporter: {enabled: true, interval: 180000}}
strictTransactionManagement: false
maxInitialLineLength: 4096
maxHeaderSize: 8192
maxChunkSize: 8192
maxContentLength: 65536
maxAccumulationBufferComponents: 1024
resultIterationBatchSize: 64
writeBufferLowWaterMark: 32768
writeBufferHighWaterMark: 65536
ssl: {
  enabled: false}

</code></pre>
<p>Graph Configuration properties example (e.g. save as <code>orientdb-empty.properties</code>. It has to be the one referenced in the <code>gremlin-server.yaml</code> file)</p>
<pre><code>gremlin.graph=org.apache.tinkerpop.gremlin.orientdb.OrientFactory
orient-url=plocal:/tmp/graph
orient-user=admin
orient-pass=admin
</code></pre>
<blockquote>
<p><strong>Note</strong>: currently <code>https://mvnrepository.com/artifact/com.github.jnr/jffi/1.2.23</code> is missing. Download and add to <code>lib</code> or <code>plugins</code> folder.</p>
</blockquote>
<h2 id="orientdb-tinkerpop-graph-api"><a class="header" href="#orientdb-tinkerpop-graph-api">OrientDB TinkerPop Graph API</a></h2>
<p>In order to use the OrientDB TinkerPop Graph API implementation, you need to create an instance of the <code>OrientGraph</code> class. If the database already exists, the Graph API opens it.</p>
<blockquote>
<p><strong>NOTE</strong>: When creating a database through the Graph API, you can only create <code>PLocal</code> and <code>Memory</code> databases.  Remote databases must already exist.</p>
</blockquote>
<blockquote>
<p><strong>NOTE</strong>: In v. 2.2 and following releases, when using PLocal or Memory,please set MaxDirectMemorySize (JVM setting) to a high value, like 512g <code>-XX:MaxDirectMemorySize=512g</code></p>
</blockquote>
<p>When building multi-threaded application, use one instance of <code>OrientGraph</code> per thread.  Bear in mind that all graph components, such as vertices and edges, are not thread safe.  So, sharing them between threads may result in unpredictable results.</p>
<p>Remember to always close the graph instance when you are done with it, using the <code>.close()</code> method.</p>
<h4 id="working-with-in-memory-database-1"><a class="header" href="#working-with-in-memory-database-1">Working with in-memory database</a></h4>
<pre><code class="language-java">OrientGraph graph = OrientGraph.open();
try {
  ...
} finally {
  graph.close();
}
</code></pre>
<h4 id="working-with-local-database-1"><a class="header" href="#working-with-local-database-1">Working with local database</a></h4>
<pre><code class="language-java">OrientGraph graph = OrientGraph.open("embedded:/tmp/gremlin/demo");
try {
  ...
} finally {
  graph.close();
}
</code></pre>
<h4 id="working-with-remote-database"><a class="header" href="#working-with-remote-database">Working with remote database</a></h4>
<pre><code class="language-java">OrientGraph graph = OrientGraph.open("remote:localhost/demodb");
try {
  ...
} finally {
  graph.close();
}
</code></pre>
<h4 id="using-the-graph-factory"><a class="header" href="#using-the-graph-factory">Using the Graph Factory</a></h4>
<p>The <code>OrientGraphFactory</code> act as a factory for <code>OrientGraph</code> instances
Using a Graph Factory in your application is relatively straightforward.  First, create and configure a factory instance using the <code>OrientGraphFactory</code> class.  Then, use the factory whenever you need to create an <code>OrientGraph</code> instance and shut it down to return it to the pool.  When you're done with the factory, close it to release all instances and free up system resources.</p>
<pre><code class="language-java">OrientGraphFactory factory = new OrientGraphFactory("remote:localhost/demodb","admin","admin");
</code></pre>
<p>Then you can:</p>
<ul>
<li>retrieve a transactional instance, use the getTx() method on your factory object:</li>
</ul>
<pre><code class="language-java">OrientGraph txGraph = factory.getTx();
</code></pre>
<ul>
<li>retrieve a non-transactional instance, use the getNoTx() method on your factory object:</li>
</ul>
<pre><code>OrientGraph noTxGraph = factory.getNoTx();
</code></pre>
<h4 id="shutting-down-graph-instances-1"><a class="header" href="#shutting-down-graph-instances-1">Shutting Down Graph Instances</a></h4>
<p>When you're done with a Graph Database instance, you can return it to the pool by calling the <code>close()</code> method on the instance.  This method does not close the instance.  The instance remains open and available for the next requester:</p>
<pre><code class="language-java">graph.close();
</code></pre>
<h4 id="releasing-the-graph-factory-1"><a class="header" href="#releasing-the-graph-factory-1">Releasing the Graph Factory</a></h4>
<p>When you're ready to release all instances, call the <code>close()</code> method on the factory.  In the case of pool usage, this also frees up the system resources claimed by the pool:</p>
<pre><code class="language-java">factory.close();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="document-api"><a class="header" href="#document-api">Document API</a></h1>
<blockquote>
<p>In case of embedded GroupId: <strong>com.orientechnologies</strong>  ArtifactId: <strong>orientdb-core</strong></p>
</blockquote>
<blockquote>
<p>In case of remote GroupId: <strong>com.orientechnologies</strong>  ArtifactId: <strong>orientdb-client</strong></p>
</blockquote>
<p>The Document Database in OrientDB is the foundation of higher level implementations, like the <a href="java/Object-Database.html">Object Database</a> and the <a href="java/Graph-Database-Tinkerpop.html">Tinkerpop Graph</a>.  The Document API supports:</p>
<ul>
<li><a href="java/Java-Multi-Threading.html">Multi-thread Access</a></li>
<li><a href="java/../internals/Transactions.html">Transactions</a></li>
<li><a href="java/Document-API-Documents.html#retrieving-documents">Queries</a></li>
<li><a href="java/Document-API-Documents.html#traversing-documents">Traverse</a></li>
</ul>
<pre><code class="language-java">// OPEN THE DATABASE
OrientDB orientDB = new OrientDB("remote:localhost");
ODatabaseDocument db = orientDB.open("petshop","admin", "admin_passwd");

// CREATE A NEW DOCUMENT AND FILL IT
ODocument doc = new ODocument("Person");
doc.field( "name", "Luke" );
doc.field( "surname", "Skywalker" );
doc.field( "city", new ODocument("City")
   .field("name","Rome")
   .field("country", "Italy") );

// SAVE THE DOCUMENT
db.save(doc);

db.close();
orientDB.close();
</code></pre>
<blockquote>
<p>For more information, see</p>
<ul>
<li>Javadoc: <a href="http://www.orientechnologies.com/javadoc/latest/">JavaDoc</a></li>
<li><a href="java/../studio/README.html">OrientDB Studio Web tool</a>.</li>
</ul>
</blockquote>
<h2 id="using-the-document-database"><a class="header" href="#using-the-document-database">Using the Document Database</a></h2>
<p>In order to work with documents in your application, you first need to open a database and create an instance in your code.  For instance, when opening on localhost through the <code>remote</code> interface, you might use something like this:</p>
<pre><code class="language-java">OrientDB orientDB = new OrientDB("remote:localhost");
ODatabaseDocument db = orientDB.open("petshop","admin", "admin_passwd");
</code></pre>
<p>Once you have the database open, you can create, update and delete documents, as well as query document data to use in your application.</p>
<blockquote>
<p>For more information, see</p>
<ul>
<li><a href="java/Document-API-Database.html">Working with Document Databases</a></li>
<li><a href="java/Document-API-Documents.html">Working with Documents</a></li>
</ul>
</blockquote>
<h3 id="creating-documents"><a class="header" href="#creating-documents">Creating Documents</a></h3>
<p>You can create documents through the <code>ODocument</code> object by setting up the document instance and then calling the <code>save()</code> method on that instance.  For instance,</p>
<pre><code class="language-java">ODocument animal = new ODocument("Animal");
animal.field("name", "Gaudi");
animal.field("location", "Madrid");
animal.save()
</code></pre>
<h3 id="updating-documents"><a class="header" href="#updating-documents">Updating Documents</a></h3>
<p>You can update persistent documents through the Java API by modifying the document instance and then calling <code>save()</code> on the database.  Alternatively, you can call <code>save()</code> on the document instance itself to synchronize the changes to the database.</p>
<pre><code class="language-java">animal.field( "location", "Nairobi" );
animal.save();
</code></pre>
<p>When you call <code>save()</code>, OrientDB only updates the fields you've changed.</p>
<blockquote>
<p><strong>NOTE</strong>: This behavior can vary depending on whether you've begun a transaction.  For more information, see <a href="java/../internals/Transactions.html">Transactions</a>.</p>
</blockquote>
<p>For instance, using the code below you can raise the price of animals by 5%:</p>
<pre><code class="language-java">for (ODocument animal : database.browseClass("Animal")) {
  animal.field("price", animal.field("price") * 1.05);
  animal.save();
}
</code></pre>
<h3 id="deleting-documents"><a class="header" href="#deleting-documents">Deleting Documents</a></h3>
<p>Through the Java API, you can delete documents through the <code>delete()</code> method on the loaded document instance. For instance,</p>
<pre><code class="language-java">animal.delete();
</code></pre>
<blockquote>
<p><strong>NOTE</strong>: This behavior can vary depending on whether you've begun a transaction.  For more information, see <a href="java/../internals/Transactions.html">Transactions</a>.</p>
</blockquote>
<p>For instance, using the code below you can delete all documents of the <code>Animal</code> class:</p>
<pre><code class="language-java">for (ODocument animal : database.browseClass("Animal")) {
   animal.delete();
}
</code></pre>
<h2 id="schema-3"><a class="header" href="#schema-3">Schema</a></h2>
<p>OrientDB is flexible when it comes to schemas.  You can use it,</p>
<ul>
<li><strong>Schema Full</strong>, such as in Relational Databases.</li>
<li><strong>Schema Less</strong>, such as with many NoSQL Document Databases.</li>
<li><strong>Scheme Hybrid</strong>, which mixes the two.</li>
</ul>
<blockquote>
<p>For more information, see <a href="java/../general/Schema.html">Schemas</a>.</p>
</blockquote>
<p>In order to use the schema with documents, create the <code>ODocument</code> instance with the constructor <code>ODocument(String className)</code>, passing it the class name as an argument.  If you haven't declared the class, OrientDB creates it automatically with no fields.  This won't work during transactions, given it can't apply schema changes in transactional contexts.</p>
<h2 id="security-5"><a class="header" href="#security-5">Security</a></h2>
<p>Few NoSQL implementations support security.  OrientDB does.  For more information on its security features, see <a href="java/../security/Security.html">Security</a>.</p>
<p>To manage the security from within the Java API, get the Security Manager and use it to operate on users and roles.  For instance,</p>
<pre><code class="language-java">OSecurity sm = db.getMetadata().getSecurity();
OUser user = sm.createUser(
   "john.smith", "smith_passwd",
   new String[]{"admin"});
</code></pre>
<p>Once you've have users on the database, you can retrieve information about them through the Java API:</p>
<pre><code class="language-java">OUser user = db.getUser();
</code></pre>
<h2 id="transactions-4"><a class="header" href="#transactions-4">Transactions</a></h2>
<p>Transactions provide you with a practical way to group sets of operations together.  OrientDB supports <a href="http://en.wikipedia.org/wiki/ACID">ACID</a> transactions, ensuring that either all operations succeed or none of them do.  The database always remains consistent.</p>
<blockquote>
<p>For more information, see <a href="java/../internals/Transactions.html">Transactions</a>.</p>
</blockquote>
<p>OrientDB manages transactions at the database-level.  Currently, it does not support nesting transactions.  A database instance can only have one transaction running at a time. It provides three methods in handling transactions:</p>
<ul>
<li><strong><code>begin()</code></strong> Starts a new transaction.  If a transaction is currently running, it's rolled back to allow the new one to start.</li>
<li><strong><code>commit()</code></strong>  Ends the transaction, making the changes persistent.  If an error occurs during the commit, the transaction is rolled back and it raises an <code>OTransactionException</code> exception.</li>
<li><strong><code>rollback()</code></strong> Ends the transaction and removes all changes.</li>
</ul>
<h3 id="optimistic-approach"><a class="header" href="#optimistic-approach">Optimistic approach</a></h3>
<p>In its current release, OrientDB uses <a href="java/../internals/Transactions.html#optimistic-transaction">Optimistic Transactions</a>, in which no lock is kept and all operations are checked on the commit.  This improves concurrency, but can throw an <code>OConcurrentModificationException</code> exception in cases where the records are modified by concurrent client threads.  In this scenario, the client code can reload the updated records and repeat the transaction.</p>
<p>When optimistic transactions run, all changes are kept in memory.  If you're using remote storage, the changes are sent to the server only when you executed a query or you call the <code>commit()</code> method.  All changes transfer in a block to reduce network latency, speed up the execution and increase concurrency.  This differs from most Relational Databases, where changes are sent immediately to the server during transactions.</p>
<h3 id="usage-7"><a class="header" href="#usage-7">Usage</a></h3>
<p>OrientDB commits transactions only when you call the <code>commit()</code> method and no errors occur.  The most common use case for transactions is to enclose all database operations within a <code>try</code>/<code>finally</code> blocks.  When you close the database, (that is, when your application executes the <code>finally</code> block), OrientDB automatically rolls back any pending transactions still running.</p>
<p>For instance,</p>
<pre><code class="language-java">OrientDB orientDB = new OrientDB("remote:localhost");

try (ODatabaseDocument db = orientDB.open("petshop","admin", "admin_passwd")) {
  db.begin();
  // YOUR CODE
  db.commit();
}

orientDB.close();
</code></pre>
<h2 id="index-api"><a class="header" href="#index-api">Index API</a></h2>
<blockquote>
<p>See also <a href="java/../indexing/Indexes.html">SQL Indices</a>.</p>
</blockquote>
<p>You can declare an index on a property or a group of properties this will make orient automatically index the documents of the specific class with the specific properties and automatically use the index in the queries, the way to declare this indexes is through the <a href="java/ref/OClass.html"><code>OClass</code></a> and <a href="java/ref/OProperty.html"><code>OProperty</code></a> API.</p>
<p>Index on a single property, For instance,</p>
<pre><code>OClass animalClass = database.getClass("Animal");
OProperty nameProp = animalClass.getProperty("name");
nameProp.createIndex(OClass.INDEX_TYPE.NOTUNIQUE);
</code></pre>
<p>This example will use as index name <code>&lt;class-name&gt;.&lt;property-name&gt;</code></p>
<p>Index on multiple properies, For Instance,</p>
<pre><code>OClass animalClass = database.getClass("Animal");
animalClass.createIndex("index_name", OClass.INDEX_TYPE.NOTUNIQUE, "name","location");
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="working-with-documents"><a class="header" href="#working-with-documents">Working with Documents</a></h1>
<p>When you have data ready in your database, you need a way to access it in order to manipulate it through your application.  There are three ways to do this:</p>
<ul>
<li><a href="java/Document-API-Documents.html#retrieving-documents">Retrieving Documents</a> through the Java API.</li>
<li><a href="java/Document-API-Documents.html#querying-documents">Querying Documents</a> through SQL.</li>
<li><a href="java/Document-API-Documents.html#traversing-documents">Traversing Documents</a> through the Java Traverse API.</li>
</ul>
<h2 id="retrieving-documents"><a class="header" href="#retrieving-documents">Retrieving Documents</a></h2>
<p>Using the Java API, you can retrieve documents into an object or access the database otherwise using the <code>ODocument</code> object.  If you're more comfortable working in Java than SQL, this solution may work best for you.</p>
<ul>
<li>
<p>Browse all documents in a cluster:</p>
<pre><code class="language-java">for (ODocument doc : database.browserCluster("CityCars")) {
   System.out.println(doc.field("model"));
}
</code></pre>
</li>
<li>
<p>Browe all records in a class:</p>
<pre><code class="language-java">for (ODocument animal : database.browseClass("Animal")) {
   System.out.println(animal.field("name"));
}
</code></pre>
</li>
<li>
<p>Count records in a class:</p>
<pre><code class="language-java">long cars = database.countClass("Cars");
</code></pre>
</li>
<li>
<p>Count records in a cluster:</p>
<pre><code class="language-java">long cityCars = database.countCLuster("CityCar");
</code></pre>
</li>
</ul>
<h2 id="querying-documents"><a class="header" href="#querying-documents">Querying Documents</a></h2>
<p>While OrientDB is a NoSQL database implementation, it does support a subset of SQL.  This allows it to process links to documents and graphs.  For example,</p>
<pre><code class="language-java">List&lt;ODocument&gt; result = db.query(
   new OSQLQuery&lt;ODocument&gt;(
      "SELECT FROM Animal WHERE id = 10
      AND NAME LIKE 'G%'"
   )
);
</code></pre>
<p>For more information on the OrientDB syntax, see <a href="java/../sql/README.html">SQL</a>.</p>
<blockquote>
<p><strong>NOTE</strong>: OrientDB is a Graph Database.  This means that it is very efficient at traversals.  You can use this feature to optimize your queries, such as with <a href="java/../sql/Pivoting-With-Query.html">pivoting</a>.</p>
</blockquote>
<h3 id="asynchronous-queries"><a class="header" href="#asynchronous-queries">Asynchronous Queries</a></h3>
<p>In addition to the standard SQL queries, OrientDB also has support for asynchronous queries.  Here, the result is not collected and returned in a synchronous manner, (as above), but rather it uses a callback every time it finds a record that satisfies the predicates.</p>
<pre><code class="language-java">database.command(
   new OSQLAsynchQuery&lt;ODocument&gt;(
      "SELECT FROM Animal WHERE name = 'Gipsy'",
      new OCommandResultListener() {
         resultCount = 0;
         @Override
         public boolean result(Object iRecord) {
            resultCount++;
            ODocument doc = (ODocument) iRecord;

            // ENTER YOUR CODE TO WORK WITH DOCUMENT

            return resultCount &gt; 20 ? false: true;
         }

         @Override
         public void end() {}
      }
   )
).execute();
</code></pre>
<p>When OrientDB executes an asynchronous query, it only needs to allocate memory for each of the individual callbacks as it encounters them.  You may find this a huge benefit in cases where you need to work with large result-sets.
Asynchronous Query are not designed for data manipulation, avoid executed update or transaction inside the listener code.</p>
<h4 id="non-blocking-queries"><a class="header" href="#non-blocking-queries">Non-Blocking Queries</a></h4>
<p>Both synchronous and asynchronous queries are blocking queries.  What this means is that the first instruction you issue after <code>db.query()</code> or <code>db.command().execute()</code> executes only after you invoke the last callback or receive the complete result-set.</p>
<p>Beginning in version 2.1, OrientDB introduces support for non-blocking queries.  These use a similar API to asynchronous queries.  That is, you have a callback that gets invoked for every record in the result-set.  However, the behavior is very different.  Execution on the current thread continues without blocking on <code>db.query()</code> or <code>db.command().execute()</code> while it invokes the callback on a different thread.  This means that you can close the database instance while still receiving callbacks from the query result.</p>
<pre><code class="language-java">Future future = database.command(
   new OSQLNonBlockingQuery&lt;Object&gt;(
      "SELECT FROM Animal WHERE name = 'Gipsy'",
      new CommandResultListener(){
         resultCount = 0;
         @Override
         public boolean result(Object iRecord){
            // ENTER YOUR CODE HERE

            System.out.print("callback "+resultCount+" invoked");
            return resultCount &gt; 20 ? false: true;
         }

         @Override
         public void end(){}
      }
   )
).execute();

System.outprintln("query executed");

future.get();
</code></pre>
<p>When the code executes, the results look something like this:</p>
<pre><code>query executed
callback 0 invoked
callback 1 invoked
callback 2 invoked
callback 3 invoked
callback 4 invoked
</code></pre>
<p>You might also get results something like this:</p>
<pre><code>query executed
callback 0 invoked
callback 1 invoked
query executed
callback 2 invoked
callback 3 invoked
callback 4 invoked
</code></pre>
<p>Whether this occurs depends on race conditions on the two parallel threads.  That is, a case where one fires the query execution and then continues with "query executed", while the other invokes the callbacks.</p>
<p>The <code>future.get()</code> method is a blocking call that returns only after the last callback invocation.  You can avoid this in cases where you don't need to know when the query terminates.</p>
<h3 id="prepared-queries"><a class="header" href="#prepared-queries">Prepared Queries</a></h3>
<p>Similar to the Prepared Statement of JDBC, OrientDB now supports prepared queries.  With prepared queries, the database pre-parses the query so that, in cases of multiple executions of the same query, they run faster than the class SQL queries.  Furthermore, the pre-parsing mitigates SQL Injection.</p>
<p>Prepared queries use two kinds of markers to substitute parameters on execution:</p>
<ul>
<li>
<p><strong><code>?</code></strong> Syntax is used in reference to position parameters. For instance,</p>
<pre><code class="language-java">OSQLSynchQuery&lt;ODocument&gt; query = new OSQLSynchQuery&lt;ODocument&gt;(
   "SELECT FROM Profile WHERE name = ? AND surname = ?"
);

List&lt;ODocument&gt; result = database.command(query).execute("Barack", "Obama");
</code></pre>
</li>
<li>
<p><strong><code>:&lt;parameter&gt;</code></strong> Syntax is used in reference to named parameters.  For instance,</p>
<pre><code class="language-java">OSQLSynchQuery&lt;ODocument&gt; query = new OSQLSynchQuery&lt;ODocument&gt;(
   "SELECT FROM Profile WHERE name = :name AND surname = :surname"
);

Map&lt;String,Object&gt; params = new HashMap&lt;String,Object&gt;();
params.put("name", "Barack");
params.put("surname", "Obama");

List&lt;ODocument&gt; result = database.command(query).execute(params);
</code></pre>
</li>
</ul>
<blockquote>
<p><strong>NOTE</strong>: With prepared queries, the parameter substitution feature only works with <a href="java/../sql/SQL-Query.html"><code>SELECT</code></a> statements.  It does not work with <a href="java/../sql/SQL-Query.html"><code>SELECT</code></a> statements nested with other query types, such as <a href="java/../sql/SQL-Create-Vertex.html"><code>CREATE VERTEX</code></a>.</p>
</blockquote>
<h3 id="sql-commands-3"><a class="header" href="#sql-commands-3">SQL Commands</a></h3>
<p>In addition to queries, you can also execute SQL commands through the Java API.  These require that you use the <code>.command()</code> method, passing it an <code>OCommandSQL</code> object.  For instance,</p>
<pre><code class="language-java">int recordsUpdated = db.comamnd(
   new OCommandSQL("UPDATE Animal SET sold = false"
).execute();
</code></pre>
<p>When the command modifies the schema, such as <a href="java/../sql/SQL-Create-Class.html"><code>CREATE CLASS</code></a> or <a href="java/../sql/SQL-Alter-Property.html"><code>ALTER PROPERTY</code></a>, remember that you also need to force a schema update on the database instance you're using.</p>
<pre><code class="language-java">db.getMetadata().getSchema().reload();
</code></pre>
<h2 id="traversing-documents"><a class="header" href="#traversing-documents">Traversing Documents</a></h2>
<p>When using SQL, the process of combining two or more tables is handled through joins.  Since OrientDB is a Graph Database, it can operate across documents by traversing links.  This is much more efficient than the SQL join.  For more information, see <a href="java/Java-Traverse.html">Java Traverse API</a>.</p>
<p>In the example below, the application operates on a database with information on movies.  It traverses each movie instance following links up to the fifth depth level:</p>
<pre><code class="language-java">for (OIdentifiable id : new OTraverse()
         .field("in").field("out")
         .target(database.browseClass("Movie").iterator())
         .predicate(new OCommandPredicate() {
   public boolean evaluate(ORecord&lt;?&gt; iRecord, OCommandContext iContext) {
      return ((Integer) iContext.getVariable("depth")) &lt;= 5;
            }
         })
     ){
   System.out.println(id);
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="live-query"><a class="header" href="#live-query">Live Query</a></h1>
<blockquote>
<p><strong>NOTE</strong>: This feature was introduced in version 2.1 of OrientDB.  It is not available in older releases.</p>
</blockquote>
<p>When you issue a standard query to the database, OrientDB returns a result-set for that moment when it received the query.  Changes that occur on the database after it returns the result-set are not available in the result-set.  Sometimes this behavior is not what you want.</p>
<p>Beginning in version 2.1, OrientDB introduces a new approach to queries, for cases when you need to push updates through to the application: the Live Query.  Instead of returning data, this query returns a token that subscribes to a result-set.  Whenever changes are made on those records, OrientDB pushes them to your application.</p>
<h2 id="using-live-queries-1"><a class="header" href="#using-live-queries-1">Using Live Queries</a></h2>
<p>Live Queries were introduced in version 2.1 of OrientDB and are not available on older versions.  Beginning in version 2.2, they are enabled by default.</p>
<p>To disable them, set the <code>query.live.support</code> property to <code>false</code>.</p>
<ul>
<li><a href="java/Live-Query-Intro.html"><strong>Understanding Live Queries</strong></a></li>
<li><a href="java/Live-Query-Comparison.html"><strong>Comparison of Queries Methods</strong></a></li>
</ul>
<h3 id="supported-interfaces"><a class="header" href="#supported-interfaces">Supported interfaces</a></h3>
<p>Currently, Live Queries are supported by the following interfaces:</p>
<ul>
<li><a href="java/Live-Query-Java.html"><strong>Java API</strong></a>, through the <code>OLiveResultListener</code> and <code>OLiveQuery</code> objects.</li>
<li><a href="java/../orientjs/OrientJS.html"><strong>OrientJS (Node.js)</strong></a>, through the <a href="java/../orientjs/OrientJS-Query-Live-Query.html"><code>liveQuery()</code></a> function.</li>
</ul>
<h3 id="when-to-use-live-queries"><a class="header" href="#when-to-use-live-queries">When to use Live Queries</a></h3>
<p>You may find Live Queries particularly useful in the following scenarios:</p>
<ul>
<li>
<p>Where you need continuous, (that is, real-time), updates to multiple clients accessing different data subsets.</p>
<p>In this use-case, polling is an expensive operation.  With thousands of clients executing continuous polling could crash any server.  At best it wastes significant resources, especially where updates only rarely occur.</p>
</li>
<li>
<p>Where you have multiple data sources that insert or update data.</p>
<p>When you have a single data source that populates the database, then you can intercept it and directly notify the clients of changes.  But, in most use-cases this doesn't happen.</p>
<p>More often you have multiple data sources, sometimes automatic (such as with applications), and sometimes manual (such as your database administrator performing maintenance), and you need these updates immediately sent through to the clients.</p>
</li>
<li>
<p>Where you have a push-based/reactive infrastructure.</p>
<p>When using message-driven infrastructure or with a reactive framework, traditional queries, which are synchronous and blocking, can create their own difficulties.</p>
<p>By providing push notifications for data changes, Live Queries allow you to work from same paradigm, developing applications in a more consistent way.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="understanding-live-queries"><a class="header" href="#understanding-live-queries">Understanding Live Queries</a></h1>
<p>Writing real-time, reactive applications can prove a difficult task when working from the traditional query paradigm.  Beginning in version 2.1, OrientDB introduces an alternative: the Live Query.</p>
<h2 id="traditional-query-approach"><a class="header" href="#traditional-query-approach">Traditional Query Approach</a></h2>
<p>Consider the typical use-case of a web application. Visitors open a page on their browser.  You need to page to update itself as new records are added to the database.  Moreover, these updates can originate from different data sources, such as multiple applications, manual database operations, and so on.</p>
<p>In the traditional approach, the client polls the database for updates.  This does work in that it allows you to update the page with new material, but it comes at a price:</p>
<ul>
<li>
<p>The client does not know when changes are made.  In order to get updates, it must constantly execute polling queries.  This can lead to wasted resources, especially in the case where the poll requires long-running or otherwise intensive queries.</p>
</li>
<li>
<p>When you need near real-time data, the client must poll the database very often.</p>
</li>
<li>
<p>Queries return results at fixed intervals to the client.  When changes are made between intervals, the client only receives them at the next polling query.</p>
</li>
</ul>
<p><em>Traditional Query Polling Approach</em>
<img src="java/../images/queryPolling.png" alt="" /></p>
<p>Given this information, in order to implement this approach effectively, you need to make one of the following compromises:</p>
<ul>
<li>Use long intervals between polling queries, reducing the resource demands at the expense of the result-set being less up to date.</li>
<li>Use short intervals between polling queries, ensuring near real-time updates at the expense of resource usage.</li>
</ul>
<h2 id="live-query-approach"><a class="header" href="#live-query-approach">Live Query Approach</a></h2>
<p>In the new Live Query approach, the process is a little different.  Instead of issuing polling queries the database, the client subscribes to a query result-set.  Whenever changes occur in the records in this result set, OrientDB pushes these changes to the client as they happen.</p>
<p><em>Live Query Approach</em>
<img src="java/../images/liveQuery.png" alt="" /></p>
<p>The most obvious advantages to this are that,</p>
<ul>
<li>You no longer need to poll the database and only use resources when the application requires them.</li>
<li>You receive notifications as soon as a change happens on the database, no matter the data source.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="comparison-of-tradition-and-live-queries"><a class="header" href="#comparison-of-tradition-and-live-queries">Comparison of Tradition and Live Queries</a></h1>
<p>When you execute a <a href="java/../sql/SQL-Query.html"><code>SELECT</code></a> statement, whether synchronous or asynchronous, you expect the system to return results that are currently present in the database and that match your selection criteria.  You also expect a finite result-set and that your query executes within a given time frame.</p>
<p>Live Queries operate in a slightly different way:</p>
<ul>
<li>They <strong>do not</strong> return data as it exists when the query executes.</li>
<li>They return <strong>changes</strong> that occur on the database from that moment on that match your selection criteria.</li>
<li>They continue until you terminate the query or an error occurs.</li>
<li>They are asynchronous and push-based, (that is, the server sends new results to your callback as soon as they become available).</li>
</ul>
<p>To make the differences more explicit, you can find a pair of simple examples below.</p>
<h2 id="standard-queries"><a class="header" href="#standard-queries">Standard Queries</a></h2>
<p>The client executes a <a href="java/../sql/SQL-Query.html"><code>SELECT</code></a> statement on the <code>Person</code> class, which returns the current list of persons in the database.</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM Person</code>

+-------+------------+---------+
| @rid  | name       | surname |
+-------+------------+---------+
| #12:0 | John       | Milton  |
| #12:1 | Hieronymus | Bosch   |
+-------+------------+---------+
</pre>
<p>From a different client, the user inserts a new entry into the database.</p>
<pre>
orientdb> <code class="lang-sql userinput">INSERT INTO Person SET surname = "Augustus"</code>
</pre>
<p>By issuing the <a href="java/../sql/SQL-Insert.html"><code>INSERT</code></a> statement, the second client adds a new entry to the <code>Person</code> class.  However, OrientDB has closed the initial selection query made by the first client.</p>
<p>The first client remains unaware of the insertion until it reissues the <a href="java/../sql/SQL-Query.html"><code>SELECT</code></a> statement.</p>
<h2 id="live-queries-3"><a class="header" href="#live-queries-3">Live Queries</a></h2>
<p>In this example, the client again queries the <code>Person</code> class, but this time uses a <a href="java/../sql/SQL-Live-Select.html"><code>LIVE SELECT</code></a> statement.</p>
<pre>
orientdb> <code class="lang-sql userinput">LIVE SELECT FROM Person</code>

token: 1234567 // Unique identifier of this live query, needed for unsubscribe.
</pre>
<p>The immediate result of this query is to issue a unique identifier of the query itself.  The statement returns no other data, even if the data is available on the database.</p>
<h3 id="insertion"><a class="header" href="#insertion">Insertion</a></h3>
<p>From the second client, issue the above <a href="java/../sql/SQL-Insert.html"><code>INSERT</code></a> statement.</p>
<pre>
orientdb> <code class="lang-sql userinput">INSERT INTO Person SET surname = "Augustus"</code>
</pre>
<p>When OrientDB executes this statement, the first client responds with the following content (schematic):</p>
<pre><code>content: {@rid: 12:2, surname: 'Augustus'}
operation: insert
</code></pre>
<h3 id="update-1"><a class="header" href="#update-1">Update</a></h3>
<p>From the second client, issue an <a href="java/../sql/SQL-Update.html"><code>UPDATE</code></a> statement.</p>
<pre>
orientdb> <code class="lang-sql userinput">UPDATE Person SET surname = "Caesar"
          WHERE surname = "Augustus"</code>
</pre>
<p>When OrientDB executes this statement, the first client responds with the following content (schematic):</p>
<pre><code>content: {@rid: #12:2, surname = "Caesar"}
operation: update
</code></pre>
<h3 id="unsubscribe"><a class="header" href="#unsubscribe">Unsubscribe</a></h3>
<p>At any time you can unsubscribe the first client from the Live Query by issuing the <a href="java/../sql/SQL-Live-Unsubscribe.html"><code>LIVE UNSUBSCRIBE</code></a> statement with the given token.</p>
<pre>
orientdb> <code class="lang-sql userinput">LIVE UNSUBSCRIBE 1234567</code>
</pre>
<p>From now on, the Live Query does not return any other results to the client.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="using-live-queries-in-java"><a class="header" href="#using-live-queries-in-java">Using Live Queries in Java</a></h1>
<p>In order to implement the Live Query feature in your Java applications, you need two elements:</p>
<ul>
<li><a href="java/Live-Query-Java.html#listener"><strong>Listener</strong></a> The class that asynchronously receives the result-set from the query.</li>
<li><a href="java/Live-Query-Java.html#statement"><strong>Statement</strong></a> The SELECT query statement that OrientDB executes to define the records to be monitored.</li>
</ul>
<h2 id="listener"><a class="header" href="#listener">Listener</a></h2>
<p>When developing a listener for your query, you must implement the <code>OLiveQueryResultListener</code> class.  It must have a callback method that receives the Live Query token and the record that was modified with the operation that occurred, (that is, <a href="java/../sql/SQL-Insert.html"><code>INSERT</code></a>, <a href="java/../sql/SQL-Update.html"><code>UPDATE</code></a>, or <a href="java/../sql/SQL-Delete.html"><code>DELETE</code></a>.</p>
<pre><code class="language-java">class MyLiveQueryListener implements OLiveQueryResultListener {

    @Override
    public void onCreate(ODatabaseDocument database, OResult data) {
       // your record create logic here
    }

    @Override
    public void onUpdate(ODatabaseDocument database, OResult before, OResult after) {
       // your record update logic here
    }

    @Override
    public void onDelete(ODatabaseDocument database, OResult data) {
       // your record delete logic here
    }

    @Override
    public void onError(ODatabaseDocument database, OException exception) {
       // your error logic here
    }

    @Override
    public void onEnd(ODatabaseDocument database) {
       // this is invoked when you unsubscribe
    }
  }
</code></pre>
<h2 id="live-query-execution"><a class="header" href="#live-query-execution">Live Query execution</a></h2>
<p>In order to actually execute a Live Query, you can use the <code>db.live(query, listener, parameters...)</code> method, passing it the SQL query statement.  For instance, assume you have an active <code>ODatabaseSession</code> instance tied to the <code>db</code> object and that you want a Live Query to update a webpage that shows current messages for a user with the Record ID #12:40.</p>
<pre><code class="language-java">// Instantiate Query Listener
OLiveQueryResultListener listener = new MyLiveQueryListener();

// Execute Live Query
OLiveQueryMonitor monitor = db.live("SELECT FROM Messages WHERE toAddress = #12:40"", listener);

// and eventually stop the live query, when you don't need it anymore
monitor.unSubscribe();
</code></pre>
<p>From now on, your application receives updates from OrientDB whenever changes are made to the result-set.  So, for instance, say that someone connected to another client where to execute an <a href="java/../sql/SQL-Insert.html"><code>INSERT</code></a> statement, like</p>
<pre><code class="language-java">// Send Message
db.command("INSERT INTO Messages SET toAddress = #12:40, "
      + "fromAddress = 12:80, "
      + "subject = 'Re: Recent Events'"
   );
</code></pre>
<p>When the client executes this command on OrientDB, OrientDB in turn invokes the <code>onCreate()</code> method on your listener class.</p>
<h3 id="unsubscribe-1"><a class="header" href="#unsubscribe-1">Unsubscribe</a></h3>
<p>Live Queries remain active indefinitely, until the server shuts down or you unsubscribe from the token.  As described above, the live query execution returns a monitor object, that can be used to unsubscribe from the live query.</p>
<pre><code class="language-java">monitor.unSubscribe();
</code></pre>
<p>From now on, your application no longer receives updates on this query.</p>
<h1 id="legacy-live-queries"><a class="header" href="#legacy-live-queries">Legacy Live Queries</a></h1>
<p>OrientDB v 3.0 still supports the legacy APIs, that were the default implementation in v 2.2.
We strongly suggest to avoid using these APIs, as they will be removed in next major versions.</p>
<h2 id="legacy-listener"><a class="header" href="#legacy-listener">Legacy Listener</a></h2>
<p>When developing a listener for your query, you must implement the <code>OLiveResultListener</code> class.  It must have a callback method that receives the Live Query token and the record that was modified with the operation that occurred, (that is, <a href="java/../sql/SQL-Insert.html"><code>INSERT</code></a>, <a href="java/../sql/SQL-Update.html"><code>UPDATE</code></a>, or <a href="java/../sql/SQL-Delete.html"><code>DELETE</code></a>.</p>
<pre><code class="language-java">class MyLiveQueryListener implements OLiveResultListener {

   public List&lt;ORecordOperation&gt; ops = new 
         ArrayList&lt;ORecordOperation&gt;();

   @Override
   public void onLiveResult(
         int LiveToken, 
         ORecordOperation iOp)
         throws OException {
   
      System.out.println(
         "New Result from server for live query "
         + iLiveToken);
      System.out.println("operation: " + iOp.type);
      System.out.println("content: " + iOp.record);
   }

   public void onError(int iLiveToken){
      System.out.println(
         "Live query terminated due to error"
      );
   }

   public void onUnsubscribe(int iLiveToken){
      System.out.println(
         "Live query terminated with unsubscribe."
      );
   }
}
</code></pre>
<h2 id="legacy-live-query-execution"><a class="header" href="#legacy-live-query-execution">Legacy Live Query execution</a></h2>
<p>In order to actually execute a Live Query, you can use the <code>db.query()</code> method, passing itan <code>OLiveQuery</code> object as an argument with a <a href="java/../sql/SQL-Live-Select.html"><code>LIVE QUERY</code></a> SQL statement.  For instance, assume you have an active <code>ODatabaseDocumentTx</code> instance tied to the <code>db</code> object and that you want a Live Query to update a webpage that shows current messages for a user with the Record ID #12:40.</p>
<pre><code class="language-java">// Instantiate Query Listener
MyLiveQueryListener listener = new MyLiveQueryListener();

// Execute Live Query
List&lt;ODocument&gt; result = db.query(
   new OLiveQuery&lt;ODocument&gt;(
      "LIVE SELECT FROM Messages WHERE toAddress = #12:40"
   )
);

// Retrieve Live Query Token
String token = result.get(0).field("token");
</code></pre>
<p>From now on, your application receives updates from OrientDB whenever changes are made to the result-set.  So, for instance, say that someone connected to another client where to execute an <a href="java/../sql/SQL-Insert.html"><code>INSERT</code></a> statement, like</p>
<pre><code class="language-java">// Send Message
db.command("INSERT INTO Messages SET toAddress = #12:40, "
      + "fromAddress = 12:80, "
      + "subject = 'Re: Recent Events'"
   );
</code></pre>
<p>When the client executes this command on OrientDB, OrientDB in turn invokes the <code>onLiveResult()</code> method on your listener class.  Given the way the code is written in Listener above, your applications prints the following information to standard output:</p>
<pre><code>New result from server for live query 1234567
operation: 3 &lt;- ORecordOperation.CREATED
content: {@RID: "15:20", toAddress: "#12:40", 
fromAddress: "#12:80", subject: "Re: Recent Events"}
</code></pre>
<h3 id="legacy-unsubscribe"><a class="header" href="#legacy-unsubscribe">Legacy Unsubscribe</a></h3>
<p>Live Queries remain active indefinitely, until the server shuts down or you unsubscribe from the token.  In the above section, you use the following line to store the Live Query token in the <code>token</code> variable</p>
<pre><code class="language-java">// Retrieve Live Query Token
String token = result.get(0).field("token");
</code></pre>
<p>You can use this variable with <a href="java/../sql/SQL-Live-Unsubscribe.html"><code>LIVE UNSUBSCRIBE</code></a> to unsubscribe from the Live Query.</p>
<pre><code class="language-java">db.command(
   new OCommandSQL("LIVE UNSUBSCRIBE " + token))
   .execute();
</code></pre>
<p>From now on, your application no longer receives updates on this query.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="object-api-1"><a class="header" href="#object-api-1">Object API</a></h1>
<blockquote>
<p>groupId: <strong>com.orientechnologies</strong>  artifactId: <strong>orientdb-object</strong></p>
</blockquote>
<p>The Object Database in OrientDB operates on top of the <a href="java/Document-Database.html">Document API</a>.  The Object API uses Java Reflection to register the classes and the <a href="http://www.jboss.org/javassist">Javassist</a> tool to manage the object-to-document conversion.</p>
<p>In modern Java virtual machines, Java Reflection works really fast and metadata discovery is only done on the first run.  Future implementations may also include byte-code enhancement techniques.</p>
<ul>
<li><a href="java/Object-DB-Interface.html"><strong>Object Interface</strong></a></li>
</ul>
<h2 id="understanding-the-object-api"><a class="header" href="#understanding-the-object-api">Understanding the Object API</a></h2>
<p>When using the Object API, you bind objects in your application to <code>ODocument</code> objects in OrientDB.  These proxied objects transparently replicate changes into the database.</p>
<p>It also allows for lazy loading of fields, ensuring that they won't be loaded from the document until the first access.  To do this, the object MUST implement <a href="http://en.wikipedia.org/wiki/Mutator_method">getters and setters</a>, given that the Object API binds the Javassist Proxy to them.  In case of object load that edits an update, only loaded fields are lost, non-loaded fields remain untouched.</p>
<p>The database instance has an API to generate new objects already proxied.  When a non-proxied instance is passed to it, it serialized the instance, wrapping it around a proxied instance.</p>
<pre><code class="language-java">// OPEN DATABASE
OrientDBObject orientDB = new OrientDBObject("remote:localhost");
ODatabaseObject db = orientDB.open("petshop","admin", "admin_passwd");

// REGISTER CLASS ONLY ONCE AFTER DB IS OPENED/CREATED
db.getEntityManager().registerEntityClass("org.petshop.domain");

// CREATE NEW PROXIED OBJECT AND FILL IT
Account account = db.newInstance(Account.class);
account.setName("Tully");
account.setSurname("Cicero");

City rome = db.newInstance(City.class, "Rome",
   db.newInstance(Country.class, "Italy"));
account.getAddress().add(
   new Address("Residence", rome, "Piazza Navona, 1");

// SAVE
db.save(account);

// CREATE NEW PROXIED OBJECT AND FILL IT
Account account = new Account();
account.setName("Alessandro");
account.setSurname("Manzoni");

City milan = new City("Milan",
   new Country("Italy"));
account.getAddress()
   .add(new Address("Residence", milan,
   "Piazza Manzoni, 1"));

// SAVE ACCOUNT: ORIENTDB SERIALIZES OBJECT &amp; GIVES PROXIED INSTANCE
account = db.save(account);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="object-interface"><a class="header" href="#object-interface">Object Interface</a></h1>
<p>In OrientDB the Object API operates on a <a href="java/Document-Database.html">Document Data</a>.  It functions as an Object Database, directly managing objects in your Java application.  In order to utilize this API, you need to initialize the object interface from within your Java application.</p>
<h2 id="initializing-object-interfaces"><a class="header" href="#initializing-object-interfaces">Initializing Object Interfaces</a></h2>
<p>The Object API interface is an instance of the Database Object type.  For instance,</p>
<p><strong>Opening Databases</strong></p>
<pre><code class="language-java">// OPEN DATABASE
OrientDBObject orientDB = new OrientDBObject("embedded:/data");
ODatabaseObject db = orientDB.open("petshop","admin","admin_passwd");
</code></pre>
<h3 id="closing-databases-2"><a class="header" href="#closing-databases-2">Closing Databases</a></h3>
<p>When you're finished with the object interface, you need to close the database to free up the resources it holds.  You can do this using the <code>close()</code> method.  For instance,</p>
<pre><code class="language-java">db.close();
</code></pre>
<h3 id="using-connection-pools"><a class="header" href="#using-connection-pools">Using Connection Pools</a></h3>
<p>Common use-case when developing applications for OrientDB, especially in the case of web apps, is to utilize a connection pool.  This allows you to reuse a given database connection, rather than creating a new one every time it's needed.</p>
<p>To open a database from the pool, use the <code>ODatabaseObjectPool</code> object:</p>
<pre><code class="language-java">// OPEN DATABASE
ODatabaseObjectPool pool = new ODatabaseObjectPool("remote:localhost/petshop",
            "admin", "admin",OrientDBConfig.defaultConfig());
ODatabaseObject db = pool.acquire();

// REGISTER THE CLASS ONLY ONCE AFTER DB IS OPEN/CREATED
db.getEntityManager().registerEntityClass("org.petshop.domain");

try {
   //...
} finally {
   db.close();
}

//...
pool.close();
</code></pre>
<p>In this case the <code>close()</code> method doesn't close the database.  Rather it releases it into the owner pool, so that it can be reused later.</p>
<h2 id="using-interfaces"><a class="header" href="#using-interfaces">Using Interfaces</a></h2>
<p>Once you have initialized the object interface, you can begin to use it in your application.  The Object API uses Java Reflection to register classes and the <a href="http://www.jboss.org/javassist">Javassist</a> tool to manage the object-to-document conversion.  With modern Java virtual machines, Java Reflection is very fast and only needs to perform meta-data discovery once.</p>
<pre><code class="language-java">// OPEN DATABASE
OrientDBObject orientDB = new OrientDBObject("remote:localhost");
ODatabaseObject db = orientDB.open("petshop","admin","admin_passwd");

// REGISTER CLASS ONLY ONCE AFTER DB IS OPENED/CREATED
db.getEntityManager().registerEntityClass("org.petshop.domain");

// CREATE NEW PROXIED OBJECT AND FILL IT
Account account = db.newInstance(Account.class);
account.setName("Tully");
account.setSurname("Cicero");

City rome = db.newInstance(City.class, "Rome",
   db.newInstance(Country.class, "Italy"));
account.getAddress().add(
   new Address("Residence", rome, "Piazza Navona, 1");

// SAVE
db.save(account);

// CREATE NEW PROXIED OBJECT AND FILL IT
Account account = new Account();
account.setName("Alessandro");
account.setSurname("Manzoni");

City milan = new City("Milan",
   new Country("Italy"));
account.getAddress()
   .add(new Address("Residence", milan,
   "Piazza Manzoni, 1"));

// SAVE ACCOUNT: ORIENTDB SERIALIZES OBJECT &amp; GIVES PROXIED INSTANCE
account = db.save(account);
</code></pre>
<h3 id="multi-threading"><a class="header" href="#multi-threading">Multi-threading</a></h3>
<p>When working with multi-threaded applications, bear in mind that the <code>ODatabaseObject</code> object interface that you use initialize your database instance is not thread safe.  For this reason, when working with multiple threads always initialize a separate <code>ODatabaseObject</code> instance for each thread.</p>
<h3 id="inheritance-3"><a class="header" href="#inheritance-3">Inheritance</a></h3>
<p>Beginning with version 0.9.19, OrientDB supports inheritance.  When using the Object API, document inheritance fully matches Java inheritance.  Additionally, when you register a new class, OrientDB generates the correct inheritance schema in the event that it doesn't exist already.</p>
<pre><code class="language-java">// SUPERCLASS
public class Account{
   private String name;
   // getters and setters
}

// SUBCLASS
public class Company extends Account {
   private int employees;
   // getters and setters
}
</code></pre>
<p>Whenever you save a <code>Company</code> object in this example, OrientDB saves the object as a unique document in the cluster specified for the <code>Company</code> class.  When you search all <code>Account</code> instances, you'll also match instances of <code>Company</code>.</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM Account</code>
</pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="working-with-pojo"><a class="header" href="#working-with-pojo">Working with POJO</a></h1>
<p>With the Object API, Plain Old Java Objects, or POJO's, are automatically bound to the database as documents.  For information on the particulars of object-to-record bindings, see <a href="java/Object-2-Record-Java-Binding.html">POJO Bindings</a>.</p>
<blockquote>
<p>Bear in mind that the behavior of POJO operations can vary depending on whether you've begun a transaction.  For more information, see <a href="java/../internals/Transactions.html">Transactions</a>.</p>
</blockquote>
<h2 id="working-with-records"><a class="header" href="#working-with-records">Working with Records</a></h2>
<p>The best practice in creating Java objects is to use the <code>newInstance()</code> method on the <code>ODatabaseObject</code> object.  For instance,</p>
<pre><code class="language-java">public class Person {
   private String name;
   private String surname;

   public Person() {}

   public Person(String name){
      this.name = name;
   }

   public Person(String name, String surname){
      this.name = name;
      this.surname = surname;
   }

   //getters and setters
}
OrientDBObject orientDB = new OrientDBObject("remote:localhost",OrientDBConfig.defaultConfig());

ODatabaseObject db = orientDB.open("petshop","admin", "admin_passwd");

db.getEntityManager().registerEntityClass(Person.class);

// CREATES NEW PERSON FROM EMPTY CONSTRUCTOR
Person person = db.newInstance(Person.class);
person.setName("Antoni");
person.setSurname("Gaudi");
db.save(person);

// CREATES A NEW PERSON FROM A PARAMETERIZED CONSTRUCTOR
Person person = db.newInstance(Person.class, "Antoni");
person.setSurname("Gaudi");
db.save(person);

// OR
Person person = db.newInstance(Person.class, "Antoni", "Gaudi");
db.save(person);
</code></pre>
<p>Note that any Java object can be saved by calling the <code>db.save()</code> method.  If it doesn't exist in the database, OrientDB serializes and saves it.  In this case, the user must assign the results of the <code>db.save()</code> method in the argument in order to get the proxied instance.  Otherwise, the database always treats the object as a new one.  For instance,</p>
<pre><code class="language-java">// REGISTER THE CLASS ONLY ONCE AFTER THE DB IS OPEN/CREATED
db.getENtityManager().registerEntityClass(Animal.class);

Animal animal = new Animal();
animal.setName("Gaudi");
animal.setLocation("Madrid");
animal = db.save(animal);
</code></pre>
<h3 id="browsing-and-counting-records"><a class="header" href="#browsing-and-counting-records">Browsing and Counting Records</a></h3>
<p>With the Object API, you can browse or count records in the database from your application, either all records in a cluster or in a particular class.  For instance,</p>
<ul>
<li>
<p><strong>Browsing Records by Class</strong>:</p>
<pre><code class="language-java">for (Object o: database.browseClass(Animal.class)){
   System.out.println(animal.getName());
}
</code></pre>
</li>
<li>
<p><strong>Counting Records by Class</strong>:</p>
<pre><code class="language-java">long cars = database.countClass("Car");
</code></pre>
</li>
<li>
<p><strong>Browsing Records by Cluster</strong>:</p>
<pre><code class="language-java">for (Object o: database.browseCluster("CityCars")){
   System.out.println(((Car) o).getModel());
}
</code></pre>
</li>
<li>
<p><strong>Counting Records by Cluster</strong>:</p>
<pre><code class="language-java">long cityCars = database.countCluster("CityCar");
</code></pre>
</li>
</ul>
<h3 id="updating-objects"><a class="header" href="#updating-objects">Updating Objects</a></h3>
<p>You can update any proxied object by using the Java language and then calling the <code>db.save()</code> method to synchronize the changes with OrientDB.  This behavior varies depending on the transaction, if any.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-java">animal.setLocation("Nairobi");
db.save(animal);
</code></pre>
<p>OrientDB only updates fields that have actually been changed.</p>
<p><strong>Example</strong></p>
<p>For example, in the pet shop application you might use something like this to raise the cost of animals by 5%:</p>
<pre><code class="language-java">for (Animal animal: database.browseClass(Animal.class)) {
   animal.setPrice(animal.getPrice() * 105 / 100);
   database.save(animal);
}
</code></pre>
<p>When you call the <code>db.save()</code> method with non-proxied objects, the database creates a new document, even if said object were already saved.</p>
<h3 id="deleting-objects"><a class="header" href="#deleting-objects">Deleting Objects</a></h3>
<p>To delete an object, call the <code>db.delete()</code> method on a proxied object.  If you call it on a non-proxied object the database doesn't do anything.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-java">db.delete(animal);
</code></pre>
<p><strong>Example</strong></p>
<pre><code class="language-java">for (Animal animal: database.browseClass(Animal.class)){
   database.delete(animal);
}
</code></pre>
<p>Here, the application loops through every instance of the class <code>Animal</code> and deletes the record.</p>
<h4 id="cascade-deletions"><a class="header" href="#cascade-deletions">Cascade Deletions</a></h4>
<p>The Object API uses JPA annotations to manage cascade deletions.  It can be done explicitly, (that is, <code>orphanRemoval = true</code>), or with <code>CascadeType</code>.  The first mode works only with <code>@OneToOne</code> and <code>@OneToMany</code> annotations.  <code>CascadeType</code> works with <code>@ManyToMany</code> annotation.</p>
<p>For instance,</p>
<pre><code class="language-java">public class JavaCascadeDeleteTestClass {
  ...

  @OneToOne(orphanRemoval = true)
  private JavaSimpleTestClass  simpleClass;

  @ManyToMany(cascade = { CascadeType.REMOVE })
  private Map&lt;String, Child&gt;   children    = new HashMap&lt;String, Child&gt;();

  @OneToMany(orphanRemoval = true)
  private List&lt;Child&gt;          list = new ArrayList&lt;Child&gt;();

  @OneToMany(orphanRemoval = true)
  private Set&lt;Child&gt; set = new HashSet&lt;Child&gt;();
  ...

  // GETTERS AND SETTERS
}
</code></pre>
<p>This means that you can make these deletions by calling,</p>
<ul>
<li>
<pre><code class="language-java">database.delete(testClass);
</code></pre>
</li>
<li>
<pre><code class="language-java">for (JavaCascadeDeleteTestClass testClass: 
      database.browseClass(JavaCascadeDeleteTestClass.class)) {
database.delete(testClass);
}
</code></pre>
</li>
</ul>
<p>Here, you also delete <code>JavaSimpleTextClass</code> instances contained in the <code>simpleClass</code> field and all other documents contained in <code>children</code>, <code>list</code>, and <code>test</code>.</p>
<h2 id="executing-queries-3"><a class="header" href="#executing-queries-3">Executing Queries</a></h2>
<p>While OrientDB is a NoSQL database, it also supports a subset of SQL with extensions, allowing it to work with objects and graphs.  For more information, see <a href="java/../sql/README.html">SQL</a>.  For instance,</p>
<pre><code class="language-java">List&lt;Animal&gt; result = db.query(
   new OSQLSynchQuery&lt;Animal&gt;(
      "SELECT FROM Animal WHERE id = 10 AND name LIKE 'G%'"));
</code></pre>
<blockquote>
<p>OrientDB is a Graph database.  This means that it is very efficient at traversing records.  You can use this feature to optimize your queries.  A common technique for this is <a href="java/../sql/Pivoting-With-Query.html">Pivoting</a>.</p>
</blockquote>
<p>To execute SQL commands, use the <code>command()</code> method with an <code>OCommandSQL</code> object.  For instance,</p>
<pre><code class="language-java">int recordsUpdated = db.command(
   new OCommandSQL("UPDATE Animal SET sold = false"))
   .execute();
</code></pre>
<h2 id="getting-odocument-from-a-pojo"><a class="header" href="#getting-odocument-from-a-pojo">Getting ODocument from a POJO</a></h2>
<p>The <code>ODatabaseObject</code> implementation has APIs to get a document from its referencing object:</p>
<pre><code class="language-java">ODocument doc = db.getRecordByUserObject( animal );
</code></pre>
<p>In case of non-proxied objects the document will be a new generated one with all object field serialized in it.</p>
<h2 id="getting-pojo-from-records"><a class="header" href="#getting-pojo-from-records">Getting POJO from Records</a></h2>
<p>The Object database can also create objects from records:</p>
<pre><code class="language-java">Object pojo = db.getUserObjectsByRecord(record);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="attaching-and-detaching"><a class="header" href="#attaching-and-detaching">Attaching and Detaching</a></h1>
<p>Beginning in version 1.1.0, Object API provides <code>attach()</code> and <code>detach()</code> methods to manually manage object-to-document data transfers.</p>
<h2 id="attach"><a class="header" href="#attach">Attach</a></h2>
<p>With the attach method all data contained in the object will be copied in the associated document, overwriting all existing informations.</p>
<pre><code class="language-java">Animal animal = database.newInstance(Animal.class);
animal.name = "Gaudi" ;
animal.location = "Madrid";
database.attach(animal);
database.save(animal);
</code></pre>
<p>in this way all changes done within the object without using setters will be copied to the document.</p>
<p>There's also an <code>attachAndSave()</code> methods that after attaching data saves the object.</p>
<pre><code class="language-java">Animal animal = database.newInstance(Animal.class);
animal.name = "Gaudi" ;
animal.location = "Madrid";
database.attachAndSave(animal);
</code></pre>
<p>This will do the same as the example before.</p>
<h2 id="detach"><a class="header" href="#detach">Detach</a></h2>
<p>With the detach method all data contained in the document will be copied in the associated object, overwriting all existing informations. The <code>detach()</code> method returns a proxied object, if there's a need to get a non proxied detached instance the <code>detach(Object,boolean)</code> can be used.</p>
<pre><code class="language-java">Animal animal = database.load(rid);
database.detach(animal);
</code></pre>
<p>this will copy all the loaded document information in the object, without needing to call all getters. This methods returns a proxied instance</p>
<pre><code class="language-java">Animal animal = database.load(rid);
animal = database.detach(animal,true);
</code></pre>
<p>this example does the same as before but in this case the detach will return a non proxied instance.</p>
<p>Since version 1.2 there's also the <code>detachAll(Object, boolean)</code> method that detaches recursively the entire object tree. This may throw a <code>StackOverflowError</code> with big trees. To avoid it increase the stack size with <code>-Xss</code> Java option. The boolean parameter works the same as with the <code>detach()</code> method.</p>
<pre><code class="language-java">Animal animal = database.load(rid);
animal = database.detachAll(animal,true);
</code></pre>
<h3 id="lazy-detachment"><a class="header" href="#lazy-detachment">Lazy Detachment</a></h3>
<p>When calling <code>detachAll(object, true)</code> on a large object tree, the call may become slow, especially when working with remote connections.  This occurs because it recurses through every link in the tree and loads all dependencies.</p>
<p>Beginning in version 2.2, you can set the Object API to only load parts of the object tree, by adding <code>@OneToOne(fetch=FetchType.LAZY)</code> annotation.  For instance,</p>
<pre><code class="language-java">public class LazyParent {

    @Id
    private String id;

    @OneToOne(fetch = FetchType.LAZY)
    private LazyChild child;
...
public class LazyChild {

    @Id
    private ORID id;

    private String name;

    public ORID getId() {
        return id;
    }

    public void setId(ORID id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }
}
</code></pre>
<p>In the above example, when calling <code>detachAll(lazyParent,true)</code>, the child variable (if a link is available) will contain a normal <code>LazyChild</code> object, but only with the <code>id</code> loaded. So the name property will be null, as will any other property that is added to the class. The <code>id</code> object can be used to load the <code>LazyChild</code> object in a later stage.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="schema-4"><a class="header" href="#schema-4">Schema</a></h1>
<p>You can use the Object API in schema-less or in schema-full mode, provided the requirements given in <a href="java/Object-DB-POJO.html">POJO</a> are followed. Schema-less means that you can create the class without defining properties.</p>
<p>For instance,</p>
<pre><code class="language-java">OrientDBObject orientDB = new OrientDBObject("remote:localhost",OrientDBConfig.defaultConfig());
ODatabaseObject db = orientDB.open("petshop","admin", "admin_passwd");

db.getEntityManager().registerEntityClass(Person.class);

Person p = db.newInstance(Person.class);
p.setName("Luca");
p.setSurname("Garulli");
p.setCity(new City("Rome", "Italy"));

db.save(p);
db.close();
</code></pre>
<p>Note in the above example that the class Person is not declared before it gets used. Despite this, OrientDB is able to recognize the new object and save it in a persistent way.</p>
<p>In schema-full mode, you need to declare the classes you're using. Each class contains one or more properties. The mode is similar to the classic Relational database approach, where you need to create tables before storing records.</p>
<blockquote>
<p>For more information on schemas in the Java API, see <a href="java/../general/Schema.html">Schemas</a>.</p>
</blockquote>
<h2 id="schema-generation"><a class="header" href="#schema-generation">Schema Generation</a></h2>
<p>Beginning in version 1.5, the Object Database provides support for automatic <a href="java/../general/Schema.html">schema</a> generation based on registered entities.  This operation can be</p>
<ul>
<li><a href="java/Object-DB-Schema.html#manual-schema-generation">Manual</a></li>
<li><a href="java/Object-DB-Schema.html#automatic-schema-generation">Automatic</a></li>
</ul>
<p>The Object API generates class properties based on field declarations where necessary.</p>
<blockquote>
<p><strong>NOTE</strong>: When modifying class fields, such as changing or renaming types, the Object API doesn't update types.  You must manually perform this operation.</p>
</blockquote>
<h3 id="manual-schema-generation"><a class="header" href="#manual-schema-generation">Manual Schema Generation</a></h3>
<p>Schema can be generated manually for single classes or entire packages.  The syntax varies depending on which version you're using:</p>
<ul>
<li>
<p>Versions 1.6 and newer:</p>
<pre><code class="language-java">// GENERATE SCHEMA FOR Foo CLASS
db.getMetadata().getSchema().generateSchema(Foo.class);

// GENERATE SCHEMA FROM ALL CLASSES IN PACKAGE
db.getMetadata().getSchema().generateSchema("com.mycompany.myapp.mydomainpackage");
</code></pre>
</li>
<li>
<p>Version 1.5</p>
<pre><code class="language-java">// GENERATE SCHEMA FOR Foo CLASS
db.generateSchema(Foo.class);

// GENERATE SCHEMA FROM ALL CLASSES IN PACKAGE
db.generateSchema("com.mycompany.myapp.mydomainpackage");
</code></pre>
</li>
</ul>
<h3 id="automatic-schema-generation"><a class="header" href="#automatic-schema-generation">Automatic Schema Generation</a></h3>
<p>By setting the <code>automaticSchemaGeneration</code> property to true the schema will be generated automatically on every class <a href="java/Object-2-Record-Java-Binding.html#declare-persistent-classes">declaration</a>.</p>
<pre><code class="language-java">db.setAutomaticSchemaGeneration(true);
db.getEntityManager().registerClass(Foo.class); // Generates the schema for Foo class after registering.
db.getEntityManager().registerEntityClasses("com.mycompany.myapp.mydomainpackage"); // Generates the schema for all classes contained in the given package after registering.
</code></pre>
<p>Here, the class <code>Foo</code> might look like this, generating one field of the Integer type and ignoring the String field.</p>
<pre><code class="language-java">public class Foo {
   // INITIALIZE STRING FIELD (IGNORED BY ORIENTDB)
   private transient String field1;

   // INITIALIZE INTEGER FIELD (CREATED BY ORIENTDB)
   private Integer field2; 
}
</code></pre>
<h3 id="standard-schema-management-equivalent"><a class="header" href="#standard-schema-management-equivalent">Standard Schema Management Equivalent</a></h3>
<p>As an example, consider the class <code>Foo</code> defined as follows:</p>
<pre><code class="language-java">public class Foo{
   private String text;
   private Child reference;
   private int number;

   // getters and setters
}
</code></pre>
<p>The schema generation creates <code>text</code>, <code>reference</code> and <code>number</code> properties as, respectively, <code>STRING</code>, <code>LINK</code>, and <code>INTEGER</code> types.  The default schema management API equivalent would be:</p>
<pre><code class="language-java">OClass foo = db.getMetadata().getSchema().getClass(Foo.class);
OClass child = db.getMetadata().getSchema().getClass(Child.class)
foo.createProperty("text",OType.STRING);
foo.createProperty("number",OType.INTEGER);
foo.createProperty("text",OType.LINK, child);
db.getMetadata().getSchema().save();
</code></pre>
<h2 id="schema-synchronization"><a class="header" href="#schema-synchronization">Schema Synchronization</a></h2>
<p>For synchronize the schema for all registered entities you can use.</p>
<pre><code class="language-java">db.getMetadata().getSchema().synchronizeSchema();
</code></pre>
<p>By calling this API the Object database checks all registered entities and generates the schema, if one has not yet been generated. This management is useful on multi-database environments.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="object-binding"><a class="header" href="#object-binding">Object Binding</a></h1>
<p>The ObjectDatabase implementation makes things easier for the Java developer since the binding between Objects to Records is transparent.</p>
<h2 id="how-it-works"><a class="header" href="#how-it-works">How it works?</a></h2>
<p>OrientDB uses Java reflection and <a href="http://www.javassist.org/">Javassist</a> Proxy to bound POJOs to Records directly. Those proxied instances take care about the synchronization between the POJO and the underlying record. Every time you invoke a setter method against the POJO, the value is early bound into the record. Every time you call a getter method the value is retrieved from the record if the POJO's field value is null. Lazy loading works in this way too.</p>
<p>So the Object Database class works as wrapper of the underlying <a href="java/Document-Database.html">Document-Database</a>.</p>
<blockquote>
<p><strong>NOTE</strong>: In case a non-proxied object is found it will be serialized, proxied and bounded to a corresponding Record.</p>
</blockquote>
<h1 id="requirements-1"><a class="header" href="#requirements-1">Requirements</a></h1>
<h2 id="declare-persistent-classes"><a class="header" href="#declare-persistent-classes">Declare persistent classes</a></h2>
<p>Before to use persistent POJOs OrientDB needs to know which classes are persistent (between thousands in your classpath) by registering the persistent packages and/or classes. Example:</p>
<pre><code class="language-java">database.getEntityManager().registerEntityClasses("com.orientechnologies.orient.test.domain");
</code></pre>
<p>This must be done only right after the database is created or opened.</p>
<h2 id="naming-conventions"><a class="header" href="#naming-conventions">Naming conventions</a></h2>
<p>OrientDB follows some naming conventions to avoid writing tons of configuration files but just applying the rule "Convention over Configuration". Below those used:</p>
<ol>
<li>Java classes will be bound to persistent classes defined in the OrientDB schema with the same name. In OrientDB class names are case insensitive. The Java class name is taken without the full package. For example registering the class <code>Account</code> in the package <code>com.orientechnologies.demo</code>, the expected persistent class will be "Account" and not the entire <code>com.orientechnologies.demo.Account</code>. This means that class names, in the database, are always unique and can't exist two class with the same name even if declared in different packages.</li>
<li>Java class's attributes will be bound to the fields with the same name in the persistent classes. Field names are case sensitive.</li>
</ol>
<h2 id="empty-constructor"><a class="header" href="#empty-constructor">Empty constructor</a></h2>
<p>All the Java classes must have an empty constructor to let to OrientDB to create instances.</p>
<h2 id="getters-and-setters"><a class="header" href="#getters-and-setters">Getters and Setters</a></h2>
<p>All your classes must have <a href="http://en.wikipedia.org/wiki/Mutator_method#Java_example">getters and setters</a> of every field that needs to be persistent in order to let to OrientDB to manage proxy operations.
<a href="http://en.wikipedia.org/wiki/Mutator_method#Java_example">Getters and Setters</a> also need to be named same as the declaring field:
Example:</p>
<pre><code class="language-java">public class Test {

  private String textField;
  private int intField;

  public String getTextField() {
    return textField;
  }

  public void setTextField( String iTextField ) {
    textField = iTextField;
  }

  // THIS DECLARATION WON'T WORK, ORIENTDB WON'T BE ABLE TO RECOGNIZE THE REAL FIELD NAME
  public int getInt(){
    return intField;
  }

  // THIS DECLARATION WON'T WORK, ORIENTDB WON'T BE ABLE TO RECOGNIZE THE REAL FIELD NAME
  public void setInt(int iInt){
    intField = iInt;
  }
}
</code></pre>
<h2 id="collections-and-maps"><a class="header" href="#collections-and-maps">Collections and Maps</a></h2>
<p>To avoid ClassCastException when the Java classes have Collections and Maps, the interface must be used rather than the Java implementation. The classic mistake is to define in a persistent class the types ArrayList, HashSet, HashMap instead of List, Set and Map.</p>
<p>Example:</p>
<pre><code class="language-java">public class MyClass{
   // CORRECT
   protected List&lt;MyElement&gt; correctList;

   // WRONG: WILL THROW A ClassCastException
   protected ArrayList&lt;MyElement&gt; wrongList;

   // CORRECT
   protected Set&lt;MyElement&gt; correctSet;

   // WRONG: WILL THROW A ClassCastException
   protected TreeSet&lt;MyElement&gt; wrongSet;

   // CORRECT
   protected Map&lt;String,MyElement&gt; correctMap;

   // WRONG: WILL THROW A ClassCastException
   protected HashMap&lt;String,MyElement&gt; wrongMap;
}
</code></pre>
<h1 id="pojo-binding"><a class="header" href="#pojo-binding">POJO binding</a></h1>
<p>OrientDB manages all the POJO attributes in persistent way during read/write from/to the record, except for the fields those:</p>
<ul>
<li>have the <em>transient</em> modifier</li>
<li>have the <em>static</em> modifier,</li>
<li>haven't getters and setters</li>
<li>are set with anonymous class types.</li>
</ul>
<p>OrientDB uses the Java reflection to discovery the POJO classes. This is made only once during the registration of the domain classes.</p>
<h2 id="default-binding"><a class="header" href="#default-binding">Default binding</a></h2>
<p>This is the default. It tries to use the getter and setter methods for the field if they exist, otherwise goes in RAW mode (see below). The convention for the getter is the same as Java: <code>get&lt;field-name&gt;</code> where field-name is capitalized. The same is for setter but with 'set' as prefix instead of 'get': <code>set&lt;field-name&gt;</code>. If the getter or setter is missing, then the raw binding will be used.</p>
<p>Example:
Field '<code>String name</code>' -&gt; <code>getName()</code> and <code>setName(String)</code></p>
<h2 id="custom-binding"><a class="header" href="#custom-binding">Custom binding</a></h2>
<p>Since v1.2 Orient provides the possibility of custom binding extending the OObjectMethodFilter class and registering it to the wanted class.</p>
<ul>
<li>The custom implementation must provide the <code>public boolean isHandled(Method m)</code> to let Orient know what methods will be managed by the ProxyHandler and what methods won't.</li>
<li>The custom implementation must provide the <code>public String getFieldName(Method m)</code> to let orient know how to parse a field name starting from the accessing method name.
In the case those two methods are not provided the <a href="java/Object-2-Record-Java-Binding.html#default-binding">default binding</a> will be used</li>
</ul>
<p>The custom MethodFilter can be registered by calling <code>OObjectEntityEnhancer.getInstance().registerClassMethodFilter(Class&lt;?&gt;, customMethodFilter);</code></p>
<p>Domain class example:</p>
<pre><code class="language-java">public class CustomMethodFilterTestClass {

  protected String standardField;

  protected String UPPERCASEFIELD;

  protected String transientNotDefinedField;

  // GETTERS AND SETTERS
  ...

}
</code></pre>
<p>Method filter example:</p>
<pre><code class="language-java"> public class CustomMethodFilter extends OObjectMethodFilter {
    @Override
    public boolean isHandled(Method m) {
      if (m.getName().contains("UPPERCASE")) {
        return true;
      } else if (m.getName().contains("Transient")) {
        return false;
      }
      return super.isHandled(m);
    }

    @Override
    public String getFieldName(Method m) {
      if (m.getName().startsWith("get")) {
        if (m.getName().contains("UPPERCASE")) {
          return "UPPERCASEFIELD";
        }
        return getFieldName(m.getName(), "get");
      } else if (m.getName().startsWith("set")) {
        if (m.getName().contains("UPPERCASE")) {
          return "UPPERCASEFIELD";
        }
        return getFieldName(m.getName(), "set");
      } else
        return getFieldName(m.getName(), "is");
    }
  }
</code></pre>
<p>Method filter registration example:</p>
<pre><code class="language-java">OObjectEntityEnhancer.getInstance().registerClassMethodFilter(CustomMethodFilterTestClass.class, new CustomMethodFilter());
</code></pre>
<h1 id="read-a-pojo"><a class="header" href="#read-a-pojo">Read a POJO</a></h1>
<p>You can read a POJO from the database in two ways:</p>
<ul>
<li>by calling the method <code>load(ORID)</code></li>
<li>by executing a query <code>query(q)</code></li>
</ul>
<p>When OrientDB loads the record, it creates a new POJO by calling the empty constructor and filling all the fields available in the source record. If a field is present only in the record and not in the POJO class, then it will be ignored. Even when the POJO is updated, any fields in the record that are not available in the POJO class will be untouched.</p>
<h1 id="save-a-pojo"><a class="header" href="#save-a-pojo">Save a POJO</a></h1>
<p>You can save a POJO to the database by calling the method <code>save(pojo)</code>. If the POJO is already a proxied instance, then the database will just save the record bounded to it. In case the object is not proxied the database will serialize it and save the corresponded record: <strong>In this case the object MUST be reassinged with the one returned by the database</strong></p>
<h1 id="fetching-strategies"><a class="header" href="#fetching-strategies">Fetching strategies</a></h1>
<p>Starting from release 0.9.20, OrientDB supports <a href="java/Fetching-Strategies.html">Fetching-Strategies</a> by using the <strong>Fetch Plans</strong>. Fetch Plans are used to customize how OrientDB must load linked records. The ODatabaseObjectTx uses the Fetch Plan also to determine how to bind the linked records to the POJO by building an object tree.</p>
<h1 id="custom-types-1"><a class="header" href="#custom-types-1">Custom types</a></h1>
<p>To let OrientDB use not supported types use the custom types. They MUST BE registered before domain classes registration, if not all custom type fields will be treated as domain classes.
In case of registering a custom type that is already register as a domain class said class will be removed.</p>
<p><strong>Important: java.lang classes cannot be managed this way</strong></p>
<p>Example to manage an enumeration as custom type:</p>
<p><strong>Enum declaration</strong></p>
<pre><code class="language-java">public enum SecurityRole {
	ADMIN("administrador"), LOGIN("login");
	private String	id;

	private SecurityRole(String id) {
		this.id = id;
	}

	public String getId() {
		return id;
	}

	@Override
	public String toString() {
		return id;
	}

	public static SecurityRole getByName(String name) {
		if (ADMIN.name().equals(name)) {
			return ADMIN;
		} else if (LOGIN.name().equals(name)) {
			return LOGIN;
		}
		return null;
	}

	public static SecurityRole[] toArray() {
		return new SecurityRole[] { ADMIN, LOGIN };
	}
}
</code></pre>
<p><strong>Custom type management</strong></p>
<pre><code class="language-java">  OObjectSerializerContext serializerContext = new OObjectSerializerContext();
  serializerContext.bind(new OObjectSerializer&lt;SecurityRole, String&gt;() {

    public Object serializeFieldValue(Class&lt;?&gt; type, SecurityRole role) {
      return role.name();
    }

    public Object unserializeFieldValue(Class&lt;?&gt; type, String str) {
      return SecurityRole.getByName(str);
    }
  });

  OObjectSerializerHelper.bindSerializerContext(null, serializerContext);

// NOW YOU CAN REGISTER YOUR DOMAIN CLASSES
database.getEntityManager().registerEntityClass(User.class);
</code></pre>
<p>OrientDB will use that custom serializer to marshall and unmarshall special types.</p>
<h1 id="odatabaseobjecttx-old-deprecated-implementation"><a class="header" href="#odatabaseobjecttx-old-deprecated-implementation">ODatabaseObjectTx (old deprecated implementation)</a></h1>
<p><em>Available since v1.0rc9</em></p>
<p>The ObjectDatabase implementation makes things easier for the Java developer since the binding between Objects to Records is transparent.</p>
<h2 id="how-it-works-1"><a class="header" href="#how-it-works-1">How it works?</a></h2>
<p>OrientDB uses Java reflection and doesn't require that the POJO is enhanced in order to use it according to the <a href="http://java.sun.com/jdo">JDO standard</a> and doesn't use Proxies as do many <a href="http://java.sun.com/developer/technicalArticles/J2EE/jpa">JPA</a> implementations such as <a href="http://www.hibernate.org">Hibernate</a>. So how can you work with plain POJOs?</p>
<p>OrientDB works in two ways:</p>
<ul>
<li>Connected mode</li>
<li>Detached mode</li>
</ul>
<h3 id="connected-mode"><a class="header" href="#connected-mode">Connected mode</a></h3>
<p>The ODatabaseObjectTx implementation is the gateway between the developer and OrientDB. ODatabaseObjectTx keeps track of the relationship between the POJO and the Record.</p>
<p>Each POJO that's read from the database is created and tracked by ODatabaseObjectTx.  If you change the POJO and call the <code>ODatabaseObjectTx.save(pojo)</code> method, OrientDB recognizes the POJO bound with the underlying record and, before saving it, will copy the POJO attributes to the loaded record.</p>
<p>This works with POJOs that belong to the same instance. For example:</p>
<pre><code class="language-java">ODatabaseObjectTx db = new ODatabaseObjectTx("remote:localhost/demo");
db.open("admin", "admin");

try{
  List&lt;Customer&gt; result = db.query( new OSQLSynchQuery&lt;Customer&gt;(db, "select from customer") );
  for( Customer c : result ){
    c.setAge( 100 );
    db.save( c ); // &lt;- AT THIS POINT THE POJO WILL BE RECOGNIZED AS KNOWN BECAUSE IS
                 // ALWAYS LOADED WITH THIS DB INSTANCE
  }

} finally {
  db.close;
}
</code></pre>
<p>When the <code>db.save( c )</code> is called, the ODatabaseObjectTx instance already knows about it because has been retrieved by using a query through the same instance.</p>
<h3 id="detached-mode"><a class="header" href="#detached-mode">Detached mode</a></h3>
<p>In a typical Front-End application you need to load objects, display them to the user, capture the changes and save them back to the database. Usually this is implemented by using a database pool in order to avoid leaving a database instance open for the entire life cycle of the user session.</p>
<p>The database pool manages a configurable number of database instances. These instances are recycled for all database operations, so the list of connected POJOs is cleared at every release of the database pool instance. This is why the database instance doesn't know the POJO used by the application and in this mode if you save a previously loaded POJO it will appear as a NEW one and is therefore created as new instance in the database with a new <a href="java/../datamodeling/Concepts.html#record-id">RecordID</a>.</p>
<p>This is why OrientDB needs to store the record information inside the POJO itself. This is retrieved when the POJO is saved so it is known if the POJO already has own identity (has been previously loaded) or not (it's new).</p>
<p>To save the <a href="java/../datamodeling/Concepts.html#record-id">Record Identity</a> you can use the <a href="http://java.sun.com/developer/technicalArticles/J2EE/jpa">JPA</a> <strong><a href="http://download.oracle.com/javaee/5/api/javax/persistence/Id.html">@Id</a></strong> annotation above the property interested. You can declare it as:</p>
<ul>
<li><strong>Object</strong>, the suggested, in this case OrientDB will store the ORecordId instance</li>
<li><strong>String</strong>, in this case OrientDB will store the string representation of the ORecordId</li>
<li><strong>Long</strong>, in this case OrientDB will store the right part of the <a href="java/../datamodeling/Concepts.html#record-id">RecordID</a>. This works only if you've a schema for the class. The left side will be rebuilt at save time by getting the class id.</li>
</ul>
<p>Example:</p>
<pre><code class="language-java">public class Customer{
  @Id
  private Object id; // DON'T CREATE GETTER/SETTER FOR IT TO PREVENT THE CHANGING BY THE USER APPLICATION,
                  // UNLESS IT'S NEEDED

  private String name;
  private String surname;

  public String getName(){
    return name;
  }
  public void setName(String name){
    this.name = name;
  }

  public String getSurname(){
    return name;
  }
  public void setSurname(String surname){
    this.surname = surname;
  }
}
</code></pre>
<p>OrientDB will save the <a href="java/../datamodeling/Concepts.html#record-id">Record Identity</a> in the <strong>id</strong> property even if getter/setter methods are not created.</p>
<p>If you work with transactions you also need to store the Record Version in the POJO to allow MVCC. Use the <a href="http://java.sun.com/developer/technicalArticles/J2EE/jpa">JPA</a> <strong><a href="http://download.oracle.com/javaee/5/api/javax/persistence/Version.html">@Version</a></strong> annotation above the property interested. You can declare it as:</p>
<ul>
<li><strong>java.lang.Object</strong> (suggested) - a <strong>com.orientechnologies.orient.core.version.OSimpleVersion</strong> is used</li>
<li><strong>java.lang.Long</strong></li>
<li><strong>java.lang.String</strong></li>
</ul>
<p>Example:</p>
<pre><code class="language-java">public class Customer{
  @Id
  private Object id; // DON'T CREATE GETTER/SETTER FOR IT TO PREVENT THE CHANGING BY THE USER APPLICATION,
                  // UNLESS IT'S NEEDED

  @Version
  private Object version; // DON'T CREATE GETTER/SETTER FOR IT TO PREVENT THE CHANGING BY THE USER APPLICATION,
                       // UNLESS IT'S NEEDED

  private String name;
  private String surname;

  public String getName(){
    return name;
  }
  public void setName(String name){
    this.name = name;
  }

  public String getSurname(){
    return name;
  }
  public void setSurname(String surname){
    this.surname = surname;
  }
}
</code></pre>
<h3 id="save-mode"><a class="header" href="#save-mode">Save Mode</a></h3>
<p>Since OrientDB doesn't know what object is changed in a tree of connected objects, by default it saves all the objects. This could be very expensive for big trees. This is the reason why you can control manually what is changed or not via a setting in the ODatabaseObjectTx instance:</p>
<pre><code class="language-java">db.setSaveOnlyDirty(true);
</code></pre>
<p>or by setting a global parameter (see <a href="java/../admin/Configuration.html">Parameters</a>):</p>
<pre><code class="language-java">OGlobalConfiguration.OBJECT_SAVE_ONLY_DIRTY.setValue(true);
</code></pre>
<p>To track what object is dirty use:</p>
<pre><code class="language-java">db.setDirty(pojo);
</code></pre>
<p>To unset the dirty status of an object use:</p>
<pre><code class="language-java">db.unsetDirty(pojo);
</code></pre>
<p>Dirty mode doesn't affect in memory state of POJOs, so if you change an object without marking it as dirty, OrientDB doesn't know that the object is changed. Furthermore if you load the same changed object using the same database instance, the modified object is returned.</p>
<h2 id="requirements-2"><a class="header" href="#requirements-2">Requirements</a></h2>
<h2 id="declare-persistent-classes-1"><a class="header" href="#declare-persistent-classes-1">Declare persistent classes</a></h2>
<p>In order to know which classes are persistent (between thousands in your classpath), you need to tell OrientDB. Using the Java API is:</p>
<pre><code class="language-java">database.getEntityManager().registerEntityClasses("com.orientechnologies.orient.test.domain");
</code></pre>
<p>OrientDB saves only the final part of the class name without the package. For example if you're using the class <code>Account</code> in the package <code>com.orientechnologies.demo</code>, the persistent class will be only "Account" and not the entire <code>com.orientechnologies.demo.Account</code>. This means that class names, in the database, are always unique and can't exist two class with the same name even if declared in different packages.</p>
<h3 id="empty-constructor-1"><a class="header" href="#empty-constructor-1">Empty constructor</a></h3>
<p>All your classes must have an empty constructor to let to OrientDB to create instances.</p>
<h2 id="pojo-binding-1"><a class="header" href="#pojo-binding-1">POJO binding</a></h2>
<p>All the POJO attributes will be read/stored from/into the record except for fields with the <em>transient</em> modifier. OrientDB uses Java reflection but the discovery of POJO classes is made only the first time at startup. Java Reflection information is inspected only the first time to speed up the access to the fields/methods.</p>
<p>There are 2 kinds of binding:</p>
<ul>
<li>Default binding and</li>
<li>Raw binding</li>
</ul>
<h3 id="default-binding-1"><a class="header" href="#default-binding-1">Default binding</a></h3>
<p>This is the default. It tries to use the getter and setter methods for the field if they exist, otherwise goes in RAW mode (see below). The convention for the getter is the same as Java: <code>get&lt;field-name&gt;</code> where field-name is capitalized. The same is for setter but with 'set' as prefix instead of 'get': <code>set&lt;field-name&gt;</code>. If the getter or setter is missing, then the raw binding will be used.</p>
<p>Example:
Field '<code>String name</code>' -&gt; <code>getName()</code> and <code>setName(String)</code></p>
<h2 id="raw-binding"><a class="header" href="#raw-binding">Raw binding</a></h2>
<p>This mode acts at raw level by accessing the field directly. If the field signature is <strong>private</strong> or <strong>protected</strong>, then the accessibility will be forced. This works generally in all the scenarios except where a custom SecurityManager is defined that denies the change to the accessibility of the field.</p>
<p>To force this behaviour, use the <a href="http://java.sun.com/developer/technicalArticles/J2EE/jpa">JPA 2</a> <strong><a href="http://download.oracle.com/javaee/6/api/javax/persistence/AccessType.html">@AccessType</a></strong> annotation above the relevant property. For example:</p>
<pre><code class="language-java">public class Customer{
  @AccessType(FIELD)
  private String name;

  private String surname;

  public String getSurname(){
    return name;
  }
  public void setSurname(String surname){
    this.surname = surname;
  }
}
</code></pre>
<h2 id="read-a-pojo-1"><a class="header" href="#read-a-pojo-1">Read a POJO</a></h2>
<p>You can read a POJO from the database in two ways:</p>
<ul>
<li>by calling the method <code>load(ORID)</code></li>
<li>by executing a query <code>query(q)</code></li>
</ul>
<p>When OrientDB loads the record, it creates a new POJO by calling the empty constructor and filling all the fields available in the source record. If a field is present only in the record and not in the POJO class, then it will be ignored. Even when the POJO is updated, any fields in the record that are not available in the POJO class will be untouched.</p>
<h3 id="callbacks"><a class="header" href="#callbacks">Callbacks</a></h3>
<p>You can define some methods in the POJO class that are called as callbacks before the record is read:</p>
<ul>
<li><a href="https://github.com/orientechnologies/orientdb/blob/2.2.x/core/src/main/java/com/orientechnologies/orient/core/annotation/OBeforeDeserialization.java">@OBeforeDeserialization</a> called just BEFORE unmarshalling the object from the source record</li>
<li><a href="https://github.com/orientechnologies/orientdb/blob/2.2.x/core/src/main/java/com/orientechnologies/orient/core/annotation/OAfterDeserialization.java">@OAfterDeserialization</a> called just AFTER unmarshalling the object from the source record</li>
</ul>
<p>Example:</p>
<pre><code class="language-java">public class Account{
  private String name;
  transient private String status;

  @OAfterDeserialization
  public void init(){
    status = "Loaded";
  }
}
</code></pre>
<p>Callbacks are useful to initialize transient fields.</p>
<h2 id="save-a-pojo-1"><a class="header" href="#save-a-pojo-1">Save a POJO</a></h2>
<p>You can save a POJO to the database by calling the method <code>save(pojo)</code>. If the POJO is already known to the ODatabaseObjectTx instance, then it updates the underlying record by copying all the POJO attributes to the records (omitting those with <em>transient</em> modifier).</p>
<h3 id="callbacks-1"><a class="header" href="#callbacks-1">Callbacks</a></h3>
<p>You can define in the POJO class some methods called as callback before the record is written:</p>
<ul>
<li><a href="https://github.com/orientechnologies/orientdb/blob/2.2.x/core/src/main/java/com/orientechnologies/orient/core/annotation/OBeforeSerialization.java">@OBeforeSerialization</a> called just BEFORE marshalling the object to the record</li>
<li><a href="https://github.com/orientechnologies/orientdb/blob/2.2.x/core/src/main/java/com/orientechnologies/orient/core/annotation/OAfterSerialization.java">@OAfterSerialization</a> called just AFTER marshalling the object to the record</li>
</ul>
<p>Example:</p>
<pre><code class="language-java">public class Account{
  private String name;
  transient private Socket s;

  @OAfterSerialization
  public void free(){
    s.close();
  }
}
</code></pre>
<p>Callbacks are useful to free transient resources.</p>
<p>== Fetching strategies =v</p>
<p>Starting from release 0.9.20, OrientDB supports <a href="java/Fetching-Strategies.html">Fetching-Strategies</a> by using the <strong>Fetch Plans</strong>. Fetch Plans are used to customize how OrientDB must load linked records. The ODatabaseObjectTx uses the Fetch Plan also to determine how to bind the linked records to the POJO by building an object tree.</p>
<h2 id="custom-types-2"><a class="header" href="#custom-types-2">Custom types</a></h2>
<p>To let OrientDB use not supported types use the custom types. Register them before to register domain classes. Example to manage a BigInteger (that it's not natively supported):</p>
<pre><code class="language-java">OObjectSerializerContext serializerContext = new OObjectSerializerContext();
serializerContext.bind(new OObjectSerializer&lt;BigInteger, Integer&gt;() {

  public Integer serializeFieldValue(Class&lt;?&gt; itype,  BigInteger iFieldValue) {
    return iFieldValue.intValue();
  }

  public  BigInteger unserializeFieldValue(Class&lt;?&gt; itype,  Integer iFieldValue) {
    return new  BigInteger(iFieldValue);
  }

});
OObjectSerializerHelper.bindSerializerContext(null, serializerContext);

// NOW YOU CAN REGISTER YOUR DOMAIN CLASSES
database.getEntityManager().registerEntityClass(Customer.class);
</code></pre>
<p>OrientDB will use that custom serializer to marshall and unmarshall special types.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="traverse"><a class="header" href="#traverse">Traverse</a></h1>
<p>OrientDB is a Graph database.  This means that its focal point is on relationships, (that is, links), and on managing them. The standard SQL language is not sufficient to work with trees or graphs, as it lacks the concept of recursion.  For this reason, the OrientDB subset of SQL implements a dedicated command for tree traversal: <a href="java/../sql/SQL-Traverse.html"><code>TRAVERSE</code></a>.</p>
<p>Traversal operations cross relationships between records, (that is, documents, vertices, nodes, and so on).  This operation runs much faster than the Relational database solution of executing a <code>JOIN</code>.</p>
<p>The main concepts in traversal are:</p>
<ul>
<li>
<p><strong>Target</strong>: Defines where you want to begin traversing records, which can be a <a href="java/../datamodeling/Concepts.html#class">class</a>, <a href="java/../datamodeling/Concepts.html#cluster">cluster</a>, or a set of records defined by their <a href="java/../datamodeling/Concepts.html#record-id">Record ID's</a>.</p>
<p>You can also use any sub-query that returns an iterable <code>OIdentifiable</code> object, such as when nesting multiple <a href="java/../sql/SQL-Query.html"><code>SELECT</code></a> and <a href="java/../sql/SQL-Traverse.html"><code>TRAVERSE</code></a> queries together.</p>
</li>
<li>
<p><strong>Fields</strong>: Defines the fields you want to traverse.  If you want to traverse all fields in a document, use <code>*</code>, <code>any()</code> or <code>all()</code>.</p>
</li>
<li>
<p><strong>Limit</strong>: Defines the maximum number of records to retrieve.</p>
</li>
<li>
<p><strong>Predicate</strong> Defines an operation you want to execute against each traversed document.  If the predicate returns <code>true</code>, the document is returned, otherwise it is skipped.</p>
</li>
<li>
<p><strong>Strategy</strong>: Defines how you want to traverse the graph, which can be <a href="java/Java-Traverse.html#depth_first-strategy"><code>DEPTH_FIRST</code></a> or <a href="java/Java-Traverse.html#breadth_first-strategy"><code>BREADTH_FIRST</code></a>.</p>
</li>
</ul>
<h2 id="traversal-strategies"><a class="header" href="#traversal-strategies">Traversal Strategies</a></h2>
<p>When issuing a traversal query to OrientDB, you can define the particular strategy for the traversal path that it uses.  For instance, OrientDB can traverse down a particular branch to its maximum depth first, then backtrack, or it can traverse each child node then search the next level down.  Which to use depends on the specific needs of your application.</p>
<h3 id="depth_first-strategy"><a class="header" href="#depth_first-strategy"><code>DEPTH_FIRST</code> Strategy</a></h3>
<p>By default, OrientDB traverses to depth first.  That is, it explores as far as possible through each branch before backtracking to the next.</p>
<p>This process is implemented using recursion.  For more information, see <a href="http://en.wikipedia.org/wiki/Depth-first_search">Depth-First algorithm</a>.</p>
<p>The diagram below shows the ordered steps OrientDB executes while traversing a graph using <code>DEPTH_FIRST</code> strategy.</p>
<p><img src="http://upload.wikimedia.org/wikipedia/commons/thumb/1/1f/Depth-first-tree.svg/600px-Depth-first-tree.svg.png" alt="Depth-first-tree" /></p>
<h3 id="breadth_first-strategy"><a class="header" href="#breadth_first-strategy"><code>BREADTH_FIRST</code> Strategy</a></h3>
<p>With this strategy, OrientDB inspects all neighboring nodes, then for each of those neighboring nodes in turn it inspects their neighboring nodes, which were unvisited, and so on.</p>
<p>Compare <strong>BREADTH_FIRST</strong> with the equivalent, but more memory-efficient iterative deepening depth first search and contrast it with <a href="java/Java-Traverse.html#depth_first-strategy"><code>DEPTH_FIRST</code></a> search. For more information, see <a href="http://en.wikipedia.org/wiki/Breath-first_search">Breadth-First algorithm</a>.</p>
<p>The diagram below shows the ordered steps OrientDB executes while traversing a graph using <code>BREADTH_FIRST</code> strategy.</p>
<p><img src="http://upload.wikimedia.org/wikipedia/commons/thumb/3/33/Breadth-first-tree.svg/600px-Breadth-first-tree.svg.png" alt="Breadth-first-tree" /></p>
<h2 id="context-variables-2"><a class="header" href="#context-variables-2">Context Variables</a></h2>
<p>During traversal, OrientDB provides context variables, which you can use in traversal conditions:</p>
<div class="table-wrapper"><table><thead><tr><th>Variable</th><th>Description</th></tr></thead><tbody>
<tr><td><code>$depth</code></td><td>Provides an integer indicating nesting depth in the tree.  The first level is 0.</td></tr>
<tr><td><code>$path</code></td><td>Provides a string representation of the current position as a sum of the traversed nodes.</td></tr>
<tr><td><code>$stack</code></td><td>Provides a stack of the current traversed nodes.</td></tr>
<tr><td><code>$history</code></td><td>Provides the entire collection of visited nodes.</td></tr>
</tbody></table>
</div>
<h2 id="traversal-methods"><a class="header" href="#traversal-methods">Traversal Methods</a></h2>
<p>The following sections describe various traversal methods.</p>
<h3 id="sql-traverse"><a class="header" href="#sql-traverse">SQL Traverse</a></h3>
<p>The simplest method available in executing a traversal is to use the SQL <a href="java/../sql/SQL-Traverse.html"><code>TRAVERSE</code></a> command.</p>
<p>For example, say that you have a <code>Movie</code> class and you want to retrieve all connected <code>from</code> and <code>to</code> records up to the fifth level in depth.  You might use something like this,</p>
<pre><code class="language-java">for (OIdentifiable id : 
      new OSQLSynchQuery&lt;ODocument&gt;(
         "TRAVERSE in, out FROM Movie WHILE $depth &lt;= 5"
      )) {
   System.out.println(id);
}
</code></pre>
<p>For more information on traversal in SQL, see <a href="java/../sql/SQL-Traverse.html"><code>TRAVERSE</code></a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="multi-threading-with-orientdb"><a class="header" href="#multi-threading-with-orientdb">Multi-threading with OrientDB</a></h1>
<p>OrientDB supports multi-threaded access to the database.  The <code>OrientDB</code> is thread safe, the <code>ODatabase*</code> and <code>OrientGraph*</code> instances are <strong>not</strong> thread-safe.  You must only use one of this instance per thread and only use each instance in one thread at a time.</p>
<p>The <code>ODocument</code>, <code>OrientVertex</code> and <code>OrientEdge</code> classes are also not thread-safe.  So, sharing them across threads can lead to unexpected errors that may prove difficult to recognize.</p>
<blockquote>
<p>For more information, see <a href="java/../general/Concurrency.html">Concurrency</a>.</p>
</blockquote>
<p>|<img src="java/../images/warning.png" alt="" />|Implicit usage of multiple database instances from the same thread is no longer allowed.  Any attempt to manage multiple instances in the same thread must explicitly call the <code>db.activateOnCurrentThread()</code> method against the database instance <strong>before</strong> you use it.|</p>
<ul>
<li><a href="java/Java-Multi-Threading-Usage.html">Multi-threading with OrientDB</a></li>
<li><a href="java/Java-Multi-Threading-Concurrency.html">Multi Version Concurrency Control</a></li>
</ul>
<h2 id="basic-example-multi-threading"><a class="header" href="#basic-example-multi-threading">Basic Example Multi-threading</a></h2>
<p>Example of multithread usage:</p>
<pre><code class="language-java">OrientDB orientDB = new OrientDB("remote:localhost", OrientDBConfig.defaultConfig());

// Spawn two threads that do some job
new Thread(() -&gt;{
   ODatabaseDocument database = orientDB.open("database", "admin", "admin");
   //... Job One
   database.close();
).start();

new Thread(() -&gt;{
   ODatabaseDocument database = orientDB.open("database", "admin", "admin");
   //... Job two
   database.close();
}).start();


</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="working-with-multi-threading"><a class="header" href="#working-with-multi-threading">Working with Multi-threading</a></h1>
<p>When developing multi-threaded applications with OrientDB, the simplest way to operate on the same database through additional threads is to create a new database instance within the scope of the <code>run()</code> method.  Doing so causes OrientDB to set the new database automatically in <code>ThreadLocal</code> for further use.</p>
<p>For instance,</p>
<pre><code class="language-java">OrientGraphFactory factory = new OrientGraphFactory(
   "remote:localhost/petshop")
   .setupPool(10, 20);
new Thread(() -&gt; {
  OrientBaseGraph graph = factory.getTx();

  try {
    // OPERATION WITH THE GRAPH INSTANCE
    graph.addVertex("class:Account", "name", "Amiga Corporation"
    );
  } finally {
    graph.shutdown();
  }

}).start();
</code></pre>
<p>In the event that you are using a database instance that was created in another thread, ensure that you active the instance before using it.  The activation API's are,</p>
<ul>
<li><strong>Graph API</strong> <code>graph.makeActive()</code></li>
<li><strong>Document API</strong> <code>database.activateOnCurrentThread()</code></li>
</ul>
<h2 id="multiple-databases"><a class="header" href="#multiple-databases">Multiple Databases</a></h2>
<p>When using multiple database instances on the same thread, you must explicitly set the database or graph instance before using it.  For instance,</p>
<pre><code class="language-java">ODocument rec1 = database1.newInstance();
ODocument rec2 = database2.newInstance();

rec1.field("name", "Luca");
database1.activateOnCurrentThread();
database1.save(rec1);

rec2.field("name", "Luke");
database2.activeOnCurrentTHread();
database2.save(rec2);
</code></pre>
<p>In the above example, bear in mind that the <code>activeOnCurrentThread()</code> method is mandatory as of version 2.1 of OrientDB.  Also, that the <code>save()</code> method forces saving on the database, no matter where the record comes from.</p>
<h3 id="closing-databases-3"><a class="header" href="#closing-databases-3">Closing Databases</a></h3>
<p><code>ThreadLocal</code> isn't a stack.  In the event that you are working with two databases and close one, you lose the previous database that was in use.  For instance,</p>
<pre><code class="language-java">ODatabaseDocument db1 = orientDB.open("db1","admin","admin");
ODatabaseDocument db2 = orientDB.open("db2","admin","admin");

...

db2.close()
</code></pre>
<p>The database is not set in <code>ThreadLocal</code>.  In order to work with <code>db1</code> from this point on, you need to call the <code>activateOnCurrentThread()</code> method.</p>
<pre><code class="language-java">db1.activateOnCurrentThread();
db1.close();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="multi-version-concurrency-control"><a class="header" href="#multi-version-concurrency-control">Multi Version Concurrency Control</a></h1>
<p>In the event that your application has two threads that attempt to update the same record, the last one issued receives the following exception:</p>
<pre><code>OConcurrentModificationException: Cannot update records
#X:Y in storage 'Z' because the version is not the latest.
Probably you are updating an old record or it has been
modified by another user (db=vA your=vB)
</code></pre>
<p>Every time you update a record, the version number for that record gets incremented by one.  What this means is, when the instance that fails attempts to update the record, it finds that the version it is trying to update is behind what's current on the database.</p>
<p>Below are examples of how to properly manage version concurrency.</p>
<h2 id="database-retry-api"><a class="header" href="#database-retry-api">Database Retry API</a></h2>
<pre><code>   ORID id = ...///
   // As first parameter you set the number of wanted retry, at second parameter a lambda with your business logic 
   session.executeWithRetry(10, (currentSession) -&gt; {
      currentSession.begin();
      OElement loaded = currentSession.load(id);
      loaded.setProperty("two", "three");
      currentSession.save(loaded);
      currentSession.commit();
      return null;
    });
</code></pre>
<h2 id="database-api-custom-retry"><a class="header" href="#database-api-custom-retry">Database API Custom Retry</a></h2>
<pre><code class="language-java">for (int retry = 0; retry &lt; maxRetries; ++retry) {

   try {

      // APPLY CHANGES
      document.field("name", "Luca");
      database.save(document);

      break;

   } catch(ONeedRetryException e) {

      // RELOAD IT TO GET LAST VERSION
      document.reload();
   }
}
</code></pre>
<h2 id="tinkerpop-graph-api-custom-retry"><a class="header" href="#tinkerpop-graph-api-custom-retry">Tinkerpop Graph API Custom Retry</a></h2>
<pre><code class="language-java">for (int retry = 0; retry &lt; maxRetries; ++retry) {

   try {

      // APPLY CHANGES
      vertex.setProperty("name", "Luca");
      vertex.addEdge("Buy", product);

      break;

   } catch(ONeedRetryException e) {

      // RELOAD IT TO GET LAST VERSION
      vertex.reload();
      product.reload();
   }
}
</code></pre>
<h2 id="transactions-custom-retry"><a class="header" href="#transactions-custom-retry">Transactions Custom Retry</a></h2>
<p>There is a similar procedure used with transactions:</p>
<pre><code class="language-java">for (int retry = 0; retry &lt; maxRetries; ++retry) {

   database.begin();

   try {

      // CREATE A NEW ITEM
      ODocument invoiceItem = new ODocument("InvoiceItem");
      invoiceItem.field("price", 213231);
      database.save(invoiceItem;

      // ADD IT TO THE INVOICE
      Collection&lt;ODocument&gt; items = invoice.field(items);
      items.add(invoiceItem);
      database(invoice);

      database.commit();
      break;

  } catch(OTransactionException e) {
     
     // RELOAD IT TO GET LAST VERSION
     invoice.reload();
  }
}
</code></pre>
<p>Where <code>maxRetries</code> is the maximum number of attempts of reloading.</p>
<h3 id="running-transactions"><a class="header" href="#running-transactions">Running Transactions</a></h3>
<p>Transactions are bound to a database.  If you change the current database while a transaction is running, the deleted and saved objects remain attached to the original database transaction.  When it commits, the objected are committed.</p>
<p>For instance,</p>
<pre><code class="language-java">ODatabaseDocument db1 =orientDB.open("db1","admin","admin"); // SETS CURRENT DB TO db1
db1.begin();

ODocument doc1 = new ODocument("Customer");
doc1.field("name", "Luca");
database.save(doc1); // OPERATION BOUND TO db1 TRANSACTION

ODatabaseDocument db2 = orientDB.open("db2","admin","admin"); // SETS CURRENT DB TO db2

ODocument doc2 = new ODocument("Provider");
doc2.field("name", "Chuck");
db2.save(doc2); // OPERATION BOUND TO db2 BECAUSE IT'S CURRENT

db1.activateOnCurrentThread();
db1.commit(); // COMMITS TRANSACTION FOR doc1 ONLY
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="transaction-propagation"><a class="header" href="#transaction-propagation">Transaction Propagation</a></h1>
<p>During application development there are situations when a <a href="java/../internals/Transactions.html">transaction</a> started in one method should be propagated to other method.</p>
<p>Lets suppose we have 2 methods.</p>
<pre><code class="language-Java">public void method1() {
 database.begin();
 try {
  method2();
  database.commit();
 } catch(Exception e) {
   database.rollback();
 }
}

public void method2() {
  database.begin();
  try {
    database.commit();
  } catch(Exception e) {
    database.rollback();
  }
}
</code></pre>
<p>As you can see <a href="java/../internals/Transactions.html">transaction</a> is started in first method and then new one is started in second method.
So how these <a href="java/../internals/Transactions.html">transactions</a> should interact with each other.</p>
<p>What does it mean on practice?</p>
<p>Lets consider example above we may have two possible cases here:</p>
<p>First case:</p>
<ol>
<li>begin outer transaction.</li>
<li>begin nested transaction.</li>
<li>commit nested transaction.</li>
<li>commit outer transaction.</li>
</ol>
<p>When nested transaction is started all changes of outer transaction are visible in nested transaction and
then when nested transaction is committed changes are done in nested transaction are not committed they will be committed at the moment when outer transaction will be committed.</p>
<p>Second case:</p>
<ol>
<li>begin outer transaction.</li>
<li>begin nested transaction.</li>
<li>rollback nested transaction.</li>
<li>commit outer transaction.</li>
</ol>
<p>When nested transaction is rolled back, changes are done in nested transaction are not rolled back.
But when we commit outer transaction all changes will be rolled back and ORollbackException will be thrown.</p>
<p>So what instances of database should we use to get advantage of <a href="java/../internals/Transactions.html">transaction</a> propagation feature:</p>
<ol>
<li>The same instance of database should be used between methods.</li>
<li>Database pool can be used, in such case all methods which asks for db connection in same
thread will have the same the same database instance.</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-11-26 SAM -->
<h1 id="fetching-strategies-1"><a class="header" href="#fetching-strategies-1">Fetching Strategies</a></h1>
<h2 id="deprecated-since-v-30"><a class="header" href="#deprecated-since-v-30">(Deprecated since v 3.0)</a></h2>
<p><em>Fetchplans</em> are used in two different scopes:</p>
<ol>
<li>A Connection that uses the <a href="java/../internals/Network-Binary-Protocol.html">Binary Protocol</a> can <em>early load</em> records to the client. On traversing of connected records, the client doesn't have to execute further remote calls to the server, because the requested records are already in the client's cache.</li>
<li>A Connection that uses the <a href="java/../misc/OrientDB-REST.html">HTTP/JSON Protocol</a> can <em>expand the resulting JSON</em> to include connected records as embedded in the same JSON. This is useful with the HTTP protocol to fetch all the connected records in just one call.</li>
</ol>
<h2 id="format-for-fetch-plans"><a class="header" href="#format-for-fetch-plans">Format for Fetch Plans</a></h2>
<p>In both scopes, the fetchplan syntax is the same.  In terms of their use, Fetch Plans are strings that you can use at run-time on queries and record loads.  The syntax for these strings is:</p>
<pre>
[[<code class="replaceable">levels</code>]]<code class="replaceable">fieldPath</code>:<code class="replaceable">depthLevel</code>
</pre>
<ul>
<li><strong>Levels</strong> Is an optional value that indicates which levels to use with the Fetch Plans.  Levels start from <code>0</code>.  As of version 2.1, levels use the following syntax:
<ul>
<li><em>Level</em> The specific level on which to use the Fetch Plan.  For example, using the level <code>[0]</code> would apply only to the first level.</li>
<li><em>Range</em> The range of levels on which to use the Fetch Plan.  For example, <code>[0-2]</code> means to use it on the first through third levels.  You can also use the partial range syntax: <code>[-3]</code> which means from the first to fourth levels, while <code>[4-]</code> means from the fifth level to infinity.</li>
<li><em>Any</em> The wildcard variable indicates that you want to use the Fetch Plan on all levels.  For example, <code>[*]</code>.</li>
</ul>
</li>
<li><strong>Field Path</strong> Is the field name path, which OrientDB expects in dot notation.  The path begins from either the root record or the wildcard variable <code>*</code> to indicate any field.  You can also use the wildcard at the end of the path to specify all paths that start for a name.</li>
<li><strong>Depth Level</strong> Is the depth of the level requested.  The depth level variable uses the following syntax:
<ul>
<li><code>0</code> Indicates to load the current record.</li>
<li><code>1-N</code> Indicates to load the current record to the <em>n</em>th record.</li>
<li><code>-1</code> Indicates an unlimited level.</li>
<li><code>-2</code> Indicates an excluded level.</li>
</ul>
</li>
</ul>
<p>In the event that you want to express multiple rules for your Fetch Plans, separate them by spaces.</p>
<p>Consider the following Fetch Plans for use with the example above:</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Fetch Plan</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left"><code>*:-1</code></td><td style="text-align: left">Fetches recursively the entire tree.</td></tr>
<tr><td style="text-align: left"><code>*:-1 orders:0</code></td><td style="text-align: left">Fetches recursively all records, but uses the field <code>orders</code> in the root class.  Note that the field <code>orders</code> only loads its direct content, (that is, the records <code>8:12</code>, <code>8:19</code>, and <code>8:23</code>).  No other records inside of them load.</td></tr>
<tr><td style="text-align: left"><code>*:0 address.city.country:0</code></td><td style="text-align: left">Fetches only non-document fields in the root class and the field <code>address.city.country</code>, (that is, records <code>10:1</code>,<code>11:2</code> and <code>12:3</code>).</td></tr>
<tr><td style="text-align: left"><code>[*]in_*:-2 out_*:-2</code></td><td style="text-align: left">Fetches all properties, except for edges at any level.</td></tr>
</tbody></table>
</div>
<h2 id="early-loading-of-records"><a class="header" href="#early-loading-of-records">Early loading of records</a></h2>
<p>By default, OrientDB loads linked records in a lazy manner.  That is to say, it does not load linked fields until it traverses these fields.  In situations where you need the entire tree of a record, this can prove costly to performance.  For instance,</p>
<pre><code>Invoice
 3:100
   |
   | customer
   +---------&gt; Customer
   |            5:233
   | address            city            country
   +---------&gt; Address---------&gt; City ---------&gt; Country
   |            10:1             11:2             12:3
   |
   | orders
   +---------&gt;* [OrderItem OrderItem OrderItem]
                [  8:12      8:19      8:23   ]
</code></pre>
<p>Here, you have a class, <code>Invoice</code>, with linked fields <code>customer</code>, <code>city</code>, and <code>orders</code>.  If you were to run a <a href="java/../sql/SQL-Query.html"><code>SELECT</code></a> query on <code>Invoice</code>, it would not load the linked class, and it would require seven different loads to build the returned value.  In the event that you have a remote connection, that means seven network calls as well.</p>
<p>In order to avoid performance issues that may arise from this behavior, OrientDB supports fetching strategies, called Fetch Plans, that allow you to customize how it loads linked records.  The aim of a Fetch Plan is to pre-load connected records in a single call, rather than several.  The best use of Fetch Plans is on records loaded through remote connections and when using JSON serializers to produce JSON with nested records.</p>
<blockquote>
<p><strong>NOTE</strong> OrientDB handles circular dependencies to avoid any loops while it fetches linking records.</p>
</blockquote>
<h3 id="remote-connections"><a class="header" href="#remote-connections">Remote Connections</a></h3>
<p>Under the default configuration, when a client executes a query or loads a single record directly from a remote database, it continues to send network calls for each linked record involved in the query, (that is, through <code>OLazyRecordList</code>).  You can mitigate this with a Fetch Plan.</p>
<p>When the client executes a query, set a Fetch Plan with a level different from <code>0</code>.  This causes the server to traverse all the records of the return result-set, sending them in response to a single call.  OrientDB loads all connected records into the local client, meaning that the collections remain lazy, but when accessing content, the record is loaded from the local cache to mitigate the need for additional connections.</p>
<h2 id="examples-using-sql"><a class="header" href="#examples-using-sql">Examples using SQL</a></h2>
<h3 id="deprecated-since-v-30-1"><a class="header" href="#deprecated-since-v-30-1">(Deprecated since v 3.0)</a></h3>
<p>Acquire Profile and its first level friendships</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT OUT("out_Friend") as friends from Profile fetchplan friends:1</code>
</pre>
<p>This will provide a result set of Profile records with a field called <code>friends</code> that contains an array of vertices connected via an <code>out_Friend</code> edge.  Only the <code>friends</code> field is part of the fetchplan in this instance, any further fields will be treated as normal.</p>
<h2 id="examples-using-the-java-apis"><a class="header" href="#examples-using-the-java-apis">Examples using the Java APIs</a></h2>
<h3 id="execute-a-query-with-a-custom-fetch-plan"><a class="header" href="#execute-a-query-with-a-custom-fetch-plan">Execute a query with a custom fetch plan</a></h3>
<pre><code class="language-java">List&lt;ODocument&gt; resultset = database.query(new OSQLSynchQuery&lt;ODocument&gt;("select * from Profile").setFetchPlan("*:-1"));
</code></pre>
<h3 id="export-a-document-and-its-nested-documents-in-json"><a class="header" href="#export-a-document-and-its-nested-documents-in-json">Export a document and its nested documents in JSON</a></h3>
<p>Export an invoice and its customer:</p>
<pre><code class="language-java">invoice.toJSON("fetchPlan:customer:1");
</code></pre>
<p>Export an invoice, its customer, and orders:</p>
<pre><code class="language-java">invoice.toJSON("fetchPlan:customer:1 orders:2");
</code></pre>
<p>Export an invoice and all the connected records up to 3rd level of depth:</p>
<pre><code class="language-java">invoice.toJSON("fetchPlan:*:3");
</code></pre>
<p>From SQL:</p>
<pre><code class="language-sql">SELECT @this.toJSON('fetchPlan:out_Friend:4') FROM #10:20
</code></pre>
<p>Export path in outgoing direction by removing all the incoming edges by using wildcards (Since 2.0):</p>
<pre><code class="language-sql">SELECT @this.toJSON('fetchPlan:in_*:-2') FROM #10:20
</code></pre>
<blockquote>
<p><strong>NOTES:</strong>:</p>
<ul>
<li>To avoid looping, the record already traversed by fetching are exported only by their <a href="java/../datamodeling/Concepts.html#record-id">RIDs</a> (RecordID) form</li>
<li>"fetchPlan" setting is case sensitive</li>
</ul>
</blockquote>
<h3 id="browse-objects-using-a-custom-fetch-plan"><a class="header" href="#browse-objects-using-a-custom-fetch-plan">Browse objects using a custom fetch plan</a></h3>
<pre><code class="language-java">for (Account a : database.browseClass(Account.class).setFetchPlan("*:0 addresses:-1")) {
  System.out.println( a.getName() );
}
</code></pre>
<blockquote>
<p><strong>NOTE:</strong> Fetching Object will mean their presence inside your domain entities. So if you load an object using fetchplan <code>*:0</code> all LINK type references won't be loaded.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><!-- proofread 2015-12-10 SAM -->
<h1 id="graph-consistency"><a class="header" href="#graph-consistency">Graph Consistency</a></h1>
<p>Before OrientDB v2.1.7, the graph consistency could be assured only by using transactions. The problems with using transactions for simple operations like creation of edges are:</p>
<ul>
<li><strong>speed</strong>, the transaction has a cost in comparison with non-transactional operations</li>
<li>management of <strong>optimistic retry</strong> at application level. Furthermore, with 'remote' connections this means high latency</li>
<li><strong>low scalability on high concurrency</strong> (this will be resolved in OrientDB v3.0, where commits will not lock the database anymore)</li>
</ul>
<p>As of v2.1.7, OrientDB provides a new mode to manage graphs without using transactions. It uses the Java class <code>OrientGraphNoTx</code> or via SQL by changing the global setting <code>sql.graphConsistencyMode</code> to one of the following values:</p>
<ul>
<li><code>tx</code>, the default, uses transactions to maintain consistency. This was the only available setting before v2.1.7</li>
<li><code>notx_sync_repair</code>, avoids the use of transactions. Consistency, in case of a JVM crash, is guaranteed through a database repair operation, which runs at startup in synchronous mode. The database cannot be used until the repair is finished.</li>
<li><code>notx_async_repair</code>, also avoids the use of transactions. Consistency, in case of JVM crash, is guaranteed through a database repair operation, which runs at startup in asynchronous mode. The database can be used immediately, as the repair procedure will run in the background.</li>
</ul>
<p>Both the new modes <code>notx_sync_repair</code> and <code>notx_async_repair</code> will manage conflicts automatically,  with a configurable RETRY (default=50). In case changes to the graph occur concurrently, any conflicts are caught transparently by OrientDB and the operations are repeated. The operations that support the auto-retry are:</p>
<ul>
<li><code>CREATE EDGE</code></li>
<li><code>DELETE EDGE</code></li>
<li><code>DELETE VERTEX</code></li>
</ul>
<h2 id="usage-8"><a class="header" href="#usage-8">Usage</a></h2>
<p>To use consistency modes that don't use transactions, set the <code>sql.graphConsistencyMode</code> global setting to <code>notx_sync_repair</code> or <code>notx_async_repair</code> in OrientDB <code>bin/server.sh</code> script or in the <code>config/orientdb-server-config.xml</code> file under properties section. Example:</p>
<pre><code class="language-xml">...
&lt;properties&gt;
  ...
  &lt;entry name="sql.graphConsistencyMode" value="notx_sync_repair"/&gt;
  ...
&lt;/properties&gt;
</code></pre>
<p>The same could be set by code, before you open any Graph. Example:</p>
<pre><code class="language-java">OGlobalConfiguration.SQL_GRAPH_CONSISTENCY_MODE.setValue("notx_sync_repair");
</code></pre>
<p>To make this setting persistent, set the <code>txRequiredForSQLGraphOperations</code> property in the storage configuration, so during the following opening of the Graph, you don't need to set the global setting again:</p>
<pre><code class="language-java">g.getRawGraph().getStorage().getConfiguration().setProperty("txRequiredForSQLGraphOperations", "false");
</code></pre>
<h3 id="usage-via-java-api"><a class="header" href="#usage-via-java-api">Usage via Java API</a></h3>
<p>In order to use non-transactional graphs, after having configured the consistency mode (as above), you can now work with the <code>OrientGraphNoTx</code> class. Example:</p>
<pre><code class="language-java">OrientGraphNoTx g = new OrientGraphNoTx("plocal:/temp/mydb");
...
v1.addEdge( "Friend", v2 );
</code></pre>
<p>Concurrent threads that change the graph will retry the graph change in case of concurrent modification (MVCC). The default value for maximum retries is 50. To change this value, call the <code>setMaxRetries()</code> API:</p>
<pre><code class="language-java">OrientGraphNoTx g = new OrientGraphNoTx("plocal:/temp/mydb");
g.setMaxRetries(100);
</code></pre>
<p>This setting will be used on the active graph instance. You can have multiple threads, which work on the same graph by using multiple graph instances, one per thread. Each thread can then have different settings. It's also allowed to work with threads, which use transactions (<code>OrientGraph</code> class) and to work with concurrent threads, which don't use transactions.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="binary-data-1"><a class="header" href="#binary-data-1">Binary Data</a></h1>
<p>OrientDB natively handles binary data, namely BLOB.</p>
<h1 id="techniques"><a class="header" href="#techniques">Techniques</a></h1>
<h2 id="store-on-file-system-and-save-the-path-in-the-document"><a class="header" href="#store-on-file-system-and-save-the-path-in-the-document">Store on file system and save the path in the document</a></h2>
<p>This is the simpler way to handle binary data: store them to the file system and just keep the path to retrieve them.</p>
<p>Example:</p>
<pre><code class="language-java">ODocument doc = database.newInstance("MyClass");
doc.field("binary", "/usr/local/orientdb/binary/test.pdf");
database.save(doc);
</code></pre>
<p>Pros:</p>
<ul>
<li>Easy to write</li>
<li>100% delegated to the File System</li>
</ul>
<p>Cons:</p>
<ul>
<li>Binary data can't be automatically distributed using the OrientDB cluster</li>
</ul>
<h2 id="store-it-as-a-document-field"><a class="header" href="#store-it-as-a-document-field">Store it as a Document field</a></h2>
<p>ODocument class is able to manage binary data in form of <code>byte[]</code> (byte array). Example:</p>
<pre><code class="language-java">ODocument doc = database.newInstance("MyClass");
doc.field("binary", "Binary data".getBytes());
database.save(doc);
</code></pre>
<p>This is the easiest way to keep the binary data inside the database, but it's not really efficient on large BLOB because the binary content is serialized in Base64. This means a waste of space (33% more) and a run-time cost in marshalling/unmarshalling.</p>
<p>Also be aware that once the binary data reaches a certain size (10 MB in some recent testing), the database's performance can decrease significantly. If this occurs, the solution is to use the <code>ORecordBytes</code> solution described below.</p>
<p>Pros:</p>
<ul>
<li>Easy to write</li>
</ul>
<p>Cons:</p>
<ul>
<li>Waste of space +33%</li>
<li>Run-time cost of marshalling/unmarshalling</li>
<li>Significant performance decrease once the binary reaches a certain large size</li>
</ul>
<h2 id="store-it-with-orecordbytes"><a class="header" href="#store-it-with-orecordbytes">Store it with ORecordBytes</a></h2>
<p>The <code>ORecordBytes</code> class is a record implementation able to store binary content without conversions (see above). This is the faster way to handle binary data with OrientDB but needs a separate record to handle it. This technique also offers the highest performance when storing and retrieving large binary data records.</p>
<p>Example:</p>
<pre><code class="language-java">OBlob record = database.newBlob("Binary data".getBytes());
database.save(record);
</code></pre>
<p>Since this is a separate record, the best way to reference it is to link it to a Document record. Example:</p>
<pre><code class="language-java">OBlob record = database.newBlob("Binary data".getBytes());
ODocument doc = new ODocument();
doc.field("id", 12345);
doc.field("binary", record);
database.save(doc);
</code></pre>
<p>In this way you can access to the binary data by traversing the <code>binary</code> field of the parent's document record.</p>
<pre><code class="language-java">OBlob record = doc.field("binary");
byte[] content = record.toStream();
</code></pre>
<p><code>ORecordBytes</code> class can work with Java Streams:</p>
<pre><code class="language-java">OBlob record = database.newBlob();
record.fromInputStream(in);
record.toOutputStream(out);
</code></pre>
<p>Pros:</p>
<ul>
<li>Fast and compact solution</li>
</ul>
<p>Cons:</p>
<ul>
<li>Slightly complex management</li>
</ul>
<div class="table-wrapper"><table><thead><tr><th><img src="java/../images/warning.png" alt="NOTE" /></th><th style="text-align: left">While running in distributed mode ORecordBytes is not supported yet. See https://github.com/orientechnologies/orientdb/issues/3762 for more information.</th></tr></thead><tbody>
</tbody></table>
</div>
<h2 id="large-content-split-in-multiple-orecordbytes"><a class="header" href="#large-content-split-in-multiple-orecordbytes">Large content: split in multiple ORecordBytes</a></h2>
<p>OrientDB can store up to 2Gb as record content. But there are other limitations on network buffers and file sizes you should tune to reach the 2GB barrier.</p>
<p>However managing big chunks of binary data means having big <code>byte[]</code> structures in RAM and this could cause a Out Of Memory of the JVM. Many users reported that splitting the binary data in chunks is the best solution.</p>
<p>Continuing from the last example we could handle not a single reference against one <code>ORecordBytes</code> record but multiple references. A One-To-Many relationship. For this purpose the <code>LINKLIST</code> type fits perfectly because maintains the order.</p>
<p>To avoid OrientDB caches in memory large records use the massive insert intent and keep in the collection the <a href="java/../datamodeling/Concepts.html#record-id">RID</a>, not the entire records.</p>
<p>Example to store in OrientDB the file content:</p>
<pre><code class="language-java">database.declareIntent( new OIntentMassiveInsert() );

List&lt;ORID&gt; chunks = new ArrayList&lt;ORID&gt;();
InputStream in = new BufferedInputStream( new FileInputStream( file ) );
while ( in.available() &gt; 0 ) {
  final ORecordBytes chunk = new ORecordBytes();

  // READ REMAINING DATA, BUT NOT MORE THAN 8K
  chunk.fromInputStream( in, 8192 );

  // SAVE THE CHUNK TO GET THE REFERENCE (IDENTITY) AND FREE FROM THE MEMORY
  database.save( chunk );

  // SAVE ITS REFERENCE INTO THE COLLECTION
  chunks.add( chunk.getIdentity() );
}

// SAVE THE COLLECTION OF REFERENCES IN A NEW DOCUMENT
ODocument record = new ODocument();
record.field( "data", chunks );
database.save( record );

database.declareIntent( null );
</code></pre>
<p>Example to read back the file content:</p>
<pre><code class="language-java">record.setLazyLoad(false);
for (OIdentifiable id : (List&lt;OIdentifiable&gt;) record.field("data")) {
    ORecordBytes chunk = (ORecordBytes) id.getRecord();
    chunk.toOutputStream(out);
    chunk.unload();
}
</code></pre>
<p>Pros:</p>
<ul>
<li>Fastest and compact solution</li>
</ul>
<p>Cons:</p>
<ul>
<li>More complex management</li>
</ul>
<div class="table-wrapper"><table><thead><tr><th><img src="java/../images/warning.png" alt="NOTE" /></th><th style="text-align: left">While running in distributed mode ORecordBytes is not supported yet. See https://github.com/orientechnologies/orientdb/issues/3762 for more information.</th></tr></thead><tbody>
</tbody></table>
</div>
<h1 id="conclusion"><a class="header" href="#conclusion">Conclusion</a></h1>
<p>What to use?</p>
<ul>
<li>Have you short binary data? Store them as document's field</li>
<li>Do you want the maximum of performance and better use of the space? Store it with <code>ORecordBytes</code></li>
<li>Have you large binary objects? Store it with <code>ORecordBytes</code> but split the content in multiple records</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="jpa"><a class="header" href="#jpa">JPA</a></h1>
<p>There are two ways to configure OrientDB JPA</p>
<h2 id="configuration-7"><a class="header" href="#configuration-7">Configuration</a></h2>
<p>The first - do it through /META-INF/persistence.xml
Following OrientDB properties are supported as for now:</p>
<p><em>javax.persistence.jdbc.url, javax.persistence.jdbc.user, javax.persistence.jdbc.password, com.orientdb.entityClasses</em></p>
<p>You can also use <em>&lt;class&gt;</em> tag</p>
<p>Example:</p>
<pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;persistence version="2.0"
	xmlns="http://java.sun.com/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd"&gt;
	&lt;persistence-unit name="appJpaUnit"&gt;
		&lt;provider&gt;com.orientechnologies.orient.object.jpa.OJPAPersistenceProvider&lt;/provider&gt;

		&lt;!-- JPA entities must be registered here --&gt;
		&lt;class&gt;com.example.domain.MyPOJO&lt;/class&gt;

		&lt;properties&gt;
			&lt;property name="javax.persistence.jdbc.url" value="remote:localhost/test.odb" /&gt;
			&lt;property name="javax.persistence.jdbc.user" value="admin" /&gt;
			&lt;property name="javax.persistence.jdbc.password" value="admin" /&gt;
			&lt;!-- Register whole package.
                             See com.orientechnologies.orient.core.entity.OEntityManager.registerEntityClasses(String) for more details --&gt;
			&lt;property name="com.orientdb.entityClasses" value="com.example.domains" /&gt;
		&lt;/properties&gt;
	&lt;/persistence-unit&gt;
&lt;/persistence&gt;
</code></pre>
<h2 id="programmatic"><a class="header" href="#programmatic">Programmatic</a></h2>
<p>The second one is programmatic:</p>
<h3 id="guice-example"><a class="header" href="#guice-example">Guice example</a></h3>
<pre><code class="language-java">com.google.inject.persist.jpa.JpaPersistModule.properties(Properties)
</code></pre>
<pre><code class="language-java">/**
 * triggered as soon as a web application is deployed, and before any requests
 * begin to arrive
 */
@WebListener
public class GuiceServletConfig extends GuiceServletContextListener {
	@Override
	protected Injector getInjector() {
		return Guice.createInjector(
                        new JpaPersistModule("appJpaUnit").properties(orientDBProp),
                        new ConfigFactoryModule(),
                        servletModule);
	}

	protected static final Properties orientDBProp = new Properties(){{
		setProperty("javax.persistence.jdbc.url", "remote:localhost/test.odb");
		setProperty("javax.persistence.jdbc.user", "admin");
		setProperty("javax.persistence.jdbc.password", "admin");
		setProperty("com.orientdb.entityClasses", "com.example.domains");
	}};

	protected static final ServletModule servletModule = new ServletModule() {
		@Override
		protected void configureServlets() {
			filter("/*").through(PersistFilter.class);
			// ...
	};
}
</code></pre>
<h3 id="native-example"><a class="header" href="#native-example">Native example</a></h3>
<pre><code class="language-java">// OPEN THE DATABASE
OrientDBObject orientDB = new OrientDBObject("remote:localhost",OrientDBConfig.defaultConfig());
ODatabaseObject db = orientDB.open("admin", "admin");

// REGISTER THE CLASS ONLY ONCE AFTER THE DB IS OPEN/CREATED
db.getEntityManager().registerEntityClasses("foo.domain");
</code></pre>
<p>DB properties, that were passed programmatically, will overwrite parsed from XML ones</p>
<h2 id="note"><a class="header" href="#note">Note</a></h2>
<p>Config parser checks persistence.xml with validation schemes (XSD), so configuration file must be valid.</p>
<p><a href="https://github.com/orientechnologies/orientdb/blob/develop/object/src/main/resources/META-INF/persistence/persistence_1_0.xsd">1.0</a>, <a href="https://github.com/orientechnologies/orientdb/blob/develop/object/src/main/resources/META-INF/persistence/persistence_2_0.xsd">2.0</a> and <a href="https://github.com/orientechnologies/orientdb/blob/develop/object/src/main/resources/META-INF/persistence/persistence_2_1.xsd">2.1</a> XSD schemes are supported.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="jdbc-driver"><a class="header" href="#jdbc-driver">JDBC Driver</a></h1>
<blockquote>
<p>GroupId: <strong>com.orientechnologies</strong> ArtifactId: <strong>orientdb-jdbc</strong></p>
</blockquote>
<p>The JDBC driver for OrientDB allows connecting to an OrientDB database using the standard way of interacting with databases in the Java world.</p>
<h2 id="overview-1"><a class="header" href="#overview-1">Overview</a></h2>
<p>The driver is registered to the Java SQL DriverManager and can be used to work with all the OrientDB database types:</p>
<ul>
<li>memory</li>
<li>plocal</li>
<li>remote</li>
</ul>
<p>The driver's class is <code>com.orientechnologies.orient.jdbc.OrientJdbcDriver</code>.</p>
<h2 id="getting-a-connection"><a class="header" href="#getting-a-connection">Getting a Connection</a></h2>
<pre><code class="language-java">Properties info = new Properties();
info.put("user", "admin");
info.put("password", "admin");

Connection conn = (OrientJdbcConnection) DriverManager.getConnection("jdbc:orient:remote:localhost/test", info);
</code></pre>
<p>Then execute a Statement and get the ResultSet:</p>
<pre><code class="language-java">Statement stmt = conn.createStatement();

ResultSet rs = stmt.executeQuery("SELECT stringKey, intKey, text, length, date FROM Item");

rs.next();

rs.getInt("@version");
rs.getString("@class");
rs.getString("@rid");

rs.getString("stringKey");
rs.getInt("intKey");

rs.close();
stmt.close();
</code></pre>
<h2 id="writing-queries"><a class="header" href="#writing-queries">Writing Queries</a></h2>
<p>The OrientDB JDBC Driver maps types returned by OrientDB, gathering metadata at the database and resultset level. For better naming and type mapping, the suggested approach is to always define aliases when aggregation functions are used.</p>
<pre><code class="language-java">stmt.execute("SELECT DISTINCT(published) AS pub FROM Item ")
 
stmt.execute("SELECT SUM(score) AS totalScore FROM Item ")
 
</code></pre>
<p>Using aliases helps the driver in the name mapping phase, and it is a good practice anyway.</p>
<h2 id="advanced-features"><a class="header" href="#advanced-features">Advanced Features</a></h2>
<h3 id="connection-pool"><a class="header" href="#connection-pool">Connection Pool</a></h3>
<p>By default a new database instance is created every time you ask for a JDBC connection. The OrientDB JDBC driver provides a Connection Pool out of the box. Set the connection pool parameters before creating a connection:</p>
<pre><code class="language-java">Properties info = new Properties();
info.put("user", "admin");
info.put("password", "admin");

info.put("db.usePool", "true"); // USE THE POOL
info.put("db.pool.min", "3");   // MINIMUM POOL SIZE

Connection conn = (OrientJdbcConnection) DriverManager.getConnection("jdbc:orient:remote:localhost/test", info);
</code></pre>
<h3 id="spark-compatibility"><a class="header" href="#spark-compatibility">Spark Compatibility</a></h3>
<p><a href="http://spark.apache.org/">Apache Spark</a> allows reading and writing of DataFrames from JDBC data sources.
The driver can be used to load data from an OrientDB database.</p>
<p>The driver offers a compatibility mode to enable loading of a DataFrame from an OrientDB class or query.</p>
<pre><code class="language-java">Map&lt;String, String&gt; options = new HashMap&lt;String, String&gt;() {{
    put("url", "jdbc:orient:remote:localhost/sparkTest");
    put("user", "admin");
    put("password", "admin");
    put("spark", "true"); // ENABLE Spark compatibility
    put("dbtable", "Item");
}};

SQLContext sqlCtx = new SQLContext(ctx);

DataFrame jdbcDF = sqlCtx.read().format("jdbc").options(options).load();
</code></pre>
<h2 id="dependencies"><a class="header" href="#dependencies">Dependencies</a></h2>
<p>The OrientDB JDBC driver is dependent on the following jars (they can be found in the lib directory of an OrientDB installation):</p>
<ul>
<li>concurrentlinkedhashmap-lru-x.x.x.jar</li>
<li>jna-x.x.x.jar</li>
<li>orientdb-client-x.x.x.jar</li>
<li>orientdb-core-x.x.x.jar</li>
<li>orientdb-jdbc-x.x.x.jar</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="scala-api"><a class="header" href="#scala-api">Scala API</a></h1>
<p>There's no specific API written in Scala for OrientDB, but since there's a Java API it's easy to use that one to access OrientDB from Scala, and if needed to write wrappers around it for making a more Scala-like API.</p>
<p>Here we just explain how to start using Scala for doing some basic operations on OrientDB, based on this GitHub repository: <a href="https://github.com/andreaiacono/OrientDbScalaExample">OrientDbScalaExample</a> that uses the <a href="http://orientdb.com/docs/last/Graph-Database-Tinkerpop.html">Graph API</a>.
To fully leverage the features of the API, refer to the Java documentation.</p>
<h2 id="java-method-invocation-problems"><a class="header" href="#java-method-invocation-problems">Java method invocation problems</a></h2>
<p>Usually the main problems are related to the difference in calling conventions between Scala and Java. Attention must be paid when passing parameters to methods with varargs like <code>OrientGraph.addVertex(...)</code>, because if not converted to java's repeated args correctly it will cause a compilation problem.</p>
<p>More detailed info here:</p>
<p>http://stackoverflow.com/questions/3022865/calling-java-vararg-method-from-scala-with-primitives</p>
<p>http://stackoverflow.com/questions/1008783/using-varargs-from-scala</p>
<p>http://stackoverflow.com/questions/3856536/how-to-pass-a-string-scala-vararg-to-a-java-method-using-scala-2-8</p>
<h2 id="buildsbt"><a class="header" href="#buildsbt">build.sbt</a></h2>
<p>Let's start defining the build.sbt. All we need is a library dependency:</p>
<pre><code>libraryDependencies ++= Seq(
  "com.orientechnologies" % "orientdb-graphdb" % "2.2.0",
)
</code></pre>
<h2 id="creatingopening-a-database"><a class="header" href="#creatingopening-a-database">Creating/Opening a Database</a></h2>
<p>We can start creating/opening a database:</p>
<pre><code>    val uri: String = "plocal:target/database/scala_sample"
    val factory: OrientGraphFactory = new OrientGraphFactory(uri)
    val graph: OrientGraph = factory.getTx()
</code></pre>
<p>If the database at the specified uri is existing, it will be just opened; if it's not existing, it will be created and opened.</p>
<h2 id="creating-new-classes"><a class="header" href="#creating-new-classes">Creating new classes</a></h2>
<p>If we need to define new classes, we can use the <em>createVertexType()</em> method of the OrientGraph class:</p>
<pre><code>    val person: OrientVertexType = graph.createVertexType("Person")
    person.createProperty("firstName", OType.STRING)
    person.createProperty("lastName", OType.STRING)
</code></pre>
<p>we can define as many properties we need, each one belonging to a <a href="http://orientdb.com/docs/last/Types.html">Type</a> (the second parameter of the <em>createProperty()</em> method).</p>
<p>In the same way, we can extend edges, like in this example:</p>
<pre><code>    val work: OrientEdgeType = graph.createEdgeType("Work")
    work.createProperty("startDate", OType.DATE)
    work.createProperty("endDate", OType.DATE)
    work.createProperty("projects", OType.LINKSET)
</code></pre>
<h2 id="adding-vertices"><a class="header" href="#adding-vertices">Adding vertices</a></h2>
<p>If we need to add Vertices, we can use the <em>OrientGraph.addVertex()</em> method, like in this example:</p>
<pre><code>    val johnDoe: Vertex = graph.addVertex("class:Person", Nil: _*)
    johnDoe.setProperty("firstName", "John")
    johnDoe.setProperty("lastName", "Doe")
</code></pre>
<p>As seen before in the paragraph "Java method invocation problems", the second parameter of the <em>addVertex()</em> method (the <em>Nil:</em>*_) is needed to tell the Scala compiler which of the overloaded version of the method to use. If not supplied, the call will not compile.</p>
<p>Luckily, the properties of the vertex can be specified in the constructor itself:</p>
<pre><code>    val johnSmith: Vertex = graph.addVertex("class:Person", "firstName", "John", "lastName", "Smith")
</code></pre>
<h2 id="adding-edges-1"><a class="header" href="#adding-edges-1">Adding edges</a></h2>
<p>If we need to add edges, we can use the <em>OrientGraph.addEdge()</em> method:</p>
<pre><code>    val johnDoeAcme: Edge = graph.addEdge(null, johnDoe, acme, "Work")
    johnDoeAcme.setProperty("startDate", "2010-01-01")
    johnDoeAcme.setProperty("endDate", "2013-04-21")
    johnDoeAcme.setProperty("projects", Set(acmeGlue, acmeRocket))
</code></pre>
<p>The first parameter of the call <em>addEdge()</em> is the RID, which is automatically generated by OrientDB and hence not needed.
Unfortunately the edge has no overloaded constructor to pass all the properties in one call.
The last line inserts - as a property of the edge - a LinkSet, in this case a Set built with a couple of vertices (see full code below for the definition of those vertices).</p>
<p>Another way to add an edge is starting form a vertex, like in this case:</p>
<pre><code>    val johnSmithAcme: Edge = johnSmith.addEdge("Work", acme)
    johnSmithAcme.setProperty("startDate", "2009-01-01")
</code></pre>
<p>In this case we're connecting the <em>johnSmith</em> vertex to the <em>acme</em> company directly using the <em>addEdge()</em> method defined in the Vertex interface.</p>
<h2 id="querying-the-database-1"><a class="header" href="#querying-the-database-1">Querying the database</a></h2>
<p>We can access our data using the <em>OrientGraph.command()</em> method:</p>
<pre><code>    val results: OrientDynaElementIterable = graph
          .command(new OCommandSQL(s"SELECT expand(in('Work')) FROM Company WHERE name='ACME'"))
          .execute()
</code></pre>
<p>that will return an <em>Iterable</em> containing the results. In this case, the query finds out all the vertices of the <em>Person</em> class that have a <em>Work</em> relationship with the <em>acme</em> company (or - in other words - all the vertices that have edges labeled <em>Work</em> going out to vertices of class <em>Company</em> that have the property <em>name</em> set to <em>acme</em>); the <em>iterable</em> contains as many elements as the vertices matching the query.
In this code sample, we can see how to access the edges of a vertex while iterating on the results:</p>
<pre><code>    results.foreach(v =&gt; {

        // gets the person
        val person = v.asInstanceOf[OrientVertex]

        // gets the "Work" edge
        val workEdgeIterator = person.getEdges(Direction.OUT, "Work").iterator()
        val edge = workEdgeIterator.next()

        // and retrieves info to print
        val status = if (edge.getProperty("endDate") != null) "retired" else "active"
        val projects = if (edge.getProperty("projects") != null)
          edge.getProperty("projects").asInstanceOf[Set[Vertex]].map(v=&gt;v.getProperty[String]("name")).mkString(", ") else "Any"

        println(s"Name: ${person.getProperty("lastName")}, ${person.getProperty("firstName")} [${status}]. Worked on: ${projects}.")
    })
</code></pre>
<p>since the GraphAPI is Tinkerpop compliant, we have to cast every element of the <em>Iterable</em> to the implementation of Tinkerpop supplied by OrientDB (<em>OrientVertex</em>), and from this object access the edges.</p>
<h2 id="using-sql"><a class="header" href="#using-sql">Using SQL</a></h2>
<p>Using SQL commands is straightforward:</p>
<pre><code>    graph.command(new OCommandSQL("DELETE VERTEX V")).execute()
</code></pre>
<p>where graph is an instance of OrientGraph class.</p>
<h2 id="orientdbsamplescala"><a class="header" href="#orientdbsamplescala">OrientDbSample.scala</a></h2>
<p>This is the complete file:</p>
<pre><code class="language-scala">import com.orientechnologies.orient.core.metadata.schema.OType
import com.orientechnologies.orient.core.sql.OCommandSQL
import com.tinkerpop.blueprints.{Direction, Edge, Vertex}
import com.tinkerpop.blueprints.impls.orient._

import scala.collection.JavaConversions._

object OrientDbSample extends App {

    val WorkEdgeLabel = "Work"

    // opens the DB (if not existing, it will create it)
    val uri: String = "plocal:target/database/scala_sample"
    val graph: OrientGraph = new OrientGraph(uri)

    try {

        // if the database does not contain the classes we need (i.e. it was just created),
        // then adds them
        if (graph.getVertexType("Person") == null) {

            // we now extend the Vertex class for Person and Company
            val person: OrientVertexType = graph.createVertexType("Person")
            person.createProperty("firstName", OType.STRING)
            person.createProperty("lastName", OType.STRING)

            val company: OrientVertexType = graph.createVertexType("Company")
            company.createProperty("name", OType.STRING)
            company.createProperty("revenue", OType.LONG)

            val product: OrientVertexType = graph.createVertexType("Project")
            product.createProperty("name", OType.STRING)

            // we now extend the Edge class for a "Work" relationship
            // between Person and Company
            val work: OrientEdgeType = graph.createEdgeType(WorkEdgeLabel)
            work.createProperty("startDate", OType.DATE)
            work.createProperty("endDate", OType.DATE)
            work.createProperty("projects", OType.LINKSET)
        }
        else {

            // cleans up the DB since it was already created in a preceding run
            graph.command(new OCommandSQL("DELETE VERTEX V")).execute()
            graph.command(new OCommandSQL("DELETE EDGE E")).execute()
        }

        // adds some people
        // (we have to force a vararg call in addVertex() method to avoid ambiguous
        // reference compile error, which is pretty ugly)
        val johnDoe: Vertex = graph.addVertex("class:Person", Nil: _*)
        johnDoe.setProperty("firstName", "John")
        johnDoe.setProperty("lastName", "Doe")

        // we can also set properties directly in the constructor call
        val johnSmith: Vertex = graph.addVertex("class:Person", "firstName", "John", "lastName", "Smith")
        val janeDoe: Vertex = graph.addVertex("class:Person", "firstName", "Jane", "lastName", "Doe")

        // creates a Company
        val acme: Vertex = graph.addVertex("class:Company", "name", "ACME", "revenue", "10000000")

        // creates a couple of projects
        val acmeGlue = graph.addVertex("class:Project", "name", "ACME Glue")
        val acmeRocket = graph.addVertex("class:Project", "name", "ACME Rocket")

        // creates edge JohnDoe worked for ACME
        val johnDoeAcme: Edge = graph.addEdge(null, johnDoe, acme, WorkEdgeLabel)
        johnDoeAcme.setProperty("startDate", "2010-01-01")
        johnDoeAcme.setProperty("endDate", "2013-04-21")
        johnDoeAcme.setProperty("projects", Set(acmeGlue, acmeRocket))

        // another way to create an edge, starting from the source vertex
        val johnSmithAcme: Edge = johnSmith.addEdge(WorkEdgeLabel, acme)
        johnSmithAcme.setProperty("startDate", "2009-01-01")

        // prints all the people who works/worked for ACME
        val res: OrientDynaElementIterable = graph
          .command(new OCommandSQL(s"SELECT expand(in('${WorkEdgeLabel}')) FROM Company WHERE name='ACME'"))
          .execute()

        println("ACME people:")
        res.foreach(v =&gt; {

            // gets the person
            val person = v.asInstanceOf[OrientVertex]

            // gets the "Work" edge
            val workEdgeIterator = person.getEdges(Direction.OUT, WorkEdgeLabel).iterator()
            val edge = workEdgeIterator.next()

            // and retrieves info to print
            val status = if (edge.getProperty("endDate") != null) "retired" else "active"
            val projects = if (edge.getProperty("projects") != null)
              edge.getProperty("projects").asInstanceOf[Set[Vertex]].map(v=&gt;v.getProperty[String]("name")).mkString(", ") else "Any"

            println(s"Name: ${person.getProperty("lastName")}, ${person.getProperty("firstName")} [${status}]. Worked on: ${projects}.")
        })
    }
    finally {
        graph.shutdown()
    }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientjs---nodejs-driver"><a class="header" href="#orientjs---nodejs-driver">OrientJS - Node.js Driver</a></h1>
<blockquote>
<p>The support for the new version of the OrientDB protocol is currently in beta, with new APIs in order to support new OrientDB features. See <a href="orientjs/OrientJS.html">here</a> the OrientJS 3.0 documentation.</p>
</blockquote>
<p>OrientDB supports all JVM languages for server-side scripting.  Using the OrientJS module, you can develop database applications for OrientDB using the Node.js language.  It is fast, lightweight and uses the binary protocol, with features including:</p>
<ul>
<li>Intuitive API, based on the <a href="https://github.com/petkaantonov/bluebird">Bluebird</a> promise library.</li>
<li>Fast Binary Protocol Parser</li>
<li>Distributed Support</li>
<li>Multi-Database Access, through the same socket.</li>
<li>Connection Pooling</li>
<li>Migration Support</li>
</ul>
<p>This page provides basic information on setting up OrientJS on your system.  For more information on using OrientJS in developing applications, see</p>
<ul>
<li><a href="orientjs/OrientJS-Server.html">Server API</a></li>
<li><a href="orientjs/OrientJS-Database.html">Database API</a></li>
<li><a href="orientjs/OrientJS-Class.html">Class API</a></li>
<li><a href="orientjs/OrientJS-Index.html">Index API</a></li>
<li><a href="orientjs/OrientJS-Functions.html">Function API</a></li>
<li><a href="orientjs/OrientJS-Query.html">Queries</a></li>
<li><a href="orientjs/OrientJS-Transactions.html">Transactions</a></li>
<li><a href="orientjs/OrientJS-Events.html">Events</a></li>
</ul>
<h2 id="installation-7"><a class="header" href="#installation-7">Installation</a></h2>
<p>In order to use OrientJS, you need to install it on your system.  There are two methods available to you in doing this: you can install it from the Node.js repositories or you can download the latest source code and build it on your local system.</p>
<p>Both methods require the Node.js package manager, NPM, and can install OrientJS as either a local or global package.</p>
<h3 id="installing-from-the-nodejs-repositories"><a class="header" href="#installing-from-the-nodejs-repositories">Installing from the Node.js Repositories</a></h3>
<p>When you call NPM and provide it with the specific package name, it connects to the Node.js repositories and downloads the source package for OrientJS.  It then installs the package on your system, either at a global level or in the <code>node_modules</code> folder of the current working directory.</p>
<ul>
<li>
<p>To install OrientJS locally in <code>node_modules</code>, run the following command:</p>
<pre>
$ <code class="lang-sh userinput">npm install orientjs</code>
</pre>
</li>
<li>
<p>To install OrientJS globally, run the following command as root or an administrator:</p>
<pre>
# <code class="lang-sh userinput">npm install orientjs -g</code>
</pre>
</li>
</ul>
<p>Once NPM finishes the install, you can begin to develop database applications using OrientJS.</p>
<h3 id="building-from-the-source-code"><a class="header" href="#building-from-the-source-code">Building from the Source Code</a></h3>
<p>When building from source code, you need to download the driver directly from <a href="https://github.com/orientechnologies/orientjs">GitHub</a>, then run NPM against the branch you want to use or test.</p>
<ol>
<li>
<p>Using Git, clone the package repository, then enter the new directory:</p>
<pre>
$ <code class="lang-sh userinput">git clone https://github.com/orientechnologies/orientjs.git</code>
$ <code class="lang-sh userinput">cd orientjs</code>
</pre>
</li>
<li>
<p>When you clone the repository, Git automatically provides you with the current state of the <code>master</code> branch.  If you would like to work with another branch, like <code>develop</code> or test features on past releases, you need to check out the branch you want.  For instance,</p>
<pre>
$ <code class="lang-sh userinput">git checkout develop</code>
</pre>
</li>
<li>
<p>Once you've selected the branch you want to build, call NPM to handle the installation.</p>
<ul>
<li>
<p>To install OrientJS locally, run the following command:</p>
<pre>
$ <code class="lang-sh userinput">npm install</code>
</pre>
</li>
<li>
<p>To install OrientJS globally, instead run this command as root or an administrator:</p>
<pre>
# <code class="lang-sh userinput">npm install -g</code>
</pre>
</li>
</ul>
</li>
<li>
<p>Run the tests to make sure it works:</p>
<pre>
$ <code class="lang-sh userinput">npm test</code>
</pre>
</li>
</ol>
<p>By calling NPM without an argument, it builds the package in the current working directory, here your local copy of the OrientJS GitHub repository.</p>
<h2 id="support"><a class="header" href="#support">Support</a></h2>
<p>OrientJS aims to support version 2.0.0 and later.  It has been tested on both versions 2.0.x and 2.1 of OrientDB.  While it may work with earlier versions, it does not currently support them directly.</p>
<h3 id="bonsai-structure"><a class="header" href="#bonsai-structure">Bonsai Structure</a></h3>
<p>Currently, OrientJS does not support the tree-based <a href="orientjs/../internals/RidBag.html">Bonsai Structure</a> feature in OrientDB, as it relies on additional network requests.</p>
<p>What this means is that, by default, the result  of <code>JSON.stringify(record)</code> on a record with 119 edges would behave very differently from a record with more than 120 edges.  It can lead to unexpected results that may not appear at any point during development, but which will occur when your application runs in production</p>
<p>For more information, see <a href="https://github.com/orientechnologies/orientdb/issues/2315">Issue 2315</a>.  Until this issue is addressed it is <strong>strongly recommended</strong> that you set the <code>RID_EMBEDDED_TO_SBTREEBONSAI_THRESHOLD</code> to a very large figure, such as 2147483647.</p>
<h3 id="maximum-call-stack-size-exceeded"><a class="header" href="#maximum-call-stack-size-exceeded">Maximum Call Stack Size Exceeded</a></h3>
<p>There is a maximum call stack size issue currently being worked on.  This occurs in queries over large record-sets (as in, in the range of 150,000 records), results in a <code>RangeError</code> exception.</p>
<p>For more information, see <a href="https://github.com/orientechnologies/orientjs/issues/116">Issue 116</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientjs-server-api"><a class="header" href="#orientjs-server-api">OrientJS Server API</a></h1>
<p>With OrientJS installed on your system, you can now begin to develop applications around it.  In your code, this starts with initializing the client connection between your application and the OrientDB Server, which is managed through the OrientJS Server API.</p>
<blockquote>
<p>By convention, the variable on which you initialize the Server API is called <code>server</code>. This designation is arbitrary and used only for convenience.</p>
</blockquote>
<h2 id="initializing-the-server-api"><a class="header" href="#initializing-the-server-api">Initializing the Server API</a></h2>
<p>In order to use the OrientDB with your Node.js application, you first need to initialize the Server API.  This provides your application with the tools it needs in interacting with the OrientDB server to find and access the necessary database objects.</p>
<pre><code class="language-javascript">var OrientDB = require('orientjs');

var server = OrientDB({
   host:       'localhost',
   port:       2424,
   username:   'root',
   password:   'root_passwd'
});
</code></pre>
<p>Your application uses this code to initialize the <code>server</code> variable.  It then connects to OrientDB using <code>root</code> and <code>root_passwd</code> as the login credentials.</p>
<p>When you're done with the server, you need to close it to free up system resources.</p>
<pre><code class="language-javascript">server.close();
</code></pre>
<h3 id="using-tokens"><a class="header" href="#using-tokens">Using Tokens</a></h3>
<p>OrientJS supports tokens through the <a href="orientjs/../internals/Network-Binary-Protocol.html#token">Network Binary Protocol</a>.  To use it in your application, define the <code>useToken</code> configuration parameter when you initialize the server connection.</p>
<p>For instance,</p>
<pre><code class="language-javascript">var server = OrientDB({
   host:     'localhost',
   port:     2424,
   username: 'root',
   password: 'root_passwd',
   useToken: true
});
</code></pre>
<h3 id="using-distributed-databases"><a class="header" href="#using-distributed-databases">Using Distributed Databases</a></h3>
<p>Beginning in version 2.1.11 of OrientJS, you can develop Node.js applications to use distributed database instances.  To do so, define the <code>servers</code> configuration parameter when you initialize the server connection.  OrientJS uses these as alternate hosts in the event that it encounters an error while connecting to the primary host.</p>
<p>When using this method, the only requisite is that at least one of these servers must be online when the application attempts to establish its first connection.</p>
<pre><code class="language-js">var server = OrientDB({
   host:     '10.0.1.5',
   port:     2424,
   username: 'root',
   password: 'root_passwd',
   servers:  [{host: '10.0.1.5', port: 2425}]
});

var db = server.use({
   name:     'GratefulDeadConcerts',
   username: 'admin',
   password: 'admin_passwd'
});
</code></pre>
<p>The only prerequisite when executing this code is that at least one of the hosts, primary or secondary, be online at the time that it first runs.  Once it has established this initial connection, OrientJS keeps the list up to date with those servers in the cluster that are currently online.  It manages this through the push notifications that OrientDB sends to connected clients when changes occur in cluster membership.</p>
<blockquote>
<p><strong>NOTE</strong>: Distributed Database support in OrientJS remains experimental.  It is recommended that you don't use it in production.</p>
</blockquote>
<h2 id="working-with-server"><a class="header" href="#working-with-server">Working with Server</a></h2>
<p>Once you have initialized the <code>server</code> variable in your application, you can use it to manage and otherwise work with the OrientDB Server, such as listing the current databases and creating new databases on the server.  It also provides methods to initialize the OrientJS <a href="orientjs/OrientJS-Database.html">Database API</a> variables, which are covered in more detail elsewhere.</p>
<h3 id="listing-databases-1"><a class="header" href="#listing-databases-1">Listing Databases</a></h3>
<p>Using the Server API you can list the current databases on the Server using the <code>server.list()</code> method.  This returns a list object, which you can store as a variable and use elsewhere, or you can pass it to the <code>console.log()</code> function to print the number of databases available on the server.</p>
<pre><code class="language-js">var dbs = server.list()
   .then(
      function(list){
         console.log('Databases on Server:', list.length);
      }
   );
</code></pre>
<p>Here, the database list is set to the variable <code>dbs</code>.  It then uses the <code>.length</code> operator to find the number of entries in the list.  You might use the <code>server.list()</code> method in your application logic in determining whether you need to create a database before attempting to connect to one.</p>
<h3 id="creating-databases-2"><a class="header" href="#creating-databases-2">Creating Databases</a></h3>
<p>In the event that you need to create a database on OrientDB, you can do so through the Server API using the <code>server.create()</code> method.  Similar to <code>server.use()</code>, this method initializes an OrientJS <a href="orientjs/OrientJS-Database.html">Database API</a> variable, which you can then use elsewhere to work with the specific databases on your server.</p>
<pre><code class="language-js">var db = server.create({
   name:    'BaseballStats',
   type:    'graph',
   storage: 'plocal'
   })
   .then(
      function(create){
         console.log('Created Database:', create.name);
      }
   );
</code></pre>
<p>Using this code creates a database for baseball statistics on the OrientDB Server. Within your application, it also initializes a Database API variable called <code>db</code>.  Then it logs a message about what it did to the console.</p>
<h3 id="using-databases"><a class="header" href="#using-databases">Using Databases</a></h3>
<p>In the event that the database already exists on your server, you can set an instance using the <code>server.use()</code> method.  Similar to <code>server.create()</code>, this method initializes an OrientJS <a href="orientjs/OrientJS-Database.html">Database API</a> variable, which you can then use elsewhere to work with the specific databases on your server.</p>
<pre><code class="language-js">var db = server.use('BaseballStats')
console.log('Using Database:', db.name);
   
</code></pre>
<p>Using this code initializes an instance of the <code>BaseballStats</code> database within your application called <code>db</code>.  You can now use this instance to work with that database.</p>
<h3 id="closing-connections"><a class="header" href="#closing-connections">Closing Connections</a></h3>
<p>When you're finished with the Server API, you need to close the client connection through the <code>server.close()</code> method.  When you call this method, OrientJS sends a message to OrientDB that it no longer needs these resources, allowing the Server itself to reallocate them to other processes.</p>
<pre><code class="language-js">server.close()
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientjs-database-api"><a class="header" href="#orientjs-database-api">OrientJS Database API</a></h1>
<p>Once you have initialized the <a href="orientjs/OrientJS-Server.html">Server API</a>, you can begin to interact with the databases on the OrientDB Server.  In your code, this starts with initializing a database instance for your application, which is managed through the OrientJS Database API.</p>
<blockquote>
<p>By convention, the variable on which you initialize the Database API is called <code>db</code>.  This designation is arbitrary and used only for convenience.</p>
</blockquote>
<h2 id="initializing-the-database-api"><a class="header" href="#initializing-the-database-api">Initializing the Database API</a></h2>
<p>In order to work with an OrientDB database in your Node.js application, you need to initialize an instance of the Database API.  This provides your application with the tools it needs to access, manipulate and otherwise interact with specific databases.  The initialization process is handled through the Server API, which is here called <code>server</code>, by convention.</p>
<p>For instance, with an existing database,</p>
<pre><code class="language-js">var db = server.use('BaseballStats')
console.log('Using Database:'  + db.name);
</code></pre>
<p>Using this code, your application would attempt to connect to the <code>BaseballStats</code> database.  When it succeeds, it logs a message to the console to tell the user which database they're on.</p>
<p>When you're done with the database, be sure to close the instance,</p>
<pre><code class="language-js">db.close();
</code></pre>
<h3 id="using-credentials"><a class="header" href="#using-credentials">Using Credentials</a></h3>
<p>In the above example, the Database API attempts to load the database using the default credentials, that is the <code>admin</code> user with the password <code>admin</code>.  That's fine for a database that collects baseball statistics, but may prove problematic in the event that you want to store sensitive information.  You can pass additional objects to the <code>server.use()</code> method to use credentials when you initialize the database instance.</p>
<pre><code class="language-js">var db = server.use({
   name:     'SmartHomeData',
   username:     'smarthome_user',
   password: 'smarthome_passwd'
});
</code></pre>
<p>Here, you have a database for logging information from various smart home devices.  By passing in the <code>user</code> and <code>password</code> arguments, you can now use application specific credentials when interacting with the database.  This allows you to implement better security practices on the database, (for instance, by restricting what <code>smarthome_user</code> can do).</p>
<h3 id="using-standalone-databases"><a class="header" href="#using-standalone-databases">Using Standalone Databases</a></h3>
<p>Beginning in version 2.1.11 of OrientJS, you can initialize a database instance without needing to connect to the OrientDB Server.  This is managed through the <code>ODatabase</code> class.</p>
<p>For instance, here the application connects to the <code>GratefulDeadConcerts</code> database and queries the vertex class, returns its length, then closes the database instance.</p>
<pre><code class="language-js">var ODatabase = require('orientjs').ODatabase;
var db = new ODatabase({
   host:     'localhost',
   port:     2424,
   username: 'admin',
   password: 'admin',
   name:     'GratefulDeadCocnerts'
});

db.open().then(function() {
   return db.query('SELECT FROM V LIMIT 1');
}).then(function(res){
   console.log(res.length);
   db.close().then(function(){
      console.log('closed');
   });
});
</code></pre>
<h2 id="working-with-databases"><a class="header" href="#working-with-databases">Working with Databases</a></h2>
<p>Methods are tied to the variable you initialize the Database API to: <code>db.&lt;method&gt;</code>.  These can also be used to define and call other API's in the OrientJS driver.</p>
<h3 id="using-the-record-api"><a class="header" href="#using-the-record-api">Using the Record API</a></h3>
<p>Methods tied to the Record API are called through the <code>db.record</code> object.  These methods allow you to access and manipulate records directly through the Record ID.  For instance, say you want to get the data from the record #1:1:</p>
<pre><code class="language-js">var rec = db.record.get('#1:1');
</code></pre>
<p>For more information on the Record API and other methods available, see <a href="orientjs/OrientJS-Record.html">Record API</a>.</p>
<h3 id="using-the-class-api"><a class="header" href="#using-the-class-api">Using the Class API</a></h3>
<p>Methods tied to the Class API are called through the <code>db.class</code> object.  These methods allow you to create, access and manipulate classes directly through their class names.  For instance, say you wanted to create a class in a baseball database for players,</p>
<pre><code class="language-js">var Player = db.class.create('Player', 'V');
</code></pre>
<p>For more information on the Class API and other methods available, see <a href="orientjs/OrientJS-Class.html">Class API</a>.</p>
<h3 id="using-the-index-api"><a class="header" href="#using-the-index-api">Using the Index API</a></h3>
<p>Methods tied to the Index API are called through the <code>db.index</code> object.  These methods all you to create and fetch index properties for a given class.  For instance, say you want create an index on the <code>Player</code> class in your baseball database for the players' names,</p>
<pre><code class="language-js">var indexName = db.index.create({
   name: 'Player.name',
   type: 'fulltext'
});
</code></pre>
<p>For more information on the Index API and other methods, see <a href="orientjs/OrientJS-Index.html">Index API</a>.  For more information on indices in general, see <a href="orientjs/../indexing/Indexes.html">Indexes</a>.</p>
<h3 id="using-the-function-api"><a class="header" href="#using-the-function-api">Using the Function API</a></h3>
<p>Using the Database API, you can access the Function API through the <code>db.createFn()</code> method.  This allows you to create custom functions to operate on your data.  For instance, in the example of a database for baseball statistics, you might want a function to calculate a player's batting average.</p>
<pre><code class="language-js">db.createFn("batAvg", function(hits, atBats){
   return hits / atBats;
});
</code></pre>
<p>For more information, see <a href="orientjs/OrientJS-Functions.html">Function API</a>.</p>
<h3 id="querying-the-database-2"><a class="header" href="#querying-the-database-2">Querying the Database</a></h3>
<p>Unlike the above operations, querying the database does not require that you call a dedicated API.  You can call these methods on the Database API directly, without setting or defining an additional object, using the <code>db.query()</code> method.</p>
<p>The <code>db.query</code> method executes an SQL query against the opened database.  You can either define these values directly in SQL, or define arbitrary parameters through additional arguments.</p>
<p>For instance, using the baseball database, say that you want to allow users to retrieve statistical information on players.  They provide the parameters and your application sorts and displays the results.</p>
<pre><code class="language-js">var targetAvg = 0.3;
var targetTeam = 'Red Sox';

var hitters = db.query(
   'SELECT name, battavg FROM Player WHERE battavg &gt;= :ba AND team = :team',
   {params: {
      ba: targetAvg,
      team: targetTeam
    },limit: 20 }
).then(
   function(players){
      console.log(players);
   }
);
</code></pre>
<p>Here, the variables <code>targetAvg</code> and <code>targetTeam</code> are defined at the start, then the query is run against the <code>Player</code> class for Red Sox players with batting averages greater than or equal to .300, printing the return value to the console.</p>
<p>There are a number of more specialized query related methods supported by the Database API.  For more information, see the <a href="orientjs/OrientJS-Query.html">Query</a> guide.</p>
<h3 id="transactions-5"><a class="header" href="#transactions-5">Transactions</a></h3>
<p>The Database API supports transactions through the <code>db.let()</code> and <code>db.commit()</code> methods.  These allow you to string together a series of changes to the database and then commit them together.  For instance, here is a transaction to add the player Shoeless Joe Jackson to the database:</p>
<pre><code class="language-js">var trx = db.let('player',
   function(p){
      p.create('VERTEX', 'Player')
         .set({
            name:      'Shoeless Joe Jackson',
            birthDate: '1887-07-16',
            deathDate: '1951-12-05',
            batted:    'left',
            threw:     'right'
         })
   }).commit()
   .return('$player').all();
</code></pre>
<p>For more information, see <a href="orientjs/OrientJS-Transactions.html">Transactions</a>.</p>
<h3 id="events"><a class="header" href="#events">Events</a></h3>
<p>You may find it useful to run additional code around queries outside of the normal operations for your application.  For instance, as part of a logging or debugging process, to record the queries made and how OrientDB or your application performed in serving the data.</p>
<p>Using the <code>db.on()</code> method, you can set custom code to run on certain events, such as the beginning and ending of queries.  For instance,</p>
<pre><code class="language-js">db.on("endQuery", function(obj){
   console.log("DEBUG QUERY:", obj);
});
</code></pre>
<p>For more information, see <a href="orientjs/OrientJS-Events.html">Events</a>.</p>
<h3 id="closing-the-database"><a class="header" href="#closing-the-database">Closing the Database</a></h3>
<p>When you initialize a database instance, OrientDB begins to reserve system resources for the client to access and manipulate data through the server.  In order to free up these resources when you're done, you need to close the open database instance, using the <code>db.close()</code> method.</p>
<pre><code class="language-js">db.close();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientjs-record-api"><a class="header" href="#orientjs-record-api">OrientJS Record API</a></h1>
<p>Once you have initialized a database instance, you can fetch and manipulate records directly through their <a href="orientjs/../datamodeling/Concepts.html#record-id">Record ID's</a>. Unlike many Database API features, you don't need to initialize a record object in order to manipulate the data.</p>
<blockquote>
<p>By convention, the variable on which you initialize the Database API is called <code>db</code>.  This designation is arbitrary and used only for convenience.</p>
</blockquote>
<h2 id="working-with-records-1"><a class="header" href="#working-with-records-1">Working with Records</a></h2>
<p>Methods tied to the Record API are accessible through the Database API: <code>db.record.&lt;method&gt;</code> and take Record ID's as an argument.</p>
<h3 id="getting-records"><a class="header" href="#getting-records">Getting Records</a></h3>
<p>Using the Record API, you can fetch records by their Record ID's using the <code>db.record.get()</code> method by their Record ID.  For instance,</p>
<pre><code class="language-js">var rec = db.record.get('#1:1')
   .then(
      function(record){
         console.log('Loaded Record:', record);
       }
   );
</code></pre>
<h3 id="deleting-records"><a class="header" href="#deleting-records">Deleting Records</a></h3>
<p>Using the Record API, you can delete records by their Record ID's using the <code>db.record.delete()</code> method.  For instance,</p>
<pre><code class="language-js">db.record.delete('#1:1');
</code></pre>
<h3 id="creating-raw-binary-records"><a class="header" href="#creating-raw-binary-records">Creating Raw Binary Records</a></h3>
<p>There are several methods available to you in creating records on the database.  Using the Record API, you can create records through raw binary data, writing directly into OrientDB.  For instance,</p>
<pre><code class="language-js">// Initialize Buffer
var binary_data = new Buffer(...);

// Define Type and Cluster
binary_data['@type'] = 'b';
binary_data['@class'] = 'Player';

// Create Record
var data = db.record.create(binary_data)
   .then(
      function(record){
         console.log('Created Record ID:', binary_data['@rid']);
      }
   );
</code></pre>
<p>Here, you initialize the <code>binary_data</code> variable as a new <code>Buffer()</code> instance.  Then you set the type and cluster on which it's stored, (<code>@class</code> in this case refers to the cluster).  Finally, you create the record in OrientDB, printing its Record ID to the console.</p>
<h3 id="updating-a-record"><a class="header" href="#updating-a-record">Updating a record</a></h3>
<p>Using the Record API, you can updated records using previusly fetched objects wit db.record.update() method.
For instance,</p>
<pre><code class="language-js">
db.record.get('#5:0')
	.then(function(record){
      record.surname = 'updated'
      db.record.update(record)
         .then(function(){
          console.log("Updated");
      })
   })
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientjs-class-api"><a class="header" href="#orientjs-class-api">OrientJS Class API</a></h1>
<p>Once you have initialized a database instance, you can use it to access and manipulate classes in OrientDB, through the OrientJS Class API.  This allows you to work with the database schema, in the event that you want to use a schema.</p>
<p>Methods for the Class API are accessible through the <code>db.class</code> object.</p>
<ul>
<li><a href="orientjs/OrientJS-Class-Classes.html"><strong>Working with Classes</strong></a> Using these methods you can operate on the class itself: listing those available, creating, extending and updating classes, as well as fetching the object itself.</li>
<li><a href="orientjs/OrientJS-Class-Properties.html"><strong>Working with Properties</strong></a> Using these methods, you can operate on class properties: listing those available, creating, removing and updating the properties.</li>
<li><a href="orientjs/OrientJS-Class-Records.html"><strong>Working with Records</strong></a> Using these methods, you can operate on records through the Class API: listing and creating records on the class, as an alternative to the OrientJS <a href="orientjs/OrientJS-Query.html">Query Builder</a>.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="working-with-classes-1"><a class="header" href="#working-with-classes-1">Working with Classes</a></h1>
<p>With OrientJS, you can access and manipulate classes on your OrientDB database, through the Class API.  This allows you to perform various operations on the classes directly from within your Node.js application.</p>
<h2 id="listing-classes"><a class="header" href="#listing-classes">Listing Classes</a></h2>
<p>Using the Class API, you can retrieve all current classes on the database in a list.  You might do this in checking that the database has been set up or to otherwise ensure that it includes the classes your application requires to operate.</p>
<pre><code class="language-js">db.class.list()
   .then(
      function(classes){
         console.log('There are ' 
         + classes.length 
         + ' classes in the db:',
         classes);
      }
   );
</code></pre>
<p>Here, the class list is set to the variable <code>classes</code>, which in turn uses the <code>length</code> operator to find the number of entries in the list.</p>
<h2 id="creating-classes-3"><a class="header" href="#creating-classes-3">Creating Classes</a></h2>
<p>You can also create classes through the Class API.  You may find this especially useful when setting up a schema on your database.  For instance, on the <code>BaseballStats</code> database, you might want to create a class to log statistical information on particular players.</p>
<pre><code class="language-js">db.class.create('Player')
   .then(
      function(player){
         console.log('Created class: ' + player.name);
      }
   );
</code></pre>
<p>This creates the class <code>Player</code> in the database and a cluster <code>player</code> in which to store the data.</p>
<blockquote>
<p>To further define the schema, you need to create properties.  For information on how to manage this through the Class API, see <a href="orientjs/OrientJS-Class-Properties.html">Working with Properties</a>.</p>
</blockquote>
<p>The <code>db.class.create</code> method has the following function signature</p>
<p><code>db.class.create(&lt;name&gt;, [inherits], [defaultCluster], [abstract])</code></p>
<ul>
<li><code>name (string)</code>: the name of the class to be created</li>
<li><code>inherits (string)</code>: the class (or list of classes as a comma delimited string) this class will inherit from</li>
<li><code>defaultCluster (integer)</code>: the default cluster to use for records on this class, can be left as null</li>
<li><code>abstract (boolean)</code>: flag to indicate if this is an abstract class being created</li>
</ul>
<h3 id="extending-classes"><a class="header" href="#extending-classes">Extending Classes</a></h3>
<p>Sometimes you may want to extend existing classes, such as ones that you've created previously or to create custom vertex and edge classes in a graph database.  You can manage this through the Class API by passing additional arguments to the <code>db.class.create()</code> method.</p>
<p>For instance, in the above example you created a class for storing data on players.  Consider the case where you want instances of <code>Player</code> to be vertices in a Graph Database.</p>
<pre><code class="language-js">db.class.create('Player', 'V')
   .then(
      function(player){
         console.log('Created Vertex Class: ' + player.name);
      }
   );
</code></pre>
<p>This creates <code>Player</code> as an extension of the vertex class <code>V</code>.</p>
<h2 id="getting-classes-2"><a class="header" href="#getting-classes-2">Getting Classes</a></h2>
<p>In order to work with the class, you may need to retrieve the class object from OrientDB.  With OrientJS this is handled by the <code>db.class.get()</code> method.</p>
<pre><code class="language-js">var player = db.class.get('Player')
   .then(
      function(player){
         console.log('Retrieved class: ' + player.name);
      }
   );
</code></pre>
<h2 id="updating-classes"><a class="header" href="#updating-classes">Updating Classes</a></h2>
<p>In certain situations, you may want to update or otherwise change a class after creating it.  You can do so through the <code>db.class.update()</code> method.</p>
<p>For instance, above there were two examples on how to create a class for baseball players, one using the default method and one creating the class as an extension of the vertex class <code>V</code>.  By updating the class, you can add the super-class to an existing class, removing the need to create it all over again.</p>
<pre><code class="language-js">db.class.update({
   name: 'Player',
   superClass: 'V'
}).then(
   function(player){
      console.log(
         'Updated Class: ' + player.name
         + ' to extend ' + player.superClass
      );
   }
);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="working-with-properties-2"><a class="header" href="#working-with-properties-2">Working with Properties</a></h1>
<p>With OrientJS, you can access and manipulate properties on your OrientDB database, through the Class API.  This allows you to perform various operations on the classes directly from within your Node.js application.</p>
<p>The examples below use a database of baseball statistics, assuming that you've already created a class for players and initialized it in your code.  For instance,</p>
<pre><code class="language-js">db.class.get('Player').then(function(Player){
   Player.property...
});
</code></pre>
<p>Methods that operate on properties use the <code>class.property</code> object, such as <code>Player.property.list()</code>.</p>
<h2 id="listing-properties"><a class="header" href="#listing-properties">Listing Properties</a></h2>
<p>In the event that you need to check the schema or are unfamiliar with the properties created on a class, you can retrieve them into a list using the <code>class.property.list()</code> method.</p>
<p>For instance, say you want a list of properties set for the class <code>Player</code>:</p>
<pre><code class="language-js">Player.property.list()
   .then(
      function(properties){
         console.log(
            Player.name + 'class has the following properties: ',
            properties
         );
      }
   );
</code></pre>
<h2 id="creating-properties-3"><a class="header" href="#creating-properties-3">Creating Properties</a></h2>
<p>Using OrientJS, you can define a schema for the classes from within your application by creating properties on the class with the <code>class.property.create()</code> method.  For instance,</p>
<pre><code class="language-js">Player.property.create({
   name: 'name',
   type: 'String'
}).then(
   function(property){
      console.log("Created Property: " + property.name);
   }
);
</code></pre>
<p>This adds a property to the class where you can give the player's name when entering data.  This is fine if you only have a few properties to create, but in the case of the example, there are a large number of values you might assign to a given player, such as dates of birth and death, team, batting averages, and so on.  You can set multiple properties together by passing <code>class.property.create()</code> an array.</p>
<pre><code class="language-js">Player.property.create([
   {name: 'dateBirth',
    type: 'Date'},
   {name: 'dateDeath',
    type: 'Date'},
   {name: 'team',
    type: 'String'}
   {name: 'battingAverage',
    type: 'Float'}
]).then(
   function(property){
      console.log("Created Property: " + property.name);
   }
);
</code></pre>
<h2 id="deleting-properties"><a class="header" href="#deleting-properties">Deleting Properties</a></h2>
<p>In the event that you find you have set a property on a class that you want to remove, you can do so from within your application using the <code>class.property.drop()</code> method.  For instance, sat that you decide that you want to handle teams as a distinct class rather than a field in <code>Player</code>.</p>
<pre><code class="language-js">Player.property.drop('team').then(function(){
   console.log('Property dropped.');
});
</code></pre>
<h2 id="renaming-properties"><a class="header" href="#renaming-properties">Renaming Properties</a></h2>
<p>In the event that you want to rename a property through OrientJS, you can do so using the <code>class.property.rename()</code> method.</p>
<pre><code class="language-js">Player.property.rename('battingAverage', 'batAvg').then(function(p){
   console.log('Property renamed');
});
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="working-with-records-2"><a class="header" href="#working-with-records-2">Working with Records</a></h1>
<p>With OrientJS you can access and manipulate records on your OrientDB database, through the Class API.  This allows you to perform various operations on the data in a given class directly from within your Node.js application.</p>
<p>The examples below use a database of baseball statistics, assuming that you've already created a class for players and initialized it in your code.  For instance,</p>
<pre><code class="language-js">db.class.get('Player').then(function(Player){
   Player...
});
</code></pre>
<h2 id="listing-records"><a class="header" href="#listing-records">Listing Records</a></h2>
<p>With the Class API, you can retrieve all records on the current class into an array using the <code>db.class.list()</code> method.  You might do this in operating on records or in collecting them for display in a web application.</p>
<pre><code class="language-js">Player.list()
   .then(
      function(player){
         console.log('Records Found: ' + records.length());
      }
   );
</code></pre>
<p>Here, the current list of players in the database are set to the variable <code>records</code>, which in turn uses the <code>length</code> operator to find the number of entries in the database.</p>
<h2 id="creating-records"><a class="header" href="#creating-records">Creating Records</a></h2>
<p>You can also create records on OrientDB through the <code>db.class.create()</code> method.  This creates the class in the database and then retrieves it into a variable for further operations.</p>
<pre><code class="language-js">Player.create({
   name:      "Ty Cobb",
   birthDate: "1886-12-18",
   deathDate: "1961-7-17",
   batted:    "left",
   threw:     "right"
}).then(
   function(player){
      console.log('Created Record: ' player.name);
   }
);
</code></pre>
<p>Here, you create an entry for the player Ty Cobb, including information on his dates of birth and death, and the sides he used when batting and throwing, which you might later collate with other players to show say the difference in batting averages and RBI's between left-side batters right-side throwers and left-side batters left-side throwers between the years 1910 and 1920.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientjs-index-api"><a class="header" href="#orientjs-index-api">OrientJS Index API</a></h1>
<p>Once you have initialized a database instance, you can create and fetch indices from OrientDB, using the OrientJS Index API.  This allows you to work with and take advantage of indexing features in OrientDB directly from within your application.</p>
<blockquote>
<p>By convention, the variable on which you initialize the Database API is called <code>db</code>.  This designation is arbitrary and used only for convenience.</p>
</blockquote>
<h2 id="working-with-indices"><a class="header" href="#working-with-indices">Working with Indices</a></h2>
<p>Methods tied to the Index API are accessible through the Database API: <code>db.index.&lt;method&gt;</code>.  In OrientDB, indices are set as properties on the class they index.</p>
<h3 id="creating-indexes-2"><a class="header" href="#creating-indexes-2">Creating Indexes</a></h3>
<p>Using the Index API, you create an index property on a given class through the <code>db.index.create()</code> method.  For instance,</p>
<pre><code class="language-js">var indexName = db.index.create({
   name: 'Player.name',
   type: 'fulltext'
}).then(
   function(index){
      console.log('Created Index: ' + index.name);
   }
);
</code></pre>
<p>In the baseball statistics database, you may find yourself often searching for players by name.  The above example creates a Full Text index on the <code>name</code> property of <code>Player</code> using the SB-Tree indexing algorithm.</p>
<blockquote>
<p>For more information on indices in OrientDB, see <a href="orientjs/../indexing/Indexes.html">Indexes</a>.</p>
</blockquote>
<h3 id="getting-indexes-1"><a class="header" href="#getting-indexes-1">Getting Indexes</a></h3>
<p>In the event that you would like to operate on an index object directly from within your application, you can fetch using the <code>db.index.get()</code> method.  You can then use the <code>get()</code> method on the return object to search for values.  For instance,</p>
<pre><code class="language-js">var indexName = db.index.get('Player.name');
var cobb = indexName.get('Ty Cobb');
</code></pre>
<p>Here, on the class <code>Player</code>, you retrieve the index on the <code>name</code> property, defining it as <code>indexName</code>, then using the <code>get()</code> method you search for the player entry on Ty Cobb.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientjs-function-api"><a class="header" href="#orientjs-function-api">OrientJS Function API</a></h1>
<p>In certain use cases you may find yourself in a situation where the available functions and methods supplied by OrientJS are not sufficient to meet your needs.  To manage this, you can create your own, custom functions to use in your application.</p>
<h2 id="creating-custom-functions"><a class="header" href="#creating-custom-functions">Creating Custom Functions</a></h2>
<p>The Function API is accessible through the <a href="orientjs/OrientJS-Database.html">Database API</a>.  Once you initialize a database, you can create custom functions through the <code>db.createFn()</code> method.</p>
<p>For instance, consider the example database of baseball statistics.  You might want a function to calculate a player's batting average from arguments providing hits and times at bat.</p>
<pre><code class="language-js">db.createFn("batAvg",
   function(hits, atBats){
      return hits / atBats;
   }
);
</code></pre>
<p>In the event that you don't want to define a name for the function, it defaults to <code>Function#name</code>:</p>
<pre><code class="language-js">db.createFn(function nameOfFunction(arg1, arg2){
   return arg1 + arg2;
});
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="queries-in-orientjs"><a class="header" href="#queries-in-orientjs">Queries in OrientJS</a></h1>
<p>Where the features described in previous chapters operate through their own API's, OrientJS handles queries as a series of methods tied to the <a href="orientjs/OrientJS-Database.html">Database API</a>.  Once you've initialized the variable for your database, (here called <code>db</code>), you can execute queries through it to get data from OrientDB.</p>
<p>There are two methods available in issuing queries to the database.  You can query it directly in SQL.  Alternatively, you can use the Query Builder methods to construct your query in Node.js.</p>
<h2 id="working-with-queries"><a class="header" href="#working-with-queries">Working with Queries</a></h2>
<p>When querying the database directly, you prepare a string containing OrientDB <a href="orientjs/../sql/README.html">SQL</a>, the pass it to either the <code>db.query()</code> or <code>db.exec()</code> methods.  For instance, going back to the baseball database, say that you want a list of players with a batting average of at least .300 that played for the Red Sox.</p>
<pre><code class="language-js">db.query(
   'SELECT name, ba FROM Player '
   + 'WHERE ba &gt;= 0.3 AND team = "Red Sox"'
).then(function(hitters){
   console.log(hitters)
});
</code></pre>
<h3 id="using-parameters"><a class="header" href="#using-parameters">Using Parameters</a></h3>
<p>In the event that you want to query other teams and batting averages, such as the case where you want your application to serve a website, you can use previously defined variables, (here, <code>targetBA</code> and <code>targetTeam</code>), to set these parameters.  You can also add a limit to minimize the amount of data your application needs to parse.</p>
<blockquote>
<p>Do not enclose param placeholders in single/double quotes in query string. Query parameters are properly encoded by their type. Given example below, the executed query will be <code>SELECT name, ba FROM Player WHERE ba &gt;= 0.3 AND team = "Red Sox" LIMIT 20</code></p>
</blockquote>
<pre><code class="language-js">var targetBA = 0.3;
var targetTeam = 'Red Sox';

db.query(
   'SELECT name, ba FROM Player '
   + 'WHERE ba &gt;= :ba AND team = :team',
   {params:{
            ba: targetBA,
            team: targetTeam
           },
    limit: 20
   }
).then(function(hitters){
   console.log(hitters)
});
</code></pre>
<h3 id="using-fetching-strategies"><a class="header" href="#using-fetching-strategies">Using Fetching Strategies</a></h3>
<p>While the <code>query()</code> method supports most OrientDB SQL statements, there are some limitations in regards to <a href="orientjs/../java/Fetching-Strategies.html">Fetching Strategies</a>.</p>
<p>The <code>query()</code> method does not support Fetching Strategies directly.For instance, say that you want to query the player records in your baseball database with baseball card images.  From the OrientDB Console, you might issue this command:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT name, OUT("hasCard") AS cards
          FROM Player FETCHPLAN *:1</code>
</pre>
<p>This would return a result-set with the player's name in one colmn and an array from the <code>Card</code> class with all properties on that class, (as expected).  If instead, you passed this query in OrientJS through the <code>query()</code> method, you would meet with different results:</p>
<pre><code class="language-js">db.query(
   'SELECT name, OUT("hasCard") AS cards '
   + 'FROM Player FETCHPLAN *:1')
   .then(function(results){
   console.log(results)
})
</code></pre>
<p>Using this code, instead of fetching and unpacking the relationship connecting the <code>Player</code> and <code>Card</code> class, the <code>card</code> column would only contain an array of Record ID's, ignoring the Fetch Plan.  The reason is that it expects to parse Fetch Plans as part of a parameter option, rather than with the query itself.  To use Fetching Strategies with OrientJS, pass it as a parameter:</p>
<pre><code class="language-js">var results = db.query(
   'SELECT name, OUT("hasCard") AS cards '
   + 'FROM Player',
   {fetchPlan: 'hasCard:1'})
    .then(function(results){
   console.log(results)
})
</code></pre>
<h2 id="query-builder"><a class="header" href="#query-builder">Query Builder</a></h2>
<p>Rather than writing out query strings in SQL, you can alternatively use the OrientJS Query Builder to construct queries using a series of methods connected through the Database API.</p>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="orientjs/OrientJS-Query-Create.html"><strong><code>create()</code></strong></a></td><td>Creates vertices and edges.</td></tr>
<tr><td><a href="orientjs/OrientJS-Query-Delete.html"><strong><code>delete()</code></strong></a></td><td>Removes vertices, edges, and records.</td></tr>
<tr><td><a href="orientjs/OrientJS-Query-Fetch.html"><strong><code>fetch()</code></strong></a></td><td>Defines a <a href="orientjs/../java/Fetching-Strategies.html">Fetching Strategy</a>.</td></tr>
<tr><td><a href="orientjs/OrientJS-Query-Insert.html"><strong><code>insert()</code></strong></a></td><td>Adds records.</td></tr>
<tr><td><a href="orientjs/OrientJS-Query-Live-Query.html"><strong><code>liveQuery()</code></strong></a></td><td>Executes a Live Query.</td></tr>
<tr><td><a href="orientjs/OrientJS-Query-Select.html"><strong><code>select()</code></strong></a></td><td>Fetches records by query.</td></tr>
<tr><td><a href="orientjs/OrientJS-Query-Transform.html"><strong><code>transform()</code></strong></a></td><td>Modifies records in transit.</td></tr>
<tr><td><a href="orientjs/OrientJS-Query-Traverse.html"><strong><code>traverse()</code></strong></a></td><td>Fetches records by traversal.</td></tr>
<tr><td><a href="orientjs/OrientJS-Query-Update.html"><strong><code>update()</code></strong></a></td><td>Modifies records on database.</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="orientjs---create"><a class="header" href="#orientjs---create">OrientJS - <code>create()</code></a></h1>
<p>Creation queries in OrientJS are those used in creating vertex and edge records on a Graph Database.  Given the added complexity of regular or lightweight edges running between the vertices, adding records is a little more complicated than the <a href="orientjs/OrientJS-Query-Insert.html"><code>insert()</code></a> method you might use otherwise.</p>
<p>The creation query method is comparable to the <a href="orientjs/../sql/SQL-Create-Vertex.html"><code>CREATE VERTEX</code></a> and <a href="orientjs/../sql/SQL-Create-Edge.html"><code>CREATE EDGE</code></a> commands on the OrientDB Console.</p>
<h2 id="working-with-creation-queries"><a class="header" href="#working-with-creation-queries">Working with Creation Queries</a></h2>
<p>In OrientJS, creating vertices and edges uses the <code>create()</code> method.  The examples below operate on a database of baseball statistics, which has been initialized on the <code>db</code> variable.</p>
<h3 id="creating-vertices-3"><a class="header" href="#creating-vertices-3">Creating Vertices</a></h3>
<p>Create an empty vertex on the <code>Player</code> vertex class:</p>
<pre><code class="language-js">var player = db.create('VERTEX', `Player`).one();
console.log('Created Vertex:', player);
</code></pre>
<p>Create a vertex with properties:</p>
<pre><code class="language-js">var player = db.create('VERTEX', 'Player')
   .set({
      name:      'Ty Cobb',
      birthDate: '1886-12-18',
      deathDate: '1961-7-17',
      batted:    'left',
      threw:     'right'
   }).one().then(
      function(player){
         console.log('Created Vertex: ' + player.name);
      }
   );
</code></pre>
<h3 id="creating-edges-4"><a class="header" href="#creating-edges-4">Creating Edges</a></h3>
<p>Creating edges to connect two vertices follows the same pattern as creating vertices, with the addition of <code>from()</code> and <code>to()</code> methods to show the edge direction.</p>
<p>For instance, consider an edge class <code>PlaysFor</code> that you use to connect player and team vertices.  Using it, you might create a simple edge that simply establishes the connection:</p>
<pre><code class="language-js">var playsFor = db.create('EDGE', 'PlaysFor')
   .from('#12:12').to('#12:13').one();
</code></pre>
<p>This creates an edge between the player Ty Cobb, (#12:12), and the Detroit Tigers, (#12:13).  While this approach may be useful with players that stay with the same team, many don't.  In order to account for this, you would need to define properties on the edge.</p>
<pre><code class="language-js">var playsFor = db.create('EDGE', 'PlaysFor')
   .from('#12:12').to('#12:13')
   .set({
      startYear: "1905",
      endYear: "1926",
   }).one();
</code></pre>
<p>Now, whenever you build queries to show the players for a team, you can include conditionals to only show what teams they played for in a given year.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientjs---delete"><a class="header" href="#orientjs---delete">OrientJS - <code>delete()</code></a></h1>
<p>Deletion queries in OrientJS are those used in removing records from the database.  It can also account for edges between vertices, updating the graph to maintain its consistency.</p>
<p>The deletion query method is comparable to <a href="orientjs/../sql/SQL-Delete.html"><code>DELETE</code></a>, <a href="orientjs/../sql/SQL-Delete-Vertex.html"><code>DELETE VERTEX</code></a> and the <a href="orientjs/../sql/SQL-Delete-Edge.html"><code>DELETE EDGE</code></a> statements.</p>
<h2 id="working-with-deletion-queries"><a class="header" href="#working-with-deletion-queries">Working with Deletion Queries</a></h2>
<p>In OrientJS, deletions use the <code>delete()</code> method.  The examples below operate on a database of baseball statistics, which has been initialized on the <code>db</code> variable.</p>
<h3 id="deleting-vertices"><a class="header" href="#deleting-vertices">Deleting Vertices</a></h3>
<p>With Graph Databases, deleting vertices is a little more complicated than the normal process of deleting records. You need to tell OrientDB that you want to delete a vertex to ensure that it takes the additional steps necessary to update the connecting edges.</p>
<p>For instance, you find that you have two entries made for the player Shoeless Joe Jackson, #12:24 and #12:84 you decide to remove the extra instance within your application.</p>
<pre><code class="language-js">db.delete('VERTEX','Player')
   .where('@rid = #12:84').one()
   .then(
      function(del){
         console.log('Records Deleted: ' + del);
      }   
   );
</code></pre>
<h3 id="deleting-edges"><a class="header" href="#deleting-edges">Deleting Edges</a></h3>
<p>When deleting edges, you need to define the vertices that the edge connects.  For instance, consider the case where you have a bad entry on the <code>playsFor</code> edge, where you have Ty Cobb assigned to the Chicago Cubs.  Ty Cobb has a Record ID of #12:12, the Chicago Cubs #12:54.</p>
<pre><code class="language-js">db.delete('EDGE', 'PlaysFor')
   .from('#12:12').to('#12:54')
   .scalar()
   .then(
      function(del){
         console.log('Records Deleted: ' + del);
      }
   );
</code></pre>
<h3 id="deleting-records-1"><a class="header" href="#deleting-records-1">Deleting Records</a></h3>
<p>In order to delete records in a given class, you need to define a conditional value that tells OrientDB the specific records in the class that you want to delete.  When working from the Console, you would use the <a href="orientjs/../sql/SQL-Where.html"><code>WHERE</code></a> clause.  In OrientJS, set the <code>where()</code> method.</p>
<pre><code class="language-js">db.delete().from('Player')
   .where('@rid = #12:84').limit(1).scalar()
   .then(
      function(del){
         console.log('Records Deleted: ' + del);
      }
   );
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientjs---fetch"><a class="header" href="#orientjs---fetch">OrientJS - <code>fetch()</code></a></h1>
<p>In OrientDB, sometimes the default behavior of the <a href="orientjs/../sql/SQL-Query.html"><code>SELECT</code></a> command is not sufficient for your needs.  For instance, when your application connects to a remote server, using a fetching strategy can limit the number of times it needs to connect to the remote server.</p>
<blockquote>
<p>For more information, see <a href="orientjs/../java/Fetching-Strategies.html">Fetching Strategies</a>.</p>
</blockquote>
<h2 id="working-with-fetching-strategies"><a class="header" href="#working-with-fetching-strategies">Working with Fetching Strategies</a></h2>
<p>Using Fetching Strategies in OrientJS operates through the <code>fetch()</code> method tied into a larger query.</p>
<h3 id="using-depth-levels"><a class="header" href="#using-depth-levels">Using Depth Levels</a></h3>
<p>When traversing relationships to a vertex, queries can return a great deal more data than you need for the operation.  By defining the depth level, you can limit the number of traversals the query crosses in collecting the data.</p>
<p>For instance, say you want a list of active users on your database.  Using this method, you can limit the size of the load by only traversing to the fifth level.</p>
<pre><code class="language-js">var users = db.select().from('OUser')
   .where({
     status: 'ACTIVE'
   }).fetch({
      role: 5
   }).all()
   .then(
      function(data){
         console.log('Active Users: ' + users);
      }
   );
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientjs---insert"><a class="header" href="#orientjs---insert">OrientJS - <code>insert()</code></a></h1>
<p>Insertion queries in OrientJS are those that add records of a given class into the database.  The insertion query method is comparable to the <a href="orientjs/../sql/SQL-Insert.html"><code>INSERT</code></a> commands on the OrientDB Console.</p>
<h2 id="working-with-insertion-queries"><a class="header" href="#working-with-insertion-queries">Working with Insertion Queries</a></h2>
<p>In OrientJS, inserting data into the database uses the <code>insert()</code> method.  For instance, say that you want to add batting averages, runs and runs batted in for Ty Cobb.</p>
<pre><code class="language-js">db.insert().into('Player')
   .set({
     ba:  0.367,
     r:   2246,
     rbi: 1938
   }).where('name = "Ty Cobb"').one().then(function(player){
      console.log(player)
   });
</code></pre>
<h2 id="raw-expressions"><a class="header" href="#raw-expressions">Raw Expressions</a></h2>
<p>with set</p>
<pre><code class="language-js">db.insert().into('Player')
   .set({
     uuid : db.rawExpression("format('%s',uuid())"),
     ba:  0.367,
     r:   2246,
     rbi: 1938
   }).where('name = "Ty Cobb"').one().then(function(player){
      console.log(player)
   });
</code></pre>
<p>Generated query</p>
<pre><code class="language-sql">INSERT INTO Player SET uuid = format('%s',uuid()), ba = 0.367, r = 2246, rbi = 1938
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientjs---livequery"><a class="header" href="#orientjs---livequery">OrientJS - <code>liveQuery()</code></a></h1>
<p>When using traditional queries, such as those called with <code>db.query()</code> and <code>db.select()</code> you only get data that is current at the time the query is issued.  Beginning in version 2.1, OrientDB now supports <a href="orientjs/../java/Live-Query.html">Live Queries</a>, where in issuing the query you tell OrientDB you want it to push affecting changes to your application.</p>
<p>You can execute Live Queries using the <code>db.liveQuery()</code> method with a <a href="orientjs/../sql/SQL-Live-Select.html"><code>LIVE SELECT</code></a> statement passed as its argument.</p>
<p>From OrientDB 2.2.x in order to make live query works the token must be enabled. See <a href="orientjs/OrientJS-Server.html#using-tokens">here</a></p>
<h2 id="understanding-live-queries-1"><a class="header" href="#understanding-live-queries-1">Understanding Live Queries</a></h2>
<p>Traditional queries provide you with information that is current at the time the query is issued.  In most cases, such as well pulling statistical data on long-dead ball players like Ty Cobb, this behavior is sufficient to your needs.  But, what if about when you need real time information.</p>
<p>For instance, what if in addition to historical data you also want your application to serve real-time information about baseball games as they're being played.</p>
<p>With the traditional query, you would have to reissue the query within a set interval to update the application.  Live Queries allow you to register events, so that your application performs addition operations in the event of an <a href="orientjs/../sql/SQL-Insert.html"><code>INSERT</code></a>, <a href="orientjs/../sql/SQL-Delete.html"><code>DELETE</code></a>, or <a href="orientjs/../sql/SQL-Update.html"><code>UPDATE</code></a>.</p>
<p>For example, say that you have a web application that uses the baseball database.  The application serves the current score and various other stats for the game.  Whenever your back-end system inserts new records for the game, you can execute a function to update the display information.</p>
<blockquote>
<p>For more information on event handlers in OrientJS, see <a href="orientjs/OrientJS-Events.html">Events</a>.</p>
</blockquote>
<h2 id="working-with-live-queries"><a class="header" href="#working-with-live-queries">Working with Live Queries</a></h2>
<p>In OrientJS, Live Queries are called using the <code>db.liveQuery()</code> method.  This is similar to <code>db.query()</code> in that you use it to issue the raw SQL of a <a href="orientjs/../sql/SQL-Live-Select.html"><code>LIVE SELECT</code></a> statement.  Unlike <code>db.query()</code>, you can assign event handlers to <code>db.liveQuery</code> using the <code>on()</code> method.</p>
<p>For instance,</p>
<pre><code class="language-js">db.liveQuery('LIVE SELECT FROM V')
   .on('live-update', function(data){
      var myRecord = data.content;
   });
</code></pre>
<p>This would assign to the variable <code>myRecord</code> object data in response to each update made to the class <code>V</code>.  For instance,</p>
<pre><code class="language-js">db.update('#12:97')
   .set({
      ba: 0.321
   }).one(); 
</code></pre>
<p>When your application runs this method, it also sets the <code>myRecord</code> variable to</p>
<pre><code class="language-js">var myRecord = {
   content: {
      @rid: $12:97,
      ba: 0.321
   },
   operation: update
};
</code></pre>
<p>You can then use this information in your code to determine what your application should do in response.</p>
<h3 id="running-events-on-insert"><a class="header" href="#running-events-on-insert">Running Events on Insert</a></h3>
<p>When you pass the <code>liveQuery().on()</code> method the string <code>live-insert</code>, it executes the function argument whenever an insert operation is performed on the class.</p>
<p>For instance, say that you want to pass statistics on new plays to your game monitoring application:</p>
<pre><code class="language-js">db.liveQuery('LIVE SELECT FROM Game '
             + WHERE game_id = "201606-001"')
   .on('live-insert', function(data){
      var gameStat = data.content;
		  if (gameStat.score != currentScore){
         var score = updateScore(gameStat.score);
         console.log("Updated Score:", score);
      }
   });
</code></pre>
<p>Here, the Live Query registers an event to <a href="orientjs/../sql/SQL-Insert.html"><code>INSERT</code></a> events on the <code>Game</code> class where the <code>game_id</code> property equals the one currently being played.  Whenever the back-end service inserts data on a new play, the application checks for changes in the score.  When either team scores, it passes the score to an <code>updateScore</code> function, which we might use to trigger a notification event in the web browser to let the user know their team scored run or runs.</p>
<h3 id="running-events-on-delete"><a class="header" href="#running-events-on-delete">Running Events on Delete</a></h3>
<p>When you pass the <code>liveQuery().on()</code> method the string <code>live-delete</code>, it executes the function argument whenever a delete operation is performed on the class.</p>
<p>For instance, for the baseball database, say that you only calculate player batting averages after each game instead of on the fly.  You might set up an event to process new batting averages whenever the stored values are deleted.</p>
<pre><code class="language-js">db.liveQuery('LIVE SELECT rid, name, ba FROM Player`)
   .on('live-delete' function(data.content){
      var player = data.content;
			var newBA = genBatAvg(player.rid);
      db.update(player.rid)
         .set({
            ba: newBa
         }).one()
         then(
            function(update){
               console.log("Updated BA: " update.name);
            }
         );
   });
</code></pre>
<p>Now, whenever your application issues a <a href="orientjs/OrientJS-Query-Delete.html"><code>delete()</code></a> statement against the player's batting average, it triggers this function to generate a new batting average and runs the <a href="orientjs/OrientJS-Query-Update.html"><code>update()</code></a> method to apply the changes to the player's record.  Once this operation is complete, all queries made against this class will use the new data.</p>
<h3 id="running-events-on-updates"><a class="header" href="#running-events-on-updates">Running Events on Updates</a></h3>
<p>When you pass the <code>liveQuery().on()</code> method the string <code>live-update</code>, it executes the function argument whenever an update operation is performed on the class.</p>
<p>For instance, say that as a security precaution, you would like your application to email you whenever certain key changes are made to the <code>OUser</code> class, such as an update that escalates user privileges.  You might use something like this,</p>
<pre><code class="language-js">db.liveQuery('LIVE SELECT FROM OUser')
   .on('live-update', function(data){
      var report = reportChange(data.content);
      console.log("Report:", report);
   });
</code></pre>
<p>When your application contains this code, any changes on the database that issue <a href="orientjs/../sql/SQL-Update.html"><code>UPDATE</code></a> queries to the <code>OUser</code> class are passed to the <code>reportChange()</code> function, which you can use to determine whether or not the changes are legitimate and if they're not, what you want it to do or who it should notify about suspicious activity.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientjs---select"><a class="header" href="#orientjs---select">OrientJS - <code>select()</code></a></h1>
<p>Selection queries in OrientJS are those used to fetch data from the database, so that you can operate on it with your application.  The method is comparable to the <a href="orientjs/../sql/SQL-Query.html"><code>SELECT</code></a> command in the OrientDB Console.</p>
<h2 id="working-with-selection-queries"><a class="header" href="#working-with-selection-queries">Working with Selection Queries</a></h2>
<p>In OrientJS, fetching data from the database uses the <code>select()</code> method.  The examples below operate on a database of baseball statistics, which has been initialized on the <code>db</code> variable.</p>
<h3 id="selecting-records"><a class="header" href="#selecting-records">Selecting Records</a></h3>
<p>Use the <code>select()</code> method to fetch records from the database.  For instance, say you want a lit of all players with a batting average of .300.</p>
<pre><code class="language-js">var hitters = db.select().from('Player')
   .where({
      ba: 0.3
   }).all()
   .then(
      function(select){
         console.log('Hitters:', select);
      }
   );
</code></pre>
<h3 id="searching-records"><a class="header" href="#searching-records">Searching Records</a></h3>
<p>Using the <code>containsText()</code> method, you can search records for specific strings.  For instance, say that a user would like information on a particular player, but does not remember the player's full name.  So, they want to fetch every player with the string <code>Ty</code> in their name.</p>
<pre><code class="language-js">var results = db.select().from('Player')
   .containsText({
      name: 'Ty'
   }).all()
   .then(
      function(select){
         console.log('Found Players:', select);
      }
   );
</code></pre>
<h3 id="using-expressions"><a class="header" href="#using-expressions">Using Expressions</a></h3>
<p>In the event that you would like to return only certain properties on the class or use OrientDB functions, you can pass the expression as an argument to the <code>select()</code> method.</p>
<p>For instance, say you want to know how many players threw right and batted left:</p>
<pre><code class="language-js">var count = db.select('count(*)').from('Player')
   .where({
      threw:  'right',
      batted: 'left'
   }).scalar()
   .then(
      function(select){
         console.log('Total:', select);
      }
   );
</code></pre>
<h3 id="returning-specific-fields"><a class="header" href="#returning-specific-fields">Returning Specific Fields</a></h3>
<p>Similar to expressions, by passing arguments to the method you can define a specific field that you want to return.  For instance, say you want to list the teams in your baseball database, such as in building links on a directory page.</p>
<pre><code class="language-js">var teams = db.select('name')
   .from('Teams').all()
   .then(
      function(select){
         console.log('Loading Teams:', select);
      }
   );
</code></pre>
<h3 id="specifying-default-values"><a class="header" href="#specifying-default-values">Specifying Default Values</a></h3>
<p>Occasionally, you may encounter issues where your queries return empty fields.  In the event that this creates issues for how your application renders data, you can define default values for certain fields as OrientJS sets them on the variable.</p>
<p>For instance, in the example of the baseball database, consider a case where for some historical players the data is either currently incomplete or entirely unavailable. Rather than serving null values, you can set default values using the <code>defaults()</code> method.</p>
<pre><code class="language-js">var player = db.select('name').from('Player')
   .defaults({
      throws: 'Unknown',
      bats: 'Unknown'
    }).all();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientjs---transform"><a class="header" href="#orientjs---transform">OrientJS - <code>transform()</code></a></h1>
<p>When working with queries in OrientJS, you may sometimes need to operate on data before setting it to the variable.  For instance, in cases where the data stored in the database is not in a format that suits your needs.  Transformation allows you to define functions within your application to update or alter the data as it comes in from the database.</p>
<h2 id="working-with-transformation-queries"><a class="header" href="#working-with-transformation-queries">Working with Transformation Queries</a></h2>
<p>In OrientJS, transformation operations are controlled through the <code>transform()</code> method as part of a larger query that fetches the data on which you want to operate.</p>
<h3 id="transforming-fields"><a class="header" href="#transforming-fields">Transforming Fields</a></h3>
<p>Most of the time, you may find that the data in the database is sufficient to your needs, save for the case of certain fields.  Using this method, you can define transformation functions for individual fields.</p>
<p>For instance, OrientDB stores the user status as a string in all caps, which you may find unsuitable as a return value to display on the user profile.</p>
<pre><code class="language-js">var user = db.select('name').from('OUser')
   .where({
      status: 'ACTIVE'
   }).transform({
      status: function(status){
         return status.toLowerCase();
      }
   }).limit(1).one()
   .then(
      function(select){
         console.log('User Status Transformed:', select.status);
      }
   );
</code></pre>
<p>In the <code>transform()</code> method, the <code>toLowerCase()</code> method operates on the return status to convert <code>ACTIVE</code> to <code>active</code>.</p>
<h3 id="transforming-records"><a class="header" href="#transforming-records">Transforming Records</a></h3>
<p>On occasion, you may need to operate on the entire record rather than individual fields.</p>
<pre><code class="language-js">var user = db.select('name').from('OUser')
   .where({
      status: 'ACTIVE'
   }).transform(
      function(record){
         return new User(record);
      }
   ).limit(1).one()
   .then(
      function(select){
         console.loog(
            'Is the user an instance of User?',
            (user.instanceof User)
         );
      }
   );
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientjs---traverse"><a class="header" href="#orientjs---traverse">OrientJS - <code>traverse()</code></a></h1>
<p>Traversal queries in OrientJS are those used to traverse records, crossing relationships.  This works in both Graph and Document Databases.  The method is comparable to the <a href="orientjs/../sql/SQL-Traverse.html"><code>TRAVERSE</code></a> command in the OrientDB Console.</p>
<blockquote>
<p>Bear in mind, in many cases you may find it sufficient to use the <a href="orientjs/OrientJS-Query-Select.html"><code>db.select()</code></a> method, which can result in shorter and faster queries.  For more information, see <a href="orientjs/../sql/SQL-Traverse.html#traverse-versus-select"><code>TRAVERSE</code> versus <code>SELECT</code></a>.</p>
</blockquote>
<h2 id="working-with-traversal-queries"><a class="header" href="#working-with-traversal-queries">Working with Traversal Queries</a></h2>
<p>In OrientJS, traversal operations use the <code>traverse()</code> method.  The example below uses a database of baseball statistics, which has been initialized on the <code>db</code> variable.</p>
<h3 id="traverse-all-records"><a class="header" href="#traverse-all-records">Traverse All Records</a></h3>
<p>The simplest use of the method is to traverse all records connected to a particular class.  For instance, say you want to see see all records associated with the Boston Red Sox, which has a Record ID of #12:45.</p>
<pre><code class="language-js">var records = db.traverse()
   .where({name: 'Boston Red Sox'})
   .all()
   .then(
      function(trav){
         console.log('Found Records:', trav);
      }
   );
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientjs---update"><a class="header" href="#orientjs---update">OrientJS - <code>update()</code></a></h1>
<p>Update queries in OrientJS are those used in changing or otherwise modifying existing records in the database.  The method is comparable to the <a href="orientjs/../sql/SQL-Update.html"><code>UPDATE</code></a> command on the OrientDB Console.</p>
<h2 id="working-with-update-queries"><a class="header" href="#working-with-update-queries">Working with Update Queries</a></h2>
<p>In OrientJS, updating records works through the <code>update()</code> method.  The examples below operate on a database of baseball statistics, which has been initialized on the <code>db</code> variable.</p>
<h3 id="updating-records-1"><a class="header" href="#updating-records-1">Updating Records</a></h3>
<p>When the record already exists in the database, you can update the content to modify the current values stored on the class.</p>
<p>Consider the case where you want to update player data after a game.  For instance, last night the Boston Red Sox played and you want to update the batting average for the player Tito Ortiz, who has a Record ID #12:97.  You've set the new batting average on the variable <code>newBA</code> and now you want to pass the new data to OrientDB.</p>
<pre><code class="language-js">db.update('#12:97')
   .set({
      ba: newBA
   }).one()
   .then(
      function(update){
         console.log('Records Updated:', update);
      }
   );
</code></pre>
<h3 id="putting-in-map-entries"><a class="header" href="#putting-in-map-entries">Putting in Map Entries</a></h3>
<p>When working with map fields, you sometimes need to put entries into map properties.  In the OrientDB Console, you can do this with the <code>PUT</code> clause, in OrientJS you can do so through the <code>put()</code> method.</p>
<pre><code class="language-js">db.update('#1:1')
   .put('mapProperty', {
      key: 'value',
      foo: 'bar'
   })
   .scalar()
   .then(
      function(update){
         console.log('Records Updated:', update);
      } 
   );
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="transactions-in-orientjs"><a class="header" href="#transactions-in-orientjs">Transactions in OrientJS</a></h1>
<p>Rather than writing out SQL commands to manage transactions, you can use the OrientJS Transaction Builder to construction transactions using a series of methods connected through the Database API.</p>
<h2 id="working-with-the-transaction-builder"><a class="header" href="#working-with-the-transaction-builder">Working with the Transaction Builder</a></h2>
<p>Transactions are built through a string of <code>let()</code> methods.  With each, define functions that execute commands on the database.  When the operation is complete, call the <code>commit()</code> method to commit your changes to the database.</p>
<p>Methods used in transactions include,</p>
<ul>
<li><strong><code>let()</code></strong> Method takes as arguments a name and a function that defines one operation in the transaction.  You can reference the name elsewhere in the transaction using the <code>$</code> symbol, (for instance, <code>$name</code>).</li>
<li><strong><code>commit()</code></strong> Method commits the transaction to the database.</li>
<li><strong><code>return()</code></strong> Method defines the transaction return value.</li>
</ul>
<p>For instance, this transaction adds vertices for Ty Cobb and the Detroit Tigers to the database, then defines an edge for the years in which Cobb played for the Tigers.</p>
<pre><code class="language-js">var trx = db.let('player', function(p){
      p.create('vertex', 'Player')
         .set({
            name:      'Ty Cobb',
            birthDate: '1886-12-18',
            deathDate: '1961-7-17',
            batted:    'left',
            threw:     'right'
         })
   })
   .let('team', function(t){
      t.create('vertex', 'Team')
         .set({
            name: 'Tigers',
            city: 'Detroit',
            state: 'Michigan'
         })
   })
   .let('career', function(c){
      c.create('edge', 'playsFor')
         .from('$player')
         .to('$team')
         .set({
            startYear: '1905',
            endYear:   '1926'
         })
   })
   .commit().return('$edge').all()
   .then(
      function(results){
         console.log(results);
      }
    );
</code></pre>
<h2 id="working-with-batch-scripts"><a class="header" href="#working-with-batch-scripts">Working with Batch Scripts</a></h2>
<p>In addition to the standard transactions, you can also execute raw batch scripts, without using the transaction builder.  These are the equivalent of <a href="orientjs/../sql/SQL-batch.html">SQL Batch</a> scripting in the OrientDB Console.</p>
<pre><code class="language-js">db.query('begin;'
   + 'let $t0 = SELECT FROM V LIMIT 1;'
   + 'return $t0'
   ,{class: 's'}).then(function(res){
      console.log(res);
   });

</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientjs-events"><a class="header" href="#orientjs-events">OrientJS Events</a></h1>
<p>On occasion, you may find the need to run additional code around queries outside of the standard query methods.  In OrientJS you can program events to run whenever queries begin and end.</p>
<p>You may find this useful in implementing logging functionality or profiling your system, or in initiating housekeeping tasks in response to certain types of queries.</p>
<h2 id="working-with-events"><a class="header" href="#working-with-events">Working with Events</a></h2>
<p>The method to create events is accessible through the <a href="orientjs/OrientJS-Database.html">Database API</a>, using <code>db.on()</code>.  The second argument defines the function it executes, the first the event that triggers the function.</p>
<h3 id="running-events-on-query-start"><a class="header" href="#running-events-on-query-start">Running Events on Query Start</a></h3>
<p>When you pass the <code>db.on()</code> method the string <code>beginQuery</code>, it executes the function argument whenever a query starts.  So, for instance, if your application executes the following query,</p>
<pre><code class="language-js">var query = db.select('name, status').from('OUser')
   .where({"status": "active"})
   .limit(1)
   .fetch({"role": 1})
   .one();
</code></pre>
<p>The function in <code>beginQuery</code> event receives an object that contains data on the query it's executing, this is similar to the data set on the <code>obj</code> variable below:</p>
<pre><code class="language-js">var obj = {
   query: 'SELECT name, status FROM OUser'
           + 'WHERE status = :paramstatus0 LIMIT 1',
   mode: 'a',
   fetchPlan: 'role:1',
   limit: -1,
   params: {
      params: {
         paramstatus0: 'active'
      }
   }
}
</code></pre>
<p>For instance, say that there is something wrong with your application and for the purposes of debugging, you want to log all queries made to the database.</p>
<pre><code class="language-js">db.on("beginQuery", function(obj){
   console.log('DEBUG: ', obj);
});
</code></pre>
<h3 id="running-events-on-query-end"><a class="header" href="#running-events-on-query-end">Running Events on Query End</a></h3>
<p>In addition to running your event code at the start of the query, by passing the <code>endQuery</code> string to the <code>db.on()</code> method, you can define a function to execute after the query finishes.</p>
<p>The function in <code>endQuery</code> events receives an object containing data about how the query ran, similar to the data set on the <code>obj</code> variable below:</p>
<pre><code class="language-js">var obj = {
   {
      "err": errObj,
      "result": resultObj,
      "perf": {
         "query": timeInMs
      },
      "input" : inputObj
   }
}
</code></pre>
<p>Where <code>inputObj</code> is the data used for the <code>beginQuery</code> event.</p>
<p>For instance, when debugging you might use this event to log errors and performance data to the console:</p>
<pre><code class="language-js">db.on("endQuery", function(obj){
   console.log("DEBUG: ", obj);
});
</code></pre>
<h3 id="running-events-on-live-queries"><a class="header" href="#running-events-on-live-queries">Running Events on Live Queries</a></h3>
<p>Beginning in version 2.1, OrientDB introduces Live Queries, which provides support for <a href="orientjs/../sql/SQL-Insert.html"><code>INSERT</code></a>, <a href="orientjs/../sql/SQL-Delete.html"><code>DELETE</code></a>, and <a href="orientjs/../sql/SQL-Update.html"><code>UPDATE</code></a> events to OrientJS applications.</p>
<p>Unlike other events, these are not set to the Database API itself, but rather through a <a href="orientjs/../sql/SQL-Live-Select.html"><code>LIVE SELECT</code></a> query that determines what records you want the application to monitor.</p>
<p>For more information and examples, see <a href="orientjs/OrientJS-Query-Live-Query.html"><code>liveQuery()</code></a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientjs---nodejs-driver-1"><a class="header" href="#orientjs---nodejs-driver-1">OrientJS - Node.js Driver</a></h1>
<p>Official <a href="http://www.orientechnologies.com/orientdb/">orientdb</a> driver for node.js. Fast, lightweight, uses the binary protocol.</p>
<p><a href="https://travis-ci.org/orientechnologies/orientjs"><img src="https://travis-ci.org/orientechnologies/orientjs.svg?branch=develop" alt="Build Status" /></a>
<a href="https://coveralls.io/github/orientechnologies/orientjs?branch=develop"><img src="https://coveralls.io/repos/github/orientechnologies/orientjs/badge.svg?branch=develop" alt="Coverage Status" /></a>
<a href="https://www.npmjs.com/package/orientjs"><img src="https://img.shields.io/npm/v/orientjs/beta.svg?style=flat-square" alt="npm version" /></a>
<a href="https://www.npmjs.com/package/orientjs"><img src="https://img.shields.io/npm/dm/orientjs.svg?style=flat-square" alt="npm downloads" /></a></p>
<p>NOTE: <em>Release v3.0 provides new APIs in order to support OrientDB 3.0 features</em>.</p>
<h2 id="features"><a class="header" href="#features">Features</a></h2>
<ul>
<li>Tested with latest OrientDB (2.2.x and 3.0.x).</li>
<li>Intuitive API, based on <a href="https://github.com/petkaantonov/bluebird">bluebird</a> promises.</li>
<li>Fast binary protocol parser.</li>
<li>Streaming Support</li>
<li>Stateful Transaction Support</li>
<li>Distributed Support</li>
<li>Access multiple databases via the same socket (Session Pooling).</li>
<li>Connection Pooling</li>
<li>Migration support.</li>
<li>Simple CLI.</li>
</ul>
<h2 id="versions-and-compatibility"><a class="header" href="#versions-and-compatibility">Versions and Compatibility</a></h2>
<p>OrientJS v3.0 contains backwards compatible APIs for OrientDB 2.2.x and OrientDB 3.0.x using the old protocol version 33 (<a href="orientjs/OrientJS-Legacy.html">Legacy</a>). New APIs are shipped in v3.0 to support the new protocol featuring Streaming, Stateful transactions, new SQL engine etc..</p>
<h2 id="resources-3"><a class="header" href="#resources-3">Resources</a></h2>
<ul>
<li><a href="http://orientdb.dev/docs/3.2.x/orientjs/OrientJS.html">API Docs</a></li>
<li><a href="https://github.com/orientechnologies/orientjs-example">Example Projects</a></li>
<li><a href="https://github.com/orientechnologies/orientjs/blob/master/CHANGELOG.md">Changelog</a></li>
</ul>
<h2 id="documentation-1"><a class="header" href="#documentation-1">Documentation</a></h2>
<ul>
<li><a href="orientjs/OrientJS.html#installation">Installation</a></li>
<li><a href="orientjs/OrientJS.html#quick-start">Quick Start</a></li>
<li><a href="orientjs/Reference.html">Reference</a></li>
</ul>
<h2 id="installation-8"><a class="header" href="#installation-8">Installation</a></h2>
<p>Install via npm.</p>
<pre><code class="language-sh">npm install orientjs
</code></pre>
<h2 id="quick-start"><a class="header" href="#quick-start">Quick Start</a></h2>
<h3 id="connect-to-orientdb"><a class="header" href="#connect-to-orientdb">Connect to OrientDB</a></h3>
<p>Use the <code>connect</code> function in order to create a new <code>OrientDBClient</code> instance.</p>
<pre><code class="language-js">const OrientDBClient = require("orientjs").OrientDBClient;

OrientDBClient.connect({
  host: "localhost",
  port: 2424
}).then(client =&gt; {
  return client.close();
}).then(()=&gt; {
   console.log("Client closed");
});
</code></pre>
<p>or with async/await</p>
<pre><code class="language-js">let client = await OrientDBClient.connect({
    host: "localhost",
    port: 2424
  });

await client.close();

console.log("Client Closed");
</code></pre>
<h4 id="single-session"><a class="header" href="#single-session">Single Session</a></h4>
<p>To open a new standalone session use the <code>client.session</code> api. This api will create a new stateful session associated with the given database and credentials. Once done, call <code>session.close</code> in order to release the session on the server. Session are stateful since OrientJS 3.0 as they can execute server side transactions.</p>
<pre><code class="language-js">client.session({ name: "demodb", username: "admin", password: "admin" })
.then(session =&gt; {
	// use the session
	... 
	// close the session
	return session.close();
});
</code></pre>
<p>or with async/await</p>
<pre><code class="language-js">let session = await client.session({ name: "demodb", username: "admin", password: "admin" });
// use the session
... 
// close the session
await session.close();
console.log("Session Closed");

</code></pre>
<h4 id="pooled-sessions"><a class="header" href="#pooled-sessions">Pooled Sessions</a></h4>
<p>Opening and closing sessions everytime can be expensive, since open and close require a network request to the server. Use the API <code>client.sessions</code> to create a pool of sessions with a given database and credentials. To get a session from the pool call the api <code>pool.acquire</code>. Once done with the session you can return the session to the pool by calling <code>session.close</code></p>
<pre><code class="language-js">// Create a sessions Pool
client.sessions({ name: "demodb", username: "admin", password: "admin", pool: { max: 10} })
  .then(pool =&gt; {
    // acquire a session
    return pool.acquire()
      .then(session =&gt; {
        // use the session
        ...
        // release the session
        return session.close();
      })
      .then(() =&gt; {
      	 // close the pool
        return pool.close();
      });
  });
});
</code></pre>
<p>or with async/await</p>
<pre><code class="language-js">// Create a sessions Pool
let pool = await client.sessions({
  name: "demodb",
  username: "admin",
  password: "admin",
  pool: { max: 10 }
});
// acquire a session from the pool
let session = await pool.acquire();
// use the session
//  ...
// release the session
await session.close();
// close the pool
await pool.close();
</code></pre>
<h3 id="session-api"><a class="header" href="#session-api">Session API</a></h3>
<p>Once you have initialized a session using the above APIs you can:</p>
<ul>
<li>Run a Query (Idempotent SQL statement)</li>
<li>Run a Command (Idempotent or non idempotent SQL statement)</li>
<li>Run a Transaction</li>
<li>Run a live query</li>
</ul>
<h4 id="query-1"><a class="header" href="#query-1">Query</a></h4>
<p>Streaming</p>
<pre><code class="language-js">session.query("select from OUser where name = :name", {params: { name: "admin" }})
.on("data", data =&gt; {
	console.log(data);
})
.on('error',(err)=&gt; {
  console.log(err);
})
.on("end", () =&gt; {
	console.log("End of the stream");
});
</code></pre>
<p>or use <code>.all</code> API that convert the stream to a Promise and collect the result set into an array.</p>
<pre><code class="language-js">session.query("select from OUser where name = :name", { params : {name: "admin" }})
.all()
.then((results)=&gt; {
	console.log(results);
});
</code></pre>
<p>or with async/await</p>
<pre><code class="language-js">try {
  let result = await session.query("select from OUser where name = :name", {params: { name: "admin" }})
    .all();
  console.log(result);
} catch (err) {
  console.log(err);
}
</code></pre>
<h4 id="command-1"><a class="header" href="#command-1">Command</a></h4>
<pre><code class="language-js">session.command("insert into V set name = :name", {params: { name: "test" }})
.all()
.then(result =&gt; {
	console.log(result);
});
</code></pre>
<p>or with async/await</p>
<pre><code class="language-js">try {
  let result = session.command("insert into V set name = :name", {params: { name: "test" }})
    .all();
  console.log(result);
} catch (err) {
  console.log(err);
}
</code></pre>
<h4 id="transaction"><a class="header" href="#transaction">Transaction</a></h4>
<p>Use the api session.runInTransaction in order to run a unit of work in a managed transaction (begin/commit/retry)
The unit of work should return a Promise.</p>
<pre><code class="language-js">session.runInTransaction((tx)=&gt;{
	return tx.command("insert into V set name = :name", {params: { name: "test" }}).all()
}).then(({result,tx}) =&gt; {
	console.log(result);
	console.log(tx);
});
</code></pre>
<p>or with async/await</p>
<pre><code class="language-js">try {
  let { result, tx } = await session.runInTransaction(tx =&gt; {
    return tx
      .command("insert into V set name = :name", { params: { name: "test" } })
      .all();
  });
  console.log(result);
  console.log(tx);
} catch (e) {
  console.log(e);
}
</code></pre>
<h4 id="live-queries-4"><a class="header" href="#live-queries-4">Live Queries</a></h4>
<pre><code class="language-js">session.liveQuery("select from V").on("data", data =&gt; {
	console.log(data);
});
</code></pre>
<h2 id="building-from-the-source-code-1"><a class="header" href="#building-from-the-source-code-1">Building from the Source Code</a></h2>
<p>When building from source code, you need to download the driver directly from <a href="https://github.com/orientechnologies/orientjs">GitHub</a>, then run NPM against the branch you want to use or test.</p>
<ol>
<li>
<p>Using Git, clone the package repository, then enter the new directory:</p>
<pre>
$ <code class="lang-sh userinput">git clone https://github.com/orientechnologies/orientjs.git</code>
$ <code class="lang-sh userinput">cd orientjs</code>
</pre>
</li>
<li>
<p>When you clone the repository, Git automatically provides you with the current state of the <code>master</code> branch.  If you would like to work with another branch, like <code>develop</code> or test features on past releases, you need to check out the branch you want.  For instance,</p>
<pre>
$ <code class="lang-sh userinput">git checkout develop</code>
</pre>
</li>
<li>
<p>Once you've selected the branch you want to build, call NPM to handle the installation.</p>
<pre>
$ <code class="lang-sh userinput">npm install</code>
</pre>
</li>
<li>
<p>Run the tests to make sure it works:</p>
<pre>
$ <code class="lang-sh userinput">npm test</code>
</pre>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><ul>
<li><a href="orientjs/Client.html">Client API</a>
<ul>
<li><a href="orientjs/Client.html#connecting">Connecting</a></li>
<li><a href="orientjs/Client.html#databases-manipulation">Databases Manipulation</a></li>
<li><a href="orientjs/Client.html#sessions">Sessions Access</a></li>
</ul>
</li>
<li><a href="orientjs/Session.html">Session API</a>
<ul>
<li><a href="orientjs/Session.html#query">Query</a></li>
<li><a href="orientjs/Session.html#command">Command</a></li>
<li><a href="orientjs/Session.html#batch-script">Batch Script</a></li>
<li><a href="orientjs/Session.html#transactions">Transactions</a></li>
<li><a href="orientjs/Session.html#live-queries">Live Queries</a></li>
<li><a href="orientjs/Session.html#query-builder">Query Builder</a></li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="client-api"><a class="header" href="#client-api">Client API</a></h1>
<p>The <code>OrientDBClient</code> is the entry point of the driver. Once connected it provides APIs for databases manipulation and sessions creation</p>
<h3 id="connecting"><a class="header" href="#connecting">Connecting</a></h3>
<p>Use the method <code>OrientDBClient.connect</code> to establish a connection to one OrientDB server/cluster. The methods return a Promise. Below an example of a connection to a single OrientDB server.</p>
<pre><code class="language-js">const OrientDBClient = require("orientjs").OrientDBClient;

OrientDBClient.connect({
  host: "localhost",
  port: 2424
}).then(client =&gt; {
  return client.close();
}).then(()=&gt; {
   console.log("Client closed");
});
</code></pre>
<p>or with async/await</p>
<pre><code class="language-js">const OrientDBClient = require("orientjs").OrientDBClient;

(async function() {
  let client;
  try {
    client = await OrientDBClient.connect({ host: "localhost" });
    console.log("Connected");
  } catch (e) {
    console.log(e);
  }

  if (client) {
    await client.close();
    console.log("Disconnected");
  }
})();
</code></pre>
<h4 id="configuration-with-orientdb-cluster"><a class="header" href="#configuration-with-orientdb-cluster">Configuration with OrientDB Cluster</a></h4>
<p>To do so, define the servers configuration parameter when you initialize the server connection. OrientJS uses these as alternate hosts in the event that it encounters an error while connecting to the primary host.</p>
<p>When using this method, the only requisite is that at least one of these servers must be online when the application attempts to establish its first connection. Below an example of a connection with two servers.</p>
<pre><code class="language-js">
const OrientDBClient = require("orientjs").OrientDBClient;

OrientDBClient.connect({
  host: "localhost",
  port: 2424,
  servers : [{host : "localhost", port : 2425}]
}).then(client =&gt; {
  return client.close();
}).then(()=&gt; {
   console.log("Client closed");
});

</code></pre>
<p>or with async/await</p>
<pre><code class="language-js">const OrientDBClient = require("orientjs").OrientDBClient;

(async function() {
  let client;
  try {
    client = await OrientDBClient.connect({
      host: "localhost",
      port: 2424,
      servers: [{ host: "localhost", port: 2425 }]
    });
    console.log("Connected");
  } catch (e) {
    console.log(e);
  }

  if (client) {
    await client.close();
    console.log("Disconnected");
  }
})();

</code></pre>
<p>The only prerequisite when executing this code is that at least one of the hosts, primary or secondary, be online at the time that it first runs. Once it has established this initial connection, OrientJS keeps the list up to date with those servers in the cluster that are currently online. It manages this through the push notifications that OrientDB sends to connected clients when changes occur in cluster membership.</p>
<h4 id="connection-pooling"><a class="header" href="#connection-pooling">Connection Pooling</a></h4>
<p>By default OrientJS create a connection pool of 5 sockets. Use the paramenter <code>pool</code> in order to change the default configuration.</p>
<pre><code class="language-js">const OrientDBClient = require("orientjs").OrientDBClient;

OrientDBClient.connect({
  host: "localhost",
  port: 2424,
  pool : { max : 10}
}).then(client =&gt; {
  return client.close();
}).then(()=&gt; {
   console.log("Client closed");
});
</code></pre>
<p>or with async/await</p>
<pre><code class="language-js">const OrientDBClient = require("orientjs").OrientDBClient;

(async function() {
  let client;
  try {
    client = await OrientDBClient.connect({
      host: "localhost",
      port: 2424,
      pool : { max : 10}
    });
    console.log("Connected");
  } catch (e) {
    console.log(e);
  }

  if (client) {
    await client.close();
    console.log("Disconnected");
  }
})();

</code></pre>
<h3 id="databases-manipulation"><a class="header" href="#databases-manipulation">Databases Manipulation</a></h3>
<p>Once you have initialized the client variable in your application, you can use it to work with the OrientDB Server, such as creating new databases on the server. It also provides methods to initialize the OrientJS Sessions API, which are covered in more detail below.</p>
<h4 id="create-a-database"><a class="header" href="#create-a-database">Create a database</a></h4>
<p>In the event that you need to create a database on OrientDB, you can do so through the OrientDBClient API using the <code>client.createDatabase </code> method.</p>
<pre><code class="language-js">client.createDatabase({
	name: "test",
	username: "root",
	password: "root"
})
.then(() =&gt; {
	console.log("Database created");
})
.catch(err =&gt; {
	console.log("Error creating database");
});
</code></pre>
<p>or with async/await</p>
<pre><code class="language-js">try {
  await client.createDatabase({
    name: "test",
    username: "root",
    password: "root"
  });
  console.log("Database created");
} catch (e) {
  console.log(e);
}
</code></pre>
<h4 id="check-existence-of-a-databases"><a class="header" href="#check-existence-of-a-databases">Check existence of a databases</a></h4>
<pre><code class="language-js">client.existsDatabase({
	name: "test",
	username: "root",
	password: "root"
})
.then(result =&gt; {
	console.log(result);
})
.catch(err =&gt; {
	console.log("Error checking for database");
});
</code></pre>
<p>or with async/await</p>
<pre><code class="language-js">try {
  let exists = await client.existsDatabase({
    name: "test",
    username: "root",
    password: "root"
  });
  console.log(exists);
} catch (e) {
  console.log(e);
}

</code></pre>
<h4 id="list-databases"><a class="header" href="#list-databases">List Databases</a></h4>
<pre><code class="language-js">client.listDatabases({
	username: "root",
	password: "root"
})
.then(results =&gt; {
	console.log(results);
})
.catch(err =&gt; {
	console.log("Error listing databases");
});
</code></pre>
<p>or with async/await</p>
<pre><code class="language-js">try {
  let databases = await client.listDatabases({
    name: "test",
    username: "root",
    password: "root"
  });
  console.log(databases);
} catch (e) {
  console.log(e);
}
</code></pre>
<h4 id="drop-a-database"><a class="header" href="#drop-a-database">Drop a database</a></h4>
<pre><code class="language-js">client.dropDatabase({
	name: "test",
	username: "root",
	password: "root"
})
.then(() =&gt; {
	console.log("Database dropped");
})
.catch(err =&gt; {
	console.log("Error dropping the database");
});
</code></pre>
<p>or with async/await</p>
<pre><code class="language-js">try {
  await client.dropDatabase({
    name: "test",
    username: "root",
    password: "root"
  });
} catch (e) {
  console.log(e);
}
</code></pre>
<h3 id="sessions"><a class="header" href="#sessions">Sessions</a></h3>
<p>Once you have initialized the client variable in your application, you can use it to open sessions on OrientDB Server.
You can either open a single session with the API <code>client.session</code> or request a pool of sessions with the API <code>client.sessions</code>.
Then use the <a href="orientjs/Session.html">Session API</a> to interact with the database.</p>
<h4 id="single-session-1"><a class="header" href="#single-session-1">Single Session</a></h4>
<p>To open a new standalone session use the <code>client.session</code> api. This api will create a new stateful session associated with the given database and credentials. Once done, call <code>session.close</code> in order to release the session on the server. Session are stateful since OrientJS 3.0 as they can execute server side transactions.</p>
<pre><code class="language-js">client.session({ name: "demodb", username: "admin", password: "admin" })
.then(session =&gt; {
	// use the session
	... 
	// close the session
	return session.close();
});
</code></pre>
<p>or with async/await</p>
<pre><code class="language-js">try {
  let session = await client.session({
    name: "demodb",
    username: "admin",
    password: "admin"
  });
  // use session

  //close session
  await session.close();
} catch (e) {
  console.log(e);
}
</code></pre>
<h4 id="pool-of-sessions"><a class="header" href="#pool-of-sessions">Pool of Sessions</a></h4>
<p>Opening and closing sessions everytime can be expensive, since open and close require a network request to the server. Use the API <code>client.sessions</code> to create a pool of sessions with a given database and credentials. To get a session from the pool call the api <code>pool.acquire</code>. Once done with the session you can return the session to the pool by calling <code>session.close</code>.</p>
<p>By default the pool size is is 5 sessions. Use the <code>pool</code> parameter to change this default configuration.</p>
<pre><code class="language-js">// Create a sessions Pool
client.sessions({ name: "demodb", username: "admin", password: "admin", pool: { max: 10} })
  .then(pool =&gt; {
    // acquire a session
    return pool.acquire()
      .then(session =&gt; {
        // use the session
        ...
        // release the session
        return session.close();
      })
      .then(() =&gt; {
      	 // close the pool
        return pool.close();
      });
  });
});
</code></pre>
<pre><code class="language-js">try {
  let pool = await client.sessions({
    name: "demodb",
    username: "admin",
    password: "admin"
  });
  // acquire a session
  let session = await pool.acquire();
  // use the session

  //close/release session
  await session.close();
  
  // close pool
  await pool.close();
} catch (e) {
  console.log(e);
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="session-api-1"><a class="header" href="#session-api-1">Session API</a></h1>
<p>A Session instance can be used for:</p>
<ul>
<li>Run a Query (Idempotent SQL statement)</li>
<li>Run a Command (Idempotent or non idempotent SQL statement)</li>
<li>Run a Batch Script</li>
<li>Execute a Transaction</li>
<li>Execute a live query</li>
<li>Use query builder</li>
</ul>
<p>To obtain a Session instance use the <a href="orientjs/Client.html#sessions">Client APIs</a>.</p>
<blockquote>
<p>By convention, the variable on which you initialize the Session API is called session. This designation is arbitrary and used only for convenience.</p>
</blockquote>
<h2 id="query-2"><a class="header" href="#query-2">Query</a></h2>
<p>The <code>session.query</code> method executes an idempotent SQL query against the opened database. You can either define these values directly in SQL, or define arbitrary parameters through additional arguments.
The API call returns an extension of Node.js Streams.</p>
<h3 id="streaming"><a class="header" href="#streaming">Streaming</a></h3>
<pre><code class="language-js">session.query("select from OUser where name = :name", {params: { name: "admin" }})
	.on("data", data =&gt; {
		console.log(data);
	})
	.on('error',(err)=&gt; {
	  console.log(err);
	})
	.on("end", () =&gt; {
		console.log("End of the stream");
	});
</code></pre>
<h3 id="to-promise"><a class="header" href="#to-promise">To Promise</a></h3>
<p>Use <code>.all</code> API that convert the stream to a Promise and collect the result set into an array</p>
<pre><code class="language-js">session.query("select from OUser where name = :name", { params : {name: "admin" }})
.all()
.then((results)=&gt; {
	console.log(results);
});
</code></pre>
<p>or with async/await</p>
<pre><code class="language-js">try {
	let results = await session
	.query("select from OUser where name = :name", {
		params: { name: "admin" }
	})
	.all();
	console.log(results);
} catch (e) {
	console.log(e);
}
</code></pre>
<p>Alternatively use <code>.one</code> API for the first entry only</p>
<pre><code class="language-js">session.query("select from OUser where name = :name", { params : {name: "admin" }})
.one()
.then((results)=&gt; {
	console.log(results);
});
</code></pre>
<p>or with async/await</p>
<pre><code class="language-js">try {
	let results = await session
	.query("select from OUser where name = :name", {
		params: { name: "admin" }
	})
	.one();
	console.log(results);
} catch (e) {
	console.log(e);
}
</code></pre>
<h2 id="command-2"><a class="header" href="#command-2">Command</a></h2>
<p>The <code>session.command</code> method executes a SQL query against the opened database and accept non idempotent queries like <code>insert into</code>, <code>create vertex</code> etc.
The API call returns an extension of Node.js Streams.</p>
<pre><code class="language-js">session.command("insert into V set name = :name", {params: { name: "test" }})
.all()
.then(result =&gt; {
	console.log(result);
});
</code></pre>
<p>or with async/await</p>
<pre><code class="language-js">try {
	let results = await session
	.command("insert into V set name = :name", { params: { name: "test" } })
	.all();
	console.log(results);
} catch (e) {
	console.log(e);
}
</code></pre>
<h2 id="batch-script"><a class="header" href="#batch-script">Batch Script</a></h2>
<p>The <code>batch</code> method executes a Multiple SQL query against the opened database.
The API call returns an extension of Node.js Streams.</p>
<pre><code class="language-js">let batch = `begin;
	let $v1 = create vertex V set name = "first";
	let $v2 = create vertex V set name = "second";
	let $e = create edge E from $v1 to $v2;
	commit;
	return  $e;`;
	
session.batch(batch).all()
  .then(results =&gt; {
    console.log(results);
  });
</code></pre>
<p>or with async/await</p>
<pre><code class="language-js">try {
	let batch = `begin;
	let $v1 = create vertex V set name = "first";
	let $v2 = create vertex V set name = "second";
	let $e = create edge E from $v1 to $v2;
	commit;
	return  $e;`;

	let results = await session.batch(batch).all();
	console.log(results);
} catch (e) {
	console.log(e);
}
</code></pre>
<h2 id="querycommandscript-options"><a class="header" href="#querycommandscript-options">Query/Command/Script Options</a></h2>
<p>Those APIs accepts an options object as second parameter.</p>
<p>The options can contains:</p>
<ul>
<li>Query parameters</li>
<li>Additional Configuration</li>
</ul>
<h3 id="using-parameters-1"><a class="header" href="#using-parameters-1">Using Parameters</a></h3>
<p>The options object can contain a <code>params</code> property that represent the query parameters to use.</p>
<h4 id="named-parameters-1"><a class="header" href="#named-parameters-1">Named parameters</a></h4>
<pre><code class="language-js">session.command("insert into V set name = :name", {params: { name: "test" }})
.all()
.then(result =&gt; {
	console.log(result);
});
</code></pre>
<h4 id="positional-parameters-1"><a class="header" href="#positional-parameters-1">Positional parameters</a></h4>
<pre><code class="language-js">session.command("insert into V set name = ?", {params: ["admin"]})
.all()
.then(result =&gt; {
	console.log(result);
});
</code></pre>
<h3 id="additional-configuration"><a class="header" href="#additional-configuration">Additional configuration</a></h3>
<p>Starting from OrientDB 3.0, the result set from a query/command/script is paginated. By default OrientJS uses a page size of <code>100</code> records.
Use the additional property <code>pageSize</code> to tune this configuration.</p>
<pre><code class="language-js">session.command("select name from V", {
	params: ["admin"],
	pageSize: 1000
})
.all()
.then(results =&gt; {
	console.log(results);
});
</code></pre>
<h2 id="transactions-6"><a class="header" href="#transactions-6">Transactions</a></h2>
<p>Use the api <code>session.runInTransaction</code> in order to run a unit of work in a managed transaction (begin/commit/retry). The unit of work provided in input should return a Promise. The return of <code>session.runInTransaction</code> is a Promise that once resolved, returns the result of the last operation in the unit of work and the result of the <code>commit</code> of the transaction.</p>
<blockquote>
<p>The Session supports only 1 transaction at time.
Use multiple sessions if you want to run concurrent transactions.</p>
</blockquote>
<pre><code class="language-js">session.runInTransaction((tx)=&gt;{
	return tx.command("insert into V set name = :name", {params: { name: "test" }})
	.all();
}).then(({result,tx}) =&gt; {
	console.log(result);
	console.log(tx);
});
</code></pre>
<p>alternatively using explicit API</p>
<pre><code class="language-js">session.begin();
session.command("insert into V set name = :name", {
	params: { name: "admin" }})
	.one()
	.then(results =&gt; {
		console.log(results);
		return session.commit();
	})
	.then(results =&gt; {
		console.log(results);
	});
</code></pre>
<h2 id="live-queries-5"><a class="header" href="#live-queries-5">Live Queries</a></h2>
<p>When using traditional queries, such as those called with <code>session.query()</code> and <code>session.select()</code> you only get data that is current at the time the query is issued.  Beginning in version 2.1, OrientDB now supports <a href="orientjs/../java/Live-Query.html">Live Queries</a>, where in issuing the query you tell OrientDB you want it to push affecting changes to your application.</p>
<p>You can execute Live Queries using the <code>session.liveQuery()</code> method with a <a href="orientjs/../sql/SQL-Live-Select.html"><code>LIVE SELECT</code></a> statement passed as its argument.</p>
<h3 id="understanding-live-queries-2"><a class="header" href="#understanding-live-queries-2">Understanding Live Queries</a></h3>
<p>Traditional queries provide you with information that is current at the time the query is issued.  In most cases, such as well pulling statistical data on long-dead ball players like Ty Cobb, this behavior is sufficient to your needs.  But, what if about when you need real time information.</p>
<p>For instance, what if in addition to historical data you also want your application to serve real-time information about baseball games as they're being played.</p>
<p>With the traditional query, you would have to reissue the query within a set interval to update the application.  Live Queries allow you to register events, so that your application performs addition operations in the event of an <a href="orientjs/../sql/SQL-Insert.html"><code>INSERT</code></a>, <a href="orientjs/../sql/SQL-Delete.html"><code>DELETE</code></a>, or <a href="orientjs/../sql/SQL-Update.html"><code>UPDATE</code></a>.</p>
<p>For example, say that you have a web application that uses the baseball database.  The application serves the current score and various other stats for the game.  Whenever your back-end system inserts new records for the game, you can execute a function to update the display information.</p>
<h3 id="working-with-live-queries-1"><a class="header" href="#working-with-live-queries-1">Working with Live Queries</a></h3>
<p>In OrientJS, Live Queries are called using the <code>session.liveQuery()</code> method.  This is similar to <code>session.query()</code> in that you use it to issue the raw SQL of a <a href="orientjs/../sql/SQL-Live-Select.html"><code>LIVE SELECT</code></a> statement.  You can assign event handlers to <code>session.liveQuery</code> using the <code>on('data')</code> method. The methods returns an extension of Node.JS Streams</p>
<p>For instance,</p>
<pre><code class="language-js">session.liveQuery("select from V").on("data", data =&gt; {
	console.log(data);
});
</code></pre>
<p>The data object is emitted every time the live query is matched and it contains those properties</p>
<ul>
<li><strong>monitorId</strong> : identifier of the live query on the server.</li>
<li><strong>operation</strong> : identifier of the operation executed
<ul>
<li>1 - Create</li>
<li>2 - Update</li>
<li>3 - Delete</li>
</ul>
</li>
<li><strong>data</strong> : the actual matched record.</li>
<li><strong>before</strong> : in case of update, the previously version of the record changed.</li>
</ul>
<pre><code class="language-JSON">{ 
	monitorId: 275616756,
	operation: 1,
	data:
  		{ 
  			name: 'Foo',
     		'@rid': RecordID { cluster: 10, position: 12 },
     		'@class': 'V',
     		'@version': 1 
     	} 
}
</code></pre>
<h3 id="unsubscribing-live-queries"><a class="header" href="#unsubscribing-live-queries">Unsubscribing Live Queries</a></h3>
<p>To unsubscribe a live query, use the API <code>handle.unsubscribe</code> where
<code>handle</code> is the returned value of the <code>liveQuery</code> function</p>
<pre><code class="language-js">let handle = session.liveQuery("select from V").on("data", data =&gt; {
	console.log(data);
	handle.unsubscribe();
});
</code></pre>
<h2 id="query-builder-1"><a class="header" href="#query-builder-1">Query Builder</a></h2>
<p>Rather than writing out query strings in SQL, you can alternatively use the OrientJS Query Builder to construct queries using a series of methods connected through the Database API.</p>
<ul>
<li><strong>create</strong>: Creates vertices and edges.</li>
<li><strong>insert</strong>: Insert records</li>
<li><strong>update</strong>: Modifies records on database.</li>
<li><strong>delete</strong>: Removes vertices, edges, and records.</li>
<li><strong>select</strong>: Fetches records by query.</li>
</ul>
<h3 id="create"><a class="header" href="#create">Create</a></h3>
<p>Creation queries in OrientJS are those used in creating vertex and edge records on a Graph Database. Given the added complexity of regular or lightweight edges running between the vertices, adding records is a little more complicated than the insert() method you might use otherwise.</p>
<p>The creation query method is comparable to the <a href="orientjs/../sql/SQL-Create-Vertex.html"><code>CREATE VERTEX</code></a> and <a href="orientjs/../sql/SQL-Create-Edge.html"><code>CREATE EDGE</code></a> commands on the OrientDB Console.</p>
<p>In OrientJS, creating vertices and edges uses the create() method. The examples below operate on a database of baseball statistics, which has been initialized on the db variable.</p>
<h4 id="creating-vertices-4"><a class="header" href="#creating-vertices-4">Creating Vertices</a></h4>
<p>Create an empty vertex on the <code>Player</code> vertex class:</p>
<pre><code class="language-js">session.create("VERTEX", `Player`).one()
	.then(results =&gt; {
		console.log(results);
	});
</code></pre>
<p>Create a vertex with properties:</p>
<pre><code class="language-js">session.create("VERTEX", "Player")
	.set({
		name: "Ty Cobb",
		birthDate: "1886-12-18",
		deathDate: "1961-7-17",
		batted: "left",
		threw: "right"
	})
	.one()
	.then((player)=&gt; {
		console.log(player);
	});
</code></pre>
<h4 id="creating-edges-5"><a class="header" href="#creating-edges-5">Creating Edges</a></h4>
<p>Creating edges to connect two vertices follows the same pattern as creating vertices, with the addition of <code>from()</code> and <code>to()</code> methods to show the edge direction.</p>
<p>For instance, consider an edge class <code>PlaysFor</code> that you use to connect player and team vertices.  Using it, you might create a simple edge that simply establishes the connection:</p>
<pre><code class="language-js">session.create("EDGE", "PlaysFor")
	.from("#12:12").to("#12:13")
	.one()
	.then(edge =&gt; {
		console.log(edge);
	});
</code></pre>
<p>This creates an edge between the player Ty Cobb, (#12:12), and the Detroit Tigers, (#12:13).  While this approach may be useful with players that stay with the same team, many don't.  In order to account for this, you would need to define properties on the edge.</p>
<pre><code class="language-js">session.create("EDGE", "PlaysFor")
	.from("#12:12").to("#12:13")
	.set({
		startYear: "1905",
		endYear: "1926"
	})
	.one()
	.then(edge =&gt; {
		console.log(edge);
	});
</code></pre>
<p>Now, whenever you build queries to show the players for a team, you can include conditionals to only show what teams they played for in a given year.</p>
<h3 id="insert-1"><a class="header" href="#insert-1">Insert</a></h3>
<p>Insertion queries in OrientJS are those that add records of a given class into the database.  The insertion query method is comparable to the <a href="orientjs/../sql/SQL-Insert.html"><code>INSERT</code></a> commands on the OrientDB Console.</p>
<p>Example</p>
<p>In OrientJS, inserting data into the database uses the <code>insert()</code> method.  For instance, say that you want to add batting averages, runs and runs batted in for Ty Cobb.</p>
<pre><code class="language-js">session.insert().into("Player")
	.set({
		ba: 0.367,
		r: 2246,
		rbi: 1938
	})
	.one()
	.then((player) =&gt; {
		console.log(player);
	});
</code></pre>
<h5 id="raw-expressions-1"><a class="header" href="#raw-expressions-1">Raw Expressions</a></h5>
<pre><code>session.insert().into('Player')
	.set({
		uuid : session.rawExpression("format('%s',uuid())"),
	  	ba:  0.367,
	  	r:   2246,
	  	rbi: 1938
	}).one().then((player)=&gt;{
	   console.log(player)
	});
</code></pre>
<p>Generated Query</p>
<pre><code class="language-SQL">INSERT INTO Player SET uuid = format('%s',uuid()), ba = 0.367, r = 2246, rbi = 1938

</code></pre>
<h3 id="update-2"><a class="header" href="#update-2">Update</a></h3>
<p>Update queries in OrientJS are those used in changing or otherwise modifying existing records in the database.  The method is comparable to the <a href="orientjs/../sql/SQL-Update.html"><code>UPDATE</code></a> command on the OrientDB Console.</p>
<p>In OrientJS, updating records works through the <code>update()</code> method.  The examples below operate on a database of baseball statistics, which has been initialized on the <code>session</code> variable.</p>
<h3 id="updating-records-2"><a class="header" href="#updating-records-2">Updating Records</a></h3>
<p>When the record already exists in the database, you can update the content to modify the current values stored on the class.</p>
<p>Consider the case where you want to update player data after a game.  For instance, last night the Boston Red Sox played and you want to update the batting average for the player Tito Ortiz, who has a Record ID #12:97.</p>
<pre><code>session.update("#12:97")
	.set({
		ba: 3.1
	})
	.one()
	.then(update =&gt; {
		console.log("Records Updated:", update);
	});
</code></pre>
<p>If you don't know the RecordID, alternatively and more likely you can update with a where condition, for example on the name of the player.</p>
<pre><code class="language-js">session.update("Player")
	.set({
		ba: 3.1
	})
	.where({ name: "Ty Cobb" })
	.one()
	.then(update =&gt; {
		console.log("Records Updated:", update);
	});
</code></pre>
<h3 id="delete-1"><a class="header" href="#delete-1">Delete</a></h3>
<p>Deletion queries in OrientJS are those used in removing records from the database.  It can also account for edges between vertices, updating the graph to maintain its consistency.</p>
<p>The deletion query method is comparable to <a href="orientjs/../sql/SQL-Delete.html"><code>DELETE</code></a>, <a href="orientjs/../sql/SQL-Delete-Vertex.html"><code>DELETE VERTEX</code></a> and the <a href="orientjs/../sql/SQL-Delete-Edge.html"><code>DELETE EDGE</code></a> statements.</p>
<p>In OrientJS, deletions use the <code>delete()</code> method.  The examples below operate on a database of baseball statistics, which has been initialized on the <code>session</code> variable.</p>
<h4 id="deleting-vertices-1"><a class="header" href="#deleting-vertices-1">Deleting Vertices</a></h4>
<p>With Graph Databases, deleting vertices is a little more complicated than the normal process of deleting records. You need to tell OrientDB that you want to delete a vertex to ensure that it takes the additional steps necessary to update the connecting edges.</p>
<p>For instance you want to remove the player Ty Cobb.</p>
<pre><code class="language-js">session.delete("VERTEX", "Player")
	.where({ name: "Ty Cobb" })
	.one()
	.then((del)=&gt; {
		console.log("Records Deleted: " + del);
	});
</code></pre>
<h4 id="deleting-edges-1"><a class="header" href="#deleting-edges-1">Deleting Edges</a></h4>
<p>When deleting edges, you need to define the vertices that the edge connects.  For instance, consider the case where you have a bad entry on the <code>playsFor</code> edge, where you have Ty Cobb assigned to the Chicago Cubs.  Ty Cobb has a Record ID of #12:12, the Chicago Cubs #12:54.</p>
<pre><code class="language-js">session.delete('EDGE', 'PlaysFor')
	.from('#12:12').to('#12:54')
	.one()
	.then((del)=&gt;{
	     console.log('Records Deleted: ' + del);
	  }
	);
</code></pre>
<h4 id="deleting-records-2"><a class="header" href="#deleting-records-2">Deleting Records</a></h4>
<p>In order to delete records in a given class, you need to define a conditional value that tells OrientDB the specific records in the class that you want to delete.  When working from the Console, you would use the <a href="orientjs/../sql/SQL-Where.html"><code>WHERE</code></a> clause.  In OrientJS, set the <code>where()</code> method.</p>
<pre><code class="language-js">session.delete().from('Player')
	.where('@rid = #12:84').limit(1).scalar()
	.then((del)=&gt;{
	     console.log('Records Deleted: ' + del);
	  }
	);
</code></pre>
<h3 id="select-1"><a class="header" href="#select-1">Select</a></h3>
<p>Selection queries in OrientJS are those used to fetch data from the database, so that you can operate on it with your application.  The method is comparable to the <a href="orientjs/../sql/SQL-Query.html"><code>SELECT</code></a> command in the OrientDB Console.</p>
<p>In OrientJS, fetching data from the database uses the <code>select()</code> method.  The examples below operate on a database of baseball statistics, which has been initialized on the <code>db</code> variable.</p>
<h4 id="selecting-records-1"><a class="header" href="#selecting-records-1">Selecting Records</a></h4>
<p>Use the <code>select()</code> method to fetch records from the database.  For instance, say you want a lit of all players with a batting average of .300.</p>
<pre><code class="language-js">session.select().from("Player")
	.where({
		ba: 0.3
	})
	.all()
	.then(function(select) {
		console.log("Hitters:", select);
	});
</code></pre>
<h4 id="custom-where"><a class="header" href="#custom-where">Custom Where</a></h4>
<p>The where clause can take a JSON object for expressing condition.
For more complex condition the where clause can take a string with
custom conditions and pass eventual parameters in one of the selected
query terminator (one/all/stream/scalar)</p>
<pre><code class="language-js">session.select().from("Player")
	.where("ba &gt;= :ba")
	.all({ ba : 0.3})
	.then((select) =&gt; {
		console.log("Hitters:", select);
	});
</code></pre>
<h4 id="using-expressions-1"><a class="header" href="#using-expressions-1">Using Expressions</a></h4>
<p>In the event that you would like to return only certain properties on the class or use OrientDB functions, you can pass the expression as an argument to the <code>select()</code> method.</p>
<p>For instance, say you want to know how many players threw right and batted left:</p>
<pre><code class="language-js">session.select("count(*)").from("Player")
	.where({
		threw: "right",
		batted: "left"
	})
	.scalar()
	.then((select) =&gt; {
		console.log("Total:", select);
	});
</code></pre>
<h4 id="returning-specific-fields-1"><a class="header" href="#returning-specific-fields-1">Returning Specific Fields</a></h4>
<p>Similar to expressions, by passing arguments to the method you can define a specific field that you want to return.  For instance, say you want to list the teams in your baseball database, such as in building links on a directory page.</p>
<pre><code class="language-js">session.select("name").from("Teams")
	.all()
	.then((select)=&gt; {
		console.log("Loading Teams:", select);
	});
</code></pre>
<h4 id="specifying-default-values-1"><a class="header" href="#specifying-default-values-1">Specifying Default Values</a></h4>
<p>Occasionally, you may encounter issues where your queries return empty fields.  In the event that this creates issues for how your application renders data, you can define default values for certain fields as OrientJS sets them on the variable.</p>
<p>For instance, in the example of the baseball database, consider a case where for some historical players the data is either currently incomplete or entirely unavailable. Rather than serving null values, you can set default values using the <code>defaults()</code> method.</p>
<pre><code class="language-js">session.select("name").from("Player")
	.defaults({
		throws: "Unknown",
		bats: "Unknown"
	}).all()
	.then(players =&gt; {
		console.log(players);
	});
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pyorient---python-driver"><a class="header" href="#pyorient---python-driver">PyOrient - Python Driver</a></h1>
<p>OrientDB supports all JVM languages for server-side scripting.  Using the PyOrient module, you can develop database applications for OrientDB using the Python language.</p>
<p>It works with version 1.7 and later of OrientDB.</p>
<h2 id="installation-9"><a class="header" href="#installation-9">Installation</a></h2>
<p>In order to use PyOrient, you need to install it on your system.  There are two methods available to you in doing this: you can install it from the Python Package Index (PyPI) or you can download the latest source code from GitHub and build it on your local system.</p>
<p>You'll need to have Python in desired version, (2 or 3), as well as the Python package management tool pip installed on your system as a prerequisite.</p>
<h3 id="installing-from-pypi"><a class="header" href="#installing-from-pypi">Installing from PyPI</a></h3>
<p>When you call pip and provided it with the specific package name, it connects to the Python Package Index and downloads the current source package for PyOrient.  It then runs the setup script to install the package on  your system, either at a global or user level.  Installing it at a system-level requires that you run pip as root or with sudo and installs the package as a system-level Python library, (for instance <code>/usr/lib/python3.4/site-packages/pyorient</code>). Installing it at a local-level does not require root privileges and installs it as a user-level Python library, (for instance <code>~/.local/lib/python3.4/site-packages/pyorient</code>).</p>
<ul>
<li>
<p>To install PyOrient locally, run the following command:</p>
<pre>
$ <code class="lang-sh userinput">pip install pyorient --user</code>
</pre>
</li>
<li>
<p>To install PyOrient globally, instead run this command:</p>
<pre>
$ <code class="lang-sh userinput">sudo pip install pyorient</code>
</pre>
</li>
</ul>
<p>When pip runs, it calls the default Python interpreter <code>python</code>.  Due to backwards compatibility issues, in some situations you may find this behavior undesirable.  For instance, on many Linux distributions and Mac OS X, 2.7 is the default installation of Python.  If yo install PyOrient using the above command and then attempt to develop an application that uses Python 3.5, you'll find the <code>pyorient</code> module unavailable.</p>
<p>In the event that you don't know what version you have installed, you can run this command to see:</p>
<pre>
$ <code class="lang-sh userinput">python --version</code>
Python 2.7.11
</pre>
<p>To install PyOrient for a specific version of Python, call pip as a module for the desired Python interpreter.  For instance,</p>
<pre>
$ <code class="lang-sh userinput">python3 -m pip install pyorient --user</code>
</pre>
<h3 id="building-from-source"><a class="header" href="#building-from-source">Building from Source</a></h3>
<p>In the event that you would like to contribute to the <a href="https://github.com/orientechnologies/pyorient">PyOrient Project</a> or for whatever reason would prefer to work from a development release of PyOrient, you can clone the repository from GitHub and install it on your system, again either at a local- or system-level.</p>
<p>You can clone the repository using the following command:</p>
<pre>
$ <code class="lang-sh userinput">git clone https://github.com/orientechnologies/pyorient</code>
</pre>
<p>Then from within that directory you can install PyOrient using the setup script:</p>
<ul>
<li>
<p>To install PyOrient locally, run the following command:</p>
<pre>
$ <code class="lang-sh userinput">python setup.py install --user</code>
</pre>
</li>
<li>
<p>To install PyOrient globally, instead run this command:</p>
<pre>
$ <code class="lang-sh userinput">sudo python setup.py install</code>
</pre>
</li>
</ul>
<p>Notice that these commands utilize the default Python interpreter, whichever version that happens to be on your system.  This may create issues if you intend to use PyOrient with a version of Python that is not your system default.  To run the installation, substitute the interpreter in the above commands with the version that you want to use.  For instance,</p>
<pre>
$ <code class="lang-sh userinput">python3 setup.py install --user</code>
</pre>
<h4 id="running-tests"><a class="header" href="#running-tests">Running Tests</a></h4>
<p>When working with development releases, it is advisable that you run tests after installing PyOrient.  If you would like to contribute code to the project, it's required that you also develop tests for your contributions, to avoid issues in future development.</p>
<p>Testing PyOrient requires that you have Apache Maven and Nose installed on your system.  To run the test, first bootstrap OrientDB by running the following command from the <code>pyorient/</code> directory:</p>
<pre>
$ <code class="lang-sh userinput">./ci/start-ci.sh</code>
</pre>
<p>Running this command downloads the latest version of OrientDB into a local directory then makes some changes to its configuration file and installs a database for use in the test.  Once it's done, you can run the test:</p>
<pre>
$ <code class="lang-sh userinput">nosetests</code>
</pre>
<h2 id="using-pyorient"><a class="header" href="#using-pyorient">Using PyOrient</a></h2>
<p>Once you have PyOrient installed you can begin to use it in your applications.  You can load it through the standard Python import system.  There are two modules available to you:</p>
<ul>
<li>
<p><a href="pyorient/PyOrient-Client.html"><strong>PyOrient Client</strong></a> The base module provides a Python wrapper to the OrientDB <a href="pyorient/../internals/Network-Binary-Protocol.html">Binary Protocol</a>.  To use it, add the following line to your application:</p>
<pre><code class="language-py">import pyorient
</code></pre>
</li>
<li>
<p><a href="pyorient/PyOrient-OGM.html"><strong>PyOrient OGM</strong></a> The Object-Graph Mapper for PyOrient provides a higher-level Object Oriented Pythonic interface for Graph Databases in OrientDB.  To use it, add the following line to your application:</p>
<pre><code class="language-py">import pyorient.ogm
</code></pre>
</li>
</ul>
<p>You may need one or both for your application, depending upon your particular needs.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pyorient-client"><a class="header" href="#pyorient-client">PyOrient Client</a></h1>
<p>The base module in PyOrient provides a Python wrapper for the OrientDB <a href="pyorient/../internals/Network-Binary-Protocol.html">Binary Protocol</a>.  Using this wrapper, you can initialize a client instance within your application, then operate on the OrientDB Server through this instance.</p>
<p>In order to use the PyOrient Client, you need to import the base module into your application.</p>
<pre><code class="language-py">import pyorient
</code></pre>
<h2 id="initializing-the-client"><a class="header" href="#initializing-the-client">Initializing the Client</a></h2>
<p>In order to use the PyOrient Client, you need to initialize a client instance in your application.  By convention, this instance is called <code>client</code>, but you can use any object name you prefer.</p>
<p>To use the client, first initialize a the client object, then connect to the OrientDB Server:</p>
<pre><code class="language-py">client = pyorient.OrientDB("localhost", 2424)
session_id = client.connect("admin", "admin_passwd")
</code></pre>
<p>Here, you initialize the <code>client</code> object to connect to OrientDB through the localhost interface on port 2424.  Then, you establish a connection with the Server, using the username <code>admin</code> and the password <code>admin_passwd</code>.</p>
<h3 id="server-shutdown"><a class="header" href="#server-shutdown">Server Shutdown</a></h3>
<p>From within your application, you can shut down the OrientDB Server.  The user that initiates the shutdown must have shutdown permissions in the <code>orientdb-server-config.xml</code> configuration file, (for instance, the <code>root</code> user on the OrientDB Server).</p>
<pre><code class="language-py">client.shutdown('root', 'root_passwd')
</code></pre>
<h2 id="working-with-the-client"><a class="header" href="#working-with-the-client">Working with the Client</a></h2>
<p>Within your application, once you have initialized the PyOrient Client this object provides you with an interface in working databases on the OrientDB Server.</p>
<ul>
<li><a href="pyorient/PyOrient-Client-Command.html"><strong><code>command()</code></strong></a> This method issues SQL commands.</li>
<li><a href="pyorient/PyOrient-Client-Batch.html"><strong><code>batch()</code></strong></a> This method issues batch commands.</li>
<li><a href="pyorient/PyOrient-Client-Data-Cluster-Add.html"><strong><code>data_cluster_add()</code></strong></a> This method creates new clusters on the database.</li>
<li><a href="pyorient/PyOrient-Client-Data-Cluster-Count.html"><strong><code>data_cluster_count()</code></strong></a> This method counts the numbers of records in an array of clusters.</li>
<li><a href="pyorient/PyOrient-Client-Data-Cluster-Data-Range.html"><strong><code>data_cluster_data_range()</code></strong></a> This method retrieves all records in the given cluster.</li>
<li><a href="pyorient/PyOrient-Client-Data-Cluster-Drop.html"><strong><code>data_cluster_drop()</code></strong></a> This method removes a cluster from the database.</li>
<li><a href="pyorient/PyOrient-Client-DB-Count-Records.html"><strong><code>db_count_records()</code></strong></a> This method counts the number of records on a database.</li>
<li><a href="pyorient/PyOrient-Client-DB-Create.html"><strong><code>db_create()</code></strong></a> This method creates databases.</li>
<li><a href="pyorient/PyOrient-Client-DB-Drop.html"><strong><code>db_drop()</code></strong></a> This method removes databases.</li>
<li><a href="pyorient/PyOrient-Client-DB-Exists.html"><strong><code>db_exists()</code></strong></a> This method determines if a database exists.</li>
<li><a href="pyorient/PyOrient-Client-DB-List.html"><strong><code>db_list()</code></strong></a> This method lists databases on the server.</li>
<li><a href="pyorient/PyOrient-Client-DB-Open.html"><strong><code>db_open()</code></strong></a> This method opens a database on the server.</li>
<li><a href="pyorient/PyOrient-Client-DB-Reload.html"><strong><code>db_reload()</code></strong></a> This method reloads the database on the client.</li>
<li><a href="pyorient/PyOrient-Client-DB-Size.html"><strong><code>db_size()</code></strong></a> This method returns the size of the database.</li>
<li><a href="pyorient/PyOrient-Client-Get-Session-Token.html"><strong><code>get_session_token()</code></strong>`</a> This method returns the client session token.</li>
<li><a href="pyorient/PyOrient-Client-Query.html"><strong><code>query()</code></strong></a> This method issues synchronous queries to the database.</li>
<li><a href="pyorient/PyOrient-Client-Query-Async.html"><strong><code>query_async()</code></strong></a> This method issues asynchronous queries to the database.</li>
<li><a href="pyorient/PyOrient-Client-Record-Create.html"><strong><code>record_create()</code></strong></a> This method creates records on the database.</li>
<li><a href="pyorient/PyOrient-Client-Record-Delete.html"><strong><code>record_delete()</code></strong></a> This method removes records from the database.</li>
<li><a href="pyorient/PyOrient-Client-Record-Load.html"><strong><code>record_load()</code></strong></a> This method retrieves records from the database.</li>
<li><a href="pyorient/PyOrient-Client-Record-Update.html"><strong><code>record_update()</code></strong></a> This method updates records on the database.</li>
<li><a href="pyorient/PyOrient-Client-Set-Session-Token.html"><strong><code>set_session_token()</code></strong></a> This method enables and loads a token for the client session.</li>
<li><a href="pyorient/PyOrient-Client-Tx-Commit.html"><strong><code>tx_commit()</code></strong></a> THis method initializes a control object for transactions.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pyorient-client---command"><a class="header" href="#pyorient-client---command">PyOrient Client - <code>command()</code></a></h1>
<p>This method allows you to issue SQL commands to an open OrientDB database.</p>
<h2 id="sending-commands"><a class="header" href="#sending-commands">Sending Commands</a></h2>
<p>There are several methods available in issuing queries and commands to OrientDB.  Using the <code>command()</code> method calls the <code>OCommandSQL</code> Java class in OrientDB.  This allows you issue commands to OrientDB through your application as you would from the Console.</p>
<p><strong>Syntax</strong></p>
<pre><code>client.command(&lt;sql-command&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;sql-command&gt;</code></strong> Defines the command you want to issue.</li>
</ul>
<p><strong>Example</strong></p>
<p>Going back to the example of a smart home database, consider the use case of logging environmental information to the database for later analysis.  In each room in your house, you set up a series of small Arduino devices to monitor light, sound levels, pollen count and so on.  Every fifteen minutes, your application needs to pull data off each device and log on the database for later graphing and analysis.</p>
<pre><code class="language-py">for sensor in pollen_sensors:
	 client.command(
      "INSERT INTO PollenSensor "
      "('device_id', 'read_time', 'read') "
      "VALUES('%s', '%s', %s')"
      % (sensor.get_id()
         time.now(),
         sensor.get_data()))
</code></pre>
<p>Here, the application iterates through an array of pollen sensors.  For each entry, it issues an <a href="pyorient/../sql/SQL-Insert.html"><code>INSERT</code></a> statement to OrientDB, retrieving the identifier and data from the sensor object and using the Python <code>time</code> module to timestamp the entry.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pyorient-client---batch"><a class="header" href="#pyorient-client---batch">PyOrient Client - <code>batch()</code></a></h1>
<p>This methods allows you to execute a series of SQL commands as a <a href="pyorient/../sql/SQL-batch.html">batch</a> operation.</p>
<h2 id="executing-batch-operations"><a class="header" href="#executing-batch-operations">Executing Batch Operations</a></h2>
<p>Normally, when you execute a series of commands in PyOrient, the operations are run in sequence.  If your application is connecting to a remote server, this means that the PyOrient client is connecting over the network for each commands, which can introduce latency issues for your application.</p>
<p>Batch operations allow you to group several commands together, then issue them together in a single operation.</p>
<p><strong>Syntax</strong></p>
<pre><code>client.batch(&lt;batch&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;batch&gt;</code></strong> Defines the batch commands.</li>
</ul>
<p><strong>Example</strong></p>
<p>Consider the example of a smart home system that uses OrientDB as its back-end database.  You have created and installed various environmental sensors around the house.  Every fifteen minutes, your applications takes readings from these sensors and adds them to the database.  Given that there may be several dozen sensors in the house, you may find it advantageous to update OrientDB through a batch operation.</p>
<pre><code class="language-py"># Initialize Batch Commands Array
batch_cmds = ['begin']

# Set Time
time_now = time.now()

# Add Commands to Array
for sensor in sensors:
   node = sensor.node
   zone = sensor.zone
   read = read_sensor(sensor)
   command = ("let %s = CREATE VERTEX Node"
              "SET node ='%s', zone = '%s',"
	      "read = '%s', time = '%s"
	      % (node, node, zone, time_now, read))
   batch_cmds.append(command)

# Add Batch Commit
batch_cmds.append('commit retry 100;')

# Join with Semicolons
cmd = ';'.join(batch_cmds)

# Execute Commands
results = client.batch(cmd)
</code></pre>
<p>Here, you have an array of record objects for each sensor in the house.  Iterating over that array, you extract the node name and zone, then take a reading from the sensor and use it in defining a <a href="pyorient/../sql/SQL-Create-Vertex.html"><code>CREATE VERTEX</code></a> batch command.  Once you have a command for each sensor, it joins the batch commands with a commit message, creating a string object to pass to <code>batch()</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pyorient-client---data_cluster_add"><a class="header" href="#pyorient-client---data_cluster_add">PyOrient Client - <code>data_cluster_add()</code></a></h1>
<p>This method creates new clusters on the connected OrientDB Server.</p>
<h2 id="creating-clusters"><a class="header" href="#creating-clusters">Creating Clusters</a></h2>
<p>In OrientDB, the cluster is the place in memory or on disk where the database stores its records.  Using PyOrient, you can create new clusters from within your application using the <code>data_cluster_add()</code> method.  New cluster can be created as physical (that is, on disk), or in memory.</p>
<p><strong>Syntax</strong></p>
<pre><code>client.data_cluster_add(&lt;cluster-name&gt;, &lt;cluster-type&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;cluster-name&gt;</code></strong> Defines the cluster name.</li>
<li><strong><code>&lt;cluster-type&gt;</code></strong> Defines the cluster type:
<ul>
<li><em><code>pyorient.CLUSTER_TYPE_PHYSICAL</code></em> Creates a physical cluster.</li>
<li><em><code>pyorient.CLUSTER_TYPE_MEMORY</code></em> Creates an in-memory cluster.</li>
</ul>
</li>
</ul>
<blockquote>
<p>For more information, see <a href="pyorient/../gettingstarted/Tutorial-Clusters.html">Clusters</a>.</p>
</blockquote>
<p><strong>Example</strong></p>
<p>Consider the example of a database for a smart home management application.  When the application runs for the first time, you'll need to initialize OrientDB with any clusters the application requires to operate.  For instance, say you want your various environmental sensors to use different clusters for different rooms in the house:</p>
<pre><code class="language-py">rooms = ['livingRoom', 'masterBedroom', 'guestBedroom', 
         'kitchen', 'bathroom', 'porch'] 

# Create a Cluster for Each Room
for room in rooms:

   client.data_cluster_add(room, pyorient.CLUSTER_TYPE_PHYSICAL)

   logging.info('Created Physical Cluster: %s' % room)
</code></pre>
<p>Here, your application loops over a list of cluster names and creates each instance as a physical cluster on the OrientDB Server.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pyorient-client---data_cluster_count"><a class="header" href="#pyorient-client---data_cluster_count">PyOrient Client - <code>data_cluster_count()</code></a></h1>
<p>This method returns the number of records in an array of clusters.</p>
<h2 id="counting-cluster-records"><a class="header" href="#counting-cluster-records">Counting Cluster Records</a></h2>
<p>Using the <code>data_cluster_count()</code> method, you can retrieve a count of the number of records stored on a given cluster.  You might find this useful for maintenance tasks or when you need a more granular record count than what the <a href="pyorient/PyOrient-Client-DB-Count-Records.html"><code>db_count_records()</code></a> method provides.</p>
<p><strong>Syntax</strong></p>
<pre><code>client.data_cluster_count([&lt;cluster-ids&gt;])
</code></pre>
<ul>
<li><strong><code>&lt;cluster-ids&gt;</code></strong> Defines an array of Cluster ID's.</li>
</ul>
<blockquote>
<p>For more information, see <a href="pyorient/../gettingstarted/Tutorial-Clusters.html">Clusters</a>.</p>
</blockquote>
<p><strong>Example</strong></p>
<p>For instance, consider the example of an application to manage smart home devices.  In each room you create a physical cluster to store data from environmental sensors.  For the web application, you want a count of the number of sensors in an array of rooms.</p>
<pre><code class="language-py"># Retrieve Record Count by Zone
def zone_count(client, cluster_ids, zone_name):

   # Fetch Record Count
   count = client.data_cluster_count(cluster_ids)

   # Log Findings
   logging.info("Found %s records for %s"
                % (str(count), zone_name))

   # Return
   return count
</code></pre>
<p>Where records are organized in clusters by room, for display purposes rooms are grouped together into zones.  This function receives the PyOrient Client, an array of Cluster ID's for a given zone and the zone name.  Using the Cluster ID's, it fetches a record count for that zone, uses the logging module to report its findings, then passes the count back as a return value.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pyorient-client---data_cluster_data_range"><a class="header" href="#pyorient-client---data_cluster_data_range">PyOrient Client - <code>data_cluster_data_range()</code></a></h1>
<p>This method returns a range of Record ID's for the given cluster.</p>
<h2 id="retrieving-cluster-records"><a class="header" href="#retrieving-cluster-records">Retrieving Cluster Records</a></h2>
<p>Using the <code>data_cluster_data_range()</code> method, you can retrieve all records stored in a particular cluster.  You may find this particularly useful in implementations that organize similar records by storing them in dedicated clusters.</p>
<p><strong>Syntax</strong></p>
<pre><code>client.data_cluster_data_range(&lt;cluster-id&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;cluster-id&gt;</code></strong> Defines an integer for the Cluster ID.</li>
</ul>
<blockquote>
<p>For more information, see <a href="pyorient/../gettingstarted/Tutorial-Clusters.html">Clusters</a>.</p>
</blockquote>
<p><strong>Example</strong></p>
<p>Consider the example of a smart home management application that maintains records using OrientDB.  You have built a series of Arduino or Micro Python devices to monitor environmental conditions around the house, (that is, light, temperature, pollen levels, and so on), and have created a class in OrientDB to store data from these sensors.  To better organize this data, for each room in your house you have a dedicated cluster to store records from these sensors.</p>
<pre><code class="language-py"># Retrieve Sensor Data
def get_sensor(client, cluster_id):

   # Retrieve Data
   data = client.data_cluster_data_range(cluster_id)
   return data
</code></pre>
<p>Here, the function receives the <code>client</code> object and an integer that indicates the Cluster ID for the room you want to access.  It then calls the <code>data_cluster_data_range()</code> method with these arguments to retrieve all records in that cluster.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pyorient-client---data_cluster_drop"><a class="header" href="#pyorient-client---data_cluster_drop">PyOrient Client - <code>data_cluster_drop()</code></a></h1>
<p>This method removes a cluster from the database.</p>
<h2 id="removing-clusters-2"><a class="header" href="#removing-clusters-2">Removing Clusters</a></h2>
<p>Occasionally, you may find the need to remove clusters from your database.  You can do so through the PyOrient Client using the <code>data_cluster_drop()</code> method.</p>
<p><strong>Syntax</strong></p>
<pre><code>client.data_cluster_drop(&lt;cluster-id&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;cluster-id&gt;</code></strong> Defines the ID of the cluster.</li>
</ul>
<blockquote>
<p>For more information, see <a href="pyorient/../gettingstarted/Tutorial-Clusters.html">Clusters</a>.</p>
</blockquote>
<p><strong>Example</strong></p>
<p>Consider the example of the smart home application.  Environmental sensors for each room write their data to a dedicated cluster on OrientDB.  Every so often users will move and take the system with them to a new house.  The new house may not have the same number of rooms as the old, which opens up the need for the application to delete clusters in setting the system back up:</p>
<pre><code class="language-py"># Remove Cluster
def remove_cluster(client, name, cluster_id):

   # Remove Cluster
   client.data_cluster_drop(cluster_id)

   # Log Event
   logging.info("Removed Cluster %s for %s"
                % (str(cluster_id), name))
</code></pre>
<p>Here, the function receives the PyOrient Client, the room name and the Cluster ID for sensor nodes in that room as arguments.  It removes the cluster, then reports on what it did to the logging module.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pyorient-client---db_count_records"><a class="header" href="#pyorient-client---db_count_records">PyOrient Client - <code>db_count_records()</code></a></h1>
<p>This method allows you to get the number of records in an opened OrientDB database.</p>
<h2 id="counting-records-1"><a class="header" href="#counting-records-1">Counting Records</a></h2>
<p>There are two methods available in determining the size of the opened database.  <a href="pyorient/PyOrient-Client-DB-Size.html"><code>db_size()</code></a> returns the size of the database, while <code>db_count_records()</code>, which returns the number of records in the database.  It takes no arguments and returns a long value.</p>
<p><strong>Syntax</strong></p>
<pre><code>client.db_count_records()
</code></pre>
<p><strong>Example</strong></p>
<p>You might use this method as a basic sanity check in your application.  For instance, you might use <a href="pyorient/PyOrient-Client-DB-Exists.html"><code>db_exists()</code></a> to determine whether the database was created, then you can use the <code>db_count_records()</code> to determine whether or not the database is empty.</p>
<pre><code class="language-py"># Check that Database exists and contains Data
if client.db_exists("tinkerhome"):
   assert client.db_count_records() != 0
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pyorient-client---db_create"><a class="header" href="#pyorient-client---db_create">PyOrient Client - <code>db_create()</code></a></h1>
<p>Creates a database on the connected OrientDB Server.</p>
<h2 id="creating-databases-3"><a class="header" href="#creating-databases-3">Creating Databases</a></h2>
<p>In the event that a database does not exist already, you can create one from within your application, using the <code>db_create()</code> method.  This method requires one argument, but can take two others.</p>
<p><strong>Syntax</strong></p>
<pre><code>client.db_create(&lt;name&gt;, &lt;database-type&gt;, &lt;storage-type&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;name&gt;</code></strong> Defines the database name.</li>
<li><strong><code>&lt;database-type&gt;</code></strong> Defines the database type, (optional):
<ul>
<li><em><code>pyorient.DB_TYPE_DOCUMENT</code></em> Creates a Document Database.</li>
<li><em><code>pyorient.DB_TYPE_GRAPH</code></em> Creates a Graph Database.</li>
</ul>
</li>
<li><strong><code>&lt;storage-type&gt;</code></strong> Defines the storage type (optional):
<ul>
<li><em><code>pyorient.STORAGE_TYPE_PLOCAL</code></em> Uses PLocal storage type.</li>
<li><em><code>pyorient.STORAGE_TYPE_MEMORY</code></em> Uses Memory storage type.</li>
</ul>
</li>
</ul>
<p>Only the database name is required.  By default the method creates a Document Database using the PLocal storage type.</p>
<p><strong>Example</strong></p>
<p>Say that your application collects and analyzes data from various custom built smart home devices installed around the house.  When it first runs it finds that it needs to initialize a database on OrientDB to store the data it collects.</p>
<pre><code class="language-py">try:
   client.db_create(
      "tinkerhome",
       pyorient.DB_TYPE_GRAPH,
       pyorient.STORAGE_TYPE_PLOCAL)
   logging.info("TinkerHome Database Created.")
except pyorient.PYORIENT_EXCEPTION as err:
   logging.critical(
      "Failed to create TinkerHome DB: %" 
      % err)
</code></pre>
<p>Here, PyOrient attempts to create the database <code>tinkerhome</code> on OrientDB.  If the create command fails, it logs it as a critical error.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pyorient-client---db_drop"><a class="header" href="#pyorient-client---db_drop">PyOrient Client - <code>db_drop()</code></a></h1>
<p>This method removes a database from the connected OrientDB server.</p>
<h2 id="dropping-databases-1"><a class="header" href="#dropping-databases-1">Dropping Databases</a></h2>
<p>In certain situations, you may want to remove a full database from the OrientDB Server.  For instance, if you create a temporary database in memory for certain operations or if you want to provide the user with the ability to uninstall the database with the application, without removing OrientDB itself.</p>
<p><strong>Syntax</strong></p>
<pre><code>client.db_drop(&lt;db-name&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;db-name&gt;</code></strong> Defines the database to remove.</li>
</ul>
<p><strong>Example</strong></p>
<p>Consider the example of the smart home database.  In developing your application, you may want to frequently reset the database to a clean state.  This allows you to move forward with a new implementation without having to worry about an obsolete schema causing problems for you.</p>
<pre><code class="language-py"># Reset Database
def reset_db(client, name):

   # Remove Old Database
   client.db_drop(name)

   # Create New Database
   client.db_create(name, 
      pyorient.DB_TYPE_GRAPH, 
      pyorient.STORAGE_TYPE_PLOCAL)
</code></pre>
<p>Here, the function receives the client and the database name.  It deletes the given database and creates a new one with the same name.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pyorient-client---db_exists"><a class="header" href="#pyorient-client---db_exists">PyOrient Client - <code>db_exists()</code></a></h1>
<p>This method checks whether or not the given database exists on the connected OrientDB Server.  In the event that you need the database to exist and be of a specific storage type, you can pass a second argument to check this as well.</p>
<h2 id="checking-database-existence"><a class="header" href="#checking-database-existence">Checking Database Existence</a></h2>
<p>There are two methods available in determining whether a database exists on the OrientDB Server.  You can use the <a href="pyorient/PyOrient-Client-DB-List.html"><code>db_list()</code></a> method to find all the databases on the server, then search the results or, in the event that you know the database name, you can check it directly with <code>db_exists()</code>.</p>
<p><strong>Syntax</strong></p>
<pre><code>client.db_exists(&lt;name&gt;, &lt;storage-type&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;name&gt;</code></strong> Defines the database you want to find.</li>
<li><strong><code>&lt;storage-type&gt;</code></strong> Defines the storage type you want to find, (optional):
<ul>
<li><em><code>pyorient.STORAGE_TYPE_PLOCAL</code></em> Checks for PLocal database.</li>
<li><em><code>pyorient.STORAGE_TYPE_MEMORY</code></em> Checks for Memory database.</li>
</ul>
</li>
</ul>
<p>By default, it searches for a PLocal database type.</p>
<p><strong>Example</strong></p>
<p>Consider the example of the database for your smart home application.  Since the application requires a database to operate, you might use this method as a basic check when the application starts.  For instance,</p>
<pre><code class="language-py"># Check Database
if client.db_exists("tinkerhome"):
   # Open Database
   client.db_open("tinkerhome", "admin", "admin_passwd")

else:
   # Create Database
   client.db_create(
      "tinkerhome",
      pyorient.DB_TYPE_GRAPH,
      pyorient.STORAGE_TYPE_PLOCAL 
   )
</code></pre>
<p>Here, the application checks if the <code>tinkerhome</code> database exists.  If it does, it opens the database on the client.  If it doesn't, it creates a PLocal Graph Database on that name.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pyorient-client---db_list"><a class="header" href="#pyorient-client---db_list">PyOrient Client - <code>db_list()</code></a></h1>
<p>This method lists the databases available on the connected OrientDB Server.</p>
<h2 id="listing-databases-2"><a class="header" href="#listing-databases-2">Listing Databases</a></h2>
<p>There are two methods available in determining what databases are available on the OrientDB Server.  The first is check whether an individual database is present, using <a href="pyorient/PyOrient-Client-DB-Exists.html"><code>db_exists()</code></a>.  In the event that you don't know the database name or you want to operate on all databases, you can use <code>db_list()</code> to fetch information on all databases on the server.</p>
<p><strong>Syntax</strong></p>
<pre><code>client.db_list()
</code></pre>
<p><strong>Example</strong></p>
<p>When you create a database without specifying the username and password, OrientDB defaults to the user <code>admin</code> and the password <code>admin</code>.  While this behavior is fine during development, it poses certain security risks in production.  You might use <code>db_list()</code> as part of a basic security check to ensure that all databases on your server have non-default login credentials.  For instance,</p>
<pre><code class="language-py"># List Databases
database_list = client.db_list().__getattr__('databases')

# Check for Default Login
for i in database_list:
   try:
      client.db_open(i, "admin", "admin")
      print("Default Credentials found on: %s" % i)
      client.db_close()
   except:
      print("Non-default Credentials found on: %s" % i)
</code></pre>
<p>Here, PyOrient creates a dict object, where the key is the database name and the value the database path.  The <code>__getattr__()</code> method ensures that you retrieve a dict instead of an OrientRecord object.  You can test this using the Python console,</p>
<pre>
>>> <code class="lang-py userinput">client.db_list()</code>
&lt;pyorient.otypes.OrientRecord object at 0x7f89c4211e10&gt;

>>> <code class="lang-py userinput">client.db_list().__getattr__('databases')</code>
{'tinkerhome': 'plocal:/data/tinkerhome',
'GratefulDeadConcerts': 'plocal:/data/GratefulDeadConcerts'}
</pre>
<p>In the code, once this is set PyOrient then loops through the dict, checking each key, (that is, each database name), to test the default login credentials.  It then prints whether the login succeeds or fails to stdout.  This lets you know which databases need updated credentials.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pyorient-client---db_open"><a class="header" href="#pyorient-client---db_open">PyOrient Client - <code>db_open()</code></a></h1>
<p>This method opens a database on the OrientDB Server.</p>
<h2 id="opening-databases-2"><a class="header" href="#opening-databases-2">Opening Databases</a></h2>
<p>When you have the name of the database that you want to use, as well as the relevant authentication credentials, you can open this database within your client.</p>
<p><strong>Syntax</strong></p>
<pre><code>client.db_open(&lt;name&gt;, &lt;username&gt;, &lt;user-passwd&gt;, &lt;db-type&gt;, &lt;client-id&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;name&gt;</code></strong> Defines the database you want to open.</li>
<li><strong><code>&lt;username&gt;</code></strong> Defines the database user name.</li>
<li><strong><code>&lt;user-passwd&gt;</code></strong> Defines the database user password.</li>
<li><strong><code>&lt;db-type&gt;</code></strong> Defines the database type, (optional).
<ul>
<li><em><code>pyorient.DB_TYPE_DOCUMENT</code></em> Opens it as a Document Database.</li>
<li><em><code>pyorient.DB_TYPE_GRAPH</code></em> Opens it as a Graph Database.</li>
</ul>
</li>
<li><strong><code>&lt;client-id&gt;</code></strong> With distributed deployments, use this argument to define the distributed node.</li>
</ul>
<p><strong>Example</strong></p>
<p>In the case of the example smart home database, say that after various sanity checks you're ready to start working on the database itself.  You might use a line like the one below to open the database, so that you can start using it:</p>
<pre><code class="language-py">client.db_open("tinkerhome", "nodeuser", "node_passwd")
</code></pre>
<p>This opens the <code>tinkerhome</code> database on the PyOrient Client.  Commands issued through this object now operate on that database.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pyorient-client---db_reload"><a class="header" href="#pyorient-client---db_reload">PyOrient Client - <code>db_reload()</code></a></h1>
<p>This method reloads the open database, refreshing cluster information from OrientDB.</p>
<h2 id="reloading-databases"><a class="header" href="#reloading-databases">Reloading Databases</a></h2>
<p>On occasion, you may encounter or implement deployments where multiple clients are interacting with the OrientDB server at a given time.  In cases such as this, you may need to reload the database, updating cluster information on the <code>client</code> object.</p>
<p><strong>Syntax</strong></p>
<pre><code>client.db_reload()
</code></pre>
<p><strong>Example</strong></p>
<p>For instance, consider the example of the smart home application database.  You have a web interface that provides control functionality and a back-end systems that update the database with information taken from physical devices.  Periodically, you may need the web interface to reload its client connection.</p>
<pre><code class="language-py">class WebInterface():

   def __init__(self, client):
      self.client = client

   def reload(self):
      self.client.db_reload()
</code></pre>
<p>Here, the class receives the PyOrient Client and initializes it as a class variable.  You can then periodically call the method periodically to reload the database on the client, updating cluster information.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pyorient-client---db_size"><a class="header" href="#pyorient-client---db_size">PyOrient Client - <code>db_size()</code></a></h1>
<p>This method returns the size of the open database.</p>
<h2 id="getting-the-database-size"><a class="header" href="#getting-the-database-size">Getting the Database Size</a></h2>
<p>Using the <code>db_size()</code> method, you can determine the size of a given database.  It does not receive any arguments, but rather checks the database currently open on the client.  To open a database, see <a href="pyorient/PyOrient-Client-DB-Open.html"><code>db_open()</code></a>.</p>
<p><strong>Syntax</strong></p>
<pre><code>client.db_size()
</code></pre>
<p><strong>Example</strong></p>
<p>You might use <code>db_size()</code> as a sanity check in your application.  For instance, you might have your application check the database size in order to determine whether or not it has been properly initialized:</p>
<pre><code class="language-py">client.db_open("tinkerhome", "admin", "admin_passwd")

# Fetch Size
size = client.db_size()

assert size != 0
</code></pre>
<p>Here, the application opens the <code>tinkerhome</code> database, then checks it's size.  It uses an <code>assert</code> statement to ensure that the database is not empty.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pyorient-client---get_session_token"><a class="header" href="#pyorient-client---get_session_token">PyOrient Client - <code>get_session_token()</code></a></h1>
<p>In certain use cases, you may want to maintain a client connection across several sessions.  For instance, in a web application you might set an identifier for a shopping cart or use sessions to maintain a local history of the user's interactions with the site.</p>
<p>Beginning in version 27, PyOrient provides support for token-based sessions.  Using the <code>get_session_token()</code> method, your client can fetch a session ID from the client, which you can then use in reattaching to old sessions.</p>
<h2 id="getting-session-tokens"><a class="header" href="#getting-session-tokens">Getting Session Tokens</a></h2>
<p>Retrieving session tokens from OrientDB is a process closely tied with setting them on the client using the <a href="pyorient/PyOrient-Client-Set-Session-Token.html"><code>set_session_token()</code></a> method.  In order to fetch the session token, you first need to enable the feature through this method.</p>
<p><strong>Syntax</strong></p>
<pre><code class="language-py">client.get_session_token()
</code></pre>
<p>The method returns either the current session token or, in the event that the feature is disabled, an empty string.</p>
<h3 id="enabling-session-tokens"><a class="header" href="#enabling-session-tokens">Enabling Session Tokens</a></h3>
<p>Working with session tokens requires that you configure the OrientDB Server to use them.  You can manage this through the <a href="pyorient/PyOrient-Client-Set-Session-Token.html"><code>set_session_token()</code></a>.  When you pass this parameter a token it reattaches to that session.  When you pass it a boolean value, it enables or disables the feature.</p>
<pre><code class="language-py"># Initialize the Client
client = pyorient.OrientDB("localhost", 2424)

# Enable Token-based Authentication
client.set_session_token(True)
</code></pre>
<h3 id="retrieving-session-tokens"><a class="header" href="#retrieving-session-tokens">Retrieving Session Tokens</a></h3>
<p>Once you have enabled this feature, you can fetch a token for the current session and set it to the variable.</p>
<pre><code class="language-py"># Fetch Session Token
sessionToken = client.get_session_token()
</code></pre>
<p>In the event that something went wrong or if for some reason session tokens are disabled on OrientDB when you call this method, it returns an empty string.  To avoid problems later, you can implement a check using an <code>assert</code> statement to ensure that the token was properly set:</p>
<pre><code class="language-py"># Ensure that Server allows Session Tokens
assert sessionToken != ''
</code></pre>
<p>With the session token set on the variable <code>sessionToken</code>, you can reattach to your current session later using the <a href="pyorient/PyOrient-Client-Set-Session-Token.html"><code>set_session_token()</code></a> method.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pyorient-client---query"><a class="header" href="#pyorient-client---query">PyOrient Client - <code>query()</code></a></h1>
<p>This method issues a synchronous query to the open OrientDB database.</p>
<h2 id="querying-records"><a class="header" href="#querying-records">Querying Records</a></h2>
<p>In the event that you're more comfortable working in SQL, you can query the OrientDB Server directly from within your PyOrient application using the <code>query()</code> method.  This method operates similar to the <a href="pyorient/PyOrient-Client-Record-Load.html"><code>record_load()</code></a>, <a href="pyorient/PyOrient-Client-Record-Update.html"><code>record_update()</code></a> and <a href="pyorient/PyOrient-Client-Record-Create.html"><code>create_record()</code></a> methods, depending on the SQL you use.</p>
<blockquote>
<p>In the event that you want to make an asynchronous query, see the <a href="pyorient/PyOrient-Client-Query-Async.html"><code>query_async()</code></a> method.</p>
</blockquote>
<p><strong>Syntax</strong></p>
<pre><code>client.query(&lt;query&gt;, &lt;limit&gt;, &lt;fetch-plan&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;query&gt;</code></strong> Defines the SQL you want to send to OrientDB.</li>
<li><strong><code>&lt;limit&gt;</code></strong> Defines the number of results you want returned, defaults to all results.</li>
<li><strong><code>&lt;fetch-plan&gt;</code></strong> Defines the fetching strategy you want to use.</li>
</ul>
<p><strong>Example</strong></p>
<p>Consider the example of the smart home database, where your application is logging readings from various Arduino or Micro Python sensors to OrientDB.  In building the web interface for this system, say that you want to pull all pollen data recorded to the database.</p>
<pre><code class="language-py">data = client.query("SELECT FROM Sensors "
                    "WHERE sensorType = 'Pollen'", 
                    100)
</code></pre>
<p>Here, your application queries the <code>Sensors</code> class for all records that pertain to pollen sensors.  It then sets the return value to the <code>data</code> object.  You can now pass this object to a Django or Flask method in rendering it to HTML to use with the web interface.</p>
<h3 id="querying-records-with-fetch-plans"><a class="header" href="#querying-records-with-fetch-plans">Querying Records with Fetch Plans</a></h3>
<p>In OrientDB, <a href="pyorient/../java/Fetching-Strategies.html">Fetching Strategies</a> allow you to refine the process the given client uses in retrieving data from the server.  You may find this useful when retrieving a record that contains several layers of linked records.  With a normal query, the client would need to resubmit the request for each additional layer of linked records.  Using a fetch plan, OrientDB with collect all connecting records and send them to PyOrient together.</p>
<p>For instance, in the example of a smart home database say that you want to retrieve all records from sensors in your bedroom.  In the event that you have trouble sleeping, this might help in determining the cause of the problem, allowing you to say connect room temperature or light conditions with your waking up in the middle of the night.</p>
<pre><code class="language-py">data = client.query("SELECT FROM Sensors "
                    "WHERE room = 'bedroom'",
                    100, "*:-1")
</code></pre>
<p>Here, the fetching strategy, (given as the third argument) retrieves all connecting records to the bedroom sensors.  It sets the return data to an object, which you can then pass to other methods for analysis or presentation.  You can fine tune how many layers of connecting records OrientDB collects.  For more information, see <a href="pyorient/../java/Fetching-Strategies.html">Fetching Strategies</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pyorient-client---query_async"><a class="header" href="#pyorient-client---query_async">PyOrient Client - <code>query_async()</code></a></h1>
<p>This method is runs queries against the open OrientDB database, and runs the given callback function for each record the query returns.</p>
<h2 id="querying-the-database-3"><a class="header" href="#querying-the-database-3">Querying the Database</a></h2>
<p>When you issue a query using the standard <a href="pyorient/PyOrient-Client-Query.html"><code>query()</code></a> method, PyOrient issues the query to OrientDB and then waits for the database to return its result-set.  In the case of particularly long running queries, you may want your application to perform some additional checks as it collects records from the query.</p>
<p>Using the <code>query_async()</code> method, each individual record PyOrient receives from OrientDB triggers the given callback function or method.</p>
<p>When working with the standard <a href="pyorient/PyOrient-Client-Query.html"><code>query()</code></a> method, PyOrient issues the query to OrientDB then sets the subsequent result-set as its return value.  In the time between the issuing of the query and receiving the return value, the application waits.  For most use cases, given OrientDB's performance, this behavior is fine.  But, in the case of particularly long running queries, you may find it undesirable.</p>
<p>In the event that you would like to perform some additional checks or operations while the query runs, you can use the <code>query_async()</code> method.  This allows you to perform addition operations on the data as it processes, such as logging or initiating certain calculations in advance of the final result.</p>
<p><strong>Syntax</strong></p>
<pre><code>client.query_async(&lt;query&gt;, &lt;limit&gt;, &lt;fetch-plan&gt;, &lt;callback&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;query&gt;</code></strong> Defines the SQL query.</li>
<li><strong><code>&lt;limit&gt;</code></strong> Defines a limit for the result-set.</li>
<li><strong><code>&lt;fetch-plan&gt;</code></strong> Defines a <a href="pyorient/../java/Fetching-Strategies.html">Fetching Strategy</a></li>
<li><strong><code>&lt;callback&gt;</code></strong> Defines the callback function or method.</li>
</ul>
<p><strong>Example</strong></p>
<p>Consider the example of a smart home system that uses OrientDB for back-end storage.  Say that your application logs data on various environmental sensors.  Given a few dozen sensors and a set of records added at least every fifteen minutes, after a few months this can grow into a very large database.</p>
<p>For instance, say that you have a class used in analyzing data for a web front-end. Using <code>query_async()</code> you can call a logging method to report on the records you've retrieved before setting the return value.</p>
<pre><code class="language-py"># Data Analyzer Class
class DataAnalyzer():

   # Initialize Class
   def __init__(self, client, nodetype):

      # Init Class Variables
      self.client = client
      self.record_count = 0

      # Retrieve Data
      query = "SELECT FROM Nodes WHERE nodetype = '%s' % nodetype
      self.data = self.client.query_async(query, "*:-1", self.log_query)

      # Report Count
      logging.info("Records Retrieved: %s" % self.record_count)

   # Log Record Returns
   def log_query(self, record):
       logging.debug("Loading Record: %s" % record._rid)
       self.record_count += 1
</code></pre>
<p>Here, when you initialize the <code>DataAnalyzer</code> class, you pass to it the PyOrient client and a string indicating the type of sensor nodes you want to analyzie.  The class queries OrientDB for data on these node types.  For each record <code>query_async()</code> retrieves, it calls the <code>log_query()</code> class method.</p>
<p>For each record retrieved, it calls the logging module to create a debugging event.  It also increments the internal counter <code>record_count</code>.  Once the query is complete, it calls logging again to issue an informational event reporting the number of records the query retrieved.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pyorient-client---record_create"><a class="header" href="#pyorient-client---record_create">PyOrient Client - <code>record_create()</code></a></h1>
<p>This method creates a record on the open OrientDB database, using the given dict.</p>
<blockquote>
<p><strong>Warning</strong>: Prior to version 2.0 of OrientDB, some users encountered issues with <code>record_create()</code> and <a href="pyorient/PyOrient-Client-Record-Update.html"><code>record_update()</code></a> in PyOrient.  When developing applications for older versions of OrientDB, it is recommended that you avoid these methods.</p>
</blockquote>
<h2 id="creating-records-1"><a class="header" href="#creating-records-1">Creating Records</a></h2>
<p>When you want to add a completely new record to the database, use the <code>record_create()</code> method.  This method takes two arguments, the ID of the cluster you want to add the data to, and a dict object that represents the data you want to add.</p>
<p><strong>Syntax</strong></p>
<pre><code>client.record_create(&lt;cluster_id&gt;, &lt;data&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;cluster_id&gt;</code></strong> Integer that defnes the cluster to use.</li>
<li><strong><code>&lt;data&gt;</code></strong> Dict that defines the data to add.</li>
</ul>
<p>The dict object you pass to this method uses the following format:</p>
<pre><code>data = {
   @&lt;class&gt;: {
      &lt;property&gt;: &lt;value&gt;
   }
}
</code></pre>
<ul>
<li><strong><code>&lt;class&gt;</code></strong> Defines the class name.</li>
<li><strong><code>&lt;property&gt;</code></strong> Defines the property you want to add, if any.</li>
<li><strong><code>&lt;value&gt;</code></strong> Defines the value you want to assign the property.</li>
</ul>
<p><strong>Example</strong></p>
<p>For instance, consider the use case of a smart home database.  Your application is connected to several basic security devices set up around the exterior doors to your house.  Whenever someone approaches one of these doors, they trigger a motion sensor that initializes the event.</p>
<p>When setting up a system like this, you might want to record the event with webcams, log whether the visitor rang the doorbell, knocked or did nothing, and determine whether the interior or exterior locks were used in openning the door.  Once the application finishes recording the event, it needs to log the data to OrientDB, (such as an offsite server, in the event of burglary).</p>
<pre><code class="language-py">event = {
   @DoorSecurityEvent: {
      "time_start": timestamp_start,
      "time_end": timestamp_end,
      "webcam_file": "/path/to/file.ogg,
      "doorbell": True,
      "knock": False,
      "open": True,
      "open_type": "InnerLock"
   },
}
client.record_create(cluster_id, event)
</code></pre>
<p>Here, your application records a postal service delivery.  It sets the cluster ID, as well as the starting and ending timestamp variables as they occur, then builds the dict object, then it passes the Cluster ID and the dict object to the <code>record_cluster()</code>, to log the delivery to OrientDB.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pyorient-client---record_delete"><a class="header" href="#pyorient-client---record_delete">PyOrient Client - <code>record_delete()</code></a></h1>
<p>This method removes records from the open OrientDB database.</p>
<h2 id="deleting-records-3"><a class="header" href="#deleting-records-3">Deleting Records</a></h2>
<p>When you want to remove records from the open OrientDB database, you can do so using the <code>record_delete()</code> method.  To do so, you'll need the cluster that contains the record and its Record ID.</p>
<p><strong>Syntax</strong></p>
<pre><code>client.record_delete(&lt;cluster-id&gt;, &lt;record-id&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;cluster-id&gt;</code></strong> Defines the cluster that contains the record.</li>
<li><strong><code>&lt;record-id&gt;</code></strong> Defines the record to remove.</li>
</ul>
<p><strong>Example</strong></p>
<p>Consider the example of the smart home database.  In developing the web interface, you want to implement a feature that allows the user to delete sensor nodes from the database.  In the event that you find certain nodes are damaged or you move the system to a new house and would like the monitors to display fresh sensor data.</p>
<pre><code class="language-py">def remove_records(client, cluster_id record_list):
   
   # Iterate through Record ID's
   for record in record_list:

      # Delete Record
      client.record_delete(cluster_id, record.__rid)
</code></pre>
<p>Here, the function receives the client, cluster ID and an array of records as arguments.  It then iterates over each record in the array and deletes it using the <code>record_delete()</code> method.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pyorient-client---record_load"><a class="header" href="#pyorient-client---record_load">PyOrient Client - <code>record_load()</code></a></h1>
<p>This method retrieves the given Record ID from an open OrientDB database.</p>
<h2 id="loading-records-1"><a class="header" href="#loading-records-1">Loading Records</a></h2>
<p>In PyOrient, a record load is similar to a <a href="pyorient/PyOrient-Client-Query.html"><code>query()</code></a> in that it fetches record from the database for the application to operate on.  But, unlike a query, <code>record_load()</code> fetches a record using its Record ID.</p>
<p><strong>Syntax</strong></p>
<pre><code>client.record_load(&lt;rid&gt;, &lt;fetch-plan&gt;, &lt;callback&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;rid&gt;</code></strong> Defines the Record ID of the record you want to load.</li>
<li><strong><code>&lt;fetch-plan&gt;</code></strong> Defines a <a href="pyorient/../java/Fetching-Strategies.html">Fetching Strategy</a> to use.</li>
<li><strong><code>&lt;callback&gt;</code></strong> Defines a function to use as callback with your Fetch Plan.</li>
</ul>
<p><strong>Example</strong></p>
<p>For instance, consider the use case of an application that manages a series of smart devices scattered about your home.  You log data from these devices to OrientDB.</p>
<p>Given that your application is logging all this data, you might want to extract it to use elsewhere.  With an array of Record ID's, you can iterate through, using this method to retrieve the data from OrientDB and pass it on as a return value.  For example,</p>
<pre><code class="language-py"># Process Data
def compile_data(client, rid_array):

   # Initialize Variable
   data = {}

   # Iterate through Record ID's
   for rid in rid_array:

      # Log Data
      data[rid] = client.record_load(rid)

   # Return Data
   return data
</code></pre>
<p>Here, the function receives the <code>client</code> interface and array of Record ID's, it iterates through them, storing the data in the <code>data</code> dict, which it then returns for analysis elsewhere in your application.</p>
<h3 id="loading-records-with-cache"><a class="header" href="#loading-records-with-cache">Loading Records with Cache</a></h3>
<p>In addition to the standard record loads, where PyOrient queries the database and returns the single requested record, you can also implement a [Fetch Plan](Fetching Strategies.md) through this method.  When you need to traverse connected records, this feature allows you to take advantage of early loads, ensuring that the client only needs to make one request, rather than sending a series of additional requests for the connected records.</p>
<p>Consider the example of a smart home database.  In each room of your house you have installed a series of Arduino- or Micro Python-based devices to record environmental conditions, such as light and noise levels, pollen count, smoke and carbon monoxide detectors and so on.  Every fifteen minutes your application checks in with these devices and takes an average of their readings, logging its findings to OrientDB.</p>
<p>In building a web interface to serve as a control panel, you might want to extract this data by room or zone to generate graphs illustrating how conditions have changed over time.  For example, you might find it useful to combine the senor readings for your bedroom with a sleep monitor.</p>
<pre><code class="language-py">zone = Zone('bedroom')

client.db_record_load('#14:33', '*:-1', zone.add_sensors)
</code></pre>
<p>Here, we initialize a Python <code>Zone</code> class, which we've defined elsewhere as a bedroom instance.  Once this is done, we ask PyOrient to all records associated with #14:33, (that is, the master bedroom).  PyOrient then passes the results to the <code>add_sensors()</code> method defined on the <code>Zone</code> class.  Once this is complete, we can use the <code>zone</code> class object in rendering a report for the control panel.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pyorient-client---record_update"><a class="header" href="#pyorient-client---record_update">PyOrient Client - <code>record_update()</code></a></h1>
<p>This method updates the given Record ID with data from a dict argument.</p>
<blockquote>
<p><strong>Warning</strong>: Prior to version 2.0 of OrientDB, some users encountered issues with <code>record_update()</code> and <a href="pyorient/PyOrient-Client-Record-Create.html"><code>record_create()</code></a> in PyOrient.  When developing applications for older versions of OrientDB, it is recommended that you avoid these methods.</p>
</blockquote>
<h2 id="updating-records-3"><a class="header" href="#updating-records-3">Updating Records</a></h2>
<p>When you want to update an existing record on OrientDB, you can use the <code>record_update()</code> method.  In order to update a record, you'll need its Record ID and version, which you can call from the record object.</p>
<p><strong>Syntax</strong></p>
<pre><code>client.record_update(&lt;record-id&gt;, &lt;data&gt;, &lt;version&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;record-id&gt;</code></strong> Defines the Record ID of the record you want to update.</li>
<li><strong><code>&lt;data&gt;</code></strong> Defines the data you want to change in a dict.</li>
<li><strong><code>&lt;versin&gt;</code></strong> Defines the version of the record you want to update.</li>
</ul>
<p>The dict object you pass to this method uses the following format:</p>
<pre><code>data = {
   @&lt;class&gt;: {
      &lt;property&gt;: &lt;value&gt;
   }
}
</code></pre>
<ul>
<li><strong><code>&lt;class&gt;</code></strong> Defines the class name.</li>
<li><strong><code>&lt;property&gt;</code></strong> Defines the property you want to add, if any.</li>
<li><strong><code>&lt;value&gt;</code></strong> Defines the value you want to assign the property.</li>
</ul>
<p><strong>Example</strong></p>
<p>Consider the example of a database for a smart home application.  Say that you have a series of appliances that you have modified with your own custom electronics.  For instance, you might add a Raspberry Pi with a touchscreen to the refrigerator, to display weather information while idle and provide an app for generating grocery lists.</p>
<p>Whenever you open the grocery list, your application checks in with OrientDB for the current shopping list, then updates the database with the new entries.  Then, say you have guests coming over and want to buy more eggs:</p>
<pre><code class="language-py">
# Fetch Grocery List
eggs = client.query(
   "SELECT FROM ShoppingList "
   "WHERE type = 'grocery'"
   "AND item = 'eggs'")

data = {
   "@ShoppingList": {
      "quantity": 24
   }
}
client.record_update(eggs._rid, data, eggs._version)
</code></pre>
<p>Here, PyOrient uses the <a href="pyorient/PyOrient-Client-Query.html"><code>query()</code></a> method to retrieve an object instance from the database, it then updates the <code>ShoppingList</code> with the new quantity of eggs.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pyorient-client---set_session_token"><a class="header" href="#pyorient-client---set_session_token">PyOrient Client - <code>set_session_token()</code></a></h1>
<p>In certain use cases, you may want to maintain a client connection across several sessions.  For instance, in a web application you might set an identifier for a shopping cart or use sessions to maintain a local history of the user's interactions with the site.</p>
<p>Beginning in version 27, PyOrient provides support for token-based sessions.  Using the <code>set_session_token()</code> method, your client can tokens and, using one, reattach to an existing session.</p>
<h2 id="setting-session-tokens"><a class="header" href="#setting-session-tokens">Setting Session Tokens</a></h2>
<p>There are two operations possible with this method.  It determines which by the type of the value you pass it as an argument.</p>
<p><strong>Syntax</strong></p>
<pre><code>client.set_session_token(&lt;enable|session-id&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;enable&gt;</code></strong> When the method receives a boolean value, it enables or disables token-based authentication in OrientDB.</li>
<li><strong><code>&lt;session-id&gt;</code></strong> When the method receives the identifier for an existing session, it reattaches to that session.</li>
</ul>
<p>In practice, you need to use both in your application.  First to enable token-based authentication and then to reattach to an existing session.  When this feature is enabled, you can fetch the current session token using the <a href="pyorient/PyOrient-Client-Get-Session-Token.html"><code>get_session_token()</code></a> method.</p>
<h3 id="enabling-session-tokens-1"><a class="header" href="#enabling-session-tokens-1">Enabling Session Tokens</a></h3>
<p>Working with session tokens requires that you configure the OrientDB Server to use them.  You can manage this through the <code>set_session_token()</code>.  When you pass this parameter a token it reattaches to that session.  When you pass it a boolean value, it enables or disables the feature.</p>
<pre><code class="language-py"># Initialize the Client
client = pyorient.OrientDB("localhost", 2424)

# Enable Token-based Authentication
client.set_session_token(True)
</code></pre>
<p>Once you have enabled this feature, you can fetch a token for the current session and set it to the variable, using the <a href="pyorient/PyOrient-Client-Get-Session-Token.html"><code>get_session_token()</code></a> method.</p>
<pre><code class="language-py"># Fetch Session Token
sessionToken = client.get_session_token()
</code></pre>
<p>With the session token fetched and stored on the variable, <code>sessionToken</code>, you now have it available to use later in reattaching to this session.</p>
<h3 id="setting-session-tokens-1"><a class="header" href="#setting-session-tokens-1">Setting Session Tokens</a></h3>
<p>With session tokens enabled and one fetched and set to a variable using the <a href="pyorient/PyOrient-Client-Get-Session-Token.html"><code>get_session_token()</code></a> method, you can use the token to reattach to an existing session.</p>
<pre><code class="language-py"># Reattach to Session
if sessionToken != '':
   client.set_session_token(sessionToken)
else:
   # Open Database
   client.db_open("tinkerhome", "admin", "admin_passwd")

   # Enable Session Tokens
   client.set_session_token(True)
   
   # Fetch Session Token
   sessionToken = client.get_session_token()
   assert sessionToken != ''

# Query Database
record = client.query(
   "SELECT status FROM Nodes WHERE zone = 'living-room'")
</code></pre>
<p>Here, your application first checks whether the <code>sessionToken</code> variable is an empty string.  If it finds that it is not an empty string, it uses the variable to reattach to an existing session.  If it finds that it is an empty string, it opens the database, enables session tokens, to fetches the current session token to set it on the <code>sessionToken</code> variable for later.  Afterwards, it queries the database for the status of all devices in the living room.</p>
<blockquote>
<p>In the above example note, when the client reattaches to an existing session, it doesn't need to reopen the database, given that the database is already open on that session.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pyorient-client---tx_commit"><a class="header" href="#pyorient-client---tx_commit">PyOrient Client - <code>tx_commit()</code></a></h1>
<p>This method initializes a transaction control object.</p>
<h2 id="working-with-transactions"><a class="header" href="#working-with-transactions">Working with Transactions</a></h2>
<p>Transactions represent units of work executed against the database, which are treated in a coherent and reliable way, independent of other transactions.  They provide units of work, allowing for failure recovery and keeping the database consistent even in cases of system failure.  They also provide isolation in cases where multiple clients concurrently access the database.</p>
<p>In PyOrient, the <code>tx_commit()</code> client method initializes a transaction control object.  Using the control object, you can begin and operate on the transaction itself, controlling what gets added and when the application commits the changes.</p>
<p><strong>Syntax</strong></p>
<pre><code>client.tx_commit()
</code></pre>
<p><strong>Examples</strong></p>
<p>Consider the example of a smart home system that uses OrientDB for its back-end storage.  Say that you have a web application that runs on a touchscreen device built into or near the refrigerator.  This application allows you to create and update grocery lists.  Other applications can then call up the grocery list to automatically send SMS reminders about things family members need to pick up on their next trip to the supermarket.</p>
<p>The grocery list application handles updates using transactions, beginning the transaction when the user edits the list and committing it after they save.  For instance, your application may build a transaction update like this,</p>
<pre><code class="language-py"># Define Cluster
cluster_id = 3

#  Create Record for Base Objects
record_base = {
   'store': "Davis Square Farmers' Market",
   'list': [],
}
record_position = client.record_create(cluster_id, record_base)

# Begin Transaction
tx = client.tx_commit()
tx.begin()


# Create Record in Transaction
record_1 = {
   'store': "McKinnon's Meat Market",
   'list': ['steak', 'eggs', 'sausage']
}
new_record = client.record_create(-1, record_1)

# Update Existing Record
record_2 = {
   'store': "Davis Square Farmers' Market",
   'list': ['garlic, 'green pepper', 'onion', 'celery'],
}
update_record = client.record_update(
      cluster_id, 
      record_position._rid,
      record_2,
      record_position._version
)

# Attach Operations to Transaction
tx.attach(new_record)
tx.attach(update_record)

# Commit the Transaction
results = tx.commit()

assert results["#3:1"].store == "Davis Square Farmers' Market"
assert results["#3:2"].store == "McKinnon's Meat Market"
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pyorient-transactions---attach"><a class="header" href="#pyorient-transactions---attach">PyOrient Transactions - <code>attach()</code></a></h1>
<p>This method attaches operations to particular transactions.</p>
<h2 id="attaching-operations"><a class="header" href="#attaching-operations">Attaching Operations</a></h2>
<p>When you initialize a transaction through the <a href="pyorient/PyOrient-Client-Tx-Commit.html"><code>tx_commit()</code></a> client method, the return object provides you with several methods used in controlling the transaction process.  Using the <code>attach()</code> method, you can associate various client operations with the transaction.</p>
<p>You can then call <a href="pyorient/PyOrient-Tx-Commit.html"><code>commit()</code></a> to apply the changes to OrientDB.  In the event that you aren't satisfied with the changes, you can revert the database to an earlier state by calling <a href="pyorient/PyOrient-Tx-Rollback.html"><code>rollback()</code></a>.</p>
<p><strong>Syntax</strong></p>
<pre><code>tx.attach(&lt;record&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;record&gt;</code></strong> Defines the PyOrient return object for a database operation you want to add to the transaction.  For instance, the return object for the <a href="pyorient/PyOrient-Client-Record-Create.html"><code>record_create()</code></a> or <a href="pyorient/PyOrient-Client-Record-Update.html"><code>record_update</code></a> client methods.</li>
</ul>
<p><strong>Example</strong></p>
<p>Consider the example of a smart home system that uses OrientDB for back-end storage.  Say that your application uses the database to store configuration options, such as how often to take readings from environmental sensors or where it should stream the video feed from security cameras.</p>
<pre><code># Prepare Update
updated_config = {
"sensorReadInterval": 15
}
update = client.record_update(cluster_id, '#2:1', updated_config)

# Attach to Transaction
tx.attach(update)
</code></pre>
<p>Here, the configuration record, (that is, #2:1), is updated with a new value assigned to the <code>sensorInterval</code> property.  When you commit the transaction, it updates the interval on environmental sensors to take readings every fifteen minutes.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pyorient-transactions---begin"><a class="header" href="#pyorient-transactions---begin">PyOrient Transactions - <code>begin()</code></a></h1>
<p>This method initiates a transaction.</p>
<h2 id="beginning-transactions-6"><a class="header" href="#beginning-transactions-6">Beginning Transactions</a></h2>
<p>When you initialize a transaction through the <a href="pyorient/PyOrient-Client-Tx-Commit.html"><code>tx_commit()</code></a> client method, the return object provides you with several methods used in controlling the transaction process.  Using the <code>begin()</code> method, you can initiate a transaction on this object.</p>
<p>Beginning a transactions effectively saves the database state.  In the event that there is a problem with operations made after this point, you can revert the database back to this point using the <a href="pyorient/PyOrient-Tx-Rollback.html"><code>rollback()</code></a> method.  Alternatively, you can commit the changes to the database using the <a href="pyorient/PyOrient-Tx-Commit.html"><code>commit()</code></a> method.</p>
<p><strong>Syntax</strong></p>
<pre><code>tx.begin()
</code></pre>
<p><strong>Example</strong></p>
<p>For instance, say for a web application you want to create a series of new records on the database through a transaction.  This ensures that, in the event that something goes wrong in the process, you can revert the database to its earlier state rather than committing an incomplete operation.</p>
<pre><code class="language-py"># Initialize Transaction Control Object
tx = client.tx_commit()

# Begin Transaction
tx.begin()

try:
   # Create Records
   for record in records:
      new = client.record_create(cluster_id, record)
      tx.attach(new)
except:
   tx.rollback()

# Commit Changes
tx.commit()
</code></pre>
<p>Here, your application has an array of records stored in the <code>records</code> object.  It initializes a transaction object with the <a href="pyorient/PyOrient-Client-Tx-Commit.html"><code>tx_commit()</code></a> client method, then begins the transaction with <code>begin()</code>.  Within a <code>try</code> statement, it loops through this array, using the <a href="pyorient/PyOrient-Client-Record-Create.html"><code>record_create()</code></a> method to create new records.  After it creates the record, it attaches the operations to the open transaction.</p>
<p>In the event that there is a problem, Python executes the <code>except</code> statement, which calls <a href="pyorient/PyOrient-Tx-Rollback.html"><code>rollback()</code></a>, reverting the database to its earlier state.  If it's able to create all the records in the array, it issues the <a href="pyorient/PyOrient-Tx-Commit.html"><code>commit()</code></a> method to commit the changes to the database.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pyorient-transactions---commit"><a class="header" href="#pyorient-transactions---commit">PyOrient Transactions - <code>commit()</code></a></h1>
<p>This method commits the open transaction.</p>
<h2 id="committing-transactions"><a class="header" href="#committing-transactions">Committing Transactions</a></h2>
<p>When you initialize a transaction through the <a href="pyorient/PyOrient-Client-Tx-Commit.html"><code>tx_commit()</code></a> client method, the return object provides you with several methods used in controlling the transaction process.  Using the <code>commit()</code> method, you close the transaction committing all modifications to the database.</p>
<p><strong>Syntax</strong></p>
<pre><code>tx.commit()
</code></pre>
<p><strong>Example</strong></p>
<p>For instance, say for a web application you want to create a series of new records on the database through a transaction.  This ensures that, in the event that something goes wrong in the process, you can revert the database to its earlier state rather than committing an incomplete operation.</p>
<pre><code class="language-py"># Initialize Transaction Control Object
tx = client.tx_commit()

# Begin Transaction
tx.begin()

try:
   # Create Records
   for record in records:
      new = client.record_create(cluster_id, record)
      tx.attach(new)
except:
   tx.rollback()

# Commit Changes
tx.commit()
</code></pre>
<p>Here, your application has an array of records stored in the <code>records</code> object.  It initializes a transaction object with the <a href="pyorient/PyOrient-Client-Tx-Commit.html"><code>tx_commit()</code></a> client method, then begins the transaction with <a href="pyorient/PyOrient-Tx-Begin.html"><code>begin()</code></a>.  Within a <code>try</code> statement, it loops through this array, using the <a href="pyorient/PyOrient-Client-Record-Create.html"><code>record_create()</code></a> method to create new records.  After it creates the record, it attaches the operations to the open transaction.</p>
<p>In the event that there is a problem, Python executes the <code>except</code> statement, which calls <a href="pyorient/PyOrient-Tx-Rollback.html"><code>rollback()</code></a>, reverting the database to its earlier state.  If it's able to create all the records in the array, it issues the <code>commit()</code> method to commit the changes to the database.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pyorient-transactions--rollback"><a class="header" href="#pyorient-transactions--rollback">PyOrient Transactions = <code>rollback()</code></a></h1>
<p>This method rolls the database back to an earlier state, removing any changes made on the open transaction.</p>
<h2 id="rolling-back-transactions"><a class="header" href="#rolling-back-transactions">Rolling Back Transactions</a></h2>
<p>When you initialize a transaction through the <a href="pyorient/PyOrient-Client-Tx-Commit.html"><code>tx_commit()</code></a> client method, the return object provides you with several methods used in controlling the transaction process.  Using the <code>rollback()</code> method, you can close the transaction, reverting all associated changes made to the database.</p>
<p><strong>Example</strong></p>
<p>For instance, say for a web application you want to create a series of new records on the database through a transaction.  This ensures that, in the event that something goes wrong in the process, you can revert the database to its earlier state rather than committing an incomplete operation.</p>
<pre><code class="language-py"># Initialize Transaction Control Object
tx = client.tx_commit()

# Begin Transaction
tx.begin()

try:
   # Create Records
   for record in records:
      new = client.record_create(cluster_id, record)
      tx.attach(new)
except:
   tx.rollback()

# Commit Changes
tx.commit()
</code></pre>
<p>Here, your application has an array of records stored in the <code>records</code> object.  It initializes a transaction object with the <a href="pyorient/PyOrient-Client-Tx-Commit.html"><code>tx_commit()</code></a> client method, then begins the transaction with <a href="pyorient/PyOrient-Tx-Begin.html"><code>begin()</code></a>.  Within a <code>try</code> statement, it loops through this array, using the <a href="pyorient/PyOrient-Client-Record-Create.html"><code>record_create()</code></a> method to create new records.  After it creates the record, it attaches the operations to the open transaction.</p>
<p>In the event that there is a problem, Python executes the <code>except</code> statement, which calls <code>rollback()</code>, reverting the database to its earlier state.  If it's able to create all the records in the array, it issues the <a href="pyorient/PyOrient-Tx-Commit.html"><code>commit()</code></a> method to commit the changes to the database.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pyorient-ogm"><a class="header" href="#pyorient-ogm">PyOrient OGM</a></h1>
<p>Where the PyOrient Client is a wrapper for the <a href="pyorient/../internals/Network-Binary-Protocol.html">Binary Protocol</a>, the Object-Graph Mapper provides a higher-level object-oriented Pythonic interface for Graph databases in OrientDB.  It is comparable to the use of ORM's with Relational databases.</p>
<p>The purpose of the OGM is to make interactions with large and complex Graph databases more understandable and easier to maintain.  It bridges the gap between higher level object-oriented concepts in your application and the vertices and edges in your database.</p>
<h2 id="understanding-the-ogm"><a class="header" href="#understanding-the-ogm">Understanding the OGM</a></h2>
<p>What the OGM does is that it maps Python objects to classes and properties in OrientDB.  Your application can then operate on objects as it would normally, with PyOrient operating on the database in the background.</p>
<ul>
<li>
<p>When you have an existing OrientDB database schema, the PyOrient OGM can map the schema classes to Python classes in your application.</p>
</li>
<li>
<p>When you have an existing Python application, the PyOrient OGM can build a database schema in OrientDB from the Python classes in your application.</p>
</li>
</ul>
<blockquote>
<p>Whichever method you choose to adopt, once you have built the database and mapped its schema to your Python classes, you can execute queries against it.  You can do this using the OrientDB console or from within your application.</p>
<p>Currently, the mapper does not support <a href="pyorient/../sql/SQL-Traverse.html"><code>TRAVERSE</code></a> and it's support for Gremlin is functional, but limited.</p>
</blockquote>
<h2 id="using-the-ogm"><a class="header" href="#using-the-ogm">Using the OGM</a></h2>
<ul>
<li><a href="pyorient/PyOrient-OGM-Connection.html"><strong>Database Connections</strong></a></li>
<li><a href="pyorient/PyOrient-OGM-Schemas.html"><strong>Working with Schemas</strong></a></li>
<li><a href="pyorient/PyOrient-OGM-Brokers.html"><strong>Working with Brokers</strong></a></li>
<li><a href="pyorient/PyOrient-OGM-Batch.html"><strong>Batch Transactions</strong></a></li>
<li><a href="pyorient/PyOrient-OGM-Scripts.html"><strong>Scripting</strong></a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pyorient-ogm---connection"><a class="header" href="#pyorient-ogm---connection">PyOrient OGM - Connection</a></h1>
<p>In order to use the Object-Graph Mapper with your application, you first need to connect to a running OrientDB Server.  In PyOrient, there are two interface classes used in this process and you can access them through an <code>import</code> statement:</p>
<pre><code class="language-py"># Module Imports
from pyorient.ogm import Graph, Config
</code></pre>
<ul>
<li>
<p><strong><code>pyorient.ogm.Graph</code></strong> Wraps the lower-level PyOrient Client, that is, <code>pyorient.OrientDB()</code> and adds to it support for mapping Python classes to OrientDB database schemas and database schemas to Python Classes.</p>
</li>
<li>
<p><strong><code>pyorient.ogm.Config</code></strong> Provides an interface for defining how the OGM connects to OrientDB.</p>
</li>
</ul>
<h2 id="connecting-to-orientdb"><a class="header" href="#connecting-to-orientdb">Connecting to OrientDB</a></h2>
<p>When the PyOrient OGM connects to OrientDB, it uses the <code>pyorient.ogm.Config</code> class to define the specific database and credentials it uses in establishing the connection.</p>
<p><strong>Syntax</strong></p>
<pre><code>Config.from_url(
      &lt;database-url&gt;, 
      &lt;user&gt;, 
      &lt;password&gt;, 
      initial_drop = False)
</code></pre>
<ul>
<li><strong><code>&lt;database-url&gt;</code></strong> Defines the database.</li>
<li><strong><code>&lt;user&gt;</code></strong> Defines the username.</li>
<li><strong><code>&lt;password&gt;</code></strong> Defines the user password.</li>
<li><strong><code>initial_drop</code></strong> Defines whether PyOrient should drop any existing databases that share this configuration.</li>
</ul>
<p>For the database URL, you have the option of using one of several supported formats:</p>
<ul>
<li>Connecting to a PLocal database:
<ul>
<li><code>localhost/&lt;database-name&gt;</code></li>
<li><code>plocal://localhost:&lt;port&gt;/&lt;database-name&gt;</code></li>
</ul>
</li>
<li>Connecting to a Memory database:
<ul>
<li><code>&lt;database-name&gt;</code></li>
<li><code>memory://localhost:&lt;port&gt;/&lt;database-name&gt;</code></li>
</ul>
</li>
</ul>
<p><strong>Example</strong></p>
<p>For instance, say that you have a smart home system written in Python that uses OrientDB for back-end database storage.  You might use something like this to set up the database connection for your application:</p>
<pre><code class="language-py"># Connect to Database
Config.from_url(
   'plocal://localhost:2424/smarthome',
   'root', 'root_passwd')
</code></pre>
<h3 id="connecting-with-graph-object"><a class="header" href="#connecting-with-graph-object">Connecting with Graph Object</a></h3>
<p>In addition to basic connection described above, you can also pass the connection configuration when you initialize the <code>Graph</code> object.  For instance,</p>
<pre><code class="language-py">graph = Graph(
      Config.from_url(
         'localhost/smarthome',
	 'root', 'root_passwd'))
</code></pre>
<p>This initializes a <code>graph</code> instance of the <code>pyorient.ogm.Graph</code> class and defines how you want the OGM to connect to OrientDB.  You can then use <code>graph</code> in your applications to access further PyOrient OGM methods.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pyorient-ogm---schemas"><a class="header" href="#pyorient-ogm---schemas">PyOrient OGM - Schemas</a></h1>
<p>By definition, an OGM maps objects in your application to classes in a Graph Database.  In doing so, it defines a schema in the database to match classes and sub-classes in the application.</p>
<h2 id="building-schemas-from-classes"><a class="header" href="#building-schemas-from-classes">Building Schemas from Classes</a></h2>
<p>PyOrient only maps classes to the database schema that belong to the registry on your PyOrient <code>Graph</code> object.  There are two types of registries, one indicating a vertex, (or node), and the other an edge, (or relationship).  Adding Python classes to the registries is handled through subclassing.  For instance,</p>
<pre><code class="language-py">from pyorient.ogm import declarative

# Initialize Registries
Node = declarative.declarative_node()
Relationship = declarative.declarative_relationship()

# Create Vertex Class
class Person(Node):
   pass

# Create Edge Class
class Likes(Relationship):
   pass
</code></pre>
<p>Each call made to the <code>declarative_node()</code> and <code>declarative_relationship()</code> methods creates a new registry.  The OGM preserves inheritance hierarchies of nodes and relationships.  This registry is now accessible through <code>Node.registry</code> and <code>Relationship.registry</code>.</p>
<p>To create the corresponding classes in the OrientDB database schema, pass the registries to the <code>Graph</code> object, using the <code>create_all()</code> method.  For instance,</p>
<pre><code class="language-py"># Initialize Schema
self.g.create_all(Node.registry)
self.g.create_all(Relationship.registry)
</code></pre>
<p>In the event that these classes already exist in your database schema, and you want to bind the Python objects too them rather than creating the schema anew, use the <code>include</code> method.</p>
<pre><code class="language-py"># Bind Schema
self.g.include(Node.registry)
self.g.include(Relationship.registry)
</code></pre>
<h2 id="building-classes-from-schemas"><a class="header" href="#building-classes-from-schemas">Building Classes from Schemas</a></h2>
<p>Currently, PyOrient does not have a tool for automatically generating Python code from a database schema, but it come close.  Using the <code>build_mapping()</code> method, you can generate a dictionary of Python classes, (that is, a registry).  You can then pass the dictionary to the <code>include()</code> method on the PyOrient <code>Graph</code> class.</p>
<p>For instance,</p>
<pre><code class="language-py">from pyorient.ogm.declarative import declarative_node, declarative_relationship

# Initial Schema Objects
SchemaNode = declarative_node()
SchemaRelationship = delcarative_relationship()

# Retrieve Schema from OrientDB
classes_from_schema = graph.build_mapping(
   SchemaNode,
   SchemaRelationship,
   auto_plural = True)

# Initialize Schema in PyOrient
graph.include(classes_from_schema)

</code></pre>
<p>Here, dynamically generated vertex classes have <code>SchemaNode</code> as their the top-level of their inheritance, while edge classes have <code>SchemaRelationship</code>.  By setting the <code>auto_plural</code> parameter to <code>True</code>, the subsequent <code>include()</code> method automatically assigns brokers to <code>graph</code> object.</p>
<blockquote>
<p>In the event that you would like to use custom names for your brokers, (such as, brokers that use the actual plural nouns), you need to perform some kind of post processing on the dict returned to <code>classes_from_schema</code>.  For instance, iterating through the broker names and adding "<code>s</code>" to the end of the string.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pyorient-ogm---brokers"><a class="header" href="#pyorient-ogm---brokers">PyOrient OGM - Brokers</a></h1>
<p>The mapping that the PyOrient OGM creates between Python classes and the OrientDB database schema happens on a few different levels.  In <a href="pyorient/PyOrient-OGM-Schemas.html">Schemas</a> you can see how it forms connections between classes in your application and database.  Brokers handle the mapping between objects in a given Python class and the specific vertices and edges in the OrientDB database.</p>
<h2 id="using-brokers"><a class="header" href="#using-brokers">Using Brokers</a></h2>
<p>When the OGM creates a mapping between Python classes and vertex or edges classes in the OrientDB schema, for each class it creates a broker to handle instances of that class.  The broker provides you with an interface in working with various types of vertices and edges in your graph.  They can also reduce coupling and hide the classes that you have mapped, to help focus on the interfaces that they expose.</p>
<p>For instance, consider the example of a smart home application that uses OrientDB as its back-end database.  You might create a class in your application and on OrientDB to manage home-built Arduino or Micro Python environmental sensors.</p>
<pre><code class="language-py"># Initialize Graph Database
graph = pyorient.ogm.Graph(
   pyorient.ogm.Config.from_url(
      'smarthome', 'root', 'root'))
Node = pyorient.ogm.declarative.declarative_node()

# Sensor Control Class
class Sensor(Node):
   element_plural = 'sensors'
   name = String()
   zone = String()

# Create a 'sensors' bject and set the 'objects' attribute
graph.include(Node.registry)
</code></pre>
<p>In the example, you create a Python class for your sensors and register it with the OGM.  Given that you already have sensor data on OrientDB, you use the <code>include()</code> method to map the registry to a vertex class in OrientDB.</p>
<p>When you create classes that map to vertex and edge classes in OrientDB, you must define a particular attribute: <code>element_plural</code> for a node and <code>label</code> for a relationship.  PyOrient uses this class variable in setting the broker attribute for the class.  Meaning that, in the example above, <code>Sensor.objects</code> and <code>graph.sensors</code> are synonymous.  Thus,</p>
<pre><code class="language-py"># Create Smoke Alarm (Method 1)
g.sensors.create(
   name = 'smokeAlarm',
   zone = 'kitchen')

# Create Light Sensor (Method 2)
Sensor.objects.create(
   name = 'lightSensor',
   zone = 'kitchen')
</code></pre>
<p>Creating vertex classes without <code>element_plural</code> attribute or edge classes without the <code>label</code> attribute, cause PyOrient to not create a broker.  Meaning, in such cases, the first method shown above won't work.</p>
<p>You can then query the results using the <code>query()</code> method:</p>
<pre><code class="language-py">results = graph.query(Sensor, name = 'smokeAlarm')
</code></pre>
<h3 id="manual-vertex-and-edge-creation"><a class="header" href="#manual-vertex-and-edge-creation">Manual Vertex and Edge Creation</a></h3>
<p>The <code>create()</code> method show above hides whether you are creating a vertex or an edge in OrientDB.  Using the manual create methods <code>create_vertex()</code> and <code>create_edge()</code>, you can optionally make your application more explicit.  For instance,</p>
<pre><code class="language-py">graph.create_vertex(
   Sensor,
   name = 'smokeAlarm', 
   zone = 'kitchen')
</code></pre>
<h2 id="working-with-properties-3"><a class="header" href="#working-with-properties-3">Working with Properties</a></h2>
<p>In the example above, when the OGM maps the Python <code>Sensor</code> class to OrientDB, attributes on that class map to properties on the vertex, (that is, <code>name</code> and <code>zone</code>).  OrientDB and PyOrient support a range of property types.  Some basic examples are,</p>
<div class="table-wrapper"><table><thead><tr><th>Numeric Types</th><th>Other</th></tr></thead><tbody>
<tr><td>Boolean</td><td>String</td></tr>
<tr><td>Byte</td><td>Date</td></tr>
<tr><td>Integer</td><td>DateTime</td></tr>
<tr><td>Short</td><td>Binary</td></tr>
<tr><td>Long</td><td>Embedded</td></tr>
<tr><td>Float</td><td></td></tr>
<tr><td>Double</td><td></td></tr>
<tr><td>Decimal</td><td></td></tr>
</tbody></table>
</div>
<blockquote>
<p>For more information on types supported by OrientDB, see <a href="pyorient/../general/Types.html">Types</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pyorient-ogm---batch-operations"><a class="header" href="#pyorient-ogm---batch-operations">PyOrient OGM - Batch Operations</a></h1>
<p>The Object-Graph Mapper provides basic support for transactions.  This allows you to group several operations together and execute them in a batch on the OrientDB database.  You may find this useful in ensuring concurrency as well as reducing the round-trip time on the given operation.</p>
<h2 id="using-batch-transactions"><a class="header" href="#using-batch-transactions">Using Batch Transactions</a></h2>
<p>Transactions in PyOrient use a similar workflow to transactions in OrientDB.  That is, you start by beginning the transaction, perform various operations as part of it, then commit those changes to the database.</p>
<h3 id="initializing-batch-transactions"><a class="header" href="#initializing-batch-transactions">Initializing Batch Transactions</a></h3>
<p>Unlike standard operations with the OGM, batch transactions operate on a separate object from the OGM <code>Graph</code> class.  Instead, you use the <code>batch()</code> method to initialize a control object for the transaction.  You can then direct operations on OrientDB through this object, only committing it to OrientDB when you're ready.</p>
<pre><code class="language-py"># Initialize Batch Transaction
batch = graph.batch()
</code></pre>
<h3 id="performing-operations"><a class="header" href="#performing-operations">Performing Operations</a></h3>
<p>Once you've initialized the control object through the <code>batch()</code> method, you can begin building the transaction.  For instance, consider the example of a smart home application that uses OrientDB for back-end storage.  While home built systems often have the database server on premises, let's say that you expect some homes to rely on a remote database accessed through the internet.</p>
<p>In situations like this, database initialization can prove difficult, since it would involve multiple network requests to OrientDB.  Instead you can group this process into a batch transaction handled through a single network operation.</p>
<h4 id="initialize-classes"><a class="header" href="#initialize-classes">Initialize Classes</a></h4>
<p>In preparing a batch operation to initialize the database, you might start by initializing the classes that you want to create:</p>
<pre><code class="language-py"># Initialize Sensor Class
class Sensor(Node):
   element_type = 'sensor'
   element_plural = 'sensors'

   name = String(multibyte = False, unique = True)
   node_type = String(multibyte = False)

# Initialize Zone Class
class Zone(Node):
   element_type = 'zone'
   element_plural = 'zones'

   name = String(multibyte = False, unique = True)
   zone_type = String(multibyte = False)

# Initialize Position Class
class SensorPosition(Relationship):
   label = 'position'
</code></pre>
<p>Here, you create three classes: two vertex classes for sensors and zones in the house, and an edge class for to position the sensors in particular zones.  The special attribute <code>element_type</code> is redundant here, but it allows you to tell the mapper what name to use for the corresponding schema class.</p>
<h4 id="creating-vertices-5"><a class="header" href="#creating-vertices-5">Creating Vertices</a></h4>
<p>With the classes created, you can create particular instances of these classes, then adding them to the batch transaction:</p>
<pre><code class="language-py"># Create Pollen Sensor
batch['pollen-sensor-1452'] = batch.sensors.create(
   name = 'ARDUINO-UNO-1432', 
   node_type = 'pollen')

# Create Light Sensor
batch['light-sensor-259'] = batch.sensors.create(
   name = 'ARDUINO-UNO-259',
   node_type = 'light-sensor')

# Create Bedroom Zone
batch['master-bedroom'] = batch.zones.create(
   name = 'master',
   zone_type = 'bedroom'
</code></pre>
<p>This creates three vertices in the batch: one for an Arduino device built as a pollen sensor, one for a light sensor,  and one for a zone for the master bedroom.</p>
<h4 id="creating-edges-6"><a class="header" href="#creating-edges-6">Creating Edges</a></h4>
<p>With the vertices created, you can also create edges to connect them.  In doing so, you have the option of two syntax methods for the operation.</p>
<pre><code class="language-py"># Place Pollen Sensor (Method 1)
batch[:] = batch.position.create(
   batch[:'pollen-sensor-1452'],
   batch[:'master-bedroom']).retry(20)

# Place Light Sensor (Method 2)
batch[:] = batch[:'light-sensor-259'](SensorPosition) &gt; batch[:'master-bedroom']
</code></pre>
<p>In the example, notice that in both cases the code defines the relationship using slice syntax.  You can do this in cases where you don't need to reference the edge later in the batch transaction.</p>
<h4 id="return-values"><a class="header" href="#return-values">Return Values</a></h4>
<p>In the event that you would like to perform further operations on the code before committing the transaction, batches provide an optional return value.  You can retrieve this value from the control object:</p>
<pre><code class="language-py"># Fetch Pollen Sensor Return Value
pollen = batch['$pollen-sensor-1452']
</code></pre>
<p>This retrieves the return value and sets it on the <code>pollen</code> variable.</p>
<h3 id="committing-batch-transactions"><a class="header" href="#committing-batch-transactions">Committing Batch Transactions</a></h3>
<p>When you're finished with the batch transaction, you can commit it to OrientDB using the <code>commit()</code> method.</p>
<pre><code class="language-py"># Cmmmit Batch Transaction
batch.commit()
</code></pre>
<p>When you issue this method, PyOrient sends a network request to OrientDB, then executes each operation in the batch through that single request, without the need for the usual back and forth between the two.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pyorient-ogm---scripts"><a class="header" href="#pyorient-ogm---scripts">PyOrient OGM - Scripts</a></h1>
<p>In addition to the <a href="pyorient/PyOrient-Client.html">Client</a> and the standard OGM methods shown above, you can also operate on the OrientDB database.  This provides you with basic support for <a href="pyorient/../gremlin/Gremlin.html">Gremlin</a> graph traversal, through Groovy scripts.</p>
<h2 id="working-with-scripts"><a class="header" href="#working-with-scripts">Working with Scripts</a></h2>
<p>In order to use scripts in your application, you first need to add them to the OGM <code>Graph</code> class.  Once added, you can call them from within your application, using the <code>gremlin()</code> method.</p>
<p>For instance, say that you want to add a set of Groovy scripts from the <code>scripts/</code> directory.  You might use something like this to do so:</p>
<pre><code class="language-py"># Module Imports
import pathlib
from pyorient.groovy import GroovyScripts

# Iterate through scripts/
for path in pathlib.Path('scripts/').iterdir():

   # Check if Groovy Script
   if path.is_file() and path.suffix == '.groovy':

      # Add Script
      graph.scripts.add(GroovyScripts.from_file(str(path)))
</code></pre>
<p>Here, your application uses the <code>pathlib</code> module to iterate over each file and directory in the <code>scripts/</code> directory.  For each instance, it checks whether the instance is a file with the <code>.groovy</code> extension.  It then parses out functions found in these files and adds them to the <code>scripts</code> attribute.</p>
<h3 id="using-scripts"><a class="header" href="#using-scripts">Using Scripts</a></h3>
<p>Scripts that you add to the <code>scripts</code> attribute are callable through the <code>gremlin()</code> method.  For the example of the smart home application, let's say that you have a <code>compile_data()</code> function that compiles sensor data in building charts for the web interface.  You give it the type of sensor you want to read and it iterates through each zone as data points for the charts.</p>
<pre><code class="language-py">pollen_chart = graph.gremlin('compile_data', 'pollen')
</code></pre>
<p>This runs the <code>compile_data()</code> function, passing the string <code>pollen</code> to it, to indicate that you would like to compile data from pollen sensors.  It then returns the results to the <code>pollen_chart</code> variable.</p>
<blockquote>
<p><strong>NOTE</strong>: In the event that you need namespacing, both the <code>add()</code> and <code>gremlin()</code> methods allow you to set <code>namespace</code> arguments.  Using this, you can separate different functions with the same name.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-net---cnet-driver"><a class="header" href="#orientdb-net---cnet-driver">OrientDB-NET - C#/.NET Driver</a></h1>
<p>OrientDB provides driver support through a network binary protocol.  This allows you to manage servers through various API's and drivers.  You can access the database through a C#/.NET application using the OrientDB-NET.binary driver.</p>
<blockquote>
<p>The OrientDB .NET SDK is currently being rewritten as a modular SDK.  If you would like to check it out and help drive the direction of the new version, navigate to <a href="https://github.com/orientechnologies/OrientDB.NET.Core">OrientDB.NET.Core</a>.</p>
</blockquote>
<h2 id="installation-10"><a class="header" href="#installation-10">Installation</a></h2>
<p>The OrientDB-NET driver is not included by default in your OrientDB installation.  In order to use it, you must install it separately on your system.</p>
<blockquote>
<p>For information on how to install OrientDB itself, see <a href="dotnet/../gettingstarted/Tutorial-Installation.html">Installing OrientDB</a>.</p>
</blockquote>
<h3 id="installing-from-nuget"><a class="header" href="#installing-from-nuget">Installing from NuGet</a></h3>
<p>NuGet is a package manager available for C#/.NET development environments.  It is accessible through Visual Studio and through the <code>nuget</code> command-line interface on Windows, macOS and on Linux through Mono.</p>
<p>The package name is <a href="https://www.nuget.org/packages/OrientDB-Net.binary.Innov8tive"><code>OrientDB-Net.binary.Innov8tive</code></a></p>
<ul>
<li>
<p>Using the package management console in Visual Studio, run the following command:</p>
<pre>
PM> <code class="lang-powershell userinput">Install-Package OrientDB-Net.binary.Innov8tive</code>
</pre>
</li>
<li>
<p>Using the NuGet command-line application, run the following command from your project directory:</p>
<pre>
$ <code class="lang-sh userinput">nuget install OrientDB-Net-Innov8tive</code>
</pre>
</li>
</ul>
<h4 id="sendfailure-errors"><a class="header" href="#sendfailure-errors">SendFailure Errors</a></h4>
<p>While most C#/.NET applications run on Microsoft Windows, it is now also possible to develop them to work with Linux and FreeBSD.</p>
<p>When using NuGet for the first time on these operating systems, you may encounter errors whenever it attempts to connect to the configured software repositories.  For instance,</p>
<pre>
$ <code class="lang-sh userinput">nuget install OrientDB-Net.binary.Innov8tive</code>
WARNING: SendFailure (Error writing headers)
WARNING: An error occurred while loading packages from 
'https://www.nuget.org/api/v2': Error SendFailure
(Error writing headers)
Unable to find package 'OrientDB-NET.binary'
</pre>
<p>These errors occur in new installations of Mono or in similar cases where NuGet cannot locate the certificates it requires to securely download packages from Microsoft and the NuGet repositories.</p>
<p>You can download these certificates using the Mono Certificate Manager, through the following commands:</p>
<pre>
# <code class="lang-sh userinput">certmgr -ssl -m https://go.microsoft.com</code>
# <code class="lang-sh userinput">certmgr -ssl -m https://nugetgallery.blob.core.windows.net</code>
# <code class="lang-sh userinput">certmgr -ssl -m https://nuget.org</code>
</pre>
<p>You can now install packages through NuGet.</p>
<h2 id="using-orientdb-net"><a class="header" href="#using-orientdb-net">Using OrientDB-NET</a></h2>
<p>Once you have installed OrientDB and the OrientDB-NET.binary driver, you can begin to develop your C#/.NET application.  In order to utilize OrientDB-NET functions and classes, set the relevant namespace with the <code>using</code> directive.</p>
<pre><code class="language-cs">using Orient.Client;
</code></pre>
<ul>
<li><a href="dotnet/NET-Server.html"><strong>Server</strong></a> Documents the <code>OServer</code> interface, used when operating on the OrientDB Server to manage server-level configuration as well as creating, removing and listing databases on the server.</li>
<li><a href="dotnet/NET-Database.html"><strong>Database</strong></a> Documents the <code>ODatabase</code> interface, used when operating on particular OrientDB databases to manage clusters, operate on records and issue scripts, queries and commands.</li>
<li><a href="dotnet/NET-Query.html"><strong>Queries</strong></a> Provides a guide to building queries.</li>
<li><a href="dotnet/NET-Transactions.html"><strong>Transaction</strong></a> Documents the <code>OTransaction</code> interface, used when operating on OrientDB databases through transactions.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-net---oserver"><a class="header" href="#orientdb-net---oserver">OrientDB-NET - <code>OServer</code></a></h1>
<p>This class provides an interface and methods for when you need to operate on the OrientDB Server from within your C#/.NET application.</p>
<p>Use this interface in cases where you need to retrieve or modify server configuration, create or remove databases or fetch information about those databases available on the server.  If you want to operate on a specific database, use the <a href="dotnet/NET-Database.html"><code>ODatabase</code></a> interface.</p>
<h2 id="initializing-oserver"><a class="header" href="#initializing-oserver">Initializing OServer</a></h2>
<p>When you enable the <code>Orient.Client</code> namespace through the <code>using</code> directive, you can create a server interface for your application by instantiating the <code>OServer</code> class.</p>
<h3 id="syntax-239"><a class="header" href="#syntax-239">Syntax</a></h3>
<pre><code>OServer(    string hostName, 
            int port, 
            string userName, 
            string userPasswd)
</code></pre>
<ul>
<li><strong><code>hostname</code></strong> Defines the host that you want to connect to, such as <code>localhost</code> or the IP address on which OrientDB is running.</li>
<li><strong><code>port</code></strong> Defines the port you want to connect to, such as 2424.</li>
<li><strong><code>userName</code></strong> Defines the Server user name.</li>
<li><strong><code>userPasswd</code></strong> Defines the Server user password.</li>
</ul>
<p>Once you have an instance of this class, you can begin to call methods on it to operate on the OrientDB Server.</p>
<h3 id="example-90"><a class="header" href="#example-90">Example</a></h3>
<p>In the interest of abstraction, you might create a class with methods to handle common OrientDB Server operations.  For instance, say you want a method that creates and returns a new <code>OServer</code> instance,</p>
<pre><code class="language-csharp">public static class Server
{
   private static string _hostname  = "localhost";
   private static int _port         = 2424;
   private static string _user      = "root";
   private static string _passwd    = "root_passwd";

   public static OServer Connect()
   {
      server = new OServer(_hostname, _port, 
            _root, _root_passwd);
      return server;
   }

}
</code></pre>
<p>With this <code>Server</code> class, you can use the <code>Connect()</code> method to retrieve a new instance of <code>OServer</code>.  You can then use this instance in various database operations.</p>
<h2 id="using-oserver"><a class="header" href="#using-oserver">Using OServer</a></h2>
<p>Once you have created an instance of <code>OServer</code> within your application, you can use its methods in performing various operations on databases, including,</p>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Return Value</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="dotnet/NET-Server-ConfigGet.html"><strong><code>ConfigGet()</code></strong></a></td><td><code>string</code></td><td>Retrieves a configuration value for the given variable.</td></tr>
<tr><td><a href="dotnet/NET-Server-ConfigList.html"><strong><code>ConfigList()</code></strong></a></td><td><code>Dictionary&lt;string, string&gt;</code></td><td>Retrieves the complete server configuration.</td></tr>
<tr><td><a href="dotnet/NET-Server-ConfigSet.html"><strong><code>ConfigSet()</code></strong></a></td><td><code>bool</code></td><td>Modifies the given configuration variable.</td></tr>
<tr><td><a href="dotnet/NET-Server-CreateDatabase.html"><strong><code>CreateDatabase()</code></strong></a></td><td><code>bool</code></td><td>Creates a database on the server.</td></tr>
<tr><td><a href="dotnet/NET-Server.html#closing-oserver"><strong><code>Close()</code></strong></a></td><td><code>void</code></td><td>Disposes of the OServer connection.</td></tr>
<tr><td><a href="dotnet/NET-Server-DatabaseExists.html"><strong><code>DatabaseExists()</code></strong></a></td><td><code>bool</code></td><td>Checks that database exists on server.</td></tr>
<tr><td><a href="dotnet/NET-Server-Databases.html"><strong><code>Databases()</code></strong></a></td><td><code>Dictionary&lt;string, ODatabaseInfo&gt;</code></td><td>Returns information on all databases on server.</td></tr>
<tr><td><a href="dotnet/NET-Server.html#closing-oserver"><strong><code>Dispose()</code></strong></a></td><td><code>void</code></td><td>Disposes of the OServer connection.</td></tr>
<tr><td><a href="dotnet/NET-Server-DropDatabase.html"><strong><code>DropDatabase()</code></strong></a></td><td><code>void</code></td><td>Removes the given database.</td></tr>
</tbody></table>
</div>
<h3 id="closing-oserver"><a class="header" href="#closing-oserver">Closing OServer</a></h3>
<p>When you are finished using an instance server interface, you can close it to free up system resources.  The <code>OServer</code> class provides two methods to close a server connection.</p>
<ul>
<li><strong><code>Close()</code></strong></li>
<li><strong><code>Dispose()</code></strong></li>
</ul>
<p>Given one is an alias, you can use whichever you find most familiar.  For instance, say that you have creating an <code>OServer</code> instance in your application and set it on the <code>server</code> object.  To dispose of this instance, call one of the above methods on that object.</p>
<pre><code class="language-csharp">// Close Server
server.Close();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-net---configget"><a class="header" href="#orientdb-net---configget">OrientDB-NET - <code>ConfigGet()</code></a></h1>
<p>This method retrieves the value of the given configuration variable from the server.  It returns the value as a string.</p>
<h2 id="retrieving-configuration-values"><a class="header" href="#retrieving-configuration-values">Retrieving Configuration Values</a></h2>
<p>In certain situations you may want to retrieve values from various configuration variables from the OrientDB Server.  You might find this useful when checking various settings to determine whether the server is ready for use by your application.</p>
<h3 id="syntax-240"><a class="header" href="#syntax-240">Syntax</a></h3>
<pre><code>string OServer.ConfigGet(string key)
</code></pre>
<ul>
<li><strong><code>key</code></strong> Defines the configuration variable that you want to check.</li>
</ul>
<p>This method returns a string of the current setting.</p>
<h3 id="example-91"><a class="header" href="#example-91">Example</a></h3>
<p>For instance, say that you are developing a basic unit test to evaluate whether the file-type is properly set for the transaction log.  You want the file-type set to classic-mode, but are worried that some databases in your distributed cluster may have the wrong configuration.</p>
<pre><code class="language-csharp">// FETCH TX.LOG FILETYPE
string txFileType = server.ConfigGet("tx.log.fileType"); 

Assert.AreEqual("classic", txFileType);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-net---configlist"><a class="header" href="#orientdb-net---configlist">OrientDB-NET - <code>ConfigList()</code></a></h1>
<p>This method returns the current configuration of the OrientDB Server as a dictionary of key/value pairs.</p>
<h2 id="retrieving-server-configuration-1"><a class="header" href="#retrieving-server-configuration-1">Retrieving Server Configuration</a></h2>
<p>In situations where you need to check multiple configuration variables on a server, you may find it beneficial to retrieve the entire server configuration set in one call rather than making multiple individual requests.</p>
<h3 id="syntax-241"><a class="header" href="#syntax-241">Syntax</a></h3>
<pre><code>Dictionary&lt;string, string&gt; OServer.ConfigList()
</code></pre>
<p>The return value is a dictionary of configuration variables and their current values.</p>
<h3 id="example-92"><a class="header" href="#example-92">Example</a></h3>
<p>When debugging your application, you may sometimes find it useful to consult the OrientDB Server configuration, to help in checking whether the server was set up properly for your usage.</p>
<p>Consider the use-case where you are working with OrientDB in a distributed cluster with dozens of servers running in-memory.  Whenever you add servers to your infrastructure, you need to evaluate several configuration variables before moving it to production.</p>
<pre><code class="language-csharp">using Orient.Client;
using System;
...

// WRITE SERVER CONFIGURATION TO CONSOLE
public Dictionary&lt;string, string&gt; ReportConfig(OServer server)
{
   // FETCH SERVER CONFIGURATION
   Dictionary&lt;string, string&gt; srvConfig = server.ConfigList();

   // WRITE HEADER
   Console.WriteLine("OrientDB Server Configuration");

   // LOOP OVER EACH CONFIG ENTRY
   foreach(KeyValuePair&lt;string, string&gt; entry in srvConfig)
   {

      // WRITE TO CONSOLE
      Console.WriteLine(" - {0}: {1}",
         entry.Key,
         entry.Value);
   }

   // RETURN CONFIGURATION FOR ADDITIONAL TESTING
   return srvConfig; 
}
</code></pre>
<p>Here, the function receives an <a href="dotnet/NET-Server.html"><code>OServer</code></a> interface as an argument.  Using this interface, it retrieves the current server configuration and loops over it, printing each variable and value to the console.  When it's done it returns the configuration dictionary, which you can then use to perform additional tests instead of making multiple calls to <a href="dotnet/NET-Server-ConfigGet.html"><code>ConfigGet()</code></a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-net---configset"><a class="header" href="#orientdb-net---configset">OrientDB-NET - <code>ConfigSet()</code></a></h1>
<p>This method changes the value of the given configuration variable on the OrientDB Server.  It returns a boolean value indicating whether the change was successful.</p>
<h2 id="setting-configuration-variables"><a class="header" href="#setting-configuration-variables">Setting Configuration Variables</a></h2>
<p>You may find that you want to change the values on various configuration variables for the OrientDB Server from within your application.  With this method you can do so through the <a href="dotnet/NET-Server.html"><code>OServer</code></a> instance.</p>
<h3 id="syntax-242"><a class="header" href="#syntax-242">Syntax</a></h3>
<pre><code>bool OServer.ConfigSet(
   string key,
   string value)
</code></pre>
<ul>
<li><strong><code>key</code></strong> Defines the configuration variable you want to change.</li>
<li><strong><code>value</code></strong> Defines the value you want to set on the variable.</li>
</ul>
<p>This method returns a boolean value, indicating whether OrientDB applied your change.</p>
<h3 id="example-93"><a class="header" href="#example-93">Example</a></h3>
<p>For instance, say that you have multiple OrientDB servers running in a distributed deployment.  You notice certain performance issues relating to network connectivity and decide to begin optimizing the <code>network.retry</code> parameter by changing its current setting to 6.</p>
<pre><code class="language-csharp">// UPDATE network.retry PARAMETER
bool IsUpdated = server.ConfigSet("network.retry", 6);
Assert.IsTrue(IsUpdated);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-net---createdatabase"><a class="header" href="#orientdb-net---createdatabase">OrientDB-NET - <code>CreateDatabase()</code></a></h1>
<p>This method creates a database on the connected OrientDB Server.  It then returns a boolean value to indicate that the operation was successful.</p>
<h2 id="creating-databases-4"><a class="header" href="#creating-databases-4">Creating Databases</a></h2>
<p>When you initialize your C#/.NET application, you may find it useful to provision an OrientDB database as part of the installation process.  This ensures that you'll have a database ready when you first run the application.  You can create databases on the OrientDB Server by calling the <code>CreateDatabase()</code> method on the <a href="dotnet/NET-Server.html"><code>OServer</code></a> interface.</p>
<h3 id="syntax-243"><a class="header" href="#syntax-243">Syntax</a></h3>
<pre><code>bool OServer.CreateDatabase(
   string name,
   ODatabaseType type,
   OStorageType storage)
</code></pre>
<ul>
<li><strong><code>name</code></strong> Defines the name of the database.</li>
<li><strong><code>type</code></strong> Defines the type of database you want to create, that is a Graph, Document or Object Database.</li>
<li><strong><code>storage</code></strong> Defines the type of storage you want to use. That is, physical or in-memory.</li>
</ul>
<p>When the operation is complete, the method returns a boolean value indicated that the new database now exists.</p>
<h3 id="examples-43"><a class="header" href="#examples-43">Examples</a></h3>
<p>For instance, imagine an application that utilizes a series of in-memory databases for various services that you want to provide.  You might construction a method such as this to use when provisioning new servers:</p>
<pre><code class="language-c-sharp">using Orient.Client;
using System;
...

// PROVISION ORIENTDB SERVER
public void InitServer(OServer server, string[] names)
{
   // LOG OPERATION 
   Console.WriteLine("Creating Databases:");

   // LOOP OVER DATABASE NAMES
   foreach(string name in names)
   {
      // CREATE DATABASE
      bool dbCheck = server.CreateDatabase(name,
         ODatabaseType.Graph,
         OStorageType.Memory);

      // REPORT CREATION 
      if(dbCheck) 
      {
         Console.WriteLine(" - SUCCESS: {0}", name);
      }
      else
      {
         Console.WriteLine(" - FAILURE: {0}", name);
      }
   }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-net---databaseexists"><a class="header" href="#orientdb-net---databaseexists">OrientDB-NET - <code>DatabaseExists()</code></a></h1>
<p>This method determines whether or not a database exists already on the OrientDB Server.  It returns a boolean value indicating what it finds.</p>
<h2 id="checking-databases-1"><a class="header" href="#checking-databases-1">Checking Databases</a></h2>
<p>In order to check that databases exist on the server, you first need to create an <a href="dotnet/NET-Server.html"><code>OServer</code></a> instance.  Once you have it, you can call the <a href="dotnet/NET-Server-DatabaseExists.html#"><code>DatabaseExists()</code></a> method on it.</p>
<h3 id="syntax-244"><a class="header" href="#syntax-244">Syntax</a></h3>
<pre><code>bool OServer.DatabaseExists(
   string &lt;name&gt;,
   OStorageType &lt;storage&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;name&gt;</code></strong> Defines the name of the database you want.</li>
<li><strong><code>&lt;storage&gt;</code></strong> Defines the storage type you want, such as PLocal or Memory.</li>
</ul>
<p>The method returns a boolean value, indicating whether or not it found the requested database on the server.</p>
<h3 id="example-94"><a class="header" href="#example-94">Example</a></h3>
<p>For instance, say that you have a complex application that utilizes several databases in-memory on an OrientDB Server.  The in-memory storage type is volatile and is lost in the event that the server shuts down or the host crashes.  As such, you may want to create a basic test function to determine whether a series of databases exist on the server before you attempt operations.  If the database doesn't exist, you'll need to create it.</p>
<pre><code class="language-csharp">using Orient.Client;
using System;
...

// CHECK THAT DATABASES EXIST
public void checkDatabases(OServer server, string[] databases)
{
   Console.WriteLine("Checking that databases exists...");

   // LOOP OVER EACH REQUIRED DATABASE
   foreach(string database in databases)
   {
      // DETERMINE IF DATABASE EXISTS
      bool dbExists = server.DatabaseExists(database,
         OStorageType.Memory);

      // CREATE DATABASE 
      if(dbExists == false)
      {
         Console.WriteLine("Database {0} doesn't exist, creating...",
            database);
         // CREATE NONEXISTENT DATABASE
         server.CreateDatabase(database,
            ODatabaseType.Graph,
            OStorageType.Memory);
      }

      // REPORT IF DATABASE EXISTS
      else
      {
          Console.WriteLine("Database {0} exists already",
             database);
      }
   }   
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-net---databases"><a class="header" href="#orientdb-net---databases">OrientDB-NET - <code>Databases()</code></a></h1>
<p>This method retrieves information on the current databases available on the OrientDB Server.  The return value is a dictionary of string keys and <code>ODatabaseInfo</code> objects.</p>
<h2 id="retrieving-database-information"><a class="header" href="#retrieving-database-information">Retrieving Database Information</a></h2>
<p>In certain situations you may need to operate on multiple databases on a given OrientDB Server, such as testing certain conditions on each database available.  When the given databases are arbitrary, (that is, the names are not fixed by variables within your application), you can retrieve all databases on the given <a href="dotnet/NET-Server.html"><code>OServer</code></a> instance using this method.</p>
<h3 id="syntax-245"><a class="header" href="#syntax-245">Syntax</a></h3>
<pre><code>Dictionary&lt;string, ODatabaseInfo&gt; OServer.Databases()
</code></pre>
<p>This method takes no arguments.  The return value is a dictionary with string value keys and <code>ODatabaseInfo</code> object values.  Each <code>ODatabaseInfo</code> object has three variables:</p>
<div class="table-wrapper"><table><thead><tr><th>Variable</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>DataBaseName</code></td><td><code>string</code></td><td>The database name</td></tr>
<tr><td><code>StorageType</code></td><td><code>OStorageType</code></td><td>The storage type, (PLocal or Memory)</td></tr>
<tr><td><code>Path</code></td><td><code>string</code></td><td>The database URL</td></tr>
</tbody></table>
</div>
<h3 id="examples-44"><a class="header" href="#examples-44">Examples</a></h3>
<p>Consider the use case of a long running OrientDB Server that has be utilized by several applications, including yours.  You intend to move your operation onto a fresh host, but want to back up those databases that were not part of your application.</p>
<pre><code class="language-csharp">using Orient.Client;
using System;
...

// CLEANUP SERVER
public void CleanServer(OServer server, string[] databaseNames, 
   string host, int, port, string user, string userPasswd, 
   string backupPath)
{
   // REPORT OPERATION
   Console.WriteLine("Cleaning OrientDB Server...");

   // FETCH DATABASE INFORMATION
   Dictionary&lt;string, ODatabaseInfo&gt; srvInfo = server.Databases();

   // LOOP OVER EACH DATABASE INSTANCE
   foreach(KeyValuePair&lt;string, ODatabaseInfo&gt; dbInfo in srvInfo)
   {
      string name = entry.Value.DataBaseName;

      // TEST IF DBNAME IN DATABASENAMES
      if(databaseNames.Contains(name))
      {
         // OPEN DATABASE
         ODatabase database = ODatabase(host, port, name,
            ODatabaseType.Graph, user, passwd);

         // FORMAT BACKUP COMMAND 
         string backupCommand = String.Format(
            "BACKUP DATABASE {0}/{1}.zip -compressionLevel=2",
            backupPath, name);
 
         // RUN COMMAND
         database.Command(backupCommand);

         // CLOSE DATABASE
         database.Close();
      }
   }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-net---dropdatabase"><a class="header" href="#orientdb-net---dropdatabase">OrientDB-NET - <code>DropDatabase()</code></a></h1>
<p>This method removes a database from the OrientDB Server.  It returns no value.</p>
<h2 id="removing-databases"><a class="header" href="#removing-databases">Removing Databases</a></h2>
<p>To remove a database from the server, you need to call the <code>DropDatabase()</code> method on the <a href="dotnet/NET-Server.html"><code>OServer</code></a> instance.</p>
<h3 id="syntax-246"><a class="header" href="#syntax-246">Syntax</a></h3>
<pre><code>void OServer.DropDatabase(
   string &lt;name&gt;,
   OStorageType &lt;storage&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;name&gt;</code></strong> Defines the name of the database you want to remove.</li>
<li><strong><code>&lt;storage&gt;</code></strong> Defines the storage type of the database.</li>
</ul>
<h3 id="example-95"><a class="header" href="#example-95">Example</a></h3>
<p>For instance, say you have an application that requires you to periodically reset databases, removing all records then initializing a new instance.</p>
<pre><code class="language-csharp">public void cleanDatabases(OServer server, string[] databaseNames)
{
   // LOOP OVER DATABASE NAMES ARRAY
   foreach(string name in databaseNames)
   {
      // REMOVE EXISTING DATABASE
      server.DropDatabase(name, OStorageType.Memory);

      // CREATE NEW DATABASE
      bool createdDb = server.CreateDatabase(name,
         ODatabaseType.Graph, OStorageType.Memory);

      // TEST
      Assert.IsTrue(createDb);
   }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-net---odatabase"><a class="header" href="#orientdb-net---odatabase">OrientDB-NET - <code>ODatabase</code></a></h1>
<p>This class provides an interface and methods for when you need to operate on OrientDB databases from within your C#/.NET application.</p>
<p>Use this interface in cases where you need to retrieve or manage clusters, operate on records or issue scripts, queries and commands to the database.  If you want to operate on the OrientDB Server as a whole or create or delete databases on the server, use the <a href="dotnet/NET-Server.html"><code>OServer</code></a> interface.</p>
<h2 id="initializing-the-database"><a class="header" href="#initializing-the-database">Initializing the Database</a></h2>
<p>When you enable the <code>Orient.Client</code> namespace through the <code>using</code> directive, you can create a database interface for your application by instantiating the <code>ODatabase</code> class.</p>
<h3 id="syntax-247"><a class="header" href="#syntax-247">Syntax</a></h3>
<pre><code>// INITIALIZE DATABASE
ODatabase(  string host, 
            int port,
            string name,
            ODatabaseType type,
            string user,
            string passwd)

// INITIALIZE DATABASE USING CONNECTION POOL
ODatabase(  string host,
            int port,
            string name,
            ODatabaseType type,
            string user,
            string passwd,
            string poolAlias)
</code></pre>
<ul>
<li><strong><code>host</code></strong> Defines the hostname or IP address of the OrientDB Server.</li>
<li><strong><code>port</code></strong> Defines the port to use in connecting to the server.</li>
<li><strong><code>name</code></strong> Defines the database name.</li>
<li><strong><code>type</code></strong> Defines the database type, that is PLocal or Memory.</li>
<li><strong><code>user</code></strong> Defines the user name.</li>
<li><strong><code>passwd</code></strong> Defines the user password.</li>
<li><strong><code>poolAlias</code></strong> Defines the alias to use for the connection pool.</li>
</ul>
<h3 id="example-96"><a class="header" href="#example-96">Example</a></h3>
<p>In the interest of abstraction, you might create a method to handle common OrientDB database operations for your application.</p>
<pre><code class="language-csharp">using Orient.Client;
using System;
...

// OPEN DATABASE
public ODatabase openDatabase(string _host, int _port,
       string _dbName, string _user, string _passwd)
{

   // CONSOLE LOG
   Console.WriteLine("Opening Database: {0}", _dbname);

   // OPEN DATABASE
   ODatabase database = ODatabase(_host, _port, _dbName, 
       ODatabaseType.Graph, _user, _passwd);

   // RETURN ODATABASE INSTANCE
   return database;
}
</code></pre>
<h4 id="using-a-connection-pool"><a class="header" href="#using-a-connection-pool">Using a Connection Pool</a></h4>
<p>Normally, OrientDB-NET clients operate through a single network connection.  When working with web applications or any situation where network bottlenecks are a concern, it is common to pool these connections to ensure better performance.</p>
<p>To use a connection pool pass a pool alias when you create the <code>ODatabase</code> interface.</p>
<pre><code class="language-csharp">ODatabase database = ODatabase("localhost", 2424,
   "microblog", ODatabaseType.PLocal, 
   "guestUser", "guest_passwd",
   "pool123");
</code></pre>
<h4 id="using-connection-options"><a class="header" href="#using-connection-options">Using Connection Options</a></h4>
<p>In addition to configuring the database interface through arguments passed to the <code>ODatabase</code> class, you can also create a configuration object independent of the class, through the <code>ConnectionOptions</code> class.  You may find this useful when you need to initialize several database instances with similar configuration.</p>
<p>The <code>ConnectionOptions</code> class has seven parameters:</p>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>HostName</code></td><td><code>string</code></td><td>Defines the hostname or IP address of the server hosting OrientDB</td></tr>
<tr><td><code>UserName</code></td><td><code>string</code></td><td>Defines the name of the database user</td></tr>
<tr><td><code>Password</code></td><td><code>string</code></td><td>Defines the password for database user</td></tr>
<tr><td><code>Port</code></td><td><code>int</code></td><td>Defines the port number for the connection</td></tr>
<tr><td><code>DatabaseName</code></td><td><code>string</code></td><td>Defines the name of the database to use</td></tr>
<tr><td><code>DatabaseType</code></td><td><code>ODatabaseType</code></td><td>Defnes the type of database, PLocal or Memory</td></tr>
<tr><td><code>PoolAlias</code></td><td><code>string</code></td><td>Defines the connection pool to use.</td></tr>
</tbody></table>
</div>
<p>If you initialize this object without defining the connection pool, it sets it to <code>Default</code>.</p>
<pre><code class="language-csharp">// INITIALIZE CONNECTION OPTIONS
ConnectionOptions opts = ConnectionOptions();

opts.HostName = "localhost";
opts.UserName = "admin";
opts.Password = "admin_passwd";
opts.Port = 2727;
opts.DatabaseName = "microblog";
opts.DatabaseType = ODatabaseType.PLocal

// Initialize Database
ODatabase database = ODatabase(opts);
</code></pre>
<h2 id="using-odatabase"><a class="header" href="#using-odatabase">Using ODatabase</a></h2>
<p>Once you have instantiated the <code>ODatabase</code> class, you can begin to operate on a particular database from within your C#/.NET application.  OrientDB-NET supports a number of database-level operations that you can call through this interface. Additionally, you can issue queries, commands and scripts to the database for those operations that it does not support.</p>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Return Value</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="dotnet/NET-Database.html#closing-databases"><strong><code>Close()</code></strong></a></td><td><code>void</code></td><td>Disposes of the database instance.</td></tr>
<tr><td><a href="dotnet/NET-Database-Clusters.html"><strong><code>Clusters()</code></strong></a></td><td><code>OClusterQuery</code></td><td>Creates clusters.</td></tr>
<tr><td><a href="dotnet/NET-Database-Command.html"><strong><code>Command()</code></strong></a></td><td><code>OCommandResult</code></td><td>Issues commands.</td></tr>
<tr><td><a href="dotnet/NET-Database.html#size-variables"><strong><code>CountRecords</code></strong></a></td><td><code>long</code></td><td>Counts records on database.</td></tr>
<tr><td><a href="dotnet/NET-Database.html#closing-databases"><strong><code>Dispose()</code></strong></a></td><td><code>void</code></td><td>Disposes of the database instance.</td></tr>
<tr><td><a href="dotnet/NET-Database-GetClusterIdFor.html"><strong><code>GetClusterIdFor()</code></strong></a></td><td><code>short</code></td><td>Retrieves ID for the given cluster name.</td></tr>
<tr><td><a href="dotnet/NET-Database-GetClusterNameFor.html"><strong><code>GetClusterNameFor()</code></strong></a></td><td><code>string</code></td><td>Retrieves the name for the given Cluster ID.</td></tr>
<tr><td><a href="dotnet/NET-Database-GetClusters.html"><strong><code>GetClusters()</code></strong></a></td><td><code>List&lt;OCluster&gt;</code></td><td>Retrieves clusters from database.</td></tr>
<tr><td><a href="dotnet/NET-Database-Gremlin.html"><strong><code>Gremlin()</code></strong></a></td><td><code>OCommandResult</code></td><td>Executes Gremlin commands.</td></tr>
<tr><td><a href="dotnet/NET-Database-Insert.html"><strong><code>Insert()</code></strong></a></td><td><code>IOInsert</code></td><td>Prepares insertion operations.</td></tr>
<tr><td><a href="dotnet/NET-Database-JS.html"><strong><code>JavaScript()</code></strong></a></td><td><code>OCommandQuery</code></td><td>Prepares JavaScript commands.</td></tr>
<tr><td><a href="dotnet/NET-Database-Query.html"><strong><code>Query()</code></strong></a></td><td><code>List&lt;ODocument&gt;</code></td><td>Queries the database using SQL.</td></tr>
<tr><td><a href="dotnet/NET-Database-Select.html"><strong><code>Select()</code></strong></a></td><td><code>OSqlSelect</code></td><td>Prepares queries to execute.</td></tr>
<tr><td><a href="dotnet/NET-Database.html#size-variables"><strong><code>Size</code></strong></a></td><td><code>long</code></td><td>Retrieves the size of the database.</td></tr>
<tr><td><a href="dotnet/NET-Database-SqlBatch.html"><strong><code>SqlBatch()</code></strong></a></td><td><code>OCommandQuery</code></td><td>Executes batch queries.</td></tr>
<tr><td><a href="dotnet/NET-Database-Update.html"><strong><code>Update()</code></strong></a></td><td><code>OSqlUpdate</code></td><td>Prepares update statements.</td></tr>
</tbody></table>
</div>
<h3 id="size-variables"><a class="header" href="#size-variables">Size Variables</a></h3>
<p>In addition to the various methods, the <code>ODatabase</code> object also supports sizing variables, which you can use to determine the size of the database or the number of records it contains.</p>
<ul>
<li>
<p>To retrieve the size of the database, use the <code>Size</code> variable:</p>
<pre><code class="language-csharp">long databaseSize = database.Size;
</code></pre>
</li>
<li>
<p>To count the number of records on the database, use the <code>CountRecords</code> variable:</p>
<pre><code class="language-csharp">long numberOfRecords = database.CountRecords;
</code></pre>
</li>
</ul>
<h3 id="closing-databases-4"><a class="header" href="#closing-databases-4">Closing Databases</a></h3>
<p>When you are finished using the database instance, you can close it to free up system resources.  The <code>ODatabase</code> object provides two methods for closing databases: <code>Close()</code> and <code>Dispose()</code>.  Given that one is an alias to the other, you can use whichever is more familiar to you.</p>
<pre><code class="language-csharp">// CLOSE DATABASE
database.Close()
</code></pre>
<h3 id="transactions-7"><a class="header" href="#transactions-7">Transactions</a></h3>
<p>OrientDB provides support for transactions.  The Insert(), Update() and Query() methods all provide support so that you can execute them as part of a transaction rather than on the database outright.  For more information, see <a href="dotnet/NET-Transactions.html"><code>OTransaction</code></a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-net---clusters"><a class="header" href="#orientdb-net---clusters">OrientDB-NET - <code>Clusters()</code></a></h1>
<p>This method adds clusters to the OrientDB database.  The return value is an <code>OClusterQuery</code> object.</p>
<h2 id="creating-clusters-1"><a class="header" href="#creating-clusters-1">Creating Clusters</a></h2>
<p>To create clusters on the database, you need to call the <code>Clusters()</code> method on the <code>ODatabase</code> interface.  In order to do so, you need to pass it an array of cluster names or ID's that you want to add to the database.</p>
<h3 id="syntax-248"><a class="header" href="#syntax-248">Syntax</a></h3>
<pre><code>// CREATING CLUSTERS BY NAME
OClusterQuery ODatabase.Clusters(params string[] clusterNames)

// CREATING CLUSTERS BY ID
OClusterQuery ODatabase.Clusters(params short[] clusterId)
</code></pre>
<ul>
<li>
<p><strong><code>cluster-names</code></strong> Defines a series of strings (<code>params string[]</code>) indicating the names of the clusters you want to create.</p>
</li>
<li>
<p><strong><code>cluster-ids</code></strong> Defines a series of numbers (<code>params short[]</code>) indicating the ID's of the clusters you want to create.</p>
</li>
</ul>
<h4 id="additional-methods"><a class="header" href="#additional-methods">Additional Methods</a></h4>
<p>When you use this method, the return value is an <code>OClusterQuery</code> object, which provides additional methods that you may find useful:</p>
<ul>
<li><code>Count()</code> This method returns a long value of the created clusters.</li>
<li><code>Range()</code> This method returns an <code>ODocument</code> object of the created clusters.</li>
</ul>
<h3 id="examples-45"><a class="header" href="#examples-45">Examples</a></h3>
<p>For instance, you might use this method in building a wrapper function to add clusters to the database.  Using the wrapper you can extend the method with additional logic to log information to the console or perform further operations on the newly created clusters.</p>
<pre><code class="language-csharp">using Orient.Client;
using System;
...

public void createCluster(ODatabase database, 
      params string[] clusters)
{
   // LOG TO CONSOLE
   Console.Write("Creating Clusters: {0}",
      String.Join(", ", clusters));

   // CREATE CLUSTERS
   OClusterQuery clusterQuery = database.Clusters(clusters);

   // FETCH COUNT
   long count = clusterQuery.Count();

   // LOG TO CONSOLE
   Console.Write("Created {0} clusters", count);
}
</code></pre>
<p>Similarly, you might want to create an arbitrary range of clusters by passing a <code>param</code> of short values to the same method.</p>
<pre><code class="language-csharp">// INITIALIZE CLUSTER ID's
params short[] clusterIds = [1, 2, 3, 4, 5]

// CREATE CLUSTERS
OClusterQuery query = database.Clusters(clusterIds);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-net---command"><a class="header" href="#orientdb-net---command">OrientDB-NET - <code>Command()</code></a></h1>
<p>This method prepares or executes a command on the OrientDB database.  The return value is an <code>OCommandResult</code> object.</p>
<h2 id="sending-commands-1"><a class="header" href="#sending-commands-1">Sending Commands</a></h2>
<p>There are several methods available in issuing queries and commands to OrientDB through your C# application.  This method allows you to issue SQL commands to the database.</p>
<p>For information on available commands, see <a href="dotnet/../sql/SQL-Commands.html">SQL Commands</a> and <a href="dotnet/../console/Console-Commands.html">Console Commands</a> commands.</p>
<h3 id="syntax-249"><a class="header" href="#syntax-249">Syntax</a></h3>
<pre><code>// EXECUTING COMMANDS
OCommandResult Command(     string &lt;query&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;query&gt;</code></strong> Defines an SQL statement to execute.</li>
<li><strong><code>&lt;command&gt;</code></strong> Defines a prepared command object.</li>
</ul>
<h3 id="example-97"><a class="header" href="#example-97">Example</a></h3>
<p>For instance, consider the use case of making internal data persistent across multiple operations.  When your application is running, it operates a dictionary object.  When it closes, it uploads data from the dictionary to OrientDB, so that it will have it ready when you run the app again.</p>
<pre><code class="language-csharp">using Orient.Client;
using System;

// SAVE DATA
public void Save(ODatabase database, Dictionary&lt;string, string&gt; data)
{
   // LOG OPERATION
   Console.WriteLine("Saving Data to OrientDB");

   // LOOP OVER DATA
   foreach(KeyValuePair&lt;string, string&gt; entry in data)
   {
      // LOG OPERATION
      Console.WriteLine(" - Saving: {0}", entry.Key);

      // BUILD QUERY
      string sqlQuery = String.Format("UPDATE Save SET {0} = {1}",
         entry.Key, entry.Value);

      // RUN COMMAND
      database.Command(sqlQuery);
   }
}
</code></pre>
<p>Here, the application loops over the dictionary, running an <a href="dotnet/../sql/SQL-Update.html"><code>UPDATE</code></a> statement for each variable in the data dictionary.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-net---getclusteridfor"><a class="header" href="#orientdb-net---getclusteridfor">OrientDB-NET - <code>GetClusterIdFor()</code></a></h1>
<p>This method retrieves the default Cluster ID for a given class.  The return value is a <code>short</code>.</p>
<h2 id="retrieving-cluster-ids-3"><a class="header" href="#retrieving-cluster-ids-3">Retrieving Cluster ID's</a></h2>
<p>While cluster names are easier for people to understand and keep track of, you may occasionally find it more efficient and performant to work with cluster ID's in these operations.  Using the <code>GetClusterIdFor()</code> method, you can retrieve the short ID for a given cluster.</p>
<p>It is comparable to the <a href="dotnet/NET-Database-GetClusterNameFor.html"><code>GetClusterNameFor()</code></a> method.</p>
<h3 id="syntax-250"><a class="header" href="#syntax-250">Syntax</a></h3>
<pre><code>short ODatabase.GetClusterIdFor(  string &lt;name&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;name&gt;</code></strong> Defines the class name.</li>
</ul>
<h3 id="example-98"><a class="header" href="#example-98">Example</a></h3>
<p>For instance, if you prefer operating on clusters by their ID's rather than names, you may find it convenient to create a helper function to retrieve the Id's for a group of cluster names.</p>
<pre><code class="language-csharp">using Orient.Client;
using System;
...

// FETCH CLUSTER ID'S
public List&lt;short&gt; fetchClusterIds(ODatabase database, string[] clusterNames)
{
   // LOG OPERATION
   Console.WriteLine("Retrieving ID's for clusters: {0}",
      String.Join(", ", clusterNames));

   // INITIALIZE RETURN VARIABLE
   List&lt;short&gt; clusterIDs;

   // LOOP OVER NAMES
   foreach(string name in clusterNames)
   {
      // FETCH CLUSTER ID
      short clusterID = database.GetClusterIdFor(name);

      // APPEND ID TO RETURN VALUE
      clusterIDs.Add(clusterID)
   }

   // RETURN CLUSTER ID'S
   return clusterIDs;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-net---getclusternamefor"><a class="header" href="#orientdb-net---getclusternamefor">OrientDB-NET - <code>GetClusterNameFor()</code></a></h1>
<p>This method retrieves the name of a cluster for the given Cluster ID.  The return value is a string.</p>
<h2 id="retrieving-cluster-names"><a class="header" href="#retrieving-cluster-names">Retrieving Cluster Names</a></h2>
<p>While Cluster ID's may prove easier and more performant for your application to operate on, their meaning and purpose is not always clear for the programmer or when writing to logs.  To retrieve the cluster name from an ID, use the <code>GetClusterNameFor()</code> method on the <code>ODatabase</code> interface.</p>
<p>It is comparable to the <a href="dotnet/NET-Database-GetClusterIdFor.html"><code>GetClusterIdFor()</code></a> method.</p>
<h3 id="syntax-251"><a class="header" href="#syntax-251">Syntax</a></h3>
<pre><code>string ODatabase.GetClusterNameFor(short &lt;cluster-id&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;cluster-id&gt;</code></strong> Defines the Cluster ID you want to query.</li>
</ul>
<h3 id="example-99"><a class="header" href="#example-99">Example</a></h3>
<p>For instance, if you prefer operating on clusters by their ID's rather than names, you may find it convenient to create a helper function to retrieve cluster names from a list of cluster ID's.</p>
<pre><code class="language-csharp">using Orient.Client;
using System;
...

// FETCH CLUSTER NMAES
public List&lt;string&gt; fetchClusterNames(ODatabase database, short[] clusterIDs)
{
   // LOG OPERATION
   Console.WriteLine("Retrieve Names for Clusters: {0}",
      String.Join(", ", clusterIDs));

  // INITIALIZE RETRUN VALUE
  List&lt;string&gt; clusterNames;

  // LOOP OVER ID'S
  foreach(short clusterID in clusterIDs)
  {
    // FETCH CLUSTER NAME
    string clusterName = database.GetClusterNameFor(clusterID);

    // APPEND NAME TO RETURN VALUE
    clusterNames.Add(clusterName);
  }

  // RETURN CLUSTER NAMES
  return clusterNames;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-net---getclusters"><a class="header" href="#orientdb-net---getclusters">OrientDB-NET - <code>GetClusters()</code></a></h1>
<p>This method returns the clusters on the connected OrientDB database.  The return value is a list of <code>OCluster</code> objects.</p>
<h2 id="retrieving-clusters"><a class="header" href="#retrieving-clusters">Retrieving Clusters</a></h2>
<p>In cases where you need to operate on many, most or all clusters in a database, you may find it more efficient to retrieve all <code>OCluster</code> objects in a single call.  You can do so using the <code>GetClusters()</code> method.</p>
<h3 id="syntax-252"><a class="header" href="#syntax-252">Syntax</a></h3>
<pre><code>List&lt;OCluster&gt; ODatabase.GetClusters(bool reload)
</code></pre>
<ul>
<li><strong><code>reload</code></strong> Defines whether you want to reload the <code>ODatabase</code> instance before retrieving the clusters.  Defaults to <code>false</code>.</li>
</ul>
<h3 id="examples-46"><a class="header" href="#examples-46">Examples</a></h3>
<p>For instance, as part of a logging operation, you might build a helper function to retrieve the available clusters from the database and to print their names to the console, before returning them for further operations.</p>
<pre><code class="language-csharp">using Orient.Client;
using System;

public List&lt;OCluster&gt; FetchClusters(ODatabase database,
    bool reload = false)
{
  // FETCH CLUSTERS
  List&lt;OCluster&gt; clusters = database.GetClusters(reload);

  // INITIALIZE CLUSTER NAMES LIST
  List&lt;string&gt; clusterNames;
  foreach(OCluster cluster in clusters)
  {
     // ADD CLUSTER NAME
     clusterNames.Add(cluster.Name);
  }

  // LOG TO CONSOLE
  Console.WriteLine("Retrieved Clusters: {0}",
    String.Join(', ', clusterNames));

  // RETURN CLUSTERS
  return clusters;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-net---gremlin"><a class="header" href="#orientdb-net---gremlin">OrientDB-NET - <code>Gremlin()</code></a></h1>
<p>This method executes <a href="dotnet/../gremlin/Gremlin.html">Gremlin</a> scripts.  The return value is an <code>OCommandResult</code> object.</p>
<h2 id="executing-gremlin-scripts"><a class="header" href="#executing-gremlin-scripts">Executing Gremlin Scripts</a></h2>
<p>In cases where you have existing scripts or would prefer to operate on OrientDB using the Gremlin language, you can do so through <code>ODatabase</code> interface, using the <code>Gremlin()</code> method.</p>
<h3 id="syntax-253"><a class="header" href="#syntax-253">Syntax</a></h3>
<pre><code>OCommandResult Gremlin(string &lt;query&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;query&gt;</code></strong> Defines the command to execute</li>
</ul>
<h3 id="example-100"><a class="header" href="#example-100">Example</a></h3>
<p>In situations where you prefer to using Gremlin scripts or would like to use features implemented in Gremlin but which are not yet available to OrientDB-NET, you can call these internally from a string.</p>
<pre><code class="language-csharp">using Orient.Client;
using System;
...

// RETRIEVE VERTICES THROUGH GREMLIN
public OCommandResult fetchVertices(ODatabase database, string databaseName,
    string className)
{
  // LOG OPERATION
  Console.WriteLine("Gremlin Query: All Vertices in: {0}",
     className);

  // INITIALIZE SCRIPT
  string script = String.Format("
    g = new OrientGraph('plocal:/data/{0}');
    vertices = g.{1};
    g.close();
    return vertices;",
    databaseName, className);

  // EXECUTE SCRIPT
  OCommandResultSet resultSet = database.Gremlin(script);

  // RETURN RESULTS
  return resultSet;
}
</code></pre>
<p>In addition to building your Gremlin scripts within your application as strings, you can also retrieve the script from file.  You may find this particularly useful in cases where you have a body of routine Gremlin scripts already prepared for your application, or when you want to work with developers who are familiar with JavaScript and Gremlin, but somewhat less so with the C#/.NET framework.</p>
<pre><code class="language-csharp">using Orient.Client;
using System;
...

// RUN GREMLIN SCRIPT FROM FILE
public OCommandResult runScript(ODatabase database, string path)
{
  // LOG OPERATION
  Console.WriteLine("Running Gremlin Script: {0}", path);

  // RETRIEVE SCRIPT
  string script = IO.File.ReadAllText(path);

  // RUN SCRIPT
  OCommandResult resultSet = database.Gremlin(script);

  // RETURN RESULT-SET
  return resultSet;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-net---insert"><a class="header" href="#orientdb-net---insert">OrientDB-NET - <code>Insert()</code></a></h1>
<p>This method inserts records into the database.</p>
<h2 id="inserting-data"><a class="header" href="#inserting-data">Inserting Data</a></h2>
<p>Using this method you can insert records into the database.  By itself, it initializes an <code>IOInsert</code> object, which you can that operate on to further define the data you want to insert.</p>
<h3 id="syntax-254"><a class="header" href="#syntax-254">Syntax</a></h3>
<pre><code>IOInsert ODatabase.Insert()
   .Into(class)
   .Set(field, value)

IOInsert ODatabase.Insert()
   .Cluster(cluster)
   .Set(field, value)
</code></pre>
<ul>
<li><strong><code>class</code></strong> Defines the class to use.</li>
<li><strong><code>cluster</code></strong> Defines the cluster to use.</li>
<li><strong><code>field</code></strong> Defines the field to set.</li>
<li><strong><code>value</code></strong> Defines the value to set on the field.</li>
</ul>
<p>The above methods allow you to build the <code>IOInsert</code> object.  You can then execute a processing command to run the query against the database.  There are two such methods available to you,</p>
<ul>
<li><strong><code>Run()</code></strong> Executes the insertion on the database and returns an <code>ODocument</code> object.</li>
<li><strong><code>ToString()</code></strong> Executes the insertion on the database and returns a string of the added record.</li>
</ul>
<h3 id="example-101"><a class="header" href="#example-101">Example</a></h3>
<p>For instance, say that you are developing an accounting application in C# and want to support migration.  You receive a CSV file from a spreadsheet application and want to insert its records into OrientDB.</p>
<pre><code class="language-csharp">using Orient.Client;
using (TextFieldParser parser = new TexFieldParser("$HOME/2016-report.csv"))
{
   // INITIALIZE DATABASE
   ODatabase database = ODatabase("localhost", 2424, "account-app",
      ODatabaseType.PLocal, "user", "passwd");

   // INITIALIZE PARSER
   parser.TextFieldType = FieldType.Delimited;
   parser.SetDelimiters(",");

   // MIGRATE DATA
   while (!parser.EndOfData)
   {
      // INSERT ROW
      string[] fields = parser.ReadFields();
			ODocument test = database.Insert()
				 .Into("Account")
				 .Set("name", field[0])
         .Set("contact", field[1])
         .Set("status", field[2])
         .Run();
   }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-net---javascript"><a class="header" href="#orientdb-net---javascript">OrientDB-NET - <code>JavaScript()</code></a></h1>
<p>This method prepares JavaScript queries to execute on the OrientDB database.  The return value is an <code>OCommandQuery</code> object.</p>
<h2 id="querying-with-javascript"><a class="header" href="#querying-with-javascript">Querying with JavaScript</a></h2>
<p>In cases where you have database operations scripted in JavaScript, you can execute these through OrientDB-NET using the <code>JavaScript()</code> method.</p>
<h3 id="syntax-255"><a class="header" href="#syntax-255">Syntax</a></h3>
<pre><code>OCommandQuery JavaScript(string &lt;query&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;query&gt;</code></strong> Defines the query to execute.</li>
</ul>
<h3 id="example-102"><a class="header" href="#example-102">Example</a></h3>
<p>In cases situations where you prefer to operate on the database using JavaScript or would like to use features available through JavaScript but which are not yet available with OrientDB-NET, you can use this method to execute JavaScript from a string.</p>
<pre><code class="language-csharp">using Orient.Client;
using System;

// RETRIEVE RECORDS FROM GIVEN CLASS
public OCommandResult FetchAllRecords(ODatabase database,
    string dbName, string className)
{
  // LOG OPERATION
  Console.WriteLine("Retrieving All Records: {0}",
    className);

  // CONSTRUCT SCRIPT
  string script = "
    var db = new ODatabase('http://localhost:2480/{0}');
    dbInfo = db.open();
    queryResult = db.Query('SELECT FROM {1}');
    db.close();
    return queryResult;",
    dbName, className);

  return database.JavaScript(script).Run();
}
</code></pre>
<p>In addition to building your JavaScript scripts from within your application as strings, you can also retrieve scripts from file.  You may find this particularly useful in cases where you have a body of routine JavaScript operations already prepared for your application, or when you want to work with developers who are familiar with JavaScript, but somewhat less so with the C#/.NET framework.</p>
<pre><code class="language-csharp">using Orient.Client;
using System;
...

// RUN JAVASCRIPT FILE
public OCommandResult JSQuery(ODatabase database, string filename)
{
  // LOG OPERATION
  Console.WriteLine("Run File: {0}", filename);

  // RETRIEVE SCRIPT
  string script = IO.File.ReadAllText(path);

  // RUN SCRIPT
  return database.JavaScript(script).Run();

}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-net---query"><a class="header" href="#orientdb-net---query">OrientDB-NET - <code>Query()</code></a></h1>
<p>This method issues SQL queries against the OrientDB database.  It returns a list of <code>ODocument</code> objects from the result-set.</p>
<h2 id="querying-the-database-4"><a class="header" href="#querying-the-database-4">Querying the Database</a></h2>
<p>In some cases you may find features in OrientDB that are not yet available through OrientDB-NET.  You can utilize these features by passing SQL statements for them through the <code>Query()</code> method.  It returns a list of <code>ODocument</code> objects that you can operate on further.</p>
<p>It is comparable to the <a href="dotnet/NET-Database-Command.html"><code>Command()</code></a> method.</p>
<h3 id="syntax-256"><a class="header" href="#syntax-256">Syntax</a></h3>
<pre><code>// QUERY DATABASE
List&lt;ODocument&gt; ODatabase.Query(string SQL)

// QUERY DATABASE WITH FETCH PLAN
List&lt;ODocument&gt; ODatabase.Query(string SQL,
   string fetch-plan)
</code></pre>
<ul>
<li><strong><code>SQL</code></strong> Defines the SQL statement to use.</li>
<li><strong><code>fetch-plan</code></strong> Defines the <a href="dotnet/../java/Fetching-Strategies.html">Fetching Strategy</a> to use.</li>
</ul>
<h3 id="example-103"><a class="header" href="#example-103">Example</a></h3>
<p>In situations where you execute the same or very similar queries with some frequency or in cases where you need to run a query that has no comparable function available in OrientDB-NET, you can issue the SQL statement manually through this method.</p>
<pre><code class="language-csharp">using Orient.Client;
using System;
...

// FETCH MATCHING DOCUMENTS FROM CLASS
public List&lt;ODocument&gt; FetchRecords(ODatabase database,
    string className, Dictionary&lt;string, string&gt; conditions)
{
  // LOG OPERATION
  Console.WriteLine("Querying Class: {0}", className);

  // BUILD QUERY
  List&lt;string&gt; baseQuery = [
    String.Format('SELECT FROM {0}', className)];

  // CHECK FOR CONDITIONAL VALUES
  if(conditions.Count &gt; 0)
  {
    // ADD WHERE
    baseQuery.Add('WHERE');

    // ADD CONDITIONS
    foreach(KeyValuePair&lt;string, string&gt; condition in conditions)
    {
      string entry = String.Format("{0}={1}",
        condition.Key, condition.Value);

      baseQuery.Add(entry);
    }

    // JOIN QUERY
    string query = String.Join(' ', baseQuery);

    // RUN QUERY
    return database.Query(query);
  }
}
</code></pre>
<p>In the event that you would like to execute the query with a fetching strategy, you can do so through the second argument.</p>
<pre><code class="language-csharp">using Orient.Client;
using System;

// FETCH ALL RECORDS WITH FETCHING STRATEGY
public List&lt;ODocument&gt; FetchAll(ODatabase database,
    string className, string fetchPlan)
{
  // LOG OPERATION
  Console.WriteLine("Fetching All Records from {0}",
    className);

  // BUILD QUERY
  string query = String.Format("SELECT FROM {0}", className);

  // RUN QUERY
  return database.Query(query, fetchPlan);
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-net---select"><a class="header" href="#orientdb-net---select">OrientDB-NET - <code>Select()</code></a></h1>
<p>This method creates an <code>OSqlSelect</code> object, which you can use in querying the database.</p>
<h2 id="querying-the-database-5"><a class="header" href="#querying-the-database-5">Querying the Database</a></h2>
<p>Eventually, you'll want to access the data that you're storing on OrientDB.  This method allows you to construct a query to use in retrieving documents from the database.</p>
<h3 id="syntax-257"><a class="header" href="#syntax-257">Syntax</a></h3>
<pre><code>// RETRIEVE LIST
List&lt;ODocument&gt; ODatabase.Select(params string[] projections)
   .From(target)
   .ToList(string fetchplan)

// RETRIEVE STRING
string ODatabase.Select(params string[] projections)
   .From(target)
   .ToString()
</code></pre>
<ul>
<li><strong><code>projections</code></strong> Defines the columns you want returned.</li>
<li><strong><code>target</code></strong> Defines the target you want to operate on.
<ul>
<li><em><code>string target</code></em> Where the target is a class or cluster.</li>
<li><em><code>ORID target</code></em> Where the target is a Record ID.</li>
<li><em><code>OSqlSelect target</code></em> Where the target is a nested <code>Select()</code> operation.</li>
<li><em><code>ODocument target</code></em> Where the target is the return value from another database operation.</li>
</ul>
</li>
<li><strong><code>fetch-plan</code></strong> Defines the <a href="dotnet/../java/Fetching-Strategies.html">Fetching Strategy</a> you want to use.  If you want to issue the query without a fetching strategy, execute the method without passing it arguments.</li>
</ul>
<blockquote>
<p>Note that you can retrieve either a list of <code>ODocument</code> objects or a string value.</p>
</blockquote>
<p>The base <code>Select()</code> method operates on an <code>OSqlSelect</code> object, which provides additional methods for conditional and grouping operations. For more information on these additional methods, see <a href="dotnet/NET-Query.html">Queries</a></p>
<h3 id="examples-47"><a class="header" href="#examples-47">Examples</a></h3>
<p>This method supports two return values: strings and lists.  In cases where you find you use on form more often than others, you might build a helper function to save yourself time and typing.</p>
<pre><code class="language-csharp">using Orient.Client;
using System;

// FETCH ALL DOCUMENTS BY CLASS
public List&lt;ODocument&gt; ClassFetch(ODatabase database, string className)
{
  // LOG OPERATION
  Console.WriteLine("Fetching Documents from: {0}", className);

  // FETCH DOCUMENTS
  return database.Select().From(className).ToList();
}
</code></pre>
<p>For classes that contain particularly large number of records, you might find it more useful to issue the query with a fetching strategy.</p>
<pre><code class="language-csharp">public List&lt;ODocument&gt; ClassFetch(ODatabase database,
    string className, string fetchPlan)
{
  // LOG OPERATION
  Console.WriteLine("Fetching Documents from: {0}", className);

  return database.Select().From(className).ToList(fetchPlan);
}
</code></pre>
<blockquote>
<p>For more information on queries in OrientDB-NET, see <a href="dotnet/NET-Query.html">Queries</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-net---sqlbatch"><a class="header" href="#orientdb-net---sqlbatch">OrientDB-NET - <code>SqlBatch()</code></a></h1>
<p>This method prepares a <a href="dotnet/../sql/SQL-batch.html"><code>Batch</code></a> command.  The return value is an <code>OCommandQuery</code> object.</p>
<h2 id="executing-batch-commands"><a class="header" href="#executing-batch-commands">Executing Batch Commands</a></h2>
<p>OrientDB supports scripting arbitrary commands through a minimal SQL engine to batch commands together.  Using <code>SqlBatch()</code> command, you can execute these scripts from within your C#/.NET application.</p>
<h3 id="syntax-258"><a class="header" href="#syntax-258">Syntax</a></h3>
<pre><code>OCommandQuery ODatabase.SqlBatch(string command)
</code></pre>
<ul>
<li><strong><code>command</code></strong> Defines the command you want to execute.</li>
</ul>
<h3 id="example-104"><a class="header" href="#example-104">Example</a></h3>
<p>For instance, say you have a business application that tracks accounts in different regions and sales persons assigned to that region.  Whenever someone joins the team, you need to update OrientDB to tell the application who they are and their assigned region.</p>
<pre><code class="language-csharp">public AddToSales(ODatabase database, string name, string region)
{
   string query = string.Format("begin
      let region = select from Region where name = {0}
      let employee = create vertex Sales set name = '{1}'
      let e = create edge Assignment from $employee to $account
      commit retry 100
      return $e", region, name);

   return database.SqlBatch(query);
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-net---update"><a class="header" href="#orientdb-net---update">OrientDB-NET - <code>Update()</code></a></h1>
<p>This method updates records on the database.</p>
<h2 id="updating-records-4"><a class="header" href="#updating-records-4">Updating Records</a></h2>
<p>Using this method you can change or otherwise modify records on the database.  By itself, it initializes an <code>OSqlUpdate</code> object, which you can then operate on to further define the records you want to change and what changes you would like to make.</p>
<h3 id="syntax-259"><a class="header" href="#syntax-259">Syntax</a></h3>
<pre><code>// UPDATING RECORDS
OSqlUpdate ODatabase.Update()
</code></pre>
<p>There are several methods available to the <code>OSqlUpdate</code> method.  These allow you to build and execute the update against your database.</p>
<h4 id="defining-the-target"><a class="header" href="#defining-the-target">Defining the Target</a></h4>
<p>When using this method, you can update by class, cluster or Record ID.</p>
<ul>
<li>
<p><strong>Class Updates</strong></p>
<pre><code>OSqlUpdate ODatabase.Update()
   .Class(string className)
</code></pre>
</li>
<li>
<p><strong>Cluster Updates</strong></p>
<pre><code>OSqlUpdate ODatabase.Update()
   .Cluster(string clusterName)
</code></pre>
</li>
<li>
<p><strong>Record Updates</strong></p>
<pre><code>// RECORD METHOD
OSqlUpdate ODatabase.Update()
   .Record(ORID recordID)

// RECORD ARGUMENT
OSqlUpdate ODatabase.Update(ORID recordID)
</code></pre>
</li>
</ul>
<p>For the sake of simplicity, syntax cases shown hereafter assume that you're updating a class.</p>
<h4 id="defining-the-update"><a class="header" href="#defining-the-update">Defining the Update</a></h4>
<p>When using this method, you have a few options in defining the update that you want to make: whether you're adding or removing data, or changing records.</p>
<ul>
<li>
<p><strong>Setting Field</strong></p>
<pre><code>OSqlUpdate ODatabase.Update(&lt;rid&gt;)
   .Set(field, value)
</code></pre>
</li>
<li>
<p><strong>Adding Fields</strong></p>
<pre><code>OSqlUpdate ODatabase.Update(&lt;rid&gt;)
   .Add(field, value)
</code></pre>
</li>
<li>
<p><strong>Removing Fields</strong></p>
<pre><code>OSqlUpdate ODatabase.Update(&lt;rid&gt;)
   .Remove(field)
</code></pre>
</li>
</ul>
<h4 id="executing-updates"><a class="header" href="#executing-updates">Executing Updates</a></h4>
<p>Using the above methods you can build the update that you want, however OrientDB-NET does not execute the update on your database until you use an execution method:</p>
<ul>
<li>
<p><code>Run()</code> Executes the update on the database and returns an integer.</p>
</li>
<li>
<p><code>ToString()</code> Executes the update on the database and returns a string.</p>
</li>
</ul>
<h3 id="example-105"><a class="header" href="#example-105">Example</a></h3>
<p>For instance, say that you routinely implement complicated updates on your database with various changes.  You might wnat to build a helper function that loops through common variables in defining the update.</p>
<pre><code class="language-csharp">using Orient.Client;
using System;
...

// UPDATE OPERATION
public ODocument UpdateDatabase(ODatabase database, string className,
      Dictionary&lt;string, string&gt; changes)
{
   // LOG OPERATION
   Console.WriteLine("Updating Class: {0}", className);

   // INITIALIZE UPDATE
   OSqlUpdate update = database.Update().Class(classname);

   // DEFINE CHANGES
   foreach(KeyValuePair&lt;string, string&gt; setting in changes)
   {
      // APPLY CHANGES
      update.Set(setting.Key, setting.Value);
   }

   // RUN AND RETURN ODOCUMENT
   return update.Run();
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-net---building-queries"><a class="header" href="#orientdb-net---building-queries">OrientDB-NET - Building Queries</a></h1>
<p>When querying a database on OrientDB through your C#/.NET application there are a few options available to you through the <a href="dotnet/NET-Database.html"><code>ODatabase</code></a> methods.  While you can issue SQL statements through <a href="dotnet/NET-Database-Query.html"><code>Query()</code></a> and <a href="dotnet/NET-Database-Command.html"><code>Command()</code></a>, there are also methods that allow you to build queries in C#: <a href="dotnet/NET-Database-Insert.html"><code>Insert()</code></a>, <a href="dotnet/NET-Database-Select.html"><code>Select()</code></a>, and <a href="dotnet/NET-Database-Update.html"><code>Update()</code></a></p>
<p>These queries support common conditional and grouping methods to organize the data before OrientDB returns it to your application.</p>
<ul>
<li><a href="dotnet/NET-Query-Conditions.html"><strong>Conditional Methods</strong></a> These are in building <a href="dotnet/../sql/SQL-Where.html"><code>WHERE</code></a> clauses within OrientDB-NET.</li>
<li><a href="dotnet/NET-Query-Limiter.html"><strong>Limiter Methods</strong></a> These are used in limited or offsetting the result-set.</li>
<li><a href="dotnet/NET-Query-Sort.html"><strong>Sort Methods</strong></a> These are used in sorting or otherwise ordering the result-set.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-net---conditionals"><a class="header" href="#orientdb-net---conditionals">OrientDB-NET - Conditionals</a></h1>
<p>In SQL, the <a href="dotnet/../sql/SQL-Where.html"><code>WHERE</code></a> clause defines conditions for returning data.  When building queries in OrientDB-NET on <a href="dotnet/NET-Database.html"><code>ODatabase</code></a> objects, there are a series of methods available in setting conditions on the query result-set.</p>
<p>There are two parts to a conditional statement, the field you want to set the condition on and the value you want from that field.</p>
<h2 id="setting-the-field"><a class="header" href="#setting-the-field">Setting the Field</a></h2>
<p>In setting the field for a condition, there are three methods available to you.</p>
<ul>
<li>
<p><strong><code>Where()</code></strong> Defines the initial field in the condition.</p>
</li>
<li>
<p><strong><code>And()</code></strong> Defines a condition where the previous cases and this both return true.</p>
</li>
<li>
<p><strong><code>Or()</code></strong> Defines a condition where either the previous cases or this return true.</p>
</li>
</ul>
<p>For instance, say you want to retrieve blog entries from a database where the user is considered active and the entries are flagged as published.</p>
<pre><code class="language-csharp">List&lt;ODocument&gt; blogEntries = database.Select()
   .From('Blog')
   .Where('user-status').Equals&lt;string&gt;('active')
   .And('published').Equals&lt;bool&gt;(true)
   .ToList();
</code></pre>
<h2 id="setting-the-value"><a class="header" href="#setting-the-value">Setting the Value</a></h2>
<p>Once you have defined the field for a condition, the second method is the value you want to check on that field.  There are several methods available to use in checking the values.</p>
<ul>
<li><strong><code>Equals&lt;T&gt;()</code></strong> Returns the record if the value of the field is equal to the given argument.</li>
<li><strong><code>NotEquals&lt;T&gt;()</code></strong> Returns the record if the value of the field is not equal to the given argument.</li>
<li><strong><code>Lesser&lt;T&gt;()</code></strong> Returns the record if the value of the field is less than the given argument.</li>
<li><strong><code>LesserEqual&lt;T&gt;()</code></strong> Returns the record if the value of the field is less than or equal to the given argument.</li>
<li><strong><code>Greater&lt;T&gt;()</code></strong> Returns the record if the value of the field is greater than the given argument.</li>
<li><strong><code>GreaterEqual&lt;T&gt;()</code></strong> Returns the record if the value of the field is greater than or equal to the given argument.</li>
<li><strong><code>Like&lt;T&gt;()</code></strong> Returns the record if the value of the field is similar to the given argument.</li>
<li><strong><code>In&lt;T&gt;()</code></strong> Returns the record if the value occurs in the given argument list.</li>
<li><strong><code>Lucene&lt;T&gt;()</code></strong> Returns true if the value occurs in the given argument, searched using the Lucene Engine.</li>
<li><strong><code>IsNull()</code></strong> Returns the record if the value of the field is <code>NULL</code>.</li>
<li><strong><code>Contains&lt;T&gt;()</code></strong> Returns the record if the value of the field contains the given argument.</li>
</ul>
<p>For instance, say you want to retrieve blog entries for active users that have not set their profile picture.</p>
<pre><code class="language-csharp">List&lt;string, ODocument&gt; blogEntries = database.Select()
   .From('Blog')
   .Where('user-status').Equals&lt;string&gt;('active')
   .And('profile-picture').IsNull()
   .ToList();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-net---limiters"><a class="header" href="#orientdb-net---limiters">OrientDB-NET - Limiters</a></h1>
<p>Queries made against large databases can return many more records than you need for a particular operation.  In OrientDB as with other databases, there are limiters available to determine how much data gets returned to you.</p>
<h2 id="limiters"><a class="header" href="#limiters">Limiters</a></h2>
<p>There are three limiters available to you, mostly used with <a href="dotnet/NET-Database-Select.html"><code>Select()</code></a> queries:</p>
<ul>
<li>
<p><strong><code>Between()</code></strong> This method takes two arguments, which are integers.  It limits the return records to those that occur between them.</p>
</li>
<li>
<p><strong><code>Skip()</code></strong> This method takes one argument, which is an integer.  It acts as offset, only returning the records that occur after this point.</p>
</li>
<li>
<p><strong><code>Limit()</code></strong> This method takes one argument, which is an integer.  It defines the maximum number of records to return.</p>
</li>
</ul>
<p>For instance,</p>
<pre><code class="language-csharp">List&lt;ODocument&gt; blogEntries = database.Select()
   .From('Blog')
   .Limit(50)
   .ToList();
</code></pre>
<p>Here, you query the database for a list of the first fifty blog entries.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-net---sort"><a class="header" href="#orientdb-net---sort">OrientDB-NET - Sort</a></h1>
<p>When OrientDB returns a result-set to your application, it isn't always arranged in a manner that is convenient to your uses.  Rather than putting your own resources to sorting results, you can add sort methods to the query to ensure that OrientDB returns the records in the order you want.</p>
<h2 id="sorting-records"><a class="header" href="#sorting-records">Sorting Records</a></h2>
<p>There are three methods available to you in sorting the result-sets OrientDB sends you on <a href="dotnet/NET-Database-Select.html"><code>Select()</code></a> queries.</p>
<ul>
<li>
<p><strong><code>OrderBy()</code></strong> This method takes a <code>params string[]</code> argument that defines the fields to use in sorting the result-set.</p>
</li>
<li>
<p><strong><code>Ascending()</code></strong> This method sorts the result-set in ascending order.</p>
</li>
<li>
<p><strong><code>Descending()</code></strong> This method sorts the result-set in descending order.</p>
</li>
</ul>
<p>For instance,</p>
<pre><code class="language-csharp">List&lt;ODocument&gt; blogs = database.Select()
   .From("Blog")
   .OrderBy('date')
   .Descending()
   .Limit(10)
   .ToList();
</code></pre>
<p>Here, you have a web application that is rendering a series of blog entries.  You would like the entries sorted by the date and display the ten most recent entries on the home page.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-net---otransaction"><a class="header" href="#orientdb-net---otransaction">OrientDB-NET - OTransaction</a></h1>
<p>Transactions allow you to organize a series of commands on the database into units of work.  Once you have done the work that you want to do, you can then commit the transaction to the database to make it persistent or revert the database to an earlier state.</p>
<p>In OrientDB-NET, transactions are controlled through the <code>OTransaction</code> object, which you can access through the <a href="dotnet/NET-Database.html"><code>ODatabase</code></a> interface.</p>
<p>For more information, see <a href="dotnet/../internals/Transactions.html">Transactions</a>.</p>
<h2 id="initialize-a-transaction"><a class="header" href="#initialize-a-transaction">Initialize a Transaction</a></h2>
<p>In order to initialize a transaction, you need to first create a transaction object to manage and identify the changes you are making.  This is handled through the database interface.</p>
<pre><code class="language-csharp">OTransaction trx = ODatabase.Transaction;
</code></pre>
<p>This initializes an <code>OTransaction</code> object that you can then use in further operations, building the transaction before you commit it to the database.</p>
<h2 id="working-with-transactions-1"><a class="header" href="#working-with-transactions-1">Working with Transactions</a></h2>
<p>Once you have the <code>OTransaction</code> interface initialized, you can call methods on this object to build the transaction.  These are similar to the methods you would normally call on the <code>ODatabase</code> interface, but specific to the transaction.</p>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="dotnet/NET-Transactions-Add.html"><code>Add&lt;T&gt;()</code></a></td><td>Adds an object, typed by the generic.</td></tr>
<tr><td><a href="dotnet/NET-Transactions-AddEdge.html"><code>AddEdge()</code></a></td><td>Adds an edge.</td></tr>
<tr><td><a href="dotnet/NET-Transactions-AddOrUpdate.html"><code>AddOrUpdate&lt;T&gt;()</code></a></td><td>Adds a new object or updates an existing one.</td></tr>
<tr><td><a href="dotnet/NET-Transactions.html#commit"><code>Commit()</code></a></td><td>Commits changes made in the transaction to the database.</td></tr>
<tr><td><a href="dotnet/NET-Transactions-Delete.html"><code>Delete&lt;T&gt;()</code></a></td><td>Removes a record.</td></tr>
<tr><td><a href="dotnet/NET-Transactions-GetPendingObject.html"><code>GetPendingObject&lt;T&gt;()</code></a></td><td>Retrieves last object of the given type in the transaction.</td></tr>
<tr><td><a href="dotnet/NET-Transactions.html#reset"><code>Reset()</code></a></td><td>Closes the transaction and reverts all changes made to it.</td></tr>
<tr><td><a href="dotnet/NET-Transactions-Update.html"><code>Update&lt;T&gt;()</code></a></td><td>Updates records on the database.</td></tr>
</tbody></table>
</div>
<h2 id="commit"><a class="header" href="#commit"><code>Commit()</code></a></h2>
<p>When you make changes to the database through an <code>OTransaction</code> object, these changes are not persistent.  In order to make them persistent, you need to commit your changes to the database.  Or, in the event that you aren't happy with the changes, you can revert the database to an earlier state, that is the state of the last commit or before you opened the transaction.</p>
<p>To commit your changes to the database, call the <code>Commit()</code> method on the transaction.</p>
<pre><code class="language-csharp">// COMMIT TRANSACTION
trx.Commit();
</code></pre>
<p>All changes made on the transaction are now committed to the database.</p>
<h2 id="reset"><a class="header" href="#reset"><code>Reset()</code></a></h2>
<p>When you make changes on the database that you are not happy with, such as in cases where there's a problem or issue with the database state, you can roll the data back to an earlier state by calling the <code>Revert()</code> method on the transaction.</p>
<pre><code class="language-csharp">// REVERT CHANGES ON TRANSACTION
trx.Revert();
</code></pre>
<p>All changes made on the transaction are removed.  The database reverts to its earlier state.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-net---addt"><a class="header" href="#orientdb-net---addt">OrientDB-NET - <code>Add&lt;T&gt;()</code></a></h1>
<p>This method adds records to the database.  The new records remain part of the transaction and can either be removed or made persistent, through <a href="dotnet/NET-Transactions.html#commit"><code>Commit()</code></a> or <a href="dotnet/NET-Transactions.html#reset"><code>Revert()</code></a>.</p>
<h2 id="adding-records"><a class="header" href="#adding-records">Adding Records</a></h2>
<p>In order to add records to the database, you need to initialize the objects and then pass them to the <code>Add&lt;T&gt;()</code> method.</p>
<h3 id="syntax-260"><a class="header" href="#syntax-260">Syntax</a></h3>
<pre><code>OTransaction.Add&lt;T&gt;(T typedObject)
</code></pre>
<h3 id="example-106"><a class="header" href="#example-106">Example</a></h3>
<p>For instance, if you find yourself often adding records with complex information or changes made to multiple fields, you may find it useful to implement a helper function to simplify these operations.</p>
<pre><code class="language-csharp">using Orient.Client;
using System; 
...

// ADD RECORDS TO THE DATABASE
public void AddRecords(OTransaction trx, List&lt;Dictionary&lt;string, string&gt;&gt;	records)
{
   // LOG OPERATION
   Console.WriteLine("Adding Records to Transaction");

   // LOOP OVER NEW RECORDS LIST
   foreach(Dictionary&lt;string, string&gt; record in records)
   {
      // INITIALIZE RECORD
      ODocument document = ODocument();

      // DEFINE RECORD CONTENTS
      foreach(KeyValuePair&lt;string, string&gt; field in record)
      {
         // DEFINE FIELD
         document.SetField&lt;string&gt;(field.Key, field.Value);
      }
      
      // ADD TO RECORD TO TRANSACTION
      trx.Add&lt;ODocument&gt;(document);
   }

}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-net---addedge"><a class="header" href="#orientdb-net---addedge">OrientDB-NET - <code>AddEdge()</code></a></h1>
<p>This method is used to add an edge to the database.  The new edge remains a part of the transaction until you commit the change and can be moved by rolling back to an earlier state.</p>
<h2 id="adding-edges-2"><a class="header" href="#adding-edges-2">Adding Edges</a></h2>
<p>In order to add an edge to the database, you need to create an <code>OEdge</code> object, then call the <code>AddEdge()</code> method, passing to it the connecting vertices as arguments.</p>
<h3 id="syntax-261"><a class="header" href="#syntax-261">Syntax</a></h3>
<pre><code>OTransaction.AddEdge( OEdge edge,
             OVertex fromVertex,
             OVertex toVertex)
</code></pre>
<ul>
<li><strong><code>edge</code></strong> Defines the edge object you want to add.</li>
<li><strong><code>fromVertex</code></strong> Defines the vertex the edge connects from.</li>
<li><strong><code>toVertex</code></strong> Defines the vertex the edge connects to.</li>
</ul>
<h3 id="example-107"><a class="header" href="#example-107">Example</a></h3>
<p>In cases where you have a class that connects to multiple edges, you may find it more convenient to use a helper function to quickly define and add edges to records.</p>
<pre><code class="language-csharp">using Orient.Client;
using System;
...

// CONNECT EDGES
public void TrxConnectEdges(OTransaction trx, Dictionary&lt;OEdge, Dictionary&lt;string, OVertex&gt;&gt; edges)
{
   // LOG OPERATION
   Console.WriteLine("Adding Edges");

   // LOOP OVER EACH EDGE
   foreach(KeyValuePair&lt;OEdge, Dictionary&lt;string, OVertex&gt;&gt; edge in edges)
   {
      // DEFINE VERTICES
      OVertex from = edge.Value['from'];
      OVertex to = edge.Value['to'];

      // ADD VERTICES
      trx.AddEdge(edge.Key, from, to);
   }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-net---addorupdatet"><a class="header" href="#orientdb-net---addorupdatet">OrientDB-NET - <code>AddOrUpdate&lt;T&gt;()</code></a></h1>
<p>This method adds a new record to the database.  In the event that the record already exists, it updates the record with new data.</p>
<h2 id="adding-or-updating-records"><a class="header" href="#adding-or-updating-records">Adding or Updating Records</a></h2>
<p>In deployments where there is the risk of the database changing while the transaction is open or where you are uncertain if a class exists on the database, you can call the <code>AddOrUpdate()</code> method to add a new record or update an existing one, depending on whether or not the record exists already on the database.</p>
<h3 id="syntax-262"><a class="header" href="#syntax-262">Syntax</a></h3>
<pre><code>OTransaction.AddOrUpdate&lt;T&gt;(T target)
</code></pre>
<ul>
<li><strong><code>target</code></strong> Defines the object you want to add or update on the database.  It is of the type defined by the generic.</li>
</ul>
<h3 id="example-108"><a class="header" href="#example-108">Example</a></h3>
<p>For instance, if you find yourself often adding or updating records with complex, but routine, information, you may find it useful to implement a helper function to simplify these operations.</p>
<pre><code class="language-csharp">using Orient.Client;
using System;
...

// ADD OR UPDATE TRANSACTION
public void TrxUpdate(OTransaction trx, Dictionary&lt;ORID, Dictionary&lt;string, string&gt;&gt; records)
{
   // LOG OPERATION
   Console.WriteLine("Updating Records in Transaction");

   // LOOP OVER RECORDS
   foreach(KeyValuePair&lt;ORID, Dictionary&lt;string, string&gt;&gt; record in records)
   {
      // LOAD RECORD
      ODocument document = LoadRecord().ORID(record.Key);

      // DEFINE FIELDS
      foreach(KeyValuePair&lt;string, string&gt; field in record.Value)
      {
          // SET FIELD
          document.SetField&lt;string&gt;(field.Key, field.Value);
      }

      // ADD OR UPDATE RECORD
      trx.AddOrUpdate&lt;ODocument&gt;(document);
   }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-net---deletet"><a class="header" href="#orientdb-net---deletet">OrientDB-NET - <code>Delete&lt;T&gt;()</code></a></h1>
<p>This method is used to remove records from the database.  Define the type through the generic.</p>
<h2 id="removing-records-2"><a class="header" href="#removing-records-2">Removing Records</a></h2>
<p>In certain situations you may want to programmatically remove records from OrientDB.  Using the <code>Delete&lt;T&gt;()</code> method you can remove the instance as part of a transaction.</p>
<h3 id="syntax-263"><a class="header" href="#syntax-263">Syntax</a></h3>
<pre><code>OTransaction.Delete&lt;T&gt;(T typedObject)
</code></pre>
<ul>
<li><strong><code>typedObject</code></strong> Defines the object you want to remove.  The object must be of the same type as defined in the <code>T</code> generic.</li>
</ul>
<h3 id="example-109"><a class="header" href="#example-109">Example</a></h3>
<p>For instance, say that you want to create a function for removing records from the database.</p>
<pre><code class="language-csharp">public void removeDocument(OTransaction trx, ODocument document)
{
   // REMOVE RECORD
   trx.Delete&lt;ODocument&gt;(document);
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-net---getpendingobjectt"><a class="header" href="#orientdb-net---getpendingobjectt">OrientDB-NET - <code>GetPendingObject&lt;T&gt;()</code></a></h1>
<p>This method returns objects from a transaction.</p>
<h2 id="retrieve-pending-objects"><a class="header" href="#retrieve-pending-objects">Retrieve Pending Objects</a></h2>
<p>In cases where you need to operate on particular records already added to a transaction, you can use <code>GetPendingObject&lt;T&gt;()</code> to retrieve it.</p>
<h3 id="syntax-264"><a class="header" href="#syntax-264">Syntax</a></h3>
<pre><code>T trx.GetPendingObject&lt;T&gt;(ORID rid)
</code></pre>
<ul>
<li><strong><code>rid</code></strong> Defines the Record ID that you want to retrieve.</li>
</ul>
<h3 id="example-110"><a class="header" href="#example-110">Example</a></h3>
<p>For instance, say you want to retrieve a vertex from a transaction:</p>
<pre><code class="language-csharp">public OVertex fetchVertex(OTransaction trx, ORID rid)
{
   // FETCH VERTEX
   OVertex target = trx.GetPendingObject&lt;OVertex&gt;(rid);
   return target;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-net---updatet"><a class="header" href="#orientdb-net---updatet">OrientDB-NET - <code>Update&lt;T&gt;()</code></a></h1>
<p>This method allows you to update records as part of a transaction.</p>
<h2 id="updating-records-5"><a class="header" href="#updating-records-5">Updating Records</a></h2>
<p>Using this method you can update records that already exist in the database as part of a transaction.  This way you can evaluate the changes before committing them to the database.</p>
<h3 id="syntax-265"><a class="header" href="#syntax-265">Syntax</a></h3>
<pre><code>void trx.Update&lt;T&gt;(T typedObject)
</code></pre>
<ul>
<li><strong><code>typedObject</code></strong> Defines the object you want to update.</li>
</ul>
<h3 id="example-111"><a class="header" href="#example-111">Example</a></h3>
<p>For instance, if you find yourself often updating records with complex information or changes made to multiple fields, you may find it useful to implement a helper function to simplify this process.</p>
<pre><code class="language-csharp">using Orient.Client;
using System;
...

// UPDATE RECORDS
public void updateRecord(OTransaction trx, Dictionary&lt;ODocument, Dictionary&lt;string, string&gt;&gt; records)
{
   // LOG OPERATION
   Console.WriteLine("Update Records");

   // LOOP OVER DOCUMENTS
   foreach(KeyValuePair&lt;ODocument, Dictionary&lt;string, string&gt;&gt; record in records)
   {
      // INITIALIZE VARIABLES
      ODocument document = record.Key;
      Dictionary&lt;string, string&gt; fields = record.Value;

      // SET CHANGES
      foreach(KeyValuePair&lt;string, string&gt; field in fields)
      {
          // SET FIELD
          document.SetField&lt;string&gt;(field.Key, field.Value);
      }

      // APPLY CHANGES TO TRANSACTION
      trx.Update&lt;ODocument&gt;(document);
   }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---php-driver"><a class="header" href="#phporient---php-driver">PhpOrient - PHP Driver</a></h1>
<p>OrientDB supports a number of application programming interfaces, natively through the JVM and externally through the <a href="php/../internals/Network-Binary-Protocol.html">Binary Protocol</a>.  In the event that you need or would prefer to develop your application for OrientDB using PHP, you can do so through the official driver: <a href="https://github.com/orientechnologies/PhpOrient">PhpOrient</a>.</p>
<p>It requires OrientDB version 1.7.4 or later.  It also requires that your application use PHP version 5.4 or later, with the Socket extension enabled.</p>
<h2 id="getting-phporient"><a class="header" href="#getting-phporient">Getting PhpOrient</a></h2>
<p>In order to use PhpOrient with your application, you first need to install it on your system.  There are two methods available to you in installing PhpOrient: registering PhpOrient as a dependency of your application or manually retrieving the source code and installing it separately on your system.  Both methods require PHP Composer.</p>
<h3 id="dependency-registration"><a class="header" href="#dependency-registration">Dependency Registration</a></h3>
<p>When working with an existing project or in cases where you already have PHP Composer installed, you can register PhpOrient as a dependency of your project.  To do so, run the following command from your project directory:</p>
<pre>
$ <code class="lang-sh userinput">php composer.phar require "ostico/phporient:dev-master" \
      --update-no-dev</code>
</pre>
<p>Running this command registers PhpOrient as a requirement of your project.  It also links the requirement to the GitHub repository for PhpOrient, so you can also install updates as they become available.</p>
<h3 id="manual-installation"><a class="header" href="#manual-installation">Manual Installation</a></h3>
<p>In cases where you would like to manually install PhpOrient, you can retrieve the source code from GitHub, then install it locally with dependencies through PHP Composer.</p>
<ol>
<li>
<p>Using <code>git</code>, retrieve the source code from GitHub:</p>
<pre>
$ <code class="lang-sh userinput">git clone https://github.com/Ostico/PhpOrient.git</code>
</pre>
</li>
<li>
<p>Retrieve and install PHP Composer:</p>
<pre>
$ <code class="lang-sh userinput">cd PhpOrient</code>
$ <code class="lang-sh userinput">php -r "readfile('https://getcomposer.org/installer');" | php</code>
</pre>
</li>
<li>
<p>Install dependencies:</p>
<pre>
php composer.phar --no-dev install
</pre>
</li>
</ol>
<p>PhpOrient is now installed and ready for use on your system.</p>
<h3 id="32-bit-architecture"><a class="header" href="#32-bit-architecture">32-bit Architecture</a></h3>
<p>While PhpOrient supports both 32-bit and 64-bit architectures, there are some issues that you should keep in mind when deploying applications on 32-bit systems.  In order to support Java long integers and to prove better driver performance on these systems, you must install one of the following libraries:</p>
<ul>
<li><a href="http://php.net/manual/en/book/bc.php">BCMath Arbitrary Precision Mathematics</a></li>
<li><a href="http://php.net/manual/en/book/gmp.php">GNU Multiple Precision</a></li>
</ul>
<p>When your 32-bit application receives a Java long integer from OrientDB, values greater than 2^32 are lost as they exceed the maximum possible number that the system can store in thirty-two bits.  To get around this limitation, PhpOrient uses with either the BCMath or GMP libraries to always handle numbers as strings.</p>
<h2 id="using-phporient"><a class="header" href="#using-phporient">Using PhpOrient</a></h2>
<p>During installation, PHP Composer generates an autoload file that you can use in retrieving PhpOrient classes and functions to use with your application.  To implement these features, add the following lines to any file where you would like to have these features available:</p>
<pre><code class="language-php">require "vendor/autoload.php";
use PhpOrient\PhpOrient;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---client-connections"><a class="header" href="#phporient---client-connections">PhpOrient - Client Connections</a></h1>
<p>Within your PHP application, performing operations on OrientDB servers and databases requires a client interface.  By convention, this interface is called <code>$client</code> within these docs, but you can use any variable name you prefer.  Once you have initialized this connection, you can begin to call additional methods to operate on <a href="php/PHP-Server.html">servers</a> and <a href="php/PHP-Database.html">databases</a>.</p>
<h2 id="initializing-client-connections"><a class="header" href="#initializing-client-connections">Initializing Client Connections</a></h2>
<p>In order to initialize a client connection within your application, you need to create a new instance of <code>PhpOrient()</code>.  Once you have instantiating the class, you need to define variables within the class to configure its connection.</p>
<pre><code class="language-php">require "vendor/autoload.php";
use PhpOrient\PhpOrient;

// INITIALIZE CLIENT CONNECTION
$client =  new PhpOrient('localhost', 2424);

// SET CREDENTIALS
$client-&gt;username = 'admin';
$client-&gt;password = 'admin_passwd';
</code></pre>
<h3 id="alternative-methods"><a class="header" href="#alternative-methods">Alternative Methods</a></h3>
<p>In addition to the method shown above, there are two alternative methods available in configuring the client connection. The first of these is to manually set all of the configuration variables.</p>
<pre><code class="language-php">// INITIALIZE CLIENT
$client = new PhpOrient();

// CONFIGURE CLIENT
$client-&gt;hostname	= 'localhost';
$client-&gt;port		= 2424;
$client-&gt;username	= 'root';
$client-&gt;password	= 'root_passwd';
</code></pre>
<p>Alternatively, you can set the variables through the <code>configure()</code> method.</p>
<pre><code class="language-php">// INITIALIZE CLIENT
$client = new PhpOrient();

// CONFIGURE CLIENT
$client-&gt;configure(
	array(
		'username'	=&gt; 'root',
		'password'	=&gt; 'root_passwd',
		'hostname'	=&gt; 'localhost',
		'port'		=&gt; 2424));
</code></pre>
<h3 id="persistent-connections"><a class="header" href="#persistent-connections">Persistent Connections</a></h3>
<p>Beginning in version 27, PhpOrient provides support for persistent client connections.  This allows you to set a session token, then connect, disconnect and reconnect to the given session as suits the needs of your application.</p>
<p>When using persistent connections, use the <code>setSessionToken()</code> method with a boolean value to enable the feature.  Then use the <code>getSessionToken()</code> method to retrieve a token for the given session.</p>
<pre><code class="language-php">
// INITIALIZE CLIENT
$client = new PhpOrient('localhost', 2424);

// ENABLE PERSISTENT CONNECTIONS
$client-&gt;setSessionToken(true);

// RETRIEVE SESSION TOKEN
$sessionToken = $client-&gt;getSessionToken();
</code></pre>
<p>Once you have the session token, you can reattach to an existing session using it.  For instance, elsewhere in your code, you might want a function to handle the reconnection:</p>
<pre><code class="language-php">// CREATE CLIENT
function getClient($sessionToken){

	// Instantiate Client
	$client = new PhpOrient("localhost", 2424);

	// Open Session
	$client-&gt;setSessionToken($sessionToken);

	return $client;
}
</code></pre>
<p>In cases where you call <code>getSessionToken()</code> before enabling persistent connections on the client, the method returns an empty string.  You can use this behavior to perform basic checks to ensure everything is working properly.  For instance,</p>
<pre><code class="language-php">function getToken(){

	// Log Operation
	echo "Retrieving Session Token";

	// Fetch Globals
	global $client;
	global $sessionToken;

	// Set Session Token
	$sessionToken = $client-&gt;getSessionToken();

	if ($sessionToken == ''){

		// Enable Session Token
		$client-&gt;setSessionToken(true);

		// Fetch New Token
		$sessionToken = $client-&gt;getSessionToken();
	}

}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---server-operations"><a class="header" href="#phporient---server-operations">PhpOrient - Server Operations</a></h1>
<p>Once you have the client interface ready in your application, you can begin to operate on OrientDB servers and databases.  In order to administer the server, you first need to connect to it.</p>
<h2 id="connecting-to-the-server"><a class="header" href="#connecting-to-the-server">Connecting to the Server</a></h2>
<p>When you need to perform server operations, instantiate the client interface using credentials that can access your OrientDB Server, then issue the <code>connect()</code> method to establish a connection to the server.</p>
<pre><code class="language-php">require "vendor/autoload.php";
use PhpOrient\PhpOrient;

// INITIALIZE CLIENT
$client = new PhpOrient('localhost' 2424);

// CONFIGURE CONNECTION
$client-&gt;username = 'root';
$client-&gt;password = 'root_passwd';

// CONNECT
$client-&gt;connect();
</code></pre>
<p>When your application gets to this point, the <code>$client</code> variable is now connected to the OrientDB Server and able to perform various operations.</p>
<blockquote>
<p><strong>NOTE</strong>: There are several methods available to you in initializing a client connection.  For more information on the available methods, see <a href="php/PHP-Client.html#alternative-methods">Client Connections</a>.</p>
</blockquote>
<h2 id="operating-on-the-server"><a class="header" href="#operating-on-the-server">Operating on the Server</a></h2>
<p>The client interface provides a number of methods for database and server operations.  The table below provides a list of methods for server operations, specifically in creating, opening, listing and removing databases on the server.</p>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="php/PHP-dbCreate.html"><code>dbCreate()</code></a></td><td>Creates a database</td></tr>
<tr><td><a href="php/PHP-dbDrop.html"><code>dbDrop()</code></a></td><td>Removes a database</td></tr>
<tr><td><a href="php/PHP-dbExists.html"><code>dbExists()</code></a></td><td>Checks that database exists</td></tr>
<tr><td><a href="php/PHP-dbList.html"><code>dbList()</code></a></td><td>Lists databases on server</td></tr>
<tr><td><a href="php/PHP-Database.html"><code>dbOpen()</code></a></td><td>Opens an existing database</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---dbcreate"><a class="header" href="#phporient---dbcreate">PhpOrient - <code>dbCreate()</code></a></h1>
<p>Creates a database on the connected OrientDB Server.</p>
<h2 id="creating-databases-5"><a class="header" href="#creating-databases-5">Creating Databases</a></h2>
<p>In the event that a database does not already exist on the server, you can create one from within your application, using the <code>dbCreate()</code> method.  This method requires one argument, the database name, and can take two additional arguments defining the storage and database types.  It returns the default cluster ID.</p>
<h3 id="syntax-266"><a class="header" href="#syntax-266">Syntax</a></h3>
<pre><code>$new_cluster_id = $client-&gt;dbCreate(
	&lt;database&gt;, 
	&lt;storage-type&gt;,
    &lt;database-type&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;database&gt;</code></strong> Defines the database name.</li>
<li><strong><code>&lt;storage-type&gt;</code></strong> Defines the storage type to use.  Valid storage types:
<ul>
<li><em><code>PhpOrient::STORAGE_TYPE_PLOCAL</code></em> Sets PLocal storage.  This is the default option.</li>
<li><em><code>PhpOrient::STORAGE_TYPE_MEMORY</code></em> Sets in-memory storage.</li>
</ul>
</li>
<li><strong><code>&lt;database-type&gt;</code></strong> Defines the database type to create.  Valid database types:
<ul>
<li><em><code>PhpOrient::DATABASE_TYPE_GRAPH</code></em> Sets the method to create a graph database.  This is the default option.</li>
<li><em><code>PhpOrient:DATABASE_TYPE_DOCUMENT</code></em> Sets the method to create a document database.</li>
</ul>
</li>
</ul>
<h3 id="example-112"><a class="header" href="#example-112">Example</a></h3>
<p>Consider the use case of a web application.  Rather than just assuming that OrientDB is ready to serve data to your application, you might want to start by checking whether a database exists and is ready for your use and in the event that it doesn't exist, have your application create it for you.  For instance,</p>
<pre><code class="language-php">// OPEN OR CREATE DATABASE
function dbOpenCreate($dbname, $user, $passwd){

	// RETRIEVE GLOBAL CLIENT
	global $client;

	// CHECK IF EXISTS
	if !($client-&gt;dbExists($dbname)){
		// CREATE DATABASE
		$client-&gt;dbCreate($dbname,
			PhpOrient::STORAGE_TYPE_PLOCAL,
			PhpOrient::DATABASE_TYPE_GRAPH);
	}
	return $client-&gt;dbOpen($dbname, $user, $passwd);
}
</code></pre>
<p>This function takes the database name and database login credentials as arguments.  Using <a href="php/PHP-dbExists.html"><code>dbExists()</code></a> it determines whether the database exists on the database and creates it if it doesn't exist.  Then it opens the given database, returning the cluster map.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---dbdrop"><a class="header" href="#phporient---dbdrop">PhpOrient - <code>dbDrop()</code></a></h1>
<p>Remove the given database from OrientDB.</p>
<h2 id="dropping-databases-2"><a class="header" href="#dropping-databases-2">Dropping Databases</a></h2>
<p>In certain situations, you may want to remove a full database from the OrientDB Server.  For instance, if you create a temporary database in memory for certain operations or if you want to provide the user with the ability to uninstall the database from within the application, without removing OrientDB itself.</p>
<h3 id="syntax-267"><a class="header" href="#syntax-267">Syntax</a></h3>
<pre><code>$client-&gt;dbDrop(
	&lt;database-name&gt;,
	&lt;storage-type&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;database-name&gt;</code></strong> Defines the database name.</li>
<li><strong><code>&lt;storage-type&gt;</code></strong> Defines the storage type.  This is an optional variable, defaults to PLocal.
<ul>
<li><em><code>PhpOrient::STORAGE_TYPE_PLOCAL</code></em> Sets the PLocal storage type.</li>
<li><em><code>PhpOrient::STORAGE_TYPE_MEMORY</code></em> Sets in-memory storage type.</li>
</ul>
</li>
</ul>
<h3 id="example-113"><a class="header" href="#example-113">Example</a></h3>
<p>For instance, in the event that your application encounters a catastrophic failure in the database, you might want a function that allows you to reset it to a clean state.</p>
<pre><code class="language-php">// RESET DATABASE
function resetDatabase($client, $dbname){

	// REMOVE DATABASE
	$client-&gt;dbDrop($dbname, PhpOrient::STORAGE_TYPE_MEMORY);

	// CREATE DATABASE
	$client-&gt;dbCreate($dbname, PhpOrient::STORAGE_TYPE_MEMORY);
}
</code></pre>
<p>This function removes the given database, then uses the <a href="php/PHP-dbCreate.html"><code>dbCreate()</code></a> method to create a new one with the same name and storage type.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---dbexists"><a class="header" href="#phporient---dbexists">PhpOrient - <code>dbExists()</code></a></h1>
<p>This method determines whether a database exists on the server.</p>
<h2 id="checking-existence"><a class="header" href="#checking-existence">Checking Existence</a></h2>
<p>There are two methods available in determining whether a database exists on the OrientDB Server.  You can use the <a href="php/PHP-dbList.html"><code>dbList()</code></a> method to retrieve a list of the databases on the server and check them individually within your PHP code or you can individually check database names against this method.</p>
<h3 id="syntax-268"><a class="header" href="#syntax-268">Syntax</a></h3>
<pre><code>$client-&gt;dbExists(
	&lt;database-name&gt;,
	&lt;database-type&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;database-name&gt;</code></strong> Defines the database name.</li>
<li><strong><code>&lt;database-type&gt;</code></strong> Defines the storage type.  The default type is a Graph database.  Valid types:
<ul>
<li><em><code>PhpOrient::DATABASE_TYPE_GRAPH</code></em> Sets to Graph database.</li>
<li><em><code>PhpOrient::DATABASE_TYPE_DOCUMENT</code></em> Sets to Document database.</li>
</ul>
</li>
</ul>
<h3 id="example-114"><a class="header" href="#example-114">Example</a></h3>
<p>Consider the use case of a web application.  Rather than just assuming that OrientDB is ready to serve data to your application, you might want to start by checking whether a database exists and is ready for your use and in the event that it doesn't exist, have your application create it for you.  For instance,</p>
<pre><code class="language-php">// OPEN OR CREATE DATABASE
function dbOpenCreate($client, $dbname, $user, $passwd){

	// CHECK IF EXISTS
	if !($client-&gt;dbExists($dbname)){
		// CREATE DATABASE
		$client-&gt;dbCreate($dbname,
			PhpOrient::STORAGE_TYPE_PLOCAL,
			PhpOrient::DATABASE_TYPE_GRAPH);
	}
	return $client-&gt;dbOpen($dbname, $user, $passwd);
}
</code></pre>
<p>This function takes the client interface, database name and login credentials as arguments.  It uses this method to check whether the given database exists.  If it does not exist, it creates it with <a href="php/PHP-dbCreate.html"><code>dbCreate()</code></a>.  Then, it opens the given database, returning the cluster map.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---dblist"><a class="header" href="#phporient---dblist">PhpOrient - <code>dbList()</code></a></h1>
<p>Retrieves a list of databases on the server.</p>
<h2 id="listing-databases-3"><a class="header" href="#listing-databases-3">Listing Databases</a></h2>
<p>In certain situations, you may want to list all databases available on the OrientDB Server.  You might find this useful when operating on multiple databases or when logging.</p>
<h3 id="syntax-269"><a class="header" href="#syntax-269">Syntax</a></h3>
<pre><code>$client-&gt;dbList()
</code></pre>
<h3 id="example-115"><a class="header" href="#example-115">Example</a></h3>
<p>For instance, when developing a web application that servers multiple sites each with its own database, you might want to list the database names in your logs when the application starts.</p>
<pre><code class="language-php">// LOOP OVER DATABASES AND ECHO NAMES
foreach ($client-&gt;dbList() as $db){
	echo "Database: $db";
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---dbopen"><a class="header" href="#phporient---dbopen">PhpOrient - <code>dbOpen()</code></a></h1>
<p>This method opens a database on the client interface.  The return value is a <a href="php/PHP-ClusterMap.html">cluster map</a>.</p>
<h2 id="opening-databases-3"><a class="header" href="#opening-databases-3">Opening Databases</a></h2>
<p>When the database you want exists already on the OrientDB Server, you can open it on the client interface using this method with the appropriate name and login credentials.  Once you have it open, a series of additional methods become available through the client interface.  These allow you to insert, retrieve and modify records in the database.</p>
<h3 id="syntax-270"><a class="header" href="#syntax-270">Syntax</a></h3>
<pre><code>$client-&gt;dbOpen('&lt;database-name&gt;', '&lt;user&gt;', '&lt;password&gt;')
</code></pre>
<ul>
<li><strong><code>&lt;database-name&gt;</code></strong> Defines the database you want to open.</li>
<li><strong><code>&lt;user&gt;</code></strong> Defines the user you want to access the database.</li>
<li><strong><code>&lt;password&gt;</code></strong> Defines the password to use.</li>
</ul>
<h3 id="example-116"><a class="header" href="#example-116">Example</a></h3>
<p>For instance, in the use case of web application, you might use something like this to connect to the database.</p>
<pre><code class="language-php">// CONNECT TO DATABASE
$ClusterMap = $client-&gt;dbOpen('GratefulDeadConcerts', 'admin', 'admin_passwd');
</code></pre>
<h2 id="working-with-database"><a class="header" href="#working-with-database">Working with Database</a></h2>
<p>Once you have an open database on the client interface, a series of additional methods become available to you.  These methods handle common operations on the database, in terms of inserting and fetching records as well as manipulating clusters on the database.</p>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="php/PHP-Command.html"><strong><code>command()</code></strong></a></td><td>Executes a command on the database.</td></tr>
<tr><td><a href="php/PHP-dataClusterAdd.html"><strong><code>dataClusterAdd()</code></strong></a></td><td>Adds a cluster to the database.</td></tr>
<tr><td><a href="php/PHP-dataClusterCount.html"><strong><code>dataClusterCount()</code></strong></a></td><td>Counts records in a cluster or clusters.</td></tr>
<tr><td><a href="php/PHP-dataClusterDrop.html"><strong><code>dataClusterDrop()</code></strong></a></td><td>Removes a cluster from the database.</td></tr>
<tr><td><a href="php/PHP-dataClusterDataRange.html"><strong><code>dataClusterDataRange()</code></strong></a></td><td>retrieves a range of Record ID's for the given cluster.</td></tr>
<tr><td><a href="php/PHP-dbCountRecords.html"><strong><code>dbCountRecords()</code></strong></a></td><td>Counts records on a database.</td></tr>
<tr><td><a href="php/PHP-dbReload.html"><strong><code>dbReload()</code></strong></a></td><td>Reloads the database on the client interface.</td></tr>
<tr><td><a href="php/PHP-dbSize.html"><strong><code>dbSize()</code></strong></a></td><td>Returns the size of the database.</td></tr>
<tr><td><a href="php/PHP-Tx.html"><strong><code>getTransactionStatement()</code></strong></a></td><td>Instantiates a transaction interface.</td></tr>
<tr><td><a href="php/PHP-Query.html"><strong><code>query()</code></strong></a></td><td>Queries the database.</td></tr>
<tr><td><a href="php/PHP-queryAsync.html"><strong><code>queryAsync()</code></strong></a></td><td>Queries the database with support for callback functions and Fetching Strategies.</td></tr>
<tr><td><a href="php/PHP-recordCreate.html"><strong><code>recordCreate()</code></strong></a></td><td>Creates a record on database.</td></tr>
<tr><td><a href="php/PHP-recordLoad.html"><strong><code>recordLoad()</code></strong></a></td><td>Loads a record from the database.</td></tr>
<tr><td><a href="php/PHP-recordUpdate.html"><strong><code>recordUpdate()</code></strong></a></td><td>Updates a record on the database.</td></tr>
<tr><td><a href="php/PHP-sqlBatch.html"><strong><code>sqlBatch()</code></strong></a></td><td>Executes an SQL batch command.</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---command"><a class="header" href="#phporient---command">PhpOrient - <code>command()</code></a></h1>
<p>This method issues an <a href="php/../sql/README.html">SQL</a> command to the database.</p>
<h2 id="sending-commands-2"><a class="header" href="#sending-commands-2">Sending Commands</a></h2>
<p>In certain situations, you may find it more convenient or preferable to issue commands to the database using SQL rather than PhpOrient methods.  Use this method only to perform non-idempotent commands.</p>
<h3 id="syntax-271"><a class="header" href="#syntax-271">Syntax</a></h3>
<pre><code>$client-&gt;command(&lt;sql&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;sql&gt;</code></strong> Defines the SQL command to run.</li>
</ul>
<h3 id="example-117"><a class="header" href="#example-117">Example</a></h3>
<p>For instance, if you find yourself frequently inserting complex data into your database, you might want to develop a function that takes the client interface, class, and an array mapping property names to values.</p>
<pre><code class="language-php">function insertData($client, $class, $dataArray){

	// CONSTRUCT BASE SQL INSERT STATEMENT
	$sql = 'INSERT INTO $class';

	// LOOP IN DATA VALUES FROM ARRAY
	foreach($dataArray as $property =&gt; $value) {

		// ADD INSERT
		$sql = '$sql SET $property = \'$value\'';
	}

    // ISSUE COMMAND
	$client-&gt;command($sql);
}
</code></pre>
<p>Here, your function constructs an <a href="php/../sql/SQL-Insert.html"><code>INSERT</code></a> statement from the given array, then issues the command to OrientDB.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---dataclusteradd"><a class="header" href="#phporient---dataclusteradd">PhpOrient - <code>dataClusterAdd()</code></a></h1>
<p>This method creates a new cluster on the database.</p>
<h2 id="adding-clusters-3"><a class="header" href="#adding-clusters-3">Adding Clusters</a></h2>
<p>In cases where you want to create clusters programmatically, such as in an initialization script that prepares OrientDB for your application, this method allows you to add new physical and in-memory clusters to the databases.</p>
<h3 id="syntax-272"><a class="header" href="#syntax-272">Syntax</a></h3>
<pre><code>$client-&gt;dataClusterAdd(
	"&lt;name&gt;",
	&lt;cluster-type&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;name&gt;</code></strong> Defines the cluster name.  By convention, this is generally lowercase.</li>
<li><strong><code>&lt;cluster-type&gt;</code></strong> Defines the cluster type.  Supported types are:
<ul>
<li><em><code>PhpOrient::CLUSTER_TYPE_PHYSICAL</code></em> Sets the method to create a physical cluster, which is the default.</li>
<li><em><code>PhpOrient::CLUSTER_TYPE_MEMORY</code></em> Sets the method to create an in-memory cluster.</li>
</ul>
</li>
</ul>
<h3 id="example-118"><a class="header" href="#example-118">Example</a></h3>
<p>For instance, imagine you have an application that stores volatile data in-memory.  You might want a function to create a series of in-memory clusters as need.</p>
<pre><code class="language-php">// CREATE AD-HOC MEMORY CLUSTERS
function createMemClusters($names){

	// LOG OPERATION
	echo "Creating Clusters";

	// FETCH GLOBAL CLIENT
	global $client;

	// CREATE CLUSTERS
	foreach($names as $name){

		// CREATE IN-MEMORY CLUSTER
		$client-&gt;dataClusterAdd($name,
			PhpOrient::CLUSTER_TYPE_MEMORY);
	}
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---dataclustercount"><a class="header" href="#phporient---dataclustercount">PhpOrient - <code>dataClusterCount()</code></a></h1>
<p>This method returns a count of records in the given cluster.</p>
<h2 id="counting-records-2"><a class="header" href="#counting-records-2">Counting Records</a></h2>
<p>In certain situations you may find it useful to check how many records a given cluster contains, for instance as part of logging or debugging, or to check cluster size before running a backup script.</p>
<h3 id="syntax-273"><a class="header" href="#syntax-273">Syntax</a></h3>
<pre><code>$client-&gt;dataClusterCount(&lt;clusters&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;clusters&gt;</code></strong> Defines the cluster or clusters you want to count on.</li>
</ul>
<h3 id="example-119"><a class="header" href="#example-119">Example</a></h3>
<p>Picture a web application where you want to count records in a given cluster.  For instance, on a blog site you might want a basic count to show the number of entries you host on the site across several entries.</p>
<pre><code class="language-php">function countBlogs(){

	// Fetch Global Client
	global $client;

	// Return Record Count
	return $client-&gt;dataClusterCount(
		$client-&gt;getTransport()-&gt;getClusterMap()-&gt;getIdList());
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---dataclusterdrop"><a class="header" href="#phporient---dataclusterdrop">PhpOrient - <code>dataClusterDrop()</code></a></h1>
<p>This method drops the given cluster.</p>
<h2 id="dropping-clusters"><a class="header" href="#dropping-clusters">Dropping Clusters</a></h2>
<p>In certain situations, you may find it useful to programmatically remove clusters from the database.  For instance, in the case of a maintenance script that frees up space when the given cluster is no longer needed.  This method allows you to remove clusters by their Cluster ID, which is the first number in a Record ID.</p>
<h3 id="syntax-274"><a class="header" href="#syntax-274">Syntax</a></h3>
<pre><code>$client-&gt;dataClusterDrop(&lt;cluster-id&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;cluster-id&gt;</code></strong> Defines the Cluster ID to remove.</li>
</ul>
<h3 id="example-120"><a class="header" href="#example-120">Example</a></h3>
<p>Consider the example of a web application that uses multiple in-memory clusters for short term needs.  For this purpose, you might want a function to quickly remove these clusters when you're finished using them.</p>
<pre><code class="language-php">// REMOVE CLUSTER
function removeCluster($clusterId){

	// Log Operation
	echo "Removing Cluster: $clusterId";

	// Fetch Global Client
	global $client;

	// Remove Cluster
	$client-&gt;dataClusterDrop($clusterId);
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---dataclusterdatarange"><a class="header" href="#phporient---dataclusterdatarange">PhpOrient - <code>dataClusterDataRange()</code></a></h1>
<p>This method fetches a range of Record ID's by cluster.</p>
<h2 id="retrieving-ranges-of-records"><a class="header" href="#retrieving-ranges-of-records">Retrieving Ranges of Records</a></h2>
<p>In some cases, you may want to retrieve all records in a given cluster.  This method uses the Cluster ID to identify the records you want to access.</p>
<h3 id="syntax-275"><a class="header" href="#syntax-275">Syntax</a></h3>
<pre><code>$client-&gt;dataClusterDataRange(&lt;cluster-id&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;cluster-id&gt;</code></strong> Defines the Cluster ID for records you want to retrieve records from.</li>
</ul>
<h3 id="example-121"><a class="header" href="#example-121">Example</a></h3>
<p>Consider the example of a web application where you need to periodically retrieve and operate on large bodies of records by cluster.  Rather than manually retrieving clusters by ID, you might set up global map to keep the references human readable.</p>
<pre><code class="language-php">// Clusters
$clusters = array(
	"BlogsUS" =&gt; array(3, 4, 5),
	"BlogsEU" =&gt; array(1, 2, 6, 9),
	"BlogsME" =&gt; array(7, 8)
);

// Fetch Record ID's
function fetchRIds($regionName){

	// Log Operation
	echo "Fetching Records: $regionName";
	
	// Initialize Global Variables 
	global $clusters;
	global $client;

	// Initialize Local Variables 
	$returnArray = array();
	$region = $clusters[$regionName];

	// Loop Over Cluster ID's in Region
	foreach($region as $clusterId){

		// Append Record ID's to Return Array
		$returnArray[] = $client-&gt;dataClusterDataRange($clusterId);
	}

	// Return Record ID's
	return $returnArray;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---dbcountrecords"><a class="header" href="#phporient---dbcountrecords">PhpOrient - <code>dbCountRecords()</code></a></h1>
<p>This method returns the number of records in the database.</p>
<h2 id="counting-records-3"><a class="header" href="#counting-records-3">Counting Records</a></h2>
<p>There are three methods available to you in counting or sizing databases.  This method returns the number of records in the database.  You can also retrieve the size of the database with <a href="php/PHP-dbSize.html"><code>dbSize()</code></a> and the number of records in a cluster with <a href="php/PHP-dataClusterCount.html"><code>dataClusterCount()</code></a>.</p>
<h3 id="syntax-276"><a class="header" href="#syntax-276">Syntax</a></h3>
<pre><code>$client-&gt;dbCountRecords()
</code></pre>
<h3 id="example-122"><a class="header" href="#example-122">Example</a></h3>
<p>As an example, you might use this method in conjunction with unit testing, especially after performing a restore operation on a new server.  That is, a quick way to determine whether the restore process properly executed is to check whether the database contains records.</p>
<pre><code class="language-php">// TEST DATABASE RESTORE
function testRestore($client, $user, $password, $databaseName){
    // LOG OPERATION
	echo "Checking Database: $databaseName";

	// TEST WHETHER DATABASE EXISTS
	assert($client-&gt;dbExists($databaseName));
	
	// TEST THAT DATABASE CONTAINS RECORDS
	$client-&gt;dbOpen($databaseName, $user, $password);
	assert($client-&gt;dbCountRecords() &gt; 0);
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---dbreload"><a class="header" href="#phporient---dbreload">PhpOrient - <code>dbReload()</code></a></h1>
<p>This method updates the client cluster map.</p>
<h2 id="reloading-the-database"><a class="header" href="#reloading-the-database">Reloading the Database</a></h2>
<p>When you create or remove a new class or cluster on the database, it updates OrientDB but not the client interface you have created within your application.  The client interface also does update when changes are made to OrientDB apart from your application.  In these cases, you can use this method to retrieve an updated cluster map from OrientDB.</p>
<h3 id="syntax-277"><a class="header" href="#syntax-277">Syntax</a></h3>
<pre><code>$client-&gt;dbReload()
</code></pre>
<h3 id="example-123"><a class="header" href="#example-123">Example</a></h3>
<p>For instance, rather than calling this method manually after creating a class on the database, you might develop your own function to save yourself the trouble of remembering to make the call elsewhere.</p>
<pre><code class="language-php">// ADD CLUSTER FUNCTION
function addCluster($client, $clusterName){

	// LOG OPERATION
	echo "Adding Cluster $clusterName";

	// ADD CLUSTER TO DATABASE
	$client-&gt;dataClusterAdd($clusterName, PhpOrient::CLUSTER_TYPE_PHYSICAL);

	// RELOAD DATABASE
	$reloaded_list = $client-&gt;dbReload;

	// RETURN NEW LIST
	return $reloaded_list;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---dbsize"><a class="header" href="#phporient---dbsize">PhpOrient - <code>dbSize()</code></a></h1>
<p>This method returns the size of the database.</p>
<h2 id="sizing-databases"><a class="header" href="#sizing-databases">Sizing Databases</a></h2>
<p>There are three methods available to you in counting or sizing databases.  This method returns the size of the database, <a href="php/PHP-dbCountRecords.html"><code>dbCountRecords()</code></a> returns the number of records in the database, and <a href="php/PHP-dataClusterCount.html"><code>dataClusterCount()</code></a> the number of records in a cluster.</p>
<h3 id="syntax-278"><a class="header" href="#syntax-278">Syntax</a></h3>
<pre><code>$client-&gt;dbSize()
</code></pre>
<h3 id="example-124"><a class="header" href="#example-124">Example</a></h3>
<p>For instance, you might use this method in conjunction with unit testing, especially after performing a restore operation on a new server.  That is, a quick way to determine whether the restore process properly executed is to check whether the database contains records.</p>
<pre><code class="language-php">// TEST DATABASE RESTORE
function testRestore($client, $user, $password, $databaseName){

	// LOG OPERATION
	echo "Checking Database: $databaseName";

	// TEST DATABASE EXISTENCE
	assert($client-&gt;dbExists($databaseName));

	// TEST THAT DATABASE CONTAINS RECORDS
	$client-&gt;dbOpen($databaseName, $user, $password);
	assert($client-&gt;dbSize() &gt; 0);
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---query"><a class="header" href="#phporient---query">PhpOrient - <code>query()</code></a></h1>
<p>This method issues an <a href="php/../sql/README.html">SQL</a> query to the database.</p>
<h2 id="querying-the-database-6"><a class="header" href="#querying-the-database-6">Querying the Database</a></h2>
<p>In the event that you're more comfortable working in SQL, you can build and issue queries to OrientDB directly using this method.</p>
<h3 id="syntax-279"><a class="header" href="#syntax-279">Syntax</a></h3>
<pre><code>$client-&gt;query(&lt;sql&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;sql&gt;</code></strong> Defines the query you want to issue.</li>
</ul>
<h3 id="example-125"><a class="header" href="#example-125">Example</a></h3>
<p>In cases where you find yourself frequently issuing queries to OrientDB, you may find it convenient to construction a function to manage the process.</p>
<pre><code class="language-php">// QUERY FUNCTION
function queryDatabase($className, 
			$properties = array('*'), 
			$whereConditions = array(), 
			$limit = 0){

	// LOG OPERATION
	echo "Querying $className";

	// FETCH GLOBAL CLIENT
	global $client;

	// CONSTRUCT SELECT STATEMENT
	if ($properties == array('*')) {
		$sql = "SELECT FROM $classname";
	} else {
		$props = join(', ', $properties)
		$sql = "SELECT $prop FROM $classname";
	}

	// CONSTRUCT WHERE CLAUSE
	if ($whereConditions != array()){
		$where = "WHERE";

		// LOOP OVER CONDITIONS
		foreach($whereConditions as $property =&gt; $value){
			$where = "$where $property = \'$value\'";
		}

		// ADD WHERE TO STATEMENT
		$sql = "$sql $where";
	}

	// ADD LIMIT
	if ($limit &gt; 0){

		// ADD LIMIT TO STATEMENT
		$sql = "$sql LIMIT $limit";
	}

	// QUERY DATABASE
	return $client-&gt;query($sql);
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---queryasync"><a class="header" href="#phporient---queryasync">PhpOrient - <code>queryAsync()</code></a></h1>
<p>This method issues a query to the database.  For each record the query returns, it executes the given callback function.</p>
<h2 id="querying-the-database-7"><a class="header" href="#querying-the-database-7">Querying the Database</a></h2>
<p>When issue a query to OrientDB using the <a href="php/PHP-Query.html"><code>query()</code></a> method, PhpOrient executes the SQL statement against the open database and then gives you all of the records as a return value.  In cases where this is not the desired result, you can use this method to execute a callback function on each record the query returns.</p>
<p>You may find this useful in cases where you need to initiate certain calculations in advance of the final result, or to log information as the query runs.</p>
<h3 id="example-126"><a class="header" href="#example-126">Example</a></h3>
<p>During development, you may find it useful to implement a debugging option that allows you to dump additional information to standard output.  Using this method with the <code>var_dump()</code> function, you can display information on records retrieved from the database.</p>
<pre><code class="language-php">// DEFAULT DEBUG OPTION
$debug = True;

// QUERY DEBUG FUNCTION
function queryDebug(Record $record){

	// LOG OPERATION
	echo "Record Returned:";

	// DUMP RECORD INFORMATION 
	global $debug;
	if ($debug){

		// DUMP RECORD
		var_dump($record);
	}
}

// QUERY DATABASE
function queryDatabase($client, $sql, $fetchPlan){

	// LOG OPERATION
	echo "Querying Database";

	// ISSUE ASYNC QUERY
	$client-&gt;queryAsync($sql, 
		['fetch_plan' =&gt; $fetchPlan, 
		'_callback' =&gt; queryDebug]);
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---recordcreate"><a class="header" href="#phporient---recordcreate">PhpOrient - <code>recordCreate()</code></a></h1>
<p>This method creates a record on the database.</p>
<h2 id="creating-records-2"><a class="header" href="#creating-records-2">Creating Records</a></h2>
<p>Eventually, you'll want your application to programmatically add records to OrientDB.  Using this method you can create a new record and insert it into the database.</p>
<h3 id="syntax-280"><a class="header" href="#syntax-280">Syntax</a></h3>
<pre><code>$client-&gt;recordCreate(&lt;record&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;record&gt;</code></strong> Defines the record to create, it is an instance of <a href="php/PHP-Record.html"><code>Record()</code></a>.</li>
</ul>
<h3 id="example-127"><a class="header" href="#example-127">Example</a></h3>
<p>For instance, say that you are developing a web application to manage blogs for multiple users.  When the user is ready to publish a blog entry to the site, you might use a function such as this to handle creating the new record on the database.</p>
<pre><code class="language-php">// POST FUNCTION
function postBlog($title, $text, $user){

	// LOG OPERATION
	echo "Posting Blog: $title, for $user\n";

	// FETCH GLOBAL PHPORIENT CLIENT
	global $client;

	// BUILD RECORD CONTENT
	$recordContent = [
		'title': $title,
		'author': $user,
		'text': $text];

	// BUILD RECORD
	$record = (new Record() )-&gt;setOData($recordContent)-&gt;setOClass("Blog")-&gt;setRid(new ID(9));

	// CREATE RECORD
	$client-&gt;recordCreate($record);
}
</code></pre>
<blockquote>
<p>Note, when creating new <code>Record()</code> objects, you only set the Cluster ID component of the Record ID.  This helps avoid unexpected results when the record is created on the database in the next line.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---recordload"><a class="header" href="#phporient---recordload">PhpOrient - <code>recordLoad()</code></a></h1>
<p>This method returns a record from the database.</p>
<h2 id="loading-records-2"><a class="header" href="#loading-records-2">Loading Records</a></h2>
<p>In addition to the <a href="php/PHP-Query.html"><code>query()</code></a> method, you can also manually select and load records from the database using this method.  Unlike the query, you need to define the record you want using its Record ID, through the <code>ID()</code> class.</p>
<h3 id="syntax-281"><a class="header" href="#syntax-281">Syntax</a></h3>
<p>In OrientDB a RecordID is built from two numeric values: the Cluster ID and the Record Position.  The <code>ID()</code> class in PhpOrient provides you with a few different ways to define the particular Record ID that you want to load.</p>
<pre><code>// DEFINING RECORD ID AS STRING 
$client-&gt;recordLoad(new ID('&lt;record-id&gt;'))

// DEFINING CLUSTER AND POSITION AS ARGUMENTS
$client-&gt;recordLoad(new ID(&lt;cluster-id&gt;, &lt;record-position&gt;))

// DEFINING CLUSTER AND POSITION WITH ARRAY
$client-&gt;recordLoad(new ID(['cluster' =&gt; &lt;cluster-id&gt;, 
							'position' =&gt; &lt;record-position&gt;]))
</code></pre>
<ul>
<li><strong><code>&lt;record-id&gt;</code></strong> Defines the Record ID that you want to return.</li>
<li><strong><code>&lt;cluster-id&gt;</code></strong> Defines the Cluster ID to search.</li>
<li><strong><code>&lt;record-position&gt;</code></strong> Defines the record's position in the cluster.</li>
</ul>
<p>When successful, this method returns an array with a single entry. In order to access the record itself, you need to add a call to the 0 position at the end of the method, for instance:</p>
<pre><code class="language-php">$record = $client-&gt;recordLoad(new ID('#3:22'))[0]
</code></pre>
<h3 id="examples-48"><a class="header" href="#examples-48">Examples</a></h3>
<p>For instance, if you find yourself frequently loading records by Record ID, you might want to build a function that retrieves an array of record ID's.</p>
<pre><code class="language-php">// FETCH RECORDS
function fetchRecords($client, $ridArray){

	// LOG OPERATION
	echo "Retrieving Records";

	// INITIALIZE ARRAY
	$records = array();

	// LOOP OVER RID'S
	foreach($rid in $ridArray){

		// FETCH RECORD
		$record = $client-&gt;recordLoad(new ID($rid))[0];
		
		// APPEND ARRAY
		array_push($records, $record);
	}

	// RETURN RECORDS
	return $records;

}
</code></pre>
<h4 id="loading-records-with-callback-function"><a class="header" href="#loading-records-with-callback-function">Loading Records with Callback Function</a></h4>
<p>Similar to the <a href="php/PHP-queryAsync.html"><code>queryAsync()</code></a> method, you can define a <a href="php/../java/Fetching-Strategies.html">fetching strategy</a> and callback function.  You can manage these features by passing a mapped array as the second argument to the method.</p>
<p>For instance, during development you might want to call the <code>var_dump()</code> function for each record the method returns.</p>
<pre><code class="language-php">// DEFAULT DEBUG OPTION
$debug = True;

// QUERY DEBUG FUNCTION
function queryDebug(Record $record){

	// LOG OPERATION
	echo "Record Returned:";

	// DUMP RECORD INFORMATION
	global $debug;
	if ($debug) {
		
		// DUMP RECORD
		var_dump($record);
	}
}

// QUERY DATABASE
function queryDatabase($client, $rid, $fetchPlan){

	// LOG OPERATION
	echo "Loading Record: $rid";

	// LOAD RECORD
	$record = $client-&gt;recordLoad(
		new ID($rid), 
		['fetch_plan' =&gt; $fetchPlan,
		 '_callback' =&gt; $queryDebug]);

	// RETURN RECORD
	return $record;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---recordupdate"><a class="header" href="#phporient---recordupdate">PhpOrient - <code>recordUpdate()</code></a></h1>
<p>This method updates records on the database.</p>
<h2 id="updating-records-6"><a class="header" href="#updating-records-6">Updating Records</a></h2>
<p>Your applications users may occasionally want to make changes to the database.  Using this method you can update existing records on the database.  In the event that you attempt to update a record that does not exist, this method creates it for you.</p>
<h3 id="syntax-282"><a class="header" href="#syntax-282">Syntax</a></h3>
<pre><code>$client-&gt;recordUpdate(&lt;record&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;record&gt;</code></strong> Defines the record that you want to update, with relevant changes.  It is an instance of the <code>Record()</code> object.</li>
</ul>
<h3 id="example-128"><a class="header" href="#example-128">Example</a></h3>
<p>For instance, consider the example of a web application that hosts blogs for multiple users.  While these users may generally post new blogs to the database, they may on occasion prefer to edit existing ones.</p>
<pre><code class="language-php">// UPDATE OR CREATE RECORD 
function buildRecord($title, $text, $user){

	// LOG OPERATION
	echo "Posting Blog: $title, for $user";

	// BUILD RECORD CONTENT
	$recordContent = [
		"title":  $title,
		"author": $user,
		"text":   $text];

	// BUILD RECORD
	$record = (new Record() )-&gt;setOData($recordContent)-&gt;setOClass("Blog")-&gt;setRid(new ID(9));

	// FETCH GLOBAL CLIENT
	global $client;

	// UPDATE
	$client-&gt;recordUpdate($record);
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---sqlbatch"><a class="header" href="#phporient---sqlbatch">PhpOrient - <code>sqlBatch()</code></a></h1>
<p>This method issues <a href="php/../sql/SQL-batch.html"><code>BATCH</code></a> commands to the database.</p>
<h2 id="executing-batch-commands-1"><a class="header" href="#executing-batch-commands-1">Executing Batch Commands</a></h2>
<p>OrientDB supports the execution of arbitrary scripts written JavaScript with a minimal SQL engine for batch commands.  Using this method, you can execute batch commands through your PhpOrient application.</p>
<h3 id="syntax-283"><a class="header" href="#syntax-283">Syntax</a></h3>
<pre><code>$client-&gt;sqlBatch(&lt;batch&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;batch&gt;</code></strong> Defines a string containing the commands you want to execute.</li>
</ul>
<h3 id="example-129"><a class="header" href="#example-129">Example</a></h3>
<p>For instance, if you have a series of records that you want to create on the database, you might find it more convenient to manage them through batch commands in a function.</p>
<pre><code class="language-php">// BATCH CREATION
function batchCreate($records){

	// LOG OPERATION
	echo "Running Batch Command";

	// INITIALIZE BATCH COMMAND
	$batchCmd = "begin; "

	// LOOP THROUGH RECORDS
	foreach($records as $class =&gt; $data){

		// INITIALIZE RECORD CREATION
		$create = "insert into $class ";

		// LOOP OVER PROPERTIES
		foreach($data as $property =&gt; $value){
			
			// ADD SETTINGS
			$create = "$create set $property = '$value' ";
		}

		// ADD CREATE STATEMENT
		$batchCmd = "$batchCmd $create; ";

	}

	// ADD COMMIT LINE
	$batchCmd = "$batchCmd commit retry 100;";

	// FETCH GLOBAL CLIENT
	global $client;

	// EXECUTE BATCH COMMAND
	$client-&gt;sqlBatch($batchCmd);	
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---cluster-maps"><a class="header" href="#phporient---cluster-maps">PhpOrient - Cluster Maps</a></h1>
<p>When you open a database on the client interface, the return value is cluster map.  This PHP class provides you with an interface and a series of methods for manipulating clusters on the database.</p>
<h2 id="using-clusters"><a class="header" href="#using-clusters">Using Clusters</a></h2>
<p>In order to retrieve the cluster map for a database, you need to open the database and set the return value on a variable.  For instance,</p>
<pre><code class="language-php">$clusterMap = $client-&gt;dbOpen("GratefulDeadConcerts", "admin", "admin);
</code></pre>
<p>You can then use the <code>$clusterMap</code> object in calling additional methods.</p>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="php/PHP-ClusterMap.html#count"><strong><code>count()</code></strong></a></td><td>Returns a count of records in the cluster.</td></tr>
<tr><td><a href="php/PHP-ClusterMap-dropClusterID.html"><strong><code>dropClusterID()</code></strong></a></td><td>Removes a cluster from the database.</td></tr>
<tr><td><a href="php/PHP-ClusterMap-getIdList.html"><strong><code>getIdList()</code></strong></a></td><td>Retrieves a list of Cluster ID's.</td></tr>
</tbody></table>
</div>
<h3 id="count-1"><a class="header" href="#count-1"><code>count()</code></a></h3>
<p>In cases where you want to know how many records the Cluster Map contains, you can obtains this using the <code>count()</code> method.  For instance, you might want to test that a database contains records after opening it:</p>
<pre><code class="language-php">// Open Database
$clusterMap = $client-&gt;dbOpen("GratefulDeadConcerts", "admin", "admin);

// Report Count
$entityCount = $clusterMap-&gt;count();
echo "Database Contains: $entityCount records";
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---dropclusterid"><a class="header" href="#phporient---dropclusterid">PhpOrient - <code>dropClusterID()</code></a></h1>
<p>This method removes the given cluster from the database using its Cluster ID.</p>
<h2 id="removing-clusters-3"><a class="header" href="#removing-clusters-3">Removing Clusters</a></h2>
<p>In certain situations, you may find it useful to programmatically remove clusters from the database. For instance, in the case of a maintenance script that frees up space when the given cluster is no longer needed.  This method allows you to remove clusters by their Cluster ID, which is the first numeral in the Record ID.</p>
<h3 id="syntax-284"><a class="header" href="#syntax-284">Syntax</a></h3>
<pre><code>$clusterMap-&gt;dropClusterID(&lt;cluster-id&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;cluster-id&gt;</code></strong> Defines the Cluster ID you want to remove.</li>
</ul>
<h3 id="example-130"><a class="header" href="#example-130">Example</a></h3>
<p>Consider the example of a web application that uses multiple in-memory clusters for short-term needs.  For this purpose, you might want to create a function to quickly remove these clusters when you're finished using them.</p>
<pre><code class="language-php">// REMOVE CLUSTER
function removeCluster($clusterID){

	// Log Operation
	echo "Removing Cluster: $clusterID";

	// Fetch Global Cluster Map
	global $clusterMap;

	// Remove the Cluster
	$clusterMap-&gt;dropClusterID($clusterID);
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---getclusterid"><a class="header" href="#phporient---getclusterid">PhpOrient - <code>getClusterID()</code></a></h1>
<p>This method returns the Cluster ID for the given name.</p>
<h2 id="retrieving-cluster-ids-4"><a class="header" href="#retrieving-cluster-ids-4">Retrieving Cluster ID's</a></h2>
<p>In cases where you need or would like to operate on a cluster by its Cluster ID, you can retrieve it from the Cluster Map by passing the cluster name as an argument to this method.</p>
<h3 id="syntax-285"><a class="header" href="#syntax-285">Syntax</a></h3>
<pre><code>$clusterMap-&gt;getClusterID(&lt;cluster-name&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;cluster-name&gt;</code></strong> Defines the name of the cluster.</li>
</ul>
<h3 id="example-131"><a class="header" href="#example-131">Example</a></h3>
<p>For instance, say you want to retrieve records for clusters by cluster name, you might use this method in conjunction with <a href="php/PHP-dataClusterDataRange.html"><code>dataClusterDataRange()</code></a>.</p>
<pre><code class="language-php">// FETCH RECORDS
function fetchRecords($clusterName){

	// Log Operation
	echo "Retrieving Records on Cluster: $clusterName";

	// Fetch Globals
	global $client;
	global $clusterMap;

	// Find Cluster ID
	$clusterId = $clusterMap-&gt;getClusterID($clusterName);

	// Return Records
	return $client-&gt;dataClusterDataRange($clusterId);
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---etidlist"><a class="header" href="#phporient---etidlist">PhpOrient - <code>[etIdList()</code></a></h1>
<p>This method returns a list of Cluster ID's on the database.</p>
<h2 id="retrieving-cluster-ids-5"><a class="header" href="#retrieving-cluster-ids-5">Retrieving Cluster ID's</a></h2>
<p>Occasionally, you may want to work with a series of clusters in a given operation.  Using this method, you can retrieve a list of Cluster ID's available on the database.  You can then pass these ID's to other methods in performing further operations.</p>
<h3 id="syntax-286"><a class="header" href="#syntax-286">Syntax</a></h3>
<pre><code>$clusterMap-&gt;getIdList()
</code></pre>
<h3 id="example-132"><a class="header" href="#example-132">Example</a></h3>
<p>In cases where you find yourself making frequent calls to all clusters on the database, you may find it convenient to write a simple function to fetch it and log the operation for you.</p>
<pre><code class="language-php">// FETCH CLUSTER ID'S
function fetchClusterIDs(){

	// Fetch Global Cluster Map
	global $clusterMap;

	// Fetch ID's
	$idList = $clusterMap-&gt;getIdList();	
	$idCount = count($idList);

	// Log Operation
	echo "Retrieving $idCount Cluster ID's";

	// Return ID's
	return $idList;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---record"><a class="header" href="#phporient---record">PhpOrient - <code>Record()</code></a></h1>
<p>On occasion, you may want to operate a record or build one from scratch within your application, before adding it to or syncing it with OrientDB.  In PhpOrient, these operations are controlled by the <code>Record()</code> class.</p>
<h2 id="working-with-records-3"><a class="header" href="#working-with-records-3">Working with Records</a></h2>
<p>Record objects require no arguments to instantiate.  Once created, you can call various methods on the object to define its class, Record ID, data and so on.</p>
<pre><code class="language-php">$record = new Record()
   -&gt;setOClass('V')
   -&gt;setRid(new ID(0))
   -&gt;setOData(
      ['accommodation' =&gt; 'bungalow']);
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="php/PHP-Record-getOClass.html"><strong><code>getOClass()</code></strong></a></td><td>Retrieve the class name</td></tr>
<tr><td><a href="php/PHP-Record-getOData.html"><strong><code>getOData()</code></strong></a></td><td>Retrieves record data</td></tr>
<tr><td><a href="php/PHP-Record-getRid.html"><strong><code>getRid()</code></strong></a></td><td>Returns the Record ID</td></tr>
<tr><td><a href="php/PHP-Record-jsonSerialize.html"><strong><code>jsonSerialize()</code></strong></a></td><td>Returns record in serialized JSON format</td></tr>
<tr><td><a href="php/PHP-Record-recordSerialize.html"><strong><code>recordSerialize()</code></strong></a></td><td>Returns record in serialized format</td></tr>
<tr><td><a href="php/PHP-Record-setOClass.html"><strong><code>setOClass()</code></strong></a></td><td>Sets the class</td></tr>
<tr><td><a href="php/PHP-Record-setOData.html"><strong><code>setOData()</code></strong></a></td><td>Sets record data</td></tr>
<tr><td><a href="php/PHP-Record-setRid.html"><strong><code>setRid()</code></strong></a></td><td>Sets the Record ID</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---getoclass"><a class="header" href="#phporient---getoclass">PhpOrient - <code>getOClass()</code></a></h1>
<p>This method retrieves the OrientDB class for the record.</p>
<h2 id="retrieving-classes-3"><a class="header" href="#retrieving-classes-3">Retrieving Classes</a></h2>
<p>In cases where you want to access the class for the given <code>Record()</code> instance, this method returns the class name.  You might find it useful in cases such as logging operations, where you would like to report the specific class rather than its Record ID.</p>
<h3 id="syntax-287"><a class="header" href="#syntax-287">Syntax</a></h3>
<pre><code>$record-&gt;getOClass()
</code></pre>
<h3 id="example-133"><a class="header" href="#example-133">Example</a></h3>
<p>Consider the use-case of a logging operation tied to the callback function for an asynchronous query.  For each record the query returns, it calls a function that logs the class that it's operating on.</p>
<pre><code class="language-php">// CALLBACK FUNCTION
function logReturn(Record $record){
	// Fetch Record ID
	$rid = $record-&gt;getRid()-&gt;_toString();

	// Fetch Class
	$class = $record-getOClass();

	// Log Operation
	echo "Retrieving $class Record: $rid";
}

// ASYNCHRONOUS QUERY
function runQuery($sql, $fetchPlan){

	// Fetch Global
	global $client;

	// Run Query
	$results = $client-&gt;queryAsync($sql,
		['fetch_plan' =&gt; $fetchPlan,
		'_callback' =&gt; logReturn]);

	// Return Results
	return $results;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---getodata"><a class="header" href="#phporient---getodata">PhpOrient - <code>getOData()</code></a></h1>
<p>This method retrieves data from the record.</p>
<h2 id="retrieving-data"><a class="header" href="#retrieving-data">Retrieving Data</a></h2>
<p>In cases where you want to operate on record data, this method allows you to retrieve the data from the <code>Record()</code> instance.  It returns a mapped array of properties and values on the record.</p>
<h3 id="syntax-288"><a class="header" href="#syntax-288">Syntax</a></h3>
<pre><code>$record-&gt;getOData()
</code></pre>
<h3 id="example-134"><a class="header" href="#example-134">Example</a></h3>
<p>Consider the use case of a web application that serves blogs.  You might want to create a blog roll, which displays data on the most recent posts.  You might want to create a function that standardizes the data retrieval process.</p>
<pre><code class="language-php">function blogRoll($limit){

	// Log Operation
	echo "Retrieving Blog Entries";

	// Retrieve Blogs
	$blogs = $client-&gt;query("SELECT FROM BlogEntry LIMIT $limit");

	$div = '&lt;div id="blog-roll"&gt;&lt;h3&gt;Latest Posts&lt;/h3&gt;&lt;ul&gt;'

	foreach($blogs as $record){

		// Fetch Data
		$data = $record-&gt;getOData();
		$title = $data['title'];
		$link = $data['link'];

		$div = '$div &lt;li&gt;&lt;a src="$link"&gt;$title&lt;/a&gt;&lt;/li&gt;';
	}
	$div = '$div&lt;/div&gt;';

	// Return Blog Roll
	return $div;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---getrid"><a class="header" href="#phporient---getrid">PhpOrient - <code>getRid()</code></a></h1>
<p>This method returns the Record ID of the given Record object.</p>
<h2 id="retrieving-record-ids"><a class="header" href="#retrieving-record-ids">Retrieving Record ID's</a></h2>
<p>In cases where you want to access the Record ID of a given <a href="php/PHP-Record.html"><code>Record()</code></a> object, this method allows you to retrieve the <a href="php/PHP-ID.html"><code>ID()</code></a> instance from the record.  You can then use this to call additional methods on the Record ID in further operations.</p>
<h3 id="syntax-289"><a class="header" href="#syntax-289">Syntax</a></h3>
<pre><code>$record-&gt;getRid()
</code></pre>
<h3 id="example-135"><a class="header" href="#example-135">Example</a></h3>
<p>Consider the use-case of a logging operation tied to an asynchronous query.  As the query runs, each record triggers a callback function.  Using this method, you can fetch the Record ID of each record to echo to the console.</p>
<pre><code class="language-php">// CALLBACK FUNCTION
function logReturn(Record $record) {

	// Fetch Record ID
	$id = $record-&gt;getRid();
	$rid = $id-&gt;_toString();

	// Log Operation
	echo 'Retrieved Record: $rid';
}

// ASYNCHRONOUS QUERY
function runQuery($sql, $fetchPlan){

	// Fetch Global
	global $client;

	// Run Query
	$results = $client-&gt;queryAsync($sql,
		['fetch_plan' =&gt; $fetchPlan,
		'_callback' =&gt; logReturn]);

	// Return Results
	return $results;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---jsonserialize"><a class="header" href="#phporient---jsonserialize">PhpOrient - <code>jsonSerialize()</code></a></h1>
<p>This method returns the record serialized in JSON format.</p>
<h2 id="serializing-records"><a class="header" href="#serializing-records">Serializing Records</a></h2>
<p>In some cases, you may find it more convenient to operate on a record in JSON format rather than the standard format provided by PhpOrient.  Alternatively, you may want to save JSON instances of records for backup or logging purposes.  This method takes no arguments and returns a JSON instance of the record.  It is similar to the <a href="php/PHP-Record-recordSerialize.html"><code>recordSerialize()</code></a> method.</p>
<h3 id="syntax-290"><a class="header" href="#syntax-290">Syntax</a></h3>
<pre><code>$record-&gt;jsonSerialize()
</code></pre>
<h3 id="example-136"><a class="header" href="#example-136">Example</a></h3>
<p>For instance, you might want to use this method as part of a logging operation, echoing a JSON instance of the record to the console on asynchronous queries.</p>
<pre><code class="language-php">// LOG QUERY
function logQuery(Record $record){

	// Fetch JSON
	$json = $record-&gt;jsonSerialize();

	// Log to Console
	echo "$json";
}

// ASYNC QUERY
function query($sql, $fetchPlan){

	// Query Database
	global $client;
	$results = $client-&gt;queryAsync($sql,
		['fetch_plan' =&gt; $fetchPlan,
		'_callback' =&gt; logQuery ]);

	// Return Results
	return $results;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---recordserialize"><a class="header" href="#phporient---recordserialize">PhpOrient - <code>recordSerialize()</code></a></h1>
<p>This method returns a serialized instance of the given record.</p>
<h2 id="serializing-records-1"><a class="header" href="#serializing-records-1">Serializing Records</a></h2>
<p>In cases where you want to pass the record instance to another application or would otherwise like to serialize the data, you can do so using this method.  It takes no arguments and returns a serialized instance of the record.  It is similar to the <a href="php/PHP-Record-jsonSerialize.html"><code>jsonSerialize()</code></a> method, which serializes the record into JSON data.</p>
<h3 id="syntax-291"><a class="header" href="#syntax-291">Syntax</a></h3>
<pre><code>$record-&gt;recordSerialize()
</code></pre>
<h3 id="example-137"><a class="header" href="#example-137">Example</a></h3>
<pre><code class="language-php">// FETCH SERIAL RECORD
function serialData(Record $record){

	// Fetch Serial Record
	$serial = $record-&gt;recordSerialize();
	echo "$serial";
}

// QUERY RECORDS 
function serialRecordsQuery($sql, $fetchplan){

	// Query
	global $client;
	$results = $client-&gt;queryAsync($sql,
		['fetch_plan' =&gt; $fetchPlan,
		'_callback' =&gt; serialData]

	// Return Results
	return $results;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---setoclass"><a class="header" href="#phporient---setoclass">PhpOrient - <code>setOClass()</code></a></h1>
<p>This method sets the class on the <a href="php/PHP-Record.html"><code>Record()</code></a> object.</p>
<h2 id="setting-classes"><a class="header" href="#setting-classes">Setting Classes</a></h2>
<p>When building records within your application this method allows you to define the class to which the record belongs in OrientDB.</p>
<h3 id="syntax-292"><a class="header" href="#syntax-292">Syntax</a></h3>
<pre><code>$record-&gt;setOClass(&lt;class&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;class&gt;</code></strong> Defines the class name.</li>
</ul>
<h3 id="example-138"><a class="header" href="#example-138">Example</a></h3>
<p>For instance, when creating a new <a href="php/PHP-Record.html"><code>Record()</code></a> instance within your application, use this method to set the class.</p>
<pre><code class="language-php">function addEntry($data){

	// Log Operation
	echo "Creating Record";

	// Build Record
	$record = new Record()
		-&gt;setOData($data)
		-&gt;setRid(
			new ID(5))
		-&gt;setOClass("entry");

	// Create Record
	global $client;
	$client-&gt;recordCreate($record);
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---setodata"><a class="header" href="#phporient---setodata">PhpOrient - <code>setOData()</code></a></h1>
<p>This method sets data on a <a href="php/PHP-Record.html"><code>Record()</code></a> object.</p>
<h2 id="setting-data"><a class="header" href="#setting-data">Setting Data</a></h2>
<p>When building a record in your application to create or update on your database, this method is used to set the data object.</p>
<h3 id="syntax-293"><a class="header" href="#syntax-293">Syntax</a></h3>
<pre><code>$record-&gt;setOData(&lt;data&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;data&gt;</code></strong> Defines an array of the data you want to set on the record.</li>
</ul>
<h3 id="example-139"><a class="header" href="#example-139">Example</a></h3>
<p>In cases where you create records on a particular cluster or class frequently, you might find it convenient to hard core the feature into an creation function, requiring you to only set the specific data going into the record.</p>
<pre><code class="language-php">// CREATE RECORD
function addBlog($data){

	// Log Operation
	echo "Creating New Blog Entry";

	// Fetch Global Client
	global $client;

	// Build Record
	$record = new Record()
		-&gt;setOData($data)
		-&gt;setRid(
			new ID(5))
		-&gt;setOClass("BlogEntry");

	// Create Record
	%client-&gt;recordCreate($record);
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---setrid"><a class="header" href="#phporient---setrid">PhpOrient - <code>setRid()</code></a></h1>
<p>This method sets the Record ID for the <a href="php/PHP-Record.html"><code>Record()</code></a> object.</p>
<h2 id="setting-record-ids"><a class="header" href="#setting-record-ids">Setting Record ID's</a></h2>
<p>When instantiating a <a href="php/PHP-Record.html"><code>Record()</code></a> object in your application, you may need to set the specific Record ID on the object before syncing it with OrientDB.  You can also partially define the record, by setting the Cluster ID for the cluster you want to create it in.  Once the <a href="php/PHP-ID.html"><code>ID()</code></a> instance is ready, you can pass it to this method to set the Record ID on the object.</p>
<h3 id="syntax-294"><a class="header" href="#syntax-294">Syntax</a></h3>
<pre><code>$record-&gt;setRid(&lt;id&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;id&gt;</code></strong> Defines the Record ID you want to set on the record.  It is an instance of <a href="php/PHP-ID.html"><code>ID()</code></a>.</li>
</ul>
<h3 id="example-140"><a class="header" href="#example-140">Example</a></h3>
<p>When creating new records in your application, you can use this method to define the Record ID or the Cluster ID for the new record before syncing it with the database.  In cases where you do this often, you may want to use a dedicated function to ensure consistency with common values.</p>
<pre><code class="language-php">function addEntry($data){

	// Log Operation
	echo "Creating Record";

	// Build Record
	$record = new Record()
		-&gt;setOData($data)
		-&gt;setRid(
			new ID(5))
		-&gt;setOClass("BlogEntry");

	// Create Record
	global $client;
	$client-&gt;recordCreate($record);
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---id"><a class="header" href="#phporient---id">PhpOrient - <code>ID()</code></a></h1>
<p>This object provides an interface for operating on Record and Cluster ID's from within your PHP application.</p>
<h2 id="working-with-ids"><a class="header" href="#working-with-ids">Working with ID's</a></h2>
<p>Certain methods and objects in PhpOrient take Record or Cluster ID's as an argument.  In cases where you need to operate on these, use the <code>ID()</code> interface to generate the instance.  It also provides methods for constructing and abstracting the ID from the interface.</p>
<h3 id="creating-ids"><a class="header" href="#creating-ids">Creating ID's</a></h3>
<p>When creating a new instance of the <code>ID()</code> interface, there are a two approaches available to you: You can define the Cluster ID and Record ID using integers as arguments, or you can initialize the class without arguments as use the <code>parseString()</code> method to set the ID values from string.  For instance,</p>
<pre><code class="language-php">// CREATE RID FROM INTEGERS 
$clusterID = 5;
$recordID = 3
$rid = new ID($clusterID, $recordID);

// CREATE ID FROM STRING
$stringID = "#5:3";
$rid = new ID().parseString($stringID); 
</code></pre>
<h4 id="using-cluster-id"><a class="header" href="#using-cluster-id">Using Cluster ID</a></h4>
<p>In addition to these approaches, you can also partially instantiate an ID by only providing it with a Cluster ID.  For instance,</p>
<pre><code class="language-php">$rid = new ID(5);
</code></pre>
<p>When you instantiate the <code>ID()</code> using this technique, it records the cluster you want to add the record to, but waits until you create the record on OrientDB before it sets the Record ID.  In cases where you're working with multiple client connections, such as in a web application, this can help to avoid conflicts where two clients attempt to create a record with the same Record ID.</p>
<h3 id="retrieving-record-id"><a class="header" href="#retrieving-record-id">Retrieving Record ID</a></h3>
<p>In cases where you want to extract the Record ID from a given <code>ID()</code> instance, for logging or other purposes, you can do so using the <code>__toString()</code> method.</p>
<pre><code class="language-php">// CREATE RECORD ID
$id = new ID(5, 3);

// FETCH RECORD ID
$rid = $id-&gt;__toString();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---transactions"><a class="header" href="#phporient---transactions">PhpOrient - Transactions</a></h1>
<p>OrientDB supports transactions, allowing you to organize database operations into units of work that you can then commit or roll back as need.  You may find this useful in cases where you want to provide reliable units of work to allow correct recovery from failures and keep the database consistent or you would like to provide isolation between clients accessing the database concurrently, such as in the case of a web application.</p>
<h2 id="using-transactions-1"><a class="header" href="#using-transactions-1">Using Transactions</a></h2>
<p>Transactions are managed through a transaction interface.  You can initialize this interface using the <code>getTransactionStatement()</code> method on the client interface.  For instance,</p>
<pre><code class="language-php">// Fetch Transaction Interface
$tx = $client-&gt;getTransactionStatement();
</code></pre>
<p>Once you have this interface initialized, there are a series of methods you can call to begin transactions, attach database operations to the transaction, then commit the changes to the database or roll the changes back to the earlier database state.</p>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="php/PHP-Tx-attach.html"><code>attach()</code></a></td><td>Attach an operation to the transaction</td></tr>
<tr><td><a href="php/PHP-Tx-begin.html"><code>begin()</code></a></td><td>Begin a transaction</td></tr>
<tr><td><a href="php/PHP-Tx-commit.html"><code>commit()</code></a></td><td>Commit the transaction</td></tr>
<tr><td><a href="php/PHP-Tx-rollback.html"><code>rollback()</code></a></td><td>Roll the transaction back</td></tr>
</tbody></table>
</div>
<p>Consider the example of a web application.  You might want a dedicated function to handle common operations like updating records in the database.  Using a global transaction interface, you can begin and commit transactions within the function.</p>
<pre><code class="language-php">// INITIALIZE TRANSACTION INTERFACE
$tx = $client-&gt;getTransactionStatement();

// UPDATE RECORD
function updateRecord($class, $data, $rid){

	// Log Operation
	echo "Updating Record";

	// Fetch Globals
	global $client;
	global $tx;

	// Begin Transaction
	$tx = $tx-&gt;begin();

	// Build Updated Record
	$record = new Record();
	$record-&gt;setOClass($class);
	$record-&gt;setOData($data);
	$record-&gt;setRid($rid);

	// Update Database
	$update = $client-&gt;recordUpdate($record);

	// Attach Operation to Transaction
	$tx-&gt;attach($update);

	// Commit Changes
	return $tx-&gt;commit();
}
</code></pre>
<blockquote>
<p>For more information, see <a href="php/../internals/Transactions.html">Transactions</a>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---attach"><a class="header" href="#phporient---attach">PhpOrient - <code>attach()</code></a></h1>
<p>This method attaches the given database operation to a transaction.</p>
<h2 id="attaching-operations-1"><a class="header" href="#attaching-operations-1">Attaching Operations</a></h2>
<p>In building transactions, you can attach specific operations to the given transaction.  This allows you to later commit the transactions to the database or roll the changes back to an earlier state.</p>
<h3 id="syntax-295"><a class="header" href="#syntax-295">Syntax</a></h3>
<pre><code>$tx-&gt;attach(&lt;operation&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;operation&gt;</code></strong> Defines the operation to attach.</li>
</ul>
<h3 id="example-141"><a class="header" href="#example-141">Example</a></h3>
<p>For instance, imagine a web application that handles blog entries.  With multiple users connecting to the application and attempting to update the database.  Using transactions, you can isolate the changes they make to the database to help avoid conflicts.</p>
<pre><code class="language-php">// CREATE RECORDS
function createRecord($class, $records){

	// Log Operation
	echo "Creating Record";

	// Fetch Global Variables
	global $client;
	global $tx;

	// Begin Transaction
	$tx = $tx-&gt;begin()

	// Loop Over Record Data
	foreach($records as $record){

		// Create Record
		$createdRecord = $client-&gt;recordCreate(
			(new Record())
				-&gt;setOClass($class)
				-&gt;setOData($data)
				-&gt;setRid(new ID())
		);	

		// Attach Operation to Transaction
		$tx-&gt;attach($createdRecord);
	}

	// Commit Changes
	$tx-&gt;commit();
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---begin"><a class="header" href="#phporient---begin">PhpOrient - <code>begin()</code></a></h1>
<p>This method begins a transaction.</p>
<h2 id="beginning-transactions-7"><a class="header" href="#beginning-transactions-7">Beginning Transactions</a></h2>
<p>Once you have the transaction interface initialized through the <code>getTransactionStatement()</code> client interface method, using this method you can initialize a transaction statement, using the other methods to attach and commit or revert the changes as need.</p>
<h3 id="syntax-296"><a class="header" href="#syntax-296">Syntax</a></h3>
<pre><code>$tx = $tx-&gt;begin()
</code></pre>
<h3 id="example-142"><a class="header" href="#example-142">Example</a></h3>
<p>Consider the use-case of a web application in which you frequently update records as part of a transaction.  You might use a function similar to this to handle both the transaction and update operations together.</p>
<pre><code class="language-php">// INITIALIZE TRANSACTION INTERFACE
$tx = $client-&gt;getTransactionStatement();

// UPDATE RECORD
function updateRecord($class, $data, $rid){

	// Log Operation
	echo "Updating Record";

	// Fetch Globals
	global $client;
	global $tx;

	// Begin Transaction
	$tx = $tx-&gt;begin();

	// Build Updated Record
	$record = new Record();
	$record-&gt;setOClass($class);
	$record-&gt;setOData($data);
	$record-&gt;setRid($rid);

	// Update Database
	$update = $client-&gt;recordUpdate($record);

	// Attach Operation to Transaction
	$tx-&gt;attach($update);

	// Commit Changes
	return $tx-&gt;commit();
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---commit"><a class="header" href="#phporient---commit">PhpOrient - <code>commit()</code></a></h1>
<p>This method commits operations attached to the transaction to the database.</p>
<h2 id="committing-transaction"><a class="header" href="#committing-transaction">Committing Transaction</a></h2>
<p>When you're finished with a transaction and satisfied with the changes you've made to it, you need to commit the changes to the database to make them persistent.  This method commits all attached operations.</p>
<h3 id="syntax-297"><a class="header" href="#syntax-297">Syntax</a></h3>
<pre><code>$tx-&gt;commit()
</code></pre>
<h3 id="example-143"><a class="header" href="#example-143">Example</a></h3>
<p>In the event that you work with transactions often, you might want to put together a routine function to handle commit and rollback operations.</p>
<pre><code class="language-php">// TX HANDLER
function transactionOp($testResult){

	// Fetch Globals
	global $tx;

	if($testResult){

		// Log Operation
		echo "Committing Transaction";

		// Commit
		$tx-&gt;commit();
	} else {

		// Log Operation
		echo "Rolling Back Transaction";
		$tx-&gt;rollback();
	}

}
</code></pre>
<p>Whenever you're finished with a transaction test it with a boolean operation, then pass the results to this function.  If the test passed, the if statement within this function commits the transaction.  If it failed, it rolls the database back the attached operations.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="phporient---rollback"><a class="header" href="#phporient---rollback">PhpOrient - <code>rollback()</code></a></h1>
<p>This method reverts changes made on the current transaction.</p>
<h2 id="rolling-back-transactions-1"><a class="header" href="#rolling-back-transactions-1">Rolling Back Transactions</a></h2>
<p>In certain situations you may encounter an issue where you need to revert a series of changes already made to the database.  When working with transactions, you can manage this by rolling the database back to its state when the transaction was begun.</p>
<h3 id="syntax-298"><a class="header" href="#syntax-298">Syntax</a></h3>
<pre><code>$tx-&gt;rollback()
</code></pre>
<h3 id="example-144"><a class="header" href="#example-144">Example</a></h3>
<p>In the event that you work with transactions often, you might want to put together a routine function to handle commit and rollback operations.</p>
<pre><code class="language-php">// TX HANDLER
function transactionOp($testResult){

	// Fetch Globals
	global $tx;

	if($testResult){

		// Log Operation
		echo "Committing Transaction";

		// Commit
		$tx-&gt;commit();
	} else {

		// Log Operation
		echo "Rolling Back Transaction";
		$tx-&gt;rollback();
	}

}
</code></pre>
<p>Whenever you're finished with a transaction test it with a boolean operation, then pass the results to this function.  If the test passed, the if statement within this function commits the transaction.  If it failed, it rolls the database back the attached operations.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="marcopolo-elixir-with-orientdb"><a class="header" href="#marcopolo-elixir-with-orientdb">MarcoPolo: Elixir with OrientDB</a></h1>
<p>OrientDB supports a number of application programming interfaces, natively through the JVM and externally through Java wrappers and the Binary Protocol.  In the event that you need or would prefer to develop your OrientDB application Erlang VM language Elixir, you can do so through the driver <a href="https://github.com/MyMedsAndMe/marco_polo">MarcoPolo</a>.</p>
<blockquote>
<p>For more information on the MarcoPolo Elixir driver, see the <a href="http://hexdocs.pm/marco_polo">project documentation</a>.</p>
</blockquote>
<h2 id="getting-marcopolo"><a class="header" href="#getting-marcopolo">Getting MarcoPolo</a></h2>
<p>In order to use MarcoPolo in your Elixir application, you first need to register it as a dependency for the Mix build tool.  To do so, edit the <code>mix.exs</code> file in the project root directory and add MarcoPolo as a dependency to the <code>deps</code> function.</p>
<pre><code class="language-elixir"># Project Dependencies
def deps do
	[{:marco_polo, "~&gt; 0.1"}]
end
</code></pre>
<p>With this line added, Mix now knows that your application requires MarcoPolo.  To retrieve and compile the package, use Mix:</p>
<pre>
$ <code class="userinput lang-sh">mix deps.get</code>
$ <code class="userinput lang-sh">mix deps.compile</code>
</pre>
<p>When you run the <code>deps.get</code> command, Mix calls the <a href="https://hex.pm">Hex</a> package manager to fetch the MarcoPolo package and its dependencies.  The second command then compiles these packages for use with your application.  You can see that the dependencies were installed without error by calling Mix again with the <code>deps</code> argument:</p>
<pre>
$ <code class="userinput lang-sh">mix deps</code>
...
* marco_polo 0.2.2 (Hex package) (mix)
  locked at 0.2.2 (marco_polo) 40x47150
  ok
</pre>
<h2 id="using-marcopolo"><a class="header" href="#using-marcopolo">Using MarcoPolo</a></h2>
<p>Once you have registered MarcoPolo as a dependency with Mix you can begin to use it in developing your Elixir application.</p>
<pre><code class="language-elixir">@doc """ Connects to OrientDB Server """
def connect_orientdb_server(user, passwd) do 
	{:ok, conn} = MarcoPolo.start_link(
		user: user, password: passwd, connection: :server)
end
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="marcopolo---server-operations"><a class="header" href="#marcopolo---server-operations">MarcoPolo - Server Operations</a></h1>
<p>OrientDB differentiates between connections made to the database and connections made to the server.  While you can get both from the <code>start_link()</code> function in MarcoPolo, which you choose determines the kinds of operations you can perform.  Server operations including creating and dropping databases, and checking that they exist.</p>
<h2 id="connecting-to-the-server-1"><a class="header" href="#connecting-to-the-server-1">Connecting to the Server</a></h2>
<p>In order to operate on the server, you first need to connect to it.  To manage this, call the <code>start_link()</code> function, then pass <code>:server</code> to the <code>connection</code> parameter.  For instance.</p>
<pre><code class="language-elixir">@doc """ Connect to OrientDB Server """
def orientdb_server(user, passwd) ::
	{:ok, conn } = MarcoPolo.start_link(
		user: user, password: passwd, connection: :server)
end
</code></pre>
<h2 id="using-server-connections"><a class="header" href="#using-server-connections">Using Server Connections</a></h2>
<p>When you call the <code>start_live()</code> function, it returns a connection interface to your application, which by convention is called <code>conn</code> here.  With the connection interface initialized to your OrientDB Server, there are a number of operations that become available by passing the <code>conn</code> value to MarcoPolo functions.</p>
<pre><code class="language-elixir">@doc """ Check if Database Exists, Create it if it does not """
def create_db(conn, dbname, type) when type in [:plocal, :memory] do

	# Check Database Existence
	unless MarcoPolo.db_exists?(conn, dbname, type) do

		# Log Operation
		IO.puts("Creating Database: #{dbname}")
		
		# Create Database
		MarcoPolo.db_create(conn, dbname, :document, type)

	end
end 
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Function</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="marcopolo/MarcoPolo-create-db.html"><code>create_db()</code></a></td><td>Creates a database.</td></tr>
<tr><td><a href="marcopolo/MarcoPolo-db-exists.html"><code>db_exists?()</code></a></td><td>Determines if database exists.</td></tr>
<tr><td><a href="marcopolo/MarcoPolo-distrib-config.html"><code>distrib_config()</code></a></td><td>Fetches distributed server configuration.</td></tr>
<tr><td><a href="marcopolo/MarcoPolo-drop-db.html"><code>drop_db()</code></a></td><td>Removes a database.</td></tr>
<tr><td><a href="marcopolo/MarcoPolo-Server.html#closing-connections"><code>stop()</code></a></td><td>Closes the server connection.</td></tr>
</tbody></table>
</div>
<h3 id="closing-connections-1"><a class="header" href="#closing-connections-1">Closing Connections</a></h3>
<p>When you are finished with a connection, whether the connection interface was opened on a database or a server, you can close the connection and free up resources by calling the <code>stop()</code> function.</p>
<p>For instance, consider the use case of a web application that operates on several databases on an OrientDB server.  You might want a function to loop over a series of database names, determining whether or not they exist and creating them where they don't, then close the connection once this operation is complete.</p>
<pre><code class="language-elixir">@doc """ Takes connection and list of databases and creates those that don't exist. """
def create_databases(user, passwd, databases) do

	# Open Connection
	IO.puts("Connecting to OrientDB Server")
	{:ok, conn} = MarcoPolo.start_link(
		user: user,
		password: passwd,
		connect: :server)

	# Loop Over Databases
	for db &lt;- databases do

		# Check Existence
		IO.puts("Database Test: #{db}")
		unless MarcoPolo.exists(conn, db, :graph, :plocal) do

			# Create Database
			IO.puts("Database #{db} not found, creating...")
			MarcoPolo.create_db(conn, db, :graph, :plocal)

		end
	end

	# Close Connection
	IO.puts("Closing Server Connection")
	MarcoPolo.stop(conn)

end
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="marcopolo---create_db"><a class="header" href="#marcopolo---create_db">MarcoPolo - <code>create_db()</code></a></h1>
<p>This function creates a database on the connected OrientDB Server.</p>
<h2 id="creating-databases-6"><a class="header" href="#creating-databases-6">Creating Databases</a></h2>
<p>While it is possible to connect your Elixir application to an existing database on the OrientDB Server, it is more likely that you'll want to create databases dynamically from within your application.  The <code>create_db()</code> takes the connection interface, database name and database options, then creates a database on the Server.  In the event that there is a problem it returns an error message.</p>
<h3 id="syntax-299"><a class="header" href="#syntax-299">Syntax</a></h3>
<pre><code>create_db(&lt;conn&gt;, &lt;name&gt;, &lt;database-type&gt;, &lt;storage type&gt;, &lt;opts&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;conn&gt;</code></strong> Provides the server connection.</li>
<li><strong><code>&lt;name&gt;</code></strong> Defines the database name.</li>
<li><strong><code>&lt;database-type&gt;</code></strong> Defines the database-type.  Supported types are,
<ul>
<li><em><code>:document</code></em> Creates a Document database.</li>
<li><em><code>:graph</code></em> Creates a Graph database.</li>
</ul>
</li>
<li><strong><code>&lt;storage type&gt;</code></strong> Defines the storage-type.  Supported types are,
<ul>
<li><em><code>:plocal</code></em> Sets to the PLocal storage-type.</li>
<li><em><code>:memory</code></em> Sets to the in-memory storage-type.</li>
</ul>
</li>
<li><strong><code>&lt;opts&gt;</code></strong> Used for any additional keyword options passed to the function.</li>
</ul>
<h4 id="options"><a class="header" href="#options">Options</a></h4>
<p>This function supports one additional option:</p>
<ul>
<li><strong><code>:timeout</code></strong> Defines the timeout value in milliseconds.  In the event that the operation takes longer than the allotted time, MarcoPolo sends an exit signal to the calling process.</li>
</ul>
<h4 id="return-values-1"><a class="header" href="#return-values-1">Return Values</a></h4>
<p>When the function is successful, it returns <code>:ok</code>.  In the event that there is a problem, it returns <code>{:error, term}</code>, where <code>term</code> is the error message.</p>
<h3 id="example-145"><a class="header" href="#example-145">Example</a></h3>
<p>For instance, you might want a function that integrates the <code>create_db()</code> function with the <a href="marcopolo/MarcoPolo-db-exists.html"><code>db_exists?()</code></a> function.  This would allow you to create a new database only in cases where one of the same name and type does not already exist.</p>
<pre><code class="language-elixir">@doc """ Check if Database Exists, Create it if it does not """
def create_db(conn, dbname, type) when type in [:plocal, :memory] do

	# Check Database Existence
	unless MarcoPolo.db_exists?(conn, dbname, type) do

		# Log Operation
		IO.puts("Creating Database: #{dbname}")
		
		# Create Database
		MarcoPolo.db_create(conn, dbname, :document, type)

	end
end 
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="marcopolo---db_exists"><a class="header" href="#marcopolo---db_exists">MarcoPolo - <code>db_exists?()</code></a></h1>
<p>This function retunrs a boolean value indicating whether the given database exists on the server.</p>
<h2 id="checking-database-existence-1"><a class="header" href="#checking-database-existence-1">Checking Database Existence</a></h2>
<p>Occasionally, you may encounter issues where you aren't certain whether a particular database exists on a server.  This might come up in distributed deployments or similar situations where you have many OrientDB Servers running in different data centers used for various purposes.  This function checks with OrientDB to confirm whether the given database exists on the server.</p>
<h3 id="syntax-300"><a class="header" href="#syntax-300">Syntax</a></h3>
<pre><code>db_exists?(&lt;conn&gt;, &lt;database&gt;, &lt;storage-type&gt;, &lt;opts&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;conn&gt;</code></strong> Defines the server connection.</li>
<li><strong><code>&lt;database&gt;</code></strong> Defines the database name.</li>
<li><strong><code>&lt;storage-type&gt;</code></strong> Defines the storage type.  There are two storage types supported:
<ul>
<li><em><code>:plocal</code></em> Sets the storage-type to PLocal storage.</li>
<li><em><code>:memory</code></em> Sets the storage-type to in-memory storage.</li>
</ul>
</li>
<li><strong><code>&lt;opts&gt;</code></strong> Defines additional options to pass to the function.  For more information on available options, see the <a href="marcopolo/MarcoPolo-db-exists.html#options">Options</a> section below.</li>
</ul>
<h4 id="options-1"><a class="header" href="#options-1">Options</a></h4>
<p>This function supports one additional option:</p>
<ul>
<li><strong><code>:timeout</code></strong> Defines the timeout value in milliseconds.  In the event that the operation takes longer than the allotted time, MarcoPolo sends an exit signal to the calling process.</li>
</ul>
<h4 id="return-value-154"><a class="header" href="#return-value-154">Return Value</a></h4>
<p>When the operation is successful, the function returns the tuple <code>{:ok, exists}</code>, where the variable is a boolean value indicating whether or not the database exists on the server.  In the event that the operation fails, the it returns the tuple <code>{:error, message}</code>, where the variable provides the exception message.</p>
<h3 id="example-146"><a class="header" href="#example-146">Example</a></h3>
<p>For instance, you might want a functin that integrates the <a href="marcopolo/MarcoPolo-create-db.html"><code>create_db()</code></a> function with <code>db_exists?()</code> function.  This would allow you to create a new database only in cases where one of the same name and type does not already exist.</p>
<pre><code class="language-elixir">@doc """ Check if Database Exists, Create it if it does not """
def create_db(conn, dbname, type) when type in [:plocal, :memory] do

	# Check Database Existence
	unless MarcoPolo.db_exists?(conn, dbname, type) do

		# Log Operation
		IO.puts("Creating Database: #{dbname}")
		
		# Create Database
		MarcoPolo.db_create(conn, dbname, :document, type)

	end
end 
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="marcopolo---distrib_config"><a class="header" href="#marcopolo---distrib_config">MarcoPolo - <code>distrib_config()</code></a></h1>
<p>This function returns the distributed configuration of the OrientDB Server.</p>
<h2 id="working-with-distributed-deployments"><a class="header" href="#working-with-distributed-deployments">Working with Distributed Deployments</a></h2>
<p>In deployments where high availability is a concern, OrientDB can run distributed across several servers, allowing you to achieve the maximum in performance, scalability and robustness possible.</p>
<p>When using this deployment architecture, the OrientDB Server pushes data to clients whenever changes occur in the distributed configuration.  In the event that you would like to review or operate on this configuration from within your Elixir application, this function allows you to retrieve it as a <a href="marcopolo/MarcoPolo-Document.html"><code>Document</code></a> instance.</p>
<blockquote>
<p>For more information on managing these deployments, see <a href="marcopolo/../distributed/Distributed-Architecture.html">Distributed Architecture</a>.</p>
</blockquote>
<h3 id="syntax-301"><a class="header" href="#syntax-301">Syntax</a></h3>
<pre><code>distrib_config(&lt;conn&gt;, &lt;opts&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;conn&gt;</code></strong> Defines the database connection.</li>
<li><strong><code>&lt;opts&gt;</code></strong> Defines any additional options you would like to pass to the function.  For more information on the available options, see the <a href="marcopolo/MarcoPolo-distrib-config.html#options">Options</a> section below.</li>
</ul>
<h4 id="options-2"><a class="header" href="#options-2">Options</a></h4>
<p>This function supports one additional option:</p>
<ul>
<li><strong><code>:timeout</code></strong> Defines the timeout value in milliseconds.  In the event that the operation takes longer than the allotted time, MarcoPolo sends an exit signal to the calling process.</li>
</ul>
<h4 id="return-values-2"><a class="header" href="#return-values-2">Return Values</a></h4>
<p>This operation returns a <a href="marcopolo/MarcoPolo-Document.html">Document</a> instance containing the current state of the distributed configuration.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="marcopolo---drop_db"><a class="header" href="#marcopolo---drop_db">MarcoPolo - <code>drop_db()</code></a></h1>
<p>This function removes the given database from the server.</p>
<h2 id="removing-databases-1"><a class="header" href="#removing-databases-1">Removing Databases</a></h2>
<p>Occasionally, you may find yourself in situations where you need to remove an entire database from the server.  For instance, in cases where your application requires volatile in-memory databases for short-term use.  Using this function, you can remove a database from the server.</p>
<h3 id="syntax-302"><a class="header" href="#syntax-302">Syntax</a></h3>
<pre><code>drop_db(&lt;conn&gt;, &lt;database&gt;, &lt;storage-type&gt;, &lt;opts&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;conn&gt;</code></strong> Defines the server connection.</li>
<li><strong><code>&lt;database&gt;</code></strong> Defines the database name.</li>
<li><strong><code>&lt;storage-type&gt;</code></strong> Defines the database storage-type.  Supported storage-types include,
<ul>
<li><em><code>:plocal</code></em> Sets it to the PLocal storage-type.</li>
<li><em><code>:memory</code></em> Sets it to the Memory storage-type.</li>
</ul>
</li>
<li><strong><code>&lt;opts&gt;</code></strong> Defines additional options.  For more information on the available options, see the <a href="marcopolo/MarcoPolo-drop-db.html#options">Options</a> section below.</li>
</ul>
<h4 id="options-3"><a class="header" href="#options-3">Options</a></h4>
<p>This function supports one additional option:</p>
<ul>
<li><strong><code>:timeout</code></strong> Defines the timeout value in milliseconds.  In the event that the operation takes longer than the allotted time, MarcoPolo sends an exit signal to the calling process.</li>
</ul>
<h4 id="return-values-3"><a class="header" href="#return-values-3">Return Values</a></h4>
<p>When the operation is successful, this function returns <code>:ok</code>.  In the event that it encounters an error, instead it returns the tuple <code>{:error, message}</code>, where the variable is the exception message.</p>
<h3 id="example-147"><a class="header" href="#example-147">Example</a></h3>
<p>Consider the use case of an application that operates with multiple databases in-memory.  These databases are ad hoc, brought online to address short term needs and then removed when the job is complete.</p>
<pre><code class="language-elixir">@doc """ Create ad hoc Databases """
def adhoc_db(conn, name, operation)

	# Create Database
	try do

		# Create Temporary Database
		MarcoPolo.create_db(conn, name, :graph, :memory)

		# Create Database Connection
		dbconn = MarcoPolo.start_link("admin", "admin_passwd", connection: {:db, name})

		# Call Operation
		operation(dbconn)

	after
		# Remove Temporary Database
		MarcoPolo.drop_db(conn, name, :memory)

	end
end
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="marcopolo---database-operations"><a class="header" href="#marcopolo---database-operations">MarcoPolo - Database Operations</a></h1>
<p>OrientDB differentiates between connections made to the database and connections made to the server.  While you can get both from the <code>start_link()</code> function in MarcoPolo, which you choose determines the kinds of operations you can perform.  Database operations</p>
<h2 id="connecting-to-the-database"><a class="header" href="#connecting-to-the-database">Connecting to the Database</a></h2>
<p>In order to operate on a database, you first need to connnect to it.  To manage this, call the <code>start_lik()</code> function with your database credentials, then pass the database name to the <code>connection:</code> parameter.  For instance,</p>
<pre><code class="language-elixir">@doc """ Connect to the given database using default credentials. """
def orientdb_database(user, passwd, dbname) ::
	{:ok, conn} = MarcoPolo.start_link(
		user: user, password: passwd,
		connect: {:db, dbname})
end
</code></pre>
<p>This function returns a connection interface that you can then pass to other MarcoPolo functions in performing further operations.</p>
<h2 id="using-database-connections"><a class="header" href="#using-database-connections">Using Database Connections</a></h2>
<p>When you call the <code>start_link()</code> function, it returns a connection interface to your application, which by convention is called <code>conn</code> here.  With the connection interface initialized to a particular database, there are a number of operations you can begin to call on the database, by passing the <code>conn</code> value to MarcoPolo functions.</p>
<pre><code class="language-elixir">@doc """ Report the size of the connected database to stdout """
def size_database(conn) do

	# Fetch Size
	size = MarcoPolo.db_size(conn)

	# Log Size
	IO.puts("Database Size: #{size}")
end
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Function</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="marcopolo/MarcoPolo-command.html"><code>command()</code></a></td><td>Executes a query or command on the database.</td></tr>
<tr><td><a href="marcopolo/MarcoPolo-create-record.html"><code>create_record()</code></a></td><td>Creates a record.</td></tr>
<tr><td><a href="marcopolo/MarcoPolo-db-countrecords.html"><code>db_countrecords()</code></a></td><td>Returns the number of records in the database.</td></tr>
<tr><td><a href="marcopolo/MarcoPolo-db-reload.html"><code>db_reload()</code></a></td><td>Reloads the database.</td></tr>
<tr><td><a href="marcopolo/MarcoPolo-db-size.html"><code>db_size()</code></a></td><td>Returns the size of the database.</td></tr>
<tr><td><a href="marcopolo/MarcoPolo-delete-record.html"><code>delete_record()</code></a></td><td>Removes the given record from the database.</td></tr>
<tr><td><a href="marcopolo/MarcoPolo-live-query.html"><code>live_query()</code></a></td><td>Subscribes to a live query.</td></tr>
<tr><td><a href="marcopolo/MarcoPolo-live-query-unsubscribe.html"><code>live_query_unsubscribe()</code></a></td><td>Unsubscribes from a live query.</td></tr>
<tr><td><a href="marcopolo/MarcoPolo-load-record.html"><code>load_record()</code></a></td><td>Loads a record into your application.</td></tr>
<tr><td><a href="marcopolo/MarcoPolo-script.html"><code>script()</code></a></td><td>Executes a script on the database in the given language.</td></tr>
<tr><td><a href="marcopolo/MarcoPolo-Database.html#closing-connections"><code>stop()</code></a></td><td>Closes the database connection.</td></tr>
<tr><td><a href="marcopolo/MarcoPolo-update-record.html"><code>update_record()</code></a></td><td>Updates the given record.</td></tr>
</tbody></table>
</div>
<h3 id="closing-connections-2"><a class="header" href="#closing-connections-2">Closing Connections</a></h3>
<p>When you're finished using a connection, you can close it to free up resources by calliing the <code>stop()</code> function and passing it the connection argument.</p>
<p>For instance, imagine that you have a series of scripts that you need to run on an OrientDB database.  These scripts are used to perform a series of routine maintenance and logging tasks each night, to prepare reports for administrators the following morning.  You might want to set up a dedicated function to manage such operations:</p>
<pre><code class="language-elixir">@doc """ Runs nightly maintenance scripts """
def maint_nightly(dbname, user, passwd, scripts) do

	# Log Operation
	IO.puts("Running Nightly Maintenance Scripts")

	# Open Connection
	IO.puts("Opening Database: #{dbname}")
	{:ok, conn } = MarcoPolo.start_link(
		user: user,
		password: passwd,
		connect: {:db, dbname})

	# Loop Over Each Script
	for script &lt;- scripts do

		# Execute Script
		case MarcoPolo.script(conn, "JavaScript", script) do
			{:ok, record} -&gt; IO.puts("Script Successful")
			{:error, reason} -&gt; IO.puts("Error: #{reason}")
		end

	end

	# Close Database when Done
	IO.puts("Closing Database: #{dbname}")
	MarcoPolo.stop(conn)

end
</code></pre>
<p>Bear in mind, the <code>stop()</code> function returns <code>:ok</code> regardless of whether or not it was successful in closing connection.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="marcopolo---command"><a class="header" href="#marcopolo---command">MarcoPolo - <code>command()</code></a></h1>
<p>This function executes a query or command on the database.</p>
<h2 id="sending-commands-3"><a class="header" href="#sending-commands-3">Sending Commands</a></h2>
<p>OrientDB SQL differentiates between idempotent queries (such as <a href="marcopolo/../sql/SQL-Query.html"><code>SELECT</code></a> and non-idempotent commands, such as <a href="marcopolo/../sql/SQL-Insert.html"><code>INSERT</code></a>.  The MarcoPolo Elixir API does not make this distinction, providing this function for use with both queries and commands..</p>
<h3 id="syntax-303"><a class="header" href="#syntax-303">Syntax</a></h3>
<pre><code>command(&lt;conn&gt;, &lt;query&gt;, &lt;opts&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;conn&gt;</code></strong> Defines the database connection.</li>
<li><strong><code>&lt;query&gt;</code></strong> Defines the query or command you want to execute.</li>
<li><strong><code>&lt;opts&gt;</code></strong> Defines additional options to set on the command.  For more information, see <a href="marcopolo/MarcoPolo-command.html#options">options</a> below.</li>
</ul>
<h4 id="options-4"><a class="header" href="#options-4">Options</a></h4>
<p>When issuing queries or commands using this function, there are a series of additional options available to you to further define how MarcoPolo performs the operation.</p>
<ul>
<li>
<p><strong><code>:params</code></strong> Defines a map of parameters for OrientDB to use in building prepared statements.  The map must use atoms or strings as keys, but can take any encodable term as values.</p>
<p>It defaults to <code>#{}</code></p>
</li>
<li>
<p><strong><code>:timeout</code></strong> Defines the timeout value in milliseconds.  In the event that the query takes longer than the allotted time, MarcoPolo sends an exit signal to the calling process.</p>
</li>
<li>
<p><strong><code>:fetch_plan</code></strong> Defines a <a href="marcopolo/../java/Fetching-Strategies.html">fetch plan</a>, which is only available when using this function with idempotent queries.  It is a mandatory argument with fetch queries.</p>
</li>
</ul>
<h4 id="return-values-4"><a class="header" href="#return-values-4">Return Values</a></h4>
<p>When the query or command is successful it returns the tuple <code>{:ok, values}</code>.  The <code>values</code> variable is a map with the following keys:</p>
<ul>
<li>
<p><strong><code>:response</code></strong> Provides the return value given by OrientDB.  This varies depending the query.  For instance, <a href="marcopolo/../sql/SQL-Query.html"><code>SELECT</code></a> returns a list of records, <a href="marcopolo/../sql/SQL-Create-Cluster.html"><code>CREATE CLUSTER</code></a> returns the new cluster's Cluster ID.</p>
</li>
<li>
<p><strong><code>:linked_records</code></strong> Provides a set of additional records fetched by OrientDB.  The <code>:fetch_plan</code> option controls the number of records retrieved to this value.</p>
</li>
</ul>
<p>In the event that the query or command fails, it returns the tuple <code>{:error, term}</code>.  The <code>term</code> variable provides the error message.</p>
<h3 id="examples-49"><a class="header" href="#examples-49">Examples</a></h3>
<h4 id="non-idempotent-commands"><a class="header" href="#non-idempotent-commands">Non-idempotent Commands</a></h4>
<p>For instance, in cases where you find yourself making frequent insertions of a particular class, you might want to set up a function to streamline this process and to make it easier to insert a series of records through a single function call.</p>
<pre><code class="language-elixir">@doc """Inserts records from array into the given class"""
def insert_records(conn, class, properties, records) do

	# Log Operation
	IO.puts("Adding Records to #{class}")
	
	# Build Initial INSERT Statement
	joined_prop = Enum.join(properties, ",")
	insert = "INSERT INTO #{class} (#{joined_prop}) "

	# Loop over Given Records
	for record &lt;- records do

		# Complete INSERT Statement
		data = Enum.join(record, ", ")
		sql = "#{insert} VALUES(#{data})"

		# Issue INSERT Statement
		MarcoPolo.command(conn, sql)

	end
end
</code></pre>
<h4 id="idempotent-queries"><a class="header" href="#idempotent-queries">Idempotent Queries</a></h4>
<p>You might find yourself in similar situations when working with idempotent queries.  For instance, if you frequently query the same class on the database with close or identical options passed to the query, you can save yourself some time by standardizing the process in a function.</p>
<pre><code class="language-elixir">@doc """ Retrieve User Profile """
def fetch_profile(conn, user) do

	# Log Operation
	IO.puts("Retrieving Profile for User ID: #{uid}"

	# Build SELECT Statement
	select = "SELECT FROM :class WHERE userId=':uid'"

	# Query Database
	options = [params: %{uid: user, class: "Profile"}, fetch_plan: "*:-1"]
	MarcoPolo.command(conn, select, options)
end
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="marcopolo---create_record"><a class="header" href="#marcopolo---create_record">MarcoPolo - <code>create_record()</code></a></h1>
<p>This method create a record on the database, using the given data.</p>
<h2 id="creating-records-3"><a class="header" href="#creating-records-3">Creating Records</a></h2>
<p>When you want to create new records, you can build <a href="marcopolo/MarcoPolo-Document.html"><code>Document</code></a> instances within your Elixir application code and pass it to this method to add it to the database.</p>
<h3 id="syntax-304"><a class="header" href="#syntax-304">Syntax</a></h3>
<pre><code>create_record(&lt;conn&gt;, &lt;cluster-id&gt;, &lt;data&gt;, &lt;opts&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;conn&gt;</code></strong> Defines the database connection.</li>
<li><strong><code>&lt;cluster-id&gt;</code></strong> Defines the Cluster you want to use.</li>
<li><strong><code>&lt;data&gt;</code></strong> Defines the data to use in the record.</li>
<li><strong><code>&lt;opts&gt;</code></strong> Defines optional options to pass to the function.  For more information on the available options, see <a href="marcopolo/MarcoPolo-create-record.html#options">Options</a> below.</li>
</ul>
<h4 id="options-5"><a class="header" href="#options-5">Options</a></h4>
<p>This function takes the following options:</p>
<ul>
<li>
<p><strong><code>:no_response</code></strong> Defines whether the function should wait on a response from the OrientDB Server.  If set <code>false</code>, it returns <code>:ok</code> regardless of whether or not the operation was successful.</p>
</li>
<li>
<p><strong><code>:timeout</code></strong> Defines the timeout value in milliseconds.  In the event that the query takes longer than the alloted time, MarcoPolo sends an exit signal to the calling process.</p>
</li>
</ul>
<h4 id="return-values-5"><a class="header" href="#return-values-5">Return Values</a></h4>
<p>When the function is successful, it returns the tuple <code>{:ok, record_info}</code>.  The <code>record_info</code> value is a tuple containing the Record ID and record version.  In the event that the record creation fails, it returns <code>{:error, term}</code>.  The <code>term</code> variable provides the error message.</p>
<h3 id="example-148"><a class="header" href="#example-148">Example</a></h3>
<p>For instance, consider the use case of a web application.  You might want a function to streamline adding new blog entries to the database.</p>
<pre><code class="language-elixir">@doc """Takes given data and add new blog entry to database"""
def add_blog(conn, author, title, text) do

	# Log Operation
	IO.puts("Adding Blog for User: #{author}")

	# Build Document
	record = %MarcoPolo.Document{class: "BlogEntry",
		fields: %{
			"title" =&gt; title,
			"author" =&gt; author,
			"text": =&gt; text}}

	# Create Record
	case MarcoPolo.create_record(conn, 15, record) do
		{:ok, {record_id, version}} -&gt; IO.puts("Record Created")
		{:error, reason} -&gt; IO.puts("Error: #{reason}")

	end
end
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="marcopolo---db_countrecords"><a class="header" href="#marcopolo---db_countrecords">MarcoPolo - <code>db_countrecords()</code></a></h1>
<p>This function returns the number of records in a database.</p>
<h2 id="counting-records-4"><a class="header" href="#counting-records-4">Counting Records</a></h2>
<p>In certain situations you may find it useful to size the database or to count the number of records it contains.  The <a href="marcopolo/MarcoPolo-db-size.html"><code>db_size()</code></a> function returns the size.  This function returns the database record count.</p>
<h3 id="syntax-305"><a class="header" href="#syntax-305">Syntax</a></h3>
<pre><code>db_countrecords(&lt;conn&gt;, &lt;opts&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;conn&gt;</code></strong> Defines the database connection.</li>
<li><strong><code>&lt;opts&gt;</code></strong> Defines additional options.  For more information on the available options, see <a href="marcopolo/MarcoPolo-db-countrecords.html#options">Options</a>.</li>
</ul>
<h4 id="options-6"><a class="header" href="#options-6">Options</a></h4>
<p>This function only provides one additional option:</p>
<ul>
<li><strong><code>:timeout</code></strong> Defines the timeout value in milliseconds.  In the event that the operation takes longer than the allotted time, MarcoPolo sends an exit signal to the calling process.</li>
</ul>
<h4 id="return-values-6"><a class="header" href="#return-values-6">Return Values</a></h4>
<p>When this function is successful it returns the tuple <code>{:ok, count}</code>, where <code>count</code> is a non-negative integer indicating the number of records in the connected database.  In the event that the function fails, it returns the tuple <code>{:error, reason}</code>, where the reason is the exception message the function receives.</p>
<h3 id="example-149"><a class="header" href="#example-149">Example</a></h3>
<p>For instance, consider the use case of a logging operation.  Whenever you connect to the database it logs the record count to the console.</p>
<pre><code class="language-elixir">@doc """ Open Database """
def connect() do

	# Log Operation
	IO.puts("Connecting to Database")

	# Connect to Database
	{:ok, conn} = MarcoPolo.start_link(
			user: "admin",
			password: "admin_passwd",
			connection: {:db, "blog"}) 

	# Log Number of Records
	count = MarcoPolo.db_countrecords(conn, {:timeout 5000})
	IO.puts("Record Count: #{count}")

	# Return Connection
	{:ok, conn}

end
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="marcopolo---db_reload"><a class="header" href="#marcopolo---db_reload">MarcoPolo - <code>db_reload()</code></a></h1>
<p>This function reloads the database connection.</p>
<h2 id="reloading-databases-1"><a class="header" href="#reloading-databases-1">Reloading Databases</a></h2>
<p>Occasionally, you may need to reload the database connection.</p>
<h3 id="syntax-306"><a class="header" href="#syntax-306">Syntax</a></h3>
<pre><code>db_reload(&lt;conn&gt;, &lt;opts&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;conn&gt;</code></strong> Defines the database connection.</li>
<li><strong><code>&lt;opts&gt;</code></strong> Defines additional options for the function.</li>
</ul>
<h4 id="options-7"><a class="header" href="#options-7">Options</a></h4>
<p>This function can take one additional option.</p>
<ul>
<li><strong><code>:timeout</code></strong> Defines the timeout value in milliseconds.  In the event that the reload operate takes longer than the alloted time, MarcoPolo sends an exit signal to the calling process.</li>
</ul>
<h3 id="example-150"><a class="header" href="#example-150">Example</a></h3>
<p>Consider the use case of a multithreaded application or some similar deployment in which multiple clients are operating on the given OrientDB database.  You might want to set up a basic timer that reloads the database connection periodically from a separate thread.</p>
<pre><code class="language-elixir">@doc """ Reload the database connection at set intervals"""
def reload(conn, interval) do

	# Log Operation
	IO.puts("Starting Reload Function")

	# Start Timer
	timer.apply_interval(interval, MarcoPolo, db_reload, conn)

end
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="marcopolo---db_size"><a class="header" href="#marcopolo---db_size">MarcoPolo - <code>db_size()</code></a></h1>
<p>This function returns the size of the database.</p>
<h2 id="sizing-the-database"><a class="header" href="#sizing-the-database">Sizing the Database</a></h2>
<p>In certain situations you may find it useful to size the database or to count the number of records it contains.  The <a href="marcopolo/MarcoPolo-db-countrecords.html"><code>db_countrecords()</code></a> function returns the record count.  This function returns the size.</p>
<h3 id="syntax-307"><a class="header" href="#syntax-307">Syntax</a></h3>
<pre><code>db_size(&lt;conn&gt;, &lt;opts&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;conn&gt;</code></strong> Defines the database connection.</li>
<li><strong><code>&lt;opts&gt;</code></strong> Defines additional options for the function.</li>
</ul>
<h4 id="options-8"><a class="header" href="#options-8">Options</a></h4>
<p>This function provides only one additional option:</p>
<ul>
<li><strong><code>:timeout</code></strong> Defines the timeout value in milliseconds.  In the event that the operation takes longer than the allotted time, MarcoPolo sends an exit signal to the calling process.</li>
</ul>
<h4 id="return-value-155"><a class="header" href="#return-value-155">Return Value</a></h4>
<p>When this function is successful, it returns the tuple <code>{:ok, size}</code>, where <code>size</code> is a non-negative integer indicating the database size.  In the event that the operation fails, the function returns the tuple <code>{:error, reason}</code>, where <code>reason</code> contains the exception message.</p>
<h3 id="example-151"><a class="header" href="#example-151">Example</a></h3>
<p>For instance, consider the use case of a logging operation.  Whenever you close a database connection, you would like to log the size of the database at the time it was closed, to check against later.</p>
<pre><code class="language-elixir">@doc """ Close the Database """
def close_database(conn) do

	# Log Operation
	IO.puts("Closing Database")

	# Fetch Size
	size = MarcoPolo.db_size(conn)
	IO.puts("Database Size: #{size}")

	# Close Database
	MarcoPolo.stop(conn)
	IO.puts("Database Closed")

end
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="marcopolo---delete_record"><a class="header" href="#marcopolo---delete_record">MarcoPolo - <code>delete_record()</code></a></h1>
<p>This method removes a record from the database, identified by its Record ID.</p>
<h2 id="removing-records-3"><a class="header" href="#removing-records-3">Removing Records</a></h2>
<p>Occasionally, you may find you need to remove records from the database and have to decide which from within your Elixir application.  This function allows you to do so, removing records by their Record ID's.</p>
<h3 id="syntax-308"><a class="header" href="#syntax-308">Syntax</a></h3>
<pre><code>delete_record(&lt;conn&gt;, &lt;record-id&gt;, &lt;version&gt;, &lt;opts&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;conn&gt;</code></strong> Defines the database connection.</li>
<li><strong><code>&lt;record-id&gt;</code></strong> Defines the Record ID, as an <a href="marcopolo/MarcoPolo-RID.html"><code>RID</code></a> instance.</li>
<li><strong><code>&lt;version&gt;</code></strong> Defines the record version.</li>
<li><strong><code>&lt;opts&gt;</code></strong> Defines additional options for the function.  For more information, see the <a href="marcopolo/MarcoPolo-delete-record.html#options">Options</a> section below.</li>
</ul>
<h4 id="options-9"><a class="header" href="#options-9">Options</a></h4>
<p>This function provides two additional options:</p>
<ul>
<li>
<p><strong><code>:no_response</code></strong> Defines whether you want your application to wait for a response from OrientDB.  When set to <code>true</code>, it returns <code>:ok</code> on every operation, regardless of whether it's successful.</p>
</li>
<li>
<p><strong><code>:timeout</code></strong> Defines the timeout value in milliseconds.  In the event that the query takes longer than the alloted time, MarcoPolo sends an exit signal to the calling process.</p>
</li>
</ul>
<h4 id="return-values-7"><a class="header" href="#return-values-7">Return Values</a></h4>
<p>When this operation is successful, the function returns the tuple <code>{:ok, passed}</code>, where the <code>passed</code> variable is a boolean value indicating whether the record was successfully deleted.  In the event that the operation fails, it returns the tuple <code>{:error, message}</code>, where the variable contains the exception message.</p>
<h3 id="example-152"><a class="header" href="#example-152">Example</a></h3>
<p>Consider the use case where you need to remove a series of records from the database.  Rather than calling <code>delete_record()</code> individually on each instance, you might want to create a function to handle the deletions.</p>
<pre><code class="language-elixir">@doc """Function to remove records from the database. It takes as arguments
the database connection interface and a list of tuples indicating
the records to remove.  Each tuple follows the pattern {cluster-id, [list of record id's]}."""
def remove_records(conn, record_list) do

	# Log Operation
	IO.puts("Removing Records")

	# Loop over Clusters
	for cluster &lt;- record_list do
	
		# Fetch Cluster ID
		cluster_id = cluster.id

		records = cluster.records

		# Loop Over Records
		for record &lt;- records do

			# Construct RID
			rid = MarcoPolo.RID(cluster_id, record)
			# Remove Records
			MarcoPolo.delete_record(conn, rid)

		end
	end
end
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="marcopolo---live_query"><a class="header" href="#marcopolo---live_query">MarcoPolo - <code>live_query()</code></a></h1>
<p>This function subscribes to a <a href="marcopolo/../java/Live-Query.html">live query</a></p>
<h2 id="subscribing-to-live-queries"><a class="header" href="#subscribing-to-live-queries">Subscribing to Live Queries</a></h2>
<p>When you issue queries using the standard <a href="marcopolo/MarcoPolo-command.html"><code>command()</code></a> function, what it returns is effectively a snapshot of the records in the state they held when the query was issued.  In the event that another client modifies these records, there's no way you'll know unless you reissue the query.</p>
<p>To get around this limitation, OrientDB provides Live Queries.  Instead of returning records, these queries return a subscription token.  When the records assigned to this token receive an update, OrientDB pushes the changes to the given receiver function.</p>
<p>This function subscribes to live queries.  When you're finished with the live query, you can call the <a href="marcopolo/MarcoPolo-live-query-unsubscribe.html"><code>live_query_unsubscribe()</code></a> function to deregister the token.</p>
<h3 id="syntax-309"><a class="header" href="#syntax-309">Syntax</a></h3>
<pre><code>live_query(&lt;conn&gt;, &lt;query&gt;, &lt;receiver&gt;, &lt;opts&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;conn&gt;</code></strong> Defines the database connection.</li>
<li><strong><code>&lt;query&gt;</code></strong> Defines the query.</li>
<li><strong><code>&lt;receiver&gt;</code></strong> Defines the function to receive the records</li>
<li><strong><code>&lt;opts&gt;</code></strong> Defines additional options for the function.  For more information, see <a href="marcopolo/MarcoPolo-live-query.html#options">Options</a>.</li>
</ul>
<h4 id="options-10"><a class="header" href="#options-10">Options</a></h4>
<p>This function can take one additional option:</p>
<ul>
<li><strong><code>:timeout</code></strong> Defines the timeout value in milliseconds.  In the event that the operation takes longer than the allotted time, MarcoPolo sends an exit signal to the calling process.</li>
</ul>
<h4 id="return-value-156"><a class="header" href="#return-value-156">Return Value</a></h4>
<p>When this operation is successful, it returns the tuple <code>{:ok, token}</code>, where the variable is a subscription token, which OrientDB uses to register any changes made to the records the query returns.  You can use this token with the <a href="marcopolo/MarcoPolo-live-query-unsubscribe.html"><code>live_query_unsubscribe()</code></a> function when you're ready to unsubscribe.</p>
<p>In the event that the operation fails, it returns <code>{:error, message}</code>, where the variable provides the exception message.</p>
<h3 id="example-153"><a class="header" href="#example-153">Example</a></h3>
<p>Imagine you have an application that handles monitoring for various environmental sensors.  Every fifteen minutes your application calls a series of functions to update the OrientDB database.  You might use a Live Query to test whether the sensor reading has met an alert condition, causing the application to send emails or text messages to on-call operators.  After a given timeout interval, the query resets itself, unsubscribing from the given Live Query.</p>
<pre><code class="language-elixir">@doc """ Check Readings for Alert Conditions """
def check_readings(record) do

	# Retrieve Data
	data = record.fields["reading"]

	if data &gt;= threshold do

		# Log Alert
		IO.puts("Alert Condition: #{data}")

		# Call Notification Function
		notify_operator(record)

	end
end

@doc """ Handler for monitor function check_readings() """
def read_handler(conn, sensor, interval) do

	# Log Operation
	IO.puts("Initializing #{sensor} Monitor")

	# Call Live Query
	{:ok, token } -&gt; MarcoPolo.live_query(conn,
		"LIVE SELECT FROM Sensors WHERE sensor_name = '#{sensor}'",
		check_readings)

	# Wait Interval
	Process.sleep(interval)

	# Unsubscribe and Restart Monitor
	MarcoPolo.live_query_unsubscribe(token)

	# Recursive Restart 
	read_handler(conn, sensor, interval)

end
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="marcopolo---live_query_unsubscribe"><a class="header" href="#marcopolo---live_query_unsubscribe">MarcoPolo - <code>live_query_unsubscribe()</code></a></h1>
<p>This function unsubscribes a receiver from a live query.</p>
<h2 id="unsubscribing-from-live-queries"><a class="header" href="#unsubscribing-from-live-queries">Unsubscribing from Live Queries</a></h2>
<p>When you issue queries using the standard <a href="marcopolo/MarcoPolo-command.html"><code>command()</code></a> function, what it returns is effectively a snapshot of the records in the state they held when the query was issued.  In the event that another client modifies these records, there's no way you'll know unless you reissue the query.</p>
<p>To get around this limitation, OrientDB provides <a href="marcopolo/../java/Live-Query.html">Live Queries</a>.  Instead of returning records, these queries return a subscription token.  When the records assigned to this token receive an update, OrientDB pushes the changes to the receiver function.</p>
<p>To subscribe to a live query in your Elixir application, use the <a href="marcopolo/MarcoPolo-live-query.html"><code>live_query()</code></a> function.  This function unsubscribes to the live query.</p>
<h3 id="syntax-310"><a class="header" href="#syntax-310">Syntax</a></h3>
<pre><code>live_query_unsubscribe(&lt;conn&gt;, &lt;token&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;conn&gt;</code></strong> Defines the database connection.</li>
<li><strong><code>&lt;token&gt;</code></strong> Defines the live query token.</li>
</ul>
<h4 id="return-values-8"><a class="header" href="#return-values-8">Return Values</a></h4>
<p>This function only returns the value <code>:ok</code>.</p>
<h3 id="example-154"><a class="header" href="#example-154">Example</a></h3>
<p>Imagine you have an application that handles monitoring for various environmental sensors.  Every fifteen minutes your application calls a series of functions to update the OrientDB database.  You might use a Live Query to test whether the sensor reading has met an alert condition, causing the application to send emails or text messages to on-call operators.  After a given timeout interval, the query resets itself, unsubscribing from the given Live Query.</p>
<pre><code class="language-elixir">@doc """ Check Readings for Alert Conditions """
def check_readings(record) do

	# Retrieve Data
	data = record.fields["reading"]

	if data &gt;= threshold do

		# Log Alert
		IO.puts("Alert Condition: #{data}")

		# Call Notification Function
		notify_operator(record)

	end
end

@doc """ Handler for monitor function check_readings() """
def read_handler(conn, sensor, interval) do

	# Log Operation
	IO.puts("Initializing #{sensor} Monitor")

	# Call Live Query
	{:ok, token } -&gt; MarcoPolo.live_query(conn,
		"LIVE SELECT FROM Sensors WHERE sensor_name = '#{sensor}'",
		check_readings)

	# Wait Interval
	Process.sleep(interval)

	# Unsubscribe and Restart Monitor
	MarcoPolo.live_query_unsubscribe(token)

	# Recursive Restart 
	read_handler(conn, sensor, interval)

end
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="marcopolo---load_record"><a class="header" href="#marcopolo---load_record">MarcoPolo - <code>load_record()</code></a></h1>
<p>This function loads a record from the database.</p>
<h2 id="loading-records-3"><a class="header" href="#loading-records-3">Loading Records</a></h2>
<p>Eventually, you'll want to operate on records from within your Elixir application.  Using this function, you can retrieve records from the database by their Record ID's.</p>
<h3 id="syntax-311"><a class="header" href="#syntax-311">Syntax</a></h3>
<pre><code>load_record(&lt;conn&gt;, &lt;record-id&gt;, &lt;opts&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;conn&gt;</code></strong> Defines the database connection.</li>
<li><strong><code>&lt;record-id&gt;</code></strong> Defines the Record ID.</li>
<li><strong><code>&lt;opts&gt;</code></strong> Defines additional options for the function.  For more information on the available options, see the <a href="marcopolo/MarcoPolo-load-record.html#options">Options</a> section below.</li>
</ul>
<h4 id="options-11"><a class="header" href="#options-11">Options</a></h4>
<p>This function supports a series of additional options defined through the final argument.</p>
<ul>
<li><strong><code>:fetch_plan</code></strong> Defines a <a href="marcopolo/../java/Fetching-Strategies.html">fetch plan</a>.</li>
<li><strong><code>:ignore_cache</code></strong> Defines whether you want to ignore the cache.  It defaults to <code>true</code>.</li>
<li><strong><code>:load_tombstones</code></strong> Defines whether you want to load information on deleted records.  It defaults to <code>false</code>.</li>
<li><strong><code>:if_version_not_latest</code></strong> Defines whether you want to load the record in cases where the provided version is not the latest.  This functionality was introduced in version 2.1 of OrientDB.</li>
<li><strong><code>:version</code></strong> Defines the record version that you want to load.</li>
<li><strong><code>:timeout</code></strong> Defines the timeout value in milliseconds.  In the event that the query takes longer than the allotted time, MarcoPolo sends an exit signal to the calling process.</li>
</ul>
<h4 id="return-values-9"><a class="header" href="#return-values-9">Return Values</a></h4>
<p>When the operation is successful, the function returns the tuple <code>{:ok, response}</code>.  The variable itself is a tuple that contains two elements: the loaded record and the set of records linked to it.  You can control the number and depth of linked records using the <code>:fetch_plan</code> option.</p>
<p>In the event that the operation fails, it returns the tuple <code>{:error, message}</code>, where the variable provides the exception message.</p>
<h3 id="example-155"><a class="header" href="#example-155">Example</a></h3>
<p>Picture an environmental monitoring application where various sensors on write to particular clusters in your database.  For each sensor you have a record defining what it monitors and where it is located, and edges that connect to separate vertices noting the readings taken at particular times.  You might use a function like the below to retrieve histories on particular sensors.</p>
<pre><code class="language-elixir">@doc """ Retrieves sensor data """
def fetch_data(conn, cluster, id) do

	# Log Operation
	IO.puts("Loading Records")


	# Create Record ID
	rid = MarcoPolo.RID( cluster_id: cluster, position: id)

	# Define Options
	options = [fetch_plan: "*.-1"]

	# Load Record
	MarcoPolo.load_record(conn, rid, options) 

end
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="marcopolo---script"><a class="header" href="#marcopolo---script">MarcoPolo - <code>script()</code></a></h1>
<p>This method executes a script on the database.</p>
<blockquote>
<p><strong>NOTE</strong>: In order for this to work, you must first enable scripting on OrientDB.  For more information, see <a href="marcopolo/../js/Javascript-Command.html">JavaScript</a>.</p>
</blockquote>
<h2 id="scripting-the-database"><a class="header" href="#scripting-the-database">Scripting the Database</a></h2>
<p>OrientDB provides support for scripting operations in JavaScript and other languages. This allows you to develop a repository of common operations or to share functions between applications developed in different languages.</p>
<h3 id="syntax-312"><a class="header" href="#syntax-312">Syntax</a></h3>
<pre><code>script(&lt;conn&gt;, &lt;language&gt;, &lt;script&gt;, &lt;opts&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;conn&gt;</code></strong> Defines the database connection.</li>
<li><strong><code>&lt;language&gt;</code></strong> Defines the language of the script.</li>
<li><strong><code>&lt;script&gt;</code></strong> Defines the script to execute.</li>
<li><strong><code>&lt;opts&gt;</code></strong> Defines additional options for the function.</li>
</ul>
<h4 id="options-12"><a class="header" href="#options-12">Options</a></h4>
<p>This function only provides on additional option:</p>
<ul>
<li><strong><code>:timeout</code></strong> Defines the timeout value in milliseconds.  In the event that the script takes longer than the allotted time to finish, MarcoPolo sends an exit signal to the calling process.</li>
</ul>
<h4 id="return-values-10"><a class="header" href="#return-values-10">Return Values</a></h4>
<p>When the script is successful, it returns the tuple <code>{:ok, record}</code>, where the variable is the last record the script operates on.  In the event that the operation fails, it returns the tuple <code>{:error, message}</code> where the variable is the exception message.</p>
<h3 id="example-156"><a class="header" href="#example-156">Example</a></h3>
<p>For instance, imagine you have a series of stored scripts to handle common operations on OrientDB.  In porting your current application to Elixir, you may want to save these scripts and continue to use them.</p>
<pre><code class="language-elixir">@doc """ Run the given script on OrientDB"""
def run_script(conn, path) do

	# Log Operation
	IO.puts("Running Script #{path}")
	{:ok, script} = IO.read(path)

	# Run Script
	{:ok, return} = MarcoPolo.script(conn, "JavaScript", script)

end
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="marcopolo---update_record"><a class="header" href="#marcopolo---update_record">MarcoPolo - <code>update_record()</code></a></h1>
<p>This function updates a record on the database.</p>
<h2 id="updating-records-7"><a class="header" href="#updating-records-7">Updating Records</a></h2>
<p>When you're finished making changes to records loaded into your Elixir application, this function allows you to use the new data to update existing records on the database.</p>
<h3 id="syntax-313"><a class="header" href="#syntax-313">Syntax</a></h3>
<pre><code>update_record(&lt;conn&gt;, &lt;record-id&gt;, &lt;version&gt;, 
              &lt;data&gt;, &lt;update-content&gt;, &lt;opts&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;conn&gt;</code></strong> Defines the database connection.</li>
<li><strong><code>&lt;record-id&gt;</code></strong> Defines the Record ID.</li>
<li><strong><code>&lt;version&gt;</code></strong> Defines the record version.</li>
<li><strong><code>&lt;data&gt;</code></strong> Defines the data you want to add.</li>
<li><strong><code>&lt;update-content&gt;</code></strong> Defines whether you want to update the content.</li>
<li><strong><code>&lt;opts&gt;</code></strong> Defines additional options for the function.  For more information on the available options, see the <a href="marcopolo/MarcoPolo-update-record.html#options">Options</a> section below.</li>
</ul>
<h4 id="options-13"><a class="header" href="#options-13">Options</a></h4>
<p>This function supports two additional options:</p>
<ul>
<li><strong><code>:no_response</code></strong> Defines whether you want your application to wait for a response from OrientDB.  When set to <code>true</code>, it sends the update and returns <code>:ok</code> regardless of whether the operation was successful.</li>
<li><strong><code>:timeout</code></strong> Defines the timeout value in milliseconds.  In the event that the update takes longer than the allotted time, MarcoPolo sends an exit signal to the calling process.</li>
</ul>
<h4 id="return-values-11"><a class="header" href="#return-values-11">Return Values</a></h4>
<p>When the operation is successful, the function returns the tuple <code>{:ok, version}</code>, where the variable is a non-negative integer indicating the updated version number on the record.  In the event that the operation fails, it returns the tuple <code>{:error, message}</code>, where the variable is the exception message.</p>
<h3 id="example-157"><a class="header" href="#example-157">Example</a></h3>
<p>For instance, consider the use case of a web application.  You might want a function to streamline updating blog entires on the database.</p>
<pre><code class="language-elixir">@doc """Takes given data and updates blog entry to database"""
def update_blog(conn, cluster, position, version, author, title, text) do

	# Log Operation
	IO.puts("Updating Blog \##{cluster}:#{position} for User: #{author}")

	# Build Document
	record = %MarcoPolo.Document{class: "BlogEntry",
		fields: %{
			"title" =&gt; title,
			"author" =&gt; author,
			"text": =&gt; text}}

	# Set Record ID
	rid = MarcoPolo.RID(
		cluster_id: cluster, 
		position: position)


	# Update Record
	MarcoPolo.update_record(conn, rid, version, record, true)

end
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="marcopolo---types"><a class="header" href="#marcopolo---types">MarcoPolo - Types</a></h1>
<p>When you store data on the database, OrientDB sets it using the typing conventions of Java.  In turn, when MarcoPolo retrieves data from OrientDB, the return values use the typing conventions of Elixir.  This ensures that the Erlang VM can understand these return values.</p>
<p>Typing in Java is somewhat more granular than it is in Elixir.  For instance, where Elixir has the integer, Java has the 2-byte short, the 4-byte integer, and the 8-byte long.  Records created in MarcoPolo encode Elixir integers as the 4-byte Java integers.  In cases where you want to take advantage of Java typing in data storage or simply use the more granular types available in that language, you can set the type you want MarcoPolo to use when sending data to OrientDB.</p>
<h2 id="typing-in-marcopolo"><a class="header" href="#typing-in-marcopolo">Typing in MarcoPolo</a></h2>
<p>In any situation where you send data from your application to OrientDB, MarcoPolo converts the internal type in Elixir to a default type in Java.  So, for instance, if you set a boolean value on a record it gets set in OrientDB as the <code>java.lang.Boolean</code> type.</p>
<p>Java types that you retrieve from OrientDB are converted to their approximate Elixir type.  So, if you query OrientDB and retrieve an instance of <code>java.lang.Long</code> it is set in your application as an Elixir integer.</p>
<p>You can also force the type to store on OrientDB by using a tuple, where the first value is the type you want and the second the value you want to set.  For instance,</p>
<pre><code class="language-elixir">data = {:long, 944}
</code></pre>
<p>Here, an integer in your application is sent to OrientDB as a long integer.  When your application retrieves a long integer, it is set on your application as an integer.</p>
<h3 id="numeric-types"><a class="header" href="#numeric-types">Numeric Types</a></h3>
<ul>
<li><strong>Integers</strong>: <code>83</code> or <code>{:int, 83</code>
<ul>
<li>Typed in OrientDB as <code>java.lang.Integer</code> or <code>int</code></li>
<li>Returned to MarcoPolo as <code>83</code></li>
</ul>
</li>
<li><strong>Short Integers</strong>: <code>{:short, 83}</code>
<ul>
<li>Typed in OrientDB as <code>java.lang.Short</code> or <code>short</code></li>
<li>Returned to MarcoPolo as <code>83</code></li>
</ul>
</li>
<li><strong>Long Integer</strong>: <code>{:long, 83}</code>
<ul>
<li>Typed in OrientDB as <code>java.lang.Long</code> or <code>long</code></li>
<li>Returned to MarcoPolo as <code>83</code></li>
</ul>
</li>
<li><strong>Doubles</strong>: <code>3.14</code>
<ul>
<li>Typed in OrientDB as <code>java.lang.Double</code> or <code>double</code></li>
<li>Returned to MarcoPolo as <code>3.14</code></li>
</ul>
</li>
<li><strong>Floats</strong>: <code>{:float, 3.14}</code>
<ul>
<li>Typed in OrientDB as <code>java.lang.Float</code> or <code>float</code></li>
<li>Returned to MarcoPolo as <code>3.14</code></li>
</ul>
</li>
<li><strong>Decimals</strong>: Using <a href="https://github.com/ericmj/decimal">Decimal</a>, <code>Decimal.new(3.14)</code>
<ul>
<li>Typed in OrientDB as <code>java.math.BigDecimal</code></li>
<li>Returned to MarcoPolo as <code>Decimal.new(3.14)</code></li>
</ul>
</li>
</ul>
<h3 id="date-and-time-types"><a class="header" href="#date-and-time-types">Date and Time Types</a></h3>
<ul>
<li><strong>Date</strong>: Using <a href="marcopolo/MarcoPolo-Date.html">Date</a>, <code>%MarcoPolo.Date{year: 2017, month: 5, day: 5}</code>
<ul>
<li>Typed in OrientDB as <code>java.util.Date</code></li>
<li>Returned to MarcoPolo as <code>%MarcoPolo.Date{year: 2017 month: 5 day: 5}</code></li>
</ul>
</li>
<li><strong>DateTime</strong>: Using <a href="marcopolo/MarcoPolo-DateTime.html">DateTime</a>, <code>%MarcoPolo.DateTime{year: 2017,i month: 5, day: 5, hour: 15, minute: 30, sec: 0, msec: 0}</code>
<ul>
<li>Typed in OrientDB as <code>java.util.Date</code></li>
<li>Returned to MarcoPolo as <code>%MarcoPolo.DateTime{year: 2017,i month: 5, day: 5, hour: 15, minute: 30, sec: 0, msec: 0}</code></li>
</ul>
</li>
</ul>
<h3 id="embedded-types"><a class="header" href="#embedded-types">Embedded Types</a></h3>
<ul>
<li><strong>Document</strong>: Using <a href="marcopolo/MarcoPolo-Document.html">Document</a>, <code>%MarcoPolo.Document{}</code>
<ul>
<li>Typed in OrientDB as <code>ORecord</code></li>
<li>Returned to MarcoPolo as the same value.</li>
</ul>
</li>
<li><strong>List</strong>: <code>[1, "foo", {:float, 3.14}]</code>
<ul>
<li>Typed in OrientDB as <code>List&lt;Object&gt;</code></li>
<li>Returned ot MarcoPolo as <code>[1, "foo", 3.14</code></li>
</ul>
</li>
<li><strong>Hash Set</strong>: <code>#HashSet&lt;[2, 1]&gt;</code>
<ul>
<li>Typed in OrientDB as <code>Set&lt;Object&gt;</code></li>
<li>Returned to MarcoPolo as <code>#HashSet&lt;[2, 1]&gt;</code></li>
</ul>
</li>
<li><strong>Map</strong>: <code>%{"foo" =&gt; true}</code>
<ul>
<li>Typed in OrientDB as <code>Map&lt;String, ORecord&gt;</code></li>
<li>Returned to MarcoPolo as <code>%{"foo" =&gt; true}</code></li>
</ul>
</li>
</ul>
<h3 id="link-types"><a class="header" href="#link-types">Link Types</a></h3>
<ul>
<li><strong>Link</strong>: Using <a href="marcopolo/MarcoPolo-RID.html">RID</a>, <code>%MarcoPolo.RID{cluster_id: 21, position: 3}</code>
<ul>
<li>Typed in OrientDB as <code>ORID</code></li>
<li>Returned to MarcoPolo as <code>%MarcoPolo.RID{cluster_id: 21, position: 3}</code></li>
</ul>
</li>
<li><strong>Link List</strong>: <code>{:link_list, [%MarcoPolo.RID{}, ...]}</code>
<ul>
<li>Typed in OrientDB as <code>List&lt;ORID&gt;</code></li>
<li>Returned to MarcoPolo as <code>{:link_list, [%MarcoPolo.RID{}, ...]}</code></li>
</ul>
</li>
<li><strong>Link Set</strong>: <code>{:link_set, #HashSet&lt;%MarcoPolo.RID{}, ...&gt;}</code>
<ul>
<li>Typed in OrientDB as <code>SET&lt;ORID&gt;</code></li>
<li>Returned to MarcoPolo as <code>{:link_set, #HashSet&lt;%MarcoPolo.RID{}, ...&gt;}</code></li>
</ul>
</li>
<li><strong>Link Map</strong>: <code>{:link_map, %{"foo" =&gt; %MarcoPolo.RID{}, ...}}</code>
<ul>
<li>Typed in OrientDB as <code>Map&lt;String, ORID&gt;</code></li>
<li>Returned to MarcoPolo as <code>{:link_map, %{"foo" =&gt; %MarcoPolo.RID{}, ...}}</code></li>
</ul>
</li>
</ul>
<h3 id="other-types"><a class="header" href="#other-types">Other Types</a></h3>
<ul>
<li><strong>Binary</strong>: <code>{:binary, &lt;&lt;7, 2&gt;&gt;</code>
<ul>
<li>Typed in OrientDB as <code>byte[]</code></li>
<li>Returned to MarcoPolo as <code>&lt;&lt;7, 2&gt;&gt;</code></li>
</ul>
</li>
<li><strong>Boolean</strong>: <code>true</code> or <code>false</code>
<ul>
<li>Typed in OrientDB as <code>java.lang.Boolean</code></li>
<li>Returned to MarcoPolo as same value.</li>
</ul>
</li>
<li><strong>String</strong>: <code>"foo"</code> or <code>&lt;&lt;1, 2, 3&gt;&gt;</code>
<ul>
<li>Typed in OrientDB as <code>java.lang.String</code></li>
<li>Returned to MarcoPolo as the same value.</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="marcopolo---structs"><a class="header" href="#marcopolo---structs">MarcoPolo - Structs</a></h1>
<p>In addition to the Elixir type conversion as described in <a href="marcopolo/MarcoPolo-Types.html">Types</a>, MarcoPolo also provides a series of dedicated structs to use when working with OrientDB.</p>
<div class="table-wrapper"><table><thead><tr><th>Struct</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="marcopolo/MarcoPolo-BinaryRecord.html"><strong><code>MarcoPolo.BinaryRecord</code></strong></a></td><td>Defines binary data</td></tr>
<tr><td><a href="marcopolo/MarcoPolo-Date.html"><strong><code>MarcoPolo.Date</code></strong></a></td><td>Defines a date</td></tr>
<tr><td><a href="marcopolo/MarcoPolo-DateTime.html"><strong><code>MarcoPolo.DateTime</code></strong></a></td><td>Defines date and time</td></tr>
<tr><td><a href="marcopolo/MarcoPolo-Document.html"><strong><code>MarcoPolo.Document</code></strong></a></td><td>Defines an OrientDB Document</td></tr>
<tr><td><a href="marcopolo/MarcoPolo-FetchPlan.html"><strong><code>MarcoPolo.FetchPlan</code></strong></a></td><td>Provides functions for traversing records</td></tr>
<tr><td><a href="marcopolo/MarcoPolo-RID.html"><strong><code>MarcoPolo.RID</code></strong></a></td><td>Defines a <a href="marcopolo/../datamodeling/Concepts.html#record-id">Record ID</a></td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="marcopolo---binaryrecord"><a class="header" href="#marcopolo---binaryrecord">MarcoPolo - <code>BinaryRecord</code></a></h1>
<p>This struct represents binary data in your Elixir application.  It rends as an <code>ORecordBytes</code> class in OrientDB.</p>
<h2 id="working-with-binary-records"><a class="header" href="#working-with-binary-records">Working with Binary Records</a></h2>
<pre><code>%MarcoPolo.BinaryRecord{
	:rid &lt;record-id&gt;,
	:contents &lt;record-data&gt;,
	:version &lt;record-version&gt;}
</code></pre>
<ul>
<li><strong><code>&lt;record-id&gt;</code></strong> Defines the Record ID, an instance of <a href="marcopolo/MarcoPolo-RID.html">MarcoPolo.RID</a>.</li>
<li><strong><code>&lt;record-data&gt;</code></strong> Defines record data.</li>
<li><strong><code>&lt;record-version&gt;</code></strong> Defines the record version, a non-negative integer.</li>
</ul>
<h3 id="example-158"><a class="header" href="#example-158">Example</a></h3>
<p>In cases where you create binary records frequently with the same data, you might create a function to generate the struct from limited data.  For instance, say you have a web application where new blog entries are all created on the same cluster:</p>
<pre><code class="language-elixir">@doc """ Create binary record of blog entry """
def gen_blog(blog_data) do
	
	# Create and Return Binary Record
	%MarcoPolo.BinaryRecord{
		:rid MarcoPolo.RID(:cluster 14),
		:contents blog_data,
		:version 1}

end
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="marcopolo---date"><a class="header" href="#marcopolo---date">MarcoPolo - <code>Date</code></a></h1>
<p>This struct is defines date objects in your Elixir application.  It renders as a <code>java.util.Date</code> class in OrientDB.</p>
<h2 id="working-with-dates"><a class="header" href="#working-with-dates">Working with Dates</a></h2>
<pre><code>%MarcoPolo.Date{
	:year &lt;year&gt;,
	:month &lt;month&gt;,
	:day &lt;day&gt;}
</code></pre>
<ul>
<li><strong><code>&lt;year&gt;</code></strong> Defines the year in the date, a non-negative integer.  Defaults to 0.</li>
<li><strong><code>&lt;month&gt;</code></strong> Defines the month in the date, a non-negative integer between 1 and 12. Defaults to 1.</li>
<li><strong><code>&lt;day&gt;</code></strong> Defines the day in the date, a non-negative integer between 1 and 31.  Defaults to 1.</li>
</ul>
<h3 id="example-159"><a class="header" href="#example-159">Example</a></h3>
<p>For instance, imagine you have an application that logs quarterly reports in OrientDB.  You might create a function to automatically generate fixed date objects for each quarter of the fiscal year, which in the United States runs from October 1 to September 30.</p>
<pre><code class="language-elixir">@doc """ Generate Date for Fiscal Quarter """
def gen_date_quarter(quart, year) do

	# Determine Month of Fiscal Quarter
	case quart do
		1 -&gt; month = 10
		2 -&gt; month = 1
		3 -&gt; month = 4
		4 -&gt; month = 7
	end

	# Generate and Return Date
	%MarcoPolo.Date{
		:year year,
		:month month,
		:day 1}
end
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="marcopolo---datetime"><a class="header" href="#marcopolo---datetime">MarcoPolo - <code>DateTime</code></a></h1>
<p>This struct defines datetime objects in your Elixir application.  It renders as a <code>java.util.Date</code> class in OrientDB.</p>
<h2 id="working-with-datetimes"><a class="header" href="#working-with-datetimes">Working with DateTimes</a></h2>
<pre><code>%MarcoPolo.DateTime{
   :year &lt;year&gt;,
   :month &lt;month&gt;,
   :day &lt;day&gt;,
   :hour &lt;hour&gt;,
   :min &lt;minute&gt;,
   :sec &lt;sec&gt;,
   :msec &lt;msec&gt;}
</code></pre>
<ul>
<li><strong><code>&lt;year&gt;</code></strong> Defines the year in the date, a non-negative integer.  Defaults to 0.w</li>
<li><strong><code>&lt;month&gt;</code></strong> Defines the month in the date, a non-negative integer between 1 and 12.  Defaults to 1.</li>
<li><strong><code>&lt;day&gt;</code></strong> Defines the day in the date, a non-negative integer between 1 and 31.  Defaults to 1.</li>
<li><strong><code>&lt;hour&gt;</code></strong> Defines the hour in the time, a non-negative integer between 0 and 23.  Defaults to 0.</li>
<li><strong><code>&lt;minute&gt;</code></strong> Defines the minute of the time, a non-negative integer between 0 and 59. Defaults to 0.</li>
<li><strong><code>&lt;sec&gt;</code></strong> Defines the second of the time, a non-negative integer between 0 and 59.  Defaults to 0.</li>
<li><strong><code>&lt;msec&gt;</code></strong> Defines the microseconds of the time, a non-negative integer between 0 and 999.  Defaults to 0.</li>
</ul>
<h3 id="example-160"><a class="header" href="#example-160">Example</a></h3>
<p>Imagine a case where you run a particular operation at set times each day.  Rather than defining DateTime objects every time you need to timestamp this operation, you might want a function to set the relevant data for you:</p>
<pre><code class="language-elixir">@doc """ Generate Date for Fiscal Quarter """
def gen_datetime(year, month, day, count) do

	# Determine Month of Fiscal Quarter
	case count do
		1 -&gt; hour = 6
		2 -&gt; hour = 12
		3 -&gt; hour = 18
		4 -&gt; hour = 0
	end

	# Generate and Return Date
	%MarcoPolo.Date{
		:year year,
		:month month,
		:day day,
		:hour hour}
end
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="marcopolo---document"><a class="header" href="#marcopolo---document">MarcoPolo - <code>Document</code></a></h1>
<p>This struct defines a document for your Elixir application.  It renders as an <code>ODocument</code> class in OrientDB.</p>
<h2 id="working-with-documents-1"><a class="header" href="#working-with-documents-1">Working with Documents</a></h2>
<pre><code>%MarcoPolo.Document{
	:rid &lt;rid&gt;,
	:class &lt;class&gt;,
	:version &lt;version&gt;,
	:fields &lt;data&gt;}
</code></pre>
<ul>
<li><strong><code>&lt;rid&gt;</code></strong> Defines the Record ID.  It is an instance of <a href="marcopolo/MarcoPolo-RID.html">MarcoPolo.RID</a>.</li>
<li><strong><code>&lt;class&gt;</code></strong> Defines the record class.</li>
<li><strong><code>&lt;version&gt;</code></strong> Defines the record version.</li>
<li><strong><code>&lt;data&gt;</code></strong> Defines the record data.</li>
</ul>
<h3 id="example-161"><a class="header" href="#example-161">Example</a></h3>
<p>In cases where your application generates a series of very similar documents, you might create a function that populates default values:</p>
<pre><code class="language-elixir">@doc """ Generate Blog Document """
def gen_blogdoc(title, text) do

	%MarcoPolo.Document{
		:rid MarcoPolo.RID(:cluster 4),
		:class "BlogEntry",
		:version 1,
		:fields %{
			"title" =&gt; title
			"text" =&gt; text}}
end
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="marcopolo---fetchplan"><a class="header" href="#marcopolo---fetchplan">MarcoPolo - <code>FetchPlan</code></a></h1>
<p>This struct defines a <a href="marcopolo/../java/Fetching-Strategies.html">fetching strategy</a> for you to use queries.  It provides functions that you may find useful when traversing records.</p>
<h2 id="working-with-fetch-plans"><a class="header" href="#working-with-fetch-plans">Working with Fetch Plans</a></h2>
<p>Using the <code>FetchPlan</code> struct, you gain access to two additional functions: <code>resolve_links()</code> and <code>resolve_links!()</code>.  Each performs the same operation, however <code>resolve_links!()</code> raises an exception when it attempts to retrieve records that don't exist on the database.</p>
<h3 id="syntax-314"><a class="header" href="#syntax-314">Syntax</a></h3>
<pre><code># Resolve Links, ignore Exception if Record Not Found
resolve_links(&lt;rids&gt;, &lt;linked&gt;)

# Resolve Links, raise Exception if Record Not Found
resolve_links!(&lt;rids&gt;, &lt;linked&gt;)
</code></pre>
<ul>
<li><strong><code>&lt;rid&gt;</code></strong> Defines a set of Record ID's, as <a href="marcopolo/MarcoPolo-RID.html"><code>MarcoPolo.RID</code></a> instances.</li>
<li><strong><code>&lt;linked&gt;</code></strong> Defines the document the given records link to, as a <a href="marcopolo/MarcoPolo-Document.html"><code>MarcoPolo.Document</code></a> instance.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="marcopolo---rid"><a class="header" href="#marcopolo---rid">MarcoPolo - <code>RID</code></a></h1>
<p>This struct defines a Record ID for your Elixir application.  It renders as an <code>ORID</code> instance in OrientDB.</p>
<h2 id="working-with-record-ids"><a class="header" href="#working-with-record-ids">Working with Record ID's</a></h2>
<pre><code>%MarcoPolo.RIDr{
	:cluster_id &lt;cluster&gt;,
	:position &lt;position&gt;}
</code></pre>
<ul>
<li><strong><code>&lt;cluster&gt;</code></strong> Defines the cluster the record occurs in.</li>
<li><strong><code>&lt;position&gt;</code></strong> Defines the position of the record in the cluster.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="javascript"><a class="header" href="#javascript">Javascript</a></h1>
<p>OrientDB supports server-side scripting. All the <a href="http://en.wikipedia.org/wiki/List_of_JVM_languages">JVM languages</a> are supported. By default <a href="http://en.wikipedia.org/wiki/JavaScript">JavaScript</a> is installed.</p>
<p>Scripts can be executed on the client and on the server-side.  On the client-side, the user must have READ privilege against the <code>database.command</code> resource.  On the server-side, <a href="js/Javascript-Command.html#enable-server-side-scripting">the scripting interpreter</a> must be enabled.  It is disabled by default for security reasons.</p>
<p>In order to return the result of a variable, put the variable name as last statement. Example:</p>
<pre><code class="language-js">var r = db.query('select from ouser');
for( var i = 0; i &lt; r.length; ++ r ){
  print(r);
}
r
</code></pre>
<p>Will return the resultset.</p>
<h2 id="see-also-1"><a class="header" href="#see-also-1">See also</a></h2>
<ul>
<li><a href="js/../sql/SQL-batch.html">SQL-batch</a></li>
</ul>
<h2 id="usage-9"><a class="header" href="#usage-9">Usage</a></h2>
<h3 id="via-java-api-5"><a class="header" href="#via-java-api-5">Via Java API</a></h3>
<p>Executes a command like SQL but uses the class <code>OCommandScript</code> passing in the language to use. JavaScript is installed by default. Example:</p>
<pre><code class="language-java">db.command( new OCommandScript("Javascript", "print('hello world')") ).execute();
</code></pre>
<h2 id="via-console"><a class="header" href="#via-console">Via console</a></h2>
<p>JavaScript code can be executed on the client-side, the console, or server-side:</p>
<ul>
<li>Use <a href="js/../console/Console-Command-Js.html"><code>js</code></a> to execute the script on the <strong>client-side</strong> running it in the console</li>
<li>use <a href="js/../console/Console-Command-Jss.html"><code>jss</code></a> to execute the script on the <strong>server-side</strong>. This feature is disabled by default. To enable it look at <a href="js/Javascript-Command.html#enable-server-side-scripting">Enable Server side scripting</a>.</li>
</ul>
<p>Note: if you want to call a server-side Javascript function that was previously created in studio remember to add <code>commit()</code> after your insert or update operations. For example if you want to execute this function:</p>
<pre><code>var g = orient.getGraph();
g.command('sql', 'insert into Person(name) values ("Luca")');
g.commit();</code></pre>
<p>you can than use this command in console:
<code>select functionName()</code></p>
<p>Since the semi-colon <code>;</code> character is used in both console and JavaScript languages to separate statements, how can we execute multiple commands on the console and with JavaScript?</p>
<p>The OrientDB console uses a reserved keyword <code>end</code> to switch from JavaScript mode to console mode.</p>
<p>Example:</p>
<pre><code>orientdb&gt; connect remote:localhost/demo admin admin; js; for( i = 0; i &lt; 10; i++ ){ db.query('select from MapPoint') };end; exit
</code></pre>
<p>This line connects to the remote server and executes 10 queries on the console. The <code>end</code> command switches the mode back to the OrientDB console and then executes the console <code>exit</code> command.</p>
<p>Below is an example to display the results of a query on the server and on the client.</p>
<ol>
  <li>connects to the remote server as <code>admin</code></li>
  <li>executes a query and assigns the result to the variable <code>r</code>, then displays it server-side and returns it to be displayed on the client side too</li>
  <li>exits the console</li>
</ol>
<h3 id="interactive-mode-1"><a class="header" href="#interactive-mode-1">Interactive mode</a></h3>
<pre><code>$ ./console.sh
OrientDB console v.1.5 www.orientechnologies.com
Type 'help' to display all the commands supported.

orientdb&gt; connect remote:localhost/demo admin admin
Connecting to database [remote:localhost/demo] with user 'admin'...OK

orientdb&gt; jss;var r = db.query('select from ouser');print(r);r

---+---------+--------------------+--------------------+--------------------+--------------------
  #| RID     |name                |password            |status              |roles
---+---------+--------------------+--------------------+--------------------+--------------------
  0|     #4:0|admin               |{SHA-256}8C6976E5B5410415BDE908BD4DEE15DFB167A9C873FC4BB8A81F6F2AB448A918|ACTIVE              |[1]
  1|     #4:1|reader              |{SHA-256}3D0941964AA3EBDCB00CCEF58B1BB399F9F898465E9886D5AEC7F31090A0FB30|ACTIVE              |[1]
  2|     #4:2|writer              |{SHA-256}B93006774CBDD4B299389A03AC3D88C3A76B460D538795BC12718011A909FBA5|ACTIVE              |[1]
---+---------+--------------------+--------------------+--------------------+--------------------
Script executed in 0,073000 sec(s). Returned 3 records

orientdb&gt; exit
</code></pre>
<h3 id="batch-mode-1"><a class="header" href="#batch-mode-1">Batch mode</a></h3>
<p>The same example above is executed in batch mode:</p>
<pre><code class="language-java">$ ./console.sh "connect remote:localhost/demo admin admin;jss;var r = db.query('select from ouser');print(r);r;exit"
OrientDB console v.1.0-SNAPSHOT (build 11761) www.orientechnologies.com
Type 'help' to display all the commands supported.
Connecting to database [remote:localhost/demo] with user 'admin'...OK

---+---------+--------------------+--------------------+--------------------+--------------------
  #| RID     |name                |password            |status              |roles
---+---------+--------------------+--------------------+--------------------+--------------------
  0|     #4:0|admin               |{SHA-256}8C6976E5B5410415BDE908BD4DEE15DFB167A9C873FC4BB8A81F6F2AB448A918|ACTIVE              |[1]
  1|     #4:1|reader              |{SHA-256}3D0941964AA3EBDCB00CCEF58B1BB399F9F898465E9886D5AEC7F31090A0FB30|ACTIVE              |[1]
  2|     #4:2|writer              |{SHA-256}B93006774CBDD4B299389A03AC3D88C3A76B460D538795BC12718011A909FBA5|ACTIVE              |[1]
---+---------+--------------------+--------------------+--------------------+--------------------
Script executed in 0,099000 sec(s). Returned 3 records
</code></pre>
<h2 id="examples-of-usage"><a class="header" href="#examples-of-usage">Examples of usage</a></h2>
<h3 id="insert-1000-records"><a class="header" href="#insert-1000-records">Insert 1000 records</a></h3>
<pre><code class="language-xml">orientdb&gt; js;for( i = 0; i &lt; 1000; i++ ){ db.query( 'insert into jstest (label) values ("test'+i+'")' ); }
</code></pre>
<h3 id="create-documents-using-wrapped-java-api"><a class="header" href="#create-documents-using-wrapped-java-api">Create documents using wrapped Java API</a></h3>
<pre><code>orientdb&gt; js new com.orientechnologies.orient.core.record.impl.ODocument('Profile').field('name', 'Luca').save()

Client side script executed in 0,426000 sec(s). Value returned is: Profile#11:52{name:Luca} v3
</code></pre>
<h2 id="enable-server-side-scripting"><a class="header" href="#enable-server-side-scripting">Enable Server-side scripting</a></h2>
<p>For security reasons server-side scripting is disabled by default on the server. To enable it change the enable field to <code>true</code> in the <strong>orientdb-server-config.xml</strong> file under the <a href="js/Script-Interpreter-Plugin.html">Server Side Script Interpreter Plugin</a> component and set "Javascript" between the supported languages:</p>
<pre><code class="language-xml">&lt;!-- SERVER SIDE SCRIPT INTERPRETER. WARNING! THIS CAN BE A SECURITY HOLE: ENABLE IT ONLY IF CLIENTS ARE TRUSTED, TO TURN ON SET THE 'ENABLED' PARAMETER TO 'true' --&gt;
  &lt;handler class="com.orientechnologies.orient.server.handler.OServerSideScriptInterpreter"&gt;
    &lt;parameters&gt;
      &lt;parameter name="enabled" value="true" /&gt;
      &lt;parameter name="allowedLanguages" value="SQL,Javascript" /&gt;
    &lt;/parameters&gt;
  &lt;/handler&gt;
</code></pre>
<p>For more information look at <a href="js/Script-Interpreter-Plugin.html">Server Side Script Interpreter Plugin</a>.</p>
<p><em>NOTE: this will allow clients to execute any code inside the server. Enable it only if clients are trusted.</em></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="javascript-api"><a class="header" href="#javascript-api">Javascript API</a></h1>
<div class="table-wrapper"><table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td><img src="js/../images/warning.png" alt="" /></td><td>This API has been deprecated, please use HTTP calls from the browser by using the <a href="js/../misc/OrientDB-REST.html">HTTP RESTful protocol</a>.</td></tr>
</tbody></table>
</div>
<hr />
<p>This driver wraps the most common use cases in database usage. All parameters required by methods or constructor are Strings. This library works on top of <a href="js/../misc/OrientDB-REST.html">HTTP RESTful protocol</a>.</p>
<p><em>Note: Due to cross-domain XMLHttpRequest restriction this API works, for now, only placed in the server deployment. To use it with cross-site look at <a href="js/Javascript-Driver.html#cross-site-scripting">Cross-site scripting</a>.</em></p>
<p>The full source code is available here: <strong><a href="https://github.com/nuvolabase/orientdb/blob/master/server/src/site/js/orientdb-api.js">orientdb-api.js</a></strong>.</p>
<h2 id="see-also-2"><a class="header" href="#see-also-2">See also</a></h2>
<ul>
<li><a href="js/Javascript-Command.html">Javascript-Command</a></li>
</ul>
<h2 id="example-162"><a class="header" href="#example-162">Example</a></h2>
<pre><code class="language-javascript">var database = new ODatabase('http://localhost:2480/demo');
databaseInfo = database.open();
queryResult = database.query('select from Address where city.country.name = \'Italy\'');
if (queryResult["result"].length == 0){
  commandResult = database.executeCommand('insert into Address (street,type) values (\'Via test 1\',\'Tipo test\')');
} else {
  commandResult = database.executeCommand('update Address set street = \'Via test 1\' where city.country.name = \'Italy\'');
}
database.close();
</code></pre>
<h2 id="api"><a class="header" href="#api">API</a></h2>
<h3 id="odatabase-object"><a class="header" href="#odatabase-object">ODatabase object</a></h3>
<p>ODatabase object requires server URL and database name:</p>
<p>Syntax: <code>new ODatabase(http://<host>:<port>/<databaseName>)</code></p>
<p>Example:</p>
<pre><code class="language-javascript">var orientServer = new ODatabase('http://localhost:2480/demo');
</code></pre>
<p>Once created database instance is ready to be used. Every method return the operation result when it succeeded, null elsewhere. <br/>
In case of null result the database instance will have the error message obtainable by the <a href="js/Javascript-Driver.html#errors">getErrorMessage()</a> method.</p>
<h3 id="open"><a class="header" href="#open">Open</a></h3>
<p>Method that connects to the server, it returns database information in JSON format.<br/></p>
<h4 id="browser-authentication"><a class="header" href="#browser-authentication">Browser Authentication</a></h4>
<p>Syntax: <code>&lt;databaseInstance&gt;.open()</code><br/>
<em>Note: This implementation asks to the browser to provide user and password.</em></p>
<p>Example:</p>
<pre><code class="language-javascript">orientServer = new ODatabase('http://localhost:2480/demo');
databaseInfo = orientServer.open();
</code></pre>
<h4 id="javascript-authentication"><a class="header" href="#javascript-authentication">Javascript Authentication</a></h4>
<p>Syntax: <code>&lt;databaseInstance&gt;.open(username,userpassword)</code></p>
<p>Example:</p>
<pre><code class="language-javascript">orientServer = new ODatabase('http://localhost:2480/demo');
databaseInfo = orientServer.open('admin','admin');
</code></pre>
<p>Return Example:</p>
<pre><code class="language-json">{"classes": [
    {
      "id": 0,
      "name": "ORole",
      "clusters": [3],
      "defaultCluster": 3, "records": 3,
      "properties": [
        {
        "id": 0,
        "name": "mode",
        "type": "BYTE",
        "mandatory": false,
        "notNull": false,
        "min": null,
        "max": null,
        "indexed": false
      },
        {
        "id": 1,
        "name": "rules",
        "linkedType": "BYTE",
        "type": "EMBEDDEDMAP",
        "mandatory": false,
        "notNull": false,
        "min": null,
        "max": null,
        "indexed": false
      }
  ]},
],
"dataSegments": [
    {"id": -1, "name": "default", "size": 10485760, "filled": 1380391, "maxSize": "0", "files": "[${STORAGE_PATH}/default.0.oda]"}
  ],

"clusters": [
    {"id": 0, "name": "internal", "type": "PHYSICAL", "records": 4, "size": 1048576, "filled": 60, "maxSize": "0", "files": "[${STORAGE_PATH}/internal.0.ocl]"},
],

"txSegment": [
    {"totalLogs": 0, "size": 1000000, "filled": 0, "maxSize": "50mb", "file": "${STORAGE_PATH}/txlog.otx"}
  ], "users": [
    {"name": "admin", "roles": "[admin]"},
    {"name": "reader", "roles": "[reader]"},
    {"name": "writer", "roles": "[writer]"}
  ],

  "roles": [
    {"name": "admin", "mode": "ALLOW_ALL_BUT",
      "rules": []
    },
    {"name": "reader", "mode": "DENY_ALL_BUT",
      "rules": [{
        "name": "database", "create": false, "read": true, "update": false, "delete": false
        }, {
        "name": "database.cluster.internal", "create": false, "read": true, "update": false, "delete": false
        }, {
        "name": "database.cluster.orole", "create": false, "read": true, "update": false, "delete": false
        }, {
        "name": "database.cluster.ouser", "create": false, "read": true, "update": false, "delete": false
        }, {
        "name": "database.class.*", "create": false, "read": true, "update": false, "delete": false
        }, {
        "name": "database.cluster.*", "create": false, "read": true, "update": false, "delete": false
        }, {
        "name": "database.query", "create": false, "read": true, "update": false, "delete": false
        }, {
        "name": "database.command", "create": false, "read": true, "update": false, "delete": false
        }, {
        "name": "database.hook.record", "create": false, "read": true, "update": false, "delete": false
        }]
    },
],

  "config":{
    "values": [
      {"name": "dateFormat", "value": "yyyy-MM-dd"},
      {"name": "dateTimeFormat", "value": "yyyy-MM-dd hh:mm:ss"},
      {"name": "localeCountry", "value": ""},
      {"name": "localeLanguage", "value": "en"},
      {"name": "definitionVersion", "value": 0}
    ],
    "properties": [
    ]
  }
}
</code></pre>
<h3 id="query-3"><a class="header" href="#query-3">Query</a></h3>
<p>Method that executes the query, it returns query results in JSON format.</p>
<p>Syntax: <code>&lt;databaseInstance&gt;.query(&lt;queryText&gt;, [limit], [fetchPlan])</code></p>
<p>Limit and <a href="js/../java/Fetching-Strategies.html">fetchPlan</a> are optional.</p>
<p>Simple Example:</p>
<pre><code class="language-javascript">queryResult = orientServer.query('select from Address where city.country.name = \'Italy\'');
</code></pre>
<p>Return Example:</p>
<pre><code class="language-json">{ "result": [{
      "@rid": "12:0", "@class": "Address",
      "street": "Piazza Navona, 1",
      "type": "Residence",
      "city": "#13:0"
    }, {
      "@rid": "12:1", "@class": "Address",
      "street": "Piazza di Spagna, 111",
      "type": "Residence",
      "city": "#13:0"
    }
  ]
}
</code></pre>
<p>Fetched Example: fetching of all fields except "type"</p>
<pre><code class="language-javascript">queryResult = orientServer.query('select from Address where city.country.name = \'Italy\'',null,'*:-1 type:0');
</code></pre>
<p>Return Example 1:</p>
<pre><code class="language-json">{ "result": [{
      "@rid": "12:0", "@class": "Address",
      "street": "Piazza Navona, 1",
      "city":{
        "@rid": "13:0", "@class": "City",
        "name": "Rome",
        "country":{
          "@rid": "14:0", "@class": "Country",
          "name": "Italy"
        }
      }
    }, {
      "@rid": "12:1", "@version": 1, "@class": "Address",
      "street": "Piazza di Spagna, 111",
      "city":{
        "@rid": "13:0", "@class": "City",
        "name": "Rome",
        "country":{
          "@rid": "14:0", "@class": "Country",
          "name": "Italy"
        }
      }
    }
  ]
}
</code></pre>
<p>Fetched Example: fetching of all fields except "city" (Class)</p>
<pre><code class="language-javascript">queryResult = orientServer.query('select from Address where city.country.name = \'Italy\'',null,'*:-1 city:0');
</code></pre>
<p>Return Example 2:</p>
<pre><code class="language-json">{ "result": [{
       "@rid": "12:0", "@class": "Address",
       "street": "Piazza Navona, 1",
       "type": "Residence"
     }, {
       "@rid": "12:1", "@version": 1, "@class": "Address",
       "street": "Piazza di Spagna, 111",
       "type": "Residence"
    }
  ]
}
</code></pre>
<p>Fetched Example: fetching of all fields except "country" of City class</p>
<pre><code class="language-javascript">queryResult = orientServer.query('select from Address where city.country.name = \'Italy\'',null,'*:-1 City.country:0');
</code></pre>
<p>Return Example 3:</p>
<pre><code class="language-json">{ "result": [{
      "@rid": "12:0", "@class": "Address",
      "street": "Piazza Navona, 1",
      "type": "Residence",
      "city":{
          "@rid": "13:0", "@class": "City",
          "name": "Rome"
      }
    }
  ]
}
</code></pre>
<h3 id="execute-command"><a class="header" href="#execute-command">Execute Command</a></h3>
<p>Method that executes arbitrary commands, it returns command result in text format.</p>
<p>Syntax: <code>&lt;databaseInstance&gt;.executeCommand(&lt;commandText&gt;)</code></p>
<p>Example 1 (insert):</p>
<pre><code class="language-javascript">commandResult = orientServer.executeCommand('insert into Address (street,type) values (\'Via test 1\',\'Tipo test\')');
</code></pre>
<p>Return Example 1 (created record):</p>
<pre><code class="language-javascript">Address@14:177{street:Via test 1,type:Tipo test}
</code></pre>
<br/>
Example 2 (delete):
```javascript
commandResult = orientServer.executeCommand('delete from Address where street = \'Via test 1\' and type = \'Tipo test\'');
```
<p>Return Example 2 (records deleted):</p>
<pre><code class="language-json">{ "value" : 5 }
</code></pre>
<p><em>Note: Delete example works also with update command</em></p>
<h3 id="load"><a class="header" href="#load">Load</a></h3>
<p>Method that loads a record from the record ID, it returns the record informations in JSON format.</p>
<p>Syntax: `<databaseInstance>.load(<recordID>, [fetchPlan]);</p>
<p>Simple Example:</p>
<pre><code class="language-javascript">queryResult = orientServer.load('12:0');
</code></pre>
<p>Return Example:</p>
<pre><code class="language-json">{
"@rid": "12:0", "@class": "Address",
      "street": "Piazza Navona, 1",
      "type": "Residence",
      "city": "#13:0"
    }
</code></pre>
<p>Fetched Example: all fields fetched except "type"</p>
<pre><code class="language-javascript">queryResult = orientServer.load('12:0', '*:-1 type:0');
</code></pre>
<p>Return Example 1:</p>
<pre><code class="language-json">{
"@rid": "12:0", "@class": "Address",
      "street": "Piazza Navona, 1",
      "city":{
         "@rid": "13:0",
         "name": "Rome",
         "country":{
         "@rid": "14:0",
             "name": "Italy"
          }
      }
    }
</code></pre>
<h3 id="class-info"><a class="header" href="#class-info">Class Info</a></h3>
<p>Method that retrieves information of a class, it returns the class informations in JSON format.</p>
<p>Syntax: <code>&lt;databaseInstance&gt;.classInfo(&lt;className&gt;)</code></p>
<p>Example:</p>
<pre><code class="language-javascript">addressInfo = orientServer.classInfo('Address');
</code></pre>
<p>Return Example:</p>
<pre><code class="language-json">{ "result": [{
      "@rid": "14:0", "@class": "Address",
      "street": "WA 98073-9717",
      "type": "Headquarter",
      "city": "#12:1"
    }, {
      "@rid": "14:1", "@class": "Address",
      "street": "WA 98073-9717",
      "type": "Headquarter",
      "city": "#12:1"
    }
  ]
}
</code></pre>
<h3 id="browse-cluster"><a class="header" href="#browse-cluster">Browse Cluster</a></h3>
<p>Method that retrieves information of a cluster, it returns the class informations in JSON format.</p>
<p>Syntax: <code>&lt;databaseInstance&gt;.browseCluster(&lt;className&gt;)</code></p>
<p>Example:</p>
<pre><code class="language-javascript">addressInfo = orientServer.browseCluster('Address');
</code></pre>
<p>Return Example:</p>
<pre><code class="language-json">{ "result": [{
      "@rid": "14:0", "@class": "Address",
      "street": "WA 98073-9717",
      "type": "Headquarter",
      "city": "#12:1"
    }, {
      "@rid": "14:1", "@class": "Address",
      "street": "WA 98073-9717",
      "type": "Headquarter",
      "city": "#12:1"
    }
  ]
}
</code></pre>
<h3 id="server-information"><a class="header" href="#server-information">Server Information</a></h3>
<p>Method that retrieves server informations, it returns the server informations in JSON format.</p>
<blockquote>
<p><strong>Note</strong>: Server information needs the root username and password.  For more information, see <a href="js/../security/Server-Security.html">OrientDB Server Security</a>.</p>
</blockquote>
<p>Syntax: <code>&lt;databaseInstance&gt;.serverInfo()</code></p>
<p>Example:</p>
<pre><code class="language-javascript">serverInfo = orientServer.serverInfo();
</code></pre>
<p>Return Example:</p>
<pre><code class="language-json">{
  "connections": [{
    "id": "64",
    "id": "64",
    "remoteAddress": "127.0.0.1:51459",
    "db": "-",
    "user": "-",
    "protocol": "HTTP-DB",
    "totalRequests": "1",
    "commandInfo": "Server status",
    "commandDetail": "-",
    "lastCommandOn": "2010-12-23 12:53:38",
    "lastCommandInfo": "-",
    "lastCommandDetail": "-",
    "lastExecutionTime": "0",
    "totalWorkingTime": "0",
    "connectedOn": "2010-12-23 12:53:38"
    }],
  "dbs": [{
    "db": "demo",
    "user": "admin",
    "open": "open",
    "storage": "OStorageLocal"
    }],
  "storages": [{
    "name": "temp",
    "type": "OStorageMemory",
    "path": "",
    "activeUsers": "0"
    }, {
    "name": "demo",
    "type": "OStorageLocal",
    "path": "/home/molino/Projects/Orient/releases/0.9.25-SNAPSHOT/db/databases/demo",
    "activeUsers": "1"
    }],
    "properties": [
      {"name": "server.cache.staticResources", "value": "false"
      },
      {"name": "log.console.level", "value": "info"
      },
      {"name": "log.file.level", "value": "fine"
      }
    ]
}
</code></pre>
<h3 id="schema-5"><a class="header" href="#schema-5">Schema</a></h3>
<p>Method that retrieves database Schema, it returns an array of classes (JSON parsed Object).</p>
<p>Syntax: <code>&lt;databaseInstance&gt;.schema()</code></p>
<p>Example:</p>
<pre><code class="language-javascript">schemaInfo = orientServer.schema();
</code></pre>
<p>Return Example:</p>
<pre><code class="language-json">{"classes": [
    {
      "id": 0,
      "name": "ORole",
      "clusters": [3],
      "defaultCluster": 3, "records": 3,
      "properties": [
        {
        "id": 0,
        "name": "mode",
        "type": "BYTE",
        "mandatory": false,
        "notNull": false,
        "min": null,
        "max": null,
        "indexed": false
      },
        {
        "id": 1,
        "name": "rules",
        "linkedType": "BYTE",
        "type": "EMBEDDEDMAP",
        "mandatory": false,
        "notNull": false,
        "min": null,
        "max": null,
        "indexed": false
      }
  ]},
]
}
</code></pre>
<h3 id="getclass"><a class="header" href="#getclass">getClass()</a></h3>
<p>Return a schema class from the schema.</p>
<p>Syntax: <code>&lt;databaseInstance&gt;.getClass(&lt;className&gt;)</code></p>
<p>Example:</p>
<pre><code class="language-javascript">var customerClass = orientServer.getClass('Customer');
</code></pre>
<p>Return Example:</p>
<pre><code class="language-json">{
  "id": 0,
  "name": "Customer",
  "clusters": [3],
  "defaultCluster": 3, "records": 3,
  "properties": [
    {
      "id": 0,
      "name": "name",
      "type": "STRING",
    },
    {
      "id": 1,
      "name": "surname",
      "type": "STRING",
    }
  ]
}
</code></pre>
<h3 id="security-6"><a class="header" href="#security-6">Security</a></h3>
<h4 id="roles-5"><a class="header" href="#roles-5">Roles</a></h4>
<p>Method that retrieves database Security Roles, it returns an array of Roles (JSON parsed Object).</p>
<p>Syntax: <code>&lt;databaseInstance&gt;.securityRoles()</code></p>
<p>Example:</p>
<pre><code class="language-javascript">roles = orientServer.securityRoles();
</code></pre>
<p>Return Example:</p>
<pre><code class="language-json">{ "roles": [
    {"name": "admin", "mode": "ALLOW_ALL_BUT",
      "rules": []
    },
    {"name": "reader", "mode": "DENY_ALL_BUT",
      "rules": [{
        "name": "database", "create": false, "read": true, "update": false, "delete": false
        }, {
        "name": "database.cluster.internal", "create": false, "read": true, "update": false, "delete": false
        }, {
        "name": "database.cluster.orole", "create": false, "read": true, "update": false, "delete": false
        }, {
        "name": "database.cluster.ouser", "create": false, "read": true, "update": false, "delete": false
        }, {
        "name": "database.class.*", "create": false, "read": true, "update": false, "delete": false
        }, {
        "name": "database.cluster.*", "create": false, "read": true, "update": false, "delete": false
        }, {
        "name": "database.query", "create": false, "read": true, "update": false, "delete": false
        }, {
        "name": "database.command", "create": false, "read": true, "update": false, "delete": false
        }, {
        "name": "database.hook.record", "create": false, "read": true, "update": false, "delete": false
        }]
    }
  ]
}
</code></pre>
<h4 id="users"><a class="header" href="#users">Users</a></h4>
<p>Method that retrieves database Security Users, it returns an array of Users (JSON parsed Object).</p>
<p>Syntax: <code>&lt;databaseInstance&gt;.securityUsers()</code></p>
<p>Example:</p>
<pre><code class="language-javascript">users = orientServer.securityUsers();
</code></pre>
<p>Return Example:</p>
<pre><code class="language-json">{ "users": [
    {"name": "admin", "roles": "[admin]"},
    {"name": "reader", "roles": "[reader]"},
    {"name": "writer", "roles": "[writer]"}
  ]
}
</code></pre>
<h3 id="close"><a class="header" href="#close">close()</a></h3>
<p>Method that disconnects from the server.</p>
<p>Syntax: <code>&lt;databaseInstance&gt;.close()</code></p>
<p>Example:</p>
<pre><code class="language-javascript">orientServer.close();
</code></pre>
<h3 id="change-server-url"><a class="header" href="#change-server-url">Change server URL</a></h3>
<p>Method that changes server URL in the database instance.<br/>
You'll need to call the <a href="js/Javascript-Driver.html#open">open</a> method to reconnect to the new server.</p>
<p>Syntax: <code>&lt;databaseInstance&gt;.setDatabaseUrl(&lt;newDatabaseUrl&gt;)</code></p>
<p>Example:</p>
<pre><code class="language-javascript">orientServer.setDatabaseUrl('http://localhost:3040')
</code></pre>
<h3 id="change-database-name"><a class="header" href="#change-database-name">Change database name</a></h3>
<p>Method that changes database name in the database instance.<br/>
You'll need to call the <a href="js/Javascript-Driver.html#open">open</a> method to reconnect to the new database.</p>
<p>Syntax: <code>&lt;databaseInstance&gt;.setDatabaseName(&lt;newDatabaseName&gt;)</code></p>
<p>Example:</p>
<pre><code class="language-javascript">orientServer.setDatabaseName('demo2');
</code></pre>
<h3 id="setting-return-type"><a class="header" href="#setting-return-type">Setting return type</a></h3>
<p>This API allows you to chose the return type, Javascript Object or JSON plain text. Default return is Javascript Object.</p>
<p><strong>Important</strong>: the javascript object is not always the evaluation of JSON plain text: for each document (identified by its Record ID) the JSON file contains only one expanded object, all other references are just its Record ID as String, so the API will reconstruct the real structure by re-linking all references to the matching javascript object.</p>
<p>Syntax: <code>orientServer.setEvalResponse(&lt;boolean&gt;)</code></p>
<p>Examples:</p>
<pre><code class="language-javascript">orientServer.setEvalResponse(true);
</code></pre>
<p>Return types will be Javascript Objects.</p>
<pre><code class="language-javascript">orientServer.setEvalResponse(false);
</code></pre>
<p>Return types will be JSON plain text.</p>
<h3 id="cross-site-scripting"><a class="header" href="#cross-site-scripting">Cross-site scripting</a></h3>
<p>To invoke OrientDB cross-site you can use the <code>query</code> command in GET and the JSONP protocol. Example:</p>
<pre><code class="language-xml">&lt;script type="text/javascript" src='http://127.0.0.1:2480/query/database/sql/select+from+XXXX?jsoncallback=var datajson='&gt;&lt;/script&gt;
</code></pre>
<p>This will put the result of the query <em><strong><code>select from XXXX&lt;/code&gt;</strong></em> into the <em><strong>&lt;code&gt;datajson</code></strong></em> variable.</p>
<h3 id="errors"><a class="header" href="#errors">Errors</a></h3>
<p>In case of errors the error message will be stored inside the database instance, retrievable by getErrorMessage() method.</p>
<p>Syntax: <code>&lt;databaseInstance&gt;.getErrorMessage()</code></p>
<p>Example:</p>
<pre><code class="language-javascript">if (orientServer.getErrorMessage() != null){
       //write error message
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="http-protocol"><a class="header" href="#http-protocol">HTTP Protocol</a></h1>
<p>OrientDB RESTful HTTP protocol allows to talk with a <a href="misc/../internals/DB-Server.html">OrientDB Server instance</a> using the <a href="http://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol">HTTP protocol</a> and <a href="http://en.wikipedia.org/wiki/JSON">JSON</a>. OrientDB supports also a highly optimized <a href="misc/../internals/Network-Binary-Protocol.html">Binary protocol</a> for superior performances.</p>
<h2 id="available-commands"><a class="header" href="#available-commands">Available Commands</a></h2>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center"><a href="misc/OrientDB-REST.html#allocation">allocation</a><br>DB's defragmentation</th><th style="text-align: center"><a href="misc/OrientDB-REST.html#batch">batch</a><br>Batch of commands</th><th style="text-align: center"><a href="misc/OrientDB-REST.html#class">class</a><br>Operations on schema classes</th><th style="text-align: center"><strong><a href="misc/OrientDB-REST.html#cluster">cluster</a></strong><br>Operations on clusters</th></tr></thead><tbody>
<tr><td style="text-align: center"><strong><a href="misc/OrientDB-REST.html#command">command</a></strong><br>Executes commands</td><td style="text-align: center"><strong><a href="misc/OrientDB-REST.html#connect">connect</a></strong><br>Create the session</td><td style="text-align: center"><strong><a href="misc/OrientDB-REST.html#database">database</a></strong><br>Information about database</td><td style="text-align: center"><strong><a href="misc/OrientDB-REST.html#disconnect">disconnect</a></strong><br>Disconnect session</td></tr>
<tr><td style="text-align: center"><strong><a href="misc/OrientDB-REST.html#document">document</a></strong><br>Operations on documents by RID<br><a href="misc/OrientDB-REST.html#get---document">GET</a> - <a href="misc/OrientDB-REST.html#head---document">HEAD</a> - <a href="misc/OrientDB-REST.html#post---document">POST</a> - <a href="misc/OrientDB-REST.html#put---document">PUT</a> - <a href="misc/OrientDB-REST.html#delete---document">DELETE</a> - <a href="misc/OrientDB-REST.html#patch---document">PATCH</a></td><td style="text-align: center"><strong><a href="misc/OrientDB-REST.html#document-by-class">documentbyclass</a></strong><br>Operations on documents by Class</td><td style="text-align: center"><strong><a href="misc/OrientDB-REST.html#export">export</a></strong><br>Exports a database</td><td style="text-align: center"><strong><a href="misc/OrientDB-REST.html#function">function</a></strong><br>Executes a server-side function</td></tr>
<tr><td style="text-align: center"><strong><a href="misc/OrientDB-REST.html#index">index</a></strong><br>Operations on indexes</td><td style="text-align: center"><strong><a href="misc/OrientDB-REST.html#list-databases">listDatabases</a></strong><br>Available databases</td><td style="text-align: center"><strong><a href="misc/OrientDB-REST.html#property">property</a></strong><br>Operations on schema properties</td><td style="text-align: center"><strong><a href="misc/OrientDB-REST.html#query">query</a></strong><br>Query</td></tr>
<tr><td style="text-align: center"><strong><a href="misc/OrientDB-REST.html#server">server</a></strong><br>Information about the server</td><td style="text-align: center"></td><td style="text-align: center"></td><td style="text-align: center"></td></tr>
</tbody></table>
</div>
<h2 id="http-methods"><a class="header" href="#http-methods">HTTP Methods</a></h2>
<p>This protocol uses the four methods of the HTTP protocol:</p>
<ul>
<li><strong>GET</strong>, to retrieve values from the database. It's idempotent that means no changes to the database happen. Remember that in IE6 the URL can be maximum of 2,083 characters. Other browsers supports longer URLs, but if you want to stay compatible with all limit to 2,083 characters</li>
<li><strong>POST</strong>, to insert values into the database</li>
<li><strong>PUT</strong>, to change values into the database</li>
<li><strong>DELETE</strong>, to delete values from the database</li>
</ul>
<p>When using POST and PUT the following are important when preparing the contents of the post message:</p>
<ul>
<li>Always have the content type set to “application/json” or "application/xml"</li>
<li>Where data or data structure is involved the content is in JSON format</li>
<li>For OrientDB SQL or Gremlin the content itself is just text</li>
</ul>
<h2 id="headers"><a class="header" href="#headers">Headers</a></h2>
<p>All the requests must have these 2 headers:</p>
<pre><code>'Accept-Encoding': 'gzip,deflate'
'Content-Length': &lt;content-length&gt;
</code></pre>
<p>Where the <code>&lt;content-length&gt;</code> is the length of the request's body.</p>
<h2 id="syntax-315"><a class="header" href="#syntax-315">Syntax</a></h2>
<p>The REST API is very flexible, with the following features:</p>
<ul>
<li>Data returned is in JSON format</li>
<li>JSONP callback is supported</li>
<li>Support for http and https connections</li>
<li>The API itself is case insensitive</li>
<li>API can just be used as a wrapper to retrieve (and control) data through requests written in OrientDB SQL or Gremlin</li>
<li>You can avoid using <code>#</code> for RecordIDs in URLs, if you prefer. Just drop the <code>#</code> from the URL and it will still work</li>
</ul>
<hr />
<p>The REST syntax used is the same for all the four HTTP methods:</p>
<p>Syntax: <code>http://&lt;server&gt;:&lt;port&gt;/&lt;command&gt;/[&lt;database&gt;/&lt;arguments&gt;]</code></p>
<p>Results are always in <a href="http://en.wikipedia.org/wiki/JSON">JSON</a> format. Support for 'document' object types is through the use of the attribute <code>@type : 'd'</code>. This also applies when using inner document objects.
Example:</p>
<pre><code class="language-json">{
  "@type"  : "d",
  "Name"   : "Test",
  "Data"   : { "@type": "d",
               "value": 0 },
  "@class" : "SimpleEntity"
}
</code></pre>
<p><a href="http://en.wikipedia.org/wiki/JSONP">JSONP</a> is also supported by adding a <em>callback</em> parameter to the request (containing the callback function name).</p>
<p>Syntax: <code>http://&lt;server&gt;:&lt;port&gt;/&lt;command&gt;/[&lt;database&gt;/&lt;arguments&gt;]?callback=&lt;callbackFunctionName&gt;</code></p>
<p>Commands are divided in two main categories:</p>
<ul>
<li>Server commands, such as to know server statistics and to create a new database</li>
<li>Database commands, all the commands against a database</li>
</ul>
<h2 id="authentication-and-security"><a class="header" href="#authentication-and-security">Authentication and security</a></h2>
<p>All the commands (but the <a href="misc/OrientDB-REST.html#disconnect">Disconnect</a> need a valid authentication before to get executed. The OrientDB Server checks if the Authorization HTTP header is present, otherwise answers with a request of authentication (HTTP error code: 401).</p>
<p>The HTTP client (or the Internet Browser) must send user and password using the HTTP Base authentication. Password is encoded using Base64 algorithm. Please note that if you want to encrypt the password using a safe mode take in consideration to use SSL connections.</p>
<p>Server commands use the realm "OrientDB Server", while the database commands use a realm per database in this form: <code>"OrientDB db-&lt;database&gt;"</code>, where <code>&lt;database&gt;</code> is the database name. In this way the Browser/HTTP client can reuse user and password inserted multiple times until the session expires or the "Disconnect" is called.</p>
<p>On first call (or when the session is expired and a new authentication is required), OrientDB returns the OSESSIONID parameter in response's HTTP header. On further calls the client should pass this OSESSIONID header in the requests and OrientDB will skip the authentication because a session is alive. By default sessions expire after 300 seconds (5 minutes), but you can change this configuration by setting the global setting: <code>network.http.sessionExpireTimeout</code></p>
<h2 id="json-data-type-handling-and-schema-less-mode"><a class="header" href="#json-data-type-handling-and-schema-less-mode">JSON data type handling and Schema-less mode</a></h2>
<p>Since OrientDB supports also schema-less/hybrid modes how to manage types? JSON doesn't support all the types OrientDB has, so how can I pass the right type when it's not defined in the schema?</p>
<p>The answer is using the special field <strong>"@fieldTypes"</strong> as string containing all the field types separated by comma. Example:</p>
<pre><code class="language-json">{ "@class":"Account", "date": 1350426789, "amount": 100.34,
  "@fieldTypes": "date=t,amount=c" }
</code></pre>
<p>The supported special types are:</p>
<ul>
<li>'f' for float</li>
<li>'c' for decimal</li>
<li>'l' for long</li>
<li>'d' for double</li>
<li>'b' for byte and binary</li>
<li>'a' for date</li>
<li>'t' for datetime</li>
<li>'s' for short</li>
<li>'e' for Set, because arrays and List are serialized as arrays like [3,4,5]</li>
<li>'x' for links</li>
<li>'n' for linksets</li>
<li>'z' for linklist</li>
<li>'m' for linkmap</li>
<li>'g' for linkbag</li>
<li>'u' for custom</li>
</ul>
<h2 id="keep-alive"><a class="header" href="#keep-alive">Keep-Alive</a></h2>
<p><em>Attention</em>: OrientDB HTTP API utilizes <a href="http://en.wikipedia.org/wiki/HTTP_persistent_connection">Keep-Alive</a> feature for better performance: the TCP/IP socket is kept open avoiding the creation of a new one for each command. If you need to re-authenticate, open a new connection avoiding to reuse the already open one. To force closing put "Connection: close" in the request header.</p>
<h1 id="http-commands"><a class="header" href="#http-commands">HTTP commands</a></h1>
<h2 id="connect"><a class="header" href="#connect">Connect</a></h2>
<h3 id="get---connect"><a class="header" href="#get---connect">GET - Connect</a></h3>
<p>Connect to a remote server using basic authentication.</p>
<p>Syntax: <code>http://&lt;server&gt;:[&lt;port&gt;]/connect/&lt;database&gt;</code></p>
<h4 id="example-163"><a class="header" href="#example-163">Example</a></h4>
<p>HTTP GET request: <code>http://localhost:2480/connect/demo</code>
HTTP response: 204 if ok, otherwise 401.</p>
<h2 id="database-2"><a class="header" href="#database-2">Database</a></h2>
<h3 id="get---database"><a class="header" href="#get---database">GET - Database</a></h3>
<p>HTTP GET request: <code>http://localhost:2480/database/demo</code>
HTTP response:</p>
<pre><code class="language-json">{
  "server": {
    "version": "1.1.0-SNAPSHOT",
    "osName": "Windows 7",
    "osVersion": "6.1",
    "osArch": "amd64",
    "javaVendor": "Oracle Corporation",
    "javaVersion": "23.0-b21"
  }, "classes": [],
  ...
}
</code></pre>
<h3 id="post---database"><a class="header" href="#post---database">POST - Database</a></h3>
<p>Create a new database.</p>
<p>Syntax: <code>http://&lt;server&gt;:[&lt;port&gt;]/database/&lt;database&gt;/&lt;type&gt;</code></p>
<p>HTTP POST request: <code>http://localhost:2480/database/demo/plocal</code></p>
<p>HTTP response: <code>{ "classes" : [], "clusters": [], "users": [], "roles": [], "config":[], "properties":{} }</code></p>
<h2 id="class-3"><a class="header" href="#class-3">Class</a></h2>
<h3 id="get---class"><a class="header" href="#get---class">GET - Class</a></h3>
<p>Gets informations about requested class.</p>
<p>Syntax: <code>http://&lt;server&gt;:[&lt;port&gt;]/class/&lt;database&gt;/&lt;class-name&gt;</code></p>
<p>HTTP response:</p>
<pre><code class="language-json">{ "class": {
    "name": "&lt;class-name&gt;"
    "properties": [
      { "name": &lt;property-name&gt;,
        "type": &lt;property-type&gt;,
        "mandatory": &lt;mandatory&gt;,
        "notNull": &lt;not-null&gt;,
        "min": &lt;min&gt;,
        "max": &lt;max&gt;
      }
    ]
  }
}
</code></pre>
<p>For more information about properties look at the <a href="misc/../general/Types.html">supported types</a>, or see the <a href="misc/../sql/SQL-Create-Property.html">SQL Create property</a> page for text values to be used when getting or posting class commands</p>
<h4 id="example-164"><a class="header" href="#example-164">Example</a></h4>
<p>HTTP GET request: <code>http://localhost:2480/class/demo/OFunction</code>
HTTP response:</p>
<pre><code class="language-json">{
  "name": "OFunction",
  "superClass": "",
  "alias": null,
  "abstract": false,
  "strictmode": false,
  "clusters": [
    7
  ],
  "defaultCluster": 7,
  "records": 0,
  "properties": [
    {
      "name": "language",
      "type": "STRING",
      "mandatory": false,
      "readonly": false,
      "notNull": false,
      "min": null,
      "max": null,
      "collate": "default"
    },
    {
      "name": "name",
      "type": "STRING",
      "mandatory": false,
      "readonly": false,
      "notNull": false,
      "min": null,
      "max": null,
      "collate": "default"
    },
    {
      "name": "idempotent",
      "type": "BOOLEAN",
      "mandatory": false,
      "readonly": false,
      "notNull": false,
      "min": null,
      "max": null,
      "collate": "default"
    },
    {
      "name": "code",
      "type": "STRING",
      "mandatory": false,
      "readonly": false,
      "notNull": false,
      "min": null,
      "max": null,
      "collate": "default"
    },
    {
      "name": "parameters",
      "linkedType": "STRING",
      "type": "EMBEDDEDLIST",
      "mandatory": false,
      "readonly": false,
      "notNull": false,
      "min": null,
      "max": null,
      "collate": "default"
    }
  ]
}
</code></pre>
<h3 id="post---class"><a class="header" href="#post---class">POST - Class</a></h3>
<p>Create a new class where the schema of the vertexes or edges is known. OrientDB allows (encourages) classes to be derived from other class definitions – this is achieved by using the <a href="misc/OrientDB-REST.html#post---command">COMMAND</a> call with an OrientDB SQL command.
Returns the id of the new class created.</p>
<p>Syntax: <code>http://&lt;server&gt;:[&lt;port&gt;]/class/&lt;database&gt;/&lt;class-name&gt;</code></p>
<p>HTTP POST request: <code>http://localhost:2480/class/demo/Address2</code>
HTTP response: <code>9</code></p>
<h2 id="property"><a class="header" href="#property">Property</a></h2>
<h3 id="post---property"><a class="header" href="#post---property">POST - Property</a></h3>
<p>Create one or more properties into a given class. Returns the number of properties of the class.</p>
<h4 id="single-property-creation"><a class="header" href="#single-property-creation">Single property creation</a></h4>
<p>Syntax: <code>http://&lt;server&gt;:[&lt;port&gt;]/property/&lt;database&gt;/&lt;class-name&gt;/&lt;property-name&gt;/[&lt;property-type&gt;]</code></p>
<p>Creates a property named <code>&lt;property-name&gt;</code> in <code>&lt;class-name&gt;</code>. If <code>&lt;property-type&gt;</code> is not specified the property will be created as STRING.</p>
<h4 id="multiple-property-creation"><a class="header" href="#multiple-property-creation">Multiple property creation</a></h4>
<p>Syntax: <code>http://&lt;server&gt;:[&lt;port&gt;]/property/&lt;database&gt;/&lt;class-name&gt;/</code></p>
<p><em>Requires a JSON document post request content</em>:</p>
<pre><code class="language-json">{
  "fieldName": {
      "propertyType": "&lt;property-type&gt;"
  },
  "fieldName": {
      "propertyType": "LINK",
      "linkedClass": "&lt;linked-class&gt;"
  },
  "fieldName": {
      "propertyType": "&lt;LINKMAP|LINKLIST|LINKSET&gt;",
      "linkedClass": "&lt;linked-class&gt;"
  },
  "fieldName": {
      "propertyType": "&lt;LINKMAP|LINKLIST|LINKSET&gt;",
      "linkedType": "&lt;linked-type&gt;"
  }
}
</code></pre>
<h4 id="example-165"><a class="header" href="#example-165">Example</a></h4>
<p><em>Single property</em>:</p>
<p>String Property Example:
HTTP POST request: <code>http://localhost:2480/class/demo/simpleField</code>
HTTP response: <code>1</code></p>
<p>Type Property Example:
HTTP POST request: <code>http://localhost:2480/class/demo/dateField/DATE</code>
HTTP response: <code>1</code></p>
<p>Link Property Example:
HTTP POST request: <code>http://localhost:2480/class/demo/linkField/LINK/Person</code>
HTTP response: <code>1</code></p>
<p><em>Multiple properties</em>:
HTTP POST request: <code>http://localhost:2480/class/demo/</code>
HTTP POST content:</p>
<pre><code class="language-json">{
  "name": {
      "propertyType": "STRING"
  },
  "father": {
      "propertyType": "LINK",
      "linkedClass": "Person"
  },
  "addresses": {
      "propertyType": "LINKMAP",
      "linkedClass": "Address"
  },
  "examsRatings": {
      "propertyType": "LINKMAP",
      "linkedType": "INTEGER"
  }
  "events": {
      "propertyType": "LINKLIST",
      "linkedType": "DATE"
  }
  "family": {
      "propertyType": "LINKLIST",
      "linkedClass": "Person"
  }
...
</code></pre>
<p>HTTP response: <code>6</code></p>
<h2 id="cluster-1"><a class="header" href="#cluster-1">Cluster</a></h2>
<h3 id="get---cluster"><a class="header" href="#get---cluster">GET - Cluster</a></h3>
<p>Where the primary usage is a document db, or where the developer wants to optimise retrieval using the clustering of the database, use the CLUSTER command to browse the records of the requested cluster.</p>
<p>Syntax: <code>http://&lt;server&gt;:[&lt;port&gt;]/cluster/&lt;database&gt;/&lt;cluster-name&gt;/</code></p>
<p>Where <code>&lt;limit&gt;</code> is optional and tells the maximum of records to load. Default is 20.</p>
<h4 id="example-166"><a class="header" href="#example-166">Example</a></h4>
<p>HTTP GET request: <code>http://localhost:2480/cluster/demo/Address</code></p>
<p>HTTP response:</p>
<pre><code class="language-json">{ "schema": {
    "id": 5,
    "name": "Address"
  },
  "result": [{
      "_id": "11:0",
      "_ver": 0,
      "@class": "Address",
      "type": "Residence",
      "street": "Piazza Navona, 1",
      "city": "12:0"
    }
...
</code></pre>
<h2 id="command-3"><a class="header" href="#command-3">Command</a></h2>
<h3 id="post---command"><a class="header" href="#post---command">POST - Command</a></h3>
<p>Execute a command against the database. Returns the records affected or the list of records for queries. Command executed via POST can be non-idempotent (look at <a href="misc/OrientDB-REST.html#query">Query</a>).</p>
<p>Syntax: <code>http://&lt;server&gt;:[&lt;port&gt;]/command/&lt;database&gt;/&lt;language&gt;[/&lt;command-text&gt;[/limit[/&lt;fetchPlan&gt;]]]</code></p>
<p>The content can be <code>&lt;command-text&gt;</code> or starting from v2.2 a json containing the command and parameters:</p>
<ul>
<li>by parameter name: <code>{"command":&lt;command-text&gt;, "parameters":{"&lt;param-name&gt;":&lt;param-value&gt;} }</code></li>
<li>by parameter position: <code>{"command":&lt;command-text&gt;, "parameters":[&lt;param-value&gt;] }</code></li>
</ul>
<p>Where:</p>
<ul>
<li><em><code>&lt;language&gt;</code></em> is the name of the language between those supported. OrientDB distribution comes with "sql" and GraphDB distribution has both "sql" and "gremlin"</li>
<li><em><code>command-text</code></em> is the text containing the command to execute</li>
<li><em><code>limit</code></em> is the maximum number of record to return. Optional, default is 20</li>
<li><em><code>fetchPlan</code></em> is the fetching strategy to use. For more information look at <a href="misc/../java/Fetching-Strategies.html">Fetching Strategies</a>. Optional, default is *:1 (1 depth level only)</li>
</ul>
<p>The <em>command-text</em> can appear in either the URL or the content of the POST transmission. Where the command-text is included in the URL, it must be encoded as per normal URL encoding. By default the result is returned in JSON. To have the result in CSV, pass "Accept: text/csv" in HTTP Request.</p>
<p>Starting from v2.2, the HTTP payload can be a JSON with both command to execute and parameters. Example:</p>
<p>Execute a query passing parameters by name:</p>
<pre><code class="language-json">{
  "command": "select from V where name = :name and city = :city",
  "parameters": {
    "name": "Luca",
    "city": "Rome"
  }
}
</code></pre>
<p>Execute a query passing parameters by position:</p>
<pre><code class="language-json">{
  "command": "select from V where name = ? and city = ?",
  "parameters": [ "Luca", "Rome" ]
}
</code></pre>
<p>Read the <a href="misc/../sql/README.html">SQL section</a> or the <a href="misc/../gremlin/Gremlin.html">Gremlin introduction</a> for the type of commands.</p>
<h4 id="example-167"><a class="header" href="#example-167">Example</a></h4>
<p>HTTP POST request: <code>http://localhost:2480/command/demo/sql</code>
content: <code>update Profile set online = false</code></p>
<p>HTTP response: <code>10</code></p>
<p>Or the same:</p>
<p>HTTP POST request: <code>http://localhost:2480/command/demo/sql/update Profile set online = false</code></p>
<p>HTTP response: <code>10</code></p>
<h5 id="extract-the-user-list-in-csv-format-using-curl"><a class="header" href="#extract-the-user-list-in-csv-format-using-curl">Extract the user list in CSV format using curl</a></h5>
<pre><code>curl --user admin:admin --header "Accept: text/csv" -d "select from ouser" "http://localhost:2480/command/GratefulDeadConcerts/sql"
</code></pre>
<h2 id="batch"><a class="header" href="#batch">Batch</a></h2>
<h3 id="post---batch"><a class="header" href="#post---batch">POST - Batch</a></h3>
<p>Executes a batch of operations in a single call. This is useful to reduce network latency issuing multiple commands as multiple requests. Batch command supports transactions as well.</p>
<p>Syntax: <code>http://&lt;server&gt;:[&lt;port&gt;]/batch/&lt;database&gt;</code></p>
<p>Content: { "transaction" : &lt;true|false&gt;, "operations" : [ { "type" : "<type>" }* ] }</p>
<p>Returns: the result of last operation.</p>
<p>Where:
<em>type</em> can be:</p>
<ul>
<li>'c' for create, 'record' field is expected.</li>
<li>'u' for update, 'record' field is expected.</li>
<li>'d' for delete. The '@rid' field only is needed.</li>
<li>'cmd' for commands (Since v1.6). The expected fields are:</li>
<li>'language', between those supported (sql, gremlin, script, etc.)</li>
<li>'command' as the text of the command to execute</li>
<li>'script' for scripts (Since v1.6). The expected fields are:</li>
<li>'language', between the language installed in the JVM. Javascript is the default one, but you can also use SQL (see below)</li>
<li>'script' as the text of the script to execute</li>
</ul>
<h4 id="example-168"><a class="header" href="#example-168">Example</a></h4>
<pre><code class="language-json">{ "transaction" : true,
  "operations" : [
    { "type" : "u",
      "record" : {
        "@rid" : "#14:122",
        "name" : "Luca",
        "vehicle" : "Car"
      }
    }, {
      "type" : "d",
      "record" : {
        "@rid" : "#14:100"
      }
    }, {
      "type" : "c",
      "record" : {
        "@class" : "City",
        "name" : "Venice"
      }
    }, {
      "type" : "cmd",
      "language" : "sql",
      "command" : "create edge Friend from #10:33 to #11:33"
    }, {
      "type" : "script",
      "language" : "javascript",
      "script" : "orient.getGraph().createVertex('class:Account')"
    }
  ]
}
</code></pre>
<h4 id="sql-batch-2"><a class="header" href="#sql-batch-2">SQL batch</a></h4>
<p>Execute a POST against /batch URL by sending a payload in this format:</p>
<p>Syntax:</p>
<pre><code class="language-json">{ "transaction" : false,
  "operations" : [
    {
      "type" : "script",
      "language" : "sql",
      "script" : &lt;text&gt;
    }
  ]
}
</code></pre>
<p>Example:</p>
<pre><code class="language-json">{ "transaction" : false,
  "operations" : [
    {
      "type" : "script",
      "language" : "sql",
      "script" : [ "BEGIN;let account = CREATE VERTEX Account SET name = 'Luke';let city =SELECT FROM City WHERE name = 'London';CREATE EDGE Lives FROM $account TO $city;COMMIT RETRY 100" ]
    }
  ]
}
</code></pre>
<p>To separate commands use semicolon (;). Starting from release 1.7 the "script" property can be an array of strings to put each command on separate item, example:</p>
<pre><code class="language-json">{ "transaction" : true,
  "operations" : [
    {
      "type" : "script",
      "language" : "sql",
      "script" : [ "LET account = CREATE VERTEX Account SET name = 'Luke'",
                   "LET city = SELECT FROM City WHERE name = 'London'",
                   "CREATE EDGE Lives FROM $account TO $city RETRY 100" ]
    }
  ]
}
</code></pre>
<h2 id="function"><a class="header" href="#function">Function</a></h2>
<h3 id="post-and-get---function"><a class="header" href="#post-and-get---function">POST and GET - Function</a></h3>
<p>Executes a server-side function against the database. Returns the result of the function that can be a string or a JSON containing the document(s) returned.</p>
<p>The difference between GET and POST method calls are if the function has been declared as idempotent. In this case can be called also by GET, otherwise only POST is accepted.</p>
<p>Syntax: <code>http://&lt;server&gt;:[&lt;port&gt;]/function/&lt;database&gt;/&lt;name&gt;[/&lt;argument&gt;*]&lt;server&gt;</code></p>
<p>Where</p>
<ul>
<li><em><code>&lt;name&gt;</code></em> is the name of the function</li>
<li><em><code>&lt;argument&gt;</code></em>, optional, are the arguments to pass to the function. They are passed by position.</li>
</ul>
<p>Creation of functions, when not using the Java API, can be done through the Studio in either Orient DB SQL or Java – see the <a href="misc/../admin/Functions.html">OrientDB Functions page</a>.</p>
<h4 id="example-169"><a class="header" href="#example-169">Example</a></h4>
<p>HTTP POST request: <code>http://localhost:2480/function/demo/sum/3/5</code></p>
<p>HTTP response: <code>8.0</code></p>
<h2 id="database-3"><a class="header" href="#database-3">Database</a></h2>
<h3 id="get---database-1"><a class="header" href="#get---database-1">GET - Database</a></h3>
<p>Retrieve all the information about a database.</p>
<p>Syntax: <code>http://&lt;server&gt;:[&lt;port&gt;]/database/&lt;database&gt;</code></p>
<h4 id="example-170"><a class="header" href="#example-170">Example</a></h4>
<p>HTTP GET request: <code>http://localhost:2480/database/demo</code></p>
<p>HTTP response:</p>
<pre><code class="language-json">{"classes": [
  {
    "id": 0,
    "name": "ORole",
    "clusters": [3],
    "defaultCluster": 3, "records": 0},
  {
    "id": 1,
    "name": "OUser",
    "clusters": [4],
    "defaultCluster": 4, "records": 0},
  {
...
</code></pre>
<h3 id="post---database-1"><a class="header" href="#post---database-1">POST - Database</a></h3>
<p>Create a new database. Requires additional authentication to the server.</p>
<p>Syntax for the url `http://<server>:</p>
<ul>
<li><em>storage</em> can be</li>
<li>'plocal' for disk-based database</li>
<li>'memory' for in memory only database.</li>
<li><em>type</em>, is optional, and can be document or graph. By default is a document.</li>
</ul>
<h4 id="example-171"><a class="header" href="#example-171">Example</a></h4>
<p>HTTP POST request: <code>http://localhost:2480/database/demo2/local</code>
HTTP response:</p>
<pre><code class="language-json">{ "classes": [
  {
    "id": 0,
    "name": "ORole",
    "clusters": [3],
    "defaultCluster": 3, "records": 0},
  {
    "id": 1,
    "name": "OUser",
    "clusters": [4],
    "defaultCluster": 4, "records": 0},
  {
...
</code></pre>
<h3 id="delete---database"><a class="header" href="#delete---database">DELETE - Database</a></h3>
<p>Drop a database. Requires additional authentication to the server.</p>
<p>Syntax: <code>http://&lt;server&gt;:[&lt;port&gt;]/database/&lt;databaseName&gt;</code></p>
<p>Where:</p>
<ul>
<li><strong>databaseName</strong> is the name of database</li>
</ul>
<h4 id="example-172"><a class="header" href="#example-172">Example</a></h4>
<p>HTTP DELETE request: <code>http://localhost:2480/database/demo2</code>
HTTP response code 204</p>
<h2 id="export"><a class="header" href="#export">Export</a></h2>
<h3 id="get---export"><a class="header" href="#get---export">GET - Export</a></h3>
<p>Exports a gzip file that contains the database JSON export.</p>
<p>Syntax: http://<server>:[<port>]/export/<database></p>
<p>HTTP GET request: <code>http://localhost:2480/export/demo2</code>
HTTP response: demo2.gzip file</p>
<h2 id="import"><a class="header" href="#import">Import</a></h2>
<h3 id="post---import"><a class="header" href="#post---import">POST - Import</a></h3>
<p>Imports a database from an uploaded JSON text file.</p>
<p>Syntax: <code>http://&lt;server&gt;:[&lt;port&gt;]/import/&lt;database&gt;</code></p>
<p>The body of the HTTP call has to be the JSON of an exported DB (plain text).
Multipart is not supported.</p>
<p><strong>Important</strong>: Connect required: the connection with the selected database must be already established</p>
<h4 id="example-173"><a class="header" href="#example-173">Example</a></h4>
<p>HTTP POST request: <code>http://localhost:2480/import/</code>
HTTP response: returns a JSON object containing the result text
<em>Success</em>:</p>
<pre><code class="language-json">{
  "responseText": "Database imported correctly"
}
</code></pre>
<p>_Fail::</p>
<pre><code class="language-json">{
  "responseText": "Error message"
}
</code></pre>
<a name="disconnect"/>
<h2 id="list-databases-1"><a class="header" href="#list-databases-1">List Databases</a></h2>
<h3 id="get---list-databases"><a class="header" href="#get---list-databases">GET - List Databases</a></h3>
<p>Retrieves the available databases.</p>
<p>Syntax: <code>http://&lt;server&gt;:&lt;port&gt;/listDatabases</code></p>
<p>To let to the Studio to display the database list by default the permission to list the database is assigned to guest. Remove this permission if you don't want anonymous user can display it.</p>
<p>For more details see <a href="misc/../security/Server-Security.html#server-resources">Server Resources</a></p>
<p>Example of configuration of "guest" server user:
a15b5e6bb7d06bd5d6c35db97e51400b</p>
<h4 id="example-174"><a class="header" href="#example-174">Example</a></h4>
<p>HTTP GET request: <code>http://localhost:2480/listDatabases</code>
HTTP response:</p>
<pre><code class="language-json">{
  "@type": "d", "@version": 0,
    "databases": ["demo", "temp"]
      }
</code></pre>
<h2 id="disconnect"><a class="header" href="#disconnect">Disconnect</a></h2>
<h3 id="get---disconnect"><a class="header" href="#get---disconnect">GET - Disconnect</a></h3>
<p>Syntax: <code>http://&lt;server&gt;:[&lt;port&gt;]/disconnect</code></p>
<h4 id="example-175"><a class="header" href="#example-175">Example</a></h4>
<p>HTTP GET request: <code>http://localhost:2480/disconnect</code>
HTTP response: empty.</p>
<h2 id="document-1"><a class="header" href="#document-1">Document</a></h2>
<h3 id="get---document"><a class="header" href="#get---document">GET - Document</a></h3>
<p>This is a key way to retrieve data from the database, especially when combined with a <code>&lt;fetchplan&gt;</code>. Where a single result is required then the RID can be used to retrieve that single document.</p>
<p>Syntax: <code>http://&lt;server&gt;:[&lt;port&gt;]/document/&lt;database&gt;/&lt;record-id&gt;[/&lt;fetchPlan&gt;]</code></p>
<p>Where:</p>
<ul>
<li><code>&lt;record-id&gt;</code> <a href="misc/../datamodeling/Concepts.html#record-id">See Concepts: RecordID</a></li>
<li><code>&lt;fetchPlan&gt;</code> Optional, is the fetch plan used. 0 means the root record, -1 infinite depth, positive numbers is the depth level. Look at <a href="misc/../java/Fetching-Strategies.html">Fetching Strategies</a> for more information.</li>
</ul>
<h4 id="example-176"><a class="header" href="#example-176">Example</a></h4>
<p>HTTP GET request: <code>http://localhost:2480/document/demo/9:0</code></p>
<p>HTTP response can be:</p>
<ul>
<li>HTTP Code 200, with the document in JSON format in the payload, such as:</li>
</ul>
<pre><code class="language-json">{
  "_id": "9:0",
  "_ver": 2,
  "@class": "Profile",
  "nick": "GGaribaldi",
  "followings": [],
  "followers": [],
  "name": "Giuseppe",
  "surname": "Garibaldi",
  "location": "11:0",
  "invitedBy": null,
  "sex": "male",
  "online": true
}
</code></pre>
<ul>
<li>HTTP Code 404, if the document was not found</li>
</ul>
<p>The example above can be extended to return all the edges and vertices beneath #9:0</p>
<p>HTTP GET request: <code>http://localhost:2480/document/demo/9:0/*:-1</code></p>
<h3 id="head---document"><a class="header" href="#head---document">HEAD - Document</a></h3>
<p>Check if a document exists</p>
<p>Syntax: <code>http://&lt;server&gt;:[&lt;port&gt;]/document/&lt;database&gt;/&lt;record-id&gt;</code></p>
<p>Where:</p>
<ul>
<li><code>&lt;record-id&gt;</code> <a href="misc/../datamodeling/Concepts.html#record-id">See Concepts: RecordID</a></li>
</ul>
<h4 id="example-177"><a class="header" href="#example-177">Example</a></h4>
<p>HTTP HEAD request: <code>http://localhost:2480/document/demo/9:0</code></p>
<p>HTTP response can be:</p>
<ul>
<li>HTTP Code 204, if the document exists</li>
<li>HTTP Code 404, if the document was not found</li>
</ul>
<h3 id="post---document"><a class="header" href="#post---document">POST - Document</a></h3>
<p>Create a new document. Returns the document with the new @rid assigned. Before 1.4.x the return was the @rid content only.</p>
<p>Syntax: <code>http://&lt;server&gt;:[&lt;port&gt;]/document/&lt;database&gt;</code></p>
<h4 id="example-178"><a class="header" href="#example-178">Example</a></h4>
<p>HTTP POST request: <code>http://localhost:2480/document/demo</code></p>
<pre><code class="language-json">  content:
  {
    "@class": "Profile",
    "nick": "GGaribaldi",
    "followings": [],
    "followers": [],
    "name": "Giuseppe",
    "surname": "Garibaldi",
    "location": "11:0",
    "invitedBy": null,
    "sex": "male",
    "online": true
  }
</code></pre>
<p>HTTP response, as the document created with the assigned <a href="misc/../datamodeling/Concepts.html#record-id">RecordID</a> as @rid:</p>
<pre><code>{
  "@rid": "#11:4456",
  "@class": "Profile",
  "nick": "GGaribaldi",
  "followings": [],
  "followers": [],
  "name": "Giuseppe",
  "surname": "Garibaldi",
  "location": "11:0",
  "invitedBy": null,
  "sex": "male",
  "online": true
}
</code></pre>
<h3 id="put---document"><a class="header" href="#put---document">PUT - Document</a></h3>
<p>Update a document. Remember to always pass the version to update. This prevent to update documents changed by other users (MVCC).</p>
<p>Syntax: <code>http://&lt;server&gt;:[&lt;port&gt;]/document/&lt;database&gt;[/&lt;record-id&gt;][?updateMode=full|partial]</code>
Where:</p>
<ul>
<li><strong>updateMode</strong> can be <strong>full</strong> (default) or <strong>partial</strong>. With partial mode only the delta of changes is sent, otherwise the entire document is replaced (full mode)</li>
</ul>
<h4 id="example-179"><a class="header" href="#example-179">Example</a></h4>
<p>HTTP PUT request: <code>http://localhost:2480/document/demo/9:0</code></p>
<pre><code class="language-json">content:
{
  "@class": "Profile",
  "@version": 3,
  "nick": "GGaribaldi",
  "followings": [],
  "followers": [],
  "name": "Giuseppe",
  "online": true
}
</code></pre>
<p>HTTP response, as the updated document with the updated @version field (Since v1.6):</p>
<pre><code class="language-json">content:
{
  "@class": "Profile",
  "@version": 4,
  "nick": "GGaribaldi",
  "followings": [],
  "followers": [],
  "name": "Giuseppe",
  "online": true
}
</code></pre>
<h3 id="patch---document"><a class="header" href="#patch---document">PATCH - Document</a></h3>
<p>Update a document with only the difference to apply. Remember to always pass the version to update. This prevent to update documents changed by other users (MVCC).</p>
<p>Syntax: <code>http://&lt;server&gt;:[&lt;port&gt;]/document/&lt;database&gt;[/&lt;record-id&gt;]</code>
Where:</p>
<h4 id="example-180"><a class="header" href="#example-180">Example</a></h4>
<p>This is the document 9:0 before to apply the patch:</p>
<pre><code class="language-json">{
  "@class": "Profile",
  "@version": 4,
  "name": "Jay",
  "amount": 10000
}
</code></pre>
<p>HTTP PATCH request: <code>http://localhost:2480/document/demo/9:0</code></p>
<pre><code class="language-json">content:
{
  "@class": "Profile",
  "@version": 4,
  "amount": 20000
}
</code></pre>
<p>HTTP response, as the updated document with the updated @version field (Since v1.6):</p>
<pre><code class="language-json">content:
{
  "@class": "Profile",
  "@version": 5,
  "name": "Jay",
  "amount": 20000
}
</code></pre>
<h3 id="delete---document"><a class="header" href="#delete---document">DELETE - Document</a></h3>
<p>Delete a document.</p>
<p>Syntax: <code>http://&lt;server&gt;:[&lt;port&gt;]/document/&lt;database&gt;/&lt;record-id&gt;</code></p>
<h4 id="example-181"><a class="header" href="#example-181">Example</a></h4>
<p>HTTP DELETE request: <code>http://localhost:2480/document/demo/9:0</code></p>
<p>HTTP response: empty</p>
<h2 id="document-by-class"><a class="header" href="#document-by-class">Document By Class</a></h2>
<h3 id="get-document-by-class"><a class="header" href="#get-document-by-class">GET Document by Class</a></h3>
<p>Retrieve a document by cluster name and record position.</p>
<p>Syntax: <code>http://&lt;server&gt;:[&lt;port&gt;]/documentbyclass/&lt;database&gt;/&lt;class-name&gt;/&lt;record-position&gt;[/fetchPlan]</code></p>
<p>Where:</p>
<ul>
<li><code>&lt;class-name&gt;</code> is the name of the document's class</li>
<li><code>&lt;record-position&gt;</code> is the absolute position of the record inside the class' default cluster</li>
<li><code>&lt;fetchPlan&gt;</code> Optional, is the fetch plan used. 0 means the root record, -1 infinite depth, positive numbers is the depth level. Look at <a href="misc/../java/Fetching-Strategies.html">Fetching Strategies</a> for more information.</li>
</ul>
<h4 id="example-182"><a class="header" href="#example-182">Example</a></h4>
<p>HTTP GET request: <code>http://localhost:2480/documentbyclass/demo/Profile/0</code></p>
<p>HTTP response:</p>
<pre><code class="language-json">{
  "_id": "9:0",
  "_ver": 2,
  "@class": "Profile",
  "nick": "GGaribaldi",
  "followings": [],
  "followers": [],
  "name": "Giuseppe",
  "surname": "Garibaldi",
  "location": "11:0",
  "invitedBy": null,
  "sex": "male",
  "online": true
}
</code></pre>
<h3 id="head---document-by-class"><a class="header" href="#head---document-by-class">HEAD - Document by Class</a></h3>
<p>Check if a document exists</p>
<p>Syntax: <code>http://&lt;server&gt;:[&lt;port&gt;]/documentbyclass/&lt;database&gt;/&lt;class-name&gt;/&lt;record-position&gt;</code></p>
<p>Where:</p>
<ul>
<li><code>&lt;class-name&gt;</code> is the name of the document's class</li>
<li><code>&lt;record-position&gt;</code> is the absolute position of the record inside the class' default cluster</li>
</ul>
<h4 id="example-183"><a class="header" href="#example-183">Example</a></h4>
<p>HTTP HEAD request: <code>http://localhost:2480/documentbyclass/demo/Profile/0</code></p>
<p>HTTP response can be:</p>
<ul>
<li>HTTP Code 204, if the document exists</li>
<li>HTTP Code 404, if the document was not found</li>
</ul>
<h2 id="allocation"><a class="header" href="#allocation">Allocation</a></h2>
<h3 id="get---allocation"><a class="header" href="#get---allocation">GET - Allocation</a></h3>
<p>Retrieve information about the storage space of a disk-based database.</p>
<p>Syntax: <code>http://&lt;server&gt;:[&lt;port&gt;]/allocation/&lt;database&gt;</code></p>
<h4 id="example-184"><a class="header" href="#example-184">Example</a></h4>
<p>HTTP GET request: <code>http://localhost:2480/allocation/demo</code></p>
<p>HTTP response:
<code>{   "size": 61910,   "segments": [     {"type": "d", "offset": 0, "size": 33154},     {"type": "h", "offset": 33154, "size": 4859},     {"type": "h", "offset": 3420, "size": 9392},     {"type": "d", "offset": 12812, "size": 49098}   ],   "dataSize": 47659,   "dataSizePercent": 76,   "holesSize": 14251,   "holesSizePercent": 24 }</code></p>
<h2 id="index-1"><a class="header" href="#index-1">Index</a></h2>
<p><em>NOTE: Every single new database has the default manual index called "dictionary".</em></p>
<h3 id="get---index"><a class="header" href="#get---index">GET - Index</a></h3>
<p>Retrieve a record looking into the index.</p>
<p>Syntax: <code>http://&lt;server&gt;:[&lt;port&gt;]/index/&lt;database&gt;/&lt;index-name&gt;/&lt;key&gt;</code></p>
<h4 id="example-185"><a class="header" href="#example-185">Example</a></h4>
<p>HTTP GET request: <code>http://localhost:2480/index/demo/dictionary/test</code>
HTTP response:</p>
<pre><code class="language-json">{
  "name" : "Jay",
  "surname" : "Miner"
}
</code></pre>
<h3 id="put---index"><a class="header" href="#put---index">PUT - Index</a></h3>
<p>Create or modify an index entry.</p>
<p>Syntax: <code>http://&lt;server&gt;:[&lt;port&gt;]/index/&lt;database&gt;/&lt;index-name&gt;/&lt;key&gt;</code></p>
<h4 id="example-186"><a class="header" href="#example-186">Example</a></h4>
<p>HTTP PUT request: <code>http://localhost:2480/index/demo/dictionary/test</code>
content:
<code>{   "name" : "Jay",   "surname" : "Miner" }</code></p>
<p>HTTP response: No response.</p>
<h3 id="delete---index"><a class="header" href="#delete---index">DELETE - Index</a></h3>
<p>Remove an index entry.</p>
<p>Syntax: <code>http://&lt;server&gt;:[&lt;port&gt;]/index/&lt;database&gt;/&lt;index-name&gt;/&lt;key&gt;</code></p>
<h4 id="example-187"><a class="header" href="#example-187">Example</a></h4>
<p>HTTP DELETE request: <code>http://localhost:2480/index/demo/dictionary/test</code>
HTTP response: No response.</p>
<h2 id="query-4"><a class="header" href="#query-4">Query</a></h2>
<h3 id="get---query"><a class="header" href="#get---query">GET - Query</a></h3>
<p>Execute a query against the database. Query means only idempotent commands like SQL SELECT and TRAVERSE. Idempotent means the command is read-only and can't change the database. Remember that in IE6 the URL can be maximum of 2,083 characters. Other browsers supports longer URLs, but if you want to stay compatible with all limit to 2,083 characters.</p>
<p>Syntax: <code>http://&lt;server&gt;:[&lt;port&gt;]/query/&lt;database&gt;/&lt;language&gt;/&lt;query-text&gt;[/&lt;limit&gt;][/&lt;fetchPlan&gt;]</code></p>
<p>Where:</p>
<ul>
<li><em><code>&lt;language&gt;</code></em> is the name of the language between those supported. OrientDB distribution comes with "sql" only. Gremlin language cannot be executed with <strong>query</strong> because it cannot guarantee to be idempotent. To execute Gremlin use <a href="misc/OrientDB-REST.html#command">command</a> instead.</li>
<li><em><code>query-text</code></em> is the text containing the query to execute</li>
<li><em><code>limit</code></em> is the maximum number of record to return. Optional, default is 20</li>
<li><em><code>fetchPlan</code></em> is the fetching strategy to use. For more information look at <a href="misc/../java/Fetching-Strategies.html">Fetching Strategies</a>. Optional, default is *:1 (1 depth level only)</li>
</ul>
<p>Other key points:</p>
<ul>
<li>To use commands that change the database (non-idempotent), see the <a href="misc/OrientDB-REST.html#post---command">POST – Command section</a></li>
<li>The command-text included in the URL must be encoded as per a normal URL</li>
<li>See the <a href="misc/../sql/README.html">SQL section</a> for the type of queries that can be sent</li>
</ul>
<h4 id="example-188"><a class="header" href="#example-188">Example</a></h4>
<p>HTTP GET request: <code>http://localhost:2480/query/demo/sql/select from Profile</code></p>
<p>HTTP response:</p>
<pre><code class="language-json">{ "result": [
{
  "_id": "-3:1",
  "_ver": 0,
  "@class": "Address",
  "type": "Residence",
  "street": "Piazza di Spagna",
  "city": "-4:0"
},
{
  "_id": "-3:2",
  "_ver": 0,
  "@class": "Address",
  "type": "Residence",
  "street": "test",
  "city": "-4:1"
}] }
</code></pre>
<p>The same query with the limit to maximum 20 results using the fetch plan *:-1 that means load all recursively:</p>
<p>HTTP GET request: <code>http://localhost:2480/query/demo/sql/select from Profile/20/*:-1</code></p>
<h2 id="server-1"><a class="header" href="#server-1">Server</a></h2>
<h3 id="get---server"><a class="header" href="#get---server">GET - Server</a></h3>
<p>Retrieve information about the connected OrientDB Server. Requires additional authentication to the server.</p>
<p>Syntax: <code>http://&lt;server&gt;:[&lt;port&gt;]/server</code></p>
<h4 id="example-189"><a class="header" href="#example-189">Example</a></h4>
<p>HTTP GET request: <code>http://localhost:2480/server</code>
HTTP response:</p>
<pre><code class="language-json">{
  "connections": [{
    "id": "4",
    "id": "4",
    "remoteAddress": "0:0:0:0:0:0:0:1:52504",
    "db": "-",
    "user": "-",
    "protocol": "HTTP-DB",
    "totalRequests": "1",
    "commandInfo": "Server status",
    "commandDetail": "-",
    "lastCommandOn": "2010-05-26 05:08:58",
    "lastCommandInfo": "-",
    "lastCommandDetail": "-",
    "lastExecutionTime": "0",
    "totalWorkingTime": "0",
...
</code></pre>
<h3 id="post---server"><a class="header" href="#post---server">POST - Server</a></h3>
<p>Changes server configuration. Supported configuration are:</p>
<ul>
<li>any setting contained in OGlobalConfiguation class, by using the prefix <code>configuration</code> in setting-name</li>
<li>logging level, by using the prefix <code>log</code> in setting-name</li>
</ul>
<p>Syntax: <code>http://&lt;server&gt;:[&lt;port&gt;]/server/&lt;setting-name&gt;/&lt;setting-value&gt;</code></p>
<h4 id="example-190"><a class="header" href="#example-190">Example</a></h4>
<h3 id="example-on-changing-the-server-log-level-to-finest"><a class="header" href="#example-on-changing-the-server-log-level-to-finest">Example on changing the server log level to FINEST</a></h3>
<pre><code>localhost:2480/server/log.console/FINEST
</code></pre>
<h3 id="example-on-changing-the-default-timeout-for-query-to-10-seconds"><a class="header" href="#example-on-changing-the-default-timeout-for-query-to-10-seconds">Example on changing the default timeout for query to 10 seconds</a></h3>
<pre><code>localhost:2480/server/configuration.command.timeout/10000
</code></pre>
<h2 id="connection"><a class="header" href="#connection">Connection</a></h2>
<h3 id="post---connection"><a class="header" href="#post---connection">POST - Connection</a></h3>
<p>Syntax: <code>http://&lt;server&gt;:[&lt;port&gt;]/connection/&lt;command&gt;/&lt;id&gt;</code></p>
<p>Where:</p>
<ul>
<li><strong>command</strong> can be:</li>
<li><strong>kill</strong> to kill a connection</li>
<li><strong>interrupt</strong> to interrupt the operation (if possible)</li>
<li><strong>id</strong>, as the connection id. To know all the connections use GET /connection/[&lt;db&gt;]</li>
</ul>
<p>You've to execute this command authenticated in the OrientDB Server realm (no database realm), so get the root password from config/orientdb-server-config.xml file (last section).</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="gremlin-api"><a class="header" href="#gremlin-api">Gremlin API</a></h1>
<p><a href="http://gremlindocs.com">Gremlin</a> is a language specialized to work with <a href="https://github.com/tinkerpop/gremlin/wiki/Defining-a-Property-Graph">Property Graphs</a>. <a href="http://gremlindocs.com">Gremlin</a> is part of <a href="http://www.tinkerpop.com">TinkerPop</a> Open Source products. For more information:</p>
<ul>
<li><a href="http://gremlindocs.com">Gremlin Documentation</a></li>
<li><a href="https://github.com/tinkerpop/gremlin/wiki">Gremlin WiKi</a></li>
<li><a href="https://github.com/tinkerpop/blueprints/wiki/OrientDB-Implementation">OrientDB adapter to use it inside Gremlin</a></li>
<li><a href="gremlin/../java/Graph-Database-Tinkerpop.html">OrientDB implementation of TinkerPop Blueprints</a></li>
</ul>
<p>To know more about <a href="http://gremlindocs.com">Gremlin</a> and <a href="http://www.tinkerpop.com">TinkerPop</a>'s products subscribe to the <a href="http://groups.google.com/forum/#!forum/gremlin-users">Gremlin Group</a>.</p>
<h1 id="get-started"><a class="header" href="#get-started">Get Started</a></h1>
<p>Launch the <strong>gremlin.sh</strong> (or gremlin.bat on Windows OS) console script located in the <strong>bin</strong> directory:</p>
<pre><code class="language-java">&gt; gremlin.bat

         \,,,/
         (o o)
-----oOOo-(_)-oOOo-----
</code></pre>
<h1 id="open-the-graph-database-1"><a class="header" href="#open-the-graph-database-1">Open the graph database</a></h1>
<p>Before playing with <a href="http://gremlindocs.com">Gremlin</a> you need a valid <strong><a href="gremlin/../java/Graph-Database-Tinkerpop.html">OrientGraph</a></strong> instance that points to an OrientDB database. To know all the database types look at <a href="gremlin/../datamodeling/Concepts.html#database-url">Storage types</a>.</p>
<p>When you're working with a local or an in-memory database, if the database does not exist it's created for you automatically. Using the remote connection you need to create the database on the target server before using it. This is due to security restrictions.</p>
<p>Once created the <strong><a href="gremlin/../java/Graph-Database-Tinkerpop.html">OrientGraph</a></strong> instance with a proper URL is necessary to assign it to a variable. <a href="http://gremlindocs.com">Gremlin</a> is written in Groovy, so it supports all the Groovy syntax, and both can be mixed to create very powerful scripts!</p>
<p>Example with a local database (see below for more information about it):</p>
<pre><code class="language-java">gremlin&gt; g = org.apache.tinkerpop.gremlin.orientdb.OrientGraph.open("plocal:/home/gremlin/db/demo");
==&gt;orientgraph[plocal:/home/gremlin/db/demo]
</code></pre>
<p>Some useful links:</p>
<ul>
<li><a href="https://github.com/tinkerpop/gremlin/wiki/Gremlin-Methods">All Gremlin methods</a></li>
<li><a href="https://github.com/tinkerpop/gremlin/wiki/Gremlin-Steps">All available steps</a></li>
</ul>
<h2 id="working-with-local-database-2"><a class="header" href="#working-with-local-database-2">Working with local database</a></h2>
<p>This is the most often used mode. The console opens and locks the database for exclusive use. This doesn't require starting an OrientDB server.</p>
<pre><code class="language-java">gremlin&gt; graph = org.apache.tinkerpop.gremlin.orientdb.OrientGraph.open("plocal:/home/gremlin/db/demo");
==&gt;orientgraph[plocal:/home/gremlin/db/demo]
</code></pre>
<h2 id="working-with-a-remote-database-1"><a class="header" href="#working-with-a-remote-database-1">Working with a remote database</a></h2>
<p>To open a database on a remote server be sure the server is up and running first. To start the server just launch <strong>server.sh</strong> (or server.bat on Windows OS) script. For more information look at <a href="gremlin/../internals/DB-Server.html">OrientDB Server</a></p>
<pre><code class="language-java">gremlin&gt; graph = org.apache.tinkerpop.gremlin.orientdb.OrientGraph.open("remote:localhost/demo");
==&gt;orientgraph[remote:localhost/demo]
</code></pre>
<h2 id="working-with-in-memory-database-2"><a class="header" href="#working-with-in-memory-database-2">Working with in-memory database</a></h2>
<p>In this mode the database is volatile and all the changes will be not persistent. Use this in a clustered configuration (the database life is assured by the cluster itself) or just for test.</p>
<pre><code class="language-java">gremlin&gt; graph = org.apache.tinkerpop.gremlin.orientdb.OrientGraph.open("memory:demo");
==&gt;orientgraph[memory:demo]
</code></pre>
<h2 id="use-security-1"><a class="header" href="#use-security-1">Use security</a></h2>
<p>OrientDB supports security by creating multiple users and roles associated with certain privileges. To know more look at <a href="gremlin/../security/Security.html">Security</a>. To open the graph database with a different user than the default, pass the user and password as additional parameters:</p>
<pre><code class="language-java">gremlin&gt; graph = org.apache.tinkerpop.gremlin.orientdb.OrientGraph.open("memory:demo", "reader", "reader");
==&gt;orientgraph[memory:demo]
</code></pre>
<h1 id="create-a-new-vertex-1"><a class="header" href="#create-a-new-vertex-1">Create a new Vertex</a></h1>
<p>To create a new vertex, use the <strong>addVertex()</strong> method. The vertex will be created and a unique id will be displayed as the return value.</p>
<pre><code class="language-java">graph.addVertex();
==&gt;v[#5:0]
</code></pre>
<h1 id="create-an-edge-1"><a class="header" href="#create-an-edge-1">Create an edge</a></h1>
<p>To create a new edge between two vertices, use the <strong>addEdge(v1, v2, label)</strong> method. The edge will be created with the label specified.</p>
<p>In the example below two vertices are created and assigned to a variable (Gremlin is based on Groovy), then an edge is created between them.</p>
<pre><code class="language-java">gremlin&gt; v1 = graph.addVertex();
==&gt;v[#5:0]

gremlin&gt; v2 = graph.addVertex();
==&gt;v[#5:1]

gremlin&gt; e = graph.addEdge(v1, v2, 'friend');
==&gt;e[#6:0][#5:0-friend-&gt;#5:1]
</code></pre>
<h1 id="retrieve-a-vertex-1"><a class="header" href="#retrieve-a-vertex-1">Retrieve a vertex</a></h1>
<p>To retrieve a vertex by its ID, use the <strong>v(id)</strong> method passing the <a href="gremlin/../datamodeling/Concepts.html#record-id">RecordId</a> as an argument (with or without the prefix '#'). This example retrieves the first vertex created in the above example.</p>
<pre><code class="language-java">gremlin&gt; g = graph.traversal()
gremlin&gt; g.V('5:0')
==&gt;v[#5:0]
</code></pre>
<h2 id="get-all-the-vertices-1"><a class="header" href="#get-all-the-vertices-1">Get all the vertices</a></h2>
<p>To retrieve all the vertices in the opened graph use <strong>.V</strong> (V in upper-case):</p>
<pre><code class="language-java">gremlin&gt; g.V()
==&gt;v[#5:0]
==&gt;v[#5:1]
</code></pre>
<h1 id="retrieve-an-edge-1"><a class="header" href="#retrieve-an-edge-1">Retrieve an edge</a></h1>
<p>Retrieving an edge is very similar to retrieving a vertex.  Use the <em>e(id)</em> method passing the <a href="gremlin/../datamodeling/Concepts.html#record-id">RecordId</a> as an argument (with or without the prefix '#'). This example retrieves the first edge created in the previous example.</p>
<pre><code class="language-java">gremlin&gt; g.e('6:0')
==&gt;e[#6:0][#5:0-friend-&gt;#5:1]
</code></pre>
<h2 id="get-all-the-edges-1"><a class="header" href="#get-all-the-edges-1">Get all the edges</a></h2>
<p>To retrieve all the edges in the opened graph use <strong>.E</strong> (E in upper-case):</p>
<pre><code class="language-java">gremlin&gt; g.E()
==&gt;e[#6:0][#5:0-friend-&gt;#5:1]
</code></pre>
<h1 id="traversal-1"><a class="header" href="#traversal-1">Traversal</a></h1>
<p>The power of Gremlin is in traversal. Once you have a graph loaded in your database you can traverse it in many different ways.</p>
<h2 id="basic-traversal-1"><a class="header" href="#basic-traversal-1">Basic Traversal</a></h2>
<p>To display all the outgoing edges of the first vertex just created append the <strong>.outE</strong> at the vertex. Example:</p>
<pre><code class="language-java">gremlin&gt; v1.outE()
==&gt;e[#6:0][#5:0-friend-&gt;#5:1]
</code></pre>
<p>To display all the incoming edges of the second vertex created in the previous examples append the <strong>.inE</strong> at the vertex. Example:</p>
<pre><code class="language-java">gremlin&gt; v2.inE()
==&gt;e[#6:0][#5:0-friend-&gt;#5:1]
</code></pre>
<p>In this case the edge is the same because it's the outgoing edge of 5:0 and the incoming edge of 5:1.</p>
<p>For more information look at the <a href="https://github.com/tinkerpop/gremlin/wiki/Basic-Graph-Traversals">Basic Traversal with Gremlin</a>.</p>
<h2 id="filter-results-1"><a class="header" href="#filter-results-1">Filter results</a></h2>
<p>This example returns all the outgoing edges of all the vertices with label equal to 'friend'.</p>
<pre><code class="language-java">gremlin&gt; g.V().outE('friend')
==&gt;e[#6:0][#5:0-friend-&gt;#5:1]
</code></pre>
<h1 id="close-the-database-1"><a class="header" href="#close-the-database-1">Close the database</a></h1>
<p>To close a graph use the <strong>shutdown()</strong> method:</p>
<pre><code class="language-java">gremlin&gt; g.shutdown()
==&gt;null
</code></pre>
<p>This is not strictly necessary because OrientDB always closes the database when the <a href="http://gremlindocs.com">Gremlin</a> console quits.</p>
<h1 id="create-complex-paths-1"><a class="header" href="#create-complex-paths-1">Create complex paths</a></h1>
<p><a href="http://gremlindocs.com">Gremlin</a> allows you to concatenate expressions to create more complex traversals in a single line:</p>
<pre><code class="language-java">v1.outE().inV()
</code></pre>
<p>Of course this could be much more complex. Below is an example with the graph taken from the official documentation:</p>
<pre><code class="language-java">// calculate basic collaborative filtering for vertex 1
m = [:]
g.v(1).out('likes').in('likes').out('likes').groupCount(m)
m.sort{a,b -&gt; a.value &lt;=&gt; b.value}

// calculate the primary eigenvector (eigenvector centrality) of a graph
m = [:]; c = 0;
g.V.out.groupCount(m).loop(2){c++ &lt; 1000}
m.sort{a,b -&gt; a.value &lt;=&gt; b.value}
</code></pre>
<h1 id="passing-input-parameters"><a class="header" href="#passing-input-parameters">Passing input parameters</a></h1>
<p>Some <a href="http://gremlindocs.com">Gremlin</a> expressions require declaration of input parameters to be
run. This is the case, for example, of bound variables, as described
in <a href="https://github.com/tinkerpop/gremlin/wiki/Using-Gremlin-through-Java">JSR223 Gremlin Script Engine</a>. OrientDB has enabled a mechanism to
pass variables to a <a href="http://gremlindocs.com">Gremlin</a> pipeline declared in a command as
described below:</p>
<pre><code class="language-java">Map&lt;String, Object&gt; params = new HashMap&lt;String, Object&gt;();
params.put("map1", new HashMap());
params.put("map2", new HashMap());
db.command(new OCommandSQL("select gremlin('
current.as('id').outE.label.groupCount(map1).optional('id').sideEffect{map2=it.map();map2+=map1;}
')")).execute(params);
</code></pre>
<h2 id="gremlinpipeline"><a class="header" href="#gremlinpipeline">GremlinPipeline</a></h2>
<p>You can also use native Java GremlinPipeline like:</p>
<pre><code class="language-java">new GremlinPipeline(g.getVertex(1)).out("knows").property("name").filter(new PipeFunction&lt;String,Boolean&gt;() {
  public Boolean compute(String argument) {
    return argument.startsWith("j");
  }
}).back(2).out("created");
</code></pre>
<p>For more information: <a href="https://github.com/tinkerpop/gremlin/wiki/Using-Gremlin-through-Java">Using Gremlin through Java</a></p>
<h1 id="declaring-output"><a class="header" href="#declaring-output">Declaring output</a></h1>
<p>In the simplest case, the output of the last step (https://github.com/tinkerpop/gremlin/wiki/Gremlin-Steps) in the Gremlin pipeline corresponds to the output of the overall Gremlin expression. However, it is possible to instruct the Gremlin engine to consider any of the input variables as output. This can be declared as:</p>
<pre><code class="language-java">Map&lt;String, Object&gt; params = new HashMap&lt;String, Object&gt;();
params.put("map1", new HashMap());
params.put("map2", new HashMap());
params.put("output", "map2");
db.command(new OCommandSQL("select gremlin('
current.as('id').outE.label.groupCount(map1).optional('id').sideEffect{map2=it.map();map2+=map1;}
')")).execute(params);
</code></pre>
<p>There are more possibilities to define the output in the <a href="http://gremlindocs.com">Gremlin</a> pipelines.  So this mechanism is expected to be extended in the future. Please, contact OrientDB mailing list to discuss customized outputs.</p>
<h1 id="conclusions"><a class="header" href="#conclusions">Conclusions</a></h1>
<p>Now you've learned how to use <a href="http://gremlindocs.com">Gremlin</a> on top of OrientDB.  The best place to go in depth with this powerful language is the <a href="https://github.com/tinkerpop/gremlin/wiki">Gremlin WiKi</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="security-7"><a class="header" href="#security-7">Security</a></h1>
<p>OrientDB is the NoSQL implementation with the greatest focus on security.</p>
<ul>
<li>
<p>To connect to an existing database, you need a user and password.  Users and roles are defined inside the database.  For more information on this process, see <a href="security/Database-Security.html">Database Security</a>.</p>
</li>
<li>
<p>In the event that you're connecting to the OrientDB Server that is hosting the database, you can access the database using the server's user.  For more information on this process, see <a href="security/Server-Security.html">Server Security</a>.</p>
</li>
<li>
<p>Additionally, you can encrypt the database contents on disk.  For more information on this process, see <a href="security/Database-Encryption.html">Database Encryption</a>.</p>
</li>
</ul>
<div class="table-wrapper"><table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td><img src="security/../images/warning.png" alt="" /></td><td>While OrientDB Server can function as a regular Web Server, it is not recommended that you expose it directly to either the Internet or public networks.  Instead, always hide OrientDB server in private networks.</td></tr>
</tbody></table>
</div>
<p>See also:</p>
<ul>
<li><a href="security/Security-OrientDB-New-Security-Features.html">New Security Features</a></li>
<li><a href="security/Database-Security.html">Database security</a></li>
<li><a href="security/Server-Security.html">Server security</a></li>
<li><a href="security/Database-Encryption.html">Database Encryption</a></li>
<li><a href="security/Using-SSL-with-OrientDB.html">Secure SSL connections</a></li>
<li><a href="security/../internals/Web-Server.html">OrientDB Web Server</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-security-guide"><a class="header" href="#orientdb-security-guide">OrientDB Security Guide</a></h1>
<p>The <em>OrientDB Security Guide</em> has three sections on security-related topics when running an instance of OrientDB:</p>
<ul>
<li>Security Recommendations Checklist</li>
<li>Data Protection and Privacy</li>
<li>OrientDB Security Documentation</li>
</ul>
<h2 id="security-recommendations-checklist"><a class="header" href="#security-recommendations-checklist">Security Recommendations Checklist</a></h2>
<p>The following is a list of recommended suggestions for improving the security of a default OrientDB installation:</p>
<ul>
<li>Disable Default Users</li>
<li>Review Port Settings</li>
<li>Enable TLS Encryption</li>
<li>Enable Database Encryption</li>
<li>Configure The JavaScript Sandbox</li>
<li>Avoid Exposing The OrientDB Server To A Public Network</li>
<li>Enable Auditing (Enterprise Only)</li>
<li>Validate Plug-Ins</li>
</ul>
<h3 id="default-users-and-roles"><a class="header" href="#default-users-and-roles">Default Users and Roles</a></h3>
<p>By default, when a new database is created, three default roles and their respective users are created.</p>
<p>The roles are <em>admin</em>, <em>reader</em>, and writer.  Three users are also created corresponding to each role: <em>admin</em>, <em>reader</em>, and <em>writer</em>.</p>
<p>A default password is also created for each user.  The password is the same as the user's name (e.g., the <em>admin</em> user's password is set to <em>admin</em>).</p>
<p><strong>SECURITY RECOMMENDATION</strong>: Disable creation of default users.</p>
<p>To disable the creation of defaults roles and users when a database is created edit the <em>security.json</em> file in the <em>config</em> directory.  Set the <em>createDefaultUsers</em> property to false.</p>
<pre><code>  "server": {
    "createDefaultUsers": false
  },
</code></pre>
<h3 id="ports"><a class="header" href="#ports">Ports</a></h3>
<p>The default configuration for an OrientDB server utilizes multiple communication ports:</p>
<ul>
<li>2424 is the default binary protocol port used by binary protocol drivers.</li>
<li>2434 is the default Hazelcast discovery and multicast port (if distributed is enabled).</li>
<li>2480 is the default REST API endpoint port and also used by OrientDB Studio.</li>
<li>8182 is the default Gremlin Server port (if installed and enabled).</li>
</ul>
<p>By default, none of the communications on these ports uses encryption.</p>
<p><strong>SECURITY RECOMMENDATION</strong>: Enable TLS encryption for each protocol.</p>
<h3 id="tls-encryption"><a class="header" href="#tls-encryption">TLS Encryption</a></h3>
<p>OrientDB supports TLS 1.2 in-transit encryption.  However, this is not enabled in the default installation.</p>
<p>See <a href="security/Using-SSL-with-OrientDB.html">TLS Encryption</a>.</p>
<p><strong>SECURITY RECOMMENDATION</strong>: Enable TLS encryption for each protocol.</p>
<h3 id="database-encryption"><a class="header" href="#database-encryption">Database Encryption</a></h3>
<p>OrientDB supports at-rest AES and DES database encryption.  A global encryption key can be set for all databases or a separate encryption can be set on each database.</p>
<p>See <a href="security/Database-Encryption.html">Database Encryption</a>.</p>
<p>By default, OrientDB databases are not encrypted.</p>
<p><strong>SECURITY RECOMMENDATION</strong>: Enable at-rest encryption for each database.</p>
<h3 id="javascript-sandbox"><a class="header" href="#javascript-sandbox">JavaScript Sandbox</a></h3>
<p>The OrientDB JavaScript engine runs in a sandbox.  By default, no packages are allowed to be accessed.</p>
<p>To allow specific Java packages edit the <em>OServerSideScriptInterpreter</em> handler in the <em>orientdb-server-config.xml</em> file under the <em>config</em> directory.</p>
<p>The parameter to edit is "allowedPackages".  Its value is a comma-separated list of packages.</p>
<pre><code>&lt;handler class="com.orientechnologies.orient.server.handler.OServerSideScriptInterpreter"&gt;
	&lt;parameters&gt;
		&lt;parameter name="enabled" value="true"/&gt;
		&lt;parameter name="allowedLanguages" value="SQL"/&gt;
		&lt;!--  Comma separated packages  allowed in JS scripts eg. java.math.*, java.util.ArrayList --&gt;
		&lt;parameter name="allowedPackages" value="com.orientechnologies.orient.core.security.OSecurityManager"/&gt;
	&lt;/parameters&gt;
&lt;/handler&gt;
</code></pre>
<p>For more information see <a href="security/../admin/Functions-DB-Access.html">JavaScript Functions</a></p>
<p><strong>SECURITY RECOMMENDATION</strong>: Be careful which packages are allowed, as granting access to certain packages could compromise the system security.</p>
<h3 id="orientdb-web-server"><a class="header" href="#orientdb-web-server">OrientDB Web Server</a></h3>
<p>It is not recommended to expose the OrientDB Web Server directly on the Internet or public networks.</p>
<p>For more information on this and JSONP, cross-site requests, and clickjacking, see: <a href="security/../internals/Web-Server.html">OrientDB Web Server Security</a>.</p>
<p><strong>SECURITY RECOMMENDATION</strong>: Do not expose the OrientDB Web Server on the Internet or public networks.</p>
<h3 id="enable-auditing-enterprise-only"><a class="header" href="#enable-auditing-enterprise-only">Enable Auditing (Enterprise Only)</a></h3>
<p>If you are using the Enterprise version of OrientDB, it is recommended to enable the auditing feature.</p>
<p>For more information: <a href="security/../ee/Auditing.html">OrientDB Auditing</a></p>
<p><strong>SECURITY RECOMMENDATION</strong>: Enable the auditing capability.</p>
<h3 id="validate-plug-ins"><a class="header" href="#validate-plug-ins">Validate Plug-Ins</a></h3>
<p>Since OrientDB supports both static and dynamic plug-ins, which have total access to the entire system, it is recommended to validate the installed plug-ins for authenticity and to limit write access to the <em>plugins</em> directory.</p>
<p><strong>SECURITY RECOMMENDATION</strong>: Validate installed plug-ins.</p>
<h2 id="data-protection-and-privacy"><a class="header" href="#data-protection-and-privacy">Data Protection and Privacy</a></h2>
<p>See <a href="security/SAP-Enterprise-OrientDB-DPP.html">SAP Enterprise OrientDB Data Protection and Privacy Approach for Products</a>.</p>
<h2 id="orientdb-security-documentation"><a class="header" href="#orientdb-security-documentation">OrientDB Security Documentation</a></h2>
<p>More comprehensive information about OrientDB security can be found here:</p>
<ul>
<li><a href="security/Security-OrientDB-New-Security-Features.html">New Security Features</a></li>
<li><a href="security/Database-Security.html">Database security</a></li>
<li><a href="security/Server-Security.html">Server security</a></li>
<li><a href="security/Database-Encryption.html">Database Encryption</a></li>
<li><a href="security/Using-SSL-with-OrientDB.html">Secure SSL connections</a></li>
<li><a href="security/../internals/Web-Server.html">OrientDB Web Server</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sap-enterprise-orientdb-data-protection-and-privacy-approach-for-products"><a class="header" href="#sap-enterprise-orientdb-data-protection-and-privacy-approach-for-products">SAP Enterprise OrientDB Data Protection and Privacy Approach for Products</a></h1>
<p>The purpose of this document is to describe the approach and capabilities provided by SAP Enterprise OrientDB which can be used by applications and customers to comply with data protection regulations like the EU General Data Protection Regulation (GDPR).</p>
<p>The document also does not provide how-tos, guidelines, or rules on how to be compliant to data protection and privacy regulations. This needs to be done by the customer based on their own data protection and privacy requirements and applicable regulations.</p>
<p>Data protection and privacy regulations are applicable to the storage and processing and transfer of data regarded as personal data or even sensitive personal data.  Data protection in general is applicable to all types of personal data.</p>
<p>However, some of the details on how data protection requirements are applied in practice can differ, depending on the type of data. In the context of SAP Enterprise OrientDB we distinguish between two types of data:</p>
<ul>
<li>
<p><strong>Application Data</strong> i.e. data that comes from applications to be stored, processed, and managed by the data-structures (e.g., database classes) and features provided by SAP Enterprise OrientDB. The semantics, content (social security number, product ID, health data) and relation (e.g., which class makes up a business object like customer) of this data or what regulations need to apply (e.g., retention periods) are under the control of the application. SAP Enterprise OrientDB itself is agnostic to the semantics and only sees the technical representation of the data in SAP Enterprise OrientDB technical objects (e.g. classes). Therefore, the application is responsible to ensure that the data is processed in compliance with data protection regulations and the requirements defined by SAP product standards. SAP Enterprise OrientDB enables the applications to comply by providing appropriate capability and features. The details on what SAP Enterprise OrientDB offers for the specific requirements are described later in this document.</p>
</li>
<li>
<p><strong>Operational Data</strong> is the data which is collected with the purpose to ensure correct operation, maintenance, and functioning of the system. Depending on the type of data it may contain personal related data. Operational data in SAP Enterprise OrientDB is stored in different places:</p>
<ul>
<li>Audit Log</li>
<li>Log Files</li>
<li>System Classes</li>
<li>Backup Files</li>
</ul>
<p>This data is collected for the direct purpose of running and maintaining the operation of the SAP Enterprise OrientDB system.</p>
</li>
</ul>
<h1 id="gdpr-principles-sap-requirements-sap-enterprise-orientdb-implementation"><a class="header" href="#gdpr-principles-sap-requirements-sap-enterprise-orientdb-implementation">GDPR principles, SAP requirements, SAP Enterprise OrientDB Implementation</a></h1>
<p>Based on the data protection regulations SAP created a set of requirements including five corporate requirements. Some of these requirements were primarily defined for business applications. For SAP Enterprise OrientDB as a database platform we had to find our own interpretation of these requirements.</p>
<p>Processing of Personal Data – Legal Ground
One of the key principles of DPP is that there needs to be an explicit legal ground to process personal data.</p>
<p>Providing the legal ground is not a technical topic but a process and legal topic that needs to be addressed independently from the technology. Therefore, those requirements do not translate into technical product requirements.</p>
<div class="table-wrapper"><table><thead><tr><th>Requirement</th><th>Content</th><th>Comment</th></tr></thead><tbody>
<tr><td>Consent</td><td>Where processing is based on the data subject's consent, the controller should be able to demonstrate that the data subject has given consent to the processing operation. (GDPR rec. 42, sentence 1.)</td><td>Not Applicable</td></tr>
<tr><td>Contract</td><td>Processing should be lawful where it is necessary in the context of a contract or the intention to enter into a contract. (GDPR rec. 44)</td><td>Not Applicable</td></tr>
<tr><td>Legal Obligation</td><td>Business software based examples: tax reporting, income tax reporting, reporting for social insurance</td><td>Not Applicable</td></tr>
<tr><td>Protect Vital Interest</td><td>The processing of personal data should also be regarded to be lawful where it is necessary to protect an interest which is essential for the life of the data subject or that of another natural person. (GDPR rec. 46 sentence 1)</td><td>Not Applicable</td></tr>
<tr><td>Public Interest</td><td>Where processing is … necessary for the performance of a task carried out in the public interest or in the exercise of official authority, the processing should have a basis in Union or Member State law. (GDPR rec. 45 sentence 1)</td><td>Not Applicable</td></tr>
<tr><td>Legitimate Interest</td><td>Proofing a legitimate interest is subject to a careful legal consideration whether “fundamental rights and freedoms of the data subject” are not overriding such an interest. (GDPR rec. 47)</td><td>Not Applicable</td></tr>
</tbody></table>
</div>
<h2 id="complements-of-the-general-right---rights-of-the-data-subject"><a class="header" href="#complements-of-the-general-right---rights-of-the-data-subject">Complements of the General Right - Rights of the Data Subject</a></h2>
<p>Data protection regulations define very specific rights to the data subject. Anyone wanting to process data on one of the legal grounds defined above needs to ensure those rights. That means SAP software has to enable customers to run their applications according to those regulations.</p>
<p>Not all requirements can be translated into technical requirements or by technical means alone. However, some of those requirements need to be technically supported by SAP software and those are translated into explicit requirements in the SAP security product standard. The following table lists those requirements and the following sections define the way SAP Enterprise OrientDB deals with those requirements.</p>
<div class="table-wrapper"><table><thead><tr><th>Requirement</th><th>Content</th></tr></thead><tbody>
<tr><td>Notification</td><td>The ability to inform the data subject if the data is used for a different purpose.</td></tr>
<tr><td>Information</td><td>The data subject’s right to get information on the data undergoing processing concerning them.</td></tr>
<tr><td>Correction</td><td>Personal data has to be true and to be corrected (latest after request).</td></tr>
<tr><td>Erasure</td><td>The ability to delete personal data when all retention periods have passed.<br><br>The ability to block personal data as soon as the primary purpose has passed and the residence time has elapsed.</td></tr>
<tr><td>Data Portability</td><td>The right of the data subject to receive his personal data in a structured, commonly used, and machine-readable format.</td></tr>
<tr><td>Automated Decisions</td><td>The data subject has the right that any automated decision can become subject to manual interference.</td></tr>
</tbody></table>
</div>
<h3 id="sec-255-provide-a-retrieval-function-which-can-be-used-to-inform-the-data-subjects-about-the-personal-data-stored-about-them"><a class="header" href="#sec-255-provide-a-retrieval-function-which-can-be-used-to-inform-the-data-subjects-about-the-personal-data-stored-about-them">SEC-255: Provide a retrieval function which can be used to inform the data subjects about the personal data stored about them</a></h3>
<p>The requirement specifically applies to applications. Personal application data stored inside SAP Enterprise OrientDB classes (user information) can be displayed by using OrientDB SQL queries. Since only applications have the knowledge as to which classes contain personal data, they are responsible for implementing report and display functions using such standard capabilities provided by SAP Enterprise OrientDB.</p>
<p>The requirement does not apply to operational data.  Backups, logs, and trace files at this time are not explicitly listed in the EU GDPR and have an agreed exception in the German Data Protection Regulation.</p>
<h3 id="sec-256-erase-personal-data-when-all-applicable-retention-periods-have-expired"><a class="header" href="#sec-256-erase-personal-data-when-all-applicable-retention-periods-have-expired">SEC-256: Erase personal data when all applicable retention periods have expired</a></h3>
<p>SAP Enterprise OrientDB supports the deletion (erasure) of application data in classes using SQL deletion commands or API commands. After the data has been deleted, this operation cannot be undone. Applications must make use of these commands to implement deletion requirements.</p>
<p>Retention periods, deletion of data without affecting application functionality (e.g. referential integrity) are dependent on the business context, application architecture, etc., and need to be managed by the application. The application needs to implement these rules using the SQL deletion commands or equivalent OrientDB APIs.</p>
<p>Applications can implement blocking of data using SAP Enterprise OrientDB methods like record-based security and masking or separating the data using OrientDB SQL Predicate Security.</p>
<p>Operational data: Deletion of specific records (e.g. all records of a specific person) does not apply to operational data.  However, still this data is also subject to deletion/retention requirements.  Those timelines usually apply to the complete data set (e.g. all logs older than x days need to be deleted).</p>
<p>Backup: Following standard practice, deletion of individual personal data is not enforced in backups. Common practice is that deleted data will disappear from backups following typical backup-rotation mechanisms. Explicitly deleting personal data from backups is therefore outside the scope of SAP Enterprise OrientDB’s data protection approach and would need to be managed by the customer dependent on their backup and DPP requirements.</p>
<p>Physical deletion: After data is deleted using, for example the SQL DELETE statement, the respective storage area is marked as free but is not immediately overwritten. The associated storage area will only be overwritten once new data is stored in the respective cluster. As SAP Enterprise OrientDB writes the page as a whole to the record cluster, the deleted, but not overwritten memory areas are also stored to disk in binary format. It is therefore feasible that fragments of the deleted data could under certain circumstances or for a certain period of time be reconstructed. Prerequisite is direct access to the database files in the file system as well as access to the encryption key in case the encryption-at-rest feature of SAP Enterprise OrientDB is used.</p>
<p>An analysis has shown that other DB vendors face the same problem and that there are no solutions on the market to address the complete deletion of those remaining data-fragments (in literature referred to as “slack”).  Completely deleting those remains is very difficult and dependent on other factors like the storage technology used. Initial recommendation is therefore to reduce such slack. SAP Enterprise OrientDB already has a method to reduce slack by making completely unused old pages unreadable when the encryption feature is used.</p>
<p>Further extending physical deletion capabilities would depend on customer demand.</p>
<h3 id="sec-254---sap-software-shall-log-read-access-to-sensitive-personal-data"><a class="header" href="#sec-254---sap-software-shall-log-read-access-to-sensitive-personal-data">SEC-254 - SAP software shall log read access to sensitive personal data</a></h3>
<p>Applications may store sensitive personal data in SAP Enterprise OrientDB.  SAP Enterprise OrientDB provides an audit log that can track which user has accessed data records in SAP Enterprise OrientDB.</p>
<p>With this mechanism, audit polices can be defined to log access to classes containing sensitive personal data.</p>
<p>It is recommended for applications built on top of SAP Enterprise OrientDB to document clearly where sensitive information is stored so that customers, if required on SAP Enterprise OrientDB level, can define respective policies.</p>
<p>This does not apply to operational data.</p>
<h3 id="sec-265---sap-software-shall-log-changes-to-personal-data"><a class="header" href="#sec-265---sap-software-shall-log-changes-to-personal-data">SEC-265 - SAP software shall log changes to personal data</a></h3>
<p>Changes to the personal data stored in application data in SAP Enterprise OrientDB can be logged using SAP Enterprise OrientDB’s audit logging functionality.</p>
<p>SAP Enterprise OrientDB provides the infrastructure to define customer-specific audit log policies which log change access to defined objects in the database (issued UPDATE, DELETE, … statements).</p>
<p>Audit policies can be defined by the customer (administrator). Applications built on top of SAP Enterprise OrientDB should provide guidelines for customers on how to set-up appropriate log policies, for example by providing information on which classes contain relevant information.</p>
<h3 id="general-log-requirements-valid-for-sec-265-sec-254"><a class="header" href="#general-log-requirements-valid-for-sec-265-sec-254">General Log Requirements (valid for SEC-265, SEC-254)</a></h3>
<p>SAP Enterprise OrientDB provides a common policy-based logging infrastructure that can be used by all applications running on SAP Enterprise OrientDB to log actions on data access as well as administrative or security related events in SAP Enterprise OrientDB.  As a target for storing the log trail, SAP Enterprise OrientDB currently supports writing the information to the syslog infrastructure of the underlying operating system or a special log class within the System database (appropriately protected by authorization).</p>
<p>Syslog integration allows customers to:</p>
<ul>
<li>Implement physical segregation of duty by sending the log data to their existing log infrastructure, which means that the log data cannot be changed by database administrators</li>
<li>Use their established log infrastructure and tools including the compliance rules already implemented in this infrastructure</li>
<li>Use their own established tools for analyzing the log entries</li>
</ul>
<p>This approach is very well received by customers and meets their expectations on log handling.</p>
<p>Logging into tables allows customers to:</p>
<ul>
<li>Store data within the database itself in specially protected classes</li>
<li>Use standard SQL tooling for log analysis</li>
</ul>
<p>The log table is a specially protected system table.</p>
<p>Log viewing, deletion, and retention have to be managed by the customer and cannot be provided by SAP Enterprise OrientDB.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="database-security"><a class="header" href="#database-security">Database Security</a></h1>
<p>OrientDB uses a security model based on the concepts of users and roles.  That is, a database has its own users.  Each <a href="security/Database-Security.html#users">User</a> has one or more roles.  <a href="security/Database-Security.html#roles">Roles</a> are a combination of the working mode and a set of permissions and security policies.</p>
<p><img src="http://www.orientdb.org/images/orientdb-dbsecurity.png" alt="Security overview" /></p>
<blockquote>
<p>For more information on security, see:</p>
<ul>
<li><a href="security/Server-Security.html">Server security</a></li>
<li><a href="security/Database-Encryption.html">Database Encryption</a></li>
<li><a href="security/Using-SSL-with-OrientDB.html">Secure SSL connections</a></li>
<li><a href="security/Database-Security.html#record-level-security-deprecated-in-v-31">Record Level Security (legacy)</a></li>
<li><a href="security/Database-Security.html#security-policies">Security Policies</a></li>
</ul>
</blockquote>
<h2 id="users-1"><a class="header" href="#users-1">Users</a></h2>
<p>A user is an actor on the database.  When you open a database, you need to specify the user name and the password to use.  Each user has its own credentials and permissions.</p>
<p>By convention, each time you create a new database OrientDB creates three default users.  The passwords for these users are the same as the usernames.  That is, by default the <code>admin</code> user has a password of <code>admin</code>.</p>
<ul>
<li><code>admin</code> This user has access to all functions on the database without limitation.</li>
<li><code>reader</code> This user is a read-only user.  The <code>reader</code> can query any records in the database, but can't modify or delete them.  It has no access to internal information, such as the users and roles themselves.</li>
<li><code>writer</code> This user is the same as the user <code>reader</code>, but it can also create, update and delete records.</li>
</ul>
<p>The users themselves are records stored inside the cluster <code>ouser</code>.  OrientDB stores passwords in hash.  From version 2.2 on, OrientDB uses the <a href="https://en.wikipedia.org/wiki/PBKDF2">PBKDF2</a> algorithm.  Prior releases relied on <a href="https://en.wikipedia.org/wiki/SHA-2">SHA-256</a>.  For more information on passwords, see <a href="security/Database-Security.html#password-management">Password Management</a>.</p>
<p>OrientDB stores the user status in the field <code>status</code>.  It can either be <code>SUSPENDED</code> or <code>ACTIVE</code>.  Only <code>ACTIVE</code> users can log in.</p>
<h3 id="working-with-users-1"><a class="header" href="#working-with-users-1">Working with Users</a></h3>
<p>When you are connected to a database, you can query the current users on the database by using <a href="security/../sql/SQL-Query.html"><code>SELECT</code></a> queries on the <code>OUser</code> class.</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT RID, name, status FROM OUser</code>

---+--------+--------+--------
#  | @CLASS | name   | status
---+--------+--------+--------
0  | null   | admin  | ACTIVE
1  | null   | reader | ACTIVE
2  | null   | writer | ACTIVE
---+--------+--------+--------
3 item(s) found. Query executed in 0.005 sec(s).
</pre>
<h4 id="creating-a-new-user"><a class="header" href="#creating-a-new-user">Creating a New User</a></h4>
<p>To create a new user, use the <a href="security/../sql/SQL-Insert.html"><code>INSERT</code></a> command.  Remember in doing so, that you must set the status to <code>ACTIVE</code> and give it a valid role.</p>
<pre>
orientdb> <code class="lang-sql userinput">INSERT INTO OUser SET name = 'jay', password = 'JaY', status = 'ACTIVE',
          roles = (SELECT FROM ORole WHERE name = 'reader')</code>
</pre>
<h4 id="updating-users"><a class="header" href="#updating-users">Updating Users</a></h4>
<p>You can change the name for the user with the <a href="security/../sql/SQL-Update.html"><code>UPDATE</code></a> statement:</p>
<pre>
orientdb> <code class="lang-sql userinput">UPDATE OUser SET name = 'jay' WHERE name = 'reader'</code>
</pre>
<p>In the same way, you can also change the password for the user:</p>
<pre>
orientdb> <code class="lang-sql userinput">UPDATE OUser SET password = 'hello' WHERE name = 'reader'</code>
</pre>
<p>OrientDB saves the password in a hash format.  The trigger <code>OUserTrigger</code> encrypts the password transparently before it saves the record.</p>
<h4 id="disabling-users"><a class="header" href="#disabling-users">Disabling Users</a></h4>
<p>To disable a user, use <a href="security/../sql/SQL-Update.html"><code>UPDATE</code></a> to switch its status from <code>ACTIVE</code> to <code>SUSPENDED</code>.  For instance, if you wanted to disable all users except for <code>admin</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">UPDATE OUser SET status = 'SUSPENDED' WHERE name &lt;&gt; 'admin'</code>
</pre>
<blockquote>
<p><strong>NOTE</strong>: In the event that, due to accident or database corruption, you lose the user <code>admin</code> and need to restore it on the database, see <a href="security/../security/Server-Security.html#restoring-the-user-admin">Restoring the admin User`</a>.</p>
</blockquote>
<h2 id="roles-6"><a class="header" href="#roles-6">Roles</a></h2>
<p>A role determines what operations a user can perform against a resource.</p>
<h3 id="working-with-roles"><a class="header" href="#working-with-roles">Working with Roles</a></h3>
<p>When you are connected to a database, you can query the current roles on the database using <a href="security/../sql/SQL-Query.html"><code>SELECT</code></a> queries on the <code>ORole</code> class.</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT RID, mode, name, policies, rules FROM ORole</code>

+----+----+----+------+------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------+
|#   |RID |mode|name  |rules                                                                                     |policies                                                                                                             |
+----+----+----+------+------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------+
|0   |    |    |admin |{database=31, database.function=31, database.schema=31, database.command.gremlin=31, *=...|{*:#4:0}                                                                                                             |
|1   |    |    |reader|{database.cluster.internal=2, database.cluster.orole=0, database=2, database.function=2...|{database.class.*.*:#4:0, database:#4:1, database.schema:#4:1, database.cluster.internal:#4:1, database.cluster.or...|
|2   |    |    |writer|{database.cluster.internal=2, database.class.oschedule=2, database.class.osequence=2, d...|{database.class.*.*:#4:0, database:#4:1, database.schema:#4:3, database.cluster.internal:#4:1, database.cluster.or...|
+----+----+----+------+------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------+
3 item(s) found.  Query executed in 0.002 sec(s).
</pre>
<h4 id="creating-new-roles"><a class="header" href="#creating-new-roles">Creating New Roles</a></h4>
<p>To create a new role, use the <a href="security/../sql/SQL-Insert.html"><code>INSERT</code></a> statement.</p>
<pre>
orientdb> <code class="lang-sql userinput">INSERT INTO ORole SET name = 'developer'</code>
</pre>
<h4 id="role-inheritance"><a class="header" href="#role-inheritance">Role Inheritance</a></h4>
<p>Roles can inherit permissions from other roles in an object-oriented fashion.  To let a role extend another, add the parent role in the <code>inheritedRole</code> attribute.  For instance, say you want users with the role <code>appuser</code> to inherit settings from the role <code>writer</code>.</p>
<pre>
orientdb> <code class="lang-sql userinput">UPDATE ORole SET inheritedRole = (SELECT FROM ORole WHERE name = 'writer')
          WHERE name = 'appuser'</code>
</pre>
<h3 id="working-with-modes-deprecated-in-v-31"><a class="header" href="#working-with-modes-deprecated-in-v-31">Working with Modes (DEPRECATED in v 3.1)</a></h3>
<blockquote>
<p>IMPORTANT: in v 3.1 working modes do not apply anymore. The standard behaviour is Deny All But. Even explicitly configuring the role for Allow All, it won't change the behaviour.</p>
</blockquote>
<p>Where rules determine what users belonging to certain roles can do on the databases, working modes determine how OrientDB interprets these rules.  There are two types of working modes, designating by <code>1</code> and <code>0</code>.</p>
<ul>
<li>
<p><strong>Allow All But (Rules)</strong> By default is the super user mode.  Specify exceptions to this using the rules.  If OrientDB finds no rules for a requested resource, then it allows the user to execute the operation.  Use this mode mainly for power users and administrators.  The default role <code>admin</code> uses this mode by default and has no exception rules.  It is written as <code>1</code> in the database.</p>
</li>
<li>
<p><strong>Deny All But (Rules)</strong> By default this mode allows nothing.  Specify exceptions to this using the rules.  If OrientDB finds rules for a requested resource, then it allows the user to execute the operation.  Use this mode as the default for all classic users.  The default roles <code>reader</code> and <code>writer</code> use this mode.  It is written as <code>0</code> in the database.</p>
</li>
</ul>
<h4 id="operations-2"><a class="header" href="#operations-2">Operations</a></h4>
<p>The supported operations are the classic CRUD operations.  That is, <strong>C</strong>reate, <strong>R</strong>ead, <strong>U</strong>pdate, <strong>D</strong>elete.  Roles can have none of these permissions or all of them.  OrientDB represents each permission internally by a 4-digit bitmask flag.</p>
<pre><code>NONE:   #0000 - 0
CREATE: #0001 - 1
READ:   #0010 - 2
UPDATE: #0100 - 4
DELETE: #1000 - 8
ALL:    #1111 - 15
</code></pre>
<p>In addition to these base permissions, you can also combine them to create new permissions.  For instance, say you want to allow only the Read and Update permissions:</p>
<pre><code>READ:               #0010 - 2
UPDATE:             #0100 - 4
Permission to use:  #0110 - 6
</code></pre>
<h3 id="security-policies"><a class="header" href="#security-policies">Security Policies</a></h3>
<p>Security policies are an enhanced version of a the Operations bitmap.</p>
<p>A security policy is a map made of operation-predicate pairs.</p>
<p>The "operation" (the map key) can be one of the following:</p>
<ul>
<li>"CREATE"</li>
<li>"READ"</li>
<li>"BEFORE UPDATE"</li>
<li>"AFTER UPDATE"</li>
<li>"DELETE"</li>
<li>"EXECUTE"</li>
</ul>
<p>The "predicate" is a normal SQL predicate, that can be a very simple one (eg. <code>TRUE</code> or <code>FALSE</code>) or a more structured condition (eg. <code>"owner = $currentUser</code>), that can also include subqueries and graph traversal.</p>
<p>Security policies are intended to be applied to single records in each phase of its lifecycle (ie. when it's created, read, before and after its update and so on) to define if that particular operation is allowed or not</p>
<h3 id="resources-4"><a class="header" href="#resources-4">Resources</a></h3>
<p>Resources are strings bound to OrientDB concepts.</p>
<blockquote>
<p><strong>NOTE</strong>: Resource entries are case-sensitive.</p>
</blockquote>
<ul>
<li><code>database</code>, checked on accessing to the database</li>
<li><code>database.class.&lt;class-name&gt;</code>, checked on accessing on specific class</li>
<li><code>database.class.&lt;class-name&gt;.&lt;property-name&gt;</code>, checked on accessing on specific property</li>
<li><code>database.cluster.&lt;cluster-name&gt;</code>, checked on accessing on specific cluster</li>
<li><code>database.query</code>, checked on query execution</li>
<li><code>database.command</code>, checked on command execution</li>
<li><code>database.schema</code>, checked to access to the schema</li>
<li><code>database.function</code>, checked on function execution</li>
<li><code>database.config</code>, checked on accessing at database configuration</li>
<li><code>database.hook.record</code></li>
<li><code>server.admin</code>, checked on accessing to remote server administration</li>
</ul>
<p>For instance, say you have a role <code>motorcyclist</code> that you want to have access to all classes except for the class <code>Car</code>.</p>
<pre>
orientdb> <code class="lang-sql userinput">UPDATE ORole PUT rules = "database.class.*", 15 WHERE name = "motorcyclist"</code>

orientdb> <code class="lang-sql userinput">UPDATE ORole PUT rules = "database.class.Car", 0 WHERE name = "motorcyclist"</code>
</pre>
<h3 id="granting-and-revoking-permissions"><a class="header" href="#granting-and-revoking-permissions">Granting and Revoking Permissions</a></h3>
<p>To grant and revoke permissions from a role, use the <a href="security/../sql/SQL-Grant.html">GRANT</a> and <a href="security/../sql/SQL-Revoke.html">REVOKE</a> commands.</p>
<p>Until v 3.0, the only way to manage permissions for a particular role, was to grant or revoke "cluster" permissions as follows</p>
<pre>
orientdb> <code class="lang-sql userinput">GRANT UPDATE ON database.cluster.Car TO motorcyclist</code>
</pre>
<p>In v 3.1, role permissions can be managed with security policies, eg.</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE SECURITY POLICY readOnlyPolicy SET CREATE = (FALSE), READ = (TRUE), BEFORE UPDATE = (FALSE), DELETE = (FALSE)</code>

orientdb> <code class="lang-sql userinput">GRANT POLICY readOnlyPolicy ON database.class.Car TO aRoleName</code>
</pre>
<p>Security policies can also be applied to single properties, eg. to hide a property to a particular role</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE SECURITY POLICY cannotRead SET  READ = (FALSE)</code>

orientdb> <code class="lang-sql userinput">GRANT POLICY cannotRead ON database.class.Employee.salary TO basicRole</code>
</pre>
<h3 id="record-level-security-deprecated-in-v-31"><a class="header" href="#record-level-security-deprecated-in-v-31">Record-level Security (DEPRECATED in v 3.1)</a></h3>
<blockquote>
<p>IMPORTANT: In v 3.1 the record level security is replaced by Predicate Security (see below).</p>
</blockquote>
<p>The sections above manage security in a vertical fashion at the schema-level, but in OrientDB you can also manage security in a horizontal fashion, that is: per record.  This allows you to completely separate database records as sandboxes, where only authorized users can access restricted records.</p>
<p>To active record-level security, create classes that extend the <code>ORestricted</code> super class.  In the event that you are working with a Graph Database, set the <code>V</code> and <code>E</code> classes (that is, the vertex and edge classes) themselves to extend <code>ORestricted</code>.</p>
<pre>
orientdb> <code class='lang-sql userinput'>ALTER CLASS V SUPERCLASS ORestricted</code>

orientdb> <code class="lang-sql userinput">ALTER CLASS E SUPERCLASS ORestricted</code>
</pre>
<p>This causes all vertices and edges to inherit the record-level security.  Beginning with version 2.1, OrientDB allows you to use multiple inheritances, to cause only certain vertex or edge calsses to be restricted.</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE CLASS Order EXTENDS V, ORestricted</code>
</pre>
<p>Whenever a class extends the class <code>ORestricted</code>, OrientDB uses special fields to type-set <code>_&lt;OIdentifiable&gt;</code> to store authorization on each record.</p>
<ul>
<li><code>_allow</code> Contains the users that have full access to the record, (that is, all CRUD operations).</li>
<li><code>_allowRead</code> Contains the users that can read the record.</li>
<li><code>_allowUpdate</code> Contains the users that can update the record.</li>
<li><code>_allowDelete</code> Contains the users that can delete the record.</li>
</ul>
<p>To allow full control over a record to a user, add the user's RID to the <code>_allow</code> set.  To provide only read permissions, use <code>_allowRead</code>.  In the example below, you allow the user with the RID <code>#5:10</code> to read record <code>#43:22</code>:</p>
<pre>
orientdb> <code class='lang-sql userinput'>UPDATE #43:22 ADD _allowRead #5:10</code>
</pre>
<p>If you want to remove read permissions, use the following command:</p>
<pre>
orientdb> <code class='lang-sql userinput'>UPDATE #43:22 REMOVE _allowRead #5:10</code>
</pre>
<h3 id="predicate-security"><a class="header" href="#predicate-security">Predicate Security</a></h3>
<p>The sections above manage security in a vertical fashion at the schema-level, but in OrientDB you can also manage security in a horizontal fashion, that is: per record or even per single property in a record.  This allows you to completely separate database records as sandboxes, where only authorized users can access restricted records.</p>
<p>To active Predicate Security, you have to define Security Policies and assign them to roles.</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE SECURITY POLICY readYourRecords SET READ = (owner = $currentUser)</code>
orientdb> <code class="lang-sql userinput">GRANT readYourRecords ON database.class.Person TO aRoleName</code>
</pre>
<pre>
orientdb> <code class="lang-sql userinput">INSERT INTO Person SET name = 'John', owner = #6:15</code>
</pre>
<p>In this case, when records of <code>Person</code> class are loaded (eg. with a SQL query), the predicate <code>owner = $currentUser</code> is evaluated on each record; if the result of the evaluation is TRUE, then the record will be made available to the user, otherwise it will be just hidden (it's completely transparent on the user level, the user will just not see the record).</p>
<p>Predicates can be applied to all the record lifecycle.</p>
<p>In case the policy is applied to a class resource (eg. <code>database.class.ClassName</code>):</p>
<ul>
<li>CREATE predicate: is evaluated when a record is created, in case it returns FALSE, the user will have a security exception</li>
<li>READ predicate: is evaluated when the record is loaded, in case it returns FALSE, the record is not returned to the user</li>
<li>BEFORE UPDATE predicate: is evaluated during an UPDATE operation, passing the record in its original status (ie. before the modifications); in case it returns FALSE, the user will have a security exception</li>
<li>AFTER UPDATE predicate: is evaluated during an UPDATE operation, passing the record in its new status (ie. after the modifications); in case it returns FALSE, the user will have a security exception</li>
<li>DELETE predicate: is evaluated during a DELETE operation, passing the record in its  status before it's deleted; in case it returns FALSE, the user will have a security exception</li>
</ul>
<p>In case the policy is applied to a property resource (eg. <code>database.class.ClassName.propertyName</code>):</p>
<ul>
<li>CREATE predicate: is evaluated when a record is created, in case it returns FALSE, the user will have a security exception</li>
<li>READ predicate: is evaluated when the record is loaded, in case it returns FALSE, the record is returned to the user, but WITHOUT the property. The user won't be allowed to overwrite the property either.</li>
<li>BEFORE UPDATE predicate: is evaluated during an UPDATE operation, passing the record in its original status (ie. before the modifications); in case it returns FALSE, the user will have a security exception</li>
<li>AFTER UPDATE predicate: is evaluated during an UPDATE operation, passing the record in its new status (ie. after the modifications); in case it returns FALSE, the user will have a security exception</li>
<li>DELETE predicate: is evaluated during a DELETE operation, passing the record in its  status before it's deleted; in case it returns FALSE, the user will have a security exception</li>
</ul>
<p>If you want to remove read permissions, use the following command:</p>
<pre>
orientdb> <code class='lang-sql userinput'>REVOKE POLICY ON database.class.Person FROM aRoleName</code>
</pre>
<h3 id="run-time-checks"><a class="header" href="#run-time-checks">Run-time Checks</a></h3>
<p>OrientDB checks record-level security using a hook that injects the check before each CRUD operation:</p>
<ul>
<li><strong>Create Documents</strong>: Sets the current database's user in the <code>_allow</code> field.  To change this behavior, see <a href="security/Database-Security.html#customize-on-creation">Customize on Creation</a>.</li>
<li><strong>Read Documents</strong>: Checks if the current user, or its roles, are listed in the <code>_allow</code> or <code>_allowRead</code> fields.  If not, OrientDB skips the record.  This allows each query to work per user.</li>
<li><strong>Update Documents</strong>: Checks if the current user, or its roles, are listed in the <code>_allow</code> or <code>_allowUpdate</code> field.  If not, OrientDB raises an <code>OSecurityException</code> exception.</li>
<li><strong>Delete Documents</strong>: Checks if the current user, or its roles, are listed in the <code>_allow</code> or <code>_allowDelete</code> field.  If not, OrientDB raises an <code>OSecurityException</code> exception.</li>
</ul>
<p>The allow fields, (that is, <code>_allow</code>, <code>_allowRead</code>, <code>_allowUpdate</code>, and <code>_allowDelete</code>) can contain instances of <code>OUser</code> and <code>ORole</code> records, as both classes extend <code>OIdentity</code>.  Use the class <code>OUser</code> to allow single <a href="security/Database-Security.html#users">users</a> and use the class <code>ORole</code> to allow all users that are a part of that <a href="security/Database-Security.html#roles">role</a>.</p>
<h3 id="using-the-api"><a class="header" href="#using-the-api">Using the API</a></h3>
<p>In addition to managing record-level security features through the OrientDB console, you can also configure it through the Graph and Document API's.</p>
<ul>
<li>
<p><strong>Graph API</strong></p>
<pre><code class="language-java">OrientVertex v = graph.addVertex("class:Invoice");
v.setProperty("amount", 1234567);
graph.getRawGraph().getMetadata().getSecurity().allowUser(
      v.getRecord(), ORestrictedOperation.ALLOW_READ, "report");
v.save();
</code></pre>
</li>
<li>
<p><strong>Document API</strong></p>
<pre><code class="language-java">ODocument invoice = new ODocument("Invoice").field("amount", 1234567);
database.getMetadata().getSecurity().allowUser(
      invoice, ORestrictedOperation.ALLOW_READ, "report");
invoice.save();
</code></pre>
</li>
</ul>
<h3 id="customize-on-creation"><a class="header" href="#customize-on-creation">Customize on Creation</a></h3>
<p>By default, whenever you create a restricted record, (that is, create a class that extends the class <code>ORestricted</code>), OrientDB inserts the current user into the <code>_allow</code> field.  You can change this using custom properties in the class schema:</p>
<ul>
<li><code>onCreate.fields</code> Specifies the names of the fields it sets.  By default, these are <code>_allow</code>, but you can also specify <code>_allowRead</code>, <code>_allowUpdate</code>, <code>_allowDelete</code> or a combination of them as an alternative.  Use commas to separate multiple fields.</li>
<li><code>onCreate.identityType</code> Specifies whether to insert the user's object or its role (the first one).  By default, it is set to <code>user</code>, but you can also set it to use its <code>role</code>.</li>
</ul>
<p>For instance, say you wanted to prevent a user from deleting new posts:</p>
<pre>
orientdb> <code class='lang-sql userinput'>ALTER CLASS Post CUSTOM onCreate.fields=_allowRead,_allowUpdate</code>
</pre>
<p>Consider another example, where you want to assign a role instead of a user to new instances of <code>Post</code>.</p>
<pre>
orientdb> <code class="lang-sql userinput">ALTER CLASS Post CUSTOM onCreate.identityType=role</code>
</pre>
<h3 id="bypassing-security-constraints"><a class="header" href="#bypassing-security-constraints">Bypassing Security Constraints</a></h3>
<p>On occasion, you may need a role that can bypass restrictions, such as for backup or administrative operations.  You can manage this through the special permission <code>database.bypassRestricted</code>, by changing its value to <code>READ</code>.  By default, the role <code>admin</code> has this permission.</p>
<p>For security reasons, this permission is not inheritable.  In the event that you need to assign it to other roles in your database, you need to set it on each role.</p>
<h2 id="using-security"><a class="header" href="#using-security">Using Security</a></h2>
<p>Now that you have some familiarity with how security works in OrientDB, consider the use case of OrientDB serving as the database for a blog-like application.  The blog is accessible through the web and you need to implement various security features to ensure that it works properly and does not grant its users access to restricted content.</p>
<p>To begin, the administrator connects to the database and creates the document class <code>Post</code>, which extends <code>ORestricted</code>.  This ensures that users can only see their own entries in the blog and entries that are shared with them.</p>
<pre>
orientdb> <code class="lang-sql userinput">CONNECT REMOTE:localhost/blog admin admin</code>
orientdb> <code class="lang-sql userinput">CREATE CLASS Post EXTENDS ORestricted</code>

Class 'Post' created successfully.
</pre>
<p>The user Luke is registered in <code>OUser</code> as <code>luke</code>, with an <code>RID</code> of <code>#5:5</code>.  He logs into the database and creates a new blog, which is an instance of the class <code>Post</code>.</p>
<pre>
orientdb> <code class="lang-sql userinput">CONNECT REMOTE:localhost/blog luke lukepassword</code>
orientdb> <code class="lang-sql userinput">INSERT INTO Post SET title = "Yesterday in Italy"</code>

Created document #18:0

orientdb> <code class="lang-sql userinput">SELECT FROM Post</code>

-------+--------+--------------------
 RID   | _allow | title 
-------+--------+--------------------
 #18:0 | [#5:5] | Yesterday in Italy
-------+--------+--------------------
</pre>
<p>Independent of the users <code>admin</code> and <code>luke</code>, there is the user Steve.  Steve is registers with <code>OUser</code> as <code>steve</code>, he has an RID of <code>#5:6</code>.  Steve logs into OrientDB and also creates a new entry on the class <code>Post</code>:</p>
<pre>
orientdb> <code class="lang-sql userinput">CONNECT REMOTE:localhost/blog steve steve</code>
orientdb> <code class="lang-sql userinput">INSERT INTO Post SET title = "My Nutella Cake!"</code>

Created document #18:1

orientdb> <code class="lang-sql userinput">SELECT FROM Post</code>

-------+--------+------------------
 RID   | _allow | title
-------+--------+------------------
 #18:1 | [#5:6] | My Nutella Cake!
-------+--------+------------------
</pre>
<p>As you can see, the users Steve and Luke can only see the records that they have access to.  Now, after some editorial work, Luke is satisfied with the state of his blog entry <code>Yesterday in Italy</code>.  He is now ready to share it with others.  From the database console, he can do so by adding the user Steve's RID to the <code>_allow</code> field.</p>
<pre>
orientdb> <code class="lang-sql userinput">UPDATE #18:0 ADD _allow = #5:6</code>
</pre>
<p>Now, when Steve logs in, the same query from before gives him different results, since he can now see the content Luke shared with him.</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM Post</code>

-------+--------+---------------------
 RID   | _allow | title  
-------+--------+---------------------
 #18:0 | [#5:5] | Yesterday in Italy
 #18:1 | [#5:6] | My Nutella Cake!
-------+--------+---------------------
</pre>
<p>While this is an effective solution, it does have one minor flaw for Luke.  By adding Steve to the <code>_allow</code> list, Steve can not only read posts Luke makes, but he can also modify them.  While Luke may find Steve a reasonable person, he begins to have second thoughts about this blanket permission and decides to remove Steve from the <code>_allow</code> field and instead add him to the <code>_allowRead</code> field:</p>
<pre>
orientdb> <code class="lang-sql userinput">UPDATE #18:0 REMOVE _allow = 5:6</code>
orientdb> <code class="lang-sql userinput">UPDATE #18:0 ADD _allowRead = #5:6</code>
</pre>
<p>For the sake of argument, assume that Luke's misgivings about Steve have some foundation.  Steve decides that he does not like Luke's entry <code>Yesterday in Italy</code> and would like to remove it from the database.  He logs into OrientDB, runs <a href="security/../sql/SQL-Query.html"><code>SELECT</code></a> to find its RID, and attempts to <a href="security/../sql/SQL-Delete.html"><code>DELETE</code></a> the record:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM Post</code>

-------+--------+---------------------
 RID   | _allow | title
-------+--------+---------------------
 #18:0 | [#5:5] | Yesterday in Italy
 #18:1 | [#5:6] | My Nutella Cake!
-------+--------+---------------------

orientdb> <code class="lang-sql userinput">DELETE FROM #18:0</code>

!Error: Cannot delete record #18:0 because the access to the resource is restricted.
</pre>
<p>As you can see, OrientDB blocks the <a href="security/../sql/SQL-Delete.html"><code>DELETE</code></a> operation, given that the current user, Steve, does not have permission to do so on this resource.</p>
<h2 id="password-management"><a class="header" href="#password-management">Password Management</a></h2>
<p>OrientDB stores user passwords in the <code>OUser</code> records using the  <a href="https://en.wikipedia.org/wiki/PBKDF2">PBKDF2</a> HASH algorithm with a 24-bit length Salt per user for a configurable number of iterations.  By default, this number is 65,536 iterations.  You can change this account through the <code>security.userPasswordSaltIterations</code> global configuration.  Note that while a higher iteration count can slow down attacks, it also slows down the authentication process on legitimate OrientDB use.</p>
<p>In order to speed up password hashing, OrientDB uses a password cache, which it implements as an LRU with a maximum of five hundred entries.  You can change this setting through the <code>security.userPasswordSaltCacheSize</code> global configuration.  Giving this global configuration the value of <code>0</code> disables the cache.</p>
<blockquote>
<p><strong>NOTE</strong>: In the event that attackers gain access to the Java virtual machine memory dump, he could access this map, which would give them access to all passwords.  You can protect your database from this attack by disabling the in memory password cache.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="server-security"><a class="header" href="#server-security">Server Security</a></h1>
<p>Individual OrientDB servers can manage multiple databases at a time and each database can have its own set of users.  When using OrientDB through the HTTP protocol, the OrientDB server uses one realm per database.</p>
<div class="table-wrapper"><table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td><img src="security/../images/warning.png" alt="" /></td><td>While OrientDB can function as a regular Web Server, it is not recommended that you expose it directly to the internet or to public networks.  Instead, always hide the OrientDB server within a private network.</td></tr>
</tbody></table>
</div>
<p>Server users are stored in the <code>config/orientdb-server-config.xml</code> configuration file, in the <code>&lt;users&gt;</code> element.</p>
<pre><code class="language-xml">    &lt;users&gt;
        &lt;user name="root" password="{PBKDF2WithHmacSHA256}55F3DEAE:DLJEJFDKY8:65536" resources="*" /&gt;
        &lt;user name="guest" password="{PBKDF2WithHmacSHA256}B36E7993C961:C8C8B36F3:65536" resources="connect,server.listDatabases,server.dblist" /&gt;
    &lt;/users&gt;
</code></pre>
<p>When the OrientDB server starts for the first time, it creates the user <code>root</code> automatically, by asking you to give the password in the terminal.  In the event that you do not specify a password, OrientDB generates a random password.  Beginning with version 2.2, OrientDB hashes the passwords using <code>PBKDF2WithHmacSHA256</code> algorithm if it's running on Java 8 or major, otherwise <code>PBKDF2WithHmacSHA1</code> with a configurable SALT.</p>
<p>For more information on security in Orientdb, see:</p>
<ul>
<li><a href="security/Database-Security.html">Database security</a></li>
<li><a href="security/Database-Encryption.html">Database Encryption</a></li>
<li><a href="security/Using-SSL-with-OrientDB.html">Secure SSL connections</a></li>
</ul>
<h2 id="configuration-8"><a class="header" href="#configuration-8">Configuration</a></h2>
<p>While the default users and passwords are fine while you are setting your system up, it would be inadvisable to leave them in production.  To help restrict untrusted  users from accessing the OrientDB server, add a new user and change the passwords in the <code>config/orientdb-server-config.xml</code> server configuration file.</p>
<p>To restrict unauthorized users from giving themselves privileges on the OrientDB server, disable write-access to the configuration file.  To help prevent them from viewing passwords, disable read-access as well.  Note that even if the passwords are hashed, there are many techniques available to crack the hash or otherwise guess the real password.</p>
<div class="table-wrapper"><table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td><img src="security/../images/warning.png" alt="" /></td><td>It is strongly recommended that you allow read/write access to the entire <code>config</code> directory only to the user that starts the OrientDB server.</td></tr>
</tbody></table>
</div>
<h2 id="managing-users"><a class="header" href="#managing-users">Managing Users</a></h2>
<p>Beginning with version 2.2, the OrientDB console provides a series of commands for managing users:</p>
<ul>
<li><a href="security/../console/Console-Command-List-Server-Users.html"><code>LIST SERVER USERS</code></a>: Displays all users.</li>
<li><a href="security/../console/Console-Command-Set-Server-User.html"><code>SET SERVER USER</code></a>: Creates or modifies a user.</li>
<li><a href="security/../console/Console-Command-Drop-Server-User.html"><code>DROP SERVER USER</code></a>: Drops a user.</li>
</ul>
<h2 id="server-resources"><a class="header" href="#server-resources">Server Resources</a></h2>
<p>Each user can declare which resources have access.  The wildcard <code>*</code> grants access to any resource.  By default, the user <code>root</code> has all privileges (<code>*</code>), so it can access all the managed databases and operations.</p>
<div class="table-wrapper"><table><thead><tr><th>Resources</th><th>Permission to</th></tr></thead><tbody>
<tr><td><code>database.create</code></td><td>Create a new database in the server</td></tr>
<tr><td><code>database.drop</code></td><td>Drop a database</td></tr>
<tr><td><code>database.exists</code></td><td>Check the existence of a database</td></tr>
<tr><td><code>database.freeze</code></td><td>Freeze the access to a database</td></tr>
<tr><td><code>database.release</code></td><td>Release a frozen database</td></tr>
<tr><td><code>database.passthrough</code></td><td>Allow access to all managed databases</td></tr>
<tr><td><code>server.config.get</code></td><td>Retrieve server's setting</td></tr>
<tr><td><code>server.config.set</code></td><td>Update server's setting</td></tr>
<tr><td><code>server.connect</code></td><td>Connect to a server</td></tr>
<tr><td><code>server.info</code></td><td>Retrieve server's information and statistics</td></tr>
<tr><td><code>server.listDatabases</code></td><td>Enlist available databases on the server</td></tr>
<tr><td><code>server.listDatabases.system</code></td><td>Include the OSystem database in the list of databases</td></tr>
<tr><td><code>server.replication</code></td><td>Execute a replication command from another server</td></tr>
<tr><td><code>server.replication.start</code></td><td>Start the replication of a database</td></tr>
<tr><td><code>server.replication.stop</code></td><td>Stop the replication of a database</td></tr>
<tr><td><code>server.replication.config</code></td><td>Update the replication configuration</td></tr>
<tr><td><code>server.shutdown</code></td><td>Shutdown a server</td></tr>
</tbody></table>
</div>
<p>For example,</p>
<pre><code class="language-xml">&lt;user name="replicator" password="repl" resources="database.passthrough"/&gt;
</code></pre>
<h2 id="securing-connections-with-ssl"><a class="header" href="#securing-connections-with-ssl">Securing Connections with SSL</a></h2>
<p>Beginning with version 1.7, you can further improve security on your OrientDB server by securing connections with SSL.  For more information on implementing this, see <a href="security/Using-SSL-with-OrientDB.html">Using SSL</a>.</p>
<h2 id="restoring-the-user-admin"><a class="header" href="#restoring-the-user-admin">Restoring the User admin</a></h2>
<p>In the event that something happens and you drop the class <code>OUser</code> or the user <code>admin</code>, you can use the following procedure to restore the user to your database.</p>
<ol>
<li>
<p>Ensure that the database is in the OrientDB server database directory, <code>$ORIENTDB_HOME/database/ folder</code>.</p>
</li>
<li>
<p>Launch the console or studio and log into the database with the user <code>root</code>.</p>
<pre>
$ <code class="lang-sh userinput"> $ORIENTDB_HOME/bin/console.sh</code>

OrientDB console v.X.X.X (build 0) www.orientdb.com
Type 'HELP' to display all the commands supported.
Installing extensions for GREMLIN language v.X.X.X

orientdb> <code class="lang-sql userinput">CONNECT remote:localhost/my_database root rootpassword</code>
</pre>
</li>
<li>
<p>Check that the class <code>OUser</code> exists:</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM OUser WHERE name = 'admin'</code>
</pre>
<ul>
<li>
<p>In the event that this command fails because the class <code>OUser</code> doesn't exist, create it:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE CLASS OUser EXTENDS OIdentity</code>
</pre>
</li>
<li>
<p>In the event that this command fails because the class `OIdentity doesn't exist, create it first:</p>
<pre>
orinetdb> <code class="lang-sql userinput">CREATE CLASS OIdentity</code>
</pre>
<p>Then repeat the above command, creating the class <code>OUser</code></p>
</li>
</ul>
</li>
<li>
<p>Check that the class <code>ORole</code> exists.</p>
<pre>
orientdb> <code class="lang-sql userinput">SELECT FROM ORole WHERE name = 'admin'</code>
</pre>
<ul>
<li>
<p>In the event that the class <code>ORole</code> doesn't exist, create it:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE CLASS ORole EXTENDS OIdentity</code>
</pre>
</li>
</ul>
</li>
<li>
<p>In the event that the user or role <code>admin</code> doesn't exist, run the following commands:</p>
<ul>
<li>
<p>In the event that the role <code>admin</code> doesn't exist, create it:</p>
<pre>
orientdb> <code class="lang-sql userinput">INSERT INTO ORole SET name = 'admin', mode = 1, 
          rules = { "database.bypassrestricted": 15 }</code>
</pre>
</li>
<li>
<p>In the event that the user <code>admin</code> doesn't exist, create it:</p>
<pre>
orientdb> <code class="lang-sql userinput">INSERT INTO OUser SET name = 'admin', 
          password = 'my-admin_password', status = 'ACTIVE', 
          rules = ( SELECT FROM ORole WHERE name = 'admin' )</code>
</pre>
</li>
</ul>
</li>
</ol>
<p>The user <code>admin</code> is now active again on your database.</p>
<h2 id="restoring-the-servers-user-root"><a class="header" href="#restoring-the-servers-user-root">Restoring the Server's User root</a></h2>
<ol>
<li>Open the <code>config/orientdb-server-config.xml</code> file and remove the "root" user entry</li>
<li>Remove the tag <code>&lt;isAfterFirstTime&gt;true&lt;/isAfterFirstTime&gt;</code> at the end of the file</li>
<li>On next restart of the server, a new root password is asked again</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="database-encryption-1"><a class="header" href="#database-encryption-1">Database Encryption</a></h1>
<p>Beginning with version 2.2, OrientDB can encrypt records on disk.  This prevents unauthorized users from accessing database content or even from bypassing OrientDB security.  OrientDB does not save the encryption key to the database.  You must provide it at run-time.  In the event that you lose the encryption key, the database, (or at least the parts of the database you have encrypted), you lose access to its content.</p>
<blockquote>
<p><strong>NOTE</strong>: Encryption parameters are  not supported on remote protocol. It can be used only with in embedded or configuring the settings on the server.</p>
</blockquote>
<p>Encryption works through the encryption interface.  It acts at the cluster (collection) level.  OrientDB encrypt data using <a href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard">AES</a>:</p>
<p>Encryption in OrientDB operates at the database-level.  You can have multiple databases, each with different encryption interfaces, running under the same server, (or, JVM, in the event that you run OrientDB embedded).  That said, you can use global configurations to define the same encryption rules for all databases open in the same JVM.  For instance, you can define rules through the Java API:</p>
<pre><code class="language-java">OGlobalConfiguration.STORAGE_ENCRYPTION_KEY.setValue("T1JJRU5UREJfSVNfQ09PTA==");
</code></pre>
<p>You can enable this at startup by passing these settings as JVM arguments:</p>
<pre>
$ <code class="lang-sh userinput">java ... -Dstorage.encryptionKey="T1JJRU5UREJfSVNfQ09PTA=="</code>
</pre>
<p>For more information on security in OrientDB, see the following pages:</p>
<ul>
<li><a href="security/Database-Security.html">Database security</a></li>
<li><a href="security/Server-Security.html">Server security</a></li>
<li><a href="security/Using-SSL-with-OrientDB.html">Secure SSL connections</a></li>
</ul>
<h2 id="creating-encrypted-databases"><a class="header" href="#creating-encrypted-databases">Creating Encrypted Databases</a></h2>
<p>You can create an encrypted database using either the console or through the Java API.  To create an encrypted database, is enough to set the encryption key by defining the <code>storage.encryptionKey</code> value through the <a href="security/../console/Console-Command-Config.html"><code>CONFIG</code></a> command, before the <a href="security/../console/Console-Command-Create-Database.html"><code>CREATE DATABASE</code></a> command.</p>
<pre>
orientdb> <code class="lang-sql userinput">CONFIG SET storage.encryptionKey T1JJRU5UREJfSVNfQ09PTA==</code>
orientdb> <code class="lang-sql userinput">CREATE DATABASE plocal:/tmp/db/encrypted-db user password  plocal </code>
</pre>
<p>To create an encrypted database through the Java API, define the encryption key as database configuration:</p>
<pre><code class="language-java">
try (final OrientDB orientDB = new OrientDB("embedded:" + dbDirectoryFile.getAbsolutePath(), OrientDBConfig.defaultConfig())) {
  final OrientDBConfig orientDBConfig = OrientDBConfig.builder()
     .addConfig(OGlobalConfiguration.STORAGE_ENCRYPTION_KEY, "T1JJRU5UREJfSVNfQ09PTA==").build();
  orientDB.create("encryption", ODatabaseType.PLOCAL, orientDBConfig);
}
       
</code></pre>
<p>Whether you use the console or the Java API, these commands encrypt the entire database on disk.  OrientDB does not store the encryption key within the database.  You must provide it at run-time.</p>
<h2 id="opening-encrypted-databases"><a class="header" href="#opening-encrypted-databases">Opening Encrypted Databases</a></h2>
<p>You can access an encrypted database through either the console or the Java API.  To do so through the console, set the encryption key with <code>storage.encryptionKey</code> then open the database.</p>
<pre>
orientdb> <code class="lang-sql userinput">CONFIG SET storage.encryptionKey T1JJRU5UREJfSVNfQ09PTA==</code>
orientdb> <code class="lang-sql userinput">CONNECT plocal:/tmp/db/encrypted-db user password</code>
</pre>
<p>When opening through the Java API, you need to just provide the encryption key.</p>
<pre><code class="language-java">try (final OrientDB orientDB = new OrientDB("embedded:" + dbDirectoryFile.getAbsolutePath(), OrientDBConfig.defaultConfig())) {
  final OrientDBConfig orientDBConfig = OrientDBConfig.builder()
     .addConfig(OGlobalConfiguration.STORAGE_ENCRYPTION_KEY, "T1JJRU5UREJfSVNfQ09PTA==").build();
  orientDB.open("encryption", "user", "password, orientDBConfig);
}
</code></pre>
<p>In the event that you pass a null or invalid key when you open the database, OrientDB raises an <code>ODatabaseException</code> exception.</p>
<blockquote>
<p><strong>Note</strong>: from version 3.x cluster encryption is no longer supported.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ssltls"><a class="header" href="#ssltls">SSL/TLS</a></h1>
<p>Beginning with version 1.7, OrientDB provides support for securing its HTTP and BINARY protocols through SSL.  For distributed SSL, see the HazelCast documentation.</p>
<p>Note that wherever SSL is referenced know that TLS 1.2 is enforced.</p>
<p>For more information on securing OrientDB, see the following pages:</p>
<ul>
<li><a href="security/Database-Security.html">Database security</a></li>
<li><a href="security/Server-Security.html">Server security</a></li>
<li><a href="security/Database-Encryption.html">Database Encryption</a></li>
</ul>
<h2 id="setting-up-the-key-and-trust-stores"><a class="header" href="#setting-up-the-key-and-trust-stores">Setting up the Key and Trust Stores</a></h2>
<p>In order to set up and manage certificates, OrientDB uses the Java Keytool.  Using certificates signed by a Certificate Authority (CA) is beyond the scope of this tutorial.  For more information on using the Java Keytool, see the <a href="http://docs.oracle.com/javase/7/docs/technotes/tools/index.html#security">Documentation</a>.</p>
<p>To create key and trust stores that reference a self-signed certificate, use the following guide:</p>
<ol>
<li>
<p>Using Keytool, create a certificate for the server:</p>
<pre>
# <code class="lang-sh userinput">keytool -genkey -alias server -keystore orientdb.ks \
     -keyalg RSA -keysize 2048 -validity 3650</code>
</pre>
</li>
<li>
<p>Export the server certificate to share it with client:</p>
<pre>
# <code class="lang-sh userinput">keytool -export -alias server -keystore orientdb.ks \
       -file orientdb.cert</code>
</pre>
</li>
<li>
<p>Create a certificate/keystore for the console/clients:</p>
<pre>
# <code class="lang-sh userinput">keytool -genkey -alias console -keystore orientdb-console.ks \
       -keyalg RSA -keysize 2048 -validity 3650</code>
</pre>
</li>
<li>
<p>Create a trust-store for the client, then import the server certificate.</p>
<pre>
# <code class="lang-sql userinput">keytool -import -alias server -keystore orientdb-console.ts \
       -file orientdb.cert</code>
</pre>
<p>This establishes that the client trusts the server.</p>
</li>
</ol>
<p>You now have a self-signed certificate to use with OrientDB.  Bear in mind that for each remote client JVM you want to connect to the server, you need to repeat steps three and four.  Remember to change the alias, keystore and trust-store filenames accordingly.</p>
<h2 id="configuring-orientdb-for-ssl"><a class="header" href="#configuring-orientdb-for-ssl">Configuring OrientDB for SSL</a></h2>
<h3 id="server-configuration"><a class="header" href="#server-configuration">Server Configuration</a></h3>
<p>The server configuration file, <code>$ORIENTDB_HOME/config/orientdb-server-config.xml</code>, does not use SSL by default.  To enable SSL on a protocol listener, you must change the <code>socket</code> attribute to the <code>&lt;listener&gt;</code> value from <code>default</code> to one of your configured <code>&lt;socket&gt;</code> definitions.</p>
<p>There are two default definitions available: <code>ssl</code> and <code>https</code>.  For most use cases this is sufficient, however you can define more if you want to secure different listeners with their own certificates or would like to use a custom factory implementations. When using the <code>ssl</code> implementation, bear in mind that the default port for OrientDB SSL is <code>2434</code>.  You need to change your port range to <code>2434-2440</code>.</p>
<p>By default, the OrientDB server looks for its keys and trust-stores in <code>$ORIENTDB_HOME/config/cert</code>.  You can configure it using the <code>&lt;socket&gt;</code> parameters.  Be sure that all the key and trust-stores created in the previous setup are in the correct directory and that the passwords used are correct.</p>
<blockquote>
<p><strong>NOTE</strong>: Paths are relative to <code>$ORIENTDB_HOME</code>.  OrientDB also supports absolute paths.</p>
</blockquote>
<pre><code class="language-xml">&lt;sockets&gt;
  &lt;socket implementation="com.orientechnologies.orient.server.network.OServerSSLSocketFactory" name="ssl"&gt;
    &lt;parameters&gt;
      &lt;parameter value="false" name="network.ssl.clientAuth"/&gt;
      &lt;parameter value="config/cert/orientdb.ks" name="network.ssl.keyStore"/&gt;
      &lt;parameter value="password" name="network.ssl.keyStorePassword"/&gt;
       &lt;!-- NOTE: We are using the same store for keys and trust.
        	This will change if client authentication is enabled. See Configuring Client section --&gt;

      &lt;parameter value="config/cert/orientdb.ks" name="network.ssl.trustStore"/&gt;
      &lt;parameter value="password" name="network.ssl.trustStorePassword"/&gt;
    &lt;/parameters&gt;
  &lt;/socket&gt;

  ...

  &lt;listener protocol="binary" ip-address="0.0.0.0" port-range="2424-2430" socket="default"/&gt;
  &lt;listener protocol="binary" ip-address="0.0.0.0" port-range="2434-2440" socket="ssl"/&gt;
</code></pre>
<h3 id="console-configuration"><a class="header" href="#console-configuration">Console Configuration</a></h3>
<p>For remote connections using the console, you need to make a few changes to to <code>console.sh</code>, enable SSL:</p>
<ol>
<li>
<p>Confirm that your <code>KEYSTORE</code>, <code>TRUSTSTORE</code> and respective <code>PASSWORD</code> variables are correctly set.</p>
</li>
<li>
<p>In the <code>SSL_OPTS</code> definition, set <code>client.ssl.enabled</code> system property to <code>true</code>.</p>
</li>
</ol>
<h3 id="client-configuration"><a class="header" href="#client-configuration">Client Configuration</a></h3>
<p>To configure remote clients, use the standard Java system property patterns:</p>
<ul>
<li><code>client.ssl.enabled</code>: Use this to enable/disable SSL.  The property accepts <code>true</code> or <code>false</code>.  You only need to define this when using remote binary client connections.</li>
<li><code>javax.net.ssl.keyStore</code>: Define the path to the keystore.</li>
<li><code>javax.net.ssl.keyStorePassword</code>: Defines the password to the keystore.</li>
<li><code>javax.net.ssl.trustStore</code>: Defines the path to the trust-store.</li>
<li><code>javax.net.ssl.trustStorePassword</code>: Defines the password to the trust-store.</li>
</ul>
<p>Use the third and fourth steps from <a href="security/Using-SSL-with-OrientDB.html#setting-up-the-key-and-trust-stores">Setting up the Key and Trust Stores</a> section above to create the client certificates and server trust.  The paths to the stores are client specific, but do not need to be the same as the server.</p>
<p>Note, if you would like to use key and/ore trust-stores other than that of the default JVN, you need to define the following variables as well:</p>
<ul>
<li><code>client.ssl.keyStore</code>: Defines the path to the keystore.</li>
<li><code>client.ssl.keyStorePass</code>: Defines the keystore password.</li>
<li><code>client.ssl.trustStore</code>: Defines the path to the trust-store.</li>
<li><code>client.ssl.trustStorePass</code>: Defines the password to the trust-store.</li>
</ul>
<p>Consider the following example, configuring SSL from the command-line through Java:</p>
<pre>
$ <code class="lang-sh userinput">java -Dclient.ssl.enabled=false \
      -Djavax.net.ssl.keyStore=</path/to/keystore> \
      -Djavax.net.ssl.keyStorePassword=<keystorepass> \  
      -Djavax.net.ssl.trustStore=</path/to/truststore> \
      -Djavax.net.ssl.trustStorePassword=<truststorepass></code>
</pre>
<p>As an alternative, you can define these variables through the Java API:</p>
<pre><code class="language-java">System.setProperty("client.ssl.enabled", &lt;"true"|"false"&gt;); # This will only be needed for remote binary clients
System.setProperty("javax.net.ssl.keyStore", &lt;/path/to/keystore&gt;);
System.setProperty("javax.net.ssl.keyStorePassword", &lt;keystorepass&gt;);
System.setProperty("javax.net.ssl.trustStore", &lt;/path/to/truststore&gt;);
System.setProperty("javax.net.ssl.trustStorePassword", &lt;truststorepass&gt;);
</code></pre>
<p>To verify or authenticate client certificates, you need to take a few additional steps on the server:</p>
<ol>
<li>
<p>Export the client certificate, so that you can share it with the server:</p>
<pre>
# <code class="lang-sh userinput">keytool -export -alias <client_alias> \
      -keystore <client.ks> -file client_cert</code>
</pre>
<p>Alternatively, you can do this through the console:</p>
<pre>
# <code class="lang-sh userinput">keytool -export -alias console -keystore orientdb-console.ks \
      -file orientdb-console.cert</code>
</pre>
</li>
<li>
<p>If you do not have a trust-store for the server, create one and import the client certificate.  This establishes that the server trusts the client:</p>
<pre>
# <code class="lang-sh userinput">keytool -import -alias <client_alias> -keystore orientdb.ts \
      -file client_cert</code>
</pre>
<p>Alternatively, you can manage the same through the console:</p>
<pre>
# <code class="lang-sh userinput">keytool -import -alias console -keystore orientdb.ts \ 
      -file orientdb-console.cert</code>
</pre>
</li>
</ol>
<p>In the server configuration file, ensure that you have client authentication enabled for the <code>&lt;socket&gt;</code> and that the trust-store path and password are correct:</p>
<pre><code class="language-xml">  &lt;sockets&gt;
    &lt;socket implementation="com.orientechnologies.orient.server.network.OServerSSLSocketFactory" name="ssl"&gt;
      &lt;parameters&gt;
        &lt;parameter value="true" name="network.ssl.clientAuth"/&gt;
        &lt;parameter value="config/cert/orientdb.ks" name="network.ssl.keyStore"/&gt;
        &lt;parameter value="password" name="network.ssl.keyStorePassword"/&gt;

        &lt;!-- NOTE: We are using the trust store with the imported client cert. You can import as many client as you would like --&gt;
        &lt;parameter value="config/cert/orientdb.ts" name="network.ssl.trustStore"/&gt;
        &lt;parameter value="password" name="network.ssl.trustStorePassword"/&gt;
      &lt;/parameters&gt;
    &lt;/socket&gt;
    ...
&lt;/sockets&gt;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-security-configuration"><a class="header" href="#orientdb-security-configuration">OrientDB Security Configuration</a></h1>
<p>The new OrientDB security system uses a JSON configuration file that's located by default in the <em>config</em> directory.  The default name of the file is <em>security.json</em>, but it can be overridden by setting the "server.security.file" property in <em>orientdb-server-config.xml</em> or by setting the global server property, "server.security.file".</p>
<p>The security.json configuration file may contain up to eight global properties: "enabled", "debug", "server", "authentication", "passwordValidator", "ldapImporter", and "auditing".</p>
<p>Here's a description of each top-level property in the security.json file.</p>
<div class="table-wrapper"><table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody>
<tr><td>"enabled"</td><td>If set to true (the default), the OrientDB security module that provides external authentication, authorization, password validation, LDAP import, and advanced auditing will be enabled.</td></tr>
<tr><td>"debug"</td><td>When set to true (false is the default), additional context information will be written to the OrientDB server log pertaining to the security system's operation.</td></tr>
<tr><td>"server"</td><td>This property is an object with one sub-property, "createDefaultUsers".  It is described below.</td></tr>
<tr><td>"authentication"</td><td>This property is an object with two sub-properties, "allowDefault" and "authenticators", and it is described in greater detail below.  Its purpose defines the available security authenticators.</td></tr>
<tr><td>"passwordValidator"</td><td>This property is also an object and defines the parameters required for the security system's password validator when enabled.  It is described in detail below.</td></tr>
<tr><td>"ldapImporter"</td><td>This property is an object with up to five sub-properties, and it defines the LDAP importer object.  See below for more details.</td></tr>
<tr><td>"auditing"</td><td>This property is also an object and contains two sub-properties, "class" and "enabled", and is described below.</td></tr>
</tbody></table>
</div>
<h2 id="server-2"><a class="header" href="#server-2">"server"</a></h2>
<p>The "server" object contains one property called "createDefaultUsers".</p>
<div class="table-wrapper"><table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody>
<tr><td>"createDefaultUsers"</td><td>When set to true (the default), the default OrientDB users will be created for new databases and the default orientdb-server-config.xml users will be created on the first run of the server.</td></tr>
</tbody></table>
</div>
<h2 id="authentication"><a class="header" href="#authentication">"authentication"</a></h2>
<p>The "authentication" object specifies security authenticators for OrientDB and their order.  Here's an example:</p>
<pre><code>"authentication" :
{
	"allowDefault" : true,

	"authenticators" :
	[
		{
			"name"		: "Kerberos",
			"class"		: "com.orientechnologies.security.kerberos.OKerberosAuthenticator",
			"enabled"	: true,
			"debug"		: false,
	
			"krb5_config"	: "/etc/krb5.conf",
			
			"service" :
			{
				"ktname" 	: "/etc/keytab/kerberosuser",
				"principal"	: "kerberosuser/kerberos.domain.com@REALM.COM"
			},
	
			"spnego" :
			{
				"ktname" 	: "/etc/keytab/kerberosuser",
				"principal"	: "HTTP/kerberos.domain.com@REALM.COM"
			},
	
			"client" :
			{
				"useTicketCache"	: true,
				"principal" 		: "kerberosuser@REALM.COM",
				"renewalPeriod"		: 300
			}
		},
		
		{
			"name"				: "Password",
			"class"				: "com.orientechnologies.orient.server.security.authenticator.ODefaultPasswordAuthenticator",
			"enabled"			: true,
			"users" 			:
			[
				{ "username" : "guest", "resources" : "connect,server.listDatabases,server.dblist" }
			]
		},

		{
			"name"				: "ServerConfig",
			"class"				: "com.orientechnologies.orient.server.security.authenticator.OServerConfigAuthenticator",
			"enabled"			: true
		},

		{
			"name"				: "SystemAuthenticator",
			"class"				: "com.orientechnologies.orient.server.security.authenticator.OSystemUserAuthenticator",
			"enabled"			: true
		}	]
}
</code></pre>
<p>Notice that "authentication" has two sub-properties, "allowDefault" and "authenticators".  The "allowDefault" property, when set to true, tells the security system that if authentication fails for all the specified authenticators to allow OrientDB's default (built-in) authentication mechanism to also try.</p>
<p>The "authenticators" property is an array of authenticator objects.  The order of the authenticators is significant, as the first is the primary authenticator.  Subsequent authenticators in the list are called, if the first authenticator fails.  This continues until either authentication succeeds or the list of authenticators is exhausted.  If the "allowDefault" property is true and authentication is being called for a database, then OrientDB's native database security will then be attempted.</p>
<p>Each authenticator object supports at least three properties: "name", "class", and "enabled".</p>
<div class="table-wrapper"><table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody>
<tr><td>"name"</td><td>The "name" property must be unique among the authenticators and can be used by other security components to reference which authenticator is used to authenticate a service.</td></tr>
<tr><td>"class"</td><td>The "class" property defines which authenticator component is instantiated for the security authenticator.  The available authenticators are: ODefaultPasswordAuthenticator, OKerberosAuthenticator, OServerConfigAuthenticator, and OSystemUserAuthenticator.  All are described below.</td></tr>
<tr><td>"enabled"</td><td>When set to true, the authenticator is used as part of the chain of authenticators.  If set to false, the authenticator is ignored.</td></tr>
</tbody></table>
</div>
<h3 id="odefaultpasswordauthenticator"><a class="header" href="#odefaultpasswordauthenticator">ODefaultPasswordAuthenticator</a></h3>
<p><em>ODefaultPasswordAuthenticator</em> supports an additional "users" property which contains an array of user objects.  Each user object must contain "username" and "resource" properties.  An optional "password" property is also permitted if authentication using a password is required.</p>
<p>Each user object can be used for authorization of the specified resources as well as authentication, if a password is present.</p>
<p>The full classpath for the "class" property is "com.orientechnologies.orient.server.security.authenticator.ODefaultPasswordAuthenticator".</p>
<p>Here's an example of the "users" property:</p>
<pre><code>	"users" 				:
	[
		{ "username" : "someuser", "resources" : "*" }
	]
</code></pre>
<p>The "resources" property uses the same format as the "resources" property for each <code>&lt;user&gt;</code> in the <code>&lt;users&gt;</code> section of the orientdb-server-config.xml file.</p>
<p>Additionally, <em>ODefaultPasswordAuthenticator</em> supports a "caseSensitive" property.  It defaults to true.  When set to false, usernames are not case-sensitive when retrieved for password or resources look-up.</p>
<h3 id="oserverconfigauthenticator"><a class="header" href="#oserverconfigauthenticator">OServerConfigAuthenticator</a></h3>
<p><em>OServerConfigAuthenticator</em> utilizes the <users> element in the orientdb-server-config.xml file and permits its list of server users to be used for authentication and authorization of resources.  Beyond "name", "class", and "enabled", <em>OServerConfigAuthenticator</em> requires no additional properties.</p>
<p>The full classpath for the "class" property is "com.orientechnologies.orient.server.security.authenticator.OServerConfigAuthenticator".</p>
<p><em>OServerConfigAuthenticator</em>'s "caseSensitive" property is always false, meaning that usernames are not case-sensitive when retrieved for password or resources look-up.</p>
<h3 id="osystemuserauthenticator"><a class="header" href="#osystemuserauthenticator">OSystemUserAuthenticator</a></h3>
<p><em>OSystemUserAuthenticator</em> implements authentication and authorization support for <em>system users</em> that reside in the OrientDB system database.  Beyond "name", "class", and "enabled", <em>OSystemUserAuthenticator</em> requires no additional properties.</p>
<p>The full classpath for the "class" property is "com.orientechnologies.orient.server.security.authenticator.OSystemUserAuthenticator".</p>
<h3 id="osecuritysymmetrickeyauth"><a class="header" href="#osecuritysymmetrickeyauth">OSecuritySymmetricKeyAuth</a></h3>
<p><em>OSecuritySymmetricKeyAuth</em> implements support for symmetric key authentication for server users.</p>
<p>Here's an example:</p>
<pre><code>"authenticators": [
	{
		"name": "SymmetricKey-Key",
		"class": "com.orientechnologies.agent.security.authenticator.OSecuritySymmetricKeyAuth",
		"enabled": true,
		"users": [
			{
				"username": "sysadmin",
				"resources": "*",
				"properties" :
				{
					"key" : "8BC7LeGkFbmHEYNTz5GwDw==",
					"keyAlgorithm" : "AES"
				}
			}
		]
	}
]
</code></pre>
<p>The authenticator class is "com.orientechnologies.agent.security.authenticator.OSecuritySymmetricKeyAuth".</p>
<p>Each <code>user</code> has a "properties" field that can specify an actual key, a path pointing to a file with the key inside, or a KeyStore containing the key.  Each is mutually exclusive.</p>
<h4 id="key"><a class="header" href="#key">"key"</a></h4>
<p>The <code>key</code> property is a Base64-encoded string of a secret key.  The <code>keyAlgorithm</code> property must also be used with <code>key</code>.</p>
<h4 id="keyfile"><a class="header" href="#keyfile">"keyFile"</a></h4>
<p>The <code>keyFile</code> property is a path to a file containing a Base64-encoded secret key string.  The <code>keyAlgorithm</code> property must also be used with <code>keyFile</code>.</p>
<p>Here's an example:</p>
<pre><code>"properties" :
{
	"keyFile" : "${ORIENTDB_HOME}/config/AES.key",
	"keyAlgorithm" : "AES"
}
</code></pre>
<h4 id="keystore"><a class="header" href="#keystore">"keyStore"</a></h4>
<p>The <code>keyStore</code> property is a JSON object that contains four sub-properties.</p>
<p>Here's an example of the <code>keyStore</code> property and its sub-properties.</p>
<p>"properties" :
{
"keyStore" :
{
"file" 			: "${ORIENTDB_HOME}/config/test.jks",
"password" 		: "password",
"keyAlias"		: "keyAlias",
"keyPassword"	: "password"
}
}</p>
<h5 id="file-1"><a class="header" href="#file-1">"file"</a></h5>
<p>The <code>file</code> property is a path to a Java KeyStore file that contains the secret key.  Note that the <code>JCEKS</code> KeyStore format must be used to hold secret keys.</p>
<h5 id="password"><a class="header" href="#password">"password"</a></h5>
<p>The <code>password</code> property holds the password for the KeyStore file.  It is optional.</p>
<h5 id="keyalias"><a class="header" href="#keyalias">"keyAlias"</a></h5>
<p>The <code>keyAlias</code> property is the alias name of the secret key in the KeyStore file.  It is required.</p>
<h5 id="keypassword"><a class="header" href="#keypassword">"keyPassword"</a></h5>
<p>The <code>keyPassword</code> property holds the password for the secret key in the KeyStore and is optional.</p>
<h3 id="osystemsymmetrickeyauth"><a class="header" href="#osystemsymmetrickeyauth">OSystemSymmetricKeyAuth</a></h3>
<p><em>OSystemSymmetricKeyAuth</em> implements support for symmetric key authentication for system users.</p>
<p>Here's an example:</p>
<pre><code>"authenticators": [
	{
		"name": "OSystemSymmetricKey",
		"class": "com.orientechnologies.agent.security.authenticator.OSystemSymmetricKeyAuth",
		"enabled": true
	}
]
</code></pre>
<p>The authenticator class is "com.orientechnologies.agent.security.authenticator.OSystemSymmetricKeyAuth".</p>
<p>Each system user will have an embedded-JSON "properties" field that supports the same sub-properties as the <code>OSecuritySymmetricKeyAuth</code> authenticator.</p>
<h3 id="okerberosauthenticator"><a class="header" href="#okerberosauthenticator">OKerberosAuthenticator</a></h3>
<p><em>OKerberosAuthenticator</em> provides support for Kerberos/SPNEGO authentication.  In addition to the usual "name", "class", and "enabled" properties, the <em>OKerberosAuthenticator</em> component also supports "debug", "krb5_config", "service", "spnego", and "client" properties.  All of these properties are defined in greater detail below.</p>
<p>The full classpath for the "class" property is "com.orientechnologies.security.kerberos.OKerberosAuthenticator".</p>
<h4 id="debug"><a class="header" href="#debug">"debug"</a></h4>
<p>When set to true, all of the Kerberos and SPNEGO authentication are displayed in the server's logfile.  This can be very useful when debugging authentication problems.</p>
<h4 id="krb5_config"><a class="header" href="#krb5_config">"krb5_config"</a></h4>
<p>By default, the KRB5_CONFIG environment variable is used to tell the Java Kerberos libraries the location of the krb5.conf file.  However, the krb5_config property may be used to override this.</p>
<h4 id="service"><a class="header" href="#service">"service"</a></h4>
<p>The "service" property contains two sub-properties, "ktname" and "principal".</p>
<div class="table-wrapper"><table><thead><tr><th>Sub-Property</th><th>Description</th></tr></thead><tbody>
<tr><td>"ktname"</td><td>This specifies the location of the keytab file used to obtain the key for decrypting OrientDB client service tickets.  By default, the KRB5_KTNAME environment variable is used to determine the location of the server's keytab file.  However, the ktname property may be used to override this.</td></tr>
<tr><td>"principal"</td><td>This specifies the LDAP/AD user that's associated with the OrientDB SPN.  This is used to obtain the correct service key to decrypt service tickets from OrientDB clients.  This is a mandatory property.</td></tr>
</tbody></table>
</div>
<h4 id="spnego"><a class="header" href="#spnego">"spnego"</a></h4>
<p>The "spnego" property contains two sub-properties, "ktname" and "principal".</p>
<div class="table-wrapper"><table><thead><tr><th>Sub-Property</th><th>Description</th></tr></thead><tbody>
<tr><td>"ktname"</td><td>This specifies the location of the keytab file used to obtain the key for decrypting OrientDB SPNEGO service tickets.  By default (and the same as the "service" property), the KRB5_KTNAME environment variable is used to determine the location of the server's keytab file.  However, the "ktname" property may be used to override this.</td></tr>
<tr><td>"principal"</td><td>This specifies the LDAP/AD user that's associated with the OrientDB SPN.  This is used to obtain the correct service key to decrypt service tickets from OrientDB SPNEGO clients.  This is a mandatory property.</td></tr>
</tbody></table>
</div>
<h4 id="client-1"><a class="header" href="#client-1">"client"</a></h4>
<p>The "client" property is used by OrientDB for configuring the LDAP/AD importer user, and it may contain five different sub-properties: "ccname", "ktname", "principal", "useTicketCache", and "renewalPeriod".</p>
<div class="table-wrapper"><table><thead><tr><th>Sub-Property</th><th>Description</th></tr></thead><tbody>
<tr><td>"ccname"</td><td>By default, the KRB5CCNAME environment variable is used to determine the location of the local credential cache file.  However, the "ccname" property may be used to override this.  This is only used if "useTicketCache" is set to true.</td></tr>
<tr><td>"ktname"</td><td>By default, the KRB5_CLIENT_KTNAME environment variable is used to determine the location of the server's client keytab file.  However, the "ktname" property may be used to override this.  This is only used if "useTicketCache" is set to false.</td></tr>
<tr><td>"principal"</td><td>This is the name of the principal used with the client credentials when accessing the LDAP service.  It is a required property.</td></tr>
<tr><td>"useTicketCache"</td><td>Defaults to false.  If true, the local ticket cache will be used to provide the client credentials to the LDAP service.  The KRB5CCNAME environment variable is used to determine the location of the ticket cache if the "ccname" property is not specified.  If false (or not present) then the specified keytab file (ktname) is used.</td></tr>
<tr><td>"renewalPeriod"</td><td>This is an optional property, and it specifies how often the LDAP client service ticket is renewed (in minutes).   It defaults to 5 hours.</td></tr>
</tbody></table>
</div>
<h2 id="passwordvalidator"><a class="header" href="#passwordvalidator">"passwordValidator"</a></h2>
<p>The "passwordValidator" object specifies an optional password validator that the OrientDB security system uses when applying new passwords.  The supported properties of the password validator object depend on the type of object specified but always contain at least "class" and "enabled".  The "class" property defines which password validator component is instantiated.  The "enabled" property (defaults to true) specifies whether the password validator component is active or not.</p>
<p>OrientDB ships with an <em>ODefaultPasswordValidator</em> component.  Its properties are defined below, and each is only required if it's included in the "passwordValidator" property.</p>
<p>The full classpath for the "class" property is "com.orientechnologies.security.password.ODefaultPasswordValidator".</p>
<h3 id="odefaultpasswordvalidator"><a class="header" href="#odefaultpasswordvalidator">ODefaultPasswordValidator</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody>
<tr><td>"minimumLength"</td><td>This property defines the minimum number of characters required in the password.</td></tr>
<tr><td>"numberRegEx"</td><td>This property defines the regular expression for the minimum count of required numbers and what symbols are considered numbers.</td></tr>
<tr><td>"uppercaseRegEx"</td><td>This property defines the regular expression for the minimum count of required uppercase characters and what symbols are considered uppercase characters.</td></tr>
<tr><td>"specialRegEx"</td><td>This property defines the regular expression for the minimum count of special characters and what symbols are considered special characters.</td></tr>
</tbody></table>
</div>
<p>Here is an example of the <em>ODefaultPasswordValidator</em>'s configuration in the security.json file:</p>
<pre><code>"passwordValidator" :
{
	"class"				: "com.orientechnologies.security.password.ODefaultPasswordValidator",
	"minimumLength"		: 5,
	"numberRegEx"		: "(?:[0-9].*){2}",
	"uppercaseRegEx"	: "(?:[A-Z].*){3}",
	"specialRegEx"		: "(?:[^a-zA-Z0-9 ].*){2}"
}
</code></pre>
<h2 id="ldapimporter"><a class="header" href="#ldapimporter">"ldapImporter"</a></h2>
<p>The "ldapImporter" object defines the properties for the LDAP importer security component.  As with the other security components, the LDAP importer object always has a "class" property and optional "enabled" and "debug" properties.  The "class" property defines which LDAP importer component is instantiated.  The "enabled" property (defaults to true) specifies whether the LDAP importer component is active or not.</p>
<p>OrientDB provides a default OLDAPImporter component, and its properties are defined below.  The full classpath for the "class" property is "com.orientechnologies.security.ldap.OLDAPImporter".</p>
<h3 id="oldapimporter"><a class="header" href="#oldapimporter">OLDAPImporter</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody>
<tr><td>"period"</td><td>This property is in seconds and determines how often the LDAP synchronization occurs.</td></tr>
<tr><td>"databases"</td><td>This property contains an array of objects.  Each object represents an OrientDB database along with LDAP domains to import.</td></tr>
</tbody></table>
</div>
<h4 id="database-object"><a class="header" href="#database-object">Database Object</a></h4>
<p>Each database object contains three properties: "database", "ignoreLocal", and "domains".  The "database" property is just the name of the OrientDB database.  The "ignoreLocal" property is an optional boolean property that defaults to true.  When true it indicates that existing users in the specified database will not be deleted if they are not present in the imported LDAP users list.  The "domains" property is described below.</p>
<h5 id="domains"><a class="header" href="#domains">"domains"</a></h5>
<p>The "domains" property contains an array of objects, each with "domain", "servers", and "users" properties, and an optional "authentication" property.</p>
<div class="table-wrapper"><table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody>
<tr><td>"domain"</td><td>This property must be unique for each database object and is primarily used with the <em>_OLDAPUser</em> class within each OrientDB database.</td></tr>
<tr><td>"authentication"</td><td>The "authentication" property specifies which authentication mechanism should be used to communicate with the LDAP server.  Two options are currently supported: "GSSAPI" and "Simple".  If none is specified, then "GSSAPI" (Kerberos) is used.</td></tr>
<tr><td>"servers"</td><td>This property is an array of server objects, each specifying the URL of the LDAP server.  It is described below.</td></tr>
<tr><td>"users"</td><td>This property is an array of user objects, each specifying the baseDN, filter, and roles to use for importing.  It is described below.</td></tr>
</tbody></table>
</div>
<h6 id="servers"><a class="header" href="#servers">"servers"</a></h6>
<div class="table-wrapper"><table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody>
<tr><td>"url"</td><td>This property specifies the LDAP server's URL.  (ldaps is supported.)</td></tr>
<tr><td>"isAlias"</td><td>This is a boolean property.  When true, the hostname specified in the URL is treated as an alias, and the real address is queried followed by a reverse DNS lookup.  This is useful for a hostname that is an alias for multiple LDAP servers.  The "isAlias" property defaults to false and is not a mandatory property.</td></tr>
<tr><td>"principal"</td><td>When "authentication" is set to "Simple", this specifies the principal (user) value to use.</td></tr>
<tr><td>"credentials"</td><td>When "authentication" is set to "Simple", this specifies the credentials (password) value to use.</td></tr>
</tbody></table>
</div>
<h6 id="users-2"><a class="header" href="#users-2">"users"</a></h6>
<p>LDAP users are imported based on a starting location within the directory and filtered using a standard LDAP filter rule.</p>
<div class="table-wrapper"><table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody>
<tr><td>"baseDN"</td><td>The "basedDN" property specifies the distinguished name of the starting point for the LDAP import, e.g., "CN=Users,DC=ad,DC=domain,DC=com".</td></tr>
<tr><td>"filter"</td><td>This property specifies the LDAP filter to use for importing users.  Here's a simple example: "(&amp;(objectCategory=person)(objectclass=user)(memberOf=CN=ODBUser,CN=Users,DC=ad,DC=domain,DC=com))".</td></tr>
<tr><td>"roles"</td><td>This is an array of strings, specifying the corresponding OrientDB roles that will be assigned to each user that is imported from the current group.</td></tr>
</tbody></table>
</div>
<p>As an alternative to the "users" property in the security configuration file, <em>OLDAPImporter</em> also supports using a class in the database, called <em>_OLDAPUser</em>, for importing LDAP users based on the same properties.  See below for more details.</p>
<h3 id="example-191"><a class="header" href="#example-191">Example</a></h3>
<p>Here's an example of the "ldapImporter" property:</p>
<pre><code>"ldapImporter" :
{
	"class"		: "com.orientechnologies.security.ldap.OLDAPImporter",
	"enabled"	: true,
	"debug"		: false,
	"period"	: 60,
	"databases" :
	[
		{
			"database"		: "MyDB",
			"ignoreLocal"	: true,
			"domains"		: 
			[
				{
					"domain"		: "ad.domain.com",
					"authentication" : "GSSAPI",
					
					"servers"	:
					[
						{
							"url"		: "ldap://alias.ad.domain.com:389",
							"isAlias"	: true
						}
					],
					
					"users" :
					[
						{
							"baseDN"	: "CN=Users,DC=ad,DC=domain,DC=com",
							"filter"	: "(&amp;(objectCategory=person)(objectclass=user)(memberOf=CN=ODBUser,CN=Users,DC=ad,DC=domain,DC=com))",
							"roles"		: ["reader", "writer"]
						},
						{
							"baseDN"	: "CN=Users,DC=ad,DC=domain,DC=com",
							"filter"	: "(&amp;(objectCategory=person)(objectclass=user)(memberOf=CN=ODBAdminGroup,CN=Users,DC=ad,DC=domain,DC=com))",
							"roles"		: ["admin"]
						}
					]
				}
			]
		}
	]
}
</code></pre>
<h3 id="_oldapuser-class"><a class="header" href="#_oldapuser-class"><em>_OLDAPUser</em> Class</a></h3>
<p>The OrientDB <em>_OLDAPUser</em> class can be used in place of or in addition to the "users" section of "ldapImporter".</p>
<p>The class has four properties defined: <em>Domain</em>, <em>BaseDN</em>, <em>Filter</em>, and <em>Roles</em>.</p>
<div class="table-wrapper"><table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody>
<tr><td>Domain</td><td>The <em>Domain</em> property must match the "domain" property of a domain object in the "domains" array of an "ldapImporter" database object.</td></tr>
<tr><td>BaseDN</td><td>This property is equivalent to the "baseDN" property of a user object in the "users" array.</td></tr>
<tr><td>Filter</td><td>This property is equivalent to the "filter" property of a user object in the "users" array.</td></tr>
<tr><td>Roles</td><td>The <em>Roles</em> property is equivalent to the "roles" array of a user object in the "users" array.  However, the value of <em>Roles</em> is a single string, and each role is separated by a comma.</td></tr>
</tbody></table>
</div>
<h2 id="auditing"><a class="header" href="#auditing">"auditing"</a></h2>
<p>The <em>auditing</em> component of the new security system is configured with the "auditing" object.  It has four possible properties, the usual "class" and "enabled" properties, and "distributed" and "systemImport" properties.</p>
<h3 id="distributed-2"><a class="header" href="#distributed-2">"distributed"</a></h3>
<p>The <em>distributed</em> property is an object and is used to configure what node events are recorded in the auditing log.</p>
<p>The <em>distributed</em> object may contain these properties:</p>
<div class="table-wrapper"><table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody>
<tr><td>"onNodeJoinedEnabled"</td><td>If <code>true</code>, enables auditing of node joined events. The default is <code>false</code>.</td></tr>
<tr><td>"onNodeJoinedMessage"</td><td>This is a custom message stored in the <code>note</code> field of the auditing record on node joined events. It supports the dynamic binding of values, see <em>Customing the Message</em> below.</td></tr>
<tr><td>"onNodeLeftEnabled"</td><td>If <code>true</code>, enables auditing of node left events. The default is <code>false</code>.</td></tr>
<tr><td>"onNodeLeftMessage"</td><td>This is a custom message stored in the <code>note</code> field of the auditing record on node left events. It supports the dynamic binding of values, see <em>Customing the Message</em> below.</td></tr>
</tbody></table>
</div>
<h4 id="customing-the-message"><a class="header" href="#customing-the-message">Customing the Message</a></h4>
<p>The variable <code>${node}</code> will be substituted in the specified message, if node joined or node left auditing is enabled.</p>
<h4 id="example-192"><a class="header" href="#example-192">Example</a></h4>
<p>Here's an example of a "distributed" section:</p>
<pre><code>  "auditing": {
    "class": "com.orientechnologies.security.auditing.ODefaultAuditing",
    "enabled": true,
    "distributed": {
      "onNodeJoinedEnabled": true,
      "onNodeJoinedMessage": "Node ${node} has joined...",
      "onNodeLeftEnabled": true,
      "onNodeLeftMessage": "Node ${node} has left..."
    }
  }
</code></pre>
<h3 id="systemimport"><a class="header" href="#systemimport">"systemImport"</a></h3>
<p>The <em>systemImport</em> property is an object and is used for importing a database's auditing log into the system database, where all new auditing is stored.</p>
<p>Each auditing log record from the specified databases is moved to a cluster in the new system database with the name <em>databasename</em>_auditing.</p>
<p>The <em>systemImport</em> object may contain these properties:</p>
<div class="table-wrapper"><table><thead><tr><th>Property</th><th>Description</th><th>Default Value</th></tr></thead><tbody>
<tr><td>"enabled"</td><td>When set to true, the audit log importer will run for the specified databases.</td><td>false</td></tr>
<tr><td>"databases"</td><td>This property is a list of database names that will have their auditing logs imported.</td><td>none</td></tr>
<tr><td>"auditingClass"</td><td>This specifies the name of the auditing class used in the database being imported.</td><td><em>AuditingLog</em></td></tr>
<tr><td>"limit"</td><td>The <em>limit</em> property indicates how many records will be imported during each <em>iteration</em> of the importer.  To reduce the impact on the system, the importer retrieves a block of auditing log records for each <em>iteration</em> and then sleeps before beginning again.</td><td>1000</td></tr>
<tr><td>"sleepPeriod"</td><td>This represents (in milliseconds) how long the importer sleeps after each <em>iteration</em>.</td><td>1000</td></tr>
</tbody></table>
</div>
<p>The importer stops for each database once all the auditing log records have been transferred to the system database.</p>
<p>Here's an example of a "systemImport" section:</p>
<pre><code>  "auditing": {
    "class": "com.orientechnologies.security.auditing.ODefaultAuditing",
    "enabled": true,
    "systemImport": {
      "enabled": true,
      "databases": ["MyDB", "MyOtherDB", "OneMoreDB"],
      "auditingClass": "AuditingLog",
      "limit": 1000,
      "sleepPeriod": 2000
    }
  }
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-kerberos-client-examples"><a class="header" href="#orientdb-kerberos-client-examples">OrientDB Kerberos Client Examples</a></h1>
<p>The Java API client is dependent on the <em>KRB5_CONFIG</em> and <em>KRB5CCNAME</em> environment variables being set.  Alternatively, you can pass them to the Java program via <code>-Dclient.krb5.config=…</code> and <code>-Dclient.krb5.ccname=…</code>, respectively.  You can also set them in your Java client program by calling <code>System.setProperty("client.krb5.config", "…./krb5.conf")</code>.</p>
<p>If a keytab is preferred, the <em>KRB5_CLIENT_KTNAME</em> environment variable may be set with the path to the keytab.  Alternatively, you may pass the keytab path as the system property <em>client.krb5.ktname</em>.</p>
<p>What enables the Kerberos client support is a system property called <em>client.credentialinterceptor</em>.  This must be set with the full package name to the Kerberos credential interceptor, as such:</p>
<p><code>java -Dclient.credentialinterceptor=com.orientechnologies.orient.core.security.kerberos.OKerberosCredentialInterceptor</code></p>
<p>or</p>
<p><code>System.setProperty("client.credentialinterceptor", "com.orientechnologies.orient.core.security.kerberos.OKerberosCredentialInterceptor");</code></p>
<p>In either case, this system property must be set to enable the Java client Kerberos support.</p>
<p>To use the client, you must specify the principal in the <em>username</em> field.  The <em>password</em> field may also specify the SPN to use to retrieve the service ticket, but if left as an empty string, then the SPN will be generated from the host portion of the URL as such: "OrientDB/" + host.</p>
<p>The principal must either exist as a server user or must exist as an OUser record in the database to be accessed.</p>
<h2 id="java-api-examples"><a class="header" href="#java-api-examples">Java API Examples</a></h2>
<p>The following is an example of how to use the OServerAdmin interface to send commands directly to the server:</p>
<pre><code>String url = "remote:server1.ad.somedomain.com:2424";
String pri = "OrientDBClient@AD.SOMEDOMAIN.COM";
String spn = "OrientDB/db1.somedomain.com";

OrientDB orientDB = new OrientDB(url, pri, spn, OrientDBConfig.defaultConfig());
orientDB.create("TestDB", ODatabaseType.PLOCAL);
orientDB.close();
</code></pre>
<p>The next example shows how to open an existing OrientDB database from the Java client API:</p>
<pre><code>String url = "remote:server1.ad.somedomain.com:2424";
String pri = "OrientDBClient@AD.SOMEDOMAIN.COM";
String spn = "OrientDB/db1.somedomain.com";

OrientDB orientDB = new OrientDB(url, OrientDBConfig.defaultConfig());
ODatabaseSession db = orientDB.open("TestDB", pri, spn, ODatabaseType.PLOCAL);
db.close();
orientDB.close();
</code></pre>
<h2 id="jdbc-client"><a class="header" href="#jdbc-client">JDBC Client</a></h2>
<p>The JDBC client support is very similar to the native OrientDB Java client.  Make sure the <em>KRB5_CONFIG</em> and <em>KRB5CCNAME</em> environment variables (or system properties) are set accordingly and then set the <em>client.credentialinterceptor</em> system property and specify the URL, principal, and SPN appropriately:</p>
<pre><code>System.setProperty("client.credentialinterceptor", "com.orientechnologies.orient.core.security.kerberos.OKerberosCredentialInterceptor");

String url = "remote:server1.ad.somedomain.com:2424/TestDB";
String pri = "OrientDBClient@AD.SOMEDOMAIN.COM";
String spn = "OrientDB/db1.somedomain.com";

Class.forName("com.orientechnologies.orient.jdbc.OrientJdbcDriver");

Properties info = new Properties();
info.put("user", pri);
info.put("password", spn);

Connection conn = (OrientJdbcConnection) DriverManager.getConnection(url, info);

Statement stmt = conn.createStatement();

ResultSet rs = stmt.executeQuery("select from MyClass");
</code></pre>
<h2 id="orientdb-console"><a class="header" href="#orientdb-console">OrientDB Console</a></h2>
<p>To enable Kerberos in the OrientDB console, you'll need to modify the console.sh (or console.bat) script.</p>
<p>Simply add the credential interceptor system property to ORIENTDB_SETTINGS as such:</p>
<pre><code>ORIENTDB_SETTINGS="-Dclient.credentialinterceptor=com.orientechnologies.orient.core.security.kerberos.OKerberosCredentialInterceptor"
</code></pre>
<p>Here's an example of connecting to the previously used URL, principal, and SPN:</p>
<pre><code>connect remote:server1.ad.somedomain.com:2424 OrientDBClient@AD.SOMEDOMAIN.COM OrientDB/db1.somedomain.com
</code></pre>
<p>Here's another example, this time creating a remote plocal database on remote server:</p>
<pre><code>create database remote:server1.ad.somedomain.com:2424/NewDB OrientDBClient@AD.SOMEDOMAIN.COM OrientDB/db1.somedomain.com plocal
</code></pre>
<p>Lastly, this final example with the console shows connecting to the NewDB database that we just created:</p>
<pre><code>connect remote:server1.ad.somedomain.com:2424/NewDB OrientDBClient@AD.SOMEDOMAIN.COM OrientDB/db1.somedomain.com
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="new-security-features---code-changes"><a class="header" href="#new-security-features---code-changes">New Security Features - Code Changes</a></h1>
<p>The motivation behind creating a new security layer for OrientDB was to meet the requirements of several customers who needed external authentication (specifically Kerberos and SPNEGO support), the ability to import users from specific groups via LDAP, password validation, and new auditing capabilities.</p>
<p>The OrientDB <em>Client</em>, <em>Core</em>, <em>Server</em>, and <em>Enterprise Agent</em> modules were all affected by the new security system.  At the heart is a new interface called <code>OSecuritySystem</code> that provides most of the high-level methods required for implementing the main features.  The <code>Orient</code> instance in the <em>Core</em> stores a reference to the <code>OSecuritySystem</code> instance, and it can be accessed by calling <code>Orient.instance().getSecurity().</code>  Note that this only applies when called from the Server.  Otherwise, <code>getSecurity()</code> will just return null.</p>
<p>Another main interface, called <code>OServerSecurity</code>, is derived from <code>OSecuritySystem</code>, and it provides some additional methods that are specific to the server.  In <code>OServer</code>, an implementation of <code>OServerSecurity</code>, called <code>ODefaultServerSecurity</code>, is created and stored. It can be accessed via a public method, <code>getSecurity()</code>, from the server instance.  When <code>ODefaultServerSecurity</code> is created in <code>OServer</code>, its instance is registered with <code>Orient</code>.</p>
<p><code>ODefaultServerSecurity</code> handles loading the new JSON security configuration file that is stored under <em>config</em> and is called <em>security.json</em> by default.  Currently, <em>security.json</em> has five main sections: "server", "authentication", "passwordValidator", "ldapImporter", and "auditing".</p>
<p>The most important thing to take away from this implementation is the concept of <em>authenticators</em> which can be chained together to support multiple kinds of authentication.  As an example, the primary <em>authenticator</em> could be for Kerberos, followed by an NTLM <em>authenticator</em>, followed by a password <em>authenticator</em> (which allows usernames, passwords, and resources to be stored in the <em>security.json</em> file), and then followed by an <code>OServer</code> config <em>authenticator</em> (which supports the users section in <em>orientdb-server-config.xml</em>).  If authentication fails for the first <em>authenticator</em> then the next one in the chain is attempted.  This continues until all <em>authenticators</em> are tried.</p>
<p>Authorization works in a similar way.  The primary <em>authenticator</em> implementation is tried first to see if the specified user has the required resource permissions.  If not successful, the second <em>authenticator</em> is then tried, and so forth.</p>
<p>Lastly, for the type of HTTP authentication that each <em>authenticator</em> supports, an authentication header will be created using each <em>authenticator</em>, starting with the primary.  As an example, this allows for a Kerberos "Negotiate" header to be returned as well as a "Basic" authentication header for fallback purposes.</p>
<p>On the <em>Client</em> side, there's a new interface, called <code>OCredentialInterceptor</code>, which allows for providing single sign-on security implementations (such as for Kerberos, NTLM) while still working with the OrientDB authentication framework.</p>
<p>The other significant change is in the <em>Core</em> and happens in <code>OMetadataDefault</code> in its <code>init()</code> method.  Previously, an instance of <code>OSecurityShared</code> was created.  Now, an <code>OSecurity</code> instance is created by calling <code>OSecurityManager.instance().newSecurity()</code>.  The reason for this is to support different OSecurity implementations depending on the authentication requirements.  As an example, for external authentication, an <code>OSecurityExternal</code> instance will be created.  <code>OSecurityExternal</code> derives from <code>OSecurityShared</code> but overrides <code>authenticate()</code>, calling the security system's <code>authenticate()</code> method instead (<code>Orient.instance().getSecurity().authenticate()</code>).</p>
<p>Enterprise auditing has some new capabilities as well.  Tracking of creating and dropping classes has been added as well as when nodes join and leave the cluster in a distributed setup.  Writing to Syslog as part of the auditing log has been added too.</p>
<h2 id="client-2"><a class="header" href="#client-2">Client</a></h2>
<h3 id="oserveradmin"><a class="header" href="#oserveradmin">OServerAdmin</a></h3>
<p>Modified the <code>connect()</code> method to create a new <code>OCredentialInterceptor</code> from the security manager and, if successful, calls its <code>intercept()</code> method, and then retrieves the username and password from the interceptor.</p>
<pre><code>OCredentialInterceptor ci = OSecurityManager.instance().newCredentialInterceptor();
			
if(ci != null)
{
  ci.intercept(storage.getURL(), iUserName, iUserPassword);
  username = ci.getUsername();
  password = ci.getPassword();
}
</code></pre>
<h3 id="ostorageremote"><a class="header" href="#ostorageremote">OStorageRemote</a></h3>
<p>Modified the <code>open()</code> method to create a new <code>OCredentialInterceptor</code> from the security manager and, if successful, calls its <code>intercept()</code> method, and then retrieves the username and password from the interceptor.</p>
<pre><code>OCredentialInterceptor ci = OSecurityManager.instance().newCredentialInterceptor();

if(ci != null)
{	
  ci.intercept(getURL(), iUserName, iUserPassword);
  connectionUserName = ci.getUsername();
  connectionUserPassword = ci.getPassword();
}
else // Do Nothing
{
  connectionUserName = iUserName;
  connectionUserPassword = iUserPassword;
}
</code></pre>
<h2 id="core"><a class="header" href="#core">Core</a></h2>
<h3 id="orient"><a class="header" href="#orient">Orient</a></h3>
<p>Added getter and setter methods for the OSecuritySystem variable.</p>
<pre><code>private volatile OSecuritySystem security;

public OSecuritySystem getSecurity() { return this.security; }
public void setSecurity(final OSecuritySystem security) {
  this.security = security;

}
</code></pre>
<h3 id="oglobalconfiguration"><a class="header" href="#oglobalconfiguration">OGlobalConfiguration</a></h3>
<p>Added several new properties to support Kerberos on the client and other server-related security properties.</p>
<p>These properties are OrientDB client-specific only:</p>
<div class="table-wrapper"><table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody>
<tr><td>"client.krb5.config"</td><td>Specifies the location of the Kerberos configuration file (typically krb5.conf).</td></tr>
<tr><td>"client.krb5.ccname"</td><td>Specifies the location of the Kerberos credential cache file.</td></tr>
<tr><td>"client.krb5.ktname"</td><td>Specifies the location of the Kerberos keytab file.</td></tr>
<tr><td>"client.credentialinterceptor"</td><td>Specifies the name of the credential interceptor class to use.</td></tr>
</tbody></table>
</div>
<p>These properties are OrientDB server-specific only:</p>
<div class="table-wrapper"><table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody>
<tr><td>"security.createDefaultUsers"</td><td>Indicates if "default users" should be created.  When set to true and the server instance is new, the default users in orientdb-server-config.xml will be created.  Also, if set to true, when a new database is created the default database users will be created.</td></tr>
<tr><td>"server.security.file"</td><td>Specifies the location (and name) of the JSON security configuration file.  By default, the file is named <em>security.json</em> and is located in the <em>config</em> directory.</td></tr>
</tbody></table>
</div>
<h3 id="ometadatadefault"><a class="header" href="#ometadatadefault">OMetadataDefault</a></h3>
<p>In the <code>init()</code> method, notice that <code>final OSecurityShared instance = new OSecurityShared();</code></p>
<pre><code>new Callable&lt;OSecurityShared&gt;() {
 public OSecurityShared call() {
   final OSecurityShared instance = new OSecurityShared();
   if (iLoad) {
     security = instance;
     instance.load();
   }
   return instance;
 }
}), database);
</code></pre>
<p>is changed to <code>final OSecurity instance = OSecurityManager.instance().newSecurity();</code></p>
<pre><code>new Callable&lt;OSecurity&gt;() {
 public OSecurity call() {
   final OSecurity instance = OSecurityManager.instance().newSecurity();
   if (iLoad) {
     security = instance;
     instance.load();
   }
   return instance;
 }
}), database);
</code></pre>
<h3 id="oschemashared"><a class="header" href="#oschemashared">OSchemaShared</a></h3>
<p>In the <code>dropClassInternal()</code> method, added calls to <code>onDropClass()</code> for all the <em>ODatabaseLifecycleListener</em> listeners.</p>
<pre><code>// WAKE UP DB LIFECYCLE LISTENER
for (Iterator&lt;ODatabaseLifecycleListener&gt; it = Orient.instance().getDbLifecycleListeners(); it.hasNext(); )
  it.next().onDropClass(getDatabase(), cls);
</code></pre>
<h3 id="osecuritymanager"><a class="header" href="#osecuritymanager">OSecurityManager</a></h3>
<p>Added four new methods to support the credential interceptor, security factory, and new OSecurity instances.  Created a default OSecurityFactory instance.</p>
<pre><code>private OSecurityFactory securityFactory = new OSecuritySharedFactory();
	
public OCredentialInterceptor newCredentialInterceptor()
	// Dynamically creates an OCredentialInterceptor instance using the OGlobalConfiguration.CLIENT_CREDENTIAL_INTERCEPTOR property.

public OSecurityFactory getSecurityFactory() { return securityFactory; }

public void setSecurityFactory(OSecurityFactory factory) { securityFactory = factory; }  

public OSecurity newSecurity()
{
  if(securityFactory != null) return securityFactory.newSecurity();
    
  return null;
}

</code></pre>
<h3 id="osecurityshared"><a class="header" href="#osecurityshared">OSecurityShared</a></h3>
<p>In the <code>isAllowed()</code> method, added a fix to check for if <code>iAllowAll</code> is null.  Also added a check for <code>areDefaultUsersCreated()</code> when calling <code>createUser()</code>.</p>
<pre><code>if(Orient.instance().getSecurity() == null || Orient.instance().getSecurity().areDefaultUsersCreated())
	createUser(…)
</code></pre>
<p>Also changed the protection of the <code>getDatabase()</code> method from private to protected.</p>
<h3 id="ousertrigger"><a class="header" href="#ousertrigger">OUserTrigger</a></h3>
<p>In the <code>encodePassword()</code> method, added a call to the security system's <code>validatePassword()</code> method.</p>
<pre><code>if(Orient.instance().getSecurity() != null)
{
  Orient.instance().getSecurity().validatePassword(password);
}
</code></pre>
<h3 id="new-files---added-to-orientcoresecurity"><a class="header" href="#new-files---added-to-orientcoresecurity">New Files - Added to orient/core/security</a></h3>
<div class="table-wrapper"><table><thead><tr><th>File</th><th>Description</th></tr></thead><tbody>
<tr><td>OCredentialInterceptor.java</td><td>Provides a basic credential interceptor interface with three methods: getUsername(), getPassword(), and intercept().</td></tr>
<tr><td>OInvalidPasswordException.java</td><td>Provides a specific exception used by password validator implementations for failed validation.  Derives from OSecurityException.</td></tr>
<tr><td>OPasswordValidator.java</td><td>Provides a simple interface for validating passwords.  Contains one method: validatePassword().</td></tr>
<tr><td>OSecurityExternal.java</td><td>Extends OSecurityShared, providing external authentication by calling Orient.instance().getSecurity().authenticate().</td></tr>
<tr><td>OSecurityFactory.java</td><td>Provides an interface for creating new OSecurity instances.  Contains one method: newSecurity().</td></tr>
<tr><td>OSecuritySharedFactory.java</td><td>Implements the OSecurityFactory interface for OSecurityShared instances.  Its newSecurity() method returns a new OSecurityShared instance.</td></tr>
<tr><td>OSecuritySystem.java</td><td>Provides a basic interface for a modular security system supporting external authenticators.</td></tr>
<tr><td>OSecuritySystemException.java</td><td>Provides a specific exception used by OSecuritySystem implementations.</td></tr>
</tbody></table>
</div>
<h3 id="osecuritysystem"><a class="header" href="#osecuritysystem">OSecuritySystem</a></h3>
<p>OSecuritySystem is a base interface and requires the following methods:</p>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Description</th></tr></thead><tbody>
<tr><td>authenticate()</td><td>Takes a username and password and returns the authenticated <em>principal</em> (on success) or null (on failure).</td></tr>
<tr><td>areDefaultUsersCreated()</td><td>Returns a boolean indicating if the "createDefaultUsers" security property is set to true or false.  When set to true and the server instance is new, the default users in orientdb-server-config.xml will be created.  Also, if set to true, when a new database is created the default database users will be created.</td></tr>
<tr><td>getAuthenticationHeader()</td><td>Returns the current HTTP authentication header.  Depending on which <em>authenticator(s)</em> is installed, multiple authentication headers may be returned to support primary, secondary, and fallback browser authentication types.</td></tr>
<tr><td>isAuthorized()</td><td>Takes a username and resource list (as a String).  Walks through the installed <em>authenticators</em> and returns true if a matching username is found that has the required authorization for the specified resource list.</td></tr>
<tr><td>isDefaultAllowed()</td><td>Returns a boolean indicating if the "authentication"."allowDefault" property is set to true or false.  When set to true and authentication fails using the installed <em>authenticators</em>, the default database authentication may also be used.</td></tr>
<tr><td>isEnabled()</td><td>Returns a boolean indicating if the security system is enabled.</td></tr>
<tr><td>isSingleSignOnSupported()</td><td>Returns a boolean that indicates if the primary authenticator supports single sign-on.</td></tr>
<tr><td>validatePassword()</td><td>Takes a password and, if a password validator is installed, throws an OInvalidPasswordException if the provided password fails to meet the validation criteria.</td></tr>
</tbody></table>
</div>
<h3 id="new-directory-kerberos---added-to-orientcoresecurity"><a class="header" href="#new-directory-kerberos---added-to-orientcoresecurity">New Directory (kerberos) - Added to orient/core/security</a></h3>
<p>Added a new kerberos directory under orient/core/security.</p>
<h3 id="new-files---added-to-orientcoresecuritykerberos"><a class="header" href="#new-files---added-to-orientcoresecuritykerberos">New Files - Added to orient/core/security/kerberos</a></h3>
<div class="table-wrapper"><table><thead><tr><th>File</th><th>Description</th></tr></thead><tbody>
<tr><td>OKerberosCredentialInterceptor.java</td><td>Provides an implementation of OCredentialInterceptor, specific to Kerberos.</td></tr>
<tr><td>OKrb5ClientLoginModuleConfig.java</td><td>Provides a custom Kerberos client login <code>Configuration</code> implementation.</td></tr>
</tbody></table>
</div>
<h2 id="server-3"><a class="header" href="#server-3">Server</a></h2>
<h3 id="oserver"><a class="header" href="#oserver">OServer</a></h3>
<p>Added a new variable for an <code>OServerSecurity</code> instance along with getter/setter methods.</p>
<p>Created a new method called <code>authenticateUser()</code>.  If the <code>OServerSecurity</code> instance is enabled, it calls its <code>authenticate()</code> method; and if a valid <em>principal</em> is returned, then its <code>isAuthorized()</code> method is called.  If <code>OServerSecurity</code> is not enabled, then the default <code>OServer</code> authentication and authorization methods are used.</p>
<p>Modified the <code>activate()</code> method, adding the creation of a new <code>ODefaultServerSecurity</code> instance, assigning it to the <code>serverSecurity</code> variable, and calling <code>Orient.instance.setSecurity(serverSecurity)</code>.</p>
<p>Changed the <code>serverLogin()</code> method, calling <code>authenticateUser()</code> instead.</p>
<p>Modified the <code>authenticate()</code> method, also calling <code>authenticateUser()</code> instead.</p>
<p>Updated the <code>isAllowed()</code> method, calling the server security's <code>isAuthorized()</code> method, if the security module is enabled.  Otherwise, the default implementation is used.</p>
<p>Changed the <code>getUser()</code> method, calling the server security's <code>getUser()</code> method, if the security module is enabled.  Otherwise, the default implementation is used.</p>
<p>Modified the <code>openDatabase()</code> method, checking and using the returned value of <code>serverLogin()</code>.  This is done because in some security implementations the user is embedded inside a ticket of some kind that must be decrypted in order to retrieve the actual user identity.  If serverLogin() is successful that user identity is returned.</p>
<p>Updated the <code>loadUsers()</code> method, adding a check to <code>serverSecurity.areDefaultUsersCreated()</code> before calling <code>createDefaultServerUsers()</code>.</p>
<p>Changed <code>createDefaultServerUsers()</code>, immediately returning if <code>serverSecurity.arePasswordsStored()</code> returns false.</p>
<p>Added a try/catch block in <code>registerPlugins()</code> around the handler loading.  This prevents a bad plugin from keeping the entire system from starting.</p>
<h3 id="ohttputils"><a class="header" href="#ohttputils">OHttpUtils</a></h3>
<p>Added SPNEGO negotiate header support.</p>
<pre><code>public static final String HEADER_AUTHENTICATE_NEGOTIATE = "WWW-Authenticate: Negotiate";
public static final String AUTHORIZATION_NEGOTIATE       = "Negotiate";
</code></pre>
<h3 id="onetworkprotocolhttpabstract"><a class="header" href="#onetworkprotocolhttpabstract">ONetworkProtocolHttpAbstract</a></h3>
<p>Changed the <code>handlerError()</code> method, using <code>server.getSecurity().getAuthenticationHeader()</code> to set the <code>responseHeaders</code> variable.</p>
<p>Modified <code>readAllContent()</code>, adding "Negotiate" support.</p>
<p>Added two new commands, <code>OServerCommandGetSSO()</code> and <code>OServerCommandGetPing()</code>, in <code>registerStatelessCommands()</code>.</p>
<h3 id="oservercommandauthenticateddbabstract"><a class="header" href="#oservercommandauthenticateddbabstract">OServerCommandAuthenticatedDbAbstract</a></h3>
<p>Replaced in <code>sendAuthorizationRequest()</code> the assignment to <code>header</code> of "Basic" authentication with the result of calling <code>server.getSecurity().getAuthenticationHeader(iDatabaseName)</code>.</p>
<h3 id="oservercommandauthenticatedserverabstract"><a class="header" href="#oservercommandauthenticatedserverabstract">OServerCommandAuthenticatedServerAbstract</a></h3>
<p>Replaced in <code>sendAuthorizationRequest()</code> the assignment to <code>header</code> of "Basic" authentication with the result of calling <code>server.getSecurity().getAuthenticationHeader(iDatabaseName)</code>.</p>
<h3 id="oservercommandpostauthtoken"><a class="header" href="#oservercommandpostauthtoken">OServerCommandPostAuthToken</a></h3>
<p>Replaced in <code>sendAuthorizationRequest()</code> the assignment to <code>header</code> of "Basic" authentication with the result of calling <code>server.getSecurity().getAuthenticationHeader(iDatabaseName)</code>.</p>
<h3 id="oserverconfigurationmanager"><a class="header" href="#oserverconfigurationmanager">OServerConfigurationManager</a></h3>
<p>In the <code>setUser()</code> method, removed the check for <code>iServerUserPasswd</code> being empty, as some security implementations do not require a password.</p>
<h3 id="new-file---added-to-orientservernetwork"><a class="header" href="#new-file---added-to-orientservernetwork">New File - Added to orient/server/network</a></h3>
<p>Added one new file, <code>OServerTLSSocketFactory.java</code>.</p>
<h3 id="oservertlssocketfactory"><a class="header" href="#oservertlssocketfactory">OServerTLSSocketFactory</a></h3>
<p>OServerTLSSocketFactory simply extends OServerSSLSocketFactory to make it clear that OrientDB does support TLS encryption by default.</p>
<h3 id="new-files---added-to-orientservernetworkprotocolhttpcommandget"><a class="header" href="#new-files---added-to-orientservernetworkprotocolhttpcommandget">New Files - Added to orient/server/network/protocol/http/command/get</a></h3>
<p>Added two new commands, <code>OServerCommandGetPing</code> and <code>OServerCommandGetSSO</code>.</p>
<h3 id="oservercommandgetping"><a class="header" href="#oservercommandgetping">OServerCommandGetPing</a></h3>
<p>Added a very simple Get <em>Ping</em> command, used by Studio, to test if the HTTP server is still alive.  As opposed to <em>listDatabases</em>, this command requires no authentication and no special authorization.  This is important for heavyweight <em>authenticators</em>, such as SPNEGO/Kerberos.</p>
<h3 id="oservercommandgetsso"><a class="header" href="#oservercommandgetsso">OServerCommandGetSSO</a></h3>
<p>This Get command is also used by Studio to determine if the primary <em>authenticator</em> supports single sign-on.  If single sign-on is supported, then the <em>username</em> and <em>password</em> credentials in the login dialog are not required.</p>
<h3 id="new-file---added-to-orientservernetworkprotocolhttpcommandpost"><a class="header" href="#new-file---added-to-orientservernetworkprotocolhttpcommandpost">New File - Added to orient/server/network/protocol/http/command/post</a></h3>
<p>Added one new command, <code>OServerCommandPostSecurityReload</code>.</p>
<h3 id="oservercommandpostsecurityreload"><a class="header" href="#oservercommandpostsecurityreload">OServerCommandPostSecurityReload</a></h3>
<p>This command is designed to reload the current <code>OServerSecurity</code> module and accepts a path to the security JSON file to use.</p>
<h3 id="new-files---added-to-orientserversecurity"><a class="header" href="#new-files---added-to-orientserversecurity">New Files - Added to orient/server/security</a></h3>
<p>The following files were added to the security directory:</p>
<ul>
<li>OAuditingService.java</li>
<li>ODefaultPasswordAuthenticator.java</li>
<li>ODefaultServerSecurity.java</li>
<li>OSecurityAuthenticator.java</li>
<li>OSecurityAuthenticatorAbstract.java</li>
<li>OSecurityAuthenticatorException.java</li>
<li>OSecurityComponent.java</li>
<li>OServerConfigAuthenticator.java</li>
<li>OServerSecurity.java</li>
<li>OSyslog.java</li>
</ul>
<h3 id="oauditingservice"><a class="header" href="#oauditingservice">OAuditingService</a></h3>
<p>Provides a simple auditing service interface, and specifies three <code>log()</code> methods.  Extends the <code>OSecurityComponent</code> interface.</p>
<h3 id="odefaultpasswordauthenticator-1"><a class="header" href="#odefaultpasswordauthenticator-1">ODefaultPasswordAuthenticator</a></h3>
<p>Extends the <code>OSecurityAuthenticatorAbstract</code> class, providing a default <em>authenticator</em> that supports a username, password, and resource list.</p>
<h3 id="odefaultserversecurity"><a class="header" href="#odefaultserversecurity">ODefaultServerSecurity</a></h3>
<p>Provides the default server security implementation, supporting these interfaces: <code>OSecurityFactory</code>, <code>OServerLifecycleListener</code>, and <code>OServerSecurity</code>.</p>
<h3 id="osecurityauthenticator"><a class="header" href="#osecurityauthenticator">OSecurityAuthenticator</a></h3>
<p>Provides an interface for implementing a security <em>authenticator</em>.  Extends the <code>OSecurityComponent</code> interface.</p>
<p>Requires the following methods.</p>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Description</th></tr></thead><tbody>
<tr><td>authenticate()</td><td>Authenticates the specified username and password.  The authenticated <em>principal</em> is returned if successful, otherwise null.</td></tr>
<tr><td>getAuthenticationHeader()</td><td>Returns the HTTP authentication header supported by this <em>authenticator</em>.</td></tr>
<tr><td>getClientSubject()</td><td>If supported by this <em>authenticator</em>, returns a <code>Subject</code> object with this <em>authenticator's</em> credentials.</td></tr>
<tr><td>getName()</td><td>Returns the name of this <code>OSecurityAuthenticator</code>.</td></tr>
<tr><td>getUser()</td><td>Returns an <code>OServerUserConfiguration</code> object if the matching username is found for this <em>authenticator</em>.  Returns null otherwise.</td></tr>
<tr><td>isAuthorized()</td><td>Takes a username and resource list (as a String).  Returns true if a matching username is found for this <em>authenticator</em> that has the required authorization for the specified resource list.</td></tr>
<tr><td>isSingleSignOnSupported()</td><td>Returns a boolean that indicates if this <em>authenticator</em> supports single sign-on.</td></tr>
</tbody></table>
</div>
<h3 id="osecurityauthenticatorabstract"><a class="header" href="#osecurityauthenticatorabstract">OSecurityAuthenticatorAbstract</a></h3>
<p>Provides an abstract implementation of <code>OSecurityAuthenticator</code>upon which most <em>authenticators</em> are derived.</p>
<h3 id="osecurityauthenticatorexception"><a class="header" href="#osecurityauthenticatorexception">OSecurityAuthenticatorException</a></h3>
<p>Provides a custom OException that security <em>authenticators</em> can throw.</p>
<h3 id="osecuritycomponent"><a class="header" href="#osecuritycomponent">OSecurityComponent</a></h3>
<p>Provides an interface for creating security components that all modules in the security JSON configuration implement.</p>
<p><code>OSecurityComponent</code> consists of four methods: <code>active()</code>, <code>config()</code>, <code>dispose()</code>, and <code>isEnabled()</code>.</p>
<h3 id="oserverconfigauthenticator-1"><a class="header" href="#oserverconfigauthenticator-1">OServerConfigAuthenticator</a></h3>
<p>Provides an <code>OSecurityAuthenticator</code> implementation that supports the users listed in orientdb-server-config.xml.  It extends <code>OSecurityAuthenticatorAbstract</code>.</p>
<h3 id="oserversecurity"><a class="header" href="#oserversecurity">OServerSecurity</a></h3>
<p>Provides an interface for server-specific security features.  It extends <code>OSecuritySystem</code>.</p>
<p>Requires the following methods.</p>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>Description</th></tr></thead><tbody>
<tr><td>getAuthenticator()</td><td>Returns the <code>authenticator</code> based on name, if one exists.</td></tr>
<tr><td>getPrimaryAuthenticator()</td><td>Returns the first <code>authenticator</code> in the chain of <code>authenticators</code>, which is the primary authenticator.</td></tr>
<tr><td>getUser()</td><td>Some <code>authenticators</code> support maintaining a list of users and associated resources (and sometimes passwords).  Returns the associated <code>OServerUserConfiguration</code> if one exists for the specified <em>username</em>.</td></tr>
<tr><td>openDatabase()</td><td>Opens the specified <em>dbName</em>, if it exists, as the <em>superuser</em>.</td></tr>
<tr><td>registerAuditingService()</td><td>Supports a pluggable, external <code>OAuditingService</code> instance.</td></tr>
<tr><td>registerSecurityClass()</td><td>Supports multiple, pluggable, external security components.</td></tr>
<tr><td>reload()</td><td>Reloads the server security module using the specified <em>cfgPath</em>.</td></tr>
</tbody></table>
</div>
<h3 id="osyslog"><a class="header" href="#osyslog">OSyslog</a></h3>
<p>Provides an interface to syslog (and other such event logging systems) and specifies three <code>log()</code> methods.  Extends the <code>OSecurityComponent</code> interface.</p>
<h2 id="graphdbconfig"><a class="header" href="#graphdbconfig">graphdb/config</a></h2>
<h3 id="orientdb-server-configxml"><a class="header" href="#orientdb-server-configxml">orientdb-server-config.xml</a></h3>
<p>Replaced OServerSSLSocketFactory with OServerTLSSocketFactory.</p>
<h3 id="securityjson"><a class="header" href="#securityjson">security.json</a></h3>
<p>Added a default security.json implementation file.</p>
<h2 id="security-plugin"><a class="header" href="#security-plugin">Security Plugin</a></h2>
<p>To support a single location for all the new security component implementations, a new project, <em>orientdb-security</em>, has been created.</p>
<p>The following security components now reside here:</p>
<ul>
<li>ODefaultAuditing</li>
<li>ODefaultPasswordAuthenticator</li>
<li>ODefaultPasswordValidator</li>
<li>ODefaultSyslog</li>
<li>OKerberosAuthenticator</li>
<li>OLDAPImporter</li>
<li>OServerConfigAuthenticator</li>
</ul>
<h2 id="enterprise-agent"><a class="header" href="#enterprise-agent">Enterprise Agent</a></h2>
<h3 id="oauditinghook"><a class="header" href="#oauditinghook">OAuditingHook</a></h3>
<p>[This was moved into <em>orientdb-security</em>.]</p>
<p>Added support for auditing of CREATECLASS and DROPCLASS events.</p>
<p>Added optional support for <em>syslog</em> audit logging as well.</p>
<h3 id="oauditinglistener"><a class="header" href="#oauditinglistener">OAuditingListener</a></h3>
<p>[This was moved into <em>orientdb-security</em> and renamed <code>ODefaultAuditing</code>.]</p>
<p>Implemented two new interfaces, <code>OAuditingService</code> and <code>ODistributedLifecycleListener</code>.</p>
<p>Also moved <code>Orient.instance().addDbLifecycleListener(this)</code> to the <code>active()</code> method.</p>
<h3 id="oenterpriseagent"><a class="header" href="#oenterpriseagent">OEnterpriseAgent</a></h3>
<p>[This was removed from the agent and added to <code>OSecurityPlugin</code> in <em>orientdb-security</em>.]</p>
<p>Added a new method, <code>registerSecurityComponents()</code>, for registering Enterprise-only security components in the security system.</p>
<p>Added a call to <code>registerSecurityComponents()</code> in the <code>startup()</code> method.</p>
<h3 id="agentkerberos"><a class="header" href="#agentkerberos">agent/kerberos</a></h3>
<p>[This was moved into <em>orientdb-security</em>.]</p>
<p>Added a new <em>kerberos</em> directory and the following new files.</p>
<div class="table-wrapper"><table><thead><tr><th>File</th><th>Description</th></tr></thead><tbody>
<tr><td>OKerberosAuthenticator.java</td><td>Implements a Kerberos-specific security <em>authenticator</em> that extends <code>OSecurityAuthenticatorAbstract</code>.</td></tr>
<tr><td>OKerberosLibrary.java</td><td>Provides a collection of static methods used by the Kerberos <em>authenticator</em>.</td></tr>
<tr><td>OKrb5LoginModuleConfig.java</td><td>Provides a custom Kerberos login <code>Configuration</code> implementation.</td></tr>
</tbody></table>
</div>
<h3 id="agentldap"><a class="header" href="#agentldap">agent/ldap</a></h3>
<p>[This was moved into <em>orientdb-security</em>.]</p>
<p>Added a new <em>ldap</em> directory and the following new files.</p>
<div class="table-wrapper"><table><thead><tr><th>File</th><th>Description</th></tr></thead><tbody>
<tr><td>OLDAPImporter.java</td><td>Provides LDAP user/group importer into a database.  Implements the <code>OSecurityComponent</code> interface.</td></tr>
<tr><td>OLDAPLibrary.java</td><td>Provides a collection of static methods used by the LDAP importer.</td></tr>
<tr><td>OLDAPServer.java</td><td>Provides a simple class used by OLDAPImporter and OLDAPLibrary for specifying LDAP servers.</td></tr>
</tbody></table>
</div>
<h3 id="agentsecurity"><a class="header" href="#agentsecurity">agent/security</a></h3>
<p>[This was moved into <em>orientdb-security</em>.]</p>
<p>Added a new <em>security</em> directory and the following new files.</p>
<div class="table-wrapper"><table><thead><tr><th>File</th><th>Description</th></tr></thead><tbody>
<tr><td>ODefaultPasswordValidator.java</td><td>Provides a default implementation for validating passwords.  Implements <code>OPasswordValidator</code> and <code>OSecurityComponent</code>.</td></tr>
<tr><td>ODefaultSyslog.java</td><td>Provides a default implementation of the <code>OSyslog</code> interface.</td></tr>
</tbody></table>
</div>
<h3 id="resources-5"><a class="header" href="#resources-5">resources</a></h3>
<p>[This was moved into <em>orientdb-security</em>.]</p>
<p>Modified the default-auditing-config.json file, adding class support for "onCreateClassEnabled", "onCreateClassMessage", "onDropClassEnabled", and "onDropClassMessage".</p>
<h3 id="pomxml-1"><a class="header" href="#pomxml-1">pom.xml</a></h3>
<p>[This was moved into <em>orientdb-security</em>.]</p>
<p>Added the dependency for CloudBees <em>syslog</em> client support:</p>
<pre><code>&lt;dependency&gt;
   &lt;groupId&gt;com.cloudbees&lt;/groupId&gt;
   &lt;artifactId&gt;syslog-java-client&lt;/artifactId&gt;
   &lt;version&gt;1.0.9-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="new-security-features---orientdb"><a class="header" href="#new-security-features---orientdb">New Security Features - OrientDB</a></h1>
<h2 id="overview-2"><a class="header" href="#overview-2">Overview</a></h2>
<p>The new security features in OrientDB (introduced in release 2.2) provide an extensible framework for adding external authenticators, password validation, LDAP import of database roles and users, advanced auditing capabilities, and syslog support.</p>
<p>The new security system uses a JSON configuration file, located in the <em>config</em> directory.  The default name of the file is <em>security.json</em>, but it can be overridden by setting the "server.security.file" property in <em>orientdb-server-config.xml</em> or by setting the global server property, "server.security.file".</p>
<p>To see the complete configuration options, click here: <a href="security/Security-Config.html">Security Configuration</a>.</p>
<h2 id="authenticators"><a class="header" href="#authenticators">Authenticators</a></h2>
<p>In addition to the built-in authentication of users that happens inside the database engine, the new OrientDB security system supports multiple types of external <em>authenticators</em>.  Each <em>authenticator</em> implements various methods to support authentication and authorization, among other things.</p>
<p>All <em>authenticators</em> can be configured in the "authentication" section of the <a href="security/Security-Config.html">security configuration</a>.</p>
<h3 id="current-implementations"><a class="header" href="#current-implementations">Current Implementations</a></h3>
<p>Currently, OrientDB provides a <a href="security/Security-OrientDB-New-Security-Features.html#okerberosauthenticator">Kerberos authenticator</a>, a <a href="security/Security-OrientDB-New-Security-Features.html#odefaultpasswordauthenticator">password authenticator</a> for authenticating users in the <em>security.json</em> file, a <a href="security/Security-OrientDB-New-Security-Features.html#oserverconfigauthenticator">server config authenticator</a> for authenticating users in the <em>orientdb-server-config.xml</em> file, and a <a href="security/Security-OrientDB-New-Security-Features.html#symmetric-key-authenticator">symmetric key authenticator</a> (Enterprise-only).  Additional <em>authenticators</em> may be provided in the future, and it's very easy to build new ones.</p>
<h4 id="okerberosauthenticator-1"><a class="header" href="#okerberosauthenticator-1">OKerberosAuthenticator</a></h4>
<p>This <em>authenticator</em> provides support for Kerberos authentication and full browser SPNEGO support.  See the <a href="security/Security-Config.html">security configuration</a> page for full details on configuring this <em>authenticator</em> for Kerberos.</p>
<p>Also, see <a href="security/Security-Kerberos-Client-Examples.html">Kerberos client examples</a> to see how to use the OrientDB clients with Kerberos.</p>
<h4 id="odefaultpasswordauthenticator-2"><a class="header" href="#odefaultpasswordauthenticator-2">ODefaultPasswordAuthenticator</a></h4>
<p>The <code>ODefaultPasswordAuthenticator</code> supports adding server users with passwords and resources to the <em>security.json</em> configuration file.  The main purpose of this is to allow having server users in a single file (along with all the other security settings) without having to maintain them in the separate <em>orientdb-server-config.xml</em> file.  See the example in the <a href="security/Security-Config.html">security configuration</a> page.</p>
<h4 id="oserverconfigauthenticator-2"><a class="header" href="#oserverconfigauthenticator-2">OServerConfigAuthenticator</a></h4>
<p>The <code>OServerConfigAuthenticator</code> is similar to <code>ODefaultPasswordAuthenticator</code> in that it supports server users with passwords and resources, but it's designed to be used with the users in the <em>orientdb-server-config.xml</em> configuration file instead.</p>
<h4 id="osystemuserauthenticator-1"><a class="header" href="#osystemuserauthenticator-1">OSystemUserAuthenticator</a></h4>
<p>The <code>OSystemUserAuthenticator</code> supports the new <em>system user</em> type that's stored in the system database.</p>
<h4 id="symmetric-key-authenticator"><a class="header" href="#symmetric-key-authenticator">Symmetric Key Authenticator</a></h4>
<p>The <code>Symmetric Key Authenticator</code> provides support for authenticating users via a shared symmetric key.</p>
<p>There are two versions of the <code>Symmetric Key Authenticator</code>, one that enables authenticating server users and one that enables authenticating system users.</p>
<h3 id="chaining-authenticators"><a class="header" href="#chaining-authenticators">Chaining <em>Authenticators</em></a></h3>
<p>What's important to note is that the <em>authenticators</em> can be thought of as being chained together so that if the first <em>authenticator</em> in the list fails to authenticate a user, then the next <em>authenticator</em> in the chain is tried.  This continues until either a user is successfully authenticated or all <em>authenticators</em> are tried.  This "chaining of <em>authenticators</em>" is used for authentication, authorization, retrieving HTTP authentication headers, and several other security features.</p>
<h3 id="default-authentication"><a class="header" href="#default-authentication">Default Authentication</a></h3>
<p>As mentioned previously, OrientDB has a built-in authentication system for each database, and it is enabled by default.  To disable it, set the "allowDefault" property in the "authentication" section of the <em>security.json</em> configuration to false.  When enabled, the built-in authentication acts as a "fallback" if the external <em>authenticators</em> cannot authenticate or authorize a user.</p>
<h2 id="password-validator"><a class="header" href="#password-validator">Password Validator</a></h2>
<p>Another new feature of the security system is a customizable password validator.  The provided validator is called <code>ODefaultPasswordValidator</code> that, when enabled, validates user-chosen passwords based on minimum length and regular expressions.  Which numbers, uppercase letters, and special characters are permitted along with their required count is specified by a regular expression for each.  Like all the security components, the password validator can be extended or completely replaced with a custom password validator component.</p>
<p>See the <a href="security/Security-Config.html">security configuration</a> page for details on how to configure the password validator.</p>
<h2 id="ldap-import"><a class="header" href="#ldap-import">LDAP Import</a></h2>
<p>Another often-requested feature, importing of LDAP users, is now available as part of OrientDB.  Each database can be configured to import from multiple LDAP domains, each domain may specify multiple LDAP servers, and the users and their corresponding roles can be specified per-domain using a standard LDAP filter.</p>
<p>The <a href="security/Security-Config.html">security configuration</a> page explains in great details all the options for the default LDAP importer.</p>
<h2 id="auditingsyslog"><a class="header" href="#auditingsyslog">Auditing/Syslog</a></h2>
<p>Enhancements to the auditing component have also been made.  The audit log now supports monitoring of a class being created and dropped as well as when distributed nodes join and leave the cluster.  Additionally, for operating systems that support <em>syslog</em>, a new <em>syslog</em> plug-in has been added for recording auditing events.</p>
<p>See the <a href="security/Security-Config.html">security configuration</a> page for details on auditing properties.</p>
<h2 id="reloading"><a class="header" href="#reloading">Reloading</a></h2>
<p>The new security system supports dynamic reloading by an HTTP POST request.  The path to the configuration file to use is provided as JSON content.  The provided credentials must have sufficient privileges to reload the security module.</p>
<p>Here's an example using <em>curl</em> with basic authentication:</p>
<pre><code>curl -u root:password -H "Content-Type: application/json" -X POST -d '{ "configFile" : "${ORIENTDB_HOME}/config/security.json" }'  servername:2480/security/reload 
</code></pre>
<p>Here's another example using <em>curl</em> using Kerberos/SPNEGO authentication:</p>
<pre><code>curl --negotiate -u : -H "Content-Type: application/json" -X POST -d '{ "configFile" : "${ORIENTDB_HOME}/config/security.json" }'  servername:2480/security/reload 
</code></pre>
<p>Notice the passed-in JSON "configFile" property.  Any valid security configuration file may be specified here, making testing multiple configurations possible.</p>
<h3 id="reloading-individual-components"><a class="header" href="#reloading-individual-components">Reloading Individual Components</a></h3>
<p>Instead of reloading the entire security system, it's also possible to reload individual security components.</p>
<p>Here's an example using <em>curl</em> with basic authentication:</p>
<pre><code>curl -u root:password -H "Content-Type: application/json" -X POST -d '{ "module" : "auditing", "config" : "{ACTUAL JSON CONTENT}" }'  servername:2480/security/reload 
</code></pre>
<p>Notice, instead of specifying "configFile" you use "config" and the "module" property.</p>
<p>Currently, you can reload the following security components:</p>
<ul>
<li>server</li>
<li>authentication</li>
<li>passwordValidator</li>
<li>ldapImporter</li>
<li>auditing</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="symmetric-key-authentication"><a class="header" href="#symmetric-key-authentication">Symmetric Key Authentication</a></h1>
<p>Symmetric key authentication enables the use of a shared secret key to authenticate an OrientDB user.  Support for this was added to OrientDB Enterprise Edition in 2.2.14.</p>
<p>Two new server-side authenticators were added: OSecuritySymmetricKeyAuth and OSystemSymmetricKeyAuth.  See <a href="security/Security-Config.html">Security Configuration</a>.</p>
<h2 id="overview-3"><a class="header" href="#overview-3">Overview</a></h2>
<p>Symmetric key authentication works by both the server and the client sharing a secret key for an OrientDB user that's used to authenticate a client.</p>
<p>When a Java client (or via the OrientDB console) uses a symmetric key and tries to connect to an OrientDB server or open a database, the <em>username</em> is encrypted using the specified secret key.  On the server-side, the user's corresponding secret key will be used to decrypt the username.  If both usernames match, then the client is successfully authenticated.</p>
<p>The normal <em>password</em> field is used to encode the encrypted username as well as information specific to the key type.  A Java client can use the OSymmetricKey class to encrypt the username as part of the password field or can use the OSymmetricKeyCI credential interceptor.</p>
<p>Note that the symmetric key is <em>never</em> sent from the client to the server as part of the authentication process.</p>
<h2 id="osymmetrickey-client-example"><a class="header" href="#osymmetrickey-client-example">OSymmetricKey Client Example</a></h2>
<p>The OSymmetricKey class is used to create symmetric secret keys, load them from various sources, and to encrypt/decrypt data.</p>
<p>Here's an example using a Base64 key string with an OSymmetricKey object to encrypt the username, "Bob", and send that as the password field of the OServerAdmin connect() method:</p>
<pre><code>String key = "8BC7LeGkFbmHEYNTz5GwDw==";
OSymmetricKey sk = new OSymmetricKey("AES", "AES/CBC/PKCS5Padding", key);

String url = "remote:localhost";
String username = "Bob";
String password = sk.encrypt(username);

OServerAdmin serverAdmin = new OServerAdmin(url).connect(username, password);
serverAdmin.createDatabase("TestDB", "graph", "plocal");
serverAdmin.close();
</code></pre>
<h2 id="osymmetrickeyci-console-example"><a class="header" href="#osymmetrickeyci-console-example">OSymmetricKeyCI Console Example</a></h2>
<p>To use the symmetric key authentication from the OrientDB console, you need to set the credential interceptor in the console.sh (or console.bat for Windows) script.</p>
<p>Add this property to the <code>ORIENTDB_SETTINGS</code> variable:</p>
<pre><code>ORIENTDB_SETTINGS="-Dclient.credentialinterceptor=com.orientechnologies.orient.core.security.symmetrickey.OSymmetricKeyCI"
</code></pre>
<p>The symmetric key credential interceptor is called <code>OSymmetricKeyCI</code>.</p>
<p>The password field is used to specify a JSON document that contains the properties for using a secret key string, a file containing a secret key string, or a Java KeyStore file.</p>
<p>One of the required JSON properties is 'transform', which indicates the cipher transformation.  If 'transform' is not specified as part of the JSON document, the global property, <code>client.ci.ciphertransform</code> can be set in <code>ORIENTDB_SETTINGS</code> instead.</p>
<p>Another property that can be set is the key's algorithm type, set by specifying 'algorithm' in the JSON document.  If 'algorithm' is not specified then the algorithm is determined from the cipher transformation.  The key's algorithm can also be set as part of the <code>ORIENTDB_SETTINGS</code> using the global property <code>client.ci.keyalgorithm</code>.</p>
<p>Example:</p>
<pre><code>ORIENTDB_SETTINGS="-Dclient.credentialinterceptor=com.orientechnologies.orient.core.security.symmetrickey.OSymmetricKeyCI -Dclient.ci.keyalgorithm=AES -Dclient.ci.ciphertransform=AES/CBC/PKCS5Padding"
</code></pre>
<h3 id="key-1"><a class="header" href="#key-1">key</a></h3>
<p>Here's a console example using an AES 128-bit key:</p>
<pre><code>connect remote:localhost:2424 serveruser "{'transform':'AES/CBC/PKCS5Padding','key':'8BC7LeGkFbmHEYNTz5GwDw=='}"
</code></pre>
<p>Note that the cipher transformation is specified via 'transform'.  If 'algorithm' is not specified (the key's algorithm), then the algorith is determined from the cipher transformation.</p>
<h3 id="keyfile-1"><a class="header" href="#keyfile-1">keyFile</a></h3>
<p>Here's a console example using an AES key file:</p>
<pre><code>connect remote:localhost:2424 serveruser "{'transform':'AES/CBC/PKCS5Padding','keyFile':'config/user.key'}"
</code></pre>
<h3 id="keystore-1"><a class="header" href="#keystore-1">keyStore</a></h3>
<p>Using a Java KeyStore requires a few more properties.  Here's an example:</p>
<pre><code>connect remote:localhost:2424 serveruser "{'keyStore':{ 'file':'config/server.ks', 'password':'password', 'keyAlias':'useralias', 'keyPassword':'password' } }"
</code></pre>
<p>In the above example, it's assumed the cipher transformation is set as part of the <code>ORIENTDB_SETTINGS</code>.</p>
<p>The 'keyStore' property is an object with the following properties:</p>
<h4 id="file-2"><a class="header" href="#file-2">'file'</a></h4>
<p>The 'file' property is a path to a Java KeyStore file that contains the secret key. Note that the JCEKS KeyStore format must be used to hold secret keys.</p>
<h4 id="password-1"><a class="header" href="#password-1">'password'</a></h4>
<p>The 'password' property holds the password for the KeyStore file. It is optional.</p>
<h4 id="keyalias-1"><a class="header" href="#keyalias-1">'keyAlias'</a></h4>
<p>The 'keyAlias' property is the alias name of the secret key in the KeyStore file. It is required.</p>
<h4 id="keypassword-1"><a class="header" href="#keypassword-1">'keyPassword'</a></h4>
<p>The 'keyPassword' property holds the password for the secret key in the KeyStore and is optional.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="distributed-architecture-2"><a class="header" href="#distributed-architecture-2">Distributed Architecture</a></h1>
<p>OrientDB can be distributed across different servers and used in different ways to achieve the maximum of performance, scalability and robustness.</p>
<p>OrientDB uses the <a href="http://www.hazelcast.com">Hazelcast Open Source project</a> for auto-discovering of nodes, storing the runtime cluster configuration and synchronize certain operations between nodes. Some of the references in this page are linked to the Hazelcast official documentation to get more information about such topic.</p>
<p><em>NOTE: When you run in distributed mode, OrientDB needs more RAM. The minimum is 2GB of heap, but we suggest to use at least 4GB of heap memory. To change the heap modify the Java memory settings in the file <code>bin/server.sh</code> (or server.bat on Windows).</em></p>
<h2 id="main-topics"><a class="header" href="#main-topics">Main topics</a></h2>
<ul>
<li><a href="distributed/Distributed-Architecture-Lifecycle.html">Distributed Architecture Lifecycle</a></li>
<li><a href="distributed/Distributed-Configuration.html">Configure the Cluster of servers</a></li>
<li><a href="distributed/Replication.html">Replication</a> of databases</li>
<li><a href="distributed/Distributed-Sharding.html">Sharding</a></li>
<li><a href="distributed/Data-Centers.html">Data Centers</a></li>
<li><a href="distributed/../gettingstarted/tutorials/Tutorial-Setup-a-distributed-database.html">Tutorial to setup a distributed database</a></li>
<li><a href="distributed/Distributed-Configuration-Tuning.html">Tuning</a></li>
</ul>
<h2 id="basic-concepts-1"><a class="header" href="#basic-concepts-1">Basic concepts</a></h2>
<h3 id="server-roles"><a class="header" href="#server-roles">Server roles</a></h3>
<p>OrientDB has a multi-master distributed architecture (called also as "master-less") where each server can read and write. Starting from v2.1, OrientDB support the role of "REPLICA", where the server is in read-only mode, accepting only idempotent commands, like Reads and Query. Furthermore when the server joins the distributed cluster as "REPLICA", own record clusters are not created like does the "MASTER" nodes.</p>
<p>Starting from v2.2, the biggest advantage of having many REPLICA servers is that they don't concur in <code>writeQuorum</code>, so if you have 3 MASTER servers and 100 REPLICA servers, every write operation will be replicated across 103 servers, but the majority of the <code>writeQuorum</code> would be just 2, because given N/2+1, N is the number of MASTER servers. In this case after the operation is executed locally, the server coordinator of the write operation has to wait only for one more MASTER server.</p>
<h3 id="cluster-ownership"><a class="header" href="#cluster-ownership">Cluster Ownership</a></h3>
<p>When new records (documents, vertices and edges) are created in distributed mode, the <a href="distributed/../datamodeling/Concepts.html#record-id">RID</a> is assigned by following the "cluster locality", where every server defines a "own" record cluster where it is able to create records. If you have the class <code>Customer</code> and 3 server nodes (node1, node2, node3), you'll have these clusters (names can be different):</p>
<ul>
<li><code>customer</code> with id=#15 (this is the default one, assigned to node1)</li>
<li><code>customer_node2</code> with id=#16</li>
<li><code>customer_node3</code> with id=#17</li>
</ul>
<p>So if you create a new Customer on node1, it will get the <a href="distributed/../datamodeling/Concepts.html#record-id">RID</a> with cluster-id of "customer" cluster: #15. The same operation on node2 will generate a <a href="distributed/../datamodeling/Concepts.html#record-id">RID</a> with cluster-id=16 and 17 on node3. In this way <a href="distributed/../datamodeling/Concepts.html#record-id">RID</a> never collides and each node can be a master on insertion without any conflicts, because each node manages own <a href="distributed/../datamodeling/Concepts.html#record-id">RIDs</a>. Starting from v2.2, if a node has more than one cluster per class, a round robin strategy is used to balance the assignment between all the available local clusters.</p>
<p>Ownership configuration is stored in the <a href="distributed/Distributed-Configuration.html#default-distributed-db-configjson">default-distributed-db-config.json</a> file. By default the server owner of the cluster is the first in the list of servers. For example with this configuration:</p>
<pre><code class="language-json">"client_usa": {
  "servers" : [ "usa", "europe", "asia" ]
},
"client_europe": {
  "servers" : [ "europe", "asia", "usa" ]
}
</code></pre>
<p>The server node "usa" is the owner for cluster <code>client_usa</code>, so "usa" is the only server can create records on such cluster. Since every server node has own cluster per class, every node is able to create records, but on different clusters. Since the record clusters are part of a class, when the user executes a <code>INSERT INTO client SET name = "Jay"</code>, the local cluster is selected automatically by OrientDB to store the new "client" record. If this INSERT operation is executed on the server "usa", the "client_usa" cluster is selected. If the same operation is executed on the server "europe", then the cluster "client_europe" would be selected. The important thing is that from a logical point of view, both records from clusters "client_usa" and "client_europe" are always instances of "client" class, so if you execute the following query <code>SELECT * FROM client</code>, both record would be retrieved.</p>
<h4 id="static-owner"><a class="header" href="#static-owner">Static Owner</a></h4>
<p>Starting from v2.2, you can stick a node as owner, no matter the runtime configuration. We call this "static owner". For this purpose use the <code>"owner" : "&lt;NODE_NAME&gt;"</code>. Example:</p>
<pre><code class="language-json">"client_usa": {
  "owner": "usa",
  "servers" : [ "usa", "europe", "asia" ]
}
</code></pre>
<p>With the configuration above, if the "usa" server is unreachable, the ownership of the cluster "client_usa" is not reassigned, so you can't create new records on that cluster until the server "usa" is back online. The static owner comes useful when you want to partition your database to be sure all the inserts come to a particular node.</p>
<h3 id="distributed-transactions"><a class="header" href="#distributed-transactions">Distributed transactions</a></h3>
<p>OrientDB supports distributed transactions. When a transaction is committed, all the updated records are sent across all the servers, so each server is responsible to commit the transaction. In case one or more nodes fail on commit, the quorum is checked. If the quorum has been respected, then the failing nodes are aligned to the winner nodes, otherwise all the nodes rollback the transaction.</p>
<p>When running distributed, the transactions use a 2 phase lock like protocol, with the cool thing that everything is optimistic, so no locks between the begin and the commit, but everything is executed at commit time only.</p>
<p>During the commit time, OrientDB acquires locks on the touched records and check the version of records (optimistic MVCC approach). At this point this could happen:</p>
<ul>
<li>All the record can be locked and nobody touched the records since the beginning of the tx, so the transaction is committed. Cool.</li>
<li>If somebody modified any of the records that are part of the transaction, the transaction fails and the client can retry it</li>
<li>If at commit time, another transaction locked any of the same records, the transaction fails, but the retry in this case is automatic and configurable</li>
</ul>
<p>If you have 5 servers, and writeQuorum is the majority (N/2+1 = 3), this could happen:</p>
<ul>
<li>All the 5 servers commit the TX: cool</li>
<li>1 or 2 servers report any error, the TX is still committed (quorum passes) and the 1 or 2 servers will be forced to have the same result as the others</li>
<li>3 servers or more have different results/errors, so the tx is rollbacked on all the servers to the initial state</li>
</ul>
<h4 id="what-about-the-visibility-during-distributed-transaction"><a class="header" href="#what-about-the-visibility-during-distributed-transaction">What about the visibility during distributed transaction?</a></h4>
<p>During the distributed transaction, in case of rollback, there could be an amount of time when the records appear changed before they are rollbacked.</p>
<h2 id="split-brain-network-problem"><a class="header" href="#split-brain-network-problem">Split brain network problem</a></h2>
<p>OrientDB guarantees strong consistency if it's configured to have a <code>writeQuorum</code> set to a value as the majority of the number of nodes. If you have 5 nodes, it's 3, but if you have 4 nodes, it's still 3 to have a majority. While <code>writeQuorum</code> setting can be configured at database and cluster level too, it's not suggested to set a value minor than the majority of nodes, because in case of re-merge of the 2 split networks, you'd have both network partitions with updated data and OrientDB doesn't support (yet) the merging of 2 non read-only networks. So the suggestion is to always provide a <code>writeQuorum</code> with a value to, at least, the majority of the nodes.</p>
<h2 id="conflict-resolution-policy"><a class="header" href="#conflict-resolution-policy">Conflict Resolution Policy</a></h2>
<p>In case of an even number of servers or when database are not aligned, OrientDB uses a Conflict Resolution Strategy chain. This default chain is defined as a global setting (<code>distributed.conflictResolverRepairerChain</code>):</p>
<p><code>-Ddistributed.conflictResolverRepairerChain=majority,content,version</code></p>
<p>The Conflict Resolution Strategy implementation are called in chain following the declaration order until a winner is selected. In the default configuration (above):</p>
<ul>
<li>is first checked if there is a <strong>strict majority</strong> for the record in terms of record versions. If the majority exists, the winner is selected</li>
<li>if no strict majority was found, the <strong>record content</strong> is analyzed. If the majority is reached by founding a record with different versions but equal content, then that record will be the winner by using the higher version between them</li>
<li>if no majority has been found with the content, then the <strong>higher version</strong> wins (supposing an higher version means the most update record)</li>
</ul>
<p>OrientDB Enterprise Edition supports the additional <a href="distributed/Data-Centers.html">Data Center</a> Conflict Resolution (<code>dc</code>).</p>
<p>At the end of the chain, if no winner is found, the records are untouched and only a manual intervention can decide who is the winner. In this case a WARNING message is displayed in the console with text <code>Auto repair cannot find a winner for record &lt;rid&gt; and the following groups of contents: [&lt;records&gt;]</code>.</p>
<h2 id="limitations-2"><a class="header" href="#limitations-2">Limitations</a></h2>
<p>OrientDB v2.2.x has some limitations you should notice when you work in Distributed Mode:</p>
<ul>
<li>In memory database is not supported.</li>
<li>Importing a database while running distributed is not supported. Import the database in non-distributed mode and then run the OrientDB in distributed mode.</li>
<li>With releases &lt; v2.2.6 the creation of a database on multiple nodes could cause synchronization problems when clusters are automatically created. Please create the databases before to run in distributed mode.</li>
<li>Constraints with distributed databases could cause problems because some operations are executed at 2 steps: create + update. For example in some circumstance edges could be first created, then updated, but constraints like MANDATORY and NOTNULL against fields would fail at the first step making the creation of edges not possible on distributed mode.</li>
<li>Auto-Sharding is not supported in the common meaning of Distributed Hash Table (DHT). Selecting the right shard (cluster) is up to the application. This will be addressed by next releases.</li>
<li>Sharded Indexes are not supported yet, so creating a UNIQUE index against a sharded class doesn't guarantee a key to be unique. This will be addressed with Auto-sharding in the further releases.</li>
<li>Hot change of distributed configuration is available only in Enterprise Edition (commercial licensed).</li>
<li>Not complete merging of results for all the projections when running on sharder configuration. Some functions like AVG() doesn’t work on map/reduce.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="distributed-architecture-lifecycle"><a class="header" href="#distributed-architecture-lifecycle">Distributed Architecture Lifecycle</a></h1>
<p>In OrientDB Distributed Architecture all the nodes are masters (Multi-Master), while in most DBMS the replication works in Master-Slave mode where there is only one Master node and N Slaves that are use only for reads or when the Master is down. Starting from OrientDB v2.1, you can also assign the role of <a href="distributed/Distributed-Architecture.html#server-roles">REPLICA</a> to some nodes.</p>
<p>When start a OrientDB server in distributed mode (<code>bin/dserver.sh</code>) it looks for an existent cluster. If exists the starting node joins the cluster, otherwise creates a new one. You can have <a href="distributed/Distributed-Architecture-Lifecycle.html#multiple-clusters">multiple clusters</a> in your network, each cluster with a different "group name".</p>
<h2 id="joining-a-cluster"><a class="header" href="#joining-a-cluster">Joining a cluster</a></h2>
<h3 id="auto-discovering"><a class="header" href="#auto-discovering">Auto discovering</a></h3>
<p>At startup each Server Node sends an IP Multicast message in broadcast to discover if an existent cluster is available to join it. If available the Server Node will connect to it, otherwise creates a new cluster.</p>
<p><img src="http://www.orientdb.org/images/cluster-autodiscovering.png" alt="image" /></p>
<p>This is the default configuration contained in <code>config/hazelcast.xml</code> file. Below the multicast configuration fragment:</p>
<pre><code class="language-xml">&lt;hazelcast&gt;
  &lt;network&gt;
    &lt;port auto-increment="true"&gt;2434&lt;/port&gt;
      &lt;join&gt;
        &lt;multicast enabled="true"&gt;
          &lt;multicast-group&gt;235.1.1.1&lt;/multicast-group&gt;
          &lt;multicast-port&gt;2434&lt;/multicast-port&gt;
       &lt;/multicast&gt;
     &lt;/join&gt;
  &lt;/network&gt;
&lt;/hazelcast&gt;
</code></pre>
<p>If multicast is not available (typical on Cloud environments), you can use:</p>
<ul>
<li><a href="http://docs.hazelcast.org/docs/3.6/manual/html-single/index.html#discovering-members-by-tcp">Direct IPs</a></li>
<li><a href="http://docs.hazelcast.org/docs/3.6/manual/html-single/index.html#discovering-members-within-ec2-cloud">Amazon EC2 Discovering</a></li>
</ul>
<p>For more information look at <a href="http://docs.hazelcast.org/docs/3.6/manual/html-single/index.html#network-configuration">Hazelcast documentation about configuring network</a>.</p>
<h3 id="security-8"><a class="header" href="#security-8">Security</a></h3>
<p>To join a cluster the Server Node has to configure the cluster group name and password in hazelcast.xml file. By default these information aren't encrypted. If you wan to encrypt all the distributed messages, configure it in hazelcast.xml file:</p>
<pre><code class="language-xml">&lt;hazelcast&gt;
    ...
    &lt;network&gt;
        ...
        &lt;!--
            Make sure to set enabled=true
            Make sure this configuration is exactly the same on
            all members
        --&gt;
        &lt;symmetric-encryption enabled="true"&gt;
            &lt;!--
               encryption algorithm such as
               DES/ECB/PKCS5Padding,
               PBEWithMD5AndDES,
               Blowfish,
               DESede
            --&gt;
            &lt;algorithm&gt;PBEWithMD5AndDES&lt;/algorithm&gt;

            &lt;!-- salt value to use when generating the secret key --&gt;
            &lt;salt&gt;thesalt&lt;/salt&gt;

            &lt;!-- pass phrase to use when generating the secret key --&gt;
            &lt;password&gt;thepass&lt;/password&gt;

            &lt;!-- iteration count to use when generating the secret key --&gt;
            &lt;iteration-count&gt;19&lt;/iteration-count&gt;
        &lt;/symmetric-encryption&gt;
    &lt;/network&gt;
    ...
&lt;/hazelcast&gt;
</code></pre>
<p>All the nodes in the distributed cluster must have the same settings.</p>
<p><img src="http://www.orientdb.org/images/cluster-security.png" alt="image" /></p>
<p>For more information look at: <a href="https://docs.hazelcast.org/docs/3.10/manual/html-single/#encryption">Hazelcast Encryption</a>.</p>
<h3 id="join-to-an-existent-cluster"><a class="header" href="#join-to-an-existent-cluster">Join to an existent cluster</a></h3>
<p>You can have multiple OrientDB clusters in the same network, what identifies a cluster is it’s name that must be unique in the network. By default OrientDB uses "orientdb", but for security reasons change it to a different name and password. All the nodes in the distributed cluster must have the same settings.</p>
<pre><code class="language-xml">&lt;hazelcast&gt;
  &lt;group&gt;
    &lt;name&gt;orientdb&lt;/name&gt;
    &lt;password&gt;orientdb&lt;/password&gt;
  &lt;/group&gt;
&lt;/hazelcast&gt;
</code></pre>
<p>In this case Server #2 joins the existent cluster.</p>
<p><img src="http://www.orientdb.org/images/cluster-join.png" alt="image" /></p>
<p>When a node joins an existent cluster, the most updated copy of the database is downloaded to the joining node if the distributed configuration has <code>autoDeploy:true</code>. If the node is rejoining the cluster after a disconnection, a delta backup is requested first. If not available a full backup is sent to the joining server. If it has been configured a sharded configuration, the joining node will ask for separate parts of the database to multiple available servers to reconstruct the own database copy. If any copy of database was already present, that is moved under <code>backup/databases</code> folder.</p>
<h3 id="multiple-clusters"><a class="header" href="#multiple-clusters">Multiple clusters</a></h3>
<p>Multiple clusters can coexist in the same network. Clusters can't see each others because are isolated black boxes.</p>
<p><img src="http://www.orientdb.org/images/cluster-multiple.png" alt="image" /></p>
<h3 id="distribute-the-configuration-to-the-clients"><a class="header" href="#distribute-the-configuration-to-the-clients">Distribute the configuration to the clients</a></h3>
<p>Every time a new Server Node joins or leaves the Cluster, the new Cluster configuration is broadcasted to all the connected clients. Everybody knows the cluster layout and who has a database!</p>
<p><img src="http://www.orientdb.org/images/cluster-cfg.png" alt="image" /></p>
<h2 id="fail-over-management"><a class="header" href="#fail-over-management">Fail over management</a></h2>
<h3 id="when-a-node-is-unreachable"><a class="header" href="#when-a-node-is-unreachable">When a node is unreachable</a></h3>
<p>When a Server Node becomes unreachable (because it’s crashed, network problems, high load, etc.) the Cluster treats this event as if the Server Node left the cluster.</p>
<p><img src="http://www.orientdb.org/images/cluster-crash.png" alt="image" /></p>
<p>Starting from v2.2.13, the unreachable server is removed from the <a href="distributed/Distributed-Configuration.html">distributed configuration</a> only if it's dynamic, that means it hasn't registered under the <a href="distributed/Distributed-Configuration.html#default-distributed-db-configjson"><code>servers</code></a> configuration. Once removed it doesn't concur to the quorum anymore. Instead, if the server has been registered under <a href="distributed/Distributed-Configuration.html#default-distributed-db-configjson"><code>servers</code></a>, it's kept in configuration waiting for a rejoining.</p>
<p>The <a href="distributed/Distributed-Configuration.html#default-distributed-db-configjson"><code>newNodeStrategy</code></a> setting specifies if a new joining node is automatically registered as static or is managed as dynamic.</p>
<h3 id="automatic-switch-of-servers"><a class="header" href="#automatic-switch-of-servers">Automatic switch of servers</a></h3>
<p>All the clients connected to the unreachable node will switch to another server transparently without raising errors to the Application User Application doesn’t know what is happening!</p>
<p><img src="http://www.orientdb.org/images/cluster-clientswitch.png" alt="image" /></p>
<h3 id="re-distribute-the-updated-configuration-again"><a class="header" href="#re-distribute-the-updated-configuration-again">Re-distribute the updated configuration again</a></h3>
<p>After the Server #2 left the Cluster the updated configuration is sent again to all the connected clients.</p>
<p><img src="http://www.orientdb.org/images/cluster-recfg.png" alt="image" /></p>
<p>Continue with:</p>
<ul>
<li><a href="distributed/Distributed-Architecture.html">Distributed Architecture</a></li>
<li><a href="distributed/Replication.html">Replication</a></li>
<li><a href="distributed/../gettingstarted/tutorials/Tutorial-Setup-a-distributed-database.html">Tutorial to setup a distributed database</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="distributed-configuration-1"><a class="header" href="#distributed-configuration-1">Distributed Configuration</a></h1>
<p>The distributed configuration consists of 3 files under the <strong>config/</strong> directory:</p>
<ul>
<li><a href="distributed/Distributed-Configuration.html#orientdb-server-configxml">orientdb-server-config.xml</a></li>
<li><a href="distributed/Distributed-Configuration.html#default-distributed-db-configjson">default-distributed-db-config.json</a></li>
<li><a href="distributed/Distributed-Configuration.html#hazelcastxml">hazelcast.xml</a></li>
</ul>
<p>Main topics:</p>
<ul>
<li><a href="distributed/Replication.html">Replication</a></li>
<li><a href="distributed/Distributed-Configuration.html#asynchronous-replication-mode">Asynchronous replication mode</a></li>
<li><a href="distributed/Distributed-Runtime.html">Return distributed configuration at run-time</a></li>
<li><a href="distributed/Distributed-Configuration.html#load-balancing">Load Balancing</a></li>
<li><a href="distributed/Data-Centers.html">Data Center support</a></li>
<li><a href="distributed/Distributed-Configuration.html#cloud-support">Cloud support</a></li>
</ul>
<h2 id="orientdb-server-configxml-1"><a class="header" href="#orientdb-server-configxml-1">orientdb-server-config.xml</a></h2>
<p>To enable and configure the clustering between nodes, add and enable the <strong>OHazelcastPlugin</strong> plugin. It is configured as a <a href="distributed/../internals/DB-Server.html#plugins">Server Plugin</a>. The default configuration is reported below.</p>
<p>File <strong>orientdb-server-config.xml</strong>:</p>
<pre><code class="language-xml">&lt;handler class="com.orientechnologies.orient.server.hazelcast.OHazelcastPlugin"&gt;
  &lt;parameters&gt;
    &lt;!-- NODE-NAME. IF NOT SET IS AUTO GENERATED THE FIRST TIME THE SERVER RUN --&gt;
    &lt;!-- &lt;parameter name="nodeName" value="europe1" /&gt; --&gt;
    &lt;parameter name="enabled" value="true" /&gt;
    &lt;parameter name="configuration.db.default"
               value="${ORIENTDB_HOME}/config/default-distributed-db-config.json" /&gt;
    &lt;parameter name="configuration.hazelcast"
               value="${ORIENTDB_HOME}/config/hazelcast.xml" /&gt;
  &lt;/parameters&gt;
&lt;/handler&gt;
</code></pre>
<p>Where:</p>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody>
<tr><td>enabled</td><td>To enable or disable the plugin: <code>true</code> to enable it, <code>false</code> to disable it. By default is <code>true</code></td></tr>
<tr><td>nodeName</td><td>An optional alias identifying the current node within the cluster. When omitted, a default value is generated as node<random-long-number>, example: "node239233932932". By default is commented, so it's automatic generated</td></tr>
<tr><td>configuration.db.default</td><td>Path of default <a href="distributed/Distributed-Configuration.html#default-distributed-db-configjson">distributed database configuration</a>. By default is <code>${ORIENTDB_HOME}/config/default-distributed-db-config.json</code></td></tr>
<tr><td>configuration.hazelcast</td><td>Path of <a href="http://www.hazelcast.com/docs/3.1/manual/multi_html/ch14.html">Hazelcast</a> configuration file, default is <code>${ORIENTDB_HOME}/config/hazelcast.xml</code></td></tr>
</tbody></table>
</div>
<h2 id="default-distributed-db-configjson"><a class="header" href="#default-distributed-db-configjson">default-distributed-db-config.json</a></h2>
<p>This is the JSON file containing the default configuration for distributed databases. The first time a database run in distributed version this file is copied in the database's folder with name <code>distributed-config.json</code>. Every time the cluster shape changes the database specific file is changed. To restore distributed database settings, remove the file <code>distributed-config.json</code> from the database folder, and the <code>default-distributed-db-config.json</code> file will be used.</p>
<p>Default <strong>default-distributed-db-config.json</strong> file content:</p>
<pre><code class="language-json">{
    "autoDeploy": true,
    "executionMode": "undefined",
    "readQuorum": 1,
    "writeQuorum": "majority",
    "readYourWrites": true,
    "newNodeStrategy": "static",
    "dataCenters": {
      "rome": {
        "writeQuorum": "majority",
        "servers": [ "europe-0", "europe-1", "europe-2" ]
      },
      "denver": {
        "writeQuorum": "majority",
        "servers": [ "usa-0", "usa-1", "usa-2" ]
      }
    },
    "servers": {
        "*": "master"
    },
    "clusters": {
        "internal": {
        },
        "product": {
          "servers": ["usa", "china"]
        },
        "employee_usa": {
          "owner": "usa",
          "servers": ["usa", "&lt;NEW_NODE&gt;"]
        },
        "*": { "servers" : [ "&lt;NEW_NODE&gt;" ] }
    }
}
</code></pre>
<p>Where:</p>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Default value</th></tr></thead><tbody>
<tr><td><strong>autoDeploy</strong></td><td>Whether to deploy the database to any joining node that does not have it. It can be <code>true</code> or <code>false</code></td><td><code>true</code></td></tr>
<tr><td><strong>executionMode</strong></td><td>It can be <code>undefined</code> to let to the client to decide per call execution between synchronous (default) or asynchronous. <code>synchronous</code> forces synchronous mode, and  <code>asynchronous</code> forces asynchronous mode</td><td><code>undefined</code></td></tr>
<tr><td><strong>readQuorum</strong></td><td>On "read" operation (record read, query and traverse) this is the number of responses to be coherent before sending the response to the client. Set to 1 if you don't want this check at read time</td><td><code>1</code></td></tr>
<tr><td><strong>writeQuorum</strong></td><td>On "write" operation (any write on database) this is the number of responses to be coherent before sending the response to the client. Set to 1 if you don't want this check at write time. Suggested value is "majority", the default, that means N/2+1 where N is the number of available nodes. In this way the quorum is reached only if the majority of nodes are coherent. "all" means all the available nodes. Starting from v2.2, N represent the MASTER only servers. For more information look at <a href="distributed/Distributed-Architecture.html#server-roles">Server Roles</a>.</td><td><code>"majority"</code></td></tr>
<tr><td><strong>readYourWrites</strong></td><td>Whether the write quorum is satisfied only when also the local node responded. This assures current the node can read its writes. Disable it to improve replication performance if such consistency is not important. Can be <code>true</code> or <code>false</code></td><td><code>true</code></td></tr>
<tr><td><strong>newNodeStrategy</strong></td><td>Strategy to use when a new node joins the cluster. Default is <code>static</code> that means the server is automatically registered under <code>servers</code> list in configuration. If it is <code>dynamic</code>, then the node is not registered. This affects the strategy when a node is unreachable. If it is not registered (dynamic), it is removed from the configuration, so it does not concur in the quorum. Available since v2.2.13</td><td><code>static</code></td></tr>
<tr><td><strong>dataCenters</strong></td><td>(Since v2.2.4) Optional (and only available in the <a href="http://orientdb.com/orientdb-enterprise">Enterprise Edition</a>, contains the definition of the data centers. For more information look at <a href="distributed/Data-Centers.html">Data Centers</a></td><td>-</td></tr>
<tr><td><strong>servers</strong></td><td>(Since v2.1) Optional, contains the map of server roles in the format <code>server-name</code> : <code>role</code>. <code>*</code> means any server. Available roles are "MASTER" (default) and "REPLICA". For more information look at <a href="distributed/Distributed-Architecture.html#server-roles">Server roles</a></td><td>-</td></tr>
<tr><td><strong>clusters</strong></td><td>if the object containing the clusters' configuration as map <code>cluster-name</code> : <code>cluster-configuration</code>. <code>*</code> means all the clusters and is the cluster's default configuration</td><td>-</td></tr>
</tbody></table>
</div>
<p>The <strong>cluster</strong> configuration inherits database configuration, so if you declare "writeQuorum" at database level, all the clusters will inherit that setting unless they define your own. Settings can be:</p>
<div class="table-wrapper"><table><thead><tr><th>Parameter</th><th>Description</th><th>Default value</th></tr></thead><tbody>
<tr><td><strong>readQuorum</strong></td><td>On "read" operation (record read, query and traverse) is the number of responses to be coherent before to send the response to the client. Set to 1 if you don't want this check at read time</td><td><code>1</code></td></tr>
<tr><td><strong>writeQuorum</strong></td><td>On "write" operation (any write on database) is the number of responses to be coherent before to send the response to the client. Set to 1 if you don't want this check at write time. Suggested value is "majority", the default, that means N/2+1 where N is the number of available nodes. In this way the quorum is reached only if the majority of nodes are coherent. "all" means all the available nodes. Starting from v2.2, N represent the MASTER only servers. For more information look at <a href="distributed/Distributed-Architecture.html#server-roles">Server Roles</a>.</td><td><code>"majority"</code></td></tr>
<tr><td><strong>readYourWrites</strong></td><td>The write quorum is satisfied only when also the local node responded. This assure current the node can read its writes. Disable it to improve replication performance if such consistency is not important. Can be <code>true</code> or <code>false</code></td><td><code>true</code></td></tr>
<tr><td><strong>owner</strong></td><td>By default the cluster owner is assigned at run-time and it's placed as first server in the <code>servers</code> list. If <code>owner</code> field is defined, the server owner is statically assigned to that server, no matter if the server is available or not.</td><td></td></tr>
<tr><td><strong>servers</strong></td><td>Is the array of servers where to store the records of cluster</td><td>empty for internal and index clusters and <code>[ "&lt;NEW_NODE&gt;" ]</code> for cluster * representing any cluster</td></tr>
</tbody></table>
</div>
<p><code>"&lt;NEW_NODE&gt;"</code> is a special tag that put any new joining node name in the array.</p>
<h3 id="default-configuration"><a class="header" href="#default-configuration">Default configuration</a></h3>
<p>In the default configuration all the record clusters are replicated, but <code>internal</code>. Every node that joins the cluster shares all the rest of the clusters ("*" settings). Since "readQuorum" is 1 all the reads are executed on the first available node where the local node is preferred if own the requested record. "writeQuorum" to "majority" means that all the changes are in at least N/2+1 nodes, where N is the number of available nodes. Using "majority" instead of a number, allows you to have an elastic configuration where nodes can join and left without the need to rebalance this value manually.</p>
<h3 id="100-asynchronous-writes"><a class="header" href="#100-asynchronous-writes">100% Asynchronous Writes</a></h3>
<p>By default writeQuorum is "majority". This means that it waits and checks the answer from at least N/2+1 (where N is the number of available nodes) nodes before to send the ACK to the client. After the quorum is reached, the responses are managed asynchronously. For example, with 3 nodes and <code>writeQuorum: "majority"</code>, then after the 2nd node's answer, the collecting and check of the 3rd node answer is managed asynchronously. You could also set this to 1 to have all the writes asynchronous.</p>
<h3 id="full-consistency"><a class="header" href="#full-consistency">Full Consistency</a></h3>
<p>To avoid experiencing any dirty reads during the replication, you can setup the writeQuorum to "all", that means all the available nodes. Example: `writeQuorum: "all". Setting writeQuorum to "all" means each replication operation will take the time of the slowest node in the cluster.</p>
<h2 id="hazelcastxml"><a class="header" href="#hazelcastxml">hazelcast.xml</a></h2>
<p>A OrientDB cluster is composed by two or more servers that are the <strong>nodes</strong> of the cluster. All the server nodes that want to be part of the same cluster must to define the same <a href="http://docs.hazelcast.org/docs/3.5/manual/html/createclustergroups.html">Cluster Group</a>. By default "orientdb" is the group name. Look at the default <strong>config/hazelcast.xml</strong> configuration file reported below:</p>
<pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;hazelcast xsi:schemaLocation="http://www.hazelcast.com/schema/config hazelcast-config-3.0.xsd"
           xmlns="http://www.hazelcast.com/schema/config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
  &lt;group&gt;
    &lt;name&gt;orientdb&lt;/name&gt;
    &lt;password&gt;orientdb&lt;/password&gt;
  &lt;/group&gt;
  &lt;network&gt;
    &lt;port auto-increment="true"&gt;2434&lt;/port&gt;
    &lt;join&gt;
      &lt;multicast enabled="true"&gt;
        &lt;multicast-group&gt;235.1.1.1&lt;/multicast-group&gt;
        &lt;multicast-port&gt;2434&lt;/multicast-port&gt;
      &lt;/multicast&gt;
    &lt;/join&gt;
  &lt;/network&gt;
  &lt;executor-service&gt;
    &lt;pool-size&gt;16&lt;/pool-size&gt;
  &lt;/executor-service&gt;
&lt;/hazelcast&gt;
</code></pre>
<p><em>NOTE: Change the name and password of the group to prevent foreign nodes from joining it!</em></p>
<h3 id="network-configuration"><a class="header" href="#network-configuration">Network configuration</a></h3>
<h4 id="automatic-discovery-in-lan-using-multicast"><a class="header" href="#automatic-discovery-in-lan-using-multicast">Automatic discovery in LAN using Multicast</a></h4>
<p>OrientDB by default uses TCP Multicast to discover nodes. This is contained in <strong>config/hazelcast.xml</strong> file under the <strong>network</strong> tag. This is the default configuration:</p>
<pre><code class="language-xml">&lt;hazelcast&gt;
  ...
  &lt;network&gt;
    &lt;port auto-increment="true"&gt;2434&lt;/port&gt;
    &lt;join&gt;
      &lt;multicast enabled="true"&gt;
        &lt;multicast-group&gt;235.1.1.1&lt;/multicast-group&gt;
        &lt;multicast-port&gt;2434&lt;/multicast-port&gt;
      &lt;/multicast&gt;
     &lt;/join&gt;
  &lt;/network&gt;
  ...
&lt;/hazelcast&gt;
</code></pre>
<h4 id="manual-ip"><a class="header" href="#manual-ip">Manual IP</a></h4>
<p>When Multicast is disabled or you prefer to assign Hostnames/IP-addresses manually use the TCP/IP tag in configuration. Pay attention to disable the <strong>multicast</strong>:</p>
<pre><code class="language-xml">&lt;hazelcast&gt;
  ...
  &lt;network&gt;
    &lt;port auto-increment="true"&gt;2434&lt;/port&gt;
    &lt;join&gt;
      &lt;multicast enabled="false"&gt;
        &lt;multicast-group&gt;235.1.1.1&lt;/multicast-group&gt;
        &lt;multicast-port&gt;2434&lt;/multicast-port&gt;
      &lt;/multicast&gt;
      &lt;tcp-ip enabled="true"&gt;
        &lt;member&gt;europe0:2434&lt;/member&gt;
        &lt;member&gt;europe1:2434&lt;/member&gt;
        &lt;member&gt;usa0:2434&lt;/member&gt;
        &lt;member&gt;asia0:2434&lt;/member&gt;
        &lt;member&gt;192.168.1.0-7:2434&lt;/member&gt;
      &lt;/tcp-ip&gt;
     &lt;/join&gt;
  &lt;/network&gt;
  ...
&lt;/hazelcast&gt;
</code></pre>
<p>For more information look at: <a href="http://docs.hazelcast.org/docs/3.5/manual/html/tcp.html">Hazelcast Config TCP/IP</a>.</p>
<h4 id="cloud-support"><a class="header" href="#cloud-support">Cloud support</a></h4>
<p>Since multicast is disabled on most of the Cloud stacks, you have to change the <strong>config/hazelcast.xml</strong> configuration file based on the Cloud used.</p>
<h5 id="amazon-ec2"><a class="header" href="#amazon-ec2">Amazon EC2</a></h5>
<p>OrientDB supports natively <a href="http://aws.amazon.com/ec2/">Amazon EC2</a> through the Hazelcast's Amazon discovery plugin. In order to use it include also the <strong>hazelcast-cloud.jar</strong> library under the <strong>lib/</strong> directory.</p>
<pre><code class="language-xml">&lt;hazelcast&gt;
  ...
    &lt;join&gt;
      &lt;multicast enabled="false"&gt;
        &lt;multicast-group&gt;235.1.1.1&lt;/multicast-group&gt;
        &lt;multicast-port&gt;2434&lt;/multicast-port&gt;
      &lt;/multicast&gt;
      &lt;aws enabled="true"&gt;
        &lt;access-key&gt;my-access-key&lt;/access-key&gt;
        &lt;secret-key&gt;my-secret-key&lt;/secret-key&gt;
        &lt;region&gt;us-west-1&lt;/region&gt;                               &lt;!-- optional, default is us-east-1 --&gt;
        &lt;host-header&gt;ec2.amazonaws.com&lt;/host-header&gt;             &lt;!-- optional, default is ec2.amazonaws.com. If set region
                                                                      shouldn't be set as it will override this property --&gt;
        &lt;security-group-name&gt;hazelcast-sg&lt;/security-group-name&gt;  &lt;!-- optional --&gt;
        &lt;tag-key&gt;type&lt;/tag-key&gt;                                  &lt;!-- optional --&gt;
        &lt;tag-value&gt;hz-nodes&lt;/tag-value&gt;                          &lt;!-- optional --&gt;
      &lt;/aws&gt;
    &lt;/join&gt;
  ...
&lt;/hazelcast&gt;
</code></pre>
<p>For more information look at <a href="http://docs.hazelcast.org/docs/3.5/manual/html/ec2.html">Hazelcast Config Amazon EC2 Auto Discovery</a>.</p>
<h5 id="other-cloud-providers"><a class="header" href="#other-cloud-providers">Other Cloud providers</a></h5>
<p>Uses manual IP like explained in <a href="distributed/Distributed-Configuration.html#manual-ip">Manual IP</a>.</p>
<h2 id="asynchronous-replication-mode"><a class="header" href="#asynchronous-replication-mode">Asynchronous replication mode</a></h2>
<p>If you are replication OrientDB database across multiple Data Centers, look at <a href="distributed/Data-Centers.html">Data Centers Configuration</a> available only with the <a href="http://orientdb.com/orientdb-enterprise">Enterprise Edition</a>.</p>
<p>If you are using the Community Edition or if you don't have multiple data centers, but just a network with high latency, in order to reduce the impact of the latency in the replication, the suggested configuration is to set <code>executionMode</code> to "asynchronous". In asynchronous mode any operation is executed on local node and then replicated. In this mode the client doesn't wait for the quorum across all the servers, but receives the response immediately after the local node answer. Example:</p>
<pre><code class="language-json">{
    "autoDeploy": true,
    "executionMode": "asynchronous",
    "readQuorum": 1,
    "writeQuorum": "majority",
    "readYourWrites": true,
    "newNodeStrategy": "static",
    "servers": {
        "*": "master"
    },
    "clusters": {
        "internal": {
        },
        "*": {
            "servers" : [ "&lt;NEW_NODE&gt;" ]
        }
    }
}
</code></pre>
<p>Starting from v2.1.6 is possible to catch events of command during asynchronous replication, thanks to the following method of OCommandSQL:</p>
<ul>
<li><code>onAsyncReplicationOk()</code>, to catch the event when the asynchronous replication succeed</li>
<li><code>onAsyncReplicationError()</code>, to catch the event when the asynchronous replication returns error</li>
</ul>
<p>Example retrying up to 3 times in case of concurrent modification exception on creation of edges:</p>
<pre><code class="language-java">g.command( new OCommandSQL("create edge Own from (select from User) to (select from Post)")
 .onAsyncReplicationError(new OAsyncReplicationError() {
  @Override
  public ACTION onAsyncReplicationError(Throwable iException, int iRetry) {
    System.err.println("Error, retrying...");
    return iException instanceof ONeedRetryException &amp;&amp; iRetry&lt;=3 ? ACTION.RETRY : ACTION.IGNORE;
  }
})
 .onAsyncReplicationOk(new OAsyncReplicationOk() {
   System.out.println("OK");
 }
).execute();
</code></pre>
<h2 id="load-balancing"><a class="header" href="#load-balancing">Load Balancing</a></h2>
<p>(Since v2.2)
OrientDB allows to do load balancing when you have multiple servers connected in cluster. Below are the available connection strategies:</p>
<ul>
<li><code>STICKY</code>, the default, where the client remains connected to a server until the close of database</li>
<li><code>ROUND_ROBIN_CONNECT</code>, at each connect, the client connects to a different server between the available ones</li>
<li><code>ROUND_ROBIN_REQUEST</code>, at each request, the client connects to a different server between the available ones. Pay attention on using this strategy if you're looking for strong consistency. In facts, in case the writeQuorum is minor of the total nodes available, a client could have executed an operation against another server and current operation cannot see updates because wasn't propagated yet.</li>
</ul>
<p>Once a client is connected to any server node, it retrieves the list of available server nodes. In case the connected server becomes unreachable (crash, network problem, etc.), the client automatically connects to the next available one.</p>
<p>To setup the strategy using the Java Document API:</p>
<pre><code class="language-java">OrientDB orientDB = new OrientDB("remote:localhost", OrientDBConfig.defaultConfig());
OrientDBConfig config = OrientDBConfig.builder().addConfig(CLIENT_CONNECTION_STRATEGY, "ROUND_ROBIN_CONNECT").build();
final ODatabaseDocument db = orientDB.open("demo", user, password, config);
</code></pre>
<p>To setup the strategy using the Java Graph API:</p>
<pre><code class="language-java">final OrientGraphFactory factory = new OrientGraphFactory("remote:localhost/demo");
factory.setConnectionStrategy(OStorageRemote.CONNECTION_STRATEGY.ROUND_ROBIN_CONNECT.toString());
OrientGraphNoTx graph = factory.getNoTx();
</code></pre>
<h3 id="use-multiple-addresses"><a class="header" href="#use-multiple-addresses">Use multiple addresses</a></h3>
<p>If the server addresses are known, it is good practice to connect the clients to a set of URLs, instead of just one. You can separate hosts/addresses by using a semicolon (;). OrientDB client will try to connect to the addresses in order. Example: <code>remote:server1:2424;server2:8888;server3/mydb</code>.</p>
<h3 id="use-the-dns"><a class="header" href="#use-the-dns">Use the DNS</a></h3>
<p>Before v2.2, the simplest and most powerful way to achieve load balancing seems to use some hidden (to some) properties of DNS. The trick is to create a TXT record listing the servers.</p>
<p>The format is:</p>
<pre><code>v=opf&lt;version&gt; (s=&lt;hostname[:&lt;port&gt;]&gt; )*
</code></pre>
<p>Example of TXT record for domain <strong>dbservers.mydomain.com</strong>:</p>
<pre><code>v=opf1 s=192.168.0.101:2424 s=192.168.0.133:2424
</code></pre>
<p>In this way if you open a database against the URL <code>remote:dbservers.mydomain.com/demo</code> the OrientDB client library will try to connect to the address <strong>192.168.0.101</strong> port 2424. If the connection fails, then the next address <strong>192.168.0.133:</strong> port 2424 is tried.</p>
<p>To enable this feature in Java Client driver set <code>network.binary.loadBalancing.enabled=true</code>:</p>
<pre><code>java ... -Dnetwork.binary.loadBalancing.enabled=true
</code></pre>
<p>or via Java code:</p>
<pre><code class="language-java">OGlobalConfiguration.NETWORK_BINARY_DNS_LOADBALANCING_ENABLED.setValue(true);
</code></pre>
<h2 id="troubleshooting-2"><a class="header" href="#troubleshooting-2">Troubleshooting</a></h2>
<h3 id="hazelcast-monitor"><a class="header" href="#hazelcast-monitor">Hazelcast Monitor</a></h3>
<p>Users reported that Hazelcast Health Monitoring could cause problem with a JVM kill (OrientDB uses Hazelcast to manage replication between nodes). By default this setting is OFF, so if you are experiencing this kind of problem assure this is set:  <code>hazelcast.health.monitoring.level=OFF</code></p>
<h3 id="extraction-directory"><a class="header" href="#extraction-directory">Extraction Directory</a></h3>
<p>OrientDB extract the database form the network to the temporary directory set in the JVM by <code>java.io.tmpdir</code> setting. To change the temporary directory used to store the temporary database, overwrite the default setting at JVM startup (or even at run-time from Java). Example:</p>
<pre><code>java ... -Djava.io.tmpdir=/myfolder/server1
</code></pre>
<p>OrientDB will create the temporary database under the folder <code>/myfolder/server1/orientdb</code>.</p>
<h2 id="history-9"><a class="header" href="#history-9">History</a></h2>
<h3 id="v2213"><a class="header" href="#v2213">v2.2.13</a></h3>
<p>New setting <code>newNodeStrategy</code> to specify what happens when a new node joins. This affects the behaviour when a node is unreachable. If it is not present under the <code>servers</code> list, then it's removed from the configuration and it doesn't concur in the quorum anymore.</p>
<h3 id="v22"><a class="header" href="#v22">v2.2</a></h3>
<p>The intra-node communication is not managed with Hazelcast Queues anymore, but rather through the OrientDB binary protocol. This assure better performance and avoid the problem of locality of the Hazelcast queues. Release v2.2 also supported the wildcard "majority" and "all" for the read and write quorums. Introduced also the concept of static cluster owner. Furthermore nodes are not removed by configuration when they are offline.</p>
<p>Introduced Load balancing at client level. For more information look at <a href="distributed/Distributed-Configuration.html#load-balancing">load balancing</a>.</p>
<h3 id="v17"><a class="header" href="#v17">v1.7</a></h3>
<p>Simplified configuration by moving. Removed some flags (replication:boolean, now it’s deducted by the presence of “servers” field) and settings now are global (autoDeploy, hotAlignment, offlineMsgQueueSize, readQuorum, writeQuorum, failureAvailableNodesLessQuorum, readYourWrites), but you can overwrite them per-cluster.</p>
<p>For more information look at <a href="http://www.orientechnologies.com/distributed-architecture-sharding/">News in 1.7</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="distributed-architecture-plugin"><a class="header" href="#distributed-architecture-plugin">Distributed Architecture Plugin</a></h1>
<p>Java class: <code>com.orientechnologies.orient.server.hazelcast.OHazelcastPlugin</code></p>
<h2 id="introduction-8"><a class="header" href="#introduction-8">Introduction</a></h2>
<p>This is part of <a href="distributed/Distributed-Architecture.html">Distributed Architecture</a>. Configure a distributed clustered architecture. This task is configured as a <a href="distributed/../internals/DB-Server.html#plugins">Server handler</a>. The task can be configured easily by changing these parameters:</p>
<ul>
<li><strong>enabled</strong>: Enable the plugin: <code>true</code> to enable, <code>false</code> to disable it.</li>
<li><strong>configuration.hazelcast</strong>: The location of the <a href="distributed/Distributed-Configuration.html#hazelcastxml">Hazelcast configuration file</a> (<code>hazelcast.xml</code>).</li>
<li><strong>alias</strong>: An alias for the current node within the cluster name. Default value is the IP address and port for OrientDB on this node.</li>
<li><strong>configuration.db.default</strong>: The location of a file that describes, using JSON syntax, the synchronization <a href="distributed/Distributed-Configuration.html#default-distributed-db-configjson">configuration</a> of the various clusters in the database.</li>
</ul>
<p>Default configuration in <a href="distributed/Distributed-Configuration.html#orientdb-server-configxml">orientdb-dserver-config.xml</a>:</p>
<pre><code class="language-xml">   &lt;handler class="com.orientechnologies.orient.server.hazelcast.OHazelcastPlugin"&gt;
      &lt;parameters&gt;
         &lt;!-- &lt;parameter name="alias" value="europe1" /&gt; --&gt;
         &lt;parameter name="enabled" value="true" /&gt;
         &lt;parameter name="configuration.db.default" value="${ORIENTDB_HOME}/config/default-distributed-db-config.json" /&gt;
         &lt;parameter name="configuration.hazelcast" value="${ORIENTDB_HOME}/config/hazelcast.xml" /&gt;
      &lt;/parameters&gt;
   &lt;/handler&gt;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="distributed-runtime"><a class="header" href="#distributed-runtime">Distributed runtime</a></h1>
<p><em>NOTE: available only in Enterprise Edition</em></p>
<h2 id="node-status"><a class="header" href="#node-status">Node status</a></h2>
<p>To retrieve the distributed configuration of a OrientDB server, execute a HTTP GET operation against the URL <code>http://&lt;server&gt;:&lt;port&gt;/distributed/node</code>. Example:</p>
<pre><code>curl -u root:root "http://localhost:2480/distributed/node"
</code></pre>
<p>Result:</p>
<pre><code class="language-json">{
    "localId": "9e20f766-5f8c-4a5c-a6a2-7308019db702",
    "localName": "_hzInstance_1_orientdb",
    "members": [
        {
            "databases": [],
            "id": "b7888b58-2b26-4098-bb4d-8e23a5050b68",
            "listeners": [
                {
                    "listen": "10.0.1.8:2425",
                    "protocol": "ONetworkProtocolBinary"
                },
                {
                    "listen": "10.0.1.8:2481",
                    "protocol": "ONetworkProtocolHttpDb"
                }
            ],
            "name": "node2",
            "startedOn": "2015-09-28 13:19:09:267"
        },
        {
            "databases": [],
            "id": "9e20f766-5f8c-4a5c-a6a2-7308019db702",
            "listeners": [
                {
                    "listen": "10.0.1.8:2424",
                    "protocol": "ONetworkProtocolBinary"
                },
                {
                    "listen": "10.0.1.8:2480",
                    "protocol": "ONetworkProtocolHttpDb"
                }
            ],
            "name": "node1",
            "startedOn": "2015-09-28 12:58:11:819"
        }
    ]
}
</code></pre>
<h2 id="database-configuration"><a class="header" href="#database-configuration">Database configuration</a></h2>
<p>To retrieve the distributed configuration for a database, execute a HTTP GET operation against the URL <code>http://&lt;server&gt;:&lt;port&gt;/distributed/database/&lt;database-name&gt;</code>. Example:</p>
<pre><code>curl -u root:root "http://localhost:2480/distributed/database/GratefulDeadConcerts"
</code></pre>
<p>Result:</p>
<pre><code class="language-json">{
    "autoDeploy": true,
    "clusters": {
        "*": {
            "servers": [
                "node1",
                "node2",
                "&lt;NEW_NODE&gt;"
            ]
        },
        "v": {
            "servers": [
                "node2",
                "node1",
                "&lt;NEW_NODE&gt;"
            ]
        }
    },
    "executionMode": "undefined",
    "failureAvailableNodesLessQuorum": false,
    "hotAlignment": false,
    "readQuorum": 1,
    "readYourWrites": true,
    "servers": {
        "*": "master"
    },
    "version": 21,
    "writeQuorum": 2
}
</code></pre>
<h3 id="queues"><a class="header" href="#queues">Queues</a></h3>
<p>OrientDB uses distributed queues to exchange messages between OrientDB servers. To have metrics about queues, execute a HTTP GET operation against the URL <code>http://&lt;server&gt;:&lt;port&gt;/distributed/queue/&lt;queue-name&gt;</code>. Use <code>*</code> as queue name to return stats for all he queues. Example:</p>
<pre><code>curl -u root:root "http://localhost:2480/distributed/queue/*"
</code></pre>
<p>Result:</p>
<pre><code class="language-json">{
    "queues": [
        {
            "avgAge": 0,
            "backupItemCount": 0,
            "emptyPollOperationCount": 0,
            "eventOperationCount": 0,
            "maxAge": 0,
            "minAge": 0,
            "name": "orientdb.node.node1.benchmark.insert.request",
            "nextMessages": [],
            "offerOperationCount": 0,
            "otherOperationsCount": 0,
            "ownedItemCount": 0,
            "partitionKey": "orientdb.node.node1.benchmark.insert.request",
            "pollOperationCount": 0,
            "rejectedOfferOperationCount": 0,
            "serviceName": "hz:impl:queueService",
            "size": 0
        },
        {
            "avgAge": 1,
            "backupItemCount": 0,
            "emptyPollOperationCount": 0,
            "eventOperationCount": 0,
            "maxAge": 1,
            "minAge": 1,
            "name": "orientdb.node.node2.response",
            "nextMessages": [],
            "offerOperationCount": 60,
            "otherOperationsCount": 12,
            "ownedItemCount": 0,
            "partitionKey": "orientdb.node.node2.response",
            "pollOperationCount": 60,
            "rejectedOfferOperationCount": 0,
            "serviceName": "hz:impl:queueService",
            "size": 0
        },
        {
            "avgAge": 0,
            "backupItemCount": 0,
            "emptyPollOperationCount": 0,
            "eventOperationCount": 0,
            "maxAge": 0,
            "minAge": 0,
            "name": "orientdb.node.node2.benchmark.request",
            "nextMessages": [],
            "offerOperationCount": 0,
            "otherOperationsCount": 0,
            "ownedItemCount": 0,
            "partitionKey": "orientdb.node.node2.benchmark.request",
            "pollOperationCount": 0,
            "rejectedOfferOperationCount": 0,
            "serviceName": "hz:impl:queueService",
            "size": 0
        },
        {
            "avgAge": 1,
            "backupItemCount": 0,
            "emptyPollOperationCount": 0,
            "eventOperationCount": 0,
            "maxAge": 1,
            "minAge": 1,
            "name": "orientdb.node.node1.GratefulDeadConcerts.request",
            "nextMessages": [],
            "offerOperationCount": 44,
            "otherOperationsCount": 53,
            "ownedItemCount": 0,
            "partitionKey": "orientdb.node.node1.GratefulDeadConcerts.request",
            "pollOperationCount": 44,
            "rejectedOfferOperationCount": 0,
            "serviceName": "hz:impl:queueService",
            "size": 0
        }
    ]
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="replication"><a class="header" href="#replication">Replication</a></h1>
<p>OrientDB supports the <a href="http://en.wikipedia.org/wiki/Multi-master_replication">Multi Master replication</a>. This means that all the nodes in the cluster are Master and are able to read and write to the database. This allows to scale up horizontally without bottlenecks like most of any other RDBMS and NoSQL solution do.</p>
<p>Replication works only in the <a href="distributed/Distributed-Architecture.html">Distributed-Architecture</a>.</p>
<h2 id="sharing-of-database"><a class="header" href="#sharing-of-database">Sharing of database</a></h2>
<p>In Distributed Architecture the replicated database must have the same name. When an OrientDB Server is starting, it sends the list of current databases (all the databases located under <code>$ORIENTDB_HOME/databases</code> directory) to all the nodes in the cluster. If other nodes have databases with the same name, a replication is automatically set.</p>
<p><img src="http://www.orientdb.org/images/distributed-db-share.png" alt="image" /></p>
<p><em>NOTE: In Distributed Architecture assure to avoid conflict with database names, otherwise 2 different databases could start replication with the chance to get corrupted.</em></p>
<p>If the <a href="distributed/Distributed-Configuration.html#default-distributed-db-configjson">database configuration</a> has the setting <code>"autoDeploy" : true</code>, then the databases are automatically deployed across the network to the other nodes as soon as they join the cluster.</p>
<p><img src="http://www.orientdb.org/images/distributed-db-autodeploy.png" alt="image" /></p>
<h2 id="server-unreachable"><a class="header" href="#server-unreachable">Server unreachable</a></h2>
<p>In case a server becomes unreachable, the node is removed by <a href="distributed/Distributed-Configuration.html#default-distributed-db-configjson">database configuration</a> unless the setting <code>"hotAlignment" : true</code>. In this case all the new synchronization messages are kept in a distributed queue.</p>
<p><img src="http://www.orientdb.org/images/distributed-srv-unreacheable.png" alt="image" /></p>
<p>As soon as the Server becomes online again, it starts the synchronization phase (status=SYNCHRONIZING) by polling all the synchronization messages in the queue.</p>
<p><img src="http://www.orientdb.org/images/distributed-srv-backonline.png" alt="image" /></p>
<p>Once the alignment is finished, the node becomes online (status=ONLINE) and the replication continues like at the beginning.</p>
<p><img src="http://www.orientdb.org/images/distributed-srv-restored.png" alt="image" /></p>
<h2 id="further-readings"><a class="header" href="#further-readings">Further readings</a></h2>
<p>Continue with:</p>
<ul>
<li><a href="distributed/Distributed-Architecture.html">Distributed Architecture</a></li>
<li><a href="distributed/Distributed-Sharding.html">Distributed Sharding</a></li>
<li><a href="distributed/Distributed-Configuration.html">Distributed database configuration</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sharding"><a class="header" href="#sharding">Sharding</a></h1>
<p><em>NOTE: Sharding is a new feature with some <a href="distributed/Distributed-Sharding.html#limitation">limitations</a>. Please read them before using it.</em></p>
<p>OrientDB supports sharding of data at class level by using multiple <a href="distributed/../datamodeling/Concepts.html#cluster">clusters</a> per <a href="distributed/../datamodeling/Concepts.html#class">class</a>. Under this model each cluster keeps a list of servers where data is replicated. From a logical point of view all the records stored in clusters that are part of the same class, are records of that class.</p>
<p>The following is an example that splits the <a href="distributed/../datamodeling/Concepts.html#class">class</a> “Client” in 3 <a href="distributed/../datamodeling/Concepts.html#cluster">clusters</a>:</p>
<p><a href="distributed/../datamodeling/Concepts.html#class">Class</a> <strong>Client</strong> -&gt; <a href="distributed/../datamodeling/Concepts.html#cluster">Clusters</a> [ <code>client_usa</code>, <code>client_europe</code>, <code>client_china</code> ]</p>
<p>This means that OrientDB will consider any record/document/graph element in any of the three <a href="distributed/../datamodeling/Concepts.html#cluster">clusters</a> as “Clients” (Client <a href="distributed/../datamodeling/Concepts.html#class">class</a> relies on such <a href="distributed/../datamodeling/Concepts.html#cluster">clusters</a>). In <a href="distributed/Distributed-Architecture.html">Distributed-Architecture</a> each cluster can be assigned to one or more server nodes.</p>
<p><img src="http://www.orientdb.com/images/distributed-sharding-class.png" alt="image" /></p>
<p>Shards, based on clusters, work against indexed and non-indexed class/clusters.</p>
<h2 id="multiple-servers-per-cluster"><a class="header" href="#multiple-servers-per-cluster">Multiple servers per cluster</a></h2>
<p>You can assign each <a href="distributed/../datamodeling/Concepts.html#cluster">cluster</a> to one or more servers. If more servers are enlisted then records will be copied across all of the servers. This is similar to what <a href="http://en.wikipedia.org/wiki/RAID">RAID</a> does for Disks. The first server in the list will be the <strong>master server</strong> for that cluster.</p>
<p>For example, consider a configuration where the Client <a href="distributed/../datamodeling/Concepts.html#class">class</a> has been split in the 3 <a href="distributed/../datamodeling/Concepts.html#cluster">clusters</a> client_usa, client_europe and client_china. Each cluster might have a different configuration:</p>
<ul>
<li><code>client_usa</code>, will be managed by the ”usa" and "europe" nodes</li>
<li><code>client_europe</code>, will be managed only by the node, ”europe"</li>
<li><code>client_china</code>, will be managed by all of the nodes (it would be equivalent as writing <code>“&lt;NEW_NODE&gt;”</code>, see cluster "*", the default one)</li>
</ul>
<p><img src="http://www.orientdb.com/images/distributed-sharding-replica-class.png" alt="image" /></p>
<h2 id="configuration-9"><a class="header" href="#configuration-9">Configuration</a></h2>
<p>In order to keep things simple, the entire OrientDB Distributed Configuration is stored on a single JSON file. The <a href="distributed/Distributed-Configuration.html#default-distributed-db-configjson">distributed database configuration</a> for <a href="distributed/Distributed-Sharding.html#multiple-servers-per-cluster">Multiple servers per cluster</a> JSON object looks somethings like this:</p>
<pre><code class="language-json">{
  "autoDeploy": true,
  "readQuorum": 1,
  "writeQuorum": "majority",
  "executionMode": "undefined",
  "readYourWrites": true,
  "newNodeStrategy": "dynamic",
  "servers": {
    "*": "master"
  },
  "clusters": {
    "internal": {
    },
    "client_usa": {
      "servers" : [ "usa", "europe" ]
    },
    "client_europe": {
      "servers" : [ "europe" ]
    },
    "client_china": {
      "servers" : [ "china", "usa", "europe" ]
    },
    "*": {
      "servers" : [ "&lt;NEW_NODE&gt;" ]
    }
  }
}
</code></pre>
<h2 id="cluster-locality"><a class="header" href="#cluster-locality">Cluster Locality</a></h2>
<p>OrientDB automatically creates a new <a href="distributed/../datamodeling/Concepts.html#cluster">cluster</a> per each class as soon a new insert operation is performed on a class where the local server has no ownership. When a node goes down, the <a href="distributed/../datamodeling/Concepts.html#cluster">clusters</a> where the node was master are reassigned to other servers. As soon as that node returns up and running, OrientDB will reassign the ownership of a cluster to the server specified in the <code>owner</code> property if specified, otherwise to the server name indicated as suffix of the cluster (<code>&lt;class&gt;_&lt;node&gt;</code>). For example the cluster <code>customer_usa</code> will be assigned automatically to the server <code>usa</code> if exists in the cluster.</p>
<p>This is defined as "Cluster Locality". The local node is always selected when a new record is created. This avoids conflicts and allows for the insert of records in parallel on multiple nodes. This also means that in distributed mode you can't select the <a href="distributed/../misc/Cluster-Selection.html">cluster selection strategy</a>, because "local" strategy is always injected to all the cluster automatically.</p>
<p>If you want to permanently change the mastership of a <a href="distributed/../datamodeling/Concepts.html#cluster">cluster</a>, rename the cluster by changing it’s suffix to that of the node you want assign as master.</p>
<h2 id="crud-operations"><a class="header" href="#crud-operations">CRUD Operations</a></h2>
<h3 id="create-new-records"><a class="header" href="#create-new-records">Create new records</a></h3>
<p>In the configuration above, if a new Client record is created on node USA, then the selected cluster will be <code>client_usa</code>, because it's the local cluster for class Client. Now, <code>client_usa</code> is managed by both USA and EUROPE nodes, so the "create record" operation is sent to both "usa" (locally) and "europe" nodes.</p>
<h3 id="update-and-delete-of-records"><a class="header" href="#update-and-delete-of-records">Update and Delete of records</a></h3>
<p>Updating and Deleting of single records always involves all the nodes where the record is stored. No matter the node that receives the update operation. If we update record <code>#13:22</code> that is stored on cluster <code>13</code>, namely <code>client_china</code> in the example above, then the update is sent to nodes: "china", "usa", "europe".</p>
<p>Instead, SQL UPDATE and DELETE commands cannot run distributed in case of sharding. For example, the SQL command <code>delete from vertex Client</code> works if the <code>Client</code> class is replicated across all the servers, but it won't work if the class is sharded by throwing a <code>ODistributedOperationException</code> exception with the following reason: "because it is not idempotent and a map-reduce has been requested".</p>
<p>If you want to execute a distributed update or delete, you can still execute a distributed SQL SELECT against all the shards, and then update or delete every single records in your code. Example to delete all the clients, no matter where they are located:</p>
<pre><code class="language-java">Iterable&lt;OrientVertex&gt; res = g.command(new OCommandSQL("select from Client")).execute();
for (OrientVertex v : res) {
  v.remove();
}
</code></pre>
<p><em>NOTE: if something happens during the iteration of the resultset, you could end up with only a few records deleted.</em></p>
<h3 id="read-of-records"><a class="header" href="#read-of-records">Read of records</a></h3>
<p>If the local node has the requested record, then the record is read directly from local storage. If it's not present on the local server, a forward is executed to any of the nodes that have the requested record. This means a network call is made between nodes.</p>
<p>In the case of queries, OrientDB checks for servers where the query targets are located and sends the query to all the involved servers. This operation is equivalent to a <a href="distributed/Distributed-Sharding.html#mapreduce">Map-Reduce</a>. If the query target is 100% managed on local node, the query is simply executed on local node without paying the cost of network call.</p>
<p>All queries work by aggregating the result sets from all the involved nodes.</p>
<p>Example of executing this query on node "usa":</p>
<pre><code class="language-sql">SELECT FROM Client
</code></pre>
<p>Since local node (USA) already owns <code>client_usa</code> and <code>client_china</code>, 2/3 of data are local. The missing 1/3 of data is in <code>client_europe</code> that is managed only by node "Europe". "So the query will be executed on local node "usa" and remote node “Europe”. The client will be provided the aggregated result back.”</p>
<p>You can query also a particular cluster:</p>
<pre><code class="language-sql">SELECT FROM CLUSTER:client_china
</code></pre>
<p>In this case the local node (USA) is used, because <code>client_china</code> is hosted on local node.</p>
<h2 id="mapreduce"><a class="header" href="#mapreduce">MapReduce</a></h2>
<p>OrientDB supports <a href="http://en.wikipedia.org/wiki/MapReduce">MapReduce</a> without Hadoop or an external framework like Spark (even if there is a connector), but rather by using the OrientDB <a href="distributed/../sql/README.html">SQL</a>. The MapReduce operation is totally transparent to the developer. When a query involves multiple shards (clusters), OrientDB executes the query against all the involved server nodes (Map operation) and then merges the results (Reduce operation). Example:</p>
<pre><code class="language-sql">SELECT MAX(amount), COUNT(*), SUM(amount) FROM Client
</code></pre>
<p><img src="http://www.orientdb.com/images/distributed-query-map.png" alt="image" /></p>
<p>In this case the query is executed across all the 3 nodes and then filtered again on the starting node.</p>
<p><img src="http://www.orientdb.com/images/distributed-query-reduce.png" alt="image" /></p>
<h2 id="define-the-target-clustershard"><a class="header" href="#define-the-target-clustershard">Define the target cluster/shard</a></h2>
<p>The application can decide where to insert a new Client by passing the cluster number or name. Example:</p>
<pre><code class="language-sql">INSERT INTO CLUSTER:client_usa SET @class = 'Client', name = 'Jay'
</code></pre>
<p>If the node that executes this command is not the master of cluster <code>client_usa</code>, an exception is thrown.</p>
<h3 id="java-graph-api"><a class="header" href="#java-graph-api">Java Graph API</a></h3>
<pre><code class="language-java">OrientVertex v = graph.addVertex("class:Client,cluster:client_usa");
v.setProperty("name", "Jay");
</code></pre>
<p>### Java Document API</p>
<pre><code class="language-java">ODocument doc = new ODocument("Client");
doc.field("name", "Jay");
doc.save( "client_usa" );
</code></pre>
<h2 id="sharding-and-split-brain-network-problem"><a class="header" href="#sharding-and-split-brain-network-problem">Sharding and Split brain network problem</a></h2>
<p>OrientDB guarantees strong consistency if it's configured to have a <code>writeQuorum</code> to the majority of the nodes. For more information look at <a href="distributed/Distributed-Architecture.html#split-brain-network-problem">Split Brain network problem</a>. In the case of Sharding you could have a situation where you'd need a relative <code>writeQuorum</code> to a certain partition of your data. While <code>writeQuorum</code> setting can be configured at database and cluster level too, it's not suggested to set a value less than the majority, because in case of re-merge of the two split networks, you'd have both network partitions with updated data and OrientDB doesn't support (yet) the merging of two non read-only networks. So the suggestion is to always provide a <code>writeQuorum</code> at least at the majority of nodes, even with sharded configuration.</p>
<h3 id="limitation"><a class="header" href="#limitation">Limitation</a></h3>
<ol>
<li><em>Auto-Sharding</em> is not supported in the common meaning of Distributed Hash Table (DHT). Selecting the right shard (cluster) is up to the application. This will be addressed by next releases</li>
<li>Sharded Indexes are not supported.</li>
<li>If <code>hotAlignment=false</code> is set, when a node re-joins the cluster (after a failure or simply unreachability) the full copy of database from a node could have no all information about the shards.</li>
<li>Hot change of distributed configuration not available. This will be introduced at release 2.0 via command line and in visual way in the Workbench of the Enterprise Edition (commercial licensed)</li>
<li>Not complete merging of results for all the projections. Some functions like AVG() doesn’t work on map/reduce</li>
<li>Backup doesn't work on distributed nodes yet, so doing a backup of all the nodes to get all the shards is a manual operation in charge to the user</li>
</ol>
<h2 id="indexes-3"><a class="header" href="#indexes-3">Indexes</a></h2>
<p>All the indexes are managed locally by a server. This means that if a class is spanned across three clusters on three different servers, each server will have it’s own local indexes. By executing a <a href="distributed/Distributed-Sharding.html#mapreduce">distributed query (Map/Reduce like)</a> each server will use own indexes.</p>
<h2 id="hot-management-of-distributed-configuration"><a class="header" href="#hot-management-of-distributed-configuration">Hot management of distributed configuration</a></h2>
<p>With Community Edition the distributed configuration cannot be changed at run-time but you have to stop and restart all the nodes. <a href="http://www.orientechnologies.com/orientdb-enterprise">Enterprise Edition</a> allows to create and drop new shards without stopping the distributed cluster.</p>
<p>By using Enterprise Edition and the <a href="http://www.orientechnologies.com/enterprise/last/clustermgmt.html">Workbench</a>, you can deploy the database to the new server and define the cluster to assign to it. In this example a new server "usa2" is created where only the cluster <code>client_usa</code> will be copied. After the deployment, cluster <code>client_usa</code> will be replicated against nodes "usa" and "usa2".</p>
<p><img src="http://www.orientdb.com/images/distributed-sharding-addserver.png" alt="image" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="data-centers"><a class="header" href="#data-centers">Data Centers</a></h1>
<p>Starting from <a href="http://orientdb.com/orientdb-enterprise">OrientDB Enterprise Edition</a> v2.2.4, you can define how your servers are deployed in multiple <strong>Data Centers</strong>.</p>
<p><img src="distributed/../images/studio-data-centers.png" alt="Studio-Data-Centers" /></p>
<p>All you need is using the tag <code>"dataCenters"</code> in your <a href="distributed/Distributed-Configuration.html#default-distributed-db-configjson"><code>default-distributed-config.json</code></a> configuration file. This is the format:</p>
<pre><code class="language-json">  "dataCenters": {
    "&lt;data-center1-name&gt;": {
      "writeQuorum": "&lt;data-center1-quorum&gt;",
      "servers": [ "&lt;data-center1-server1&gt;", "&lt;data-center1-server2&gt;", "&lt;data-center1-serverN&gt;" ]
    },
    "&lt;data-center2-name&gt;": {
      "writeQuorum": "&lt;data-center2-quorum&gt;",
      "servers": [ "&lt;data-center2-server1&gt;", "&lt;data-center2-server2&gt;", "&lt;data-center2-serverN&gt;" ]
    },
  },
</code></pre>
<p>NOTE: <em>This feature is available only in the <a href="http://orientdb.com/orientdb-enterprise">OrientDB Enterprise Edition</a>. If you are interested in a commercial license look at <a href="http://orientdb.dev/support">OrientDB Subscription Packages</a></em>.</p>
<p>Example:</p>
<pre><code class="language-json">  "dataCenters": {
    "usa": {
      "writeQuorum": "majority",
      "servers": [ "&lt;austin&gt;", "&lt;paloalto&gt;", "&lt;newyork&gt;" ]
    },
    "europe": {
      "writeQuorum": "majority",
      "servers": [ "&lt;rome&gt;", "&lt;dublin&gt;", "&lt;london&gt;" ]
    },
    "asia": {
      "writeQuorum": "majority",
      "servers": [ "&lt;tokio&gt;", "&lt;singapore&gt;", "&lt;hongkong&gt;" ]
    }
  },
</code></pre>
<p><img src="http://orientdb.com/wp-content/uploads/2016/07/orientdb-dc1.png" alt="DC" /></p>
<h2 id="write-quorum"><a class="header" href="#write-quorum">Write Quorum</a></h2>
<p>The most common reason why defining data centers is a good idea is the possibility of defining the consistency at data center level. A typical scenario is having a synchronous replication between the servers in the same data center where the coordinator server is located and then propagate changes to the other data centers in asynchronous way. In this way you can avoid the cost of the latency of the replication to the servers located on different data centers. In order to activate this mode, set the global <code>"writeQuorum": "localDataCenter"</code> and then specify a writeQuorum per data center.</p>
<p>For example, if a write operation is executed by a server where its data center's write quorum setting is <code>majority</code>, then the used quorum will be <code>majority</code> between only the servers located in the same data center.</p>
<p>Example about the configuration of 2 data centers, "rome" and "austin", with respectively 3 and 2 servers.</p>
<pre><code class="language-json">{
  "autoDeploy": true,
  "readQuorum": 1,
  "writeQuorum": "localDataCenter",
  "readYourWrites": true,
  "dataCenters": {
    "rome": {
      "writeQuorum": "majority",
      "servers": [ "europe-0", "europe-1", "europe-2" ]
    },
    "austin": {
      "writeQuorum": "majority",
      "servers": [ "usa-0", "usa-1" ]
    }
  },
  "servers": { "*": "master" },
  "clusters": {
    "internal": {},
    "*": { "servers": [ "&lt;NEW_NODE&gt;" ] }
  }
}
</code></pre>
<p>If a write operation is executed on the server "europe-0", the quorum used will be <code>majority</code>, but only between the servers locates in the same data center: namely "europe-0" (the coordinator), "europe-1" and "europe-2". Since the coordinator writes in the database before to distribute the operation, the write operation succeed as soon as at least one between the "europe-1" and "europe-2" servers provide the same result as with "europe-0". The rest of the replication will be executed in background in asynchronous way.</p>
<h2 id="consistency-1"><a class="header" href="#consistency-1">Consistency</a></h2>
<p>Since multiple data centers can have a local quorum, it is possible having an <strong>Eventual Consistency</strong> between them. It's always suggested to keep the number of servers odd, so you can, eventually, always be consistent. Example of 2 data centers with equal number of servers:</p>
<pre><code class="language-json">  "dataCenters": {
    "rome": {
      "writeQuorum": "all",
      "servers": [ "europe-0", "europe-1", "europe-2" ]
    },
    "austin": {
      "writeQuorum": "all",
      "servers": [ "usa-0", "usa-1", "usa-2" ]
    }
</code></pre>
<p>In this case if an UPDATE operation is executed by the server "usa-0" (the coordinator), it will reach the quorum only if <code>all</code> the servers in the "austin" data center provide the same result. Let's say the result for all these 2 servers was <code>5</code> (in the UPDATE operation the result is the updated version of the record). But what happens if all the other 3 servers in "rome" return the version <code>6</code>? You have no majority in this case (3 against 3), so the coordinator cannot establish who is the winner. The database become inconsistent.</p>
<p>In order to automatically manage conflicts, the suggested configuration is always to keep an <strong>odd number</strong> of servers if you have or not data centers.</p>
<h2 id="conflict-resolution-policy-1"><a class="header" href="#conflict-resolution-policy-1">Conflict Resolution Policy</a></h2>
<p>In <a href="http://orientdb.com/orientdb-enterprise">OrientDB Enterprise Edition</a> the additional <code>dc</code> <a href="distributed/Distributed-Architecture.html#conflict-resolution-policy">Conflict Resolution Strategy</a> is supported to let to a configured data center to always win in case of conflict. To use this strategy in the conflict resolution chain, append <code>dc</code> at the chain by overwriting the global setting <code>distributed.conflictResolverRepairerChain</code>. Example:</p>
<p><code>-Ddistributed.conflictResolverRepairerChain=majority,content,version,dc{winner:asia}</code></p>
<p>Note the configuration passed in curly brackets <code>{winner:asia}</code> containing the name of the data center that will be the winner in case no winner has been found in the chain.</p>
<h2 id="client-reconnection"><a class="header" href="#client-reconnection">Client Reconnection</a></h2>
<p>Starting from OrientDB v2.2.25, when a client has lost its connection to the server, it's able to transparently reconnect to another server in the same Data Center of the server where it was connected. If no other server is available for the same Data Center, then it will try to reconnect to a server in another Data Center and, one by one, will try until one server is reachable. If no servers are reachable, then a connection error is thrown. You can change this strategy by forcing the reconnection to be only against the same Data Center. In this case, if no servers are available in the same Data Center, a connection error is thrown. This is the setting:</p>
<pre><code>-Dnetwork.retry.strategy=same-dc
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="troubleshooting-3"><a class="header" href="#troubleshooting-3">Troubleshooting</a></h1>
<p>This page aims to link all the guides to Problems and Troubleshooting.</p>
<h2 id="sub-sections"><a class="header" href="#sub-sections">Sub sections</a></h2>
<ul>
<li><a href="misc/Troubleshooting-Java.html">Troubleshooting Java API</a></li>
</ul>
<h2 id="topics"><a class="header" href="#topics">Topics</a></h2>
<h4 id="best-practice-to-map-the-rid-in-rest-full-friendly-id-representation"><a class="header" href="#best-practice-to-map-the-rid-in-rest-full-friendly-id-representation">Best practice to map the <a href="misc/../datamodeling/Concepts.html#record-id">RID</a> in REST Full friendly ID representation</a></h4>
<p>Take a look at <a href="http://hashids.org/">HashID</a>. HashID should get you a hashed Rid, which is also convertible, so it won't take up more storage space (like with a UUID). It will just take a small bit of CPU time.</p>
<p>Please note, this little tool is not in any way a true hash, as in, it makes it very hard to crack the hash. It is more about good obfuscation. If you are at all worried about the Rids being known, this isn't a proper solution.</p>
<h4 id="why-cant-i-see-all-the-edges"><a class="header" href="#why-cant-i-see-all-the-edges">Why can't I see all the edges?</a></h4>
<p>OrientDB, by default, manages edges as "lightweight" edges if they have no properties. This means that if an edge has no properties, it's not stored as physical record. But don't worry, your edge is still there but encoded in a separate data structure. For this reason if you execute a <code>select from E</code>no edges or less edges than expected are returned. It's extremely rare the need to have the list of edges, but if this is your case you can disable this feature by issuing this command once (with a slow down and a bigger database size):</p>
<pre><code class="language-sql">ALTER DATABASE custom useLightweightEdges=false
</code></pre>
<h4 id="use-iso-8601-dates-1"><a class="header" href="#use-iso-8601-dates-1">Use ISO 8601 Dates</a></h4>
<p>According to ISO 8601, Combined date and time in UTC: 2014-12-20T00:00:00. To use this standard change the datetimeformat in the database:</p>
<pre><code class="language-sql">ALTER DATABASE DATETIMEFORMAT yyyy-MM-dd'T'HH:mm:ss.SSS'Z'
</code></pre>
<h4 id="jvm-crash-on-solaris-and-other-nix-platforms"><a class="header" href="#jvm-crash-on-solaris-and-other-nix-platforms">JVM crash on Solaris and other *NIX platforms.</a></h4>
<p>The reason of this issue is massive usage of sun.misc.Unsafe which may have different contract than it is
implemented for Linux and Windows JDKs. To avoid this error please use following settings during server start:</p>
<pre><code>java ... -Dmemory.useUnsafe=false and -Dstorage.compressionMethod=gzip ...
</code></pre>
<h4 id="error-occurred-while-locking-memory-unable-to-lock-jvm-memory-this-can-result-in-part-of-the-jvm-being-swapped-out-especially-if-mmapping-of-files-enabled-increase-rlimit_memlock-or-run-orientdb-server-as-rootenomem"><a class="header" href="#error-occurred-while-locking-memory-unable-to-lock-jvm-memory-this-can-result-in-part-of-the-jvm-being-swapped-out-especially-if-mmapping-of-files-enabled-increase-rlimit_memlock-or-run-orientdb-server-as-rootenomem">Error occurred while locking memory: Unable to lock JVM memory. This can result in part of the JVM being swapped out, especially if mmapping of files enabled. Increase RLIMIT_MEMLOCK or run OrientDB server as root(ENOMEM)</a></h4>
<p>Don't be scared about it: your OrientDB installation will work perfectly, just it could be slower with database larger than memory.</p>
<p>This lock is needed in case of you work on OS which uses aggressive swapping like Linux. If there is the case when amount of available RAM is not enough to cache all MMAP content OS can swap out rarely used parts of Java heap to the disk and when GC is started to collect garbage we will have performance degradation, to prevent such situation Java heap is locked into memory and prohibited to be flushed on the disk.</p>
<h4 id="comorientechnologiesorientcoreexceptionostorageexception-error-on-reading-record-from-file-default0oda-position-2333-size-12214mb-the-record-size-is-bigger-then-the-file-itself-23399kb"><a class="header" href="#comorientechnologiesorientcoreexceptionostorageexception-error-on-reading-record-from-file-default0oda-position-2333-size-12214mb-the-record-size-is-bigger-then-the-file-itself-23399kb">com.orientechnologies.orient.core.exception.OStorageException: Error on reading record from file 'default.0.oda', position 2333, size 122,14Mb: the record size is bigger then the file itself (233,99Kb)</a></h4>
<p>This usually happens because the database has been corrupted by a hw/sw crash or a hard kill of the process during the writing to disk. If this happens on index clusters just rebuild indexes, otherwise re-import a previously exported database.</p>
<h4 id="class-ouser-or-orole-was-not-found-in-current-database"><a class="header" href="#class-ouser-or-orole-was-not-found-in-current-database">Class 'OUSER' or 'OROLE' was not found in current database</a></h4>
<p>Look at: <a href="misc/../security/Server-Security.html#restoring-the-user-admin">Restore admin user</a>.</p>
<h4 id="user-admin-was-not-found-in-current-database"><a class="header" href="#user-admin-was-not-found-in-current-database">User 'admin' was not found in current database</a></h4>
<p>Look at: <a href="misc/../security/Server-Security.html#restoring-the-user-admin">Restore admin user</a>.</p>
<h4 id="warning-connection-re-acquired-transparently-after-xxxms-and-y-retries-no-errors-will-be-thrown-at-application-level"><a class="header" href="#warning-connection-re-acquired-transparently-after-xxxms-and-y-retries-no-errors-will-be-thrown-at-application-level">WARNING: Connection re-acquired transparently after XXXms and Y retries: no errors will be thrown at application level</a></h4>
<p>This means that probably default timeouts are too low and server side operation need more time to complete. Follow these  <a href="misc/../tuning/Performance-Tuning.html">Performance Tuning</a>.</p>
<h4 id="record-id-invalid--1-2"><a class="header" href="#record-id-invalid--1-2">Record id invalid -1:-2</a></h4>
<p>This message is relative to a temporary record id generated inside a transaction. For more information look at <a href="misc/../internals/Transactions.html">Transactions</a>. This means that the record hasn't been correctly serialized.</p>
<h4 id="brand-new-records-are-created-with-version-greater-than-0"><a class="header" href="#brand-new-records-are-created-with-version-greater-than-0">Brand new records are created with version greater than 0</a></h4>
<p>This happens in graphs. Think to this graph of records:</p>
<p>A -&gt; B -&gt; C -&gt; A</p>
<p>When OrientDB starts to serialize records goes recursively from the root A. When A is encountered again to avoid loops it saves the record as empty just to get the RecordID to store into the record C. When the serialization stack ends the record A (that was the first of the stack) is updated because has been created as first but empty.</p>
<h4 id="error-comorientechnologiesorientcoreexceptionostorageexception-cannot-open-local-storage-tmpdatabasesdemo-with-moderw"><a class="header" href="#error-comorientechnologiesorientcoreexceptionostorageexception-cannot-open-local-storage-tmpdatabasesdemo-with-moderw">Error: com.orientechnologies.orient.core.exception.OStorageException: Cannot open local storage '/tmp/databases/demo' with mode=rw</a></h4>
<h4 id="comorientechnologiescommonconcurlockolockexception-file-tmpdatabasesdemodefault0oda-is-locked-by-another-process-maybe-the-database-is-in-use-by-another-process-use-the-remote-mode-with-a-orientdb-server-to-allow-multiple-access-to-the-same-database"><a class="header" href="#comorientechnologiescommonconcurlockolockexception-file-tmpdatabasesdemodefault0oda-is-locked-by-another-process-maybe-the-database-is-in-use-by-another-process-use-the-remote-mode-with-a-orientdb-server-to-allow-multiple-access-to-the-same-database">com.orientechnologies.common.concur.lock.OLockException: File '/tmp/databases/demo/default.0.oda' is locked by another process, maybe the database is in use by another process. Use the remote mode with a OrientDB server to allow multiple access to the same database</a></h4>
<p>Both errors have the same meaning: a "plocal" database can't be opened by multiple JVM at the same time. To fix:</p>
<ul>
<li>check if there's no process using OrientDB (most of the times a OrientDB Server is running i the background). Just shutdown that server and retry</li>
<li>if you need multiple access to the same database, don't use "plocal" directly, but rather start a server and access to the database by using "remote" protocol. In this way the server is able to share the same database with multiple clients.</li>
</ul>
<h4 id="caused-by-javalangnumberformatexception-for-input-string-500mb"><a class="header" href="#caused-by-javalangnumberformatexception-for-input-string-500mb">Caused by: java.lang.NumberFormatException: For input string: "500Mb"</a></h4>
<p>You're using different version of libraries. For example the client is using 1.3 and the server 1.4. Align the libraries to the same version (last is suggested). Or probably you've different versions of the same jars in the classpath.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="troubleshooting-using-java-api"><a class="header" href="#troubleshooting-using-java-api">Troubleshooting using Java API</a></h1>
<h2 id="oconcurrentmodificationexception-cannot-update-record-xy-in-storage-z-because-the-version-is-not-the-latest-probably-you-are-updating-an-old-record-or-it-has-been-modified-by-another-user-dbva-yourvb"><a class="header" href="#oconcurrentmodificationexception-cannot-update-record-xy-in-storage-z-because-the-version-is-not-the-latest-probably-you-are-updating-an-old-record-or-it-has-been-modified-by-another-user-dbva-yourvb">OConcurrentModificationException: Cannot update record #X:Y in storage 'Z' because the version is not the latest. Probably you are updating an old record or it has been modified by another user (db=vA your=vB)</a></h2>
<p>This exception happens because you're running in a Multi Version Control Check (MVCC) system and another thread/user has updated the record you're saving. For more information about this topic look at <a href="misc/../general/Concurrency.html">Concurrency</a>. To fix this problem you can:</p>
<ul>
<li>Change the Graph <a href="misc/../java/Graph-Consistency.html">consistency level</a> to don't use transactions.</li>
<li>Or write code concurrency proof.</li>
</ul>
<p>Example:</p>
<pre><code class="language-java">for (int retry = 0; retry &lt; maxRetries; ++retry) {
  try {
    // APPLY CHANGES
    document.field(name, "Luca");

    document.save();
    break;
  } catch(ONeedRetryException e) {
    // RELOAD IT TO GET LAST VERSION
    document.reload();
  }
}
</code></pre>
<p>The same in transactions:</p>
<pre><code class="language-java">for (int retry = 0; retry &lt; maxRetries; ++retry) {
  db.begin();
  try {
    // CREATE A NEW ITEM
    ODocument invoiceItem = new ODocument("InvoiceItem");
    invoiceItem.field(price, 213231);
    invoiceItem.save();

    // ADD IT TO THE INVOICE
    Collection&lt;ODocument&gt; items = invoice.field(items);
    items.add(invoiceItem);
    invoice.save();

    db.commit();
    break;
  } catch (OTransactionException e) {
    // RELOAD IT TO GET LAST VERSION
    invoice.reload();
  }
}
</code></pre>
<p>Where <code>maxRetries</code> is the maximum number of attempt of reloading.</p>
<h2 id="run-in-osgi-context"><a class="header" href="#run-in-osgi-context">Run in OSGi context</a></h2>
<p>(by Raman Gupta)
OrientDB uses <a href="http://docs.oracle.com/javase/7/docs/api/javax/imageio/spi/ServiceRegistry.html">ServiceRegistry</a> to load OIndexFactory and some OSGi containers might not work with it.</p>
<p>One solution is to set the TCCL so that the <a href="http://docs.oracle.com/javase/7/docs/api/javax/imageio/spi/ServiceRegistry.html">ServiceRegistry</a> lookup works inside of OSGi:</p>
<pre><code class="language-java">ODatabaseObjectTx db = null;
ClassLoader origClassLoader = Thread.currentThread().getContextClassLoader();
try {
  ClassLoader orientClassLoader = OIndexes.class.getClassLoader();
  Thread.currentThread().setContextClassLoader(orientClassLoader);
  db = objectConnectionPool.acquire(dbUrl, username, password);
} finally {
  Thread.currentThread().setContextClassLoader(origClassLoader);
}
</code></pre>
<p>Because the <a href="http://docs.oracle.com/javase/6/docs/api/java/util/ServiceLoader.html">ServiceLoader</a> uses the thread context classloader, you can configure it to use the classloader of the OrientDB bundle so that it finds the entries in META-INF/services.</p>
<p>Another way is to embed the dependencies in configuration in the Maven pom.xml file under plugin(maven-bundle-plugin)/configuration/instructions:</p>
<pre><code class="language-xml">&lt;Embed-Dependency&gt;
  orientdb-client,
  orient-commons,
  orientdb-core,
  orientdb-enterprise,
  orientdb-object,
  javassist
&lt;/Embed-Dependency&gt;
</code></pre>
<p>Including only the jars you need. Look at <a href="misc/../java/Java-API.html">Supported Libraries</a></p>
<h2 id="database-instance-has-been-released-to-the-pool-get-another-database-instance-from-the-pool-with-the-right-username-and-password"><a class="header" href="#database-instance-has-been-released-to-the-pool-get-another-database-instance-from-the-pool-with-the-right-username-and-password">Database instance has been released to the pool. Get another database instance from the pool with the right username and password</a></h2>
<p>This is a generic error telling that the database has been found closed while using it.</p>
<p>Check the stack trace to find the reason of it:</p>
<h2 id="olazyobjectiterator"><a class="header" href="#olazyobjectiterator">OLazyObjectIterator</a></h2>
<p>This is the case when you're working with <a href="misc/../java/Object-Database.html">Object Database API</a> and a field contains a collection or a map loaded in lazy. On iteration it needs an open database to fetch linked records.</p>
<p>Solutions:</p>
<ul>
<li>assure to leave the database open while browsing the field</li>
<li>or early load all the instances (just iterate the items)</li>
<li>define a fetch-plan to load the entire object tree in one shoot and then work offline. If you need to save the object back to the database then reopen the database and call <code>db.save( object )</code>.</li>
</ul>
<h2 id="stack-overflow-on-saving-objects"><a class="header" href="#stack-overflow-on-saving-objects">Stack Overflow on saving objects</a></h2>
<p>This could be due to the high deep of the graph, usually when you create many records. To fix it save the records more often.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="memory-leak-detector"><a class="header" href="#memory-leak-detector">Memory Leak Detector</a></h1>
<p>OrientDB uses off-heap memory pool for its file cache allocations. Leaks of such allocations can't be tracked using standard Java techniques like heap dumps, to overcome this problem we developed a specialized leak detector. For sure, OrientDB is designed to avoid any kind of leaks, but sometimes bad things happen.</p>
<blockquote>
<p>Use the leak detector for debugging and troubleshooting purposes only, since it significantly slowdowns OrientDB off-heap memory management infrastructure. Never leave the leak detector turned on in a production setup.</p>
</blockquote>
<h2 id="activating-leak-detector"><a class="header" href="#activating-leak-detector">Activating Leak Detector</a></h2>
<p>To activate the leak detection provide the <code>memory.directMemory.trackMode=true</code> configuration option to the OrientDB instance in question. For example, you may provide following command line argument to the JVM:</p>
<pre><code>java ... -Dmemory.directMemory.trackMode=true ...
</code></pre>
<p>Leak detector may be turned on or off at startup time only, at runtime changing the <code>memory.directMemory.trackMode</code> setting will have no effect.</p>
<h4 id="activating-debugging-logger"><a class="header" href="#activating-debugging-logger">Activating Debugging Logger</a></h4>
<p>Leak detector uses logging facilities to report detected problems. To be sure you see all produced log entries activate the OrientDB debugging logger. Provide following command line argument to the JVM to activate it:</p>
<pre><code>-Djava.util.logging.manager=com.orientechnologies.common.log.OLogManager$DebugLogManager
</code></pre>
<blockquote>
<p>Make sure <code>$DebugLogManager</code> part is not interpreted as a shell variable substitution. To avoid the substitution apply escaping specific to your shell environment.
Read more about debugging logger <a href="troubleshooting/../admin/Logging.html#debugging-logger">here</a>.</p>
</blockquote>
<h2 id="inspecting-for-leaks"><a class="header" href="#inspecting-for-leaks">Inspecting for Leaks</a></h2>
<p>After activation of both the leak detector and the debugging logger, information about found problems will be written to the log. Related log entries are marked with the <code>DIRECT-TRACK</code> label. Leak detector is able to detect following problems:</p>
<ol>
<li>Attempt to release an off-heap memory buffer more than once. Reported instantly.</li>
<li>Presence of suspicious memory buffers released due to the JVM object finalization procedure. Reported during OrientDB lifetime, but not instantly.</li>
<li>Presence of unreleased/leaked memory buffers. Reported at OrientDB runtime shutdown.</li>
</ol>
<h2 id="summary-1"><a class="header" href="#summary-1">Summary</a></h2>
<p>The leak detection procedure looks as follows:</p>
<ol>
<li>Shutdown the OrientDB instance in question, if it's running.</li>
<li>Activate the leak detector and the debugging logger as described above.</li>
<li>Start the OrientDB instance.</li>
<li>Start a workload cycle specific to your application.</li>
<li>Monitor for leaks using the log.</li>
<li>Wait for the workload cycle to finish.</li>
<li>Stop the OrientDB instance.</li>
<li>Inspect the OrientDB log for leaks detected at shutdown.</li>
</ol>
<h2 id="see-also-3"><a class="header" href="#see-also-3">See Also</a></h2>
<p><a href="troubleshooting/Direct-Memory-Tracing.html">Direct Memory Allocations Tracing</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="direct-memory-allocations-tracing"><a class="header" href="#direct-memory-allocations-tracing">Direct Memory Allocations Tracing</a></h1>
<p>OrientDB uses off-heap memory pool for its file cache allocations. Direct memory allocations tracing allows to trace allocations done by this pool.</p>
<blockquote>
<p>Use direct memory allocations tracing for debugging and troubleshooting purposes only, since it significantly slowdowns OrientDB off-heap memory management infrastructure. Never leave the tracer turned on in a production setup.</p>
</blockquote>
<h2 id="activating-allocations-tracing"><a class="header" href="#activating-allocations-tracing">Activating Allocations Tracing</a></h2>
<p>To activate allocations tracing provide the <code>memory.directMemory.trace=true</code> configuration option to the OrientDB instance in question. For example, you may provide following command line argument to the JVM:</p>
<pre><code>java ... -Dmemory.directMemory.trace=true ...
</code></pre>
<p>Alternatively, you may enable/disable the tracer at runtime by changing the value of <code>OGlobalConfiguration#DIRECT_MEMORY_TRACE</code> setting or by invoking <code>startTracing</code>/'stopTracing' operation on the <code>com.orientechnologies.common.directmemory:type=OByteBufferPoolMXBean</code> JMX bean.</p>
<h2 id="inspecting-the-log"><a class="header" href="#inspecting-the-log">Inspecting the Log</a></h2>
<p>After activation of the tracing, information about relevant events will be written to <a href="troubleshooting/../admin/Logging.html">regular OrientDB log</a>. Related log entries are marked with the <code>DIRECT-TRACE</code> label. General format of the log entry looks like:</p>
<pre><code>DIRECT-TRACE $event: $name = $before + $delta = $after, buffer = $buffer_id
</code></pre>
<ul>
<li><code>$event</code> – the event type.</li>
<li><code>$name</code> – the name of the value being changed.</li>
<li><code>$before</code> – the value before the event.</li>
<li><code>$delta</code> – the delta of the value.</li>
<li><code>$after</code> – the value after the event.</li>
<li><code>$buffer_id</code> – the identifier of the buffer related to the event, if any.</li>
</ul>
<p>Tracer is able to report following event types:</p>
<ul>
<li><code>AcquiredFromPool</code> – the buffer is acquired/reused from the pool; change in the pool size is reported.</li>
<li><code>OverflowBufferAllocated</code> – the overflow buffer allocated; changes in the overflow buffer count and in the total allocated memory are reported. Usually, overflow allocations indicate memory settings misconfiguration and/or low-memory conditions.</li>
<li><code>SlicedFromPreallocatedArea</code> – the buffer is allocated/sliced from a large preallocated chunk of the memory; the change in the chunk size is reported.</li>
<li><code>FallbackBufferAllocated</code> – the fallback overflow buffer allocated; changes in the overflow buffer count and in the total allocated memory are reported. Usually, fallback overflow allocations indicate severe memory settings misconfiguration and/or severe low-memory conditions.</li>
<li><code>AllocatedForPreallocatedArea</code> – the large preallocation buffer is allocated to slice smaller buffers from it later; change in the total allocated memory is reported.</li>
<li><code>ReturnedToPool</code> – the buffer is returned to the pool; change in the pool size is reported.</li>
<li><code>DirectBufferPoolSizeChanged</code> – JVM's allocated direct memory size is changed.</li>
</ul>
<h2 id="event-aggregation"><a class="header" href="#event-aggregation">Event Aggregation</a></h2>
<p>You may change the "spamness" of the tracer by adjusting the value of <code>memory.directMemory.trace.aggregation</code> setting. Possible values:</p>
<ul>
<li><code>none</code> – for no aggregation, events are traced one-by-one.</li>
<li><code>low</code> – for low aggregation which provides more details.</li>
<li><code>medium</code> (default) – provides medium level of details.</li>
<li><code>high</code> – provides low level of details.</li>
</ul>
<p>Alternatively, you may adjust the aggregation level at runtime by changing the value of <code>OGlobalConfiguration#DIRECT_MEMORY_TRACE_AGGREGATION</code> setting or by changing the value of the <code>TraceAggregation</code> attribute on the <code>com.orientechnologies.common.directmemory:type=OByteBufferPoolMXBean</code> JMX bean.</p>
<h2 id="see-also-4"><a class="header" href="#see-also-4">See Also</a></h2>
<ul>
<li><a href="troubleshooting/Leak-Detector.html">Memory Leak Detector</a></li>
<li><a href="troubleshooting/../admin/Logging.html">Logging</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="performance-tuning"><a class="header" href="#performance-tuning">Performance Tuning</a></h1>
<p>This guide contains the general tips to optimize your application that use the OrientDB. Below you can find links for the specific guides different per database type used. Look at the specific guides based on the database type you're using:</p>
<ul>
<li><a href="tuning/Performance-Tuning-Document.html">Document Database performance tuning</a></li>
<li><a href="tuning/Performance-Tuning-Object.html">Object Database performance tuning</a></li>
<li><a href="tuning/../distributed/Distributed-Configuration-Tuning.html">Distributed Configuration tuning</a></li>
</ul>
<h2 id="io-benchmark"><a class="header" href="#io-benchmark">I/O benchmark</a></h2>
<p>The main requirement for a fast DBMS is having good I/O. In order to understand the performance of your hw/sw configuration. If you have a Unix derived OS (like Linux, MacOSX, etc.), the simplest way to have your raw I/O performance is running this two commands:</p>
<pre><code>dd if=/dev/zero of=/tmp/output.img bs=8k count=256k
rm /tmp/output.img
</code></pre>
<p>This is the output on a fast SSD (1.4 GB/sec):</p>
<pre><code>262144+0 records in
262144+0 records out
2147483648 bytes transferred in 1.467536 secs (1463326070 bytes/sec)
</code></pre>
<p>And this is what you usually get with a HD connected with a USB 3.0 (90 MB/sec):</p>
<pre><code>262144+0 records in
262144+0 records out
2147483648 bytes transferred in 23.699740 secs (90612119 bytes/sec)
</code></pre>
<p>As you can notice the first configuration (SSD) is 16x faster than the second configuration (HD). Sensible differences can be found between bare metal hw and Virtual Machines.</p>
<h2 id="java"><a class="header" href="#java">Java</a></h2>
<p>OrientDB is written in Java, so it runs on top of Java Virtual Machine (JVM). OrientDB is compatible with Java 8 and we suggest to use this version to run OrientDB. Java 8 is faster than Java 7 and previous ones.</p>
<h2 id="jmx-1"><a class="header" href="#jmx-1">JMX</a></h2>
<p>Starting from v2.1, OrientDB exposes internal metrics through <a href="tuning/../admin/JMX.html">JMX Beans</a>. Use this information to track and profile OrientDB.</p>
<h2 id="memory-settings"><a class="header" href="#memory-settings">Memory settings</a></h2>
<h3 id="server-and-embedded-settings"><a class="header" href="#server-and-embedded-settings">Server and Embedded settings</a></h3>
<p>These settings are valid for both Server component and the JVM where is running the Java application that use OrientDB in Embedded Mode, by using directly <a href="tuning/../internals/plocal-storage-engine.html">plocal</a>.</p>
<p>The most important thing on tuning is assuring the memory settings are correct. What can make the real difference is the right balancing between the heap and the virtual memory used by Memory Mapping, specially on large datasets (GBs, TBs and more) where the in memory cache structures count less than raw IO.</p>
<p>For example if you can assign maximum 8GB to the Java process, it's usually better assigning small heap and large disk cache buffer (off-heap memory). So rather than:</p>
<pre><code>java -Xmx8g ...
</code></pre>
<p>You could instead try this:</p>
<pre><code>java -Xmx800m -Dstorage.diskCache.bufferSize=7200 ...
</code></pre>
<p>The <strong>storage.diskCache.bufferSize</strong> setting (with old "local" storage it was <strong>file.mmap.maxMemory</strong>) is in MB and tells how much memory to use for <a href="tuning/../internals/plocal-storage-disk-cache.html">Disk Cache</a> component. By default is 4GB.</p>
<p><em>NOTE: If the sum of maximum heap and disk cache buffer is too high, could cause the OS to swap with huge slow down.</em></p>
<h2 id="jvm-settings"><a class="header" href="#jvm-settings">JVM settings</a></h2>
<p>JVM settings are encoded in server.sh (and server.bat) batch files. You can change them to tune the JVM according to your usage and hw/sw settings. We found these setting work well on most configurations:</p>
<pre><code class="language-java">-server -XX:+PerfDisableSharedMem
</code></pre>
<p>This setting will disable writing debug information about the JVM. In case you need to profile the JVM, just remove this setting. For more information look at this post: http://www.evanjones.ca/jvm-mmap-pause.html.</p>
<h3 id="high-concurrent-updates"><a class="header" href="#high-concurrent-updates">High concurrent updates</a></h3>
<p>OrientDB has an optimistic concurrency control system, but on very high concurrent updates on the few records it could be more efficient locking records to avoid retries. You could synchronize the access by yourself or by using the storage API. Note that this works only with non-remote databases.</p>
<pre><code>((OStorageEmbedded)db.getStorage()).acquireWriteLock(final ORID iRid)
((OStorageEmbedded)db.getStorage()).acquireSharedLock(final ORID iRid)
((OStorageEmbedded)db.getStorage()).releaseWriteLock(final ORID iRid)
((OStorageEmbedded)db.getStorage()).releaseSharedLock(final ORID iRid)
</code></pre>
<p>Example of usage. Writer threads:</p>
<pre><code>try{
  ((OStorageEmbedded)db.getStorage()).acquireWriteLock(record.getIdentity());

  // DO SOMETHING
} finally {
  ((OStorageEmbedded)db.getStorage()).releaseWriteLock(record.getIdentity());
}
</code></pre>
<p>Reader threads:</p>
<pre><code>try{
  ((OStorageEmbedded)db.getStorage()).acquireSharedLock(record.getIdentity());
  // DO SOMETHING

} finally {
  ((OStorageEmbedded)db.getStorage()).releaseSharedLock(record.getIdentity());
}
</code></pre>
<h2 id="remote-connections-1"><a class="header" href="#remote-connections-1">Remote connections</a></h2>
<p>There are many ways to improve performance when you access to the database using the remote connection.</p>
<h3 id="fetching-strategy"><a class="header" href="#fetching-strategy">Fetching strategy</a></h3>
<p>When you work with a remote database you've to pay attention to the <a href="tuning/../java/Fetching-Strategies.html">fetching strategy</a> used. By default OrientDB Client loads only the record contained in the result set. For example if a query returns 100 elements, but then you cross these elements from the client, then OrientDB client lazily loads the elements with one more network call to the server foreach missed record.</p>
<p>By specifying a fetch plan when you execute a command you're telling to OrientDB to prefetch the elements you know the client application will access. By specifying a complete fetch plan you could receive the entire result in <em>just one network call</em>.</p>
<p>For more information look at: <a href="tuning/../java/Fetching-Strategies.html">Fetching-Strategies</a>.</p>
<h3 id="network-connection-pool"><a class="header" href="#network-connection-pool">Network Connection Pool</a></h3>
<p>Each client, by default, uses only one network connection to talk with the server. Multiple threads on the same client share the same network connection pool.</p>
<p>When you've multiple threads could be a bottleneck since a lot of time is spent on waiting for a free network connection. This is the reason why is much important to configure the network connection pool.</p>
<p>The configurations is very simple, just 2 parameters:</p>
<ul>
<li><strong>minPool</strong>, is the initial size of the connection pool. The default value is configured as global parameters "client.channel.minPool" (see <a href="tuning/../admin/Configuration.html#parameters">parameters</a>)</li>
<li><strong>maxPool</strong>, is the maximum size the connection pool can reach. The default value is configured as global parameters "client.channel.maxPool" (see <a href="tuning/../admin/Configuration.html#parameters">parameters</a>)</li>
</ul>
<p>At first connection the <strong>minPool</strong> is used to pre-create network connections against the server. When a client thread is asking for a connection and all the pool is busy, then it tries to create a new connection until <strong>maxPool</strong> is reached.</p>
<p>If all the pool connections are busy, then the client thread will wait for the first free connection.</p>
<p>Example of configuration by using database properties:</p>
<pre><code class="language-java">database = new ODatabaseDocumentTx("remote:localhost/demo");
database.setProperty("minPool", 2);
database.setProperty("maxPool", 5);

database.open("admin", "admin");
</code></pre>
<h3 id="enlarge-timeouts"><a class="header" href="#enlarge-timeouts">Enlarge timeouts</a></h3>
<p>If you see a lot of messages like:</p>
<pre><code>WARNING: Connection re-acquired transparently after XXXms and Y retries: no errors will be thrown at application level
</code></pre>
<p>means that probably default timeouts are too low and server side operation need more time to complete. It's strongly suggested you enlarge your timeout only after tried to enlarge the <a href="tuning/Performance-Tuning.html#network-connection-pool">Network Connection Pool</a>. The timeout parameters to tune are:</p>
<ul>
<li><code>network.lockTimeout</code>, the timeout in ms to acquire a lock against a channel. The default is 15 seconds.</li>
<li><code>network.socketTimeout</code>, the TCP/IP Socket timeout in ms. The default is 10 seconds.</li>
</ul>
<h2 id="query-5"><a class="header" href="#query-5">Query</a></h2>
<h3 id="use-of-indexes"><a class="header" href="#use-of-indexes">Use of indexes</a></h3>
<p>The first improvement to speed up queries is to create <a href="tuning/../indexing/Indexes.html">Indexes</a> against the fields used in WHERE conditions. For example this query:</p>
<pre><code class="language-sql">SELECT FROM Profile WHERE name = 'Jay'
</code></pre>
<p>Browses the entire "profile" cluster looking for records that satisfy the conditions. The solution is to create an index against the 'name' property with:</p>
<pre><code class="language-sql">CREATE INDEX profile.name UNIQUE
</code></pre>
<p>Use NOTUNIQUE instead of UNIQUE if the value is not unique.</p>
<p>For more complex queries like</p>
<pre><code class="language-sql">SELECT * FROM testClass WHERE prop1 = ? AND prop2 = ?
</code></pre>
<p>Composite index should be used</p>
<pre><code class="language-sql">CREATE INDEX compositeIndex ON testClass (prop1, prop2) UNIQUE
</code></pre>
<p>or via Java API:</p>
<pre><code class="language-java">oClass.createIndex("compositeIndex", OClass.INDEX_TYPE.UNIQUE, "prop1", "prop2");
</code></pre>
<p>Moreover, because of partial match searching, this index will be used for optimizing query like</p>
<pre><code class="language-sql">SELECT * FROM testClass WHERE prop1 = ?
</code></pre>
<p>For deep understanding of query optimization look at <a href="https://github.com/orientechnologies/orientdb/blob/master/tests/src/test/java/com/orientechnologies/orient/test/database/auto/SQLSelectIndexReuseTest.java">the unit test</a>.</p>
<h3 id="use-parameters-instead-of-hard-wired-values"><a class="header" href="#use-parameters-instead-of-hard-wired-values">Use parameters instead of hard-wired values</a></h3>
<p>Query parsing is not an extremely expensive operation, but zero cost is better than low cost, right?</p>
<p>When you execute an SQL query, OrientDB parses the query text and produces an <a href="https://en.wikipedia.org/wiki/Abstract_syntax_tree">AST</a>. This structure is cached at storage level, so if you execute the query again, OrientDB will avoid to parse it again and will just pick the AST from the cache.</p>
<p>In most cases, your application will execute a very limited number of queries, but with different condition values, eg.</p>
<pre><code class="language-sql">SELECT FROM Person WHERE name = 'Joe';
SELECT FROM Person WHERE name = 'Jenny';
SELECT FROM Person WHERE name = 'Frank';
SELECT FROM Person WHERE name = 'Anne';
</code></pre>
<p>With these queries, OrientDB has to perform parsing operations each time.</p>
<p>Re-writing the query as follows:</p>
<pre><code class="language-sql">SELECT FROM Person WHERE name = ?;
</code></pre>
<p>or</p>
<pre><code class="language-sql">SELECT FROM Person WHERE name = :theName;
</code></pre>
<p>and passing the name as a parameter (see the docs for your language driver, eg <a href="tuning/../java/Java-Query-API.html">the Java Multi-Model API</a>) allows OrientDB to parse the query only once and then cache it. The second time you execute the same query, even with different parameters, there will be no parsing at all.</p>
<h3 id="parallel-queries"><a class="header" href="#parallel-queries">Parallel queries</a></h3>
<p>Starting from v2.2, the OrientDB SQL executor will decide if execute or not a query in parallel. To tune parallel query execution these are the new settings:</p>
<ul>
<li><code>query.parallelAuto</code> enable automatic parallel query, if requirements are met. By default is true if your system has more than 2 CPUs/Cores.</li>
<li><code>query.parallelMinimumRecords</code> is the minimum number of records to activate parallel query automatically. Default is 300,000.</li>
<li><code>query.parallelResultQueueSize</code> is the size of the queue that holds results on parallel execution. The queue is blocking, so in case the queue is full, the query threads will be in a wait state. Default is 20,000 results.</li>
</ul>
<h2 id="massive-insertion"><a class="header" href="#massive-insertion">Massive Insertion</a></h2>
<h3 id="use-the-massive-insert-intent"><a class="header" href="#use-the-massive-insert-intent">Use the Massive Insert intent</a></h3>
<p>Intents suggest to OrientDB what you're going to do. In this case you're telling to OrientDB that you're executing a massive insertion. OrientDB auto-reconfigure itself to obtain the best performance. When done you can remove the intent just setting it to null.</p>
<p>Example:</p>
<pre><code class="language-java">db.declareIntent( new OIntentMassiveInsert() );

// YOUR MASSIVE INSERTION

db.declareIntent( null );
</code></pre>
<h3 id="disable-journal"><a class="header" href="#disable-journal">Disable Journal</a></h3>
<p>In case of massive insertion, specially when this operation is made just once, you could disable the journal (WAL) to improve insertion speed:</p>
<pre><code>-storage.useWAL=false
</code></pre>
<p>By default <a href="tuning/../internals/Write-Ahead-Log.html">WAL (Write Ahead Log)</a> is enabled.</p>
<h3 id="disable-sync-on-flush-of-pages"><a class="header" href="#disable-sync-on-flush-of-pages">Disable sync on flush of pages</a></h3>
<p>This setting avoids to execute a sync at OS level when a page is flushed. Disabling this setting will improve throughput on writes:</p>
<pre><code>-Dstorage.wal.syncOnPageFlush=false
</code></pre>
<h2 id="massive-updates"><a class="header" href="#massive-updates">Massive Updates</a></h2>
<p>Updates generates "holes" at Storage level because rarely the new record fits perfectly the size of the previous one. Holes are free spaces between data. Holes are recycled but an excessive number of small holes it's the same as having a highly defragmented File System: space is wasted (because small holes can't be easily recycled) and performance degrades when the database growth.</p>
<h3 id="oversize"><a class="header" href="#oversize">Oversize</a></h3>
<p>If you know you will update certain type of records, create a class for them and set the Oversize (default is 0) to 2 or more.</p>
<p>By default the OGraphVertex class has an oversize value setted at 2. If you define your own classes set this value at least at 2.</p>
<p>OClass myClass = getMetadata().getSchema().createClass("Car");
myClass.setOverSize(2);</p>
<h2 id="wise-use-of-transactions"><a class="header" href="#wise-use-of-transactions">Wise use of transactions</a></h2>
<p>To obtain real linear performance with OrientDB you should avoid to use <a href="tuning/../internals/Transactions.html">Transactions</a> as far as you can. In facts OrientDB keeps in memory all the changes until you flush it with a commit. So the bottleneck is your Heap space and the management of local transaction cache (implemented as a Map).</p>
<p><a href="tuning/../internals/Transactions.html">Transactions</a> slow down massive inserts unless you're using a "remote" connection. In that case it speeds up all the insertion because the client/server communication happens only at commit time.</p>
<h3 id="disable-transaction-log"><a class="header" href="#disable-transaction-log">Disable Transaction Log</a></h3>
<p>If you need to group operations to speed up remote execution in a logical transaction but renouncing to the Transaction Log, just disable it by setting the property <strong>tx.useLog</strong> to false.</p>
<p>Via JVM configuration:</p>
<pre><code>java ... -Dtx.useLog=false ...
</code></pre>
<p>or via API:</p>
<pre><code class="language-java">OGlobalConfiguration.TX_USE_LOG.setValue(false);
</code></pre>
<p><em>NOTE: Please note that in case of crash of the JVM the pending transaction OrientDB could not be able to rollback it.</em></p>
<h3 id="use-the-schema"><a class="header" href="#use-the-schema">Use the schema</a></h3>
<p>Starting from OrientDB 2.0, if fields are declared in the schema, field names are not stored in document/vertex/edge themselves. This improves performance and saves a lot of space on disk.</p>
<h2 id="configuration-10"><a class="header" href="#configuration-10">Configuration</a></h2>
<p>To tune OrientDB look at the <a href="tuning/../admin/Configuration.html">Configuration</a> settings.</p>
<h2 id="platforms"><a class="header" href="#platforms">Platforms</a></h2>
<ul>
<li><a href="http://carloprad.blogspot.it/2014/03/orientdb-on-zfs-performance-analysis.html">Performance analysis on ZFS</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tuning-the-graph-api"><a class="header" href="#tuning-the-graph-api">Tuning the Graph API</a></h1>
<p>This guide is specific for the <a href="tuning/../java/Graph-Database-Tinkerpop.html">TinkerPop Blueprints Graph Database</a>. Please be sure to read the generic guide to the <a href="tuning/Performance-Tuning.html">Performance-Tuning</a>.</p>
<h2 id="connect-to-the-database-locally"><a class="header" href="#connect-to-the-database-locally">Connect to the database locally</a></h2>
<p>Local connection is much faster than remote. So use "plocal" based on the storage engine used on database creation. If you need to connect to the database from the network you can use the <a href="tuning/../internals/Embedded-Server.html">"Embed the server technique"</a>.</p>
<h2 id="avoid-putting-properties-on-edges"><a class="header" href="#avoid-putting-properties-on-edges">Avoid putting properties on edges</a></h2>
<p>Even though supports properties on edges, this is much expensive because it creates a new record per edge. So if you need them you've to know that the database will be bigger and insertion time will be much longer.</p>
<h2 id="set-properties-all-together"><a class="header" href="#set-properties-all-together">Set properties all together</a></h2>
<p>It's much lighter to set properties in block than one by one. Look at this paragraph: <a href="tuning/../java/Graph-VE.html#setting-multiple-properties">Setting Multiple Properties</a>.</p>
<h2 id="set-properties-on-vertex-and-edge-creation"><a class="header" href="#set-properties-on-vertex-and-edge-creation">Set properties on vertex and edge creation</a></h2>
<p>It's even faster if you set properties directly on creation of vertices and edges. Look at this paragraph: <a href="tuning/../java/Graph-VE.html#creating-element-and-properties-together">Creating Elements and Properties Together</a>.</p>
<h2 id="massive-insertion-1"><a class="header" href="#massive-insertion-1">Massive Insertion</a></h2>
<p>See <a href="tuning/Performance-Tuning.html#massive-insertion">Generic improvement on massive insertion</a>. To access to the underlying database use:</p>
<pre><code>database.getRawGraph().declareIntent( new OIntentMassiveInsert() );

// YOUR MASSIVE INSERTION

database.getRawGraph().declareIntent( null );
</code></pre>
<h2 id="avoid-transactions-if-you-can"><a class="header" href="#avoid-transactions-if-you-can">Avoid transactions if you can</a></h2>
<p>Use the OrientGraphNoTx implementation that doesn't use transaction for basic operations like creation and deletion of vertices and edges. If you plan to don't use transactions change the <a href="tuning/../java/Graph-Consistency.html">consistency level</a>. OrientGraphNoTx is not compatible with OrientBatchGraph so use it plain:</p>
<pre><code>OrientGraphNoTx graph = new OrientGraphNoTx("local:/tmp/mydb");
</code></pre>
<h2 id="use-the-schema-1"><a class="header" href="#use-the-schema-1">Use the schema</a></h2>
<p>Even if you can model your graph with only the entities (V)ertex and (E)dge it's much better to use schema for your types extending Vertex and Edge classes. In this way traversing will be faster and vertices and edges will be split on different files. For more information look at: <a href="tuning/../java/Graph-Schema.html">Graph Schema</a>.</p>
<p>Example:</p>
<pre><code>OClass account = graph.createVertexType("Account");
Vertex v = graph.addVertex("class:Account");
</code></pre>
<h2 id="use-indexes-to-lookup-vertices-by-an-id"><a class="header" href="#use-indexes-to-lookup-vertices-by-an-id">Use indexes to lookup vertices by an ID</a></h2>
<p>If you've your own ID on vertices and you need to lookup them to create edges then create an index against it:</p>
<pre><code>graph.createKeyIndex("id", Vertex.class, new Parameter("class", "Account"));
</code></pre>
<p>If the ID is unique then create an UNIQUE index that is much faster and lighter:</p>
<pre><code>graph.createKeyIndex("id", Vertex.class, new Parameter("type", "UNIQUE"), new Parameter("class", "Account"));
</code></pre>
<p>To lookup vertices by ID:</p>
<pre><code>for( Vertex v : graph.getVertices("Account.id", "23876JS2") ) {
  System.out.println("Found vertex: " + v );
}
</code></pre>
<h2 id="disable-validation"><a class="header" href="#disable-validation">Disable validation</a></h2>
<p>Every time a graph element is modified, OrientDB executes a validation to assure the graph rules are all respected, that means:</p>
<ul>
<li>put edge in out/in collections</li>
<li>put vertex in edges in/out</li>
</ul>
<p>Now if you use the Graph API without bypassing graph element manipulation this could be turned off with a huge gain in performance:</p>
<pre><code>graph.setValidationEnabled(false);
</code></pre>
<h2 id="reduce-vertex-objects"><a class="header" href="#reduce-vertex-objects">Reduce vertex objects</a></h2>
<p>You can avoid the creation of a new ODocument for each new vertex by reusing it with ODocument.reset() method that clears the instance making it ready for a new insert operation. Bear in mind that you will need to assign the document with the proper class after resetting as it is done in the code below.</p>
<blockquote>
<p><strong>NOTE</strong>: This trick works <em>ONLY IN NON-TRANSACTIONAL</em> contexts, because during transactions the documents could be kept in memory until commit.</p>
</blockquote>
<p>Example:</p>
<pre><code class="language-java">db.declareIntent( new OIntentMassiveInsert() );

ODocument doc = db.createVertex("myVertex");
for( int i = 0; i &lt; 1000000; ++i ){
  doc.reset();
  doc.setClassName("myVertex");
  doc.field("id", i);
  doc.field("name", "Jason");
  doc.save();
}

db.declareIntent( null );
</code></pre>
<h2 id="cache-management"><a class="header" href="#cache-management">Cache management</a></h2>
<p>Graph Database, by default, caches the most used elements. For massive insertion is strongly suggested to disable cache to avoid to keep all the element in memory. <a href="tuning/Performance-Tuning.html#use-the-massive-insert-intent">Massive Insert Intent</a> automatically sets it to false.</p>
<pre><code class="language-java">graph.setRetainObjects(false);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tuning-the-document-api"><a class="header" href="#tuning-the-document-api">Tuning the Document API</a></h1>
<p>This guide is specific for the Document Database. Please be sure to read the generic guide to the <a href="tuning/Performance-Tuning.html">Performance-Tuning</a>.</p>
<h2 id="massive-insertion-2"><a class="header" href="#massive-insertion-2">Massive Insertion</a></h2>
<p>See <a href="tuning/Performance-Tuning.html#massive-insertion">Generic improvement on massive insertion</a>.</p>
<h3 id="avoid-document-creation"><a class="header" href="#avoid-document-creation">Avoid document creation</a></h3>
<p>You can avoid the creation of a new ODocument for each insertion by using the ODocument.reset() method that clears the instance making it ready for a new insert operation. Bear in mind that you will need to assign the document with the proper class after resetting as it is done in the code below.</p>
<blockquote>
<p><strong>NOTE</strong>: This trick works <em>ONLY IN NON-TRANSACTIONAL</em> contexts, because during transactions the documents could be kept in memory until commit.</p>
</blockquote>
<p>Example:</p>
<pre><code class="language-java">import com.orientechnologies.orient.core.intent.OIntentMassiveInsert;

db.declareIntent( new OIntentMassiveInsert() );

ODocument doc = new ODocument();
for( int i = 0; i &lt; 1000000; ++i ){
  doc.reset();
  doc.setClassName("Customer");
  doc.field("id", i);
  doc.field("name", "Jason");
  doc.save();
}

db.declareIntent( null );
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tuning-the-object-api"><a class="header" href="#tuning-the-object-api">Tuning the Object API</a></h1>
<p>This guide is specific for the Object Database. Please be sure to read the generic guide to the <a href="tuning/Performance-Tuning.html">Performance-Tuning</a>.</p>
<h2 id="massive-insertion-3"><a class="header" href="#massive-insertion-3">Massive Insertion</a></h2>
<p>See <a href="tuning/Performance-Tuning.html#massive-insertion">Generic improvement on massive insertion</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="profiler-1"><a class="header" href="#profiler-1">Profiler</a></h1>
<p><a href="tuning/../ee/Enterprise-Edition.html">OrientDB Enterprise Edition</a> comes with a profiler that collects all the metrics about the engine and the system where is running.</p>
<h2 id="automatic-dump"><a class="header" href="#automatic-dump">Automatic dump</a></h2>
<p>When you incur in problems, the best way to produce information about OrientDB is activating a regular dump of the profiler. Set this configuration variable at start:</p>
<pre><code>java ... -Dprofiler.autoDump.reset=true -Dprofiler.autoDump.interval=60 -Dprofiler.enabled=true ...
</code></pre>
<p>This will dump the profiler in the console every 60 seconds and resets the metrics after the dump. For more information about settings look at <a href="tuning/Performance-Tuning.html">Parameters</a>.</p>
<h2 id="retrieve-profiler-metrics-via-http"><a class="header" href="#retrieve-profiler-metrics-via-http">Retrieve profiler metrics via HTTP</a></h2>
<pre><code>http://&lt;server&gt;[&lt;:port&gt;]/profiler/&lt;command&gt;/[&lt;config&gt;]|[&lt;from&gt;/&lt;to&gt;]
</code></pre>
<p>Where:</p>
<ul>
<li><strong>server</strong> is the server where OrientDB is running</li>
<li><strong>port</strong> is the http port, OrientDB listens at 2480 by default</li>
<li><strong>command</strong>, is the command between:</li>
<li><strong>realtime</strong> to retrieve realtime information</li>
<li><strong>last</strong> to retrieve realtime information</li>
<li><strong>archive</strong> to retrieve archived profiling</li>
<li><strong>summary</strong> to retrieve summary of past profiling</li>
<li><strong>start</strong> to start profiling</li>
<li><strong>stop</strong> to stop profiling</li>
<li><strong>reset</strong> to reset the profiler (equals to stop+start)</li>
<li><strong>status</strong> to know the status of profiler</li>
<li><strong>configure</strong> to configure profiling</li>
<li><strong>metadata</strong> to retrieve metadata</li>
</ul>
<p>Example:</p>
<pre><code>http://localhost:2480/profiler/realtime
</code></pre>
<h2 id="metric-type"><a class="header" href="#metric-type">Metric type</a></h2>
<h3 id="chrono"><a class="header" href="#chrono">Chrono</a></h3>
<p>Chrono are recording of operation. Each Chrono has the following values:</p>
<ul>
<li><strong>last</strong>, as the last time recorded</li>
<li><strong>min</strong>, as the minimum time recorded</li>
<li><strong>max</strong>, as the maximum time recorded</li>
<li><strong>average</strong>, as the average time recorded</li>
<li><strong>total</strong>, as the total time recorded</li>
<li><strong>entries</strong>, as the number of times the metric has been recorded</li>
</ul>
<h3 id="counter"><a class="header" href="#counter">Counter</a></h3>
<p>It's a counter as long value that records resources.</p>
<h3 id="hookvalues"><a class="header" href="#hookvalues">HookValues</a></h3>
<p>Are generic values of any type between the supported ones: string, number, boolean or null.</p>
<p>A hook value is not collected in central way, but it's gathered at runtime by calling the hooks as callbacks.</p>
<h2 id="metric-main-categories"><a class="header" href="#metric-main-categories">Metric main categories</a></h2>
<p>Follows the main categories of metrics:</p>
<ul>
<li><strong><code>db.&lt;db-name&gt;</code></strong>: database related metrics</li>
<li><strong><code>db.&lt;db-name&gt;.cache</code></strong>: metrics about db's caching</li>
<li><strong><code>db.&lt;db-name&gt;.index</code></strong>: metrics about db's indexes</li>
<li><strong><code>system</code></strong>: system metrics like CPU, memory, OS, etc.</li>
<li><strong><code>system.disk</code></strong>: File system metrics</li>
<li><strong><code>process</code></strong>: not strictly related to database but to the process (JVM) that is running OrientDB as client, server or embedded</li>
<li><strong><code>process.network</code></strong>: network metrics</li>
<li><strong><code>process.runtime</code></strong>: process's runtime information like memory used, etc</li>
<li><strong><code>server</code></strong>: server related metrics</li>
</ul>
<p>Example of profiler values extracted from the server after test suite is run (http://localhost:2480/profiler/realtime):</p>
<pre><code class="language-json">{
    "realtime": {
        "from": 1344531312356,
        "to": 9223372036854776000,
        "hookValues": {
            "db.0$db.cache.level1.current": 0,
            "db.0$db.cache.level1.enabled": false,
            "db.0$db.cache.level1.max": -1,
            "db.0$db.cache.level2.current": 0,
            "db.0$db.cache.level2.enabled": true,
            "db.0$db.cache.level2.max": -1,
            "db.0$db.data.holeSize": 0,
            "db.0$db.data.holes": 0,
            "db.0$db.index.dictionary.entryPointSize": 64,
            "db.0$db.index.dictionary.items": 0,
            "db.0$db.index.dictionary.maxUpdateBeforeSave": 5000,
            "db.0$db.index.dictionary.optimizationThreshold": 100000,
            "db.1$db.cache.level1.current": 0,
            "db.1$db.cache.level1.enabled": false,
            "db.1$db.cache.level1.max": -1,
            "db.1$db.cache.level2.current": 0,
            "db.1$db.cache.level2.enabled": true,
            "db.1$db.cache.level2.max": -1,
            "db.1$db.data.holeSize": 0,
            "db.1$db.data.holes": 0,
            "db.1$db.index.dictionary.entryPointSize": 64,
            "db.1$db.index.dictionary.items": 0,
            "db.1$db.index.dictionary.maxUpdateBeforeSave": 5000,
            "db.1$db.index.dictionary.optimizationThreshold": 100000,
            "db.2$db.cache.level1.current": 0,
            "db.2$db.cache.level1.enabled": false,
            "db.2$db.cache.level1.max": -1,
            "db.2$db.cache.level2.current": 0,
            "db.2$db.cache.level2.enabled": true,
            "db.2$db.cache.level2.max": -1,
            "db.2$db.data.holeSize": 0,
            "db.2$db.data.holes": 0,
            "db.2$db.index.dictionary.entryPointSize": 64,
            "db.2$db.index.dictionary.items": 0,
            "db.2$db.index.dictionary.maxUpdateBeforeSave": 5000,
            "db.2$db.index.dictionary.optimizationThreshold": 100000,
            "db.demo.cache.level1.current": 0,
            "db.demo.cache.level1.enabled": false,
            "db.demo.cache.level1.max": -1,
            "db.demo.cache.level2.current": 20520,
            "db.demo.cache.level2.enabled": true,
            "db.demo.cache.level2.max": -1,
            "db.demo.data.holeSize": 47553,
            "db.demo.data.holes": 24,
            "db.demo.index.BaseTestClass.testParentProperty.entryPointSize": 64,
            "db.demo.index.BaseTestClass.testParentProperty.items": 2,
            "db.demo.index.BaseTestClass.testParentProperty.maxUpdateBeforeSave": 5000,
            "db.demo.index.BaseTestClass.testParentProperty.optimizationThreshold": 100000,
            "db.demo.index.ClassIndexTestCompositeEmbeddedList.entryPointSize": 64,
            "db.demo.index.ClassIndexTestCompositeEmbeddedList.items": 0,
            "db.demo.index.ClassIndexTestCompositeEmbeddedList.maxUpdateBeforeSave": 5000,
            "db.demo.index.ClassIndexTestCompositeEmbeddedList.optimizationThreshold": 100000,
            "db.demo.index.ClassIndexTestCompositeEmbeddedMap.entryPointSize": 64,
            "db.demo.index.ClassIndexTestCompositeEmbeddedMap.items": 0,
            "db.demo.index.ClassIndexTestCompositeEmbeddedMap.maxUpdateBeforeSave": 5000,
            "db.demo.index.ClassIndexTestCompositeEmbeddedMap.optimizationThreshold": 100000,
            "db.demo.index.ClassIndexTestCompositeEmbeddedMapByKey.entryPointSize": 64,
            "db.demo.index.ClassIndexTestCompositeEmbeddedMapByKey.items": 0,
            "db.demo.index.ClassIndexTestCompositeEmbeddedMapByKey.maxUpdateBeforeSave": 5000,
            "db.demo.index.ClassIndexTestCompositeEmbeddedMapByKey.optimizationThreshold": 100000,
            "db.demo.index.ClassIndexTestCompositeEmbeddedMapByValue.entryPointSize": 64,
            "db.demo.index.ClassIndexTestCompositeEmbeddedMapByValue.items": 0,
            "db.demo.index.ClassIndexTestCompositeEmbeddedMapByValue.maxUpdateBeforeSave": 5000,
            "db.demo.index.ClassIndexTestCompositeEmbeddedMapByValue.optimizationThreshold": 100000,
            "db.demo.index.ClassIndexTestCompositeEmbeddedSet.entryPointSize": 64,
            "db.demo.index.ClassIndexTestCompositeEmbeddedSet.items": 0,
            "db.demo.index.ClassIndexTestCompositeEmbeddedSet.maxUpdateBeforeSave": 5000,
            "db.demo.index.ClassIndexTestCompositeEmbeddedSet.optimizationThreshold": 100000,
            "db.demo.index.ClassIndexTestCompositeLinkList.entryPointSize": 64,
            "db.demo.index.ClassIndexTestCompositeLinkList.items": 0,
            "db.demo.index.ClassIndexTestCompositeLinkList.maxUpdateBeforeSave": 5000,
            "db.demo.index.ClassIndexTestCompositeLinkList.optimizationThreshold": 100000,
            "db.demo.index.ClassIndexTestCompositeLinkMapByValue.entryPointSize": 64,
            "db.demo.index.ClassIndexTestCompositeLinkMapByValue.items": 0,
            "db.demo.index.ClassIndexTestCompositeLinkMapByValue.maxUpdateBeforeSave": 5000,
            "db.demo.index.ClassIndexTestCompositeLinkMapByValue.optimizationThreshold": 100000,
            "db.demo.index.ClassIndexTestCompositeOne.entryPointSize": 64,
            "db.demo.index.ClassIndexTestCompositeOne.items": 0,
            "db.demo.index.ClassIndexTestCompositeOne.maxUpdateBeforeSave": 5000,
            "db.demo.index.ClassIndexTestCompositeOne.optimizationThreshold": 100000,
            "db.demo.index.ClassIndexTestCompositeTwo.entryPointSize": 64,
            "db.demo.index.ClassIndexTestCompositeTwo.items": 0,
            "db.demo.index.ClassIndexTestCompositeTwo.maxUpdateBeforeSave": 5000,
            "db.demo.index.ClassIndexTestCompositeTwo.optimizationThreshold": 100000,
            "db.demo.index.ClassIndexTestDictionaryIndex.entryPointSize": 64,
            "db.demo.index.ClassIndexTestDictionaryIndex.items": 0,
            "db.demo.index.ClassIndexTestDictionaryIndex.maxUpdateBeforeSave": 5000,
            "db.demo.index.ClassIndexTestDictionaryIndex.optimizationThreshold": 100000,
            "db.demo.index.ClassIndexTestFulltextIndex.entryPointSize": 64,
            "db.demo.index.ClassIndexTestFulltextIndex.items": 0,
            "db.demo.index.ClassIndexTestFulltextIndex.maxUpdateBeforeSave": 5000,
            "db.demo.index.ClassIndexTestFulltextIndex.optimizationThreshold": 100000,
            "db.demo.index.ClassIndexTestNotUniqueIndex.entryPointSize": 64,
            "db.demo.index.ClassIndexTestNotUniqueIndex.items": 0,
            "db.demo.index.ClassIndexTestNotUniqueIndex.maxUpdateBeforeSave": 5000,
            "db.demo.index.ClassIndexTestNotUniqueIndex.optimizationThreshold": 100000,
            "db.demo.index.ClassIndexTestParentPropertyNine.entryPointSize": 64,
            "db.demo.index.ClassIndexTestParentPropertyNine.items": 0,
            "db.demo.index.ClassIndexTestParentPropertyNine.maxUpdateBeforeSave": 5000,
            "db.demo.index.ClassIndexTestParentPropertyNine.optimizationThreshold": 100000,
            "db.demo.index.ClassIndexTestPropertyByKeyEmbeddedMap.entryPointSize": 64,
            "db.demo.index.ClassIndexTestPropertyByKeyEmbeddedMap.items": 0,
            "db.demo.index.ClassIndexTestPropertyByKeyEmbeddedMap.maxUpdateBeforeSave": 5000,
            "db.demo.index.ClassIndexTestPropertyByKeyEmbeddedMap.optimizationThreshold": 100000,
            "db.demo.index.ClassIndexTestPropertyByValueEmbeddedMap.entryPointSize": 64,
            "db.demo.index.ClassIndexTestPropertyByValueEmbeddedMap.items": 0,
            "db.demo.index.ClassIndexTestPropertyByValueEmbeddedMap.maxUpdateBeforeSave": 5000,
            "db.demo.index.ClassIndexTestPropertyByValueEmbeddedMap.optimizationThreshold": 100000,
            "db.demo.index.ClassIndexTestPropertyEmbeddedMap.entryPointSize": 64,
            "db.demo.index.ClassIndexTestPropertyEmbeddedMap.items": 0,
            "db.demo.index.ClassIndexTestPropertyEmbeddedMap.maxUpdateBeforeSave": 5000,
            "db.demo.index.ClassIndexTestPropertyEmbeddedMap.optimizationThreshold": 100000,
            "db.demo.index.ClassIndexTestPropertyLinkedMap.entryPointSize": 64,
            "db.demo.index.ClassIndexTestPropertyLinkedMap.items": 0,
            "db.demo.index.ClassIndexTestPropertyLinkedMap.maxUpdateBeforeSave": 5000,
            "db.demo.index.ClassIndexTestPropertyLinkedMap.optimizationThreshold": 100000,
            "db.demo.index.ClassIndexTestPropertyLinkedMapByKey.entryPointSize": 64,
            "db.demo.index.ClassIndexTestPropertyLinkedMapByKey.items": 0,
            "db.demo.index.ClassIndexTestPropertyLinkedMapByKey.maxUpdateBeforeSave": 5000,
            "db.demo.index.ClassIndexTestPropertyLinkedMapByKey.optimizationThreshold": 100000,
            "db.demo.index.ClassIndexTestPropertyLinkedMapByValue.entryPointSize": 64,
            "db.demo.index.ClassIndexTestPropertyLinkedMapByValue.items": 0,
            "db.demo.index.ClassIndexTestPropertyLinkedMapByValue.maxUpdateBeforeSave": 5000,
            "db.demo.index.ClassIndexTestPropertyLinkedMapByValue.optimizationThreshold": 100000,
            "db.demo.index.ClassIndexTestPropertyOne.entryPointSize": 64,
            "db.demo.index.ClassIndexTestPropertyOne.items": 0,
            "db.demo.index.ClassIndexTestPropertyOne.maxUpdateBeforeSave": 5000,
            "db.demo.index.ClassIndexTestPropertyOne.optimizationThreshold": 100000,
            "db.demo.index.Collector.stringCollection.entryPointSize": 64,
            "db.demo.index.Collector.stringCollection.items": 0,
            "db.demo.index.Collector.stringCollection.maxUpdateBeforeSave": 5000,
            "db.demo.index.Collector.stringCollection.optimizationThreshold": 100000,
            "db.demo.index.DropPropertyIndexCompositeIndex.entryPointSize": 64,
            "db.demo.index.DropPropertyIndexCompositeIndex.items": 0,
            "db.demo.index.DropPropertyIndexCompositeIndex.maxUpdateBeforeSave": 5000,
            "db.demo.index.DropPropertyIndexCompositeIndex.optimizationThreshold": 100000,
            "db.demo.index.Fruit.color.entryPointSize": 64,
            "db.demo.index.Fruit.color.items": 0,
            "db.demo.index.Fruit.color.maxUpdateBeforeSave": 5000,
            "db.demo.index.Fruit.color.optimizationThreshold": 100000,
            "db.demo.index.IndexCountPlusCondition.entryPointSize": 64,
            "db.demo.index.IndexCountPlusCondition.items": 5,
            "db.demo.index.IndexCountPlusCondition.maxUpdateBeforeSave": 5000,
            "db.demo.index.IndexCountPlusCondition.optimizationThreshold": 100000,
            "db.demo.index.IndexNotUniqueIndexKeySize.entryPointSize": 64,
            "db.demo.index.IndexNotUniqueIndexKeySize.items": 5,
            "db.demo.index.IndexNotUniqueIndexKeySize.maxUpdateBeforeSave": 5000,
            "db.demo.index.IndexNotUniqueIndexKeySize.optimizationThreshold": 100000,
            "db.demo.index.IndexNotUniqueIndexSize.entryPointSize": 64,
            "db.demo.index.IndexNotUniqueIndexSize.items": 5,
            "db.demo.index.IndexNotUniqueIndexSize.maxUpdateBeforeSave": 5000,
            "db.demo.index.IndexNotUniqueIndexSize.optimizationThreshold": 100000,
            "db.demo.index.MapPoint.x.entryPointSize": 64,
            "db.demo.index.MapPoint.x.items": 9999,
            "db.demo.index.MapPoint.x.maxUpdateBeforeSave": 5000,
            "db.demo.index.MapPoint.x.optimizationThreshold": 100000,
            "db.demo.index.MapPoint.y.entryPointSize": 64,
            "db.demo.index.MapPoint.y.items": 10000,
            "db.demo.index.MapPoint.y.maxUpdateBeforeSave": 5000,
            "db.demo.index.MapPoint.y.optimizationThreshold": 100000,
            "db.demo.index.MyFruit.color.entryPointSize": 64,
            "db.demo.index.MyFruit.color.items": 10,
            "db.demo.index.MyFruit.color.maxUpdateBeforeSave": 5000,
            "db.demo.index.MyFruit.color.optimizationThreshold": 100000,
            "db.demo.index.MyFruit.flavor.entryPointSize": 64,
            "db.demo.index.MyFruit.flavor.items": 0,
            "db.demo.index.MyFruit.flavor.maxUpdateBeforeSave": 5000,
            "db.demo.index.MyFruit.flavor.optimizationThreshold": 100000,
            "db.demo.index.MyFruit.name.entryPointSize": 64,
            "db.demo.index.MyFruit.name.items": 5000,
            "db.demo.index.MyFruit.name.maxUpdateBeforeSave": 5000,
            "db.demo.index.MyFruit.name.optimizationThreshold": 100000,
            "db.demo.index.MyProfile.name.entryPointSize": 64,
            "db.demo.index.MyProfile.name.items": 3,
            "db.demo.index.MyProfile.name.maxUpdateBeforeSave": 5000,
            "db.demo.index.MyProfile.name.optimizationThreshold": 100000,
            "db.demo.index.Profile.hash.entryPointSize": 64,
            "db.demo.index.Profile.hash.items": 5,
            "db.demo.index.Profile.hash.maxUpdateBeforeSave": 5000,
            "db.demo.index.Profile.hash.optimizationThreshold": 100000,
            "db.demo.index.Profile.name.entryPointSize": 64,
            "db.demo.index.Profile.name.items": 20,
            "db.demo.index.Profile.name.maxUpdateBeforeSave": 5000,
            "db.demo.index.Profile.name.optimizationThreshold": 100000,
            "db.demo.index.Profile.nick.entryPointSize": 64,
            "db.demo.index.Profile.nick.items": 38,
            "db.demo.index.Profile.nick.maxUpdateBeforeSave": 5000,
            "db.demo.index.Profile.nick.optimizationThreshold": 100000,
            "db.demo.index.PropertyIndexFirstIndex.entryPointSize": 64,
            "db.demo.index.PropertyIndexFirstIndex.items": 0,
            "db.demo.index.PropertyIndexFirstIndex.maxUpdateBeforeSave": 5000,
            "db.demo.index.PropertyIndexFirstIndex.optimizationThreshold": 100000,
            "db.demo.index.PropertyIndexSecondIndex.entryPointSize": 64,
            "db.demo.index.PropertyIndexSecondIndex.items": 0,
            "db.demo.index.PropertyIndexSecondIndex.maxUpdateBeforeSave": 5000,
            "db.demo.index.PropertyIndexSecondIndex.optimizationThreshold": 100000,
            "db.demo.index.PropertyIndexTestClass.prop1.entryPointSize": 64,
            "db.demo.index.PropertyIndexTestClass.prop1.items": 0,
            "db.demo.index.PropertyIndexTestClass.prop1.maxUpdateBeforeSave": 5000,
            "db.demo.index.PropertyIndexTestClass.prop1.optimizationThreshold": 100000,
            "db.demo.index.SQLDropClassCompositeIndex.entryPointSize": 64,
            "db.demo.index.SQLDropClassCompositeIndex.items": 0,
            "db.demo.index.SQLDropClassCompositeIndex.maxUpdateBeforeSave": 5000,
            "db.demo.index.SQLDropClassCompositeIndex.optimizationThreshold": 100000,
            "db.demo.index.SQLDropIndexCompositeIndex.entryPointSize": 64,
            "db.demo.index.SQLDropIndexCompositeIndex.items": 0,
            "db.demo.index.SQLDropIndexCompositeIndex.maxUpdateBeforeSave": 5000,
            "db.demo.index.SQLDropIndexCompositeIndex.optimizationThreshold": 100000,
            "db.demo.index.SQLDropIndexTestClass.prop1.entryPointSize": 64,
            "db.demo.index.SQLDropIndexTestClass.prop1.items": 0,
            "db.demo.index.SQLDropIndexTestClass.prop1.maxUpdateBeforeSave": 5000,
            "db.demo.index.SQLDropIndexTestClass.prop1.optimizationThreshold": 100000,
            "db.demo.index.SQLDropIndexWithoutClass.entryPointSize": 64,
            "db.demo.index.SQLDropIndexWithoutClass.items": 0,
            "db.demo.index.SQLDropIndexWithoutClass.maxUpdateBeforeSave": 5000,
            "db.demo.index.SQLDropIndexWithoutClass.optimizationThreshold": 100000,
            "db.demo.index.SQLSelectCompositeIndexDirectSearchTestIndex.entryPointSize": 64,
            "db.demo.index.SQLSelectCompositeIndexDirectSearchTestIndex.items": 0,
            "db.demo.index.SQLSelectCompositeIndexDirectSearchTestIndex.maxUpdateBeforeSave": 5000,
            "db.demo.index.SQLSelectCompositeIndexDirectSearchTestIndex.optimizationThreshold": 100000,
            "db.demo.index.SchemaSharedIndexCompositeIndex.entryPointSize": 64,
            "db.demo.index.SchemaSharedIndexCompositeIndex.items": 0,
            "db.demo.index.SchemaSharedIndexCompositeIndex.maxUpdateBeforeSave": 5000,
            "db.demo.index.SchemaSharedIndexCompositeIndex.optimizationThreshold": 100000,
            "db.demo.index.TRPerson.name.entryPointSize": 64,
            "db.demo.index.TRPerson.name.items": 4,
            "db.demo.index.TRPerson.name.maxUpdateBeforeSave": 5000,
            "db.demo.index.TRPerson.name.optimizationThreshold": 100000,
            "db.demo.index.TRPerson.surname.entryPointSize": 64,
            "db.demo.index.TRPerson.surname.items": 3,
            "db.demo.index.TRPerson.surname.maxUpdateBeforeSave": 5000,
            "db.demo.index.TRPerson.surname.optimizationThreshold": 100000,
            "db.demo.index.TestClass.name.entryPointSize": 64,
            "db.demo.index.TestClass.name.items": 2,
            "db.demo.index.TestClass.name.maxUpdateBeforeSave": 5000,
            "db.demo.index.TestClass.name.optimizationThreshold": 100000,
            "db.demo.index.TestClass.testLink.entryPointSize": 64,
            "db.demo.index.TestClass.testLink.items": 2,
            "db.demo.index.TestClass.testLink.maxUpdateBeforeSave": 5000,
            "db.demo.index.TestClass.testLink.optimizationThreshold": 100000,
            "db.demo.index.TransactionUniqueIndexWithDotTest.label.entryPointSize": 64,
            "db.demo.index.TransactionUniqueIndexWithDotTest.label.items": 1,
            "db.demo.index.TransactionUniqueIndexWithDotTest.label.maxUpdateBeforeSave": 5000,
            "db.demo.index.TransactionUniqueIndexWithDotTest.label.optimizationThreshold": 100000,
            "db.demo.index.Whiz.account.entryPointSize": 64,
            "db.demo.index.Whiz.account.items": 1,
            "db.demo.index.Whiz.account.maxUpdateBeforeSave": 5000,
            "db.demo.index.Whiz.account.optimizationThreshold": 100000,
            "db.demo.index.Whiz.text.entryPointSize": 64,
            "db.demo.index.Whiz.text.items": 275,
            "db.demo.index.Whiz.text.maxUpdateBeforeSave": 5000,
            "db.demo.index.Whiz.text.optimizationThreshold": 100000,
            "db.demo.index.a.entryPointSize": 64,
            "db.demo.index.a.items": 0,
            "db.demo.index.a.maxUpdateBeforeSave": 5000,
            "db.demo.index.a.optimizationThreshold": 100000,
            "db.demo.index.anotherproperty.entryPointSize": 64,
            "db.demo.index.anotherproperty.items": 0,
            "db.demo.index.anotherproperty.maxUpdateBeforeSave": 5000,
            "db.demo.index.anotherproperty.optimizationThreshold": 100000,
            "db.demo.index.byte-array-manualIndex-notunique.entryPointSize": 64,
            "db.demo.index.byte-array-manualIndex-notunique.items": 6,
            "db.demo.index.byte-array-manualIndex-notunique.maxUpdateBeforeSave": 5000,
            "db.demo.index.byte-array-manualIndex-notunique.optimizationThreshold": 100000,
            "db.demo.index.byte-array-manualIndex.entryPointSize": 64,
            "db.demo.index.byte-array-manualIndex.items": 11,
            "db.demo.index.byte-array-manualIndex.maxUpdateBeforeSave": 5000,
            "db.demo.index.byte-array-manualIndex.optimizationThreshold": 100000,
            "db.demo.index.byteArrayKeyIndex.entryPointSize": 64,
            "db.demo.index.byteArrayKeyIndex.items": 2,
            "db.demo.index.byteArrayKeyIndex.maxUpdateBeforeSave": 5000,
            "db.demo.index.byteArrayKeyIndex.optimizationThreshold": 100000,
            "db.demo.index.classIndexManagerComposite.entryPointSize": 64,
            "db.demo.index.classIndexManagerComposite.items": 0,
            "db.demo.index.classIndexManagerComposite.maxUpdateBeforeSave": 5000,
            "db.demo.index.classIndexManagerComposite.optimizationThreshold": 100000,
            "db.demo.index.classIndexManagerTestClass.prop1.entryPointSize": 64,
            "db.demo.index.classIndexManagerTestClass.prop1.items": 0,
            "db.demo.index.classIndexManagerTestClass.prop1.maxUpdateBeforeSave": 5000,
            "db.demo.index.classIndexManagerTestClass.prop1.optimizationThreshold": 100000,
            "db.demo.index.classIndexManagerTestClass.prop2.entryPointSize": 64,
            "db.demo.index.classIndexManagerTestClass.prop2.items": 0,
            "db.demo.index.classIndexManagerTestClass.prop2.maxUpdateBeforeSave": 5000,
            "db.demo.index.classIndexManagerTestClass.prop2.optimizationThreshold": 100000,
            "db.demo.index.classIndexManagerTestClass.prop4.entryPointSize": 64,
            "db.demo.index.classIndexManagerTestClass.prop4.items": 0,
            "db.demo.index.classIndexManagerTestClass.prop4.maxUpdateBeforeSave": 5000,
            "db.demo.index.classIndexManagerTestClass.prop4.optimizationThreshold": 100000,
            "db.demo.index.classIndexManagerTestClass.prop6.entryPointSize": 64,
            "db.demo.index.classIndexManagerTestClass.prop6.items": 0,
            "db.demo.index.classIndexManagerTestClass.prop6.maxUpdateBeforeSave": 5000,
            "db.demo.index.classIndexManagerTestClass.prop6.optimizationThreshold": 100000,
            "db.demo.index.classIndexManagerTestIndexByKey.entryPointSize": 64,
            "db.demo.index.classIndexManagerTestIndexByKey.items": 0,
            "db.demo.index.classIndexManagerTestIndexByKey.maxUpdateBeforeSave": 5000,
            "db.demo.index.classIndexManagerTestIndexByKey.optimizationThreshold": 100000,
            "db.demo.index.classIndexManagerTestIndexByValue.entryPointSize": 64,
            "db.demo.index.classIndexManagerTestIndexByValue.items": 0,
            "db.demo.index.classIndexManagerTestIndexByValue.maxUpdateBeforeSave": 5000,
            "db.demo.index.classIndexManagerTestIndexByValue.optimizationThreshold": 100000,
            "db.demo.index.classIndexManagerTestIndexValueAndCollection.entryPointSize": 64,
            "db.demo.index.classIndexManagerTestIndexValueAndCollection.items": 0,
            "db.demo.index.classIndexManagerTestIndexValueAndCollection.maxUpdateBeforeSave": 5000,
            "db.demo.index.classIndexManagerTestIndexValueAndCollection.optimizationThreshold": 100000,
            "db.demo.index.classIndexManagerTestSuperClass.prop0.entryPointSize": 64,
            "db.demo.index.classIndexManagerTestSuperClass.prop0.items": 0,
            "db.demo.index.classIndexManagerTestSuperClass.prop0.maxUpdateBeforeSave": 5000,
            "db.demo.index.classIndexManagerTestSuperClass.prop0.optimizationThreshold": 100000,
            "db.demo.index.compositeByteArrayKey.entryPointSize": 64,
            "db.demo.index.compositeByteArrayKey.items": 4,
            "db.demo.index.compositeByteArrayKey.maxUpdateBeforeSave": 5000,
            "db.demo.index.compositeByteArrayKey.optimizationThreshold": 100000,
            "db.demo.index.compositeIndexWithoutSchema.entryPointSize": 64,
            "db.demo.index.compositeIndexWithoutSchema.items": 0,
            "db.demo.index.compositeIndexWithoutSchema.maxUpdateBeforeSave": 5000,
            "db.demo.index.compositeIndexWithoutSchema.optimizationThreshold": 100000,
            "db.demo.index.compositeone.entryPointSize": 64,
            "db.demo.index.compositeone.items": 0,
            "db.demo.index.compositeone.maxUpdateBeforeSave": 5000,
            "db.demo.index.compositeone.optimizationThreshold": 100000,
            "db.demo.index.compositetwo.entryPointSize": 64,
            "db.demo.index.compositetwo.items": 0,
            "db.demo.index.compositetwo.maxUpdateBeforeSave": 5000,
            "db.demo.index.compositetwo.optimizationThreshold": 100000,
            "db.demo.index.curotorCompositeIndex.entryPointSize": 64,
            "db.demo.index.curotorCompositeIndex.items": 0,
            "db.demo.index.curotorCompositeIndex.maxUpdateBeforeSave": 5000,
            "db.demo.index.curotorCompositeIndex.optimizationThreshold": 100000,
            "db.demo.index.dictionary.entryPointSize": 64,
            "db.demo.index.dictionary.items": 2,
            "db.demo.index.dictionary.maxUpdateBeforeSave": 5000,
            "db.demo.index.dictionary.optimizationThreshold": 100000,
            "db.demo.index.diplomaThesisUnique.entryPointSize": 64,
            "db.demo.index.diplomaThesisUnique.items": 3,
            "db.demo.index.diplomaThesisUnique.maxUpdateBeforeSave": 5000,
            "db.demo.index.diplomaThesisUnique.optimizationThreshold": 100000,
            "db.demo.index.equalityIdx.entryPointSize": 64,
            "db.demo.index.equalityIdx.items": 0,
            "db.demo.index.equalityIdx.maxUpdateBeforeSave": 5000,
            "db.demo.index.equalityIdx.optimizationThreshold": 100000,
            "db.demo.index.idx.entryPointSize": 64,
            "db.demo.index.idx.items": 2,
            "db.demo.index.idx.maxUpdateBeforeSave": 5000,
            "db.demo.index.idx.optimizationThreshold": 100000,
            "db.demo.index.idxTerm.entryPointSize": 64,
            "db.demo.index.idxTerm.items": 1,
            "db.demo.index.idxTerm.maxUpdateBeforeSave": 5000,
            "db.demo.index.idxTerm.optimizationThreshold": 100000,
            "db.demo.index.idxTransactionUniqueIndexTest.entryPointSize": 64,
            "db.demo.index.idxTransactionUniqueIndexTest.items": 1,
            "db.demo.index.idxTransactionUniqueIndexTest.maxUpdateBeforeSave": 5000,
            "db.demo.index.idxTransactionUniqueIndexTest.optimizationThreshold": 100000,
            "db.demo.index.idxTxAwareMultiValueGetEntriesTest.entryPointSize": 64,
            "db.demo.index.idxTxAwareMultiValueGetEntriesTest.items": 0,
            "db.demo.index.idxTxAwareMultiValueGetEntriesTest.maxUpdateBeforeSave": 5000,
            "db.demo.index.idxTxAwareMultiValueGetEntriesTest.optimizationThreshold": 100000,
            "db.demo.index.idxTxAwareMultiValueGetTest.entryPointSize": 64,
            "db.demo.index.idxTxAwareMultiValueGetTest.items": 0,
            "db.demo.index.idxTxAwareMultiValueGetTest.maxUpdateBeforeSave": 5000,
            "db.demo.index.idxTxAwareMultiValueGetTest.optimizationThreshold": 100000,
            "db.demo.index.idxTxAwareMultiValueGetValuesTest.entryPointSize": 64,
            "db.demo.index.idxTxAwareMultiValueGetValuesTest.items": 0,
            "db.demo.index.idxTxAwareMultiValueGetValuesTest.maxUpdateBeforeSave": 5000,
            "db.demo.index.idxTxAwareMultiValueGetValuesTest.optimizationThreshold": 100000,
            "db.demo.index.idxTxAwareOneValueGetEntriesTest.entryPointSize": 64,
            "db.demo.index.idxTxAwareOneValueGetEntriesTest.items": 0,
            "db.demo.index.idxTxAwareOneValueGetEntriesTest.maxUpdateBeforeSave": 5000,
            "db.demo.index.idxTxAwareOneValueGetEntriesTest.optimizationThreshold": 100000,
            "db.demo.index.idxTxAwareOneValueGetTest.entryPointSize": 64,
            "db.demo.index.idxTxAwareOneValueGetTest.items": 0,
            "db.demo.index.idxTxAwareOneValueGetTest.maxUpdateBeforeSave": 5000,
            "db.demo.index.idxTxAwareOneValueGetTest.optimizationThreshold": 100000,
            "db.demo.index.idxTxAwareOneValueGetValuesTest.entryPointSize": 64,
            "db.demo.index.idxTxAwareOneValueGetValuesTest.items": 0,
            "db.demo.index.idxTxAwareOneValueGetValuesTest.maxUpdateBeforeSave": 5000,
            "db.demo.index.idxTxAwareOneValueGetValuesTest.optimizationThreshold": 100000,
            "db.demo.index.inIdx.entryPointSize": 64,
            "db.demo.index.inIdx.items": 0,
            "db.demo.index.inIdx.maxUpdateBeforeSave": 5000,
            "db.demo.index.inIdx.optimizationThreshold": 100000,
            "db.demo.index.indexForMap.entryPointSize": 64,
            "db.demo.index.indexForMap.items": 0,
            "db.demo.index.indexForMap.maxUpdateBeforeSave": 5000,
            "db.demo.index.indexForMap.optimizationThreshold": 100000,
            "db.demo.index.indexWithoutSchema.entryPointSize": 64,
            "db.demo.index.indexWithoutSchema.items": 0,
            "db.demo.index.indexWithoutSchema.maxUpdateBeforeSave": 5000,
            "db.demo.index.indexWithoutSchema.optimizationThreshold": 100000,
            "db.demo.index.indexfive.entryPointSize": 64,
            "db.demo.index.indexfive.items": 0,
            "db.demo.index.indexfive.maxUpdateBeforeSave": 5000,
            "db.demo.index.indexfive.optimizationThreshold": 100000,
            "db.demo.index.indexfour.entryPointSize": 64,
            "db.demo.index.indexfour.items": 0,
            "db.demo.index.indexfour.maxUpdateBeforeSave": 5000,
            "db.demo.index.indexfour.optimizationThreshold": 100000,
            "db.demo.index.indexone.entryPointSize": 64,
            "db.demo.index.indexone.items": 0,
            "db.demo.index.indexone.maxUpdateBeforeSave": 5000,
            "db.demo.index.indexone.optimizationThreshold": 100000,
            "db.demo.index.indexsix.entryPointSize": 64,
            "db.demo.index.indexsix.items": 0,
            "db.demo.index.indexsix.maxUpdateBeforeSave": 5000,
            "db.demo.index.indexsix.optimizationThreshold": 100000,
            "db.demo.index.indexthree.entryPointSize": 64,
            "db.demo.index.indexthree.items": 0,
            "db.demo.index.indexthree.maxUpdateBeforeSave": 5000,
            "db.demo.index.indexthree.optimizationThreshold": 100000,
            "db.demo.index.indextwo.entryPointSize": 64,
            "db.demo.index.indextwo.items": 0,
            "db.demo.index.indextwo.maxUpdateBeforeSave": 5000,
            "db.demo.index.indextwo.optimizationThreshold": 100000,
            "db.demo.index.linkCollectionIndex.entryPointSize": 64,
            "db.demo.index.linkCollectionIndex.items": 0,
            "db.demo.index.linkCollectionIndex.maxUpdateBeforeSave": 5000,
            "db.demo.index.linkCollectionIndex.optimizationThreshold": 100000,
            "db.demo.index.lpirtCurator.name.entryPointSize": 64,
            "db.demo.index.lpirtCurator.name.items": 0,
            "db.demo.index.lpirtCurator.name.maxUpdateBeforeSave": 5000,
            "db.demo.index.lpirtCurator.name.optimizationThreshold": 100000,
            "db.demo.index.lpirtCurator.salary.entryPointSize": 64,
            "db.demo.index.lpirtCurator.salary.items": 0,
            "db.demo.index.lpirtCurator.salary.maxUpdateBeforeSave": 5000,
            "db.demo.index.lpirtCurator.salary.optimizationThreshold": 100000,
            "db.demo.index.lpirtDiploma.GPA.entryPointSize": 64,
            "db.demo.index.lpirtDiploma.GPA.items": 3,
            "db.demo.index.lpirtDiploma.GPA.maxUpdateBeforeSave": 5000,
            "db.demo.index.lpirtDiploma.GPA.optimizationThreshold": 100000,
            "db.demo.index.lpirtDiploma.thesis.entryPointSize": 64,
            "db.demo.index.lpirtDiploma.thesis.items": 54,
            "db.demo.index.lpirtDiploma.thesis.maxUpdateBeforeSave": 5000,
            "db.demo.index.lpirtDiploma.thesis.optimizationThreshold": 100000,
            "db.demo.index.lpirtGroup.curator.entryPointSize": 64,
            "db.demo.index.lpirtGroup.curator.items": 0,
            "db.demo.index.lpirtGroup.curator.maxUpdateBeforeSave": 5000,
            "db.demo.index.lpirtGroup.curator.optimizationThreshold": 100000,
            "db.demo.index.lpirtGroup.name.entryPointSize": 64,
            "db.demo.index.lpirtGroup.name.items": 0,
            "db.demo.index.lpirtGroup.name.maxUpdateBeforeSave": 5000,
            "db.demo.index.lpirtGroup.name.optimizationThreshold": 100000,
            "db.demo.index.lpirtStudent.group.entryPointSize": 64,
            "db.demo.index.lpirtStudent.group.items": 0,
            "db.demo.index.lpirtStudent.group.maxUpdateBeforeSave": 5000,
            "db.demo.index.lpirtStudent.group.optimizationThreshold": 100000,
            "db.demo.index.lpirtStudent.name.entryPointSize": 64,
            "db.demo.index.lpirtStudent.name.items": 0,
            "db.demo.index.lpirtStudent.name.maxUpdateBeforeSave": 5000,
            "db.demo.index.lpirtStudent.name.optimizationThreshold": 100000,
            "db.demo.index.manualTxIndexTest.entryPointSize": 64,
            "db.demo.index.manualTxIndexTest.items": 1,
            "db.demo.index.manualTxIndexTest.maxUpdateBeforeSave": 5000,
            "db.demo.index.manualTxIndexTest.optimizationThreshold": 100000,
            "db.demo.index.mapIndexTestKey.entryPointSize": 64,
            "db.demo.index.mapIndexTestKey.items": 0,
            "db.demo.index.mapIndexTestKey.maxUpdateBeforeSave": 5000,
            "db.demo.index.mapIndexTestKey.optimizationThreshold": 100000,
            "db.demo.index.mapIndexTestValue.entryPointSize": 64,
            "db.demo.index.mapIndexTestValue.items": 0,
            "db.demo.index.mapIndexTestValue.maxUpdateBeforeSave": 5000,
            "db.demo.index.mapIndexTestValue.optimizationThreshold": 100000,
            "db.demo.index.newV.f_int.entryPointSize": 64,
            "db.demo.index.newV.f_int.items": 3,
            "db.demo.index.newV.f_int.maxUpdateBeforeSave": 5000,
            "db.demo.index.newV.f_int.optimizationThreshold": 100000,
            "db.demo.index.nullkey.entryPointSize": 64,
            "db.demo.index.nullkey.items": 0,
            "db.demo.index.nullkey.maxUpdateBeforeSave": 5000,
            "db.demo.index.nullkey.optimizationThreshold": 100000,
            "db.demo.index.nullkeytwo.entryPointSize": 64,
            "db.demo.index.nullkeytwo.items": 0,
            "db.demo.index.nullkeytwo.maxUpdateBeforeSave": 5000,
            "db.demo.index.nullkeytwo.optimizationThreshold": 100000,
            "db.demo.index.propOne1.entryPointSize": 64,
            "db.demo.index.propOne1.items": 0,
            "db.demo.index.propOne1.maxUpdateBeforeSave": 5000,
            "db.demo.index.propOne1.optimizationThreshold": 100000,
            "db.demo.index.propOne2.entryPointSize": 64,
            "db.demo.index.propOne2.items": 0,
            "db.demo.index.propOne2.maxUpdateBeforeSave": 5000,
            "db.demo.index.propOne2.optimizationThreshold": 100000,
            "db.demo.index.propOne3.entryPointSize": 64,
            "db.demo.index.propOne3.items": 0,
            "db.demo.index.propOne3.maxUpdateBeforeSave": 5000,
            "db.demo.index.propOne3.optimizationThreshold": 100000,
            "db.demo.index.propOne4.entryPointSize": 64,
            "db.demo.index.propOne4.items": 0,
            "db.demo.index.propOne4.maxUpdateBeforeSave": 5000,
            "db.demo.index.propOne4.optimizationThreshold": 100000,
            "db.demo.index.propertyone.entryPointSize": 64,
            "db.demo.index.propertyone.items": 0,
            "db.demo.index.propertyone.maxUpdateBeforeSave": 5000,
            "db.demo.index.propertyone.optimizationThreshold": 100000,
            "db.demo.index.simplekey.entryPointSize": 64,
            "db.demo.index.simplekey.items": 0,
            "db.demo.index.simplekey.maxUpdateBeforeSave": 5000,
            "db.demo.index.simplekey.optimizationThreshold": 100000,
            "db.demo.index.simplekeytwo.entryPointSize": 64,
            "db.demo.index.simplekeytwo.items": 0,
            "db.demo.index.simplekeytwo.maxUpdateBeforeSave": 5000,
            "db.demo.index.simplekeytwo.optimizationThreshold": 100000,
            "db.demo.index.sqlCreateIndexCompositeIndex.entryPointSize": 64,
            "db.demo.index.sqlCreateIndexCompositeIndex.items": 0,
            "db.demo.index.sqlCreateIndexCompositeIndex.maxUpdateBeforeSave": 5000,
            "db.demo.index.sqlCreateIndexCompositeIndex.optimizationThreshold": 100000,
            "db.demo.index.sqlCreateIndexCompositeIndex2.entryPointSize": 64,
            "db.demo.index.sqlCreateIndexCompositeIndex2.items": 0,
            "db.demo.index.sqlCreateIndexCompositeIndex2.maxUpdateBeforeSave": 5000,
            "db.demo.index.sqlCreateIndexCompositeIndex2.optimizationThreshold": 100000,
            "db.demo.index.sqlCreateIndexEmbeddedListIndex.entryPointSize": 64,
            "db.demo.index.sqlCreateIndexEmbeddedListIndex.items": 0,
            "db.demo.index.sqlCreateIndexEmbeddedListIndex.maxUpdateBeforeSave": 5000,
            "db.demo.index.sqlCreateIndexEmbeddedListIndex.optimizationThreshold": 100000,
            "db.demo.index.sqlCreateIndexEmbeddedMapByKeyIndex.entryPointSize": 64,
            "db.demo.index.sqlCreateIndexEmbeddedMapByKeyIndex.items": 0,
            "db.demo.index.sqlCreateIndexEmbeddedMapByKeyIndex.maxUpdateBeforeSave": 5000,
            "db.demo.index.sqlCreateIndexEmbeddedMapByKeyIndex.optimizationThreshold": 100000,
            "db.demo.index.sqlCreateIndexEmbeddedMapByValueIndex.entryPointSize": 64,
            "db.demo.index.sqlCreateIndexEmbeddedMapByValueIndex.items": 0,
            "db.demo.index.sqlCreateIndexEmbeddedMapByValueIndex.maxUpdateBeforeSave": 5000,
            "db.demo.index.sqlCreateIndexEmbeddedMapByValueIndex.optimizationThreshold": 100000,
            "db.demo.index.sqlCreateIndexEmbeddedMapIndex.entryPointSize": 64,
            "db.demo.index.sqlCreateIndexEmbeddedMapIndex.items": 0,
            "db.demo.index.sqlCreateIndexEmbeddedMapIndex.maxUpdateBeforeSave": 5000,
            "db.demo.index.sqlCreateIndexEmbeddedMapIndex.optimizationThreshold": 100000,
            "db.demo.index.sqlCreateIndexTestClass.prop1.entryPointSize": 64,
            "db.demo.index.sqlCreateIndexTestClass.prop1.items": 0,
            "db.demo.index.sqlCreateIndexTestClass.prop1.maxUpdateBeforeSave": 5000,
            "db.demo.index.sqlCreateIndexTestClass.prop1.optimizationThreshold": 100000,
            "db.demo.index.sqlCreateIndexTestClass.prop3.entryPointSize": 64,
            "db.demo.index.sqlCreateIndexTestClass.prop3.items": 0,
            "db.demo.index.sqlCreateIndexTestClass.prop3.maxUpdateBeforeSave": 5000,
            "db.demo.index.sqlCreateIndexTestClass.prop3.optimizationThreshold": 100000,
            "db.demo.index.sqlCreateIndexTestClass.prop5.entryPointSize": 64,
            "db.demo.index.sqlCreateIndexTestClass.prop5.items": 0,
            "db.demo.index.sqlCreateIndexTestClass.prop5.maxUpdateBeforeSave": 5000,
            "db.demo.index.sqlCreateIndexTestClass.prop5.optimizationThreshold": 100000,
            "db.demo.index.sqlCreateIndexWithoutClass.entryPointSize": 64,
            "db.demo.index.sqlCreateIndexWithoutClass.items": 0,
            "db.demo.index.sqlCreateIndexWithoutClass.maxUpdateBeforeSave": 5000,
            "db.demo.index.sqlCreateIndexWithoutClass.optimizationThreshold": 100000,
            "db.demo.index.sqlSelectIndexReuseTestEmbeddedList.entryPointSize": 64,
            "db.demo.index.sqlSelectIndexReuseTestEmbeddedList.items": 0,
            "db.demo.index.sqlSelectIndexReuseTestEmbeddedList.maxUpdateBeforeSave": 5000,
            "db.demo.index.sqlSelectIndexReuseTestEmbeddedList.optimizationThreshold": 100000,
            "db.demo.index.sqlSelectIndexReuseTestEmbeddedListTwoProp8.entryPointSize": 64,
            "db.demo.index.sqlSelectIndexReuseTestEmbeddedListTwoProp8.items": 0,
            "db.demo.index.sqlSelectIndexReuseTestEmbeddedListTwoProp8.maxUpdateBeforeSave": 5000,
            "db.demo.index.sqlSelectIndexReuseTestEmbeddedListTwoProp8.optimizationThreshold": 100000,
            "db.demo.index.sqlSelectIndexReuseTestEmbeddedMapByKey.entryPointSize": 64,
            "db.demo.index.sqlSelectIndexReuseTestEmbeddedMapByKey.items": 0,
            "db.demo.index.sqlSelectIndexReuseTestEmbeddedMapByKey.maxUpdateBeforeSave": 5000,
            "db.demo.index.sqlSelectIndexReuseTestEmbeddedMapByKey.optimizationThreshold": 100000,
            "db.demo.index.sqlSelectIndexReuseTestEmbeddedMapByKeyProp8.entryPointSize": 64,
            "db.demo.index.sqlSelectIndexReuseTestEmbeddedMapByKeyProp8.items": 0,
            "db.demo.index.sqlSelectIndexReuseTestEmbeddedMapByKeyProp8.maxUpdateBeforeSave": 5000,
            "db.demo.index.sqlSelectIndexReuseTestEmbeddedMapByKeyProp8.optimizationThreshold": 100000,
            "db.demo.index.sqlSelectIndexReuseTestEmbeddedMapByValue.entryPointSize": 64,
            "db.demo.index.sqlSelectIndexReuseTestEmbeddedMapByValue.items": 0,
            "db.demo.index.sqlSelectIndexReuseTestEmbeddedMapByValue.maxUpdateBeforeSave": 5000,
            "db.demo.index.sqlSelectIndexReuseTestEmbeddedMapByValue.optimizationThreshold": 100000,
            "db.demo.index.sqlSelectIndexReuseTestEmbeddedMapByValueProp8.entryPointSize": 64,
            "db.demo.index.sqlSelectIndexReuseTestEmbeddedMapByValueProp8.items": 0,
            "db.demo.index.sqlSelectIndexReuseTestEmbeddedMapByValueProp8.maxUpdateBeforeSave": 5000,
            "db.demo.index.sqlSelectIndexReuseTestEmbeddedMapByValueProp8.optimizationThreshold": 100000,
            "db.demo.index.sqlSelectIndexReuseTestEmbeddedSetProp8.entryPointSize": 64,
            "db.demo.index.sqlSelectIndexReuseTestEmbeddedSetProp8.items": 0,
            "db.demo.index.sqlSelectIndexReuseTestEmbeddedSetProp8.maxUpdateBeforeSave": 5000,
            "db.demo.index.sqlSelectIndexReuseTestEmbeddedSetProp8.optimizationThreshold": 100000,
            "db.demo.index.sqlSelectIndexReuseTestProp9EmbeddedSetProp8.entryPointSize": 64,
            "db.demo.index.sqlSelectIndexReuseTestProp9EmbeddedSetProp8.items": 0,
            "db.demo.index.sqlSelectIndexReuseTestProp9EmbeddedSetProp8.maxUpdateBeforeSave": 5000,
            "db.demo.index.sqlSelectIndexReuseTestProp9EmbeddedSetProp8.optimizationThreshold": 100000,
            "db.demo.index.studentDiplomaAndNameIndex.entryPointSize": 64,
            "db.demo.index.studentDiplomaAndNameIndex.items": 0,
            "db.demo.index.studentDiplomaAndNameIndex.maxUpdateBeforeSave": 5000,
            "db.demo.index.studentDiplomaAndNameIndex.optimizationThreshold": 100000,
            "db.demo.index.testIdx.entryPointSize": 64,
            "db.demo.index.testIdx.items": 1,
            "db.demo.index.testIdx.maxUpdateBeforeSave": 5000,
            "db.demo.index.testIdx.optimizationThreshold": 100000,
            "db.demo.index.test_class_by_data.entryPointSize": 64,
            "db.demo.index.test_class_by_data.items": 0,
            "db.demo.index.test_class_by_data.maxUpdateBeforeSave": 5000,
            "db.demo.index.test_class_by_data.optimizationThreshold": 100000,
            "db.demo.index.twoclassproperty.entryPointSize": 64,
            "db.demo.index.twoclassproperty.items": 0,
            "db.demo.index.twoclassproperty.maxUpdateBeforeSave": 5000,
            "db.demo.index.twoclassproperty.optimizationThreshold": 100000,
            "db.demo.index.vertexA_name_idx.entryPointSize": 64,
            "db.demo.index.vertexA_name_idx.items": 2,
            "db.demo.index.vertexA_name_idx.maxUpdateBeforeSave": 5000,
            "db.demo.index.vertexA_name_idx.optimizationThreshold": 100000,
            "db.demo.index.vertexB_name_idx.entryPointSize": 64,
            "db.demo.index.vertexB_name_idx.items": 2,
            "db.demo.index.vertexB_name_idx.maxUpdateBeforeSave": 5000,
            "db.demo.index.vertexB_name_idx.optimizationThreshold": 100000,
            "db.subTest.cache.level1.current": 0,
            "db.subTest.cache.level1.enabled": false,
            "db.subTest.cache.level1.max": -1,
            "db.subTest.cache.level2.current": 0,
            "db.subTest.cache.level2.enabled": false,
            "db.subTest.cache.level2.max": -1,
            "db.subTest.data.holeSize": 0,
            "db.subTest.data.holes": 0,
            "db.subTest.index.dictionary.entryPointSize": 64,
            "db.subTest.index.dictionary.items": 0,
            "db.subTest.index.dictionary.maxUpdateBeforeSave": 5000,
            "db.subTest.index.dictionary.optimizationThreshold": 100000,
            "db.temp.cache.level1.current": 0,
            "db.temp.cache.level1.enabled": false,
            "db.temp.cache.level1.max": -1,
            "db.temp.cache.level2.current": 3,
            "db.temp.cache.level2.enabled": true,
            "db.temp.cache.level2.max": -1,
            "db.temp.index.dictionary.entryPointSize": 64,
            "db.temp.index.dictionary.items": 0,
            "db.temp.index.dictionary.maxUpdateBeforeSave": 5000,
            "db.temp.index.dictionary.optimizationThreshold": 100000,
            "process.network.channel.binary./0:0:0:0:0:0:0:1:451822480.flushes": 0,
            "process.network.channel.binary./0:0:0:0:0:0:0:1:451822480.receivedBytes": 513,
            "process.network.channel.binary./0:0:0:0:0:0:0:1:451822480.transmittedBytes": 0,
            "process.network.channel.binary./127.0.0.1:451282424.flushes": 3,
            "process.network.channel.binary./127.0.0.1:451282424.receivedBytes": 98,
            "process.network.channel.binary./127.0.0.1:451282424.transmittedBytes": 16,
            "process.network.channel.binary./127.0.0.1:451292424.flushes": 3,
            "process.network.channel.binary./127.0.0.1:451292424.receivedBytes": 72,
            "process.network.channel.binary./127.0.0.1:451292424.transmittedBytes": 17,
            "process.network.channel.binary./127.0.0.1:451352424.flushes": 3,
            "process.network.channel.binary./127.0.0.1:451352424.receivedBytes": 79,
            "process.network.channel.binary./127.0.0.1:451352424.transmittedBytes": 134,
            "process.network.channel.binary./127.0.0.1:451362424.flushes": 3,
            "process.network.channel.binary./127.0.0.1:451362424.receivedBytes": 105,
            "process.network.channel.binary./127.0.0.1:451362424.transmittedBytes": 16,
            "process.network.channel.binary./127.0.0.1:451382424.flushes": 3,
            "process.network.channel.binary./127.0.0.1:451382424.receivedBytes": 79,
            "process.network.channel.binary./127.0.0.1:451382424.transmittedBytes": 16,
            "process.network.channel.binary./127.0.0.1:451392424.flushes": 3,
            "process.network.channel.binary./127.0.0.1:451392424.receivedBytes": 79,
            "process.network.channel.binary./127.0.0.1:451392424.transmittedBytes": 134,
            "process.network.channel.binary./127.0.0.1:451402424.flushes": 3,
            "process.network.channel.binary./127.0.0.1:451402424.receivedBytes": 105,
            "process.network.channel.binary./127.0.0.1:451402424.transmittedBytes": 16,
            "process.network.channel.binary./127.0.0.1:451422424.flushes": 3,
            "process.network.channel.binary./127.0.0.1:451422424.receivedBytes": 79,
            "process.network.channel.binary./127.0.0.1:451422424.transmittedBytes": 16,
            "process.network.channel.binary./127.0.0.1:451432424.flushes": 3,
            "process.network.channel.binary./127.0.0.1:451432424.receivedBytes": 72,
            "process.network.channel.binary./127.0.0.1:451432424.transmittedBytes": 127,
            "process.network.channel.binary./127.0.0.1:451442424.flushes": 3,
            "process.network.channel.binary./127.0.0.1:451442424.receivedBytes": 98,
            "process.network.channel.binary./127.0.0.1:451442424.transmittedBytes": 16,
            "process.network.channel.binary./127.0.0.1:451452424.flushes": 3,
            "process.network.channel.binary./127.0.0.1:451452424.receivedBytes": 72,
            "process.network.channel.binary./127.0.0.1:451452424.transmittedBytes": 17,
            "process.network.channel.binary./127.0.0.1:451462424.flushes": 7,
            "process.network.channel.binary./127.0.0.1:451462424.receivedBytes": 194,
            "process.network.channel.binary./127.0.0.1:451462424.transmittedBytes": 2606,
            "process.network.channel.binary./127.0.0.1:451472424.flushes": 3,
            "process.network.channel.binary./127.0.0.1:451472424.receivedBytes": 72,
            "process.network.channel.binary./127.0.0.1:451472424.transmittedBytes": 127,
            "process.network.channel.binary./127.0.0.1:451482424.flushes": 3,
            "process.network.channel.binary./127.0.0.1:451482424.receivedBytes": 98,
            "process.network.channel.binary./127.0.0.1:451482424.transmittedBytes": 16,
            "process.network.channel.binary./127.0.0.1:451492424.flushes": 3,
            "process.network.channel.binary./127.0.0.1:451492424.receivedBytes": 72,
            "process.network.channel.binary./127.0.0.1:451492424.transmittedBytes": 17,
            "process.network.channel.binary./127.0.0.1:451502424.flushes": 7,
            "process.network.channel.binary./127.0.0.1:451502424.receivedBytes": 194,
            "process.network.channel.binary./127.0.0.1:451502424.transmittedBytes": 2606,
            "process.network.channel.binary./127.0.0.1:451512424.flushes": 3,
            "process.network.channel.binary./127.0.0.1:451512424.receivedBytes": 72,
            "process.network.channel.binary./127.0.0.1:451512424.transmittedBytes": 127,
            "process.network.channel.binary./127.0.0.1:451522424.flushes": 3,
            "process.network.channel.binary./127.0.0.1:451522424.receivedBytes": 98,
            "process.network.channel.binary./127.0.0.1:451522424.transmittedBytes": 16,
            "process.network.channel.binary./127.0.0.1:451532424.flushes": 3,
            "process.network.channel.binary./127.0.0.1:451532424.receivedBytes": 72,
            "process.network.channel.binary./127.0.0.1:451532424.transmittedBytes": 17,
            "process.network.channel.binary./127.0.0.1:451542424.flushes": 7,
            "process.network.channel.binary./127.0.0.1:451542424.receivedBytes": 194,
            "process.network.channel.binary./127.0.0.1:451542424.transmittedBytes": 2606,
            "process.network.channel.binary./127.0.0.1:451552424.flushes": 3,
            "process.network.channel.binary./127.0.0.1:451552424.receivedBytes": 72,
            "process.network.channel.binary./127.0.0.1:451552424.transmittedBytes": 17,
            "process.network.channel.binary./127.0.0.1:451562424.flushes": 3,
            "process.network.channel.binary./127.0.0.1:451562424.receivedBytes": 72,
            "process.network.channel.binary./127.0.0.1:451562424.transmittedBytes": 16,
            "process.network.channel.binary./127.0.0.1:451572424.flushes": 3,
            "process.network.channel.binary./127.0.0.1:451572424.receivedBytes": 72,
            "process.network.channel.binary./127.0.0.1:451572424.transmittedBytes": 17,
            "process.network.channel.binary./127.0.0.1:451582424.flushes": 3,
            "process.network.channel.binary./127.0.0.1:451582424.receivedBytes": 72,
            "process.network.channel.binary./127.0.0.1:451582424.transmittedBytes": 17,
            "process.network.channel.binary./127.0.0.1:451592424.flushes": 3,
            "process.network.channel.binary./127.0.0.1:451592424.receivedBytes": 72,
            "process.network.channel.binary./127.0.0.1:451592424.transmittedBytes": 16,
            "process.network.channel.binary./127.0.0.1:451602424.flushes": 3,
            "process.network.channel.binary./127.0.0.1:451602424.receivedBytes": 72,
            "process.network.channel.binary./127.0.0.1:451602424.transmittedBytes": 17,
            "process.network.channel.binary./127.0.0.1:451612424.flushes": 3,
            "process.network.channel.binary./127.0.0.1:451612424.receivedBytes": 72,
            "process.network.channel.binary./127.0.0.1:451612424.transmittedBytes": 17,
            "process.network.channel.binary./127.0.0.1:451622424.flushes": 3,
            "process.network.channel.binary./127.0.0.1:451622424.receivedBytes": 72,
            "process.network.channel.binary./127.0.0.1:451622424.transmittedBytes": 16,
            "process.network.channel.binary./127.0.0.1:451632424.flushes": 3,
            "process.network.channel.binary./127.0.0.1:451632424.receivedBytes": 72,
            "process.network.channel.binary./127.0.0.1:451632424.transmittedBytes": 17,
            "process.network.channel.binary./127.0.0.1:451642424.flushes": 3,
            "process.network.channel.binary./127.0.0.1:451642424.receivedBytes": 72,
            "process.network.channel.binary./127.0.0.1:451642424.transmittedBytes": 16,
            "process.network.channel.binary./127.0.0.1:451652424.flushes": 3,
            "process.network.channel.binary./127.0.0.1:451652424.receivedBytes": 98,
            "process.network.channel.binary./127.0.0.1:451652424.transmittedBytes": 16,
            "process.network.channel.binary./127.0.0.1:451672424.flushes": 3,
            "process.network.channel.binary./127.0.0.1:451672424.receivedBytes": 72,
            "process.network.channel.binary./127.0.0.1:451672424.transmittedBytes": 16,
            "process.network.channel.binary./127.0.0.1:451682424.flushes": 3,
            "process.network.channel.binary./127.0.0.1:451682424.receivedBytes": 98,
            "process.network.channel.binary./127.0.0.1:451682424.transmittedBytes": 16,
            "process.network.channel.binary./127.0.0.1:451692424.flushes": 3,
            "process.network.channel.binary./127.0.0.1:451692424.receivedBytes": 72,
            "process.network.channel.binary./127.0.0.1:451692424.transmittedBytes": 17,
            "process.network.channel.binary./127.0.0.1:451702424.flushes": 76545,
            "process.network.channel.binary./127.0.0.1:451702424.receivedBytes": 4937639,
            "process.network.channel.binary./127.0.0.1:451702424.transmittedBytes": 53391585,
            "process.network.channel.binary./127.0.0.1:451712424.flushes": 3,
            "process.network.channel.binary./127.0.0.1:451712424.receivedBytes": 72,
            "process.network.channel.binary./127.0.0.1:451712424.transmittedBytes": 17,
            "process.network.channel.binary./127.0.0.1:451762424.flushes": 16176,
            "process.network.channel.binary./127.0.0.1:451762424.receivedBytes": 435578,
            "process.network.channel.binary./127.0.0.1:451762424.transmittedBytes": 7744941,
            "process.network.channel.binary./127.0.0.1:451772424.flushes": 16181,
            "process.network.channel.binary./127.0.0.1:451772424.receivedBytes": 446949,
            "process.network.channel.binary./127.0.0.1:451772424.transmittedBytes": 7932617,
            "process.network.channel.binary./127.0.0.1:451782424.flushes": 16103,
            "process.network.channel.binary./127.0.0.1:451782424.receivedBytes": 437708,
            "process.network.channel.binary./127.0.0.1:451782424.transmittedBytes": 7192022,
            "process.network.channel.binary./127.0.0.1:451792424.flushes": 15663,
            "process.network.channel.binary./127.0.0.1:451792424.receivedBytes": 422013,
            "process.network.channel.binary./127.0.0.1:451792424.transmittedBytes": 1128841,
            "process.network.channel.binary.flushes": 140851,
            "process.network.channel.binary.receivedBytes": 6687263,
            "process.network.channel.binary.transmittedBytes": 77419866,
            "process.runtime.availableMemory": 311502288,
            "process.runtime.maxMemory": 939524096,
            "process.runtime.totalMemory": 442368000,
            "server.connections.actives": 101,
            "system.config.cpus": 8,
            "system.disk.C.freeSpace": 50445692928,
            "system.disk.C.totalSpace": 127928365056,
            "system.disk.C.usableSpace": 50445692928,
            "system.disk.D.freeSpace": 0,
            "system.disk.D.totalSpace": 0,
            "system.disk.D.usableSpace": 0,
            "system.disk.G.freeSpace": 12820815872,
            "system.disk.G.totalSpace": 500103213056,
            "system.disk.G.usableSpace": 12820815872,
            "system.file.mmap.mappedPages": 177,
            "system.file.mmap.nonPooledBufferUsed": 0,
            "system.file.mmap.pooledBufferCreated": 0,
            "system.file.mmap.pooledBufferUsed": 0,
            "system.file.mmap.reusedPages": 31698774,
            "system.memory.alerts": 0,
            "system.memory.stream.resize": 21154
        },
        "chronos": {
            "db.0$db.close": {
                "entries": 4,
                "last": 16,
                "min": 0,
                "max": 16,
                "average": 4,
                "total": 16
            },
            "db.0$db.create": {
                "entries": 1,
                "last": 13,
                "min": 13,
                "max": 13,
                "average": 13,
                "total": 13
            },
            "db.0$db.createRecord": {
                "entries": 10,
                "last": 1,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 6
            },
            "db.0$db.data.createHole": {
                "entries": 14,
                "last": 2,
                "min": 0,
                "max": 2,
                "average": 0,
                "total": 8
            },
            "db.0$db.data.findClosestHole": {
                "entries": 11,
                "last": 0,
                "min": 0,
                "max": 0,
                "average": 0,
                "total": 0
            },
            "db.0$db.data.move": {
                "entries": 6,
                "last": 1,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 3
            },
            "db.0$db.data.recycled.notFound": {
                "entries": 7,
                "last": 0,
                "min": 0,
                "max": 0,
                "average": 0,
                "total": 0
            },
            "db.0$db.data.recycled.partial": {
                "entries": 11,
                "last": 0,
                "min": 0,
                "max": 0,
                "average": 0,
                "total": 0
            },
            "db.0$db.data.updateHole": {
                "entries": 21,
                "last": 0,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 2
            },
            "db.0$db.delete": {
                "entries": 1,
                "last": 101,
                "min": 101,
                "max": 101,
                "average": 101,
                "total": 101
            },
            "db.0$db.metadata.load": {
                "entries": 3,
                "last": 0,
                "min": 0,
                "max": 0,
                "average": 0,
                "total": 0
            },
            "db.0$db.open": {
                "entries": 3,
                "last": 0,
                "min": 0,
                "max": 0,
                "average": 0,
                "total": 0
            },
            "db.0$db.readRecord": {
                "entries": 15,
                "last": 0,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 5
            },
            "db.0$db.updateRecord": {
                "entries": 18,
                "last": 2,
                "min": 0,
                "max": 2,
                "average": 0,
                "total": 9
            },
            "db.1$db.close": {
                "entries": 4,
                "last": 13,
                "min": 0,
                "max": 13,
                "average": 3,
                "total": 13
            },
            "db.1$db.create": {
                "entries": 1,
                "last": 15,
                "min": 15,
                "max": 15,
                "average": 15,
                "total": 15
            },
            "db.1$db.createRecord": {
                "entries": 10,
                "last": 1,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 5
            },
            "db.1$db.data.createHole": {
                "entries": 14,
                "last": 3,
                "min": 0,
                "max": 3,
                "average": 0,
                "total": 8
            },
            "db.1$db.data.findClosestHole": {
                "entries": 11,
                "last": 0,
                "min": 0,
                "max": 0,
                "average": 0,
                "total": 0
            },
            "db.1$db.data.move": {
                "entries": 6,
                "last": 0,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 3
            },
            "db.1$db.data.recycled.notFound": {
                "entries": 7,
                "last": 0,
                "min": 0,
                "max": 0,
                "average": 0,
                "total": 0
            },
            "db.1$db.data.recycled.partial": {
                "entries": 11,
                "last": 0,
                "min": 0,
                "max": 0,
                "average": 0,
                "total": 0
            },
            "db.1$db.data.updateHole": {
                "entries": 21,
                "last": 1,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 1
            },
            "db.1$db.delete": {
                "entries": 1,
                "last": 115,
                "min": 115,
                "max": 115,
                "average": 115,
                "total": 115
            },
            "db.1$db.metadata.load": {
                "entries": 3,
                "last": 0,
                "min": 0,
                "max": 0,
                "average": 0,
                "total": 0
            },
            "db.1$db.open": {
                "entries": 3,
                "last": 0,
                "min": 0,
                "max": 0,
                "average": 0,
                "total": 0
            },
            "db.1$db.readRecord": {
                "entries": 15,
                "last": 0,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 4
            },
            "db.1$db.updateRecord": {
                "entries": 18,
                "last": 3,
                "min": 0,
                "max": 3,
                "average": 0,
                "total": 7
            },
            "db.2$db.close": {
                "entries": 4,
                "last": 15,
                "min": 0,
                "max": 15,
                "average": 3,
                "total": 15
            },
            "db.2$db.create": {
                "entries": 1,
                "last": 17,
                "min": 17,
                "max": 17,
                "average": 17,
                "total": 17
            },
            "db.2$db.createRecord": {
                "entries": 10,
                "last": 1,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 5
            },
            "db.2$db.data.createHole": {
                "entries": 14,
                "last": 1,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 5
            },
            "db.2$db.data.findClosestHole": {
                "entries": 11,
                "last": 0,
                "min": 0,
                "max": 0,
                "average": 0,
                "total": 0
            },
            "db.2$db.data.move": {
                "entries": 6,
                "last": 0,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 1
            },
            "db.2$db.data.recycled.notFound": {
                "entries": 7,
                "last": 0,
                "min": 0,
                "max": 0,
                "average": 0,
                "total": 0
            },
            "db.2$db.data.recycled.partial": {
                "entries": 11,
                "last": 0,
                "min": 0,
                "max": 0,
                "average": 0,
                "total": 0
            },
            "db.2$db.data.updateHole": {
                "entries": 21,
                "last": 0,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 1
            },
            "db.2$db.delete": {
                "entries": 1,
                "last": 61,
                "min": 61,
                "max": 61,
                "average": 61,
                "total": 61
            },
            "db.2$db.metadata.load": {
                "entries": 3,
                "last": 0,
                "min": 0,
                "max": 0,
                "average": 0,
                "total": 0
            },
            "db.2$db.open": {
                "entries": 3,
                "last": 0,
                "min": 0,
                "max": 0,
                "average": 0,
                "total": 0
            },
            "db.2$db.readRecord": {
                "entries": 15,
                "last": 0,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 1
            },
            "db.2$db.updateRecord": {
                "entries": 18,
                "last": 1,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 5
            },
            "db.demo.close": {
                "entries": 1396,
                "last": 0,
                "min": 0,
                "max": 31,
                "average": 0,
                "total": 51
            },
            "db.demo.create": {
                "entries": 3,
                "last": 19,
                "min": 19,
                "max": 40,
                "average": 27,
                "total": 81
            },
            "db.demo.createRecord": {
                "entries": 35716,
                "last": 0,
                "min": 0,
                "max": 12,
                "average": 0,
                "total": 1187
            },
            "db.demo.data.createHole": {
                "entries": 58886,
                "last": 0,
                "min": 0,
                "max": 23,
                "average": 0,
                "total": 9822
            },
            "db.demo.data.findClosestHole": {
                "entries": 51022,
                "last": 0,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 181
            },
            "db.demo.data.move": {
                "entries": 1327946,
                "last": 0,
                "min": 0,
                "max": 16,
                "average": 0,
                "total": 4091
            },
            "db.demo.data.recycled.complete": {
                "entries": 24,
                "last": 0,
                "min": 0,
                "max": 0,
                "average": 0,
                "total": 0
            },
            "db.demo.data.recycled.notFound": {
                "entries": 16070,
                "last": 0,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 59
            },
            "db.demo.data.recycled.partial": {
                "entries": 57638,
                "last": 0,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 102
            },
            "db.demo.data.updateHole": {
                "entries": 108613,
                "last": 0,
                "min": 0,
                "max": 12,
                "average": 0,
                "total": 451
            },
            "db.demo.delete": {
                "entries": 2,
                "last": 61,
                "min": 61,
                "max": 124,
                "average": 92,
                "total": 185
            },
            "db.demo.deleteRecord": {
                "entries": 12362,
                "last": 0,
                "min": 0,
                "max": 24,
                "average": 0,
                "total": 4626
            },
            "db.demo.metadata.load": {
                "entries": 1423,
                "last": 0,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 49
            },
            "db.demo.open": {
                "entries": 1423,
                "last": 0,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 6
            },
            "db.demo.readRecord": {
                "entries": 476697,
                "last": 0,
                "min": 0,
                "max": 16,
                "average": 0,
                "total": 3071
            },
            "db.demo.synch": {
                "entries": 484,
                "last": 2,
                "min": 0,
                "max": 34,
                "average": 2,
                "total": 1251
            },
            "db.demo.updateRecord": {
                "entries": 180667,
                "last": 0,
                "min": 0,
                "max": 12,
                "average": 0,
                "total": 2343
            },
            "db.subTest.close": {
                "entries": 10,
                "last": 0,
                "min": 0,
                "max": 16,
                "average": 3,
                "total": 31
            },
            "db.subTest.create": {
                "entries": 2,
                "last": 44,
                "min": 18,
                "max": 44,
                "average": 31,
                "total": 62
            },
            "db.subTest.createRecord": {
                "entries": 20,
                "last": 1,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 11
            },
            "db.subTest.data.createHole": {
                "entries": 28,
                "last": 2,
                "min": 0,
                "max": 2,
                "average": 0,
                "total": 12
            },
            "db.subTest.data.findClosestHole": {
                "entries": 22,
                "last": 0,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 1
            },
            "db.subTest.data.move": {
                "entries": 12,
                "last": 0,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 4
            },
            "db.subTest.data.recycled.notFound": {
                "entries": 14,
                "last": 0,
                "min": 0,
                "max": 0,
                "average": 0,
                "total": 0
            },
            "db.subTest.data.recycled.partial": {
                "entries": 22,
                "last": 0,
                "min": 0,
                "max": 0,
                "average": 0,
                "total": 0
            },
            "db.subTest.data.updateHole": {
                "entries": 42,
                "last": 0,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 2
            },
            "db.subTest.delete": {
                "entries": 2,
                "last": 118,
                "min": 76,
                "max": 118,
                "average": 97,
                "total": 194
            },
            "db.subTest.metadata.load": {
                "entries": 6,
                "last": 0,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 1
            },
            "db.subTest.open": {
                "entries": 6,
                "last": 0,
                "min": 0,
                "max": 0,
                "average": 0,
                "total": 0
            },
            "db.subTest.readRecord": {
                "entries": 30,
                "last": 0,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 3
            },
            "db.subTest.updateRecord": {
                "entries": 36,
                "last": 2,
                "min": 0,
                "max": 2,
                "average": 0,
                "total": 16
            },
            "db.temp.createRecord": {
                "entries": 10,
                "last": 0,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 2
            },
            "db.temp.readRecord": {
                "entries": 7,
                "last": 0,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 1
            },
            "db.temp.updateRecord": {
                "entries": 21,
                "last": 0,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 2
            },
            "process.file.mmap.commitPages": {
                "entries": 2034,
                "last": 1,
                "min": 0,
                "max": 21,
                "average": 0,
                "total": 1048
            },
            "process.mvrbtree.clear": {
                "entries": 16007,
                "last": 0,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 141
            },
            "process.mvrbtree.commitChanges": {
                "entries": 165235,
                "last": 0,
                "min": 0,
                "max": 55,
                "average": 0,
                "total": 5730
            },
            "process.mvrbtree.entry.fromStream": {
                "entries": 5408,
                "last": 0,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 45
            },
            "process.mvrbtree.entry.toStream": {
                "entries": 60839,
                "last": 0,
                "min": 0,
                "max": 26,
                "average": 0,
                "total": 3013
            },
            "process.mvrbtree.fromStream": {
                "entries": 7424,
                "last": 0,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 54
            },
            "process.mvrbtree.get": {
                "entries": 97863,
                "last": 0,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 233
            },
            "process.mvrbtree.put": {
                "entries": 151070,
                "last": 0,
                "min": 0,
                "max": 55,
                "average": 0,
                "total": 5002
            },
            "process.mvrbtree.putAll": {
                "entries": 1847,
                "last": 0,
                "min": 0,
                "max": 8,
                "average": 0,
                "total": 84
            },
            "process.mvrbtree.remove": {
                "entries": 41000,
                "last": 0,
                "min": 0,
                "max": 10,
                "average": 0,
                "total": 2226
            },
            "process.mvrbtree.toStream": {
                "entries": 124870,
                "last": 0,
                "min": 0,
                "max": 6,
                "average": 0,
                "total": 543
            },
            "process.mvrbtree.unload": {
                "entries": 7424,
                "last": 0,
                "min": 0,
                "max": 10,
                "average": 0,
                "total": 519
            },
            "process.serializer.record.string.binary2string": {
                "entries": 1867,
                "last": 0,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 18
            },
            "process.serializer.record.string.bool2string": {
                "entries": 43,
                "last": 0,
                "min": 0,
                "max": 0,
                "average": 0,
                "total": 0
            },
            "process.serializer.record.string.byte2string": {
                "entries": 1143,
                "last": 0,
                "min": 0,
                "max": 0,
                "average": 0,
                "total": 0
            },
            "process.serializer.record.string.date2string": {
                "entries": 114176,
                "last": 0,
                "min": 0,
                "max": 6,
                "average": 0,
                "total": 464
            },
            "process.serializer.record.string.datetime2string": {
                "entries": 2,
                "last": 0,
                "min": 0,
                "max": 0,
                "average": 0,
                "total": 0
            },
            "process.serializer.record.string.decimal2string": {
                "entries": 2,
                "last": 1,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 1
            },
            "process.serializer.record.string.double2string": {
                "entries": 30237,
                "last": 0,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 104
            },
            "process.serializer.record.string.embed2string": {
                "entries": 122581,
                "last": 0,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 117
            },
            "process.serializer.record.string.embedList2string": {
                "entries": 29922,
                "last": 0,
                "min": 0,
                "max": 2,
                "average": 0,
                "total": 87
            },
            "process.serializer.record.string.embedMap2string": {
                "entries": 3160,
                "last": 0,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 25
            },
            "process.serializer.record.string.embedSet2string": {
                "entries": 32280,
                "last": 1,
                "min": 0,
                "max": 8,
                "average": 0,
                "total": 1430
            },
            "process.serializer.record.string.float2string": {
                "entries": 20640,
                "last": 0,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 63
            },
            "process.serializer.record.string.fromStream": {
                "entries": 1735665,
                "last": 0,
                "min": 0,
                "max": 82,
                "average": 0,
                "total": 7174
            },
            "process.serializer.record.string.int2string": {
                "entries": 246700,
                "last": 0,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 101
            },
            "process.serializer.record.string.link2string": {
                "entries": 18664,
                "last": 0,
                "min": 0,
                "max": 6,
                "average": 0,
                "total": 62
            },
            "process.serializer.record.string.linkList2string": {
                "entries": 2648,
                "last": 0,
                "min": 0,
                "max": 2,
                "average": 0,
                "total": 52
            },
            "process.serializer.record.string.linkMap2string": {
                "entries": 28,
                "last": 0,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 1
            },
            "process.serializer.record.string.linkSet2string": {
                "entries": 1269,
                "last": 0,
                "min": 0,
                "max": 33,
                "average": 0,
                "total": 80
            },
            "process.serializer.record.string.long2string": {
                "entries": 1620,
                "last": 0,
                "min": 0,
                "max": 1,
                "average": 0,
                "total": 6
            },
            "process.serializer.record.string.string2string": {
                "entries": 358585,
                "last": 0,
                "min": 0,
                "max": 3,
                "average": 0,
                "total": 183
            },
            "process.serializer.record.string.toStream": {
                "entries": 183912,
                "last": 0,
                "min": 0,
                "max": 34,
                "average": 0,
                "total": 3149
            },
            "server.http.0:0:0:0:0:0:0:1.request": {
                "entries": 2,
                "last": 2,
                "min": 2,
                "max": 19,
                "average": 10,
                "total": 21
            }
        },
        "statistics": {},
        "counters": {
            "db.0$db.cache.level2.cache.found": 7,
            "db.0$db.cache.level2.cache.notFound": 8,
            "db.0$db.data.update.notReused": 11,
            "db.0$db.data.update.reusedAll": 7,
            "db.1$db.cache.level2.cache.found": 7,
            "db.1$db.cache.level2.cache.notFound": 8,
            "db.1$db.data.update.notReused": 11,
            "db.1$db.data.update.reusedAll": 7,
            "db.2$db.cache.level2.cache.found": 7,
            "db.2$db.cache.level2.cache.notFound": 8,
            "db.2$db.data.update.notReused": 11,
            "db.2$db.data.update.reusedAll": 7,
            "db.demo.cache.level2.cache.found": 364467,
            "db.demo.cache.level2.cache.notFound": 393509,
            "db.demo.data.update.notReused": 38426,
            "db.demo.data.update.reusedAll": 140921,
            "db.demo.data.update.reusedPartial": 100,
            "db.demo.query.compositeIndexUsed": 46,
            "db.demo.query.compositeIndexUsed.2": 42,
            "db.demo.query.compositeIndexUsed.2.1": 20,
            "db.demo.query.compositeIndexUsed.2.2": 18,
            "db.demo.query.compositeIndexUsed.3": 4,
            "db.demo.query.compositeIndexUsed.3.1": 1,
            "db.demo.query.compositeIndexUsed.3.2": 1,
            "db.demo.query.compositeIndexUsed.3.3": 2,
            "db.demo.query.indexUsed": 2784,
            "db.subTest.cache.level2.cache.found": 14,
            "db.subTest.cache.level2.cache.notFound": 16,
            "db.subTest.data.update.notReused": 22,
            "db.subTest.data.update.reusedAll": 14,
            "db.temp.cache.level2.cache.found": 5,
            "db.temp.cache.level2.cache.notFound": 4,
            "process.file.mmap.pagesCommitted": 2034,
            "process.mvrbtree.entry.serializeKey": 4617509,
            "process.mvrbtree.entry.serializeValue": 68620,
            "process.mvrbtree.entry.unserializeKey": 6127,
            "process.mvrbtree.entry.unserializeValue": 225,
            "process.serializer.record.string.linkList2string.cached": 19,
            "server.http.0:0:0:0:0:0:0:1.requests": 3,
            "server.http.0:0:0:0:0:0:0:1.timeout": 1
        }
    }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="distributed-configuration-tuning"><a class="header" href="#distributed-configuration-tuning">Distributed Configuration Tuning</a></h1>
<p>When you run <a href="distributed/Distributed-Architecture.html">distributed</a> on multiple servers, you could face on a drop of performance you got with single node. While it's normal that replication has a cost, there are many ways to improve performance on distributed configuration:</p>
<ul>
<li><a href="distributed/Distributed-Configuration-Tuning.html#use-transactions">Use transactions</a></li>
<li><a href="distributed/Distributed-Configuration-Tuning.html#replication-vs-sharding">Replication vs Sharding</a></li>
<li><a href="distributed/Distributed-Configuration-Tuning.html#use-few-master-and-many-replica-servers">Use few MASTER and many REPLICA servers</a></li>
<li><a href="distributed/Distributed-Configuration-Tuning.html#scale-up-on-writes">Scale up on writes</a></li>
<li><a href="distributed/Distributed-Configuration-Tuning.html#scale-up-on-reads">Scale up on reads</a></li>
<li><a href="distributed/Distributed-Configuration-Tuning.html#replication-vs-sharding">Replication vs Sharding</a></li>
</ul>
<h2 id="generic-advice"><a class="header" href="#generic-advice">Generic advice</a></h2>
<h3 id="load-balancing-1"><a class="header" href="#load-balancing-1">Load Balancing</a></h3>
<p>Active the <a href="distributed/Distributed-Configuration.html#load-balancing">load balancing</a> to distribute the load across multiple nodes.</p>
<h3 id="use-transactions"><a class="header" href="#use-transactions">Use transactions</a></h3>
<p>Even though when you update graphs you should always work in transactions, OrientDB allows also to work outside of them. Common cases are read-only queries or massive and non concurrent operations can be restored in case of failure. When you run on distributed configuration, using transactions helps to reduce latency. This is because the distributed operation happens only at commit time. Distributing one big operation is much efficient than transferring small multiple operations, because the latency.</p>
<h3 id="replication-vs-sharding"><a class="header" href="#replication-vs-sharding">Replication vs Sharding</a></h3>
<p>OrientDB <a href="distributed/Distributed-Configuration.html">distributed configuration</a> is set to full replication. Having multiple nodes with the very same copy of database is important for HA and scale reads. In facts, each server is independent on executing reads and queries. If you have 10 server nodes, the read throughput is 10x.</p>
<p>With writes it's the opposite: having multiple nodes with full replication slows down operations if the replication is synchronous. In this case <a href="distributed/Distributed-Sharding.html">Sharding</a> the database across multiple nodes allows you to scale up writes, because only a subset of nodes are involved on write. Furthermore you could have a database bigger than one server node HD.</p>
<h2 id="use-few-master-and-many-replica-servers"><a class="header" href="#use-few-master-and-many-replica-servers">Use few MASTER and many REPLICA servers</a></h2>
<p>Starting from v2.2, the biggest advantage of having many REPLICA servers is that they don't concur in the <code>writeQuorum</code>, so if you have 3 MASTER servers and 100 REPLICA servers, every write operation will be replicated across 103 servers, but the majority of the writeQuorum would be just 2, because given N/2+1, N is the number of MASTER servers. In this case after the operation is executed locally, the server coordinator of the write operation has to wait only for one more MASTER server.</p>
<p>For more information look at <a href="distributed/Distributed-Architecture.html#server-roles">Server roles</a>.</p>
<h2 id="scale-up-on-writes"><a class="header" href="#scale-up-on-writes">Scale up on writes</a></h2>
<p>If you have a slow network and you have a synchronous (default) replication, you could pay the cost of latency. In facts when OrientDB runs synchronously, it waits at least for the <code>writeQuorum</code>. This means that if the <code>writeQuorum</code> is 3 ("majority"), and you have 5 nodes, the coordinator server node (where the distributed operation is started) has to wait for the answer from at least 3 nodes in order to provide the answer to the client.</p>
<p>In order to maintain the consistency, the <code>writeQuorum</code> should be set to the majority (the default setting), defined as N/2+1, where N is the number of MASTER servers. If you have 5 nodes the majority is 3. With 4 nodes is still 3. Setting the <code>writeQuorum</code> to 3 instead of 4 or 5 allows to reduce the latency cost and still maintain the consistency.</p>
<h2 id="scale-up-on-reads"><a class="header" href="#scale-up-on-reads">Scale up on reads</a></h2>
<p>If you already set the <code>writeQuorum</code> to the majority to the nodes, you can leave the <code>readQuorum</code> to 1 (the default). This speeds up all the reads.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-stress-test-tool"><a class="header" href="#orientdb-stress-test-tool">OrientDB Stress Test Tool</a></h1>
<p>The OrientDB Stress Test Tool is an utility for very basic benchmarking of OrientDB.</p>
<h2 id="syntax-316"><a class="header" href="#syntax-316">Syntax</a></h2>
<pre><code>StressTester
	-m [plocal|memory|remote] (mandatory)
	-w &lt;workload-name&gt;:&lt;workload-params&gt;*
	-c &lt;concurrency level&gt; (number of parallel threads)
	-tx &lt;operationsPerTransaction&gt;
    -o &lt;resultOutputFile&gt;
    -d &lt;plocalDirectory&gt;
    -chk true|false
    -k true|false
--root-password &lt;rootPassword&gt;
--remote-ip &lt;remoteIpOrHost&gt;
--remote-port &lt;remotePort&gt;
--ha-metrics true|false
</code></pre>
<ul>
<li>the <strong>m</strong> parameter sets the type of database to be stressed.</li>
<li>the <strong>c</strong> parameter sets the concurrency level, as the number of threads that will be launched. Every thread will execute the complete operationSe. If not present, it defaults to 4.</li>
<li>the <strong>tx</strong> parameter sets the number of operations to be included in a transaction. This value must be lesser than the number of creates divided by the threads number and the iterations number. If the <strong>tx</strong> parameter is not present, all the operations will be executed outside transactions.</li>
<li>the <strong>w</strong> parameter defines the workloads. To specify multiple workloads, use the comma (<code>,</code>) to separate them, but do not use any space. Workloads are pluggable, the available ones are:
<ul>
<li>
<p><strong>CRUD</strong>, executes, in order, (C)reate, (R)ead, (U)pdate and (D)elete operations. The <code>&lt;workload-params&gt;</code> must follow the format <code>C#R#U#D#</code>, where the '#' is a number:</p>
<ul>
<li>C1000 defines 1000 Create operations</li>
<li>R1000 defines 1000 Read operations</li>
<li>U1000 defines 1000 Update operations</li>
<li>D1000 defines 1000 Delete operations</li>
</ul>
<p>So a valid set is C1000R1000U1000D1000. There is only one constraint: the number of reads, updates and deletes cannot be greater than the number of creates. If not present, it defaults to C5000R5000U5000D5000.</p>
</li>
<li>
<p><strong>GINSERT</strong>, Insert a graph where all the nodes are connected with each others. The <code>&lt;workload-params&gt;</code> must follow the format <code>V#F#</code>, where the '#' is a number:</p>
<ul>
<li>V1000 creates 1000 vertices</li>
<li>F10 Each vertex has 10 edges</li>
</ul>
</li>
<li>
<p><strong>GSP</strong>, Executes a shortest path between all the vertices against all the other vertices. The <code>&lt;workload-params&gt;</code> must follow the format <code>L#</code>, where the '#' is a number::</p>
<ul>
<li>L1000 set the limit to 1000 vertices only. Optional.</li>
</ul>
</li>
</ul>
</li>
<li>the <strong>o</strong> parameter sets the filename where the results are written in JSON format.</li>
<li>the <strong>d</strong> parameter sets the base directory for writing the plocal database</li>
<li>the <strong>k</strong> keeps the database at the end of workload. By default is <code>false</code>, so the database is dropped.</li>
<li>the <strong>chk</strong> Checks the database created by the workload at the end of the test. Default is <code>false</code>.</li>
<li>the <strong>remote-ip</strong> parameter defines the remote host (or IP) of the server to connect to. The StressTester will fail if this parameter is not specified and mode is <strong>remote</strong>.</li>
<li>the <strong>remote-port</strong> parameter defines the port of the server to connect to. If not specified, it defaults to 2424.</li>
<li>the <strong>root-password</strong> parameter sets the root password of the server to connect to. If not specified and if mode is <strong>remote</strong>, the root password will be asked at the start of the test.</li>
<li>the <strong>ha-metrics</strong> (since v2.2.7) setting dumps the HA metrics at the end of each workload</li>
</ul>
<p>If the StressTester is launched without parameters, it fails because the <strong>-m</strong> parameter is mandatory.</p>
<h2 id="how-it-works-2"><a class="header" href="#how-it-works-2">How it works</a></h2>
<p>The stress tester tool creates a temporary database where needed (on memory / plocal / remote) and then creates a pool of N threads (where N is the threadsNumber parameter) that - all together - execute the number of operations defined in the OperationSet.
So, if the number of Creates is 1000 and the thread number is 4, every single thread will execute 250 Creates (1000/4).
After the execution of the test (or any error) the temporary database is dropped.</p>
<h2 id="example-with-crud-workload"><a class="header" href="#example-with-crud-workload">Example with CRUD workload</a></h2>
<p>Executing a CRUD workload by inserting, reading, updating and deleting 100,000 records by using a connection of type "plocal" and 8 parallel threads:</p>
<pre><code>cd bin
./stresstester -m plocal -c 8 -w crud:C100000R100000U100000D100000
</code></pre>
<p>This is the result:</p>
<pre><code>OrientDB Stress Tool v.2.2.4-SNAPSHOT - Copyrights (c) 2016 OrientDB LTD
WARNING: 'tx' option not found. Defaulting to 0.
Created database [plocal:/var/folders/zc/y34429014c3bt_x1587qblth0000gn/T/stress-test-db-20160701_165901].

Starting workload CRUD (concurrencyLevel=8)...
- Workload in progress 100% [Creates: 100% - Reads: 100% - Updates: 100% - Deletes: 100%]
- Total execution time: 27.602 secs
- Created 1000000 records in 26.464 secs
  - Throughput: 37787.184/sec - Avg: 0.026ms/op (0th percentile) - 99th Perc: 0.799ms - 99.9th Perc: 5.769ms
- Read 1000 records in 0.096 secs
  - Throughput: 10416.667/sec - Avg: 0.096ms/op (0th percentile) - 99th Perc: 2.597ms - 99.9th Perc: 6.860ms
- Updated 1000 records in 0.043 secs
  - Throughput: 23255.814/sec - Avg: 0.043ms/op (0th percentile) - 99th Perc: 1.404ms - 99.9th Perc: 3.505ms
- Deleted 1000 records in 0.107 secs
  - Throughput: 9345.794/sec - Avg: 0.107ms/op (0th percentile) - 99th Perc: 3.175ms - 99.9th Perc: 5.664ms

Dropped database [plocal:/var/folders/zc/y34429014c3bt_x1587qblth0000gn/T/stress-test-db-20160701_165901].
</code></pre>
<p>The first part of the result is updated as long as the test is running, to give the user an idea of how long it will last. It will be deleted as soon as the test successfully terminates.
The second part shows the results of the test:</p>
<ul>
<li>The total time of execution</li>
<li>The times of execution of every operation type, their percentiles and the throughput.</li>
</ul>
<p>The time is computed by summing up the times of execution of all the threads and dividing it by their number; the percentile value shows where the average result is located compared to all other results: if the average is a lot higher than 50%, it means that there are a few executions with higher times that lifted up the average (and you can expect better performance in general); a high percentile can happen when, for example, the OS or another process is doing something else (either CPU or I/O intensive) during the execution of the test.</p>
<p>If you plan to use the results of the StressTester the <strong>o</strong> option is available for writing the results in JSON format on disk.</p>
<h2 id="example-with-graph-workloads"><a class="header" href="#example-with-graph-workloads">Example with Graph workloads</a></h2>
<p>Insert 100 vertices with 10 edges each (all connected), then execute a shortest path between all of them and checks the database integrity at the end.</p>
<pre><code>cd bin
./stresstester -m plocal -c 16 -w GINSERT:V100F10,GSP -chk true
</code></pre>
<p>This is the result:</p>
<pre><code>OrientDB Stress Tool v.2.2.4-SNAPSHOT - Copyrights (c) 2016 OrientDB LTD
WARNING: 'tx' option not found. Defaulting to 0.
Created database [plocal:/var/folders/zc/y34429014c3bt_x1587qblth0000gn/T/stress-test-db-20160701_170356].

Starting workload GINSERT (concurrencyLevel=16)...
- Workload in progress 100% [Vertices: 100 - Edges: 84]
- Total execution time: 0.068 secs
- Created 100 vertices and 84 edges in 0.052 secs
- Throughput: 1923.077/sec - Avg: 0.520ms/op (0th percentile) - 99th Perc: 15.900ms - 99.9th Perc: 15.900ms
- Checking database...
   - Repair of graph 'plocal:/var/folders/zc/y34429014c3bt_x1587qblth0000gn/T/stress-test-db-20160701_170356' is started ...
   - Scanning 99 edges...
   - Scanning edges completed
   - Scanning 100 vertices...
   - Scanning vertices completed
   - Repair of graph 'plocal:/var/folders/zc/y34429014c3bt_x1587qblth0000gn/T/stress-test-db-20160701_170356' completed in 0 secs
   -  scannedEdges.....: 99
   -  removedEdges.....: 0
   -  scannedVertices..: 100
   -  scannedLinks.....: 198
   -  removedLinks.....: 0
   -  repairedVertices.: 0
- Check completed

Starting workload GSP (concurrencyLevel=16)...
- Workload in progress 100% [Shortest paths blocks (block size=100) executed: 100/100]
- Total execution time: 2.065 secs
- Executed 100 shortest paths in 2.060 secs
- Path depth: maximum 18, average 8.135, not connected 0
- Throughput: 48.544/sec - Avg: 20.600ms/op (0th percentile) - 99th Perc: 650.284ms - 99.9th Perc: 650.284ms
- Checking database...
   - Repair of graph 'plocal:/var/folders/zc/y34429014c3bt_x1587qblth0000gn/T/stress-test-db-20160701_170356' is started ...
   - Scanning 99 edges...
   - Scanning edges completed
   - Scanning 100 vertices...
   - Scanning vertices completed
   - Repair of graph 'plocal:/var/folders/zc/y34429014c3bt_x1587qblth0000gn/T/stress-test-db-20160701_170356' completed in 0 secs
   -  scannedEdges.....: 99
   -  removedEdges.....: 0
   -  scannedVertices..: 100
   -  scannedLinks.....: 198
   -  removedLinks.....: 0
   -  repairedVertices.: 0
- Check completed

Dropped database [plocal:/var/folders/zc/y34429014c3bt_x1587qblth0000gn/T/stress-test-db-20160701_170356].
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="enterprise-edition-1"><a class="header" href="#enterprise-edition-1">Enterprise Edition</a></h1>
<p>This is the main guide on using <b>OrientDB Enterprise Edition</b>.</p>
<p>Enterprise Edition is a commercial product developed by SAP.</p>
<p>OrientDB Enterprise Edition is designed specifically for applications seeking a scalable, robust, and secure multi-model database. Its main goal is to save time and money on your OrientDB investment by reducing risk, cost, effort, and time invested in a business critical application. It includes all Community features plus professional enterprise tools such as support for <a href="ee/./Server-Profiler.html">Query Profiler</a>, <a href="ee/./Cluster-Management.html">Distributed Clustering</a> configuration, <a href="ee/./Security.html">Auditing Tools</a>, <a href="ee/../Server-Management.html">Metrics recording</a>, <a href="ee/./Backup-Management.html">Non-Stop Incremental Backups</a>, <a href="ee/./Teleporter.html">Teleporter</a> to import data from any Relational DBMS.</p>
<h3 id="installation-11"><a class="header" href="#installation-11">Installation</a></h3>
<p>Enterprise Edition is an additional package which can be installed in the <a href="ee/../gettingstarted/Tutorial-Installation.html">Community Edition</a>. Download the Enterprise package after registering on the web site and install it in the <code>${ORIENTDB_HOME}/plugins</code> folder.</p>
<p>At run-time, the Enterprise edition logs this message:</p>
<pre><code>2016-08-04 09:38:26:589 INFO  ***************************************************************************** [OEnterpriseAgent]
2016-08-04 09:38:26:589 INFO  *                     ORIENTDB  -  ENTERPRISE EDITION                       * [OEnterpriseAgent]
2016-08-04 09:38:26:589 INFO  ***************************************************************************** [OEnterpriseAgent]
2016-08-04 09:38:26:589 INFO  * If you are in Production or Test, you must purchase a commercial license. * [OEnterpriseAgent]
2016-08-04 09:38:26:589 INFO  * For more information look at: http://orientdb.com/orientdb-enterprise/    * [OEnterpriseAgent]
2016-08-04 09:38:26:590 INFO  ***************************************************************************** [OEnterpriseAgent]
</code></pre>
<h2 id="ee-features"><a class="header" href="#ee-features">EE Features</a></h2>
<p>Explore the Enterprise Edition features:</p>
<ul>
<li><a href="ee/./Dashboard.html">Dashboard</a></li>
<li><a href="ee/./Server-Management.html">Server Management</a></li>
<li><a href="ee/./Cluster-Management.html">Cluster Management</a></li>
<li><a href="ee/./Backup-Management.html">Backup Management</a></li>
<li><a href="ee/./Server-Profiler.html">Server Profiler</a></li>
<li><a href="ee/./Security.html">Security</a></li>
<li><a href="ee/./Teleporter.html">Teleporter</a></li>
<li><a href="ee/./Neo4j-Importer.html">Neo4j to OrientDB Importer</a></li>
<li><a href="ee/./Settings.html">Settings</a></li>
</ul>
<p>See here for the documentation of the new <a href="ee/./Profiler.html">Metrics</a> module.</p>
<h2 id="accessing-ee-features-from-studio"><a class="header" href="#accessing-ee-features-from-studio">Accessing EE Features from Studio</a></h2>
<p>To access the Enterprise features from OrientDB Studio, from the login page, click on <code>SERVER MANAGEMENT</code> (top right corner) and enter root username and password</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dashboard-panel"><a class="header" href="#dashboard-panel"><em>Dashboard</em> Panel</a></h1>
<blockquote>
<p>Only users with grant <code>server.metrics</code> can see this section</p>
</blockquote>
<p>Studio Enterprise Edition includes an easy-to-read and single-page <em>Dashboard</em> with constantly updated reports.
The <em>Dashboard</em> shows a graphical presentation of the current status and historical trends of each node joining your cluster. Performance indicators are reported in order to enable instantaneous and informed decisions which you can make at a glance.</p>
<p>Here you can see the Dashboard reporting the status of a cluster composed of 1 node.</p>
<p>For each node you can monitor several information divided in two main sections:</p>
<ul>
<li>
<p>System report</p>
<ul>
<li><code>CPU</code>, <code>RAM</code>, <code>DISK CACHE</code> and <code>DISK</code> used</li>
<li><code>Status</code> of the node</li>
<li><code>Operations</code></li>
<li><code>Active Sessions</code></li>
<li><code>Network Requests</code></li>
</ul>
</li>
<li>
<p>CRUD operations: includes a <code>Live Chart</code> of CRUD operations in real time.</p>
</li>
</ul>
<p><img src="ee/./images/studio-dashboard-ee.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="server-management"><a class="header" href="#server-management">Server Management</a></h1>
<p>This is the section to work with OrientDB Server as DBA/DevOps with <a href="http://orientdb.com/enterprise/">Enterprise Edition</a>.</p>
<blockquote>
<p>Only users with grant <code>server.metrics</code> can see this section</p>
</blockquote>
<p>This page contains detailed information about the selected node.</p>
<p>General information are:</p>
<ul>
<li><code>Number of CPUs</code></li>
<li><code>Status of the node</code></li>
<li><code>Java information</code></li>
<li><code>OS information</code></li>
<li><code>OrientDB version</code></li>
</ul>
<p>Then 3 sub-sections are available:</p>
<ul>
<li>Overview</li>
<li>Monitoring</li>
<li>Global Configuration</li>
</ul>
<h2 id="overview-4"><a class="header" href="#overview-4">Overview</a></h2>
<p>This page summarizes all the most important information about the current server:</p>
<ul>
<li><code>Server status</code></li>
<li><code>Operations</code></li>
<li><code>Active Sessions</code></li>
<li><code>CPU</code>, <code>RAM</code> and <code>DISK</code> used</li>
<li><code>Live chart</code> with CRUD operations in real-time</li>
</ul>
<p><img src="ee/../images/ee/studio-server-management.png" alt="Overview" /></p>
<h2 id="monitoring-1"><a class="header" href="#monitoring-1">Monitoring</a></h2>
<h3 id="connections"><a class="header" href="#connections">Connections</a></h3>
<p>Displays all the active sessions to the server. Each session reports the following information:</p>
<ul>
<li><code>Session ID</code>, as the unique session number</li>
<li><code>Client</code>, as the unique client number</li>
<li><code>Address</code>, is the connection source</li>
<li><code>Database</code>, the database name used</li>
<li><code>User</code>, the database user</li>
<li><code>Total Requests</code>, as the total number of requests executed by the connection</li>
<li><code>Command Info</code>, as the running command</li>
<li><code>Command Detail</code>, as the detail about the running command</li>
<li><code>Last Command On</code>, is the last time a request has been executed</li>
<li><code>Last Command Info</code>, is the information about last operation executed</li>
<li><code>Last Command Detail</code>, is the information about the details of last operation executed</li>
<li><code>Last Execution Time</code>, is the execution time o last request</li>
<li><code>Total Working Time</code>, is the total execution time taken by current connection so far</li>
<li><code>Connected Since</code>, is the date when the connection has been created</li>
<li><code>Protocol</code>, is the protocol between <a href="ee/../misc/OrientDB-REST.html">HTTP</a> and <a href="ee/../internals/Network-Binary-Protocol.html">Binary</a></li>
<li><code>Client ID</code>, a text representing the client connection</li>
<li><code>Driver</code>, the driver name</li>
</ul>
<p>Each session can be interrupted or even killed.</p>
<p><img src="ee/./images/studio-monitoring-connections.png" alt="Connections" /></p>
<h3 id="threads"><a class="header" href="#threads">Threads</a></h3>
<p>This panel show the thread dump of the selected server.</p>
<p><img src="ee/./images/studio-monitoring-threads.png" alt="Threads" /></p>
<h2 id="global-cfg"><a class="header" href="#global-cfg">Global CFG</a></h2>
<p>This panel shows the Server settings divided in two boxes:</p>
<ul>
<li><code>Properties</code>, as the custom settings in <code>config/orientdb-server-config.xml</code> file</li>
<li><code>Global Configuration</code>, as all the global configuration. Only few of them can be changed at run-time with the "Save" button</li>
</ul>
<p><img src="ee/./images/studio-global-configurations.png" alt="Configuration" /></p>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p>Only users with grant <code>server.metrics</code> and <code>server.distributed</code> can see this section</p>
</blockquote>
<h1 id="cluster-management-1"><a class="header" href="#cluster-management-1">Cluster Management</a></h1>
<p>This is the section (available only for the Enterprise Edition) to work with OrientDB Cluster as DBA/DevOps.</p>
<blockquote>
<p><strong>NOTE</strong>: This feature is available only in the <a href="http://orientdb.com/orientdb-enterprise">OrientDB Enterprise Edition</a>. If you are interested in a commercial license look at <a href="http://orientdb.dev/support">OrientDB Subscription Packages</a>.</p>
</blockquote>
<p>On the top of the page are reported the number of active nodes joining your cluster.</p>
<h2 id="overview-5"><a class="header" href="#overview-5">Overview</a></h2>
<p>This page summarizes all the most important information about all servers connected to the cluster:</p>
<ul>
<li><code>CPU</code>, <code>RAM</code>, <code>DISK CACHE</code> and <code>DISK</code> used</li>
<li><code>Status</code></li>
<li><code>Operations per second</code></li>
<li><code>Active Connections</code></li>
<li><code>Network Requests</code></li>
<li><code>Live chart</code> with CRUD operations in real-time</li>
</ul>
<p>It also contains stats about replication messages:</p>
<ul>
<li><code>Replication Latency Average</code>: average replication latency between nodes</li>
<li><code>Replication Message Counters</code>: counters of messages exchanged between nodes;</li>
<li><code>Replication Message Coordinator Stats</code>: detailed counters of messages grouped by type, sent by the coordinator.</li>
</ul>
<p><img src="ee/./images/studio-cluster-management-overview.png" alt="Overview" /></p>
<h2 id="databases"><a class="header" href="#databases">Databases</a></h2>
<p>In this panel you can see all databases present on each server joining your cluster.
Through the box above you can change in real time the current cluster configuration, without touching the <code>config/default-distributed-db-config.json</code> file content. You can set the following parameters:</p>
<ul>
<li><code>Write Quorum</code></li>
<li><code>Read Quorum</code></li>
<li><code>Auto Deploy</code></li>
<li><code>Hot Alignment</code></li>
<li><code>Read your Writes</code></li>
<li><code>Failure Available Nodes Less Quorum</code></li>
<li><code>Server Roles</code>, roles may be "Master" or "Replica"</li>
</ul>
<p>To learn more about these configuration parameters please visit the <a href="ee/../../distributed/Distributed-Configuration.html">Distributed Configuration</a> section.</p>
<p><img src="ee/./images/studio-cluster-management-databases.png" alt="Databases" /></p>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p>Only users with grant <code>server.backup</code> can see this section</p>
</blockquote>
<h1 id="backup-management-panel"><a class="header" href="#backup-management-panel"><em>Backup Management</em> Panel</a></h1>
<p>Studio 2.2 Enterprise Edition includes a <strong>Backup Manager</strong> that allows you to schedule and perform your backups and easily execute and manage restores you may need.
You can enjoy this new functionality by reaching the <strong>Backup Management</strong> panel in the Server Management area, this is what you will find:</p>
<p><img src="ee/./images/studio-backup-00-fresh-scheduler.png" alt="" /></p>
<p>How you can see the panel is divided into two sections, on the left side you can schedule your backups, on the right side there is the calendar where you can check:</p>
<ul>
<li>the executed tasks (backup or restore)</li>
<li>the scheduled backups</li>
<li>eventual errors raised during the execution of a task</li>
</ul>
<p>Now let's start seeing how you can schedule your backups.</p>
<h2 id="backup-scheduling"><a class="header" href="#backup-scheduling">Backup scheduling</a></h2>
<p>On the left you can find all the settings for your backup scheduling.</p>
<p><img src="ee/./images/studio-backup-01-backup-scheduler-right-panel.png" alt="" /></p>
<p>As first thing choose the <strong>database</strong> that you want backup. In the example above we have chosen the GratefulDeadConcerts database.
Then you must specify the <strong>output directory</strong> where you want to save your backups and the <strong>retention days</strong> of your backups.
Now you must select the <strong>backup mode</strong> you want to use:</p>
<ul>
<li><strong>Full backup</strong></li>
<li><strong>Incremental Backup</strong></li>
<li><strong>Full + Incremental Backup</strong></li>
</ul>
<p>These modes will be analysed afterwards.</p>
<p>Once you have chosen the desired backup mode, you have to choose the <strong>backup period</strong> that indicates the time you want to wait between each backup and the next one.
Eventually you must flag the <strong>Enabled</strong> checkbox and click on the <strong>Save</strong> button in order to start the scheduling of the backups according to your settings.</p>
<p>Below we will examine briefly the three different backup strategies.</p>
<p>###Full backup
Through this mode when each period passes a <strong>full backup</strong> will be performed in the path you specified in the settings just discussed.
If you want know more about the full backup you can refer to the <a href="ee/../../admin/Backup-and-Restore.html">Full Backup</a> page.</p>
<p><img src="ee/./images/studio-backup-02-full-backup-scheduling.png" alt="" /></p>
<p>With the settings shown above a full backup will be performed every 5 minutes. Thus in our example after 5 minutes we will have the first backup, after 10 minutes the second one and so on.</p>
<pre><code>/tmp/backup/full
          |
          |____________GratefulDeadConcerts-1465213003035
          |                      |____________GratefulDeadConcerts_2016-06-06-13-36-43_0_full.ibu
          |
          |____________GratefulDeadConcerts-1465213020008
          |                      |____________GratefulDeadConcerts_2016-06-06-13-37-00_0_full.ibu
          |
          |____________GratefulDeadConcerts-1465213080003
          |                      |____________GratefulDeadConcerts_2016-06-06-13-38-00_0_full.ibu
          ...
</code></pre>
<p>###Incremental Backup
If you prefer to execute an <strong>incremental backup</strong> you can select this mode.
As declared in the <a href="ee/../../admin/Incremental-Backup-And-Restore.html">Incremental Backup</a> page the incremental backup generates smaller backup files by storing only the <strong>delta</strong> between two versions of the database.
Let's suppose we want execute a backup every 5 minutes: a <strong>first full backup</strong> will be performed, then it will be followed by a new <strong>incremental backup</strong>, containing only the delta, <strong>every 5 minutes</strong>.</p>
<p><img src="ee/./images/studio-backup-03-incremental-backup-scheduling.png" alt="" /></p>
<pre><code>/tmp/backup/incremental
          |
          |____________GratefulDeadConcerts-incremental
                                |____________GratefulDeadConcerts_2016-06-06-13-27-00_0_full.ibu
                                |____________GratefulDeadConcerts_2016-06-06-13-28-00_1.ibu
                                |____________GratefulDeadConcerts_2016-06-06-13-29-00_2.ibu
                                |____________GratefulDeadConcerts_2016-06-06-13-30-00_3.ibu
                                |____________GratefulDeadConcerts_2016-06-06-13-31-00_4.ibu
                                ...

</code></pre>
<p>###Full + Incremental Backup
This mode follows an <strong>hybrid approach</strong> between the first two strategies, combining them according to your criteria. The first significant thing you can notice is that <strong>you must specify two different backup-periods</strong>:</p>
<ul>
<li><strong>Full Backup period</strong>: it specifies how much time will be waited between two sequential full backups.</li>
<li><strong>Incremental Backup period</strong>: it specifies how much time will be waited between two sequential incremental backups.</li>
</ul>
<p>Let's analyse in which way the two modes are combined. Suppose we decided to execute the full backup every 5 minutes and the incremental backup every minute as shown in the example below.</p>
<p><img src="ee/./images/studio-backup-04-full-incr-backup-scheduling.png" alt="" /></p>
<p>Thus we will obtain that <strong>every 5 minutes</strong> a new directory with a <strong>full backup</strong> will be added in the specified path, then <strong>in the following 4 minutes</strong> only <strong>incremental backups</strong> will be performed. As we set 1 minute for the incremental backup, we will have 4 incremental backups after the first full backup.
After 5 minutes a new full backup in another folder will be performed, and the following incrementals will be executed according to the delta relative to this second full backup and they will put in this second folder.
That's all, after another 5 minutes we will have a third directory with an initial full backup that will be followed by 4 incremental backups, ans so on.</p>
<pre><code>/tmp/backup/full-incremental
          |
          |____________GratefulDeadConcerts-1465213200182
          |                      |____________GratefulDeadConcerts_2016-06-06-13-40-00_0_full.ibu
          |                      |____________GratefulDeadConcerts_2016-06-06-13-41-00_1.ibu
          |                      |____________GratefulDeadConcerts_2016-06-06-13-42-00_2.ibu
          |                      |____________GratefulDeadConcerts_2016-06-06-13-44-00_3.ibu
          |                      |____________GratefulDeadConcerts_2016-06-06-13-44-00_4.ibu
          |
          |____________GratefulDeadConcerts-1465213440019
          |                      |____________GratefulDeadConcerts_2016-06-06-13-45-00_0_full.ibu
          |                      |____________GratefulDeadConcerts_2016-06-06-13-46-00_1.ibu
          |                      |____________GratefulDeadConcerts_2016-06-06-13-47-00_2.ibu
          |                      |____________GratefulDeadConcerts_2016-06-06-13-48-00_3.ibu
          |                      |____________GratefulDeadConcerts_2016-06-06-13-49-00_4.ibu
          |
          |____________GratefulDeadConcerts-1467210084991
          |                      |____________GratefulDeadConcerts_2016-06-06-13-46-00_0_full.ibu
          |                      ...
          ...
</code></pre>
<p>In this way we can have a "checkpoint" for each different directory to use in order to restore the database to a specific moment. You can decide if delete or maintain old backups and for each of them you can exploit the incremental backup features at the same time. To achieve this goal and use this feature properly mind that <strong>full backup period must be major than incremental backup period</strong>, different settings may cause illogical behaviours.</p>
<p>###Granularity
You can have different granularities to schedule your backups. Besides <strong>minutes</strong> granularity you can choose <strong>hour</strong>, <strong>day</strong>, <strong>week</strong>, <strong>month</strong>, and <strong>year</strong> granularity.</p>
<p><img src="ee/./images/studio-backup-05-granularity.png" alt="" /></p>
<p>##Restore</p>
<p>In the calendar you can visualize and filter all the tasks (with the eventual related errors) through the voices below:</p>
<ul>
<li>Backup Finished</li>
<li>Restore Finished</li>
<li>Backup Scheduled</li>
<li>Backup Started</li>
<li>Restore Started</li>
<li>Backup Error</li>
<li>Restore Error</li>
</ul>
<p>![](images/studio-backup-05.1- calendar-not-empty.png)</p>
<p>Notice you can choose three different scopes: <strong>month</strong>, <strong>week</strong> and <strong>day</strong>.</p>
<p>Clicking on a backup you can examine additional info like <strong>execution time</strong> and <strong>timestamp</strong>, <strong>directory path</strong>, <strong>file name</strong> and <strong>file size</strong>.
Moreover you can <strong>remove</strong> the backup or carry out a restore starting from it.<br />
<strong>Use this way to delete your backups</strong> because removing them manually may generates <strong>unexpected behaviours</strong>.</p>
<p><img src="ee/./images/studio-backup-06-backup-event.png" alt="" /></p>
<p>Let's make a restore by clicking on the button "Restore Database". A new window will be opened.
Here you must <strong>select the database where you want restore the backup</strong>: notice you must declare just a name and a new empty database will be automatically created by the restore procedure, <strong>don't use</strong>:</p>
<ul>
<li><strong>an existent not-empty database</strong></li>
<li><strong>fresh manually-built database</strong></li>
</ul>
<p>Below are reported all the files involved in the restore procedure: the number of files used to restore your database depends on the <strong>backup mode</strong> you chose for the selected backup task.</p>
<p>If the backup belongs to a <strong>Full Backup</strong> schedule, just a file will be involved for each restore procedure.</p>
<p><img src="ee/./images/studio-backup-07-restore-from-full.png" alt="" /></p>
<p>If the backup belongs to an <strong>Incremental Backup</strong> schedule, doesn't matter which file is selected, all the files in the directory will be processed during the restore.</p>
<p><img src="ee/./images/studio-backup-08-restore-from-incremental.png" alt="" /></p>
<p>If you chose a backup belonging to a <strong>Full + Incremental Backup</strong> schedule, then will be evaluated all the files contained in the folder which contains the backup file you selected from the calendar.</p>
<p><img src="ee/./images/studio-backup-09-restore-from-full-incr.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="server-profiler"><a class="header" href="#server-profiler">Server Profiler</a></h1>
<blockquote>
<p>Only users with grant <code>server.metrics</code> can see this section</p>
</blockquote>
<p>This sections contains information about Queries:</p>
<ul>
<li>Real Time queries</li>
<li>Statistics about queries</li>
</ul>
<h3 id="running-queries"><a class="header" href="#running-queries">Running Queries</a></h3>
<p>Displays information about running queries in OrientDB Server. Each query report the following infos:</p>
<ul>
<li><code>Query ID</code>, as the unique query number</li>
<li><code>Session ID</code>, the session id used for the query</li>
<li><code>Database</code>, the database used</li>
<li><code>User</code>, the database user</li>
<li><code>Language</code>, The language used. SQL or Gremlin</li>
<li><code>Statement</code>, the actual text of the query</li>
<li><code>Start Time</code>, when the query was started</li>
<li><code>Elapsed Time</code>, the actual timing of the query in milliseconds</li>
</ul>
<p><img src="ee/./images/studio-query-profiler-running.png" alt="Running" /></p>
<h3 id="queries-stats"><a class="header" href="#queries-stats">Queries stats</a></h3>
<p>Displays statistics about executed queries in OrientDB Server. Each query report the following infos:</p>
<ul>
<li><code>Database</code>, the database used</li>
<li><code>Language</code>, The language used. SQL or Gremlin</li>
<li><code>Query</code>, the actual text of the query</li>
<li><code>Count</code>, how many times the query was executed</li>
<li><code>Min</code>, the minimum execution time of the query</li>
<li><code>Mean</code>, the mean execution time of the query</li>
<li><code>Max</code>, the maximum execution time of the query</li>
</ul>
<p><img src="ee/./images/studio-query-profiler-stats.png" alt="Stats" /></p>
<h2 id="http-apis"><a class="header" href="#http-apis">HTTP APIs</a></h2>
<h3 id="retrieve-running-queries-via-http"><a class="header" href="#retrieve-running-queries-via-http">Retrieve running queries via HTTP</a></h3>
<p>GET | Basic Auth</p>
<pre><code>http://&lt;server&gt;[&lt;:port&gt;]/sqlProfiler/running?server=&lt;name&gt;
</code></pre>
<p>where
<code>&lt;name&gt;</code> : should be the name of the node in case of distributed version of orientdb.</p>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p>Only users with grant <code>server.security</code> can see this section</p>
</blockquote>
<blockquote>
<p><strong>NOTE</strong>: This feature is available only in the <a href="http://orientdb.com/orientdb-enterprise">OrientDB Enterprise Edition</a>. If you are interested in a commercial license look at <a href="http://orientdb.dev/support">OrientDB Subscription Packages</a>.</p>
</blockquote>
<h1 id="security-9"><a class="header" href="#security-9">Security</a></h1>
<p>To understand how Security works, please refer to the <a href="ee/../security/Security.html">Security</a> page.</p>
<p>The configuration of security is stored in the <code>security.json</code> file.</p>
<p>By using the Enterprise edition the configuration of the security can be changed at runtime, via REST APIs or using the Studio EE extension.</p>
<p><img src="ee/./images/studio-security-configuration.png" alt="" /></p>
<p>For a detailed documentation of Security config check the new <a href="ee/../security/Security-OrientDB-New-Security-Features.html">Security Feature</a> page.</p>
<h1 id="auditing-1"><a class="header" href="#auditing-1">Auditing</a></h1>
<p>To understand how Auditing works, please refer to the <a href="ee/./Auditing.html">Auditing</a> page.</p>
<p>By default all the auditing logs are saved as documents of class <code>OAuditingLog</code> in the internal database <code>OSystem</code>. If your account has enough privileges, you can directly query the auditing log. Example on retrieving last 20 logs: <code>select from OAuditingLog order by @rid desc limit 20</code>.</p>
<p>However, Studio provides a panel to filter the Auditing Log messages on a specific server without using SQL.</p>
<p><img src="ee/./images/studio-auditing-log.png" alt="" /></p>
<p>Studio Auditing panel helps you also on Auditing configuration of servers, avoiding to edit the <code>auditing-config.json</code> file under the database folder.</p>
<p><img src="ee/./images/studio-auditing-configuration.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p>Only users with grant <code>server.importers</code> can see this section</p>
</blockquote>
<h1 id="teleporter-2"><a class="header" href="#teleporter-2">Teleporter</a></h1>
<p>In Studio 2.2 you can configure the execution of the new Teleporter plugin, which allows you to import your relational database into OrientDB in few simple steps.
If you are interested in a detailed description of the tool, of its inner workings and features you can view the <a href="ee/../teleporter/Teleporter-Home.html">Teleporter Documentation</a>.</p>
<p><strong>NOTE</strong>: This feature is available both for the <a href="http://orientdb.com/orientdb-enterprise">OrientDB Enterprise Edition</a> and the <a href="http://orientdb.dev/downloads/">OrientDB Community Edition</a>. <strong>But beware</strong>: in <strong>Community Edition</strong> you can migrate your source relational database but <strong>you cannot enjoy the synchronize feature</strong>, only available in the <strong>Enterprise Edition</strong>.</p>
<p>This visual tool consists in a wizard composed of 4 steps, where just <strong>Step 1</strong> and <strong>Step 2</strong> are strictly necessary in order to perform your migration.
Let's have a look at each configuration step.</p>
<h3 id="step-1"><a class="header" href="#step-1">Step 1</a></h3>
<p>In the first step you have to type the following required parameters:</p>
<ul>
<li><code>Database Driver</code>, as the driver name of the DBMS from which you want to execute the import. You have to choose among:
<ul>
<li>Oracle</li>
<li>SQLServer</li>
<li>Mysql</li>
<li>PostgreSQL</li>
<li>HyperSQL</li>
</ul>
</li>
<li><code>Database Host</code>, as the host where your DBMS instance is running on</li>
<li><code>Port</code>, as the port where your DBMS is listening on</li>
<li><code>Database Name</code>, as the name of the source database</li>
<li><code>User Name</code>, as the username to access the source database (it may be blank)</li>
<li><code>Password</code>, as the password to access the source database (it may be blank)</li>
</ul>
<p>After you typed all the required parameters for the migration you can test the connection.</p>
<p><img src="ee/./images/studio-teleporter/studio-teleporter-step1-tryConnection.png" alt="Test Connection" /></p>
<h3 id="step-2"><a class="header" href="#step-2">Step 2</a></h3>
<p>In the second step you have to specify all the parameters about the OrientDB target database:</p>
<ul>
<li><code>Connection protocol</code>, as the protocol adopted to write in OrientDB. You have to choose among:
<ul>
<li>plocal</li>
<li>memory</li>
</ul>
</li>
<li><code>OrientDB Database Name</code>, as the name of the target database in OrientDB</li>
<li><code>Strategy</code>, as the strategy adopted during the migration (<a href="ee/../teleporter/Teleporter-Home.html">More</a> about strategies)</li>
<li><code>Name Resolver</code>, as the basic name resolver to adopt during names' resolution</li>
<li><code>Inheritance descriptor</code>, as the XML file's path. In this descriptor you can report all the info describing inheritance relationships present between the tables in the source database</li>
<li><code>Log Level</code>, as the log level adopted by Teleporter during the migration. You can choose among:
<ul>
<li>NO</li>
<li>DEBUG</li>
<li>INFO</li>
<li>WARNING</li>
<li>ERROR</li>
</ul>
</li>
</ul>
<p><img src="ee/./images/studio-teleporter/studio-teleporter-step2.png" alt="Teleporter Job Running" /></p>
<p>Once we have collected all the minimal info needed for the migration, you can run your configured job through the <code>START MIGRATION</code> button, then the job progress monitor will be displayed:</p>
<p><img src="ee/./images/studio-teleporter/studio-teleporter-job-running.png" alt="Teleporter Job Running" /></p>
<p>At the end of the migration, statistics and warnings about the process are reported as shown below:</p>
<p><img src="ee/./images/studio-teleporter/studio-teleporter-job-completed.png" alt="Teleporter Job Completed" /></p>
<p>Otherwise you can go on in your migrations customisation jumping to the next step.</p>
<h3 id="step-3"><a class="header" href="#step-3">Step 3</a></h3>
<p>Here you can exploit Teleporter's filtering features: in the panel on the left all the tables present in the source database are reported. If you want migrate just a subset of these tables, you just have to select and move them in the right panel through the specific buttons (you can also drag-and-drop the selected items).</p>
<p><img src="ee/./images/studio-teleporter/studio-teleporter-step3-filtering-1.png" alt="Teleporter Job Running" /></p>
<p><img src="ee/./images/studio-teleporter/studio-teleporter-step3-filtering-2.png" alt="Teleporter Job Running" /></p>
<p>You can perform the same operations also in the opposite direction, that is excluding some tables during the migration just moving them from the right panel to the left one.</p>
<p>If the right panel is empty, no filters will be applied. Instead, if the right panel is not empty, just the selected tables in the right panel will be imported while all the others will be filtered out.
Thus, for example, these two configurations are equivalent:</p>
<p><img src="ee/./images/studio-teleporter/studio-teleporter-step3-filtering-3.png" alt="Teleporter Job Running" /></p>
<p><img src="ee/./images/studio-teleporter/studio-teleporter-step3-filtering-4.png" alt="Teleporter Job Running" /></p>
<p>Here too you can start your migration or go to the 4th and last configuration step.</p>
<h3 id="step-4"><a class="header" href="#step-4">Step 4</a></h3>
<p>In the last step Teleporter will provide you a Graph Model coming from the translation of the ER-Model inferred from the source database schema. The correspondent Graph Model is built according to basic mapping rules and your choices as well (filters applied, chosen strategy, name resolver adopted etc.).
This step has two aims:</p>
<ul>
<li>it gives you an idea of how your source database will appear once imported in OrientDB</li>
<li>it allows you to edit the graph model</li>
</ul>
<p><img src="ee/./images/studio-teleporter/studio-teleporter-step4-only-graph.png" alt="Teleporter Job Running" /></p>
<p>You can see two panels, the Graph Model Panel on the left, containing the Graph Model built from Teleporter, and the Details Panel on the right, reporting all the details about the current selected element in the left panel.</p>
<p>The Details Panel is divided into two sections:</p>
<ol>
<li>in the top area you can enjoy a graph perspective of the element selected in the Graph Panel: you can inspect info about the OrientDB schema, like class name and properties.</li>
<li>in the bottom area you have a source-schema perspective, where you got the source-schema items the information above comes from.</li>
</ol>
<p>This step is conceived to make very easy the graph model editing and to change the mapping with the source database schema. In fact you can modify the basic mapping</p>
<ul>
<li>Renaming classes (both for Vertex and Edge classes)</li>
<li>Excluding/re-including a property mapped with a column in the correspondent source table</li>
<li>Adding new properties</li>
<li>Dropping existent properties</li>
<li>Editing properties</li>
<li>Adding new Edge classes and/or instances</li>
<li>Inspecting original schema data, both for tables and relationships</li>
</ul>
<p>Let's have a deeper look at each of these operations.</p>
<h4 id="inspecting-classes-and-source-correspondent-elements"><a class="header" href="#inspecting-classes-and-source-correspondent-elements">Inspecting Classes and source correspondent elements</a></h4>
<p>Via the Details Panel you can inspect information about:</p>
<ol>
<li>Vertex class</li>
</ol>
<p>If you select a Vertex Class, you can inspect the correspondence between each column in the source table and the correspondent property in the translated Vertex class. Columns and properties are strongly bound: you can exclude, include or rename a property, but the bindings with the correspondent column will remain.</p>
<p><img src="ee/./images/studio-teleporter/studio-teleporter-step4-graph+selected-vertex.png" alt="Teleporter Job Running" /></p>
<ol start="2">
<li>Edge Class</li>
</ol>
<p>Everytime you select an edge in the graph, you can find out about the original relationship it comes from in the bottom section in the Details Panel. We can have 2 kinds of relationships, and coherently 2 kinds of edge rendering.</p>
<ul>
<li>
<p>1-N Relationship</p>
<p>Edges coming from 1-N Relationships are represented through a continuous arrow.</p>
</li>
</ul>
<p><img src="ee/./images/studio-teleporter/studio-teleporter-step4-simple-edge-rendering.png" alt="Teleporter Job Running" /></p>
<p>The rendered Relationship involves just two tables of course, the starting table (aka <strong>foreign table</strong>) and the arrival table (aka <strong>parent table</strong>). Clicking the question mark you can also see for each table all the columns involved in the relationship.</p>
<p align="center">
<img src="ee/./images/studio-teleporter/studio-teleporter-step4-simple-edge-rel-view.png" width="580" height="628" />
</p>
<ul>
<li>
<p>N-N Relationship</p>
<p>Let's suppose you have got the following graph, obtained performing join tables aggregation through the naive-aggregate strategy.</p>
</li>
</ul>
<p><img src="ee/./images/studio-teleporter/studio-teleporter-step4-aggregated-graph+legend.png" alt="Teleporter Job Running" /></p>
<p>Edges coming from N-N Relationships are represented through a dashed arrow and in the bottom you can see the 2 relationships involving two external tables and the join table between them.</p>
<p><img src="ee/./images/studio-teleporter/studio-teleporter-step4-aggr-edge-rendering.png" alt="Teleporter Job Running" /></p>
<p>Here too, clicking the question mark you can inspect the involved columns for both the relationships.</p>
<p align="center">
<img src="ee/./images/studio-teleporter/studio-teleporter-step4-aggr-edge-rel-view-1.png" width="430" height="465" /> <img src="ee/./images/studio-teleporter/studio-teleporter-step4-aggr-edge-rel-view-2.png" width="430" height="465" />
</p>
<h4 id="search-bar"><a class="header" href="#search-bar">Search Bar</a></h4>
<p>In the Graph Panel a useful search bar is provided to allow you fast vertex selection according to the vertex class name or the source table name.</p>
<p><img src="ee/./images/studio-teleporter/studio-teleporter-step4-search-bar.png" alt="Teleporter Job Running" /></p>
<p>In the example above you can see that for each class we have two items, the vertex class name and the source table name. In this case each couple of items are equal because no classes were renamed nor a name resolver was adoted during the basic graph model building.</p>
<h4 id="class-renaming"><a class="header" href="#class-renaming">Class Renaming</a></h4>
<p>You can rename a class just selecting an element in the graph (vertex or edge) and clicking the "Rename Class" button in the "Edit Class" dropdown menu.</p>
<p><img src="ee/./images/studio-teleporter/studio-teleporter-step4-rename-class-button.png" alt="Teleporter Job Running" /></p>
<p>Then you just have to choose the new name for the specific class.</p>
<p><img src="ee/./images/studio-teleporter/studio-teleporter-step4-rename-class-modal.png" alt="Teleporter Job Running" /></p>
<p>The class name will be updated in the graph, in the search bar and in the Details Panel of course.</p>
<h4 id="property-excluding"><a class="header" href="#property-excluding">Property Excluding</a></h4>
<p>We have two ways to exclude a property mapped with a column in the source table:</p>
<ol>
<li>
<p>Unflagging the correspondent column name in the source table perspective.</p>
</li>
<li>
<p>Dropping the property from the class perspective.</p>
</li>
</ol>
<p align="center">
<img src="ee/./images/studio-teleporter/studio-teleporter-step4-excluded-props.png" width="580" height="628" />
</p>
<h4 id="property-dropping"><a class="header" href="#property-dropping">Property Dropping</a></h4>
<p>You can also drop a property via the specific button.</p>
<p><img src="ee/./images/studio-teleporter/studio-teleporter-step4-drop-prop-modal.png" alt="Teleporter Job Running" /></p>
<p>You can have 2 different behaviours depending on whether the property is bound with a column in the source table or not.</p>
<ul>
<li>
<p>If the property is bound with a source column, when you drop it you will get the same result as when you exclude it, so it will not be migrated in OrientDB but you can always include it again, as the binding is not deleted at all.</p>
</li>
<li>
<p>If the property is not bound with a source column, then when you drop it the property will be definitively deleted.</p>
</li>
</ul>
<h4 id="property-adding"><a class="header" href="#property-adding">Property Adding</a></h4>
<p>You can add new properties just clicking the "Add property" button in the "Edit Class" dropdown menu.</p>
<p><img src="ee/./images/studio-teleporter/studio-teleporter-step4-add-prop-button.png" alt="Teleporter Job Running" /></p>
<p>In the just opened window you can choose to add a new property never defined before, selecting the "Add new property" radio button,</p>
<p><img src="ee/./images/studio-teleporter/studio-teleporter-step4-add-prop-modal1.png" alt="Teleporter Job Running" /></p>
<p>or re-include some excluded properties if any, selecting the "Include Property" radio button.</p>
<p><img src="ee/./images/studio-teleporter/studio-teleporter-step4-add-prop-modal2.png" alt="Teleporter Job Running" /></p>
<h4 id="property-editing"><a class="header" href="#property-editing">Property Editing</a></h4>
<p>You can also edit an existing property: you can choose a different name, type, or just add/remove some constraints.</p>
<p><img src="ee/./images/studio-teleporter/studio-teleporter-step4-edit-prop-modal.png" alt="Teleporter Job Running" /></p>
<h4 id="property-including"><a class="header" href="#property-including">Property Including</a></h4>
<p>We have two ways to include a property mapped with a column in the source table:</p>
<ol>
<li>
<p>Flagging the correspondent column name in the source table perspective.</p>
</li>
<li>
<p>Including the property from the OrientDB class perspective through the "Add property" button as shown above.</p>
</li>
</ol>
<p align="center">
<img src="ee/./images/studio-teleporter/studio-teleporter-step4-reincluded-props.png" width="580" height="628" />
</p>
<h4 id="edge-adding"><a class="header" href="#edge-adding">Edge Adding</a></h4>
<p>Often you need to add an edge in your graph model, if it's missing for some reason.
For example, if you didn't defined some foreign keys between the tables on which you usually perform join operations, you will lose this kind of info during the importing process and you will not have any edges in your final Graph Database.
Sometimes you just want to enrich the model adding new edges.
In both the cases you have to select a vertex in the graph and then click the "Add Edge" button in the "Action" dropdown menu.</p>
<p><img src="ee/./images/studio-teleporter/studio-teleporter-step4-add-edge-button.png" alt="Teleporter Job Running" /></p>
<p>Then you have to drag the edge till the target vertex and click over it.</p>
<p><img src="ee/./images/studio-teleporter/studio-teleporter-step4-add-edge-drag.png" alt="Teleporter Job Running" /></p>
<p>A new window will open where you have to specify the name of the Edge class for the new edge instance and some mapping info:</p>
<ul>
<li>fromTable: the foreign table that imports the primary key of the parent table.</li>
<li>fromColumns: the attributes involved in the foreign key.</li>
<li>toTable: the parent table whose primary key is imported by the foreign table.</li>
<li>toColumns: the attributes involved in the imported primary key.</li>
</ul>
<p>As said above, when we want to create a new edge instance, we can create a new Edge class</p>
<p><img src="ee/./images/studio-teleporter/studio-teleporter-step4-add-edge-modal1.png" alt="Teleporter Job Running" /></p>
<p>or just choose a preexisting Edge class</p>
<p><img src="ee/./images/studio-teleporter/studio-teleporter-step4-add-edge-modal2.png" alt="Teleporter Job Running" /></p>
<h4 id="edge-dropping"><a class="header" href="#edge-dropping">Edge Dropping</a></h4>
<p>When you select an edge in the graph model, you have 2 choices:</p>
<ol>
<li>Delete the Edge class with all its instances</li>
</ol>
<p><img src="ee/./images/studio-teleporter/studio-teleporter-step4-drop-edge-class.png" alt="Teleporter Job Running" /></p>
<ol start="2">
<li>Delete only the selected instance of the specific Edge Class</li>
</ol>
<p><img src="ee/./images/studio-teleporter/studio-teleporter-step4-drop-edge-instance.png" alt="Teleporter Job Running" /></p>
<div style="break-before: page; page-break-before: always;"></div><blockquote>
<p>Only users with grant <code>server.importers</code> can see this section</p>
</blockquote>
<h1 id="neo4j-to-orientdb-importer-1"><a class="header" href="#neo4j-to-orientdb-importer-1">Neo4j to OrientDB Importer</a></h1>
<p>In Studio 2.2 you can configure the execution of a new plugin, which allows you to import your Neo4j database into OrientDB in few simple steps.</p>
<p>Imported neo4j items are:</p>
<ul>
<li>nodes</li>
<li>relationships</li>
<li>unique constraints</li>
<li>indexes</li>
</ul>
<p><strong>NOTE</strong>: This feature is available both for the <a href="http://orientdb.com/orientdb-enterprise">OrientDB Enterprise Edition</a> and the <a href="http://orientdb.dev/downloads/">OrientDB Community Edition</a>.</p>
<p>This visual tool consists in a wizard composed of 2 simple steps.
Let's have a look at each configuration step.</p>
<h3 id="step-1-1"><a class="header" href="#step-1-1">Step 1</a></h3>
<p>In the first step you have to type the following required parameters:</p>
<ul>
<li><code>Database Host</code>, as the address of the host where the neo4j server is available</li>
<li><code>Port</code>, as the port where your neo4j server is listening for new connections via the bolt binary protocol (default port is 7687)</li>
<li><code>User Name</code>, as the username to access the neo4j server</li>
<li><code>Password</code>, as the password to access the neo4j server</li>
</ul>
<p>After you typed all the required parameters for the migration you can test the connection with the source database.</p>
<p><img src="ee/./images/studio-neo4j-importer/studio-neo4jimporter-step1-tryConnection.png" alt="Test Connection" /></p>
<h3 id="step-2-1"><a class="header" href="#step-2-1">Step 2</a></h3>
<p>In the second step you have to specify the parameters about the OrientDB target database and some additional info:</p>
<ul>
<li><code>Connection protocol</code>, as the protocol adopted during the migration in order to connect to OrientDB. You have to choose among:
<ul>
<li>plocal: persistent disk-based, where the access is made in the same JVM process</li>
<li>memory: all data remain in memory</li>
</ul>
</li>
<li><code>OrientDB Database Name</code>, as the target database name where the Neo4j database will be migrated. The database will be created by the import tool if not present. In case the database already exists, the Neo4j to OrientDB Importer will behave accordingly to the checkbox below.</li>
<li><code>Log Level</code>, as the level of verbosity printed to the output during the execution. You can choose among:
<ul>
<li>NO</li>
<li>DEBUG</li>
<li>INFO</li>
<li>WARNING</li>
<li>ERROR</li>
</ul>
</li>
<li><code>Overwrite Database</code>, checkbox to overwrite OrientDB target database if it already exists.</li>
<li><code>Create indices on edges</code>, checkbox to create indices on imported edges in OrientDB. In this way an index will be built for each Edge class on <code>'Neo4jRelId'</code> property.</li>
</ul>
<p><img src="ee/./images/studio-neo4j-importer/studio-neo4jimporter-step2.png" alt="Neo4jImporter Step 2" /></p>
<p>Once we have collected all the info, you can run your configured job through the <code>START MIGRATION</code> button, then the job progress monitor will be displayed:</p>
<p><img src="ee/./images/studio-neo4j-importer/studio-neo4jimporter-job-running.png" alt="Job Running" /></p>
<p>At the end of the migration, statistics about the process are reported as shown below:</p>
<p><img src="ee/./images/studio-neo4j-importer/studio-neo4jimporter-job-completed.png" alt="Migration Job Completed" /></p>
<h3 id="migration-details-1"><a class="header" href="#migration-details-1">Migration Details</a></h3>
<p>Internally, the <em>Neo4j to OrientDB Importer</em> makes use of:</p>
<ul>
<li>the Neo4j's bolt connector based on the the Bolt binary protocol to read the graph database from Neo4j</li>
<li>the OrientDB's java API to store the graph into OrientDB</li>
</ul>
<p>The migration consists of four phases:</p>
<ul>
<li><strong>Phase 1</strong>: Connection initialization to Neo4j</li>
<li><strong>Phase 2</strong>: Migration of nodes and relationships present in the source graph database</li>
<li><strong>Phase 3</strong>: Schema migration</li>
<li><strong>Phase 4</strong>: Shutdown of the connection to Neo4j and summary info reporting</li>
</ul>
<h4 id="general-migration-details-1"><a class="header" href="#general-migration-details-1">General Migration Details</a></h4>
<p>The following are some general migration details that is good to keep in mind:</p>
<ul>
<li>
<p>In case a node in Neo4j has no <em>Label</em>, it will be imported in OrientDB into the Class <em>"GenericClassNeo4jConversion"</em>.</p>
</li>
<li>
<p>In case a node in Neo4j has multiple <em>Labels</em>, it will be imported into the <code>Class</code> <em>"MultipleLabelNeo4jConversion"</em>.</p>
</li>
<li>
<p>List of original Neo4j <em>Labels</em> are stored as properties in the imported OrientDB vertices (property: <em>"Neo4jLabelList"</em>).</p>
</li>
<li>
<p>During the import, a not unique index is created on the property <em>"Neo4jLabelList"</em>. This allows you to query by <em>Label</em> even over nodes migrated into the single <code>Class</code> <em>"MultipleLabelNeo4jConversion"</em>, using queries like:
<code>SELECT FROM V WHERE Neo4jLabelList CONTAINS 'your_label_here'</code> or the equivalent with the <a href="ee/../../sql/SQL-Match.html">MATCH</a> syntax: <code>MATCH {class: V, as: your_alias, where: (Neo4jLabelList CONTAINS 'your_label'} RETURN your_alias</code>.</p>
</li>
<li>
<p>Original Neo4j <code>IDs</code> are stored as properties in the imported OrientDB vertices and edges (<code>Neo4jNodeID</code> for vertices and <code>Neo4jRelID</code> for edges). Such properties can be (manually) removed at the end of the import, if not needed.</p>
</li>
<li>
<p>During the import, an OrientDB index is created on the property <code>Neo4jNodeID</code> for all imported vertex <code>classes</code> (node's <em>Labels</em> in Neo4j). This is to speed up vertices lookup during edge creation. The created indexes can be (manually) removed at the end of the import, if not needed.</p>
</li>
<li>
<p>In case a Neo4j Relationship has the same name of a Neo4j <em>Label</em>, e.g. <em>"RelationshipName"</em>, the <em>Neo4j to OrientDB Importer</em> will import that relationship into OrientDB in the class <code>E_RelationshipName</code> (i.e. prefixing the Neo4j's <code>RelationshipType</code> with an <code>E_</code>).</p>
</li>
<li>
<p>Neo4j Nodes with same <em>Label</em> but different case, e.g. <em>LABEL</em> and <em>LAbel</em> will be aggregated into a single OrientDB vertex <code>Class</code>.</p>
</li>
<li>
<p>Neo4j Relationship with same name but different case, e.g. <em>relaTIONship</em> and <em>RELATIONSHIP</em> will be aggregated into a single OrientDB edge <code>Class</code></p>
</li>
<li>
<p>Migration of Neo4j's <em>"existence"</em> constraints (only available in the Neo4j's Enterprise Edition) is currently not implemented.</p>
</li>
<li>
<p>During the creation of properties in OrientDB, Neo4j <code>Char</code> data type is mapped to a <code>String</code> data type.</p>
</li>
</ul>
<h4 id="details-about-schema-migration"><a class="header" href="#details-about-schema-migration">Details about Schema Migration</a></h4>
<p>The following are some schema-specific migration details that is good to keep in mind:</p>
<ul>
<li>
<p>If in Neo4j there are no constraints nor indexes, and if after we drop, after the migration, the properties and indexes created for internal purposes (<code>Neo4jNodeID</code>, <code>Neo4jRelID</code>, <code>Neo4jLabelList</code> and corresponding indexes), the imported OrientDB database is schemaless.</p>
</li>
<li>
<p>If in Neo4j there are constraints or indexes, the imported OrientDB database is schema-hybrid (with some properties defined). In particular, for any constraint and index:</p>
<pre><code>	- The Neo4j property where the constraint or index is defined on, is determined.

	- A corresponding property is created in OrientDB (hence the schema-hybrid mode).
</code></pre>
</li>
<li>
<p>If a Neo4j unique constraint is found, a corresponding unique index is created in OrientDB</p>
<pre><code>	- In case the creation of the unique index fails, a not unique index will be created. Note: this scenario can happen, by design, when migrating nodes that have multiple _Labels_, as they are imported into a single vertex `Class`).
</code></pre>
</li>
<li>
<p>If a Neo4j index is found, a corresponding (not unique) OrientDB index is created.</p>
</li>
</ul>
<h4 id="migration-best-practices-1"><a class="header" href="#migration-best-practices-1">Migration Best Practices</a></h4>
<p>According to the migration logic shown so far, we can define the following best practices, adoptable before the migration towards OrientDB:</p>
<ol>
<li>
<p>Check if you are using <em>Labels</em> with same name but different case, e.g. <em>LABEL</em> and <em>LAbel</em> and if you really need them. If the correct <em>Label</em> is <em>Label</em>, change <em>LABEL</em> and <em>LAbel</em> to <em>Label</em> in the original Neo4j database before the import. If you really cannot change them, be aware that with the current version of the Neo4j to OrientDB Importer such nodes will be aggregated into a single OrientDB vertex <code>Class</code>.</p>
</li>
<li>
<p>Check if you are using relationships with same name but different case, e.g. <em>relaTIONship</em> and <em>RELATIONSHIP</em> and if you really need them. If the correct relationship is <em>Relationship</em>, change <em>relaTIONship</em> and <em>RELATIONSHIP</em> to <em>Relationship</em> before the import. If you really cannot change them, be aware that with the current version of the Neo4j to OrientDB Importer such relationships will be aggregated into a single OrientDB edge <code>Class</code>.</p>
</li>
<li>
<p>Check your constraints and indexes before starting the import. Sometime you have more constraints or indexes than needed, e.g. old ones that you created on <em>Labels</em> that you are not using anymore. These constraints will be migrated as well, so a best practice is to check that you have defined, in Neo4j, only those that you really want to import. To check constraints and indexes in Neo4j, you can type <code>:schema</code> in the Browser and then click on the "play" icon. Please delete the not needed items.</p>
</li>
<li>
<p>Check if you are using nodes with multiple <em>Labels</em>, and if you really need more than one <em>Label</em> on them. Be aware that with current version of the Neo4j to OrientDB Importer such nodes with multiple <em>Labels</em> will be imported into a single OrientDB <code>Class</code> ("<em>MultipleLabelNeo4jConversion</em>").</p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="profiler-2"><a class="header" href="#profiler-2">Profiler</a></h1>
<p><a href="ee/../ee/Enterprise-Edition.html">OrientDB Enterprise Edition</a> comes with a profiler that collects all the metrics about the engine and the system where is running. Studio uses the profiler API as source for the <a href="ee/./Dashboard.html">Dashboard</a> and can be configured in the <a href="ee/./Settings.html">Settings</a> section.</p>
<p>Profiler is available through Studio or HTTP APIs<br />
to server user that has those permissions</p>
<ul>
<li><code>server.metrics</code> (Read)</li>
<li><code>server.metrics.edit</code> (Write)</li>
</ul>
<h2 id="configuration-11"><a class="header" href="#configuration-11">Configuration</a></h2>
<p>The profiler is configured via <code>JSON</code> file, located  <code>${ORIENTDB_HOME}/config/profiler.json</code> the  Enterprise distribution</p>
<p>Example of configuration</p>
<pre><code class="language-JSON">{
  "enabled": true,
  "server": {
    "enabled": true
  },
  "database": {
    "enabled": true
  },
  "cluster": {
    "enabled": false
  },
  "reporters": {
    "jmx": {
      "enabled": false,
      "domain": "Test"
    },
    "console": {
      "enabled": false,
      "interval": 5000
    },
    "csv": {
      "enabled": false,
      "directory": "/tmp/orientdb-server-metrics.csv",
      "interval": 5000
    },
    "prometheus": {
      "enabled": false
    }
  }
}
</code></pre>
<p>The profiler is divided in 3 sections which can be enabled/disabled</p>
<ul>
<li>Database metrics</li>
<li>Server metrics</li>
<li>Cluster metrics</li>
</ul>
<h3 id="database-metrics"><a class="header" href="#database-metrics">Database metrics</a></h3>
<p>The suffix is <code>db.&lt;dbName&gt;.*</code></p>
<p>These metrics contains statistics on crud operations and queries and are recorded for each database in the server.</p>
<h3 id="server-metrics"><a class="header" href="#server-metrics">Server Metrics</a></h3>
<p>The suffix is <code>server.*</code></p>
<p>These metrics contains information on the status and health of the server such as</p>
<ul>
<li>Memory metrics</li>
<li>Disk metrics</li>
<li>Disk Cache</li>
<li>CPU stats</li>
<li>GC activity</li>
<li>Threads</li>
<li>Network requests</li>
<li>Active sessions</li>
<li>....</li>
</ul>
<h3 id="cluster-metrics"><a class="header" href="#cluster-metrics">Cluster metrics</a></h3>
<p>The suffix is <code>distributed.*</code></p>
<p>These metrics contains information on the status of nodes in the cluster and latencies</p>
<h3 id="reporters"><a class="header" href="#reporters">Reporters</a></h3>
<p>The profiler supports different outputs that can  be configured in the reporters section:</p>
<ul>
<li>CSV</li>
<li>JMX</li>
<li>Console</li>
<li>Prometheus</li>
</ul>
<p>The profiler also expose custom HTTP api to server users with right permissions</p>
<h2 id="http-apis-1"><a class="header" href="#http-apis-1">HTTP APIs</a></h2>
<h3 id="retrieve-profiler-metrics-via-http-1"><a class="header" href="#retrieve-profiler-metrics-via-http-1">Retrieve profiler metrics via HTTP</a></h3>
<p>GET | Basic Auth</p>
<pre><code>http://&lt;server&gt;[&lt;:port&gt;]/metrics
</code></pre>
<p>Retrieve stats recorded by the profiler</p>
<h3 id="prometheus-endpoint"><a class="header" href="#prometheus-endpoint">Prometheus endpoint</a></h3>
<p>If it is enabled as reporter</p>
<p>GET | Basic Auth</p>
<pre><code>http://&lt;server&gt;[&lt;:port&gt;]/metrics/prometheus
</code></pre>
<p>Retrieve stats recorded by the profiler with prometheus format</p>
<h3 id="retrieve-profiler-configuration"><a class="header" href="#retrieve-profiler-configuration">Retrieve profiler configuration</a></h3>
<p>GET | Basic Auth</p>
<pre><code>http://&lt;server&gt;[&lt;:port&gt;]/metrics/config
</code></pre>
<h3 id="change-profiler-configuration"><a class="header" href="#change-profiler-configuration">Change profiler configuration</a></h3>
<p>POST | Basic Auth</p>
<pre><code>http://&lt;server&gt;[&lt;:port&gt;]/metrics/config
</code></pre>
<p>with configuration as JSON body</p>
<h3 id="get-the-list-of-available-metrics-with-description"><a class="header" href="#get-the-list-of-available-metrics-with-description">Get the list of available metrics with description</a></h3>
<p>GET | Basic Auth</p>
<pre><code>http://&lt;server&gt;[&lt;:port&gt;]/metrics/list
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="auditing-2"><a class="header" href="#auditing-2">Auditing</a></h1>
<p>Starting in OrientDB 2.1, the Auditing component is part of the <a href="http://www.orientechnologies.com/orientdb-enterprise/">Enterprise Edition</a>. This page refers to the Auditing feature and how to work with it. The Studio web tool provides a GUI for Auditing that makes configuration easier. Look at the <a href="ee/../studio/server-management/Studio-Auditing.html">Auditing page in Studio</a>.</p>
<p>By default all the auditing logs are saved as documents of class <code>AuditingLog</code>. If your account has enough privileges, you can directly query the auditing log. Example on retrieving the last 20 logs: <code>select from AuditingLog order by @rid desc limit 20</code>.</p>
<p><strong>OrientDB 2.2</strong>
Starting in OrientDB 2.2, all auditing logs are now stored in the <a href="ee/../internals/System-Database.html">system database</a>.  The auditing log for each database is stored in a derived class of the <code>AuditingLog</code> class with this format: <em>databaseName</em>OAuditingLog.</p>
<p>As an example, if you have a database called <em>MyDB</em>, then the class name will be <code>MyDBOAuditingLog</code>.</p>
<p>Using the previous example to retrieve the last 20 log entries for a specific database, do this from within the system database:
<code>select from MyDBOAuditingLog order by @rid desc limit 20</code></p>
<h2 id="security-first"><a class="header" href="#security-first">Security First</a></h2>
<p>For security reasons, no roles should be able to access the <code>AuditingLog</code> records. For this reason before using Auditing assure to revoke any privilege on the <code>AuditingLog</code> cluster. You can do that from Studio, security panel, or via SQL by using the <a href="ee/../sql/SQL-Revoke.html">SQL REVOKE</a> command. Here's an example of revoking any access to the writer and reader roles:</p>
<pre><code class="language-sql">REVOKE ALL ON database.cluster.auditinglog FROM writer
REVOKE ALL ON database.cluster.auditinglog FROM reader
</code></pre>
<p><strong>OrientDB 2.2</strong>
This is no longer required starting in 2.2, since all auditing logs are stored in the system database.  No local database user has access to the auditing logs stored in the system database.  To grant access, a <a href="ee/../internals/System-Users.html"><em>system user</em></a> must be created in the system database with the appropriate role and permissions.</p>
<h2 id="polymorphism-1"><a class="header" href="#polymorphism-1">Polymorphism</a></h2>
<p>OrientDB schema is polymorphic (taken from the Object-Oriented paradigm). This means that if you have the class "Person" and the two classes "Employee" and "Provider" that extend "Person", all the auditing settings on "Person" will be inherited by "Employee" and "Provider" (if the checkbox "polymorphic" is enabled on class "Person").</p>
<p>This makes your life easier when you want to profile only certain classes. For example, you could create an abstract class "Profiled" and let all the classes you want to profile extend it. Starting from v2.1, OrientDB supports multiple inheritance, so it's not a problem extending more classes.</p>
<h2 id="securityjson-configuration"><a class="header" href="#securityjson-configuration">security.json Configuration</a></h2>
<p>There are two parts to enabling and configuring the auditing component.  Starting in OrientDB 2.2, there is a <code>security.json</code> configuration file that resides under the <code>config</code> folder.  See the <a href="ee/../security/Security-Config.html">OrientDB Security Configuration</a> documentation for more details.</p>
<p>The "auditing" section of the <code>security.json</code> file must be enabled for auditing to work.</p>
<p>Note the additional "distributed" section of "auditing" for logging distributed node events.</p>
<h2 id="auditing-configjson-configuration"><a class="header" href="#auditing-configjson-configuration">auditing-config.json Configuration</a></h2>
<p>To configure auditing of a database, create a JSON configuration file with the name <code>auditing-config.json</code> under the database folder. This is the syntax for configuration:</p>
<pre><code class="language-json">{
  "classes": {
    "&lt;class-name&gt;" : {
      "polymorphic": &lt;true|false&gt;,
      "onCreateEnabled": &lt;true|false&gt;, "onCreateMessage": "&lt;message&gt;",
      "onReadEnabled": &lt;true|false&gt;, "onReadMessage": "&lt;message&gt;",
      "onUpdateEnabled": &lt;true|false&gt;, "onUpdateMessage": "&lt;message&gt;",
      "onUpdateChanges": &lt;true|false&gt;,
      "onDeleteEnabled": &lt;true|false&gt;, "onDeleteMessage": "&lt;message&gt;"
    }
  },
  "commands": [
    {
      "regex": "&lt;regexp to match&gt;",
      "message": "&lt;message&gt;"
    }
  ],
  "schema": {
      "onCreateClassEnabled": &lt;true|false&gt;, "onCreateClassMessage": "&lt;message&gt;",
      "onDropClassEnabled": &lt;true|false&gt;, "onDropClassMessage": "&lt;message&gt;"
  }
}
</code></pre>
<h3 id="classes-5"><a class="header" href="#classes-5">"classes"</a></h3>
<p>Where:</p>
<ul>
<li><code>classes</code>: contains the mapping per class. A wildcard <code>*</code> represents any class.</li>
<li><code>class-name</code>: class name to configure.</li>
<li><code>polymorphic</code>: If <code>true</code>, the auditing log also uses this class definition for all sub-classes. By default, the class definition is polymorphic.</li>
<li><code>onCreateEnabled</code>: If <code>true</code>, enables auditing of record creation events. Default is <code>false</code>.</li>
<li><code>onCreateMessage</code>: A custom message stored in the <code>note</code> field of the auditing record on create record events. It supports the dynamic binding of values, see "Customizing the Message", below.</li>
<li><code>onReadEnabled</code>: If <code>true</code>, enables auditing of record reading events. Default is <code>false</code>.</li>
<li><code>onReadMessage</code>: A custom message stored in the <code>note</code> field of the auditing record on read record events. It supports the dynamic binding of values, see "Customizing the Message", below.</li>
<li><code>onUpdateEnabled</code>: If <code>true</code>, enables auditing of record updating events. Default is <code>false</code>.</li>
<li><code>onUpdateMessage</code>: A custom message stored in the <code>note</code> field of the auditing record on update record events. It supports the dynamic binding of values, see "Customizing the Message", below.</li>
<li><code>onUpdateChanges</code>: If <code>true</code>, records all the changed field values in the <code>changes</code> property. The default is <code>true</code> if <code>onUpdateEnabled</code> is true.</li>
<li><code>onDeleteEnabled</code>: If <code>true</code>, enables auditing of delete record events. The default is <code>false</code>.</li>
<li><code>onDeleteMessage</code>: A custom message stored in the <code>note</code> field of the auditing record on delete record events. It supports the dynamic binding of values, see "Customizing the Message", below.</li>
</ul>
<h4 id="customising-the-message"><a class="header" href="#customising-the-message">Customising the Message</a></h4>
<ul>
<li><code>${field.&lt;field-name&gt;}</code>, to use the field value. Example: <code>${field.surname}</code> to get the field "surname" from the current record in case of CRUD Auditing of classes.</li>
</ul>
<p>Example to log all the delete operations (<code>class="*"</code>), and log all the CRUD operation on any vertex (<code>class="V" and polymorphic:true</code>):</p>
<pre><code class="language-json">{
  "classes": {
    "*" : {
      "onDeleteEnabled": true, "onDeleteMessage": "Deleted record of class ${field.@class}"
    },
    "V" : {
      "polymorphic": true,
      "onCreateEnabled": true, "onCreateMessage": "Created vertex of class ${field.@class}",
      "onReadEnabled": true, "onReadMessage": "Read vertex of class ${field.@class}",
      "onUpdateEnabled": true, "onUpdateMessage": "Updated vertex of class ${field.@class}",
      "onDeleteEnabled": true, "onDeleteMessage": "Deleted vertex of class ${field.@class}"
    }
  }
}
</code></pre>
<h3 id="commands"><a class="header" href="#commands">"commands"</a></h3>
<p>Where:</p>
<ul>
<li><code>regexp</code>: If a command is executed that matches the regular expression then the command is logged.</li>
<li><code>message</code>: The optional message that's recorded when the command is logged. It supports the dynamic binding of values, see "Customizing the Message", below.</li>
</ul>
<h4 id="customizing-the-message"><a class="header" href="#customizing-the-message">Customizing the Message</a></h4>
<ul>
<li>The variable <code>${command}</code> will be substituted in the specified message, if command auditing is enabled.</li>
</ul>
<p>Example:
If you want to get all commands regarding update query, you can use standard Java regular expressions (<a href="https://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html">see documentation</a>):</p>
<ul>
<li>Regex: <code>^update.*</code></li>
<li>Message: <code>Following update: ${command} executed.</code></li>
</ul>
<p>under "Command Auditing" section.</p>
<h3 id="schema-6"><a class="header" href="#schema-6">"schema"</a></h3>
<p>Where:</p>
<ul>
<li><code>onCreateClassEnabled</code>: If <code>true</code>, enables auditing of class creation events. The default is <code>false</code>.</li>
<li><code>onCreateClassMessage</code>: A custom message stored in the <code>note</code> field of the auditing record on class creation events. It supports the dynamic binding of values, look at <a href="ee/Auditing.html#customizing-the-message">Customize the message</a>.</li>
<li><code>onDropClassEnabled</code>: If <code>true</code>, enables auditing of class drop events. The default is <code>false</code>.</li>
<li><code>onDropClassMessage</code>: A custom message stored in the <code>note</code> field of the auditing record on drop class events. It supports the dynamic binding of values, look at <a href="ee/Auditing.html#customizing-the-message">Customize the message</a>.</li>
</ul>
<h4 id="customizing-the-message-1"><a class="header" href="#customizing-the-message-1">Customizing the Message</a></h4>
<ul>
<li>The variable <code>${class}</code> will be substituted in the specified message, if create class or drop class auditing is enabled.</li>
</ul>
<h2 id="log-record-structure"><a class="header" href="#log-record-structure">Log record structure</a></h2>
<p>Auditing Log records have the following structure:</p>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Description</th><th>Values</th></tr></thead><tbody>
<tr><td><code>date</code></td><td>DATE</td><td>Date of execution</td><td>-</td></tr>
<tr><td><code>user</code></td><td>LINK</td><td>User that executed the command. Can be <code>null</code> if internal user has been used</td><td>-</td></tr>
<tr><td><code>operation</code></td><td>BYTE</td><td>Type of operation</td><td>0=READ, 1=UPDATE, 2=DELETE, 3=CREATE, 4=COMMAND</td></tr>
<tr><td><code>record</code></td><td>LINK</td><td>Link to the record subject of the log</td><td>-</td></tr>
<tr><td><code>note</code></td><td>STRING</td><td>Optional message</td><td>-</td></tr>
<tr><td><code>changes</code></td><td>MAP</td><td>Only for UPDATE operation, contains the map of changed fields in the form <code>{"from":&lt;old-value&gt;, "to":&lt;new-value&gt;}</code></td><td>-</td></tr>
</tbody></table>
</div>
<p><strong>OrientDB 2.2</strong>
Starting in 2.2, the <em>AuditingLog</em> class has changed slightly.</p>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Description</th><th>Values</th></tr></thead><tbody>
<tr><td><code>database</code></td><td>STRING</td><td>The name of the database of the logging event.</td><td>-</td></tr>
<tr><td><code>date</code></td><td>DATE</td><td>Date of execution</td><td>-</td></tr>
<tr><td><code>user</code></td><td>STRING</td><td>The name of the user that executed the command.  This type has changed to a String and now supports system users.</td><td>-</td></tr>
<tr><td><code>operation</code></td><td>BYTE</td><td>Type of operation</td><td>0=READ, 1=UPDATE, 2=DELETE, 3=CREATE, 4=COMMAND</td></tr>
<tr><td><code>record</code></td><td>LINK</td><td>Link to the record subject of the log.</td><td>-</td></tr>
<tr><td><code>note</code></td><td>STRING</td><td>Optional message</td><td>-</td></tr>
<tr><td><code>changes</code></td><td>MAP</td><td>Only for UPDATE operation, contains the map of changed fields in the form <code>{"from":&lt;old-value&gt;, "to":&lt;new-value&gt;}</code></td><td>-</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="studio-settings"><a class="header" href="#studio-settings">Studio Settings</a></h1>
<p>This section contains two sub-sections</p>
<ul>
<li>Profiler configuration</li>
<li>Permissions</li>
</ul>
<h2 id="profiler-configuration"><a class="header" href="#profiler-configuration">Profiler Configuration</a></h2>
<blockquote>
<p>Only users with grant <code>server.metrics</code> can see this section</p>
</blockquote>
<p>The profiler can be configured also from the UI in this tab.</p>
<p>This page contains also all the metrics that are currently being monitored with the assosciated description.</p>
<p><img src="ee/./images/studio-settings-profiler.png" alt="" /></p>
<h2 id="permissions"><a class="header" href="#permissions">Permissions</a></h2>
<blockquote>
<p>Only users with grant <code>server.permissions</code> can see this section</p>
</blockquote>
<p>Here are listed all permissions for Enterprise Features with description.</p>
<p><img src="ee/./images/studio-settings-permissions.png" alt="" /></p>
<p>Those permissions can be configured in the OrientDB configuration file. See [here](../security/Se  rver-Security.md)</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="internals-2"><a class="header" href="#internals-2">Internals</a></h1>
<p>This section contains internal technical information. Users usually are not interested to such technical details, but if you want to hack OrientDB or become a contributor this information could be useful.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-system-database"><a class="header" href="#orientdb-system-database">OrientDB System Database</a></h1>
<p>Introduced in 2.2, OrientDB now uses a "system database" to provide additional capabilities.</p>
<p>The system database, currently named <em>OSystem</em>, is created when the OrientDB server starts, if the database does not exist.</p>
<h2 id="features-1"><a class="header" href="#features-1">Features</a></h2>
<p>Here's a list of some of the features that the system database may support:</p>
<ul>
<li>A new class of user called the <em>system user</em></li>
<li>A centralized location for configuration files</li>
<li>Logging of per-database and global auditing events</li>
<li>Recording performance metrics about the server and its databases</li>
</ul>
<h3 id="system-users"><a class="header" href="#system-users">System Users</a></h3>
<p>A third type of user now exists, called a <em>system user</em>.  A <em>system user</em> is similar in concept to a <em>server user</em> but resides in the system database as an <em>OUser</em> record.  See <a href="internals/System-Users.html">System Users</a>.</p>
<h3 id="accessing-the-system-database-via-studio"><a class="header" href="#accessing-the-system-database-via-studio">Accessing The System Database via Studio</a></h3>
<p>By default, the OrientDB system database will not be displayed in the <em>Studio</em> drop-down list of databases.  To enable this, add a "server.listDatabases.system" resource to the "guest" server user.</p>
<p>Here's an example from <em>orientdb-server-config.xml</em>:</p>
<pre><code>&lt;user resources="connect,server.listDatabases,server.listDatabases.system" password="*****" name="guest"/&gt;
</code></pre>
<h3 id="schema-7"><a class="header" href="#schema-7">Schema</a></h3>
<p>Currently, the system database has no specialized class schema, but this will changes as more features are added that utilize the private database.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="storages"><a class="header" href="#storages">Storages</a></h1>
<p>Any OrientDB database relies on a Storage. OrientDB supports 4 storage types:</p>
<ul>
<li><strong><a href="internals/Paginated-Local-Storage.html">plocal</a></strong>, persistent disk-based, where the access is made in the same JVM process</li>
<li><strong>remote</strong>, by using the network to access a remote storage</li>
<li><strong><a href="internals/Memory-storage.html">memory</a></strong>, all data remains in memory</li>
<li><strong><a href="internals/Local-Storage.html">local</a></strong>, deprecated, it's the first version of disk based storage, but has been replaced by <strong>plocal</strong></li>
</ul>
<p>A Storage is composed of multiple <a href="internals/../datamodeling/Concepts.html#cluster">Clusters</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="memory-storage"><a class="header" href="#memory-storage">Memory Storage</a></h1>
<p>Memory Storage is local and endures <strong>only as long as the JVM is running</strong>.
For the application programmer, it is identical in use to <a href="internals/Paginated-Local-Storage.html">Paginated Local Storage</a>.
Transactions remain atomic, consistent and isolated (but are not durable).</p>
<p>Memory is the fastest choice for tasks where data are read from an external source,
and where the results are provided without needing to persist the graph itself.
It is also a good choice for certain test scenarios, since an abrupt exit leaves no debris on the disk.</p>
<p>A database using memory storage is designated by a URL of the form <code>memory:&lt;path&gt;</code>,
for example <code>memory:test</code>.
A hierarchical path is allowed, for example <code>memory:subdir/test</code>.</p>
<p>The memory available for the database is <em>direct memory</em> allocated by the JVM as needed. In the case of a <code>plocal:</code> database, memory like this provides a cache whose pages are loaded from or flushed to pages files on disk. In the case of a <code>memory:</code> database, these direct memory pages are the ultimate storage. The database is allowed to take up more memory than there is physical RAM, as the JVM will allocate more from swap. Total size is limited by the <code>-XX:MaxDirectMemorySize</code> JVM option.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="plocal-storage"><a class="header" href="#plocal-storage">PLocal Storage</a></h1>
<p>The Paginated Local Storage, "<strong>plocal</strong>" from now, is a disk based storage which works with data using page model.</p>
<p>plocal storage consists of several components each of those components use disk data through <strong><a href="internals/plocal-storage-disk-cache.html">disk cache</a></strong>.</p>
<p>Below is list of plocal storage components and short description of each of them:</p>
<ol>
<li><strong>Clusters</strong> are managed by 2 kinds of files:</li>
</ol>
<ul>
<li><strong>.pcl</strong> files contain the cluster data</li>
<li><strong>.cpm</strong> files contain the mapping between record's cluster position and real physical position</li>
</ul>
<ol start="2">
<li><strong>Write Ahead (operation) Log (<a href="internals/Write-Ahead-Log.html">WAL</a>)</strong> are managed by 2 kinds of files:</li>
</ol>
<ul>
<li><strong>.wal</strong> to store the log content</li>
<li><strong>.wmr</strong> contains timing about synchronization operations between storage cache and disk system</li>
</ul>
<ol start="3">
<li><strong>SBTree Index</strong>, it uses files with extensions <strong>.sbt</strong>.</li>
<li><strong>Hash Index</strong>, it uses files with extensions <strong>.hit</strong>, <strong>.him</strong> and <strong>.hib</strong>.</li>
<li><strong>Index Containers</strong> to store values of single entries of not unique index (Index RID Set). It uses files with extension <strong>.irs</strong>.</li>
<li><strong>File mapping</strong>, maps between file names and file ids (used internally). It's a single file with name: <strong>name_id_map.cm</strong>.</li>
</ol>
<h2 id="file-system"><a class="header" href="#file-system">File System</a></h2>
<p>Since PLOCAL is disk-based, all pages are flushed to physical files. You can specify any mounted partitions on your machine, backed by Disks, SSD, Flash Disks or DRAM.</p>
<h2 id="cluster-2"><a class="header" href="#cluster-2">Cluster</a></h2>
<p><strong>Cluster</strong> is logical piece of disk space where storage stores records data. Each cluster is split in pages. <strong>Page</strong> is a single atomic unit, which is used by cluster.</p>
<p>Each page contains system information and records data. System information includes "magic number" and a crc32 check sum of the page content. This information is used to check storage integrity after a DB crash. To start an integrity check run command "check database" from console.</p>
<p>Each cluster has 2 sub components:</p>
<ul>
<li>data file, with extension .pcl</li>
<li>mapping between physical position of record in the data file and cluster position, with extension .cpm</li>
</ul>
<h3 id="file-system-1"><a class="header" href="#file-system-1">File System</a></h3>
<p>To speed up access to the most requested clusters it's recommended to use the cluster files to a SSD or any faster support than disk. To do that, move the files to the mounted partitions and create symbolic links to them on original path. OrientDB will follow symbolic links and will open cluster files everywhere are reachable.</p>
<h3 id="cluster-pointers"><a class="header" href="#cluster-pointers">Cluster pointers</a></h3>
<p>The mapping between data file and physical position is managed with a list. Each entry in this list is a fixed size element, which is the pointer to the physical position of the record in the data file.</p>
<p>Because the data file is paginated, this pointer will consist of 2 items: a page index (long value) and the position of the record inside the page (int value). Each record pointer consumes 12 bytes.</p>
<h3 id="creation-of-new-records-in-cluster"><a class="header" href="#creation-of-new-records-in-cluster">Creation of new records in cluster</a></h3>
<p>When a new record is inserted, a pointer is added to the list. The index of this pointer is the cluster position. The list is an append only data structure, so if you add a new record its cluster position will be unique and will not be reused.</p>
<h3 id="deletion-of-records-in-cluster"><a class="header" href="#deletion-of-records-in-cluster">Deletion of records in cluster</a></h3>
<p>When you delete a record, the page index and record position are set to -1. So the record pointer is transformed into a "tombstone". You can think of a record id like a <strong>uuid</strong>.. It is unique and never reused.</p>
<p>Usually when you delete records you lose very small amount of disk space. This can be mitigated with a periodic "offline compaction", by performing a database export/import. During this process, cluster positions will be changed (tombstones will be ignored during export) and the lost space will be recovered. So during the import process, the cluster positions can change.</p>
<h4 id="migration-of-rid"><a class="header" href="#migration-of-rid">Migration of RID</a></h4>
<p>The OrientDB import tool uses a manual hash index (by default the name is '___exportImportRIDMap') to map the old record ids to new record ids.</p>
<h2 id="write-ahead-operation-log-wal"><a class="header" href="#write-ahead-operation-log-wal">Write Ahead (operation) Log (WAL)</a></h2>
<p>The <a href="internals/Write-Ahead-Log.html">Write Ahead Log</a> (or WAL) is used to restore storage data after a non-soft shutdown:</p>
<ul>
<li>Hard kill of the OrientDB process</li>
<li>Crash/Failure of the Java Virtual Machine that runs OrientDB</li>
<li>Crash/Failure of the Operating System that is hosting OrientDB</li>
</ul>
<p>All the operations on <strong>plocal</strong> components are logged in WAL before they are performed. WAL is an append only data structure. You can think of it as a list of records which contain information about operations performed on storage components.</p>
<h3 id="wal-flush"><a class="header" href="#wal-flush">WAL flush</a></h3>
<p>WAL content is flushed to the disk on these events:</p>
<ul>
<li>every 1 second in background thread (flush interval can be changed in <strong>storage.wal.commitTimeout</strong> configuration property)</li>
<li>synchronously if the amount of RAM used by WAL exceeds 65Mb (can be changed in <strong>storage.wal.cacheSize</strong> configuration property).</li>
</ul>
<p>As result if OrientDB crashes, all data changes done during &lt;=1 second interval before crash will be lost. This is a trade off between performance and durability.</p>
<h3 id="put-the-wal-on-a-separate-disk"><a class="header" href="#put-the-wal-on-a-separate-disk">Put the WAL on a separate disk</a></h3>
<p>It's strongly recommended that WAL records are stored on a different disk than the disk used to store the DB content. In this way data I/O operations will not be interrupted by WAL I/O operations. This can be done by setting the <strong>storage.wal.path</strong> property to the folder where storage WAL files will be placed.</p>
<h3 id="how-indexes-use-wal"><a class="header" href="#how-indexes-use-wal">How Indexes use WAL?</a></h3>
<p>Indexes can work with WAL in 2 modes:</p>
<ul>
<li><strong>ROLLBACK_ONLY</strong> (default mode) and</li>
<li><strong>FULL</strong></li>
</ul>
<p>In ROLLBACK_ONLY mode only the data needed to rollback transactions is stored. This means that WAL records can not be used to restore index content after a crash. In the case of a crash, the indexes will be rebuilt automatically.</p>
<p>In FULL mode, indexes can be restored after DB crash without a rebuild. You can change index durability mode by setting the property <strong>index.txMode</strong>.</p>
<p>You can find more details about WAL <strong><a href="internals/Write-Ahead-Log.html">here</a></strong>.</p>
<h2 id="file-types"><a class="header" href="#file-types">File types</a></h2>
<p>PLocal stores data on the file system using different files, using the following extensions:</p>
<ul>
<li><strong>.cpm</strong>, contains the mapping between real physical positions and cluster positions. If you delete a record, the tombstone is placed here. Each tombstone consumes about 12 bytes.</li>
<li><strong>.pcl</strong>, data file</li>
<li><strong>.sbt</strong>, is index file</li>
<li><strong>.wal</strong> and <strong>.wmr</strong>, are Journal Write Ahead (operation) Log files</li>
<li><strong>.cm</strong>, is the mapping between file id and real file name (used internally)</li>
<li><strong>.irs</strong>, is the RID set file for non-unique indexes</li>
</ul>
<h2 id="how-it-works-internal"><a class="header" href="#how-it-works-internal">How it works (Internal)</a></h2>
<p>Paginated storage is a 2-level disk cache that works together with the write ahead log.</p>
<p>Every file is spit into pages, and each file operation is atomic at a page level. The 2-level disk cache allows:</p>
<ol>
<li>Cache frequently accessed pages in memory.</li>
<li>Automatically separate pages which are rarely accessed from frequently accessed and rid off the first from cache memory.</li>
<li>Minimize amount of disk head seeks during data writes.</li>
<li>In case of low or middle write data load allows to mitigate pauses are needed to write data to the disk by flushing all changed or newly added pages to the disk in background thread.</li>
<li>Works together with WAL to make any set changes on single page look like atomic operation.</li>
</ol>
<p>2-level cache itself consist of a <strong>Read Cache</strong> (implementation is based on 2Q cache algorithm) and a *<em>Write cache</em> (implementation is based on WOW cache algorithm).</p>
<p>Typical set of operations are needed to work with any file looks like following:</p>
<ol>
<li>Open file using OReadWriteDiskCache#openFile operation and get id of open file. If the file does not exist it will be automatically created. The id of file is stored in a special meta data file and will always belong to the given file till it will be deleted.</li>
<li>Allocate new page OReadWriteDiskCache#allocateNewPage or load existing one ORreadWriteDiskCache#load into off-heap memory.</li>
<li>Retrieve pointer to the allocated area of off-heap memory OCacheEntry#getCachePointer().</li>
<li>If you plan to change page data acquire a write lock, or a read lock if you read data and your single file page is shared across several data structures. Write lock must be acquired whether a single page is used between several data structures or not. The write lock is needed to prevent flushing inconsistent pages to the disk by the “data flush” thread of the write cache. OCachePointer#acquireExclusiveLock.</li>
<li>Update/read data in off heap memory.</li>
<li>Release write lock if needed. OCachePointer#releaseExclusiveLock.</li>
<li>Mark page as dirty if you changed page data. It will allow write cache to flush pages which are really changed OCacheEntry#markDirty.</li>
<li>Push record back to the disk cache: indicate to the cache that you will not use this page any more so it can be safely evicted from the memory to make room to other pages OReadWriteDiskCache#release.</li>
</ol>
<h3 id="so-what-is-going-on-underneath-when-we-load-and-release-pages"><a class="header" href="#so-what-is-going-on-underneath-when-we-load-and-release-pages">So what is going on underneath when we load and release pages?</a></h3>
<p>When we load page the Read Cache looks it in one of its two LRU lists. One list is for data that was accessed several times and then not accessed for very long period of time. It consumes 25% of memory. The second is for data that is accessed frequently for a long period of time. It consumes 75% of memory.</p>
<p>If the page is not in either LRU queue, the Read Cache asks the Write Cache to load page from the disk.</p>
<p>If we are lucky and the page is queued to flush but is still in the Write Queue of Write Cache it will be retrieved from there. Otherwise, the Write Cache will load the page from disk.</p>
<p>When data will be read from file by Write Cache, it will be put in LRU queue which contains “short living” pages. Eventually, if this pages will be accessed frequently during long time interval, loaded page will be moved to the LRU of “long living” pages.</p>
<p>When we release a page and the page is marked as dirty, it is put into the Write Cache which adds it to the Write Queue. The Write Queue can be considered as ring buffer where all the pages are sorted by their position on the disk. This trick allows to minimize disk head movements during pages flush. What is more interesting is that pages are always flushed in the background in the “background flush” thread. This approach allows to mitigate I/O bottleneck if we have enough RAM to work in memory only and flush data in background.</p>
<p>So it was about how disk cache works. But how we achieve durability of changes on page level and what is more interesting on the level when we work with complex data structures like Trees or Hash Maps (these data structures are used in indexes).</p>
<p>If we look back on set of operations which we perform to manipulate file data you see that step 5 does not contains any references to OrientDB API. That is because there are two ways to work with off heap pages: durable and not durable.</p>
<p>The simple (not durable way) is to work with methods of direct memory pointer com.orientechnologies.common.directmemory.ODirectMemoryPointer(setLong/getLong, setInt/getInt and so on).
If you would like to make all changes in your data structures durable you should not work with direct memory pointer but should create a component that will present part of your data structure by extending com.orientechnologies.orient.core.storage.impl.local.paginated.ODurablePage class. This class has similar methods for manipulation of data in off heap pages, but it also tracks all changes made to the page. It can return the diff between the old/new states of page using the com.orientechnologies.orient.core.storage.impl.local.paginated.ODurablePage#getPageChanges method. Also this class allows to apply given diff to the old/new snapshot of given pages to repeat/revert (restoreChanges()/revertChanges()) changes are done for this page.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="plocal-engine"><a class="header" href="#plocal-engine">PLocal Engine</a></h1>
<p>Paginated Local storage engine, also called as <strong>"plocal"</strong>, is intended to be used as durable replacement of the previous <a href="internals/Local-Storage.html">local storage</a>.</p>
<p>plocal storage is based on principle that using disk cache which contains disk data that are split by fixed size portions (pages) and write ahead logging approach (when changes in page are logged first in so called durable storage) we can achieve following characteristics:</p>
<ol>
<li>Operations on single page are atomic.</li>
<li>Changes applied to the page can be restored after server crash even if they were not flushed to the disk.</li>
</ol>
<p>Using write ahead log and page based cache we can achieve durability/performance trade off. We do not need to flush every page to the disk so we will avoid costly random I/O operations as much as possible and still can achieve durability using much cheaper append only I/O operations.</p>
<p>From all given above we can conclude one more advantage of plocal against local - it has much faster transactions implementation. In order achieve durability on local storage we should set tx.commit.synch property to true (perform synchronization of disk cache on each transaction commit) which of course makes
create/update/delete operations inside transaction pretty slow.</p>
<p>Lets go deeper in implementation of both storages.</p>
<p>Local storage uses MMAP implementation and it means that caching of read and write operations can not be controlled, plocal from other side uses two types of caches read cache and write cache (the last is under implementation yet and not included in current implementation).</p>
<p>The decision to split responsibilities between 2 caches is based on the fact that characters of distribution of "read" and "write" data are different and they should be processed separately.</p>
<p>We replaced MMAP by our own cache solution because we needed low level integration with cache life cycle  to provide fast and durable integration between WAL and disk cache. Also we expect that when cache implementation will be finished issues like https://github.com/orientechnologies/orientdb/issues/1202 and https://github.com/orientechnologies/orientdb/issues/1339 will be fixed automatically.</p>
<p>Despite of the fact that write cache is still not finished it does not mean that plocal storage is not fully functional. You can use plocal storage and can notice that after server crash it will restore itself.</p>
<p>But it has some limitations right now, mostly related to WAL implementation.
When storage is crashed it finds last data check point and restores data from this checkpoint by reading operations log from WAL.</p>
<p>There are two kind of check points full check point and fuzzy check point.
The full check point is simple disk cache flush it is performed when cluster is added to storage or cluster attributes are changed, also this check point is performed during storage close.</p>
<p>Fuzzy checkpoint is completely different (it is under implementation yet).
During this checkpoint we do not flush disk cache we just store the position of last operation in write ahead log which is for sure flushed to the disk.
When we restore data after crash we find this position in WAL and restore all operations from it.
Fuzzy check points are much faster and will be performed each hour.</p>
<p>To achieve this trick we should have special write cache which will guarantee that we will not restore data from the begging of database creation during restore from fuzzy checkpoint and will not have performance degradation during write operations. This cache is under implementation.</p>
<p>So right now when we restore data we need to restore data since last DB open operation.
It is quite long procedure and require quite space for WAL.</p>
<p>When fuzzy check points will be implemented we will cut unneeded part of WAL during fuzzy check point which will allow us to keep WAL quite small.</p>
<p>We plan to finish fuzzy checkpoints during a month.</p>
<p>But whether we use fuzzy checkpoints or not we can not append to the WAL forever.
WAL is split by segments, when WAL size is exceed maximum allowed size the oldest WAL segment will be deleted and new empty one will be created.</p>
<p>The segments size are controlled by storage.wal.maxSegmentSize parameter in megabytes.
The maximum WAL size is set by property storage.wal.maxSize parameter in megabytes.</p>
<p>Maximum amount of size which is consumed by disk cache currently is set using two parameters:
storage.diskCache.bufferSize - Maximum amount of memory consumed by disk cache in megabytes.
storage.diskCache.writeQueueLength - Currently pages are nor flushed on the disk at the same time when disk cache size exceeds, they placed to write queue and when write queue will be full it is flushed. This approach minimize disk head movements but it is temporary solution and will be removed at final version of plocal storage. This parameter is measured in megabytes.</p>
<p>During update the previous record deleted and content of new record is placed instead of old record at the same place. If content of new record does not fit in place occupied by old record, record is split on two parts first is written on old record's place and the second is placed on new or existing page.
Placing of part of the record on new page requires to log in WAL not only new but previous data are hold in both pages which requires much more space. To prevent such situation cluster in plocal storage has following attributes:</p>
<ol>
<li>
<p>RECORD_GROW_FACTOR the factor which shows how many space will be consumed by record during initial creation. If record size is 100 bytes and RECORD_GROW_FACTOR  is 2 record will consume 200 bytes. Additional 100 bytes will be reused when record will grow.</p>
</li>
<li>
<p>RECORD_OVERFLOW_GROW_FACTOR the factor shows how many additional space will be added to the record when record size will exceed initial record size. If record consumed 200 bytes and additional 20 bytes will be needed and RECORD_OVERFLOW_GROW_FACTOR is 1.5 then record will consume 300 bytes after update. Additional 80 bytes will be used during next record updates.</p>
</li>
</ol>
<p>Default value for both parameters are 1.2.</p>
<ol start="3">
<li>USE_WAL if you prefer that some clusters will be faster but not durable you can set this parameter to false.</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="plocal-disk-cache"><a class="header" href="#plocal-disk-cache">PLocal Disk-Cache</a></h1>
<p>OrientDB Disk cache consists of two separate cache components that work together:</p>
<ul>
<li><strong>Read Cache</strong>, based on <a href="http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.54.392">2Q</a> cache algorithm</li>
<li><strong>Write Cache</strong>, based on <a href="http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.108.8729">WOW</a> cache algorithm</li>
</ul>
<p>Starting from v2.1, OrientDB exposes internal metrics through <a href="internals/../admin/JMX.html">JMX Beans</a>. Use this information to track and profile OrientDB.</p>
<h2 id="read-cache-1"><a class="header" href="#read-cache-1">Read Cache</a></h2>
<p>It contains the following queues:</p>
<ul>
<li><strong>a1</strong>, as FIFO queue for pages which were not in the read cache and accessed for the first time</li>
<li><strong>am</strong>, as FIFO queue for the hot pages (pages which are accessed frequently during db lifetime). The most used pages stored in <strong>a1</strong> becomes "hot pages" and are moved into the <strong>am</strong> queue.</li>
</ul>
<h3 id="a1-queue"><a class="header" href="#a1-queue">a1 Queue</a></h3>
<p>a1 queue is split in two queues:</p>
<ul>
<li><strong>a1in</strong> that contains pointers to the pages are cached in memory</li>
<li><strong>a1out</strong> that contains pointers to the pages which were in <strong>a1in</strong>, but was not accessed for some time and were removed from RAM. <strong>a1out</strong> contains pointers to the pages located on the disk, not in RAM.</li>
</ul>
<h3 id="loading-a-page"><a class="header" href="#loading-a-page">Loading a page</a></h3>
<p>When a page is read for the first time, it's loaded from the disk and put in the <strong>a1in</strong> queue. If there isn't enough space in RAM, the page is moved to <strong>a1out</strong> queue.</p>
<p>If the same page is accessed again, then:</p>
<ol>
<li>if it is in <strong>a1in</strong> queue, nothing</li>
<li>if it is in <strong>a1out</strong> queue, the page is supposed to be a "hot page" (that is page which is accessed several times, but doesn't follow the pattern when the page is accessed several times for short interval, and then not accessed at all) we put it in <strong>am</strong> queue</li>
<li>if it is in <strong>am</strong> queue, we put the page at the top of am queue</li>
</ol>
<h3 id="queue-sizes"><a class="header" href="#queue-sizes">Queue sizes</a></h3>
<p>By default this is the configuration of queues:</p>
<ul>
<li><strong>a1in</strong> queue is 25% of Read Cache size</li>
<li><strong>a1out</strong> queue is 50% of Read Cache size</li>
<li><strong>am</strong> is 75% of Read Cache size.</li>
</ul>
<p>When OrientDB starts, both caches are empty, so all the accessed pages are put in <strong>a1in</strong> queue, and the size of this queue is 100% of the size of the Read Cache.</p>
<p>But then, when there is no more room for new pages in <strong>a1in</strong>, the old pages are moved from <strong>a1in</strong> to <strong>a1out</strong>. Eventually when <strong>a1out</strong> contains requested pages we need room for <strong>am</strong> queue pages, so once again we move pages from <strong>a1in</strong> queue to <strong>a1out</strong> queue, <strong>a1in</strong> queue is truncated till it is reached 25% size of read cache.</p>
<p>To make more clear how RAM and pages are distributed through queues lets look at example.
Lets suppose we have cache which should cache in RAM 4 pages, and we have 8 pages stored on disk (which have indexes from 0 till 7 accordingly).</p>
<p>When we start database server all queues contain 0 pages:</p>
<ul>
<li>am - []</li>
<li>a1in - []</li>
<li>a1out - []</li>
</ul>
<p>Then we read first 4 pages from the disk.
So we have:</p>
<ul>
<li>am - []</li>
<li>a1in - [3, 2, 1, 0]</li>
<li>a1out - []</li>
</ul>
<p>Then we read 5-th page from the disk and then 6-th , because only 4 pages can be fit into RAM we remove the last pages with indexes 0 and 1, free memory which is consumed by those pages and put them in a1out.
So we have:</p>
<ul>
<li>am - []</li>
<li>a1in - [5, 4, 3, 2]</li>
<li>a1out - [1, 0]</li>
</ul>
<p>lets read pages with indexes from 6 till 7 (last 2 pages) but a1out can contain only 2 pages (50% of cache size) so the first pages will be removed from o1out.
We have here:</p>
<ul>
<li>am - []</li>
<li>a1in - [7, 6, 5, 4]</li>
<li>a1out - [3, 2]</li>
</ul>
<p>Then if we will read pages 2, 3 then we mark them (obviously) as hot pages and we put them in am queue but we do not have enough memory for these pages, so we remove pages 5 and 4 from a1in queue and free memory which they consumed.
Here we have:</p>
<ul>
<li>am - [3, 2]</li>
<li>a1in - [7, 6]</li>
<li>a1out - [5, 4]</li>
</ul>
<p>Then we read page 4  because we read it several times during long time interval it is hot page and we put it in am queue.
So we have:</p>
<ul>
<li>am - [4, 3, 5]</li>
<li>a1in - [7]</li>
<li>a1out - [6, 5]</li>
</ul>
<p>We reached state when queues can not grow any more so we reached stable, from point of view of memory distribution, state.</p>
<p>This is the used algorithm in pseudo code:</p>
<pre>
On accessing a page X
begin:
 if X is in Am then
   move X to the head of Am
else if (X is in A1out) then
 removeColdestPageIfNeeded
 add X to the head of Am
else if (X is in A1in)
 // do nothing
else
 removeColdestPageIfNeeded
 add X to the head of A1in
end if
end

removeColdestPageIfNeeded
begin
 if there is enough RAM do nothing
 else if( A1in.size > A1inMaxSize)
  free page out the tail of A1in, call it Y
  add identifier of Y to the head of A1out
 if(A1out.size > A1OutMaxSize)
  remove page from the tail of A1out
 end if
 else
  remove page out the tail of Am
  // do not put it on A1out; it hasn’t been
  // accessed for a while
 end if
end
</pre>
<h2 id="write-cache-1"><a class="header" href="#write-cache-1">Write cache</a></h2>
<p>The main target of the write cache is to eliminate disk I/O overhead, by using the following approaches:</p>
<ol>
<li>All the pages are grouped by 4 adjacent pages (group 0 contains pages from 0 to 3, group 1 contains pages from 4 to 7, etc. ). Groups are sorted by position on the disk. Groups are flushed in sorted order, in such way we reduce the random I/O disk head seek overhead. Group's container is implemented as SortedMap: when we reach the end of the map we start again from the beginning. You can think about this data structure as a "ring buffer"</li>
<li>All the groups have "recency bit", this bit is set when group is changed. It is needed to avoid to flush  pages that are updated too often, it will be wasting of I/O time</li>
<li>Groups are continuously flushed by background thread, so until there is enough free memory, all data operations do not suffer of I/O overhead because all operations are performed in memory</li>
</ol>
<p>Below the pseudo code for write cache algorithms:</p>
<p>Add changed page in cache:</p>
<pre>
begin
 try to find page in page group.
 if such page exist
  replace page in page group
  set group's "recency bit" to true
 end if
 else
  add page group
  set group's "recency bit" to true
 end if
end
</pre>
<p>On periodical background flush</p>
<pre>
begin
 calculate amount of groups to flush
 start from group next to flushed in previous flush iteration
 set "force sync" flag to false

 for each group
  if "recency bit" set to true and "force sync" set to false
   set "recency bit" to false
  else
   flush pages in group
   remove group from ring buffer
  end if
 end for

  if we need to flush more than one group and not all of them are flushed repeat "flush loop" with "force sync" flag set to true.
end
</pre>
<p>The collection of groups to flush is calculated in following way:</p>
<ol>
<li>if amount of RAM consumed by pages is less than 80%, then 1 group is flushed.</li>
<li>if amount of RAM consumed by pages is more than 80%, then 20% of groups is flushed.</li>
<li>if amount of RAM consumed by pages is more than 90%, then 40% of groups is flushed.</li>
</ol>
<h2 id="interaction-between-read-and-write-caches"><a class="header" href="#interaction-between-read-and-write-caches">Interaction between Read and Write Caches</a></h2>
<p>By default the maximum size of Read Cache is 70% of cache RAM and 30% for Write Cache.</p>
<p>When a page is requested, the Read Cache looks into the cached pages. If it's not present, the Read Cache requests page from the Write Cache. Write Cache looks for the page inside the Ring Buffer: if it is absent, it reads the page from the disk and returns it directly to the Read Cache without caching it inside of Write Cache Ring Buffer.</p>
<h3 id="implementation-details"><a class="header" href="#implementation-details">Implementation details</a></h3>
<p>Page which is used by storage data structure (such as cluster or index) can not be evicted (removed from memory) so each page pointer also has "usage counter" when page is requested by cache user, "usage counter" is incremented and decremented when page is released. So removeColdestPageIfNeeded() method does not remove tail page, but removes page closest to tail which usage counter is 0, if such pages do not exit either exception is thrown or cache size is automatically increased and warning message is added to server log (default) (it is controlled by properties <strong>server.cache.2q.increaseOnDemand</strong> and <strong>server.cache.2q.increaseStep</strong>, the last one is amount of percent of RAM from original size on which cache size will be increased).</p>
<p>When a page is changed, the cache page pointer (data structure which is called OCacheEntry) is marked as dirty by cache user before release. If cache page is dirty it is put in write cache by read cache during call of OReadWriteDiskCache#release() method. Strictly speaking memory content of page is not copied, it will be too  slow, but pointer to the page is passed. This pointer (OCachePointer) tracks amount of referents if no one references this pointer, it frees referenced page.</p>
<p>Obviously caches work in multithreaded environment, so to prevent data inconsistencies each page is not accessed directly. Read cache returns data structure which is called cache pointer. This pointer contains pointer to the page and lock object. Cache user should acquire read or write lock before it will use this page. The same read lock is acquired by write cache for each page in group before flush, so inconsistent data will not be flushed to the disk. There is interesting nuance here, write cache tries to acquire read lock and if it is used by cache user it will not wait but will try to flush other group.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="plocal-wal-journal"><a class="header" href="#plocal-wal-journal">PLocal WAL (Journal)</a></h1>
<p>Write Ahead Log, <strong>WAL</strong> form now, is operation log which is used to store data about operations which were performed on disk cache page. WAL is enabled by default.</p>
<p>You could disable the journal (WAL) for some operations where reliability is not necessary:</p>
<pre><code>-Dstorage.useWAL=false
</code></pre>
<p>By default, the WAL files are written in the database folder. Since these files can growth very fast, it's a best practice to store in a dedicated partition. WAL are written in append-only mode, so there is not much difference on using a SSD or a normal HDD. If you have a SSD we suggest to use for database files only, not WAL.</p>
<p>To setup a different location than database folder, set the <code>WAL_LOCATION</code>variable.</p>
<pre><code class="language-java">OGlobalConfiguration.WAL_LOCATION.setValue("/temp/wal")
</code></pre>
<p>or at JVM level:</p>
<pre><code>java ... -Dstorage.wal.path=/temp/wal ...
</code></pre>
<p>This log is not an high level log, which is used to log operations on record level. During each page change following values are stored:</p>
<ol>
<li>offset and length of chunk of bytes which was changed.</li>
<li>previous value of chunk of bytes.</li>
<li>replaced (new) value of chunk of bytes.</li>
</ol>
<p>As you can see WAL contains not logical but raw (in form of chunk of bytes) presentation of data which was/is contained inside of page. Such format of record of write ahead log allows to apply the same changes to the page several times and as result allows do not flush cache content after each TX operation but do such flush on demand and flush only chosen pages instead of whole cache. The second advantage is following if storage is crashed during data restore operation it can be restored again , again and again.</p>
<p>Lets say we have page where following changes are done.</p>
<ol>
<li>10 bytes at the beginning were changed.</li>
<li>10 bytes at the end were changed.</li>
</ol>
<p>Storage is crashed during the middle of page flush, which does not mean that first 10 bytes are written, so lets suppose that the last 10 changed byte were written, but first 10 bytes were not.</p>
<p>During data restore we apply all operations stored in WAL one by one, which means that we set first 10 bytes of changed page and then last 10 bytes of this page. So the changed page will have correct state does not matter whether it's state was flushed to the disk or not.</p>
<p>WAL file is split on pages and segments, each page contains in header CRC32 code of page content and "magic number".
When operation records are logged to WAL they are serialized and binary content appended to the current page, if it is not enough space left in page to accommodate binary presentation of whole record, the part of binary content (which does not fit inside of current page) will be put inside of next record. It is important to avoid gaps (free space) inside of pages. As any other files WAL can be corrupted because of power failure and detection of gaps inside WAL pages is one of the approaches how database separates  broken and "healthy" WAL pages. More about this later.</p>
<p>Any operation may include not single but several pages, to avoid data inconsistency all operations on several records inside of one logical operation are considered as single atomic operation.
To achieve this functionality following types of WAL records were introduced:</p>
<ol>
<li>atomic operation start.</li>
<li>atomic operation end.</li>
<li>record which contains changes are done in single page inside of atomic operation.</li>
</ol>
<p>These records contain following fields:</p>
<ol>
<li>Atomic operation start record contains following fields:
<ol>
<li>Atomic operation id (uuid).</li>
<li>LSN (log sequence number) - physical position of log record inside WAL.</li>
</ol>
</li>
<li>Atomic operation end record contains following fields:
<ol>
<li>Atomic operation id (uuid).</li>
<li>LSN (log sequence number) - physical position of log record inside WAL.</li>
<li>rollback flag  - indicates whether given atomic operation should be rolled back.</li>
</ol>
</li>
<li>Record which contains page changes contains following fields:
<ol>
<li>LSN (log sequence number) - physical position of log record inside WAL.</li>
<li>page index and file id of changed page.</li>
<li>Page changes itself.</li>
<li>LSN of change which was applied to the current page before given one - prevLSN.</li>
</ol>
</li>
</ol>
<p>The last record's type (page changes container) contains field (d. item) which deserves additional explanation. Each cache page contains following "system" fields:</p>
<ol>
<li>CRC32 code of the rest of content.</li>
<li>magic number</li>
<li>LSN of last change applied to the page - page LSN.</li>
</ol>
<p>Every time we perform changes on the page before we release it back to the cache we log page changes to the WAL, assign LSN of WAL record as the "page LSN" and only after that release page back to the cache.</p>
<p>When WAL flushes it's pages it does not do it at once when current page is filled it is put in cache and is flushed in background along with other cached pages. Flush is performed every second in background thread (it is trade off between performance and durability). But there are two exceptions when flush is performed in thread which put record in WAL:</p>
<ol>
<li>If WAL page's cache is exhausted.</li>
<li>If cache page is flushed, page LSN is compared with LSN of last flushed WAL record and if page LSN  is more than LSN of flushed WAL record then flush of WAL pages is triggered. LSN is physical position of WAL record, because of WAL is append only log so if "page LSN" is more than LSN of flushed record it means that changes for given page were logged but not flushed, but we can restore state of page only and only if all page changes will be contained in WAL too.</li>
</ol>
<p>Given all of this data restore process looks like following:</p>
<pre>
begin
go trough all WAL records one by one
gather together all atomic operation records in one batch
when "atomic operation end" record was found
  if commit should be performed
    go through all atomic operation records from first to last, apply all page changes, set page LSN to the LSN of applied WAL record.
  else
    go through all atomic operation records from last to first, set old page's content, set page LSN to the WALRecord.prevLSN value.
  endif
end
</pre>
<p>As it is written before WAL files are usual files and they can be flushed only partially if power is switched off during WAL cache flush. There are two cases how WAL pages can be broken:</p>
<ol>
<li>Pages are flushed partially.</li>
<li>Some of pages are completely flushed, some are not flushed.</li>
</ol>
<p>First case is very easy to detect and resolve:</p>
<ol>
<li>When we open WAL during DB start we verify that size of WAL multiplies of WAL page size if it is not WAL size is truncated to page size.</li>
<li>When we read pages one by one we verify CR32 and magic number of each page. If page is broken we stop data restore procedure here.</li>
</ol>
<p>Second case a bit more tricky. Because WAL is append only log, there is two possible sub-cases,
lets suppose we have 3 pages after 2-nd (broken) flush. First and first half of second page were flushed during first flush and second half of second page and third page were flushed during second flush.
Because second flush was interrupted by power failure we can have two possible states:</p>
<ol>
<li>Second half of page was flushed but third was not. It is easy to detect by checking CRC and magic number values.</li>
<li>Second half of page is not flushed but third page is flushed. In such case CRC and magic number values will be correct and we can not use them instead of this when we read WAL page we check if this page has free space if it has then we check if this is last page if it is not we mark this WAL page as broken.</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="local-storage"><a class="header" href="#local-storage">Local Storage</a></h1>
<blockquote>
<p><strong>NOTE</strong>: Local storage is no longer available as of Version 2.0.</p>
</blockquote>
<p>Local storage is the first version of disk-based storage engine, but has been replaced by <a href="internals/Paginated-Local-Storage.html">plocal</a>. Don't create new databases using <strong>local</strong>, but rather <a href="internals/Paginated-Local-Storage.html">plocal</a>. Local storage has been kept only for compatibility purpose.</p>
<p>A <strong>local</strong> storage is composed of multiple <a href="internals/Local-Storage.html#local-physical-cluster">Cluster</a> and <a href="internals/Local-Storage.html#data-segment">Data Segments</a>.</p>
<p><img src="http://www.orientdb.org/images/orientdb-storage.png" alt="" /></p>
<h2 id="local-physical-cluster"><a class="header" href="#local-physical-cluster">Local Physical Cluster</a></h2>
<p>The cluster is mapped 1-by-2 to files in the underlying File System. The local physical cluster uses two or more files: One or more files with extension "ocl" (OrientDB Cluster) and only one file with the extension "och" (OrientDB Cluster Holes).</p>
<p>For example, if you create the "Person" cluster, the following files will be created in the folder that contains your database:</p>
<ul>
<li>person.0.ocl</li>
<li>person.och</li>
</ul>
<p>The first file contains the pointers to the record content in ODA (OrientDB Data Segment). The '0' in the name indicates that more successive data files can be created for this cluster. You can split a physical cluster into multiple real files. This behavior depends on your configuration. When a cluster file is full, a new file will be used.</p>
<p>The second file is the "Hole" file that stores the holes in the cluster caused by deleted data.</p>
<p><strong>NOTE (again, but very important): You can move real files in your file system only by using the OrientDB APIs.</strong></p>
<h1 id="data-segment"><a class="header" href="#data-segment">Data Segment</a></h1>
<p>OrientDB uses <strong>data segments</strong> to store the record content. The data segment behaves similar to the physical cluster files: it uses two or more files. One or multiple files with the extension "oda" (OrientDB Data) and only one file with the extension "odh" (OrientDB Data Holes).</p>
<p>By default OrientDB creates the first data segment named "default". In the folder that contains your database you will find the following files:</p>
<ul>
<li>default.0.oda</li>
<li>default.odh</li>
</ul>
<p>The first file is the one that contains the real data. The '0' in the name indicates that more successive data files can be created for this cluster. You can split a data segment into multiple real files. This behavior depends on your configuration. When a data segment file is full, a new file will be used.</p>
<p><strong>NOTE (again, but it can't be said too many times): You can move real files in your file system only by using the OrientDB APIs.</strong></p>
<p>Interaction between components: load record use case:</p>
<p><img src="http://www.orientdb.org/images/orientdb-loadrecord.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="clusters"><a class="header" href="#clusters">Clusters</a></h1>
<p>OrientDB uses <strong>clusters</strong> to store links to the data. A cluster is a generic way to group records. It is a concept that does not exist in the Relational world, so it is something that readers from the relational world should pay particular attention to.</p>
<p>You can use a cluster to group all the records of a certain type, or by a specific value. Here are some examples of how clusters may be used:</p>
<ul>
<li>Use the cluster "Person" to group all the records of type "Person". This may at first look very similar to the RDBMS tables, but be aware that the concept is quite different.</li>
<li>Use the cluster "Cache" to group all the records most accessed.</li>
<li>Use the cluster "Today" to group all the records created today.</li>
<li>Use the cluster "CityCar" to group all the city cars.</li>
</ul>
<p>If you have a background from the RDBMS world, you may benefit to think of a cluster as a table (at least in the beginning). OrientDB uses a cluster per "class" by default, so the similarities may be striking at first. However, as you get more advanced, we strongly recommend that you spend some time understanding clustering and how it differs from RDBMS tables.</p>
<p>A cluster can be local (physical) or in-memory.</p>
<p><strong>Note: If you used an earlier version of OrientDB. The concept of "Logical Clusters" are not supported after the introduction of version 1.0.</strong></p>
<h2 id="persistent-cluster"><a class="header" href="#persistent-cluster">Persistent Cluster</a></h2>
<p>Also called Physical cluster, it stores data on disk.</p>
<h2 id="in-memory-cluster"><a class="header" href="#in-memory-cluster">In-Memory Cluster</a></h2>
<p>The information stored in "In-Memory clusters" is volatile (that is, it is never stored to disk). Use this cluster only to work with temporary data. If you need an In-Memory database, create it as an In-memory Database. In-memory databases have only In-memory clusters.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="limits"><a class="header" href="#limits">Limits</a></h1>
<p>Below are the limitations of the OrientDB engine:</p>
<ul>
<li><strong>Databases</strong>: There is no limit to the number of databases per server or embedded. Users reported no problem with 1000 databases open</li>
<li><strong>Clusters</strong>: each database can have a maximum of 32,767 clusters (2^15-1)</li>
<li><strong>Records</strong> per cluster (<strong>Documents</strong>, <strong>Vertices</strong> and <strong>Edges</strong> are stored as records): can be up to 9,223,372,036,854,780,000 (2^63-1), namely 9,223,372 Trillion records</li>
<li><strong>Records</strong> per database (<strong>Documents</strong>, <strong>Vertices</strong> and <strong>Edges</strong> are stored as records): can be up to 302,231,454,903,000,000,000,000 (2^78-1), namely 302,231,454,903 Trillion records</li>
<li><strong>Record size</strong>: up to 2GB each, even if we suggest avoiding the creation of records larger than 10MB. They can be split into smaller records, take a look at <a href="internals/../java/Binary-Data.html">Binary Data</a></li>
<li><strong>Document Properties</strong> can be:</li>
<li>up to 2 Billion per database for schema-full properties</li>
<li>there is no limitation regarding the number of properties in schema-less mode. The only concrete limit is the size of the Document where they can be stored. Users have reported no problems working with documents made of 15,000 properties</li>
<li><strong>Indexes</strong> can be up to 2 Billion per database. There are no limitations regarding the number of indexes per class</li>
<li><strong>Queries</strong> can return a maximum of 2 Billion rows, no matter the number of the properties per record</li>
<li><strong>Concurrency level</strong>: in order to guarantee atomicity and consistency, OrientDB acquire an exclusive lock on the storage during transaction commit. This means transactions are serialized. Giving this limitation, <em>the OrientDB team is already working on improving parallelism to achieve better scalability on multi-core machines by optimizing internal structure to avoid exclusive locking.</em></li>
</ul>
<p>Look also at the <a href="internals/../distributed/Distributed-Architecture.html#limitations">limitations with distributed setup</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ridbag-1"><a class="header" href="#ridbag-1">RidBag</a></h1>
<p><strong>RidBag</strong> is a data structure that manages multiple RIDs. It is a collection without an order that could contain duplication. Actually the bag (or multi-set) is similar to set, but could hold several instances of the same object.</p>
<p><strong>RidBag</strong> is designed to efficiently manage edges in graph database, however it could be used directly in document level.</p>
<p><strong>Why it doesn't implement java java.util.Collection</strong></p>
<p>The first goal of RidBag is to be able efficiently manage billions of entries. In the same time it should be possible to use such collection in the remote. The main restriction of such case is amount of data that should be sent over the network.</p>
<p>Some of the methods of <code>java.util.Collection</code> is really hard to efficiently implement for such case, when most of them are not required for relationship management.</p>
<h2 id="how-it-works-3"><a class="header" href="#how-it-works-3">How it works</a></h2>
<p>RidBag has 2 modes:</p>
<ul>
<li><strong>Embedded</strong> - has list-like representation and serialize its content right in document</li>
<li><strong>Tree-based</strong> - uses external tree-based data structure to manages its content. Has some overhead over embedded one, but much more efficient for many records.</li>
</ul>
<p>By default newly created RidBags are embedded and they are automatically converted to tree-based after reaching a threshold.
The automatic conversion in opposite direction is disabled by default due to an issues in remote mode. However you can use it if you are using OrientDB embedded and don't use remote connections.</p>
<p>The conversion is <strong>always</strong> done on server and never on client. Firstly it allows to avoid a lot of issues related to simultaneous conversions. Secondly it allows to simplify the clients.</p>
<h2 id="configuration-12"><a class="header" href="#configuration-12">Configuration</a></h2>
<p>RidBag could be configured with OGlobalConfiguration.</p>
<ul>
<li><code>RID_BAG_EMBEDDED_TO_SBTREEBONSAI_THRESHOLD</code> (<code>ridBag.embeddedToSbtreeBonsaiThreshold</code>) - The threshold of LINKBAG conversion to sbtree-based implementation. <em>Default value: 40</em>.</li>
<li><code>RID_BAG_SBTREEBONSAI_TO_EMBEDDED_THRESHOLD</code> (<code>ridBag.sbtreeBonsaiToEmbeddedToThreshold</code>) - The threshold of LINKBAG conversion to embedded implementation. <em>Disabled by default</em>.</li>
</ul>
<p>Setting <code>RID_BAG_EMBEDDED_TO_SBTREEBONSAI_THRESHOLD</code> to <code>-1</code> forces using of sbtree-based RidBag. Look at <a href="internals/../general/Concurrency.html#concurrency-when-adding-edges">Concurrency on adding edges</a> to know more about impact on graphs of this setting.</p>
<div class="table-wrapper"><table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td><img src="internals/../images/warning.png" alt="NOTE" /></td><td><em>NOTE: While running in distributed mode SBTrees are not supported. If using a distributed database then you must set <code>ridBag.embeddedToSbtreeBonsaiThreshold=Integer.MAX\_VALUE</code> to avoid replication errors.</em></td></tr>
</tbody></table>
</div>
<h2 id="interaction-with-remote-clients"><a class="header" href="#interaction-with-remote-clients">Interaction with remote clients</a></h2>
<blockquote>
<p>NOTE: This topic is rather for contributors or driver developers. OrientDB users don't have to care about bag internals.</p>
</blockquote>
<p>As been said rid bag could be represented in two ways: <em>embedded</em> and <em>tree-based</em>. The first implementation serializes its entries right into stream of its owner. The second one serializes only a special pointer to an external data structure.</p>
<p>In the same time the server could automatically convert the bag from embedded to tree-based during save/commit. So client should be aware of such conversion because it can hold an instance of rid bag.</p>
<p>To "listen" for such changes client should assign a temporary collection id to bag.</p>
<p>The flow of save/commit commands:</p>
<pre><code> Client                                                         Server
   |                                                              |
   V                                                              |
  /---------\      Record content [that contain bag with uuid]        |
 |           |-------------------------------------------------------&gt;|
 |   Send    |                                                        | Convert to tree
 |  command  |                                                        | and save to disk
 | to server |   Response with changes (A new collection pointer)     |
 |           |&lt;-------------------------------------------------------/
  \---------/        the target of new identity assignment
   |                  identified by temporary id
   |
   V
 /-----------------------------\
 | Update a collection pointer |
 | to be able perform actions  |
 | with remote tree            |
 \-----------------------------/
</code></pre>
<h2 id="serialization"><a class="header" href="#serialization">Serialization.</a></h2>
<blockquote>
<p>NOTE: This topic is rather for contributors or driver developers. OrietnDB users don't have to care about bag serialization</p>
</blockquote>
<p>Save and load operations are performed during save/load of owner of RidBag. Other operations are performed separately and have its own commands in binary protocol.</p>
<p>To get definitive syntax of each network command see <a href="internals/Network-Binary-Protocol.html">Network Binary Protocol</a></p>
<h3 id="serialization-during-save-and-load"><a class="header" href="#serialization-during-save-and-load">Serialization during save and load</a></h3>
<p>The bag is serialized in a binary format. If it is serialized into document by CSV serializer it's encoded with base64.</p>
<p>The format is following:</p>
<pre><code>(config:byte)[(temp_id:uuid:optional)](content.md)
</code></pre>
<p>The first byte is reserved for configuration. The bits of config byte define the further structure of binary stream:</p>
<ol>
<li>1st: 1 if bag is embedded. 0 if tree-based.</li>
<li>2nd: 1 if uuid is assigned, 0 otherwise. Used to prevent storing of UUID to disk.</li>
</ol>
<p>If bag is embedded content has following</p>
<pre><code>(size:int)(link:rid)*
</code></pre>
<p>If bag is tree based it doesn't serialize the content it serialize just a <strong>collection pointer</strong> that points where the tree structure is saved:</p>
<pre><code>(collectionPointer)(size:int)(changes)
</code></pre>
<p>See also <a href="internals/RidBag.html#serialization-of-collection-pointer">serialization of collection pointer</a> and <a href="internals/RidBag.html#serialization-of-rid-bag-changes">rid bag changes</a></p>
<p>The cached size value is also saved to stream. It don't have to be recalculated in most cases.</p>
<p>The <em>changes</em> part is used by client to send changes to server. In all other cases <em>size</em> of cahnges is 0</p>
<h3 id="size-of-rid-bag"><a class="header" href="#size-of-rid-bag">Size of rid bag</a></h3>
<p>Calculation of size for embedded rid bag is straight forward. But what about tree-based bag.</p>
<p>The issue there that we probably have some changes on client that have not been send to the server. On the other hand we probably have billions of records in bag on server. So we can't just calculate size on server because we don't know how to apply changes readjust that size regarding to changes on client. And in the same time calculation of size on client is inefficient because we had to iterate over big amount of records over the network.</p>
<p>That's why following approach is used:</p>
<ul>
<li>Client ask server for RidBag size and provide client changes</li>
<li>Server apply changes in memory to calculate size, but doesn't save them to bag.</li>
<li>New entries (documents that have never been saved) are not sent to server for recalculation, and the size is adjusted on client. New entries doesn't have an identity yet, but rid bag works only with identities. So to prevent miscalculation it is easier to add the count of not saved entries to calculated bag size on client.</li>
</ul>
<h4 id="request_ridbag_get_size-network-command"><a class="header" href="#request_ridbag_get_size-network-command">REQUEST_RIDBAG_GET_SIZE network command</a></h4>
<p><strong>Request:</strong></p>
<pre><code>(treePointer:collectionPointer)(changes)
</code></pre>
<p>See also <a href="internals/RidBag.html#serialization-of-collection-pointer">serialization of collection pointer</a> and <a href="internals/RidBag.html#serialization-of-rid-bag-changes">rid bag changes</a></p>
<p><strong>Response:</strong></p>
<pre><code>(size:int)
</code></pre>
<h3 id="iteration-over-tree-based-ridbag"><a class="header" href="#iteration-over-tree-based-ridbag">Iteration over tree-based RidBag</a></h3>
<p>Iteration over tree-based RidBag could be implemented with <strong>REQUEST_SBTREE_BONSAI_GET_ENTRIES_MAJOR</strong> and <strong>REQUEST_SBTREE_BONSAI_FIRST_KEY</strong>.</p>
<p>Server doesn't know anything about client changes. So iterator implementation should apply changes to the result before returning result to the user.</p>
<p>The algorithm of fetching records from server is following:</p>
<ol>
<li>Get the <em>first key</em> from SB-tree.</li>
<li>Fetch portion of data with <em>getEtriesMajor</em> operation.</li>
<li>Repeat <strong>step 2</strong> while <em>getEtriesMajor</em> returns any result.</li>
</ol>
<h3 id="serialization-of-rid-bag-changes"><a class="header" href="#serialization-of-rid-bag-changes">Serialization of rid bag changes</a></h3>
<pre><code>(changesSize:int)[(link:rid)(changeType:byte)(value:int)]*
</code></pre>
<p>changes could be 2 types:</p>
<ul>
<li><strong>Diff</strong> - value defines how the number of entries is changed for specific link.</li>
<li><strong>Absolute</strong> - sets the number of entries of specified link. The number defined by value field.</li>
</ul>
<h3 id="serialization-of-collection-pointer"><a class="header" href="#serialization-of-collection-pointer">Serialization of collection pointer</a></h3>
<pre><code>(fileId:long)(pageIndex:long)(pageOffset:int)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="entry-points-since-orientdb-v-17"><a class="header" href="#entry-points-since-orientdb-v-17">Entry Points Since OrientDB v 1.7</a></h1>
<p>The entry points for creating a new Index Engine are two:</p>
<ul>
<li>OIndexFactory</li>
<li>OIndexEngine</li>
</ul>
<h2 id="implementing-oindexfactory"><a class="header" href="#implementing-oindexfactory">Implementing OIndexFactory</a></h2>
<p>Create your own factory that implements OIndexFactory.</p>
<p>In your factory you have to declare:</p>
<ol>
<li>Which types of index you support</li>
<li>Which types of algorithms you support</li>
</ol>
<p>and you have to implements the createIndex method</p>
<p>Example of custom factory for Lucene Indexing</p>
<pre><code>package com.orientechnologies.lucene;

import java.util.Collections;
import java.util.HashSet;
import java.util.Set;

import com.orientechnologies.lucene.index.OLuceneFullTextIndex;
import com.orientechnologies.lucene.index.OLuceneSpatialIndex;
import com.orientechnologies.lucene.manager.*;
import com.orientechnologies.lucene.shape.OShapeFactoryImpl;
import com.orientechnologies.orient.core.db.record.ODatabaseRecord;
import com.orientechnologies.orient.core.db.record.OIdentifiable;
import com.orientechnologies.orient.core.exception.OConfigurationException;
import com.orientechnologies.orient.core.index.OIndexFactory;
import com.orientechnologies.orient.core.index.OIndexInternal;
import com.orientechnologies.orient.core.metadata.schema.OClass;
import com.orientechnologies.orient.core.record.impl.ODocument;

/**
 * Created by enricorisa on 21/03/14.
 */
public class OLuceneIndexFactory implements OIndexFactory {

  private static final Set&lt;String&gt; TYPES;
  private static final Set&lt;String&gt; ALGORITHMS;
  public static final String       LUCENE_ALGORITHM = "LUCENE";

  static {
    final Set&lt;String&gt; types = new HashSet&lt;String&gt;();
    types.add(OClass.INDEX_TYPE.UNIQUE.toString());
    types.add(OClass.INDEX_TYPE.NOTUNIQUE.toString());
    types.add(OClass.INDEX_TYPE.FULLTEXT.toString());
    types.add(OClass.INDEX_TYPE.DICTIONARY.toString());
    types.add(OClass.INDEX_TYPE.SPATIAL.toString());
    TYPES = Collections.unmodifiableSet(types);
  }

  static {
    final Set&lt;String&gt; algorithms = new HashSet&lt;String&gt;();
    algorithms.add(LUCENE_ALGORITHM);
    ALGORITHMS = Collections.unmodifiableSet(algorithms);
  }

  public OLuceneIndexFactory() {
  }

  @Override
  public Set&lt;String&gt; getTypes() {
    return TYPES;
  }

  @Override
  public Set&lt;String&gt; getAlgorithms() {
    return ALGORITHMS;
  }

  @Override
  public OIndexInternal&lt;?&gt; createIndex(ODatabaseRecord oDatabaseRecord, String indexType, String algorithm,
      String valueContainerAlgorithm, ODocument metadata) throws OConfigurationException {
    return createLuceneIndex(oDatabaseRecord, indexType, valueContainerAlgorithm, metadata);
  }

  private OIndexInternal&lt;?&gt; createLuceneIndex(ODatabaseRecord oDatabaseRecord, String indexType, String valueContainerAlgorithm,
      ODocument metadata) {
    if (OClass.INDEX_TYPE.FULLTEXT.toString().equals(indexType)) {
      return new OLuceneFullTextIndex(indexType, LUCENE_ALGORITHM, new OLuceneIndexEngine&lt;Set&lt;OIdentifiable&gt;&gt;(
          new OLuceneFullTextIndexManager(), indexType), valueContainerAlgorithm, metadata);
    } else if (OClass.INDEX_TYPE.SPATIAL.toString().equals(indexType)) {
      return new OLuceneSpatialIndex(indexType, LUCENE_ALGORITHM, new OLuceneIndexEngine&lt;Set&lt;OIdentifiable&gt;&gt;(
          new OLuceneSpatialIndexManager(new OShapeFactoryImpl()), indexType), valueContainerAlgorithm);
    }
    throw new OConfigurationException("Unsupported type : " + indexType);
  }
}
</code></pre>
<p>To plug your factory create in your project under META-INF/services a text file called <code>com.orientechnologies.orient.core.index.OIndexFactory</code> and write inside your factory</p>
<p>Example</p>
<pre><code>com.orientechnologies.lucene.OLuceneIndexFactory
</code></pre>
<h2 id="implementing-oindexengine"><a class="header" href="#implementing-oindexengine">Implementing OIndexEngine</a></h2>
<p>To write a new Index Engine implements the OIndexEngine interface.</p>
<p>The main methods are:</p>
<ul>
<li>get</li>
<li>put</li>
</ul>
<h3 id="get-v-getobject-key"><a class="header" href="#get-v-getobject-key">get <code>V get(Object key);</code></a></h3>
<p>You have to return a Set of OIdentifiable or OIdentifiable if your index is unique, associated with the key.
The key could be:</p>
<ul>
<li>The value if you are indexing a single field (Integer,String,Double..etc).</li>
<li>OCompositeKey if you are indexing two or more fields</li>
</ul>
<h3 id="put-void-putobject-key-v-value"><a class="header" href="#put-void-putobject-key-v-value">put <code>void put(Object key, V value);</code></a></h3>
<ul>
<li>The key is the value to be indexed. Could be as written before</li>
<li>The value is a Set of OIdentifiable or OIdentifiable associated with the key</li>
</ul>
<h2 id="create-index-from-sql"><a class="header" href="#create-index-from-sql">Create Index from SQL</a></h2>
<p>You can create an index with your Index Engine with sql with this syntax</p>
<pre><code class="language-sql">CREATE INDEX Foo.bar ON Foo (bar) NOTUNIQUE ENGINE CUSTOM
</code></pre>
<p>where CUSTOM is the name of your index engine</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="caching"><a class="header" href="#caching">Caching</a></h1>
<p>OrientDB has several caching mechanisms that act at different levels. Look at this picture:</p>
<p><img src="http://www.orientdb.org/images/caching.png" alt="image" /></p>
<ul>
<li><strong>Local cache</strong> is one per database instance (and per thread in multi-thread environment)</li>
<li><strong><a href="internals/../datamodeling/Concepts.html">Storage</a></strong>, it could cache depending on the implementation. This is the case for the <strong>Local Storage</strong> (disk-based) that caches file reads to reduce I/O requests</li>
<li><strong><a href="internals/../sql/Command-Cache.html">Command Cache</a></strong></li>
</ul>
<h1 id="how-cache-works"><a class="header" href="#how-cache-works">How cache works?</a></h1>
<h2 id="local-mode-embedded-database"><a class="header" href="#local-mode-embedded-database">Local Mode (embedded database)</a></h2>
<p><img src="http://www.orientdb.org/images/cache-flow.png" alt="image" /></p>
<p>When the client application asks for a record OrientDB checks:</p>
<ul>
<li>if a <strong>transaction</strong> has begun then it searches inside the transaction for changed records and returns it if found</li>
<li>if the <strong>Local cache</strong> is enabled and contains the requested record then return it</li>
<li>otherwise, at this point the record is not in cache, then asks for it to the <strong>Storage</strong> (disk, memory)</li>
</ul>
<h2 id="client-server-mode-remote-database"><a class="header" href="#client-server-mode-remote-database">Client-Server Mode (remote database)</a></h2>
<p><img src="http://www.orientdb.org/images/cache_flow_client_server.png" alt="image" /></p>
<p>When the client application asks for a record OrientDB checks:</p>
<ul>
<li>if a <strong>transaction</strong> has begun then it searches inside the transaction for changed records and returns it if found</li>
<li>if the <strong>Local cache</strong> is enabled and contains the requested record then return it</li>
<li>otherwise, at this point the record is not in cache, then asks for it to the <strong>Server</strong> through a TCP/IP call</li>
<li>in the server, if the <strong>Local cache</strong> is enabled and contains the requested record then return it</li>
<li>otherwise, at this point the record is also not cached in the server, then asks for it to the <strong>Storage</strong> (disk, memory)</li>
</ul>
<h1 id="record-cache"><a class="header" href="#record-cache">Record cache</a></h1>
<h2 id="local-cache"><a class="header" href="#local-cache">Local cache</a></h2>
<p>Local cache acts at database level. Each database instance has a Local cache enabled by default. This cache keeps the used records. Records will be removed from heap if two conditions will be satisfied:</p>
<ol>
<li>There are no links to these records from outside of the database</li>
<li>The Java Virtual Machine doesn't have enough memory to allocate new data</li>
</ol>
<h2 id="empty-local-cache"><a class="header" href="#empty-local-cache">Empty Local cache</a></h2>
<p>To remove all the records in Local cache you can invoke the <code>invalidate()</code> method:</p>
<pre><code class="language-java">db.getLocalCache().invalidate();
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hooks-triggers"><a class="header" href="#hooks-triggers">Hooks (Triggers)</a></h1>
<p>Hooks work like triggers and enable a user's application to intercept internal events before and after each CRUD operation against records. You can use them to write custom validation rules, to enforce security, or even to orchestrate external events like replicating against a Relational DBMS.</p>
<p>OrientDB supports two kinds of Hooks:</p>
<ul>
<li><a href="internals/Dynamic-Hooks.html">Dynamic Hooks</a>, defined at the schema and/or document level</li>
<li>Native <a href="internals/../java/Java-Hooks.html">Java Hooks</a>, defined as Java classes</li>
</ul>
<h3 id="what-use-proscons"><a class="header" href="#what-use-proscons">What use? Pros/Cons?</a></h3>
<p>Depends on your goal: Java Hooks are faster. Write a Java Hook if you need the best performance on execution. Dynamic Hooks are more flexible, can be changed at run-time, and can run per document if needed, but are slower than Java Hooks.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dynamic-hooks"><a class="header" href="#dynamic-hooks">Dynamic Hooks</a></h1>
<p>Dynamic <a href="internals/Hook.html">Hooks</a> are more flexible than <a href="internals/../java/Java-Hooks.html">Java Hooks</a>, because they can be changed at run-time and can run per document if needed, but are slower than <a href="internals/../java/Java-Hooks.html">Java Hooks</a>.</p>
<p>Dynamic Hooks can call:</p>
<ul>
<li><a href="internals/../admin/Functions.html">Functions</a>, written in SQL, Javascript or any language supported by OrientDB and JVM</li>
<li>Java static methods</li>
</ul>
<h2 id="available-events"><a class="header" href="#available-events">Available Events</a></h2>
<p>The following are the available events:</p>
<ul>
<li><code>onBeforeCreate</code>, called <strong>before</strong> creating a new document</li>
<li><code>onAfterCreate</code>, called <strong>after</strong> creating a new document</li>
<li><code>onBeforeRead</code>, called <strong>before</strong> reading a document</li>
<li><code>onAfterRead</code>, called <strong>after</strong> reading a document</li>
<li><code>onBeforeUpdate</code>, called <strong>before</strong> updating a document</li>
<li><code>onAfterUpdate</code>, called <strong>after</strong> updating a document</li>
<li><code>onBeforeDelete</code>, called <strong>before</strong> deleting a document</li>
<li><code>onAfterDelete</code>, called <strong>after</strong> deleting a document</li>
</ul>
<h2 id="class-level-hooks"><a class="header" href="#class-level-hooks">Class level hooks</a></h2>
<p>Class level hooks are defined for all the documents that relate to a class.</p>
<p>To create a Class level hook, let your class to extend <code>OTriggered</code> base class. Then define a custom property for the event you are interested on.</p>
<p>Below is an example to setup a hook that acts at class level against <code>Invoice</code> documents.</p>
<p>First let's create the class <code>Invoice</code> and the custom property on an event, e.g. <code>onAfterCreate</code>:</p>
<pre><code class="language-sql">CREATE CLASS Invoice EXTENDS OTriggered
ALTER CLASS Invoice CUSTOM onAfterCreate=invoiceCreated
</code></pre>
<p>Let's now create the function that will be executed when the <code>onAfterCreate</code> event occurs. For this example we will create a Javascript function (<code>invoiceCreated</code>) that prints in the server console the invoice number created:</p>
<pre><code class="language-sql">CREATE FUNCTION invoiceCreated "print('\\nInvoice created: ' + doc.field('number'));" LANGUAGE Javascript
</code></pre>
<p>Now try the hook by creating a new <code>Invoice</code> document:</p>
<pre><code class="language-sql">INSERT INTO Invoice CONTENT { number: 100, notes: 'This is a test' }
</code></pre>
<p>The following text will appear in the server console:</p>
<pre><code>Invoice created: 100
</code></pre>
<h2 id="document-level-hook"><a class="header" href="#document-level-hook">Document level hook</a></h2>
<p>You could need to define a special action only against one or more documents. To do this, let your class to extend <code>OTriggered</code> class. Then define a property for the event you are interested on, on all documents where you want the hook to be active.</p>
<p>For example, if you want to prevent deletion of all the documents with property <code>account = 'Premium'</code> in the already existing class <code>Profile</code>, first alter the class to set <code>OTriggered</code> as SUPERCLASS:</p>
<pre><code class="language-sql">ALTER CLASS Profile SUPERCLASS OTriggered
</code></pre>
<p>Then use an UPDATE command to set a property with name equals to one of the available <a href="internals/Dynamic-Hooks.html#available-events">Events</a> and value equals to the function you want to be executed when the event occurs:</p>
<pre><code class="language-sql">UPDATE Profile SET onBeforeDelete = 'preventDeletion' WHERE account = 'Premium'
</code></pre>
<p>Now let's create the <code>preventDeletion()</code> function, e.g. in Javascript:</p>
<pre><code class="language-sql">CREATE FUNCTION preventDeletion "throw new java.lang.RuntimeException('Cannot delete Premium profile ' + doc)" LANGUAGE Javascript
</code></pre>
<p>To test the hook try to delete a <code>Premium</code> account, e.g.:</p>
<pre><code class="language-sql">DELETE FROM #12:1
</code></pre>
<p>The following Exception will be returned:</p>
<pre><code>java.lang.RuntimeException: Cannot delete Premium profile profile#12:1{onBeforeDelete:preventDeletion,account:Premium,name:Jill} v-1 (&lt;Unknown source&gt;#2) in &lt;Unknown source&gt; at line number 2
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="native-java-hooks"><a class="header" href="#native-java-hooks">(Native) Java Hooks</a></h1>
<p>Java Hooks are the fastest <a href="java/../internals/Hook.html">hooks</a>. Write a Java Hook if you need the best performance on execution. Look at <a href="java/../internals/Hook.html">Hooks</a> for more information.</p>
<h3 id="the-orecordhook-interface"><a class="header" href="#the-orecordhook-interface">The ORecordHook interface</a></h3>
<p>A hook is an implementation of the interface <a href="https://github.com/orientechnologies/orientdb/blob/develop/core/src/main/java/com/orientechnologies/orient/core/hook/ORecordHook.java">ORecordHook</a>:</p>
<pre><code class="language-java">public interface ORecordHook {
  public enum TYPE {
    ANY,
    BEFORE_CREATE, BEFORE_READ, BEFORE_UPDATE, BEFORE_DELETE,
    AFTER_CREATE, AFTER_READ, AFTER_UPDATE, AFTER_DELETE
  };

  public void onTrigger(TYPE iType, ORecord&lt;?&gt; iRecord);
}
</code></pre>
<h3 id="the-orecordhookabstract-abstract-class"><a class="header" href="#the-orecordhookabstract-abstract-class">The ORecordHookAbstract abstract class</a></h3>
<p>OrientDB comes with an abstract implementation of the <a href="https://github.com/orientechnologies/orientdb/blob/develop/core/src/main/java/com/orientechnologies/orient/core/hook/ORecordHook.java">ORecordHook</a> interface called <a href="https://github.com/orientechnologies/orientdb/blob/develop/core/src/main/java/com/orientechnologies/orient/core/hook/ORecordHookAbstract.java">ORecordHookAbstract.java</a>. It switches the callback event, calling separate methods for each one:</p>
<pre><code class="language-java">public abstract class ORecordHookAbstract implements ORecordHook {
  public void onRecordBeforeCreate(ORecord&lt;?&gt; iRecord){}
  public void onRecordAfterCreate(ORecord&lt;?&gt; iRecord){}
  public void onRecordBeforeRead(ORecord&lt;?&gt; iRecord){}
  public void onRecordAfterRead(ORecord&lt;?&gt; iRecord){}
  public void onRecordBeforeUpdate(ORecord&lt;?&gt; iRecord){}
  public void onRecordAfterUpdate(ORecord&lt;?&gt; iRecord){}
  public void onRecordBeforeDelete(ORecord&lt;?&gt; iRecord){}
  public void onRecordAfterDelete(ORecord&lt;?&gt; iRecord){}
  ...
}
</code></pre>
<h3 id="the-odocumenthookabstract-abstract-class"><a class="header" href="#the-odocumenthookabstract-abstract-class">The ODocumentHookAbstract abstract class</a></h3>
<p>When you want to catch an event from a Document only, the best way to create a hook is to extend the <code>ODocumentHookAbstract</code> abstract class. You can specify what classes you're interested in. In this way the callbacks will be called only on documents of the specified classes. Classes are polymorphic so filtering works against specified classes and all sub-classes.</p>
<p>You can specify only the class you're interested or the classes you want to exclude. Example to include only the <code>Client</code> and <code>Provider</code> classes:</p>
<pre><code class="language-java">public class MyHook extends ODocumentHookAbstract {
  public MyHook(ODatabaseDocument database){
     super(database);
  }
  
  public MyHook() {
    setIncludeClasses("Client", "Provider");
  }
}
</code></pre>
<p>Example to get called for all the changes on documents of any class but <code>Log</code>:</p>
<pre><code class="language-java">public class MyHook extends ODocumentHookAbstract {
  public MyHook(ODatabaseDocument database){
     super(database);
  }
  
  public MyHook() {
    setExcludeClasses("Log");
  }
}
</code></pre>
<h3 id="access-to-the-modified-fields"><a class="header" href="#access-to-the-modified-fields">Access to the modified fields</a></h3>
<p>In Hook methods you can access dirty fields and the original values. Example:</p>
<pre><code class="language-java">for( String field : document.getDirtyFields() ) {
  Object originalValue = document.getOriginalValue( field );
  ...
}
</code></pre>
<h3 id="self-registration"><a class="header" href="#self-registration">Self registration</a></h3>
<p>Hooks can be installed on certain database instances, but in most cases you'll need to register it for each instance. To do this programmatically you can intercept the <code>onOpen()</code> and <code>onCreate()</code> callbacks from OrientDB to install hooks. All you need is to implement the <code>ODatabaseLifecycleListener</code> interface. Example:</p>
<pre><code class="language-java">public class MyHook extends ODocumentHookAbstract implements ODatabaseLifecycleListener {
  public MyHook(ODatabaseDocument database){
     super(database);
  }
  
  public MyHook() {
    // REGISTER MYSELF AS LISTENER TO THE DATABASE LIFECYCLE
    Orient.instance().addDbLifecycleListener(this);
  }
  ...
  @Override
  public void onOpen(final ODatabase iDatabase) {
    // REGISTER THE HOOK
    ((ODatabaseComplex&lt;?&gt;)iDatabase).registerHook(this);
  }

  @Override
  public void onCreate(final ODatabase iDatabase) {
    // REGISTER THE HOOK
    ((ODatabaseComplex&lt;?&gt;)iDatabase).registerHook(this);
  }

  @Override
  public void onClose(final ODatabase iDatabase) {
    // REGISTER THE HOOK
    ((ODatabaseComplex&lt;?&gt;)iDatabase).unregisterHook(this);
  }
  ...
  public RESULT onRecordBeforeCreate(final ODocument iDocument) {
    // DO SOMETHING BEFORE THE DOCUMENT IS CREATED
    ...
  }
  ...
}
</code></pre>
<h3 id="hook-example"><a class="header" href="#hook-example">Hook example</a></h3>
<p>In this example the events <code>before-create</code> and <code>after-delete</code> are called during the <code>save()</code> of the <code>Profile</code> object where:</p>
<ul>
<li><code>before-create</code> is used to check custom validation rules</li>
<li><code>after-delete</code> is used to maintain the references valid</li>
</ul>
<pre><code class="language-java">public class HookTest extends ORecordHookAbstract {

  /**
   * Custom validation rules
   */
  @Override
  public void onRecordBeforeCreate(ORecord&lt;?&gt; iRecord){
    if( iRecord instanceof ODocument ){
      ODocument doc = (ODocument) iRecord;
      Integer age = doc .field( "age" );
      if( age != null &amp;&amp; age &gt; 130 )
        throw new OValidationException("Invalid age");
    }
  }

  /**
   * On deletion removes the reference back.
   */
  @Override
  public void onRecordAfterDelete(ORecord&lt;?&gt; iRecord){
    if( iRecord instanceof ODocument ){
      ODocument doc = (ODocument) iRecord;

      Set&lt;OIdentifiable&gt; friends = doc.field( "friends" );
      if( friends != null ){
        for( OIdentifiable friend : friends ){
          Set&lt;OIdentifiable&gt; otherFriends = ((ODocument)friend.getRecord()).field("friends");
          if( friends != null )
            friends.remove( iRecord );
        }
      }
    }
  }
}
</code></pre>
<p>For more information take a look to the <a href="https://github.com/orientechnologies/orientdb/blob/develop/tests/src/test/java/com/orientechnologies/orient/test/database/auto/HookTest.java">HookTest.java</a> source code.</p>
<h3 id="install-server-side-hooks"><a class="header" href="#install-server-side-hooks">Install server-side hooks</a></h3>
<p>To let a hook be executed in the Server space you have to register it in the server <code>orientdb-server-config.xml</code> configuration file.</p>
<h4 id="write-your-hook"><a class="header" href="#write-your-hook">Write your hook</a></h4>
<p>Example of a hook to execute custom validation rules:</p>
<pre><code class="language-java">public class CustomValidationRules implements ORecordHook{
  /**
   * Apply custom validation rules
   */
  public boolean onTrigger(final TYPE iType, final ORecord&lt;?&gt; iRecord) {
    if( iRecord instanceof ODocument ){
      ODocument doc = (ODocument) iRecord;

      switch( iType ){
        case BEFORE_CREATE:
        case BEFORE_UPDATE: {
          if( doc.getClassName().equals("Customer") ){
            Integer age = doc .field( "age" );
            if( age != null &amp;&amp; age &gt; 130 )
              throw new OValidationException("Invalid age");
          }
          break;
        }

        case BEFORE_DELETE: {
          if( doc.getClassName().equals("Customer") ){
            final ODatabaseRecord db = ODatabaseRecordThreadLocal.INSTANCE.get();
            if( !db.getUser().getName().equals( "admin" ) )
              throw new OSecurityException("Only admin can delete customers");
          }
          break;
        }
    }
  }
}
</code></pre>
<h4 id="deploy-the-hook"><a class="header" href="#deploy-the-hook">Deploy the hook</a></h4>
<p>Once implemented create a <code>.jar</code> file containing your class and put it under the <code>$ORIENTDB_HOME/lib</code> directory.</p>
<h4 id="register-it-in-the-server-configuration"><a class="header" href="#register-it-in-the-server-configuration">Register it in the server configuration</a></h4>
<p>Change the <code>orientdb-server-config.xml</code> file adding your hook inside the <code>&lt;hooks&gt;</code> tag. The position can be one of following values <code>FIRST</code>, <code>EARLY</code>, <code>REGULAR</code>, <code>LATE</code>, <code>LAST</code>:</p>
<pre><code class="language-xml">&lt;orient-server&gt;
   
  &lt;hooks&gt;
    &lt;hook class="org.orientdb.test.MyHook" position="REGULAR"/&gt;
  &lt;hooks&gt;
</code></pre>
<h4 id="configurable-hooks"><a class="header" href="#configurable-hooks">Configurable hooks</a></h4>
<p>If your hook must be configurable with external parameters write the parameters in the <code>orientdb-server-config.xml</code> file:</p>
<pre><code class="language-xml">&lt;hook class="org.orientdb.test.MyHook" position="REGULAR"&gt;
    &lt;parameters&gt;
        &lt;parameter name="userCanDelete" value="admin" /&gt;
    &lt;/parameters&gt;
&lt;/hook&gt;
</code></pre>
<p>And in your Java class implement the config() method to read the parameter:</p>
<pre><code class="language-java">private String userCanDelete;
...
public void config(OServer oServer, OServerParameterConfiguration[] iParams) {
  for (OServerParameterConfiguration param : iParams) {
    if (param.name.equalsIgnoreCase("userCanDelete")) {
      userCanDelete = param.value;
    }
  }
}
...
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-server-1"><a class="header" href="#orientdb-server-1">OrientDB Server</a></h1>
<p>OrientDB Server (DB-Server from now) is a multi-threaded Java application that listens to remote commands and executes them against the Orient databases. OrientDB Server supports both <a href="internals/Network-Binary-Protocol.html">binary</a> and <a href="internals/../misc/OrientDB-REST.html">HTTP</a> protocols. The first one is used by the Orient native client and the Orient Console. The second one can be used by any languages since it's based on <a href="internals/../misc/OrientDB-REST.html">HTTP RESTful API</a>. The HTTP protocol is used also by the <a href="internals/../studio/README.html">OrientDB Studio application</a>.</p>
<p>Starting from v1.7 OrientDB support <a href="internals/../security/Using-SSL-with-OrientDB.html">protected SSL connections</a>.</p>
<div class="table-wrapper"><table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td><img src="internals/../images/warning.png" alt="warning" /></td><td>Even thought OrientDB Server is a regular Web Server, it is not recommended to expose it directly on the Internet or public networks. We suggest to always hide OrientDB server in a private network.</td></tr>
</tbody></table>
</div>
<h2 id="install-as-a-service"><a class="header" href="#install-as-a-service">Install as a service</a></h2>
<p>OrientDB Server is part of Community and Enterprise distributions. To install OrientDB as service follow the following guides</p>
<ul>
<li><a href="internals/../admin/Unix-Service.html">Unix, Linux and MacOSX</a></li>
<li><a href="internals/../admin/Windows-Service.html">Windows</a></li>
</ul>
<h2 id="start-the-server"><a class="header" href="#start-the-server">Start the server</a></h2>
<p>To start the server, execute bin/server.sh (or bin/server.bat on Microsoft Windows systems). By default both the binary and http interfaces are active. If you want to disable one of these change the <a href="internals/DB-Server.html#configuration">Server configuration</a>.</p>
<p>Upon startup, the server runs on port 2424 for the binary protocol and 2480 for the http one. If a port is busy the next free one will be used. The default range is 2424-2430 (binary) and 2480-2490 (http). These default ranges can be changed in in <a href="internals/DB-Server.html#configuration">Server configuration</a>.</p>
<h2 id="stop-the-server-1"><a class="header" href="#stop-the-server-1">Stop the server</a></h2>
<p>To stop a running server, press CTRL+C in the open shell that runs the Server instance or soft kill the process to be sure that the opened databases close softly. Soft killing on Windows can be done by closing the window. On Unix-like systems, a simple kill is enough (Do not use kill -9 unless you want to force a hard shutdown).</p>
<h2 id="dump-the-server-status"><a class="header" href="#dump-the-server-status">Dump the server status</a></h2>
<p>In order to display the internal status of an OrientDB server, you can send an interrupt to the process. In Unix based OS you can do that by executing <code>kill -5 &lt;orientdb-server-pid&gt;</code>. To know more about this topic, please visit the <a href="internals/Server-Status.html">Server Status</a> page.</p>
<h2 id="connect-to-the-server"><a class="header" href="#connect-to-the-server">Connect to the server</a></h2>
<h3 id="by-console"><a class="header" href="#by-console">By Console</a></h3>
<p>The OrientDB distribution provides the <a href="internals/../console/README.html">Orient Console</a> tool as a console Java application that uses the binary protocol to work with the database.</p>
<h3 id="by-orientdb-studio"><a class="header" href="#by-orientdb-studio">By OrientDB Studio</a></h3>
<p>Starting from the release 0.9.13 Orient comes with the <a href="internals/../studio/README.html">OrientDB Studio application</a>, a client-side web app that uses the HTTP protocol to work with the database.</p>
<h3 id="by-your-application"><a class="header" href="#by-your-application">By your application</a></h3>
<p>Consider the <a href="internals/../java/Java-API.html">native APIs</a> if you use Java. For all the other languages you can use the <a href="internals/../misc/OrientDB-REST.html">HTTP RESTful protocol</a>.</p>
<h2 id="distributed-servers"><a class="header" href="#distributed-servers">Distributed servers</a></h2>
<p>To setup a distributed configuration look at: <a href="internals/../distributed/Distributed-Architecture.html">Distributed-Architecture</a>.</p>
<h2 id="change-the-servers-database-directory"><a class="header" href="#change-the-servers-database-directory">Change the Server's database directory</a></h2>
<p>By default OrientDB server manages the database under the directory "$ORIENTDB_HOME/databases" where $ORIENTDB_HOME is the OrientDB installation directory. By setting the configuration parameter <code>"server.database.path"</code> in server orientdb-server-config.xml you can specify a custom path. Example:</p>
<pre><code class="language-xml">&lt;orient-server&gt;
  ...
  &lt;properties&gt;
    &lt;entry value="C:/temp/databases" name="server.database.path" /&gt;
  &lt;/properties&gt;
&lt;/orient-server&gt;
</code></pre>
<h2 id="configuration-13"><a class="header" href="#configuration-13">Configuration</a></h2>
<h3 id="plugins-1"><a class="header" href="#plugins-1">Plugins</a></h3>
<p>Plug-ins (old name "Handler") are the way the OrientDB Server can be extended.</p>
<p>To write your own plug-in read below <a href="internals/../plugins/Extend-Server.html">Extend the server</a>.</p>
<p>Available plugins:</p>
<ul>
<li><a href="internals/../plugins/Automatic-Backup.html">Automatic-Backup</a></li>
<li><a href="internals/../plugins/Mail-Plugin.html">EMail Plugin</a></li>
<li><a href="internals/../plugins/JMX-Plugin.html">JMX Plugin</a></li>
<li><a href="internals/../distributed/Distributed-Server-Manager.html">Distributed-Server-Manager</a></li>
<li><a href="internals/../js/Javascript-Command.html#enable-server-side-scripting">Server-side script interpreter</a></li>
<li><a href="internals/../plugins/Extend-Server.html">Write your own</a></li>
</ul>
<h3 id="protocols"><a class="header" href="#protocols">Protocols</a></h3>
<p>Contains the list of protocols used by the <a href="internals/DB-Server.html#listeners">listeners section</a>.
The protocols supported today are:</p>
<ul>
<li><strong>binary</strong>: the Raw binary protocol used by OrientDB clients and console application.</li>
<li><strong>http</strong>: the HTTP RESTful protocol used by <a href="internals/../studio/README.html">OrientDB Studio</a> and direct raw access from any language and browsers.</li>
</ul>
<h3 id="listeners"><a class="header" href="#listeners">Listeners</a></h3>
<p>You can configure multiple listeners by adding items under the <code>&lt;listeners&gt;</code> tag and selecting the ip-address and TCP/IP port to bind. The protocol used must be listed in the <a href="internals/DB-Server.html#protocols">protocols section</a>. Listeners can be configured with single port or port range. If a range of ports is specified, then it will try to acquire the first port available. If no such port is available, then an error is thrown.
By default the Server configuration activates connections from both the protocols:</p>
<ul>
<li><strong>binary</strong>: by default the binary connections are listened to the port range 2424-2430.</li>
<li><strong>http</strong>: by default the HTTP connections are listened to the port range 2480-2490.</li>
</ul>
<h3 id="storages-1"><a class="header" href="#storages-1">Storages</a></h3>
<p>Contains the list of the static configured storages. When the server starts for each storages static configured storage enlisted check if exists. If exists opens it, otherwise creates it transparently.</p>
<p>By convention all the storages contained in the $ORIENT_HOME/databases are visible from the OrientDB Server instance without the need of configure them. So configure storages if:</p>
<ul>
<li>are located outside the default folder. You can use any environment variable in the path such the ORIENT_HOME that points to the Orient installation path if defined otherwise to the root directory where the Orient Server starts.</li>
<li>want to create/open automatically a database when the server start ups</li>
</ul>
<p>By default the <strong>"temp"</strong> database is always configured as in-memory storage useful to store volatile information.</p>
<p>Example of configuration:</p>
<pre><code class="language-xml">&lt;storage name="mydb" path="local:C:/temp/databases/mydb"
         userName="admin" userPassword="admin"
         loaded-at-startup="true" /&gt;
</code></pre>
<p>To create a new database use the <a href="internals/../console/Console-Command-Create-Database.html">CREATE DATABASE console command</a> or create it dynamically using the <a href="internals/../java/Java-API.html">Java-API</a>.</p>
<h3 id="users-3"><a class="header" href="#users-3">Users</a></h3>
<p>Starting from v.0.9.15 OrientDB supports per-server users in order to protect sensible operations to the users. In facts the creation of a new database is a server operation as much as the retrieving of server statistics.</p>
<h4 id="automatic-password-generation"><a class="header" href="#automatic-password-generation">Automatic password generation</a></h4>
<p>When an OrientDB server starts for the first time, a new user called "root" will be generated and saved in the server configuration. This avoid security problems when, very often, the passwords remain the default ones.</p>
<h4 id="resources-6"><a class="header" href="#resources-6">Resources</a></h4>
<p>User based authentication checks if the logged user has the permission to access to the requested resource. "*" means access to all the resource. This is the typical setting for the user "root". Multiple resources must be separated by comma.</p>
<p>Example to let to the "root" user to access to all the server commands:</p>
<pre><code class="language-xml">&lt;user name="root" resources="*" password="095F17F6488FF5416ED24E"/&gt;
</code></pre>
<p>Example to let to the "guest" user to access only to the "info-server" command:</p>
<pre><code class="language-xml">&lt;user name="guest" resources="info-server" password="3489438DKJDK4343UDH76"/&gt;
</code></pre>
<p>Supported resources are:</p>
<ul>
<li><code>info-server</code>, to obtain statistics about the server</li>
<li><code>database.create</code>, to create a new database</li>
<li><code>database.exists</code>, to check if a database exists</li>
<li><code>database.delete</code>, to delete an existent database</li>
<li><code>database.share</code>, to share a database to another OrientDB Server node</li>
<li><code>database.passthrough</code>, to access to the hosted databases without database's authentication</li>
<li><code>server.config.get</code>, to retrieve a configuration setting value</li>
<li><code>server.config.set</code>, to set a configuration setting value</li>
</ul>
<h3 id="create-new-user-with-some-privileges"><a class="header" href="#create-new-user-with-some-privileges">Create new user with some privileges</a></h3>
<p>To configure a new user open the <strong>config/orientdb-server-config.xml</strong> file and add a new XML tag under the tag <code>&lt;users&gt;</code>:</p>
<pre><code class="language-xml">&lt;users&gt;
    &lt;user name="MyUser" password="MyPassword" resources="database.exists"/&gt;
&lt;/users&gt;
</code></pre>
<h2 id="extend-the-server"><a class="header" href="#extend-the-server">Extend the server</a></h2>
<p>To extend the server's features look at <a href="internals/../plugins/Extend-Server.html">Extends the server</a>.</p>
<h2 id="debug-the-server-1"><a class="header" href="#debug-the-server-1">Debug the server</a></h2>
<p>To debug the server configure your IDE to execute the class OServerMain:</p>
<pre><code class="language-java">com.orientechnologies.orient.server.OServerMain
</code></pre>
<p>Passing these parameters:</p>
<pre><code>-server
-Dorientdb.config.file=config/orientdb-server-config.xml
-Dorientdb.www.path=src/site
-DORIENTDB_HOME=url/local/orientdb/releases/orientdb-1.2.0-SNAPSHOT
-Djava.util.logging.config.file=config/orientdb-server-log.properties
-Dcache.level1.enabled=false
-Dprofiler.enabled=true
</code></pre>
<p>Changing the ORIENTDB_HOME according to your path.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="server-status"><a class="header" href="#server-status">Server Status</a></h1>
<p>The server status can be obtained by executing a <code>kill -5 &lt;server-pid&gt;</code>. The status will be written to the standard output, by default the console output of the server.
The dump contains the following information:</p>
<ul>
<li>Current settings</li>
<li>Stack Trace of all the threads</li>
<li>Replication latency (if running in HA mode)</li>
<li>Replication messages statistics (if running in HA mode)</li>
<li>Distributed resources locked (if running in HA mode)</li>
<li>Record locks per database (if running in HA mode)</li>
</ul>
<p>Below an example of a dump.</p>
<pre><code>2017-08-21 16:51:25:060 WARNI Received signal: SIGTRAP [OSignalHandler]
OrientDB 2.2.27-SNAPSHOT (build b3c2429a7f0992cd650c61917a171134fa0c6794) configuration dump:
- ENVIRONMENT
  + environment.dumpCfgAtStartup = false
  + environment.concurrent = true
  + environment.lockManager.concurrency.level = 64
  + environment.allowJVMShutdown = true
...

THREAD DUMP
"SIGTRAP handler" id=226 
   java.lang.Thread.State: RUNNABLE
        at sun.management.ThreadImpl.getThreadInfo1(Native Method)
        at sun.management.ThreadImpl.getThreadInfo(ThreadImpl.java:174)
        at com.orientechnologies.common.profiler.OAbstractProfiler.threadDump(OAbstractProfiler.java:432)
        at com.orientechnologies.orient.core.OSignalHandler.handle(OSignalHandler.java:76)
        at sun.misc.Signal$1.run(Signal.java:212)
        at java.lang.Thread.run(Thread.java:745)

"Thread-176" id=224 
   java.lang.Thread.State: WAITING
        at sun.misc.Unsafe.park(Native Method)
        at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)
        at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2039)
        at java.util.concurrent.ArrayBlockingQueue.take(ArrayBlockingQueue.java:403)
        at com.orientechnologies.agent.event.OEventController.run(OEventController.java:214)
...

REPLICATION LATENCY AVERAGE (in milliseconds)
+-------+-----+------+
|Servers|node1|node2*|
+-------+-----+------+
|node1  |     |      |
|node2* |47.32|      |
+-------+-----+------+

REPLICATION MESSAGE COUNTERS (servers: source on the row and destination on the column)
+-------+-----+------+-----+
|Servers|node1|node2*|TOTAL|
+-------+-----+------+-----+
|node1  |     |      |    0|
|node2* |   63|      |   63|
+-------+-----+------+-----+
|TOTAL  |   63|  null|   63|
+-------+-----+------+-----+

REPLICATION MESSAGE CURRENT NODE STATS
+-------+----------+--------+---------+---------------+-----+
|Servers|upd_db_cfg|exc_lock|deploy_db|deploy_delta_db|TOTAL|
+-------+----------+--------+---------+---------------+-----+
|node1  |          |        |         |               |    0|
|node2* |        17|      30|        1|             15|   63|
+-------+----------+--------+---------+---------------+-----+
|TOTAL  |        17|      30|        1|             15|   63|
+-------+----------+--------+---------+---------------+-----+

HA RESOURCE LOCKS FOR SERVER 'node2'

DATABASE 'foo_14' ON SERVER 'node2'
- HA RECORD LOCKS FOR DATABASE 'foo_14'
- MESSAGES IN QUEUES (8 WORKERS):
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="web-server"><a class="header" href="#web-server">Web Server</a></h1>
<div class="table-wrapper"><table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td><img src="internals/../images/warning.png" alt="" /></td><td>Even though OrientDB Server is a regular Web Server, it is not recommended to expose it directly on the Internet or public networks. We suggest to always hide OrientDB server in a private network.</td></tr>
</tbody></table>
</div>
<p>Global settings can be set at JVM startup (<code>java ... -D&lt;setting&gt;="&lt;value&gt;"</code>) or in <code>orientdb-server-config.xml</code> file under "properties" XML tag.</p>
<h2 id="avoid-exposing-orientdb-server-to-a-public-network"><a class="header" href="#avoid-exposing-orientdb-server-to-a-public-network">Avoid exposing OrientDB Server to a public network</a></h2>
<p>By default, OrientDB listens to all the network interfaces (<code>0.0.0.0</code>). It's strongly suggested to not open OrientDB server on public networks. To force OrientDB to bind to only one network, please edit the file <code>config/orientdb-server-config.xml</code>.  Replace <code>"0.0.0.0</code> with <code>127.0.0.1</code> if you want only local clients to have access to the server or any other valid IP you want to publish OrientDB. This is the default configuration:</p>
<pre><code class="language-xml">&lt;listeners&gt;
  &lt;listener protocol="binary" socket="default" port-range="2424-2430" ip-address="0.0.0.0"/&gt;
  &lt;listener protocol="http" socket="default" port-range="2480-2490" ip-address="0.0.0.0"&gt;
&lt;/listeners&gt;
</code></pre>
<p>To bind OrientDB server only to the local server, change it into:</p>
<pre><code class="language-xml">&lt;listeners&gt;
  &lt;listener protocol="binary" socket="default" port-range="2424-2430" ip-address="127.0.0.1"/&gt;
  &lt;listener protocol="http" socket="default" port-range="2480-2490" ip-address="127.0.0.1"&gt;
&lt;/listeners&gt;
</code></pre>
<h2 id="maximum-content-length"><a class="header" href="#maximum-content-length">Maximum content length</a></h2>
<p>OrientDB by default allows a request content of maximum 1 MB. To change this limitation set the global configuration <code>network.http.maxLength</code> to the needed value.</p>
<h2 id="charset"><a class="header" href="#charset">Charset</a></h2>
<p>OrientDB uses UTF-8 as the default charset. To change it set the global configuration <code>network.http.charset</code>.</p>
<h2 id="jsonp"><a class="header" href="#jsonp">JSONP</a></h2>
<p>JSONP is supported by OrientDB Web Server, but disabled by default. To enable it set the coniguration <code>network.http.jsonp=true</code></p>
<p>This is a global setting, so you can set it at JVM startup (<code>java ... -Dnetwork.http.jsonp=true</code>) or by setting it as property in <code>orientdb-server-config.xml</code> file under "properties" XML tag.</p>
<h2 id="cross-site"><a class="header" href="#cross-site">Cross Site</a></h2>
<p>Cross site requests are disabled by default.</p>
<p>To enable it, set a couple of additional headers in <code>orientdb-server-config.xml</code> under the HTTP listener XML tag:</p>
<pre><code class="language-xml">&lt;listener protocol="http" ip-address="0.0.0.0" port-range="2480-2490" socket="default"&gt;
  &lt;parameters&gt;
    &lt;parameter name="network.http.additionalResponseHeaders" value="Access-Control-Allow-Origin: *;Access-Control-Allow-Credentials: true" /&gt;
  &lt;/parameters&gt;
&lt;/listener&gt;
</code></pre>
<p>This setting is also global, so you can set it at JVM startup (<code>java ... -Dnetwork.http.additionalResponseHeaders="Access-Control-Allow-Origin: *;Access-Control-Allow-Credentials: true"</code>) or by setting it as property in <code>orientdb-server-config.xml</code> file under "properties" XML tag.</p>
<h2 id="clickjacking"><a class="header" href="#clickjacking">Clickjacking</a></h2>
<p>Look also: <a href="https://en.wikipedia.org/wiki/Clickjacking">Clickjacking on WikiPedia</a> and  <a href="https://www.owasp.org/index.php/Clickjacking">Clickjacking on OWASP</a></p>
<p>You can disable clickjacking in OrientDB by setting the additional header <code>X-FRAME-OPTIONS</code> to <code>DENY</code> in all the HTTP responses.</p>
<p>To enable it, set a couple of additional headers in <code>orientdb-server-config.xml</code> under the HTTP listener XML tag:</p>
<pre><code class="language-xml">&lt;listener protocol="http" ip-address="0.0.0.0" port-range="2480-2490" socket="default"&gt;
  &lt;parameters&gt;
    &lt;parameter name="network.http.additionalResponseHeaders" value="X-FRAME-OPTIONS: DENY" /&gt;
  &lt;/parameters&gt;
&lt;/listener&gt;
</code></pre>
<p>This setting is also global, so you can set it at JVM startup (<code>java ... -Dnetwork.http.additionalResponseHeaders="X-FRAME-OPTIONS: DENY"</code>) or by setting it as property in <code>orientdb-server-config.xml</code> file under "properties" XML tag.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="binary-protocol"><a class="header" href="#binary-protocol">Binary Protocol</a></h1>
<p>Current protocol version for 3.0.x: <strong>37</strong>. Look at <a href="internals/Network-Binary-Protocol.html#compatibility">Compatibility</a> for retro-compatibility.</p>
<h1 id="introduction-9"><a class="header" href="#introduction-9">Introduction</a></h1>
<p>The OrientDB binary protocol is the fastest way to interface a client application to an OrientDB Server instance. The aim of this page is to provide a starting point from which to build a language binding, maintaining high-performance.</p>
<p>If you'd like to develop a new binding, please take a look to the available ones before starting a new project from scratch: <a href="internals/../apis-and-drivers/README.html">Existent Drivers</a>.</p>
<p>Also, check the available <a href="internals/../misc/OrientDB-REST.html">REST implementations</a>.</p>
<p>Before starting, please note that:</p>
<ul>
<li><strong><a href="internals/../datamodeling/Concepts.html#record">Record</a></strong> is an abstraction of <strong><a href="internals/../datamodeling/Concepts.html#document">Document</a></strong>. However, keep in mind that in OrientDB you can handle structures at a lower level than Documents. These include positional records, raw strings, raw bytes, etc.</li>
</ul>
<p>For more in-depth information please look at the Java classes:</p>
<ul>
<li>Client side: <a href="https://github.com/nuvolabase/orientdb/tree/master/client/src/main/java/com/orientechnologies/orient/client/remote/OStorageRemote.java">OStorageRemote.java</a></li>
<li>Server side: <a href="https://github.com/nuvolabase/orientdb/tree/master/server/src/main/java/com/orientechnologies/orient/server/network/protocol/binary/ONetworkProtocolBinary.java">ONetworkProtocolBinary.java</a></li>
<li>Protocol constants: <a href="https://github.com/nuvolabase/orientdb/tree/master/enterprise/src/main/java/com/orientechnologies/orient/enterprise/channel/binary/OChannelBinaryProtocol.java">OChannelBinaryProtocol.java</a></li>
</ul>
<h2 id="connection-1"><a class="header" href="#connection-1">Connection</a></h2>
<p><em>(Since 0.9.24-SNAPSHOT Nov 25th 2010)</em> Once connected, the server sends a short number (2 byte) containing the binary protocol number. The client should check that it supports that version of the protocol. Every time the protocol changes the version is incremented.</p>
<h2 id="getting-started-2"><a class="header" href="#getting-started-2">Getting started</a></h2>
<p>After the connection has been established, a client can <b>Connect</b> to the server or request the opening of a database <b>Database Open</b>. Currently, only TCP/IP raw sockets are supported. For this operation use socket APIs appropriate to the language you're using. After the <b>Connect</b> and <b>Database Open</b> all the client's requests are sent to the server until the client closes the socket. When the socket is closed, OrientDB Server instance frees resources the used for the connection.</p>
<p>The first operation following the socket-level connection must be one of:</p>
<ul>
<li><a href="internals/Network-Binary-Protocol.html#connection">Connect to the server</a> to work with the OrientDB Server instance</li>
<li><a href="internals/Network-Binary-Protocol.html#request_db_open">Open a database</a> to open an existing database</li>
</ul>
<p>In both cases a <a href="internals/Network-Binary-Protocol.html#session-id">Session ID</a> is sent back to the client. The server assigns a unique Session-Id to the client. This value must be used for all further operations against the server. You may open a database after connecting to the server, using the same Session-Id</p>
<h2 id="session"><a class="header" href="#session">Session</a></h2>
<p>The session management supports two modes: stateful and stateless:</p>
<ul>
<li>the stateful is based on a <a href="internals/Network-Binary-Protocol.html#session-id">Session ID</a></li>
<li>the stateless is based on a <a href="internals/Network-Binary-Protocol.html#token">Token</a></li>
</ul>
<p>The session mode is selected at open/connect operation.</p>
<h2 id="session-id"><a class="header" href="#session-id">Session ID</a></h2>
<p>All the operations that follow the open/connect must contain, as the first parameter, the client <strong>Session-Id</strong> (as Integer, 4 bytes) and it will be sent back on completion of the request just after the result field.</p>
<p><em>NOTE: In order to create a new server-side connection, the client must send a negative number into the open/connect calls.</em></p>
<p>This <strong>Session-Id</strong> can be used into the client to keep track of the requests if it handles multiple session bound to the same connection. In this way the client can implement a sharing policy to save resources. This requires that the client implementation handle the response returned and dispatch it to the correct caller thread.</p>
<div class="table-wrapper"><table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td><img src="internals/../images/warning.png" alt="" /></td><td>Opening multiple TCP/IP sockets against OrientDB Server allows to parallelize requests. However, pay attention to use one Session-id per connection. If multiple sockets use the same Session-Id, requests will not be executed concurrently on the server side.</td></tr>
</tbody></table>
</div>
<h2 id="token"><a class="header" href="#token">Token</a></h2>
<p>All the operation in a stateless session are based on the token, the token is a byte[] that contains all the information for the interaction with the server, the token is acquired at the moment of open or connect, and need to be resend for each request. the session id used in the stateful requests is still there and is used to associate the request to the response. in the response can be resend a token in case of expire renew.</p>
<h1 id="enable-debug-messages-on-protocol"><a class="header" href="#enable-debug-messages-on-protocol">Enable debug messages on protocol</a></h1>
<p>To make the development of a new client easier it's strongly suggested to activate debug mode on the binary channel. To activate this, edit the file <code>orientdb-server-config.xml</code> and configure the new parameter <code>network.binary.debug</code> on the "binary" or "distributed" listener. E.g.:</p>
<pre><code>...
&lt;listener protocol="distributed" port-range="2424-2430"
ip-address="127.0.0.1"&gt;
  &lt;parameters&gt;
    &lt;parameter name="network.binary.debug" value="true" /&gt;
  &lt;/parameters&gt;
&lt;/listener&gt;
...
</code></pre>
<p>In the log file (or the console if you have configured the <code>orientdb-server-log.properties</code> file)
all the packets received will be printed.</p>
<h1 id="exchange"><a class="header" href="#exchange">Exchange</a></h1>
<p>This is the typical exchange of messages between client and server sides:</p>
<pre><code>+------+ +------+
|Client| |Server|
+------+ +------+
| TCP/IP Socket connection |
+--------------------------&gt;|
| DB_OPEN |
+--------------------------&gt;|
| RESPONSE (+ SESSION-ID) |
+&lt;--------------------------+
... ...
| REQUEST (+ SESSION-ID) |
+--------------------------&gt;|
| RESPONSE (+ SESSION-ID) |
+&lt;--------------------------+
... ...
| DB_CLOSE (+ SESSION-ID) |
+--------------------------&gt;|
| TCP/IP Socket close |
+--------------------------&gt;|
</code></pre>
<h1 id="network-message-format"><a class="header" href="#network-message-format">Network message format</a></h1>
<p>In explaining the network messages these conventions will be used:</p>
<ul>
<li>fields are bracketed by parenthesis and contain the name and the type separated by ':'. E.g. <code>(length:int)</code></li>
</ul>
<h1 id="supported-types-1"><a class="header" href="#supported-types-1">Supported types</a></h1>
<p>The network protocol supports different types of information:</p>
<table>
<tbody>
<tr><th>Type</th><th>Minimum length in bytes</th><th>Maximum length in bytes</th><th>Notes</th><th>Example</th></tr>
<tr><th>boolean</th><td>1</td><td>1</td><td>Single byte: 1 = true, 0 = false</td><td>1</td></tr>
<tr><th>byte</th><td>1</td><td>1</td><td>Single byte, used to store small numbers and booleans</td><td>1</td></tr>
<tr><th>short</th><td>2</td><td>2</td><td>Signed short type</td><td>01</td></tr>
<tr><th>int</th><td>4</td><td>4</td><td>Signed integer type</td><td>0001</td></tr>
<tr><th>long</th><td>8</td><td>8</td><td>Signed long type</td><td>00000001</td></tr>
<tr><th>bytes</th><td>4</td><td>N</td><td>Used for binary data. The format is <code>(length:int)[(bytes)]</code>. Send -1 as NULL</td><td><code>000511111</code></td></tr>
<tr><th>string</th><td>4</td><td>N</td><td>Used for text messages.The format is: <code>(length:int)[(bytes)](content:&lt;length&gt;)</code>. Send -1 as NULL</td><td><code>0005Hello</code></td></tr>
<tr><th>record</th><td>2</td><td>N</td><td>An entire record serialized. The format depends if a RID is passed or an entire record with its content. In case of null record then -2 as short is passed. In case of RID -3 is passes as short and then the RID: <code>(-3:short)(cluster-id:short)(cluster-position:long)</code>. In case of record: <code>(0:short)(record-type:byte)(cluster-id:short)(cluster-position:long)(record-version:int)(record-content:bytes)</code></td><td></td></tr>
<tr><th>strings</th><td>4</td><td>N</td><td>Used for multiple text messages. The format is: <code>(length:int)[(Nth-string:string)]</code></td><td><code>00020005Hello0007World!</code></td></tr>
</tbody>
</table>
<p><strong>Note</strong> when the type of a field in a response depends on the values of the previous fields, that field will be written without the type (e.g., <code>(a-field)</code>). The type of the field will be then specified based on the values of the previous fields in the description of the response.</p>
<h1 id="record-format"><a class="header" href="#record-format">Record format</a></h1>
<p>The record format is choose during the <a href="internals/Network-Binary-Protocol.html#request_connect">CONNECT</a> or <a href="internals/Network-Binary-Protocol.html#request_db_open">DB_OPEN</a> request, the formats available are:</p>
<p><a href="internals/Record-CSV-Serialization.html">CSV</a> (serialization-impl value "ORecordDocument2csv")
<a href="internals/Record-Schemaless-Binary-Serialization.html">Binary</a> (serialization-impl value "ORecordSerializerBinary")</p>
<p>The CSV format is the default for all the versions 0.* and 1.* or for any client with Network Protocol Version &lt; 22</p>
<h1 id="request"><a class="header" href="#request">Request</a></h1>
<p>Each request has own format depending of the operation requested. The operation requested is indicated in the first byte:</p>
<ul>
<li><em>1 byte</em> for the operation. See <a href="internals/Network-Binary-Protocol.html#operation-types">Operation types</a> for the list</li>
<li><strong>4 bytes</strong> for the <a href="internals/Network-Binary-Protocol.html#session-id">Session-Id</a> number as Integer</li>
<li><strong>N bytes</strong> optional token bytes only present if the REQUEST_CONNECT/REQUEST_DB_OPEN return a token.</li>
<li><strong>N bytes</strong> = message content based on the operation type</li>
</ul>
<h2 id="operation-types"><a class="header" href="#operation-types">Operation types</a></h2>
<table>
<tr><th>Command</th><th>Value as byte</th><th>Description</th><th>Async</th><th>Since</th></tr>
<tr><td colspan="5"><h3 id="server-connect-operations"><a class="header" href="#server-connect-operations">Server <i>(CONNECT Operations)</i></a></h3></td></tr>
<tr><td><a href="internals/Network-Binary-Protocol.html#request_shutdown">REQUEST_SHUTDOWN</a></td><td>1</td><td>Shut down server.</td><td>no</td><td></td></tr>
<tr><td><a href="internals/Network-Binary-Protocol.html#request_connect">REQUEST_CONNECT</a></td><td>2</td><td>Required initial operation</b> to access to server commands.</td><td>no</td><td></td></tr>
<tr><td><a href="internals/Network-Binary-Protocol.html#request_db_open">REQUEST_DB_OPEN</a></td><td>3</td><td><b>Required initial operation</b> to access to the database.</td><td>no</td><td></td></tr>
<tr><td><a href="internals/Network-Binary-Protocol.html#request_db_create">REQUEST_DB_CREATE</a></td><td>4</td><td>Add a new database.</td><td>no</td><td></td></tr>
<tr><td><a href="internals/Network-Binary-Protocol.html#request_db_exist">REQUEST_DB_EXIST</a></td><td>6</td><td>Check if database exists.</td><td>no</td><td></td></tr>
<tr><td><a href="internals/Network-Binary-Protocol.html#request_db_drop">REQUEST_DB_DROP</a></td><td>7</td><td>Delete database.</td><td>no</td><td></td></tr>
<tr><td>REQUEST_CONFIG_GET</td><td>70</td><td>Get a configuration property.</td><td>no</td><td></td></tr>
<tr><td>REQUEST_CONFIG_SET</td><td>71</td><td>Set a configuration property.</td><td>no</td><td></td></tr>
<tr><td>REQUEST_CONFIG_LIST</td><td>72</td><td>Get a list of configuration properties.</td><td>no</td><td></td></tr>
<tr><td>REQUEST_DB_LIST<td>74</td><td>Get a list of databases.</td><td>no</td><td>1.0rc6</td></tr>
<tr><td colspan="5"><h3 id="database-db_open-operations"><a class="header" href="#database-db_open-operations">Database <i>(DB_OPEN Operations)</i></a></h3></td></tr>
<tr><td><a href="internals/Network-Binary-Protocol.html#request_db_close">REQUEST_DB_CLOSE</a></td><td>5</td><td>Close a database.</td><td>no</td><td></td></tr>
<tr><td><a href="internals/Network-Binary-Protocol.html#request_db_size">REQUEST_DB_SIZE</a></td><td>8</td><td>Get the size of a database (in bytes).</td><td>no</td><td>0.9.25</td></tr>
<tr><td><a href="internals/Network-Binary-Protocol.html#request_db_countrecords">REQUEST_DB_COUNTRECORDS</a></td><td>9</td><td>Get total number of records in a database.</td><td>no</td><td>0.9.25</td></tr>
<tr><td><a href="internals/Network-Binary-Protocol.html#request_datacluster_add">REQUEST_DATACLUSTER_ADD (deprecated)</a></td><td>10</td><td>Add a data cluster.</td><td>no</td><td></td></tr>
<tr><td><a href="internals/Network-Binary-Protocol.html#request_datacluster_drop">REQUEST_DATACLUSTER_DROP (deprecated)</a><td>11</td><td>Delete a data cluster.</td><td>no</td><td></td></tr>
<tr><td><a href="internals/Network-Binary-Protocol.html#request_datacluster_count">REQUEST_DATACLUSTER_COUNT (deprecated)</a></td><td>12</td><td>Get the total number of data clusters.</td><td>no</td><td></td></tr>
<tr><td><a href="internals/Network-Binary-Protocol.html#request_datacluster_datarange">REQUEST_DATACLUSTER_DATARANGE (deprecated)</a></td><td>13</td><td>Get the data range of data clusters.</td><td>no</td><td></td></tr>
<tr><td>REQUEST_DATACLUSTER_COPY</td><td>14</td><td>Copy a data cluster.</td><td>no</td><td></td></tr>
<tr><td>REQUEST_DATACLUSTER_LH_CLUSTER_IS_USED</td><td>16</td><td></td><td>no</td><td>1.2.0</td></tr>
<tr><td>REQUEST_RECORD_METADATA</td><td>29</td><td>Get metadata from a record.</td><td>no</td><td>1.4.0</td></tr>
<tr><td><a href="internals/Network-Binary-Protocol.html#request_record_load">REQUEST_RECORD_LOAD</a></td><td>30</td><td>Load a record.</td><td>no</td><td></td></tr>
<tr><td><a href="internals/Network-Binary-Protocol.html#request_record_load_if_version_not_latest">REQUEST_RECORD_LOAD_IF_VERSION_NOT_LATEST</a></td><td>44</td><td>Load a record.</td><td>no</td><td>2.1-rc4</td></tr>
<tr><td><a href="internals/Network-Binary-Protocol.html#request_record_create">REQUEST_RECORD_CREATE</a></td><td>31</td><td>Add a record.</td><td>yes</td><td></td></tr>
<tr><td><a href="internals/Network-Binary-Protocol.html#request_record_update">REQUEST_RECORD_UPDATE</a></td><td>32</td><td><Update a record./td><td>yes</td><td></td></tr>
<tr><td><a href="internals/Network-Binary-Protocol.html#request_record_delete">REQUEST_RECORD_DELETE</a></td><td>33</td><td>Delete a record.</td><td>yes</td><td></td></tr>
<tr><td>REQUEST_RECORD_COPY</td><td>34</td><td>Copy a record.</td><td>yes</td><td></td></tr>
<tr><td>REQUEST_RECORD_CLEAN_OUT</td><td>38</td><td>Clean out record.</td><td>yes</td><td>1.3.0</td></tr>
<tr><td>REQUEST_POSITIONS_FLOOR</td><td>39</td><td>Get the last record.</td><td>yes</td><td>1.3.0</td></tr>
<tr><td>REQUEST_COUNT <i>(DEPRECATED)</i></td><td>40</td><td>See REQUEST_DATACLUSTER_COUNT</td><td>no</td><td></td></tr>
<tr><td><a href="internals/Network-Binary-Protocol.html#request_command">REQUEST_COMMAND</a></td><td>41</td><td>Execute a command.</td><td>no</td><td></td></tr>
<tr><td>REQUEST_POSITIONS_CEILING</td><td>42</td><td>Get the first record.</td><td>no</td><td>1.3.0</td></tr>
<tr><td><a href="internals/Network-Binary-Protocol.html#request_query">REQUEST_QUERY</a></td><td>45</td><td>Execute a query.</td><td>no</td><td>3.0.0</td></tr>   
<tr><td><a href="internals/Network-Binary-Protocol.html#request_query_close">REQUEST_CLOSE_QUERY</a></td><td>46</td><td>Close an active query cursor.</td><td>no</td><td>3.0.0</td></tr>   
<tr><td><a href="internals/Network-Binary-Protocol.html#request_query_next_page">REQUEST_QUERY_NEXT_PAGE</a></td><td>47</td><td>Get next page of a query result</td><td>no</td><td>3.0.0</td></tr>   
<tr><td><a href="internals/Network-Binary-Protocol.html#request_tx_commit">REQUEST_TX_COMMIT</a></td><td>60</td><td>Commit transaction.</td><td>no</td><td></td></tr>
<tr><td><a href="internals/Network-Binary-Protocol.html#request_db_reload">REQUEST_DB_RELOAD</a></td><td>73</td><td>Reload database.</td><td>no</td><td>1.0rc4</td></tr>
<tr><td>REQUEST_PUSH_RECORD<td>79</td><td></td><td>no</td><td>1.0rc6</td></tr>
<tr><td>REQUEST_PUSH_DISTRIB_CONFIG<td>80</td><td></td><td>no</td><td>1.0rc6</td></tr>
<tr><td><a href="internals/Network-Binary-Protocol.html#request_push_live_query">REQUEST_PUSH_LIVE_QUERY</a><td>81</td><td></td><td>no</td><td>2.1-rc2</td></tr>
<tr><td>REQUEST_DB_COPY<td>90</td><td></td><td>no</td><td>1.0rc8</td></tr>
<tr><td>REQUEST_REPLICATION<td>91</td><td></td><td>no</td><td>1.0</td></tr>
<tr><td>REQUEST_CLUSTER<td>92</td><td></td><td>no</td><td>1.0</td></tr>
<tr><td>REQUEST_DB_TRANSFER<td>93</td><td></td><td>no</td><td>1.0.2</td></tr>
<tr><td>REQUEST_DB_FREEZE<td>94</td><td></td><td>no</td><td>1.1.0</td></tr>
<tr><td>REQUEST_DB_RELEASE<td>95</td><td></td><td>no</td><td>1.1.0</td></tr>
<tr><td>REQUEST_DATACLUSTER_FREEZE (deprecated)<td>96</td><td></td><td>no</td><td></td></tr>
<tr><td>REQUEST_DATACLUSTER_RELEASE (deprecated)<td>97</td><td></td><td>no</td><td></td></tr>
<tr><td>REQUEST_CREATE_SBTREE_BONSAI<td>110</td><td>Creates an sb-tree bonsai on the remote server</td><td>no</td><td>1.7rc1</td></tr>
<tr><td>REQUEST_SBTREE_BONSAI_GET<td>111</td><td>Get value by key from sb-tree bonsai</td><td>no</td><td>1.7rc1</td></tr>
<tr><td>REQUEST_SBTREE_BONSAI_FIRST_KEY<td>112</td><td>Get first key from sb-tree bonsai</td><td>no</td><td>1.7rc1</td></tr>
<tr><td>REQUEST_SBTREE_BONSAI_GET_ENTRIES_MAJOR<td>113</td><td>Gets the portion of entries greater than the specified one. If returns 0 entries then the specified entry is the largest</td><td>no</td><td>1.7rc1</td></tr>
<tr><td>REQUEST_RIDBAG_GET_SIZE<td>114</td><td>Rid-bag specific operation. Send but does not save changes of rid bag. Retrieves computed size of rid bag.</td><td>no</td><td>1.7rc1</td></tr>
<tr><td>REQUEST_INDEX_GET<td>120</td><td>Lookup in an index by key</td><td>no</td><td>2.1rc4</td></tr>
<tr><td>REQUEST_INDEX_PUT<td>121</td><td>Create or update an entry in an index</td><td>no</td><td>2.1rc4</td></tr>
<tr><td>REQUEST_INDEX_REMOVE<td>122</td><td>Remove an entry in an index by key</td><td>no</td><td>2.1rc4</td></tr>
<tr><td>REQUEST_INCREMENTAL_RESTORE</td><td> Incremental restore </td><td>no</td><td>2.2-rc1</td></tr>
</table>
<h1 id="response"><a class="header" href="#response">Response</a></h1>
<p>Every request has a response unless the command supports the asynchronous mode (look at the table above).</p>
<ul>
<li><strong>1 byte</strong>: Success status of the request if succeeded or failed (0=OK, 1=ERROR)</li>
<li><strong>4 bytes</strong>: <a href="internals/Network-Binary-Protocol.html#session-id">Session-Id</a> (Integer)</li>
<li><strong>N bytes</strong> optional token, is only present for token based session (REQUEST_CONNECT/REQUEST_DB_OPEN return a token) and is usually empty(N=0) is only filled up by the server when renew of an expiring token is required.</li>
<li><strong>N bytes</strong>: Message content depending on the operation requested</li>
</ul>
<h1 id="push-request"><a class="header" href="#push-request">Push Request</a></h1>
<p>A push request is a message sent by the server without any request from the client, it has a similar structure of a response and is distinguished using the response status byte:</p>
<ul>
<li><strong>1 byte</strong>: Success status has value 3 in case of push request</li>
<li><strong>4 bytes</strong>: <a href="internals/Network-Binary-Protocol.html#session-id">Session-Id</a> has everytime MIN_INTEGER value (-2^31)</li>
<li><strong>1 byte</strong>: Push command id</li>
<li><strong>N bytes</strong>: Message content depending on the push massage, this is written as a <code>(content:bytes)</code> having inside the details of the specific message.</li>
</ul>
<h2 id="statuses"><a class="header" href="#statuses">Statuses</a></h2>
<p>Every time the client sends a request, and the command is not in asynchronous mode (look at the table above), client must read the one-byte response status that indicates OK or ERROR. The rest of response bytes depends on this first byte.</p>
<pre><code>* OK = 0;
* ERROR = 1;
* PUSH_REQUEST = 3
</code></pre>
<p><strong>OK response bytes are depends for every request type. ERROR response bytes sequence described below.</strong></p>
<h2 id="errors-1"><a class="header" href="#errors-1">Errors</a></h2>
<p>The format is: <code>[(1)(exception-class:string)(exception-message:string)]*(0)(serialized-exception:bytes)</code></p>
<p>The pairs exception-class and exception-message continue while the following byte is 1. A 0 in this position indicates that no more data follows.</p>
<p>E.g. (parentheses are used here just to separate fields to make this easier to read: they are not present in the server response):</p>
<pre><code>(1)(com.orientechnologies.orient.core.exception.OStorageException)(Can't open the storage 'demo')(0)
</code></pre>
<p>Example of 2 depth-levels exception:</p>
<pre><code>(1)(com.orientechnologies.orient.core.exception.OStorageException)(Can't open the storage 'demo')(1)(com.orientechnologies.orient.core.exception.OStorageException)(File not found)(0)
</code></pre>
<p>Since 1.6.1 we also send serialized version of exception thrown on server side. This allows to preserve full
stack trace of server exception on client side but this feature can be used by Java clients only.</p>
<h1 id="operations-3"><a class="header" href="#operations-3">Operations</a></h1>
<p>This section explains the <em>request</em> and <em>response</em> messages of all supported operations.</p>
<h2 id="request_shutdown"><a class="header" href="#request_shutdown">REQUEST_SHUTDOWN</a></h2>
<p>Shut down the server. Requires "shutdown" permission to be set in <em>orientdb-server-config.xml</em> file.</p>
<pre><code>Request: (user-name:string)(user-password:string)
Response: empty
</code></pre>
<p>Typically the credentials are those of the OrientDB server administrator. This is not the same as the <em>admin</em> user for individual databases.</p>
<h2 id="request_connect"><a class="header" href="#request_connect">REQUEST_CONNECT</a></h2>
<p>This is the first operation requested by the client when it needs to work with the server instance. This operation returns the <a href="internals/Network-Binary-Protocol.html#session-id">Session-Id</a> of the new client to reuse for all the next calls.</p>
<pre><code>Request: (driver-name:string)(driver-version:string)(protocol-version:short)(client-id:string)(serialization-impl:string)(token-session:boolean)(support-push)(collect-stats)(user-name:string)(user-password:string)
Response: (session-id:int)(token:bytes)
</code></pre>
<h4 id="request-1"><a class="header" href="#request-1">Request</a></h4>
<ul>
<li>client's <strong>driver-name</strong> - the name of the client driver. Example: "OrientDB Java client"</li>
<li>client's <strong>driver-version</strong> - the version of the client driver. Example: "1.0rc8-SNAPSHOT"</li>
<li>client's <strong>protocol-version</strong> - the version of the protocol the client wants to use. Example: 30</li>
<li>client's <strong>client-id</strong> - can be null for clients. In clustered configurations it's the distributed node ID as TCP <code>host:port</code>. Example: "10.10.10.10:2480"</li>
<li>client's <strong>serialization-impl</strong> - the <a href="internals/Network-Binary-Protocol.html#record-format">serialization format</a> required by the client</li>
<li><strong>token-session</strong> - true if the client wants to use a token-based session, false otherwise</li>
<li><strong>support-push</strong> - supports push messages from the server (starting from v34)</li>
<li><strong>collect-stats</strong> - collects statistics for the connection (starting from v34)</li>
<li><strong>user-name</strong> - the username of the user on the server. Example: "root"</li>
<li><strong>user-password</strong> - the password of the user on the server. Example: "37aed6392"</li>
</ul>
<p>Typically the credentials are those of the OrientDB server administrator. This is not the same as the <em>admin</em> user for individual databases.</p>
<h4 id="response-1"><a class="header" href="#response-1">Response</a></h4>
<ul>
<li><strong>session-id</strong> - the new session id or a match id in case of token authentication.</li>
<li><strong>token</strong> - the token for token-based authentication. If the clients sends <strong>token-session</strong> as false in the request or the server doesn't support token-based authentication, this will be an empty <code>byte[]</code>.</li>
</ul>
<h2 id="request_db_open"><a class="header" href="#request_db_open">REQUEST_DB_OPEN</a></h2>
<p>This is the first operation the client should call. It opens a database on the remote OrientDB Server. This operation returns the <a href="internals/Network-Binary-Protocol.html#session-id">Session-Id</a> of the new client to reuse for all the next calls and the list of configured <a href="internals/../datamodeling/Concepts.html#cluster">clusters</a> in the opened database.</p>
<pre><code>Request: (driver-name:string)(driver-version:string)(protocol-version:short)(client-id:string)(serialization-impl:string)(token-session:boolean)(support-push:boolean)(collect-stats:boolean)(database-name:string)(user-name:string)(user-password:string)
Response: (session-id:int)(token:bytes)(num-of-clusters:short)[(cluster-name:string)(cluster-id:short)](cluster-config:bytes)(orientdb-release:string)
</code></pre>
<h4 id="request-2"><a class="header" href="#request-2">Request</a></h4>
<ul>
<li>client's <strong>driver-name</strong> - the name of the client driver. Example: "OrientDB Java client".</li>
<li>client's <strong>driver-version</strong> - the version of the client driver. Example: "1.0rc8-SNAPSHOT"</li>
<li>client's <strong>protocol-version</strong> - the version of the protocol the client wants to use. Example: 30.</li>
<li>client's <strong>client-id</strong> - can be null for clients. In clustered configurations it's the distributed node ID as TCP <code>host:port</code>. Example: "10.10.10.10:2480".</li>
<li>client's <strong>serialization-impl</strong> - the <a href="internals/Network-Binary-Protocol.html#record-format">serialization format</a> required by the client.</li>
<li><strong>token-session</strong> - true if the client wants to use a token-based session, false otherwise.</li>
<li><strong>support-push</strong> - true if the client support push request</li>
<li><strong>collect-stats</strong> - true if this connection is to be counted on the server stats, normal client should use true</li>
<li><strong>database-name</strong> - the name of the database to connect to. Example: "demo".</li>
<li><strong>user-name</strong> - the username of the user on the server. Example: "root".</li>
<li><strong>user-password</strong> - the password of the user on the server. Example: "37aed6392".</li>
</ul>
<h4 id="response-2"><a class="header" href="#response-2">Response</a></h4>
<ul>
<li><strong>session-id</strong> - the new session id or a match id in case of token authentication.</li>
<li><strong>token</strong> - the token for token-based authentication. If the clients sends <strong>token-session</strong> as false in the request or the server doesn't support token-based authentication, this will be an empty <code>byte[]</code>.</li>
<li><strong>num-of-clusters</strong> - the size of the array of clusters in the form <code>(cluster-name:string)(cluster-id:short)</code> that follows this number.</li>
<li><strong>cluster-name</strong>, <strong>cluster-id</strong> - the name and id of a cluster.</li>
<li><strong>cluster-config</strong> - it's usually null unless running in a server clustered configuration.</li>
<li><strong>orientdb-release</strong> - contains the version of the OrientDB release deployed on the server and optionally the build number. Example: "1.4.0-SNAPSHOT (build 13)".</li>
</ul>
<h2 id="request_db_reopen"><a class="header" href="#request_db_reopen">REQUEST_DB_REOPEN</a></h2>
<p>Used on new sockets for associate the specific socket with the server side session for the specific client, can be used exclusively with the token authentication</p>
<pre><code>Request:empty 
Response:(session-id:int)
</code></pre>
<h2 id="request_db_create"><a class="header" href="#request_db_create">REQUEST_DB_CREATE</a></h2>
<p>Creates a database in the remote OrientDB server instance.</p>
<pre><code>Request: (database-name:string)(database-type:string)(storage-type:string)(backup-path)
Response: empty
</code></pre>
<h4 id="request-3"><a class="header" href="#request-3">Request</a></h4>
<ul>
<li><strong>database-name</strong> - the name of the database to create. Example: "MyDatabase".</li>
<li><strong>database-type</strong> - the type of the database to create. Can be either <code>document</code> or <code>graph</code> (since version 8). Example: "document".</li>
<li><strong>storage-type</strong> - specifies the storage type of the database to create. It can be one of the <a href="internals/../datamodeling/Concepts.html#database-url">supported types</a>:
<ul>
<li><code>plocal</code> - persistent database</li>
<li><code>memory</code> - volatile database</li>
</ul>
</li>
<li><strong>backup-path</strong> - path of the backup file to restore located on the server's file system (since version 36). This is used when a database is created starting from a previous backup</li>
</ul>
<p><strong>Note</strong>: it doesn't make sense to use <code>remote</code> in this context.</p>
<h2 id="request_db_close"><a class="header" href="#request_db_close">REQUEST_DB_CLOSE</a></h2>
<p>Closes the database and the network connection to the OrientDB server instance. No response is expected.</p>
<pre><code>Request: empty
Response: no response, the socket is just closed at server side
</code></pre>
<h2 id="request_db_exist"><a class="header" href="#request_db_exist">REQUEST_DB_EXIST</a></h2>
<p>Asks if a database exists in the OrientDB server instance.</p>
<pre><code>Request: (database-name:string)(server-storage-type:string)
Response: (result:boolean)
</code></pre>
<h4 id="request-4"><a class="header" href="#request-4">Request</a></h4>
<ul>
<li><strong>database-name</strong> - the name of the target database. <em>Note</em> that this was empty before <code>1.0rc1</code>.</li>
<li><strong>storage-type</strong> - specifies the storage type of the database to be checked for existence. Since <code>1.5-snapshot</code>. It can be one of the <a href="internals/../datamodeling/Concepts.html#database-url">supported types</a>:
<ul>
<li><code>plocal</code> - persistent database</li>
<li><code>memory</code> - volatile database</li>
</ul>
</li>
</ul>
<h4 id="response-3"><a class="header" href="#response-3">Response</a></h4>
<ul>
<li><strong>result</strong> - true if the given database exists, false otherwise.</li>
</ul>
<h2 id="request_db_reload"><a class="header" href="#request_db_reload">REQUEST_DB_RELOAD</a></h2>
<p>Reloads information about the given database. Available since <code>1.0rc4</code>.</p>
<pre><code>Request: empty
Response: (num-of-clusters:short)[(cluster-name:string)(cluster-id:short)]
</code></pre>
<h4 id="response-4"><a class="header" href="#response-4">Response</a></h4>
<ul>
<li><strong>num-of-clusters</strong> - the size of the array of clusters in the form <code>(cluster-name:string)(cluster-id:short)</code> that follows this number.</li>
<li><strong>cluster-name</strong>, <strong>cluster-id</strong> - the name and id of a cluster.</li>
</ul>
<h2 id="request_db_drop"><a class="header" href="#request_db_drop">REQUEST_DB_DROP</a></h2>
<p>Removes a database from the OrientDB server instance. This operation returns a successful response if the database is deleted successfully. Otherwise, if the database doesn't exist on the server, it returns an error (an <code>OStorageException</code>).</p>
<pre><code>Request: (database-name:string)(storage-type:string)
Response: empty
</code></pre>
<h4 id="request-5"><a class="header" href="#request-5">Request</a></h4>
<ul>
<li><strong>database-name</strong> - the name of the database to remove.</li>
<li><strong>storage-type</strong> - specifies the storage type of the database to create. Since <code>1.5-snapshot</code>. It can be one of the <a href="internals/../datamodeling/Concepts.html#database-url">supported types</a>:
<ul>
<li><code>plocal</code> - persistent database</li>
<li><code>memory</code> - volatile database</li>
</ul>
</li>
</ul>
<h2 id="request_db_size"><a class="header" href="#request_db_size">REQUEST_DB_SIZE</a></h2>
<p>Returns the size of the currently open database.</p>
<pre><code>Request: empty
Response: (size:long)
</code></pre>
<h4 id="response-5"><a class="header" href="#response-5">Response</a></h4>
<ul>
<li><strong>size</strong> - the size of the current database.</li>
</ul>
<h2 id="request_db_countrecords"><a class="header" href="#request_db_countrecords">REQUEST_DB_COUNTRECORDS</a></h2>
<p>Returns the number of records in the currently open database.</p>
<pre><code>Request: empty
Response: (count:long)
</code></pre>
<h4 id="response-6"><a class="header" href="#response-6">Response</a></h4>
<ul>
<li><strong>count</strong> - the number of records in the current database.</li>
</ul>
<h2 id="request_datacluster_add"><a class="header" href="#request_datacluster_add">REQUEST_DATACLUSTER_ADD</a></h2>
<p>Add a new data cluster. Deprecated.</p>
<pre><code>Request: (name:string)(cluster-id:short - since 1.6 snapshot)
Response: (new-cluster:short)
</code></pre>
<p>Where: type is one of "PHYSICAL" or "MEMORY".
If cluster-id is -1 (recommended value) new cluster id will be generated.</p>
<h2 id="request_datacluster_drop"><a class="header" href="#request_datacluster_drop">REQUEST_DATACLUSTER_DROP</a></h2>
<p>Remove a cluster. Deprecated.</p>
<pre><code>Request: (cluster-number:short)
Response: (delete-on-clientside:byte)
</code></pre>
<p>Where:</p>
<ul>
<li><strong>delete-on-clientside</strong> can be 1 if the cluster has been successfully removed and the client has to remove too, otherwise 0</li>
</ul>
<h2 id="request_datacluster_count"><a class="header" href="#request_datacluster_count">REQUEST_DATACLUSTER_COUNT</a></h2>
<p>Returns the number of records in one or more clusters. Deprecated.</p>
<pre><code>Request: (cluster-count:short)(cluster-number:short)*(count-tombstones:byte)
Response: (records-in-clusters:long)
</code></pre>
<p>Where:</p>
<ul>
<li><strong>cluster-count</strong> the number of requested clusters</li>
<li><strong>cluster-number</strong> the cluster id of each single cluster</li>
<li><strong>count-tombstones</strong> the flag which indicates whether deleted records should be taken in account. It is applicable for autosharded storage only, otherwise it is ignored.</li>
<li><strong>records-in-clusters</strong> is the total number of records found in the requested clusters</li>
</ul>
<h3 id="example-193"><a class="header" href="#example-193">Example</a></h3>
<p>Request the record count for clusters 5, 6 and 7. Note the "03" at the beginning to tell you're passing 3 cluster ids (as short each). 1,000 as long (8 bytes) is the answer.</p>
<pre><code>Request: 03050607
Response: 00001000
</code></pre>
<h2 id="request_datacluster_datarange"><a class="header" href="#request_datacluster_datarange">REQUEST_DATACLUSTER_DATARANGE</a></h2>
<p>Returns the range of record ids for a cluster. Deprecated.</p>
<pre><code>Request: (cluster-number:short)
Response: (begin:long)(end:long)
</code></pre>
<h3 id="example-194"><a class="header" href="#example-194">Example</a></h3>
<p>Request the range for cluster 7. The range 0-1,000 is returned in the response as 2 longs (8 bytes each).</p>
<pre><code>Request: 07
Response: 0000000000001000
</code></pre>
<h2 id="request_record_load"><a class="header" href="#request_record_load">REQUEST_RECORD_LOAD</a></h2>
<p>Loads a record by its <a href="internals/../datamodeling/Concepts.html#record-id">Record ID</a>, according to a <a href="internals/../java/Fetching-Strategies.html">fetch plan</a>.</p>
<pre><code>Request: (cluster-id:short)(cluster-position:long)(fetch-plan:string)(ignore-cache:boolean)(load-tombstones:boolean)
Response: [(payload-status:byte)[(record-type:byte)(record-version:int)(record-content:bytes)]*]+
</code></pre>
<h4 id="request-6"><a class="header" href="#request-6">Request</a></h4>
<ul>
<li><strong>cluster-id</strong>, <strong>cluster-position</strong> - the Record ID of the record.</li>
<li><strong>fetch-plan</strong> - the <a href="internals/../java/Fetching-Strategies.html">fetch plan</a> to use or an empty string.</li>
<li><strong>ignore-cache</strong> - if true tells the server to ignore the cache, if false tells the server to not ignore the cache. Available since protocol v.9 (introduced in release 1.0rc9).</li>
<li><strong>load-tombstones</strong> - a flag which indicates whether information about deleted record should be loaded. The flag is applied only to autosharded storage and ignored otherwise.</li>
</ul>
<h4 id="response-7"><a class="header" href="#response-7">Response</a></h4>
<ul>
<li><strong>payload-status</strong> - can be:
<ul>
<li><code>0</code>: no records remain to be fetched.</li>
<li><code>1</code>: a record is returned as resultset.</li>
<li><code>2</code>: a record is returned as pre-fetched to be loaded in client's cache only. It's not part of the result set but the client knows that it's available for later access. This value is not currently used.</li>
</ul>
</li>
<li><strong>record-type</strong> - can be:
<ul>
<li><code>d</code>: document</li>
<li><code>b</code>: raw bytes</li>
<li><code>f</code>: flat data</li>
</ul>
</li>
</ul>
<h2 id="request_record_load_if_version_not_latest"><a class="header" href="#request_record_load_if_version_not_latest">REQUEST_RECORD_LOAD_IF_VERSION_NOT_LATEST</a></h2>
<p>Loads a record by <a href="internals/../datamodeling/Concepts.html#record-id">Record ID</a>, according to a <a href="internals/../java/Fetching-Strategies.html">fetch plan</a>. The record is only loaded if the persistent version is more recent of the version specified in the request.</p>
<pre><code>Request: (cluster-id:short)(cluster-position:long)(version:int)(fetch-plan:string)(ignore-cache:boolean)
Response: [(payload-status:byte)[(record-type:byte)(record-version:int)(record-content:bytes)]*]*
</code></pre>
<h4 id="request-7"><a class="header" href="#request-7">Request</a></h4>
<ul>
<li><strong>cluster-id</strong>, <strong>cluster-position</strong> - the Record ID of the record.</li>
<li><strong>version</strong> - the version of the record to fetch.</li>
<li><strong>fetch-plan</strong> - the <a href="internals/../java/Fetching-Strategies.html">fetch plan</a> to use or an empty string.</li>
<li><strong>ignore-cache</strong> - if true tells the server to ignore the cache, if false tells the server to not ignore the cache. Available since protocol v.9 (introduced in release 1.0rc9).</li>
</ul>
<h4 id="response-8"><a class="header" href="#response-8">Response</a></h4>
<ul>
<li><code>payload-status</code> - can be:
<ul>
<li><code>0</code>: no records remain to be fetched.</li>
<li><code>1</code>: a record is returned as resultset.</li>
<li><code>2</code>: a record is returned as pre-fetched to be loaded in client's cache only. It's not part of the result set but the client knows that it's available for later access. This value is not currently used.</li>
</ul>
</li>
<li><code>record-type</code> - can be:
<ul>
<li><code>d</code>: document</li>
<li><code>b</code>: raw bytes</li>
<li><code>f</code>: flat data</li>
</ul>
</li>
</ul>
<h2 id="request_record_create"><a class="header" href="#request_record_create">REQUEST_RECORD_CREATE</a></h2>
<p>Creates a new record. Returns the Record ID of the newly created record.. New records can have version &gt; 0 (since <code>1.0</code>) in case the Record ID has been recycled.</p>
<pre><code>Request: (cluster-id:short)(record-content:bytes)(record-type:byte)(mode:byte)
Response: (cluster-id:short)(cluster-position:long)(record-version:int)(count-of-collection-changes)[(uuid-most-sig-bits:long)(uuid-least-sig-bits:long)(updated-file-id:long)(updated-page-index:long)(updated-page-offset:int)]*
</code></pre>
<h4 id="request-8"><a class="header" href="#request-8">Request</a></h4>
<ul>
<li><strong>cluster-id</strong> - the id of the cluster in which to create the new record.</li>
<li><strong>record-content</strong> - the record to create serialized using the appropriate <a href="internals/Network-Binary-Protocol.html#record-format">serialization format</a> chosen at connection time.</li>
<li><strong>record-type</strong> - the type of the record to create. It can be:
<ul>
<li><code>d</code>: document</li>
<li><code>b</code>: raw bytes</li>
<li><code>f</code>: flat data</li>
</ul>
</li>
<li><strong>mode</strong> - can be:
<ul>
<li><code>0</code> - <strong>synchronous</strong>. It's the default mode which waits for the answer before the response is sent.</li>
<li><code>1</code> - <strong>asynchronous</strong>. The response is identical to the synchronous response, but the driver is encouraged to manage the answer in a callback.</li>
<li><code>2</code> - <strong>no-response</strong>. Don't wait for the answer (<em>fire and forget</em>). This mode is useful on massive operations since it reduces network latency.</li>
</ul>
</li>
</ul>
<p>In versions before <code>2.0</code>, the response started with an additional <strong>datasegment-id</strong>, the segment id to store the data (available since version 10 - <code>1.0-SNAPSHOT</code>), with -1 meaning default one.</p>
<h4 id="response-9"><a class="header" href="#response-9">Response</a></h4>
<ul>
<li><strong>cluster-id</strong>, <strong>cluster-position</strong> - the Record ID of the newly created record.</li>
<li><strong>record-version</strong> - the version of the newly created record.</li>
</ul>
<p>The last part of response (from <code>count-of-collection-changes</code> on) refers to <a href="internals/RidBag.html">RidBag</a> management. Take a look at <a href="internals/RidBag.html">the main page</a> for more details.</p>
<h2 id="request_record_update"><a class="header" href="#request_record_update">REQUEST_RECORD_UPDATE</a></h2>
<p>Updates the record identified by the given <a href="internals/../datamodeling/Concepts.html#record-id">Record ID</a>. Returns the new version of the record.</p>
<pre><code>Request: (cluster-id:short)(cluster-position:long)(update-content:boolean)(record-content:bytes)(record-version:int)(record-type:byte)(mode:byte)
Response: (record-version:int)(count-of-collection-changes)[(uuid-most-sig-bits:long)(uuid-least-sig-bits:long)(updated-file-id:long)(updated-page-index:long)(updated-page-offset:int)]*
</code></pre>
<h4 id="request-9"><a class="header" href="#request-9">Request</a></h4>
<ul>
<li><strong>cluster-id</strong>, <strong>cluster-position</strong> - the Record ID of the record to update.</li>
<li><strong>update-content</strong> - can be:
<ul>
<li>true - the content of the record has been changed and should be updated in the storage.</li>
<li>false - the record was modified but its own content has not changed: related collections (e.g. RidBags) have to be updated, but the record version and its contents should not be updated.</li>
</ul>
</li>
<li><strong>record-content</strong> - the new contents of the record serialized using the appropriate <a href="internals/Network-Binary-Protocol.html#record-format">serialization format</a> chosen at connection time.</li>
<li><strong>record-version</strong> - the version of the record to update.</li>
<li><strong>record-type</strong> - the type of the record to create. It can be:
<ul>
<li><code>d</code>: document</li>
<li><code>b</code>: raw bytes</li>
<li><code>f</code>: flat data</li>
</ul>
</li>
<li><strong>mode</strong> - can be:
<ul>
<li><code>0</code> - <strong>synchronous</strong>. It's the default mode which waits for the answer before the response is sent.</li>
<li><code>1</code> - <strong>asynchronous</strong>. The response is identical to the synchronous response, but the driver is encouraged to manage the answer in a callback.</li>
<li><code>2</code> - <strong>no-response</strong>. Don't wait for the answer (<em>fire and forget</em>). This mode is useful on massive operations since it reduces network latency.</li>
</ul>
</li>
</ul>
<h4 id="response-10"><a class="header" href="#response-10">Response</a></h4>
<ul>
<li><strong>record-version</strong> - the new version of the updated record</li>
</ul>
<p>The last part of response (from <code>count-of-collection-changes</code> on) refers to <a href="internals/RidBag.html">RidBag</a> management. Take a look at <a href="internals/RidBag.html">the main page</a> for more details.</p>
<h2 id="request_record_delete"><a class="header" href="#request_record_delete">REQUEST_RECORD_DELETE</a></h2>
<p>Delete a record identified by the given <a href="internals/../datamodeling/Concepts.html#record-id">Record ID</a>. During the optimistic transaction the record will be deleted only if the given version and the version of the record on the server match. This operation returns true if the record is deleted successfully, false otherwise.</p>
<pre><code>Request: (cluster-id:short)(cluster-position:long)(record-version:int)(mode:byte)
Response: (has-been-deleted:boolean)
</code></pre>
<h4 id="request-10"><a class="header" href="#request-10">Request</a></h4>
<ul>
<li><strong>cluster-id</strong>, <strong>cluster-position</strong> - the Record ID of the record to delete.</li>
<li><strong>record-version</strong> - the version of the record to delete.</li>
<li><strong>mode</strong> - can be:
<ul>
<li><code>0</code> - <strong>synchronous</strong>. It's the default mode which waits for the answer before the response is sent.</li>
<li><code>1</code> - <strong>asynchronous</strong>. The response is identical to the synchronous response, but the driver is encouraged to manage the answer in a callback.</li>
<li><code>2</code> - <strong>no-response</strong>. Don't wait for the answer (<em>fire and forget</em>). This mode is useful on massive operations since it reduces network latency.</li>
</ul>
</li>
</ul>
<h4 id="response-11"><a class="header" href="#response-11">Response</a></h4>
<ul>
<li><strong>has-been-deleted</strong> - true if the record is deleted successfully, false if it's not or if the record with the given Record ID doesn't exist.</li>
</ul>
<h2 id="request_command"><a class="header" href="#request_command">REQUEST_COMMAND</a></h2>
<p>Executes remote commands.</p>
<pre><code>Request: (mode:byte)(command-payload-length:int)(class-name:string)(command-payload)
Response:
- synchronous commands: [(synch-result-type:byte)[(synch-result-content:?)]]+
- asynchronous commands: [(asynch-result-type:byte)[(asynch-result-content:?)]*](pre-fetched-record-size.md)[(pre-fetched-record)]*+
</code></pre>
<h4 id="request-11"><a class="header" href="#request-11">Request</a></h4>
<ul>
<li><strong>mode</strong> - it can assume one of the following values:
<ul>
<li><code>a</code> - asynchronous mode</li>
<li><code>s</code> - synchronous mode</li>
<li><code>l</code> - live mode</li>
</ul>
</li>
<li><strong>command-payload-length</strong> - the length of the <strong>class-name</strong> field plus the length of the <strong>command-payload</strong> field.</li>
<li><strong>class-name</strong> - the class name of the command implementation. There are some short forms for the most common commands, which are:
<ul>
<li><code>q</code> - stands for "query" as idempotent command (e.g., <code>SELECT</code>). It's like passing <code>com.orientechnologies.orient.core.sql.query.OSQLSynchquery</code>.</li>
<li><code>c</code> - stands for "command" as non-idempotent command (e.g., <code>INSERT</code> or <code>UPDATE</code>). It's like passing <code>com.orientechnologies.orient.core.sql.OCommandSQL</code>.</li>
<li><code>s</code> - stands for "script" (for server-side scripting using languages like <a href="internals/../js/Javascript-Command.html">JavaScript</a>). It's like passing <code>com.orientechnologies.orient.core.command.script.OCommandScript</code>.</li>
<li>any other string - the string is the class name of the command. The command will be created via reflection using the default constructor and invoking the <code>fromStream()</code> method against it.</li>
</ul>
</li>
<li><strong>command-payload</strong> - is the payload of the command as specified in <a href="internals/Network-Binary-Protocol-Commands.html">the "Commands" section</a>.</li>
</ul>
<h4 id="response-12"><a class="header" href="#response-12">Response</a></h4>
<p>Response is different for synchronous and asynchronous request:</p>
<ul>
<li><strong>synchronous</strong>:</li>
<li><strong>synch-result-type</strong> can be:</li>
<li>'n', means null result</li>
<li>'r', means single record returned</li>
<li>'l', list of records. The format is:
<ul>
<li>an integer to indicate the collection size. Starting form v32, size can be -1 to stream a resultset. Last item will be null</li>
<li>all the records and each entry is typed with a short that can be:
<ul>
<li>'0' a record in the next bytes</li>
<li>'-2' no record and is considered as a null record</li>
<li>'-3' only a recordId in the next bytes</li>
</ul>
</li>
</ul>
</li>
<li>'s', set of records. The format is:
<ul>
<li>an integer to indicate the collection size. Starting form v32, size can be -1 to stream a resultset. Last item will be null</li>
<li>all the records and each entry is typed with a short that can be:
<ul>
<li>'0' a record in the next bytes</li>
<li>'-2' no record and is considered as a null record</li>
<li>'-3' only a recordId in the next bytes</li>
</ul>
</li>
</ul>
</li>
<li>'w', is a simple result wrapped inside a single record, deserialize the record as the <code>r</code> option and unwrap the real result reading the field <code>result</code> of the record.</li>
<li>'i', iterable of records
<ul>
<li>the result records will be streamed, no size as start is given, each entry has a flag at the start(same as <strong>asynch-result-type</strong>)
<ul>
<li>0: no record remain to be fetched</li>
<li>1: a record in the next bytes</li>
<li>2: a record in the next bytes to be loaded in client's cache only. It's not part of the result set but</li>
</ul>
</li>
</ul>
</li>
<li><strong>synch-result-content</strong>, can only be a record</li>
<li><strong>pre-fetched-record-size</strong>, as the number of pre-fetched records not directly part of the result set but joined to it by fetching</li>
<li><strong>pre-fetched-record</strong> as the pre-fetched record content</li>
<li><strong>asynchronous</strong>:</li>
<li><strong>asynch-result-type</strong> can be:</li>
<li>0: no records remain to be fetched</li>
<li>1: a record is returned as a resultset</li>
<li>2: a record is returned as pre-fetched to be loaded in client's cache only. It's not part of the result set but the client knows that it's available for later access</li>
<li><strong>asynch-result-content</strong>, can only be a record</li>
</ul>
<h2 id="request_query"><a class="header" href="#request_query">REQUEST_QUERY</a></h2>
<p>Executes remote commands.</p>
<pre><code>Request: (language:string)(statement:string)(operationType:byte)(recordsPerPage:int)(unused:string)(params:byte[])(namedParams:boolean)
Response: (queryId:string)(txChanges:boolean)(executionPlanPresent:boolean)[(executionPlan:OResult)](zero:integer)(resultSize:int)[(resultItem:OResult)]*(hasNextPage:boolean)(queryStatsCount:int)[(queryStatKey:string)(queryStatValue:long)]*(reloadMetadata:boolean)
</code></pre>
<h4 id="request-12"><a class="header" href="#request-12">Request</a></h4>
<ul>
<li><strong>language</strong> - The query language (eg. "SQL")</li>
<li><strong>statement</strong> - The command statement (ie. the query itself)</li>
<li><strong>operationType</strong> - The type of query operation to be performed:
<ul>
<li><code>0</code> - stands for "command" as non-idempotent command (e.g., <code>INSERT</code> or <code>UPDATE</code>). It's like using db.command(statement, params)</li>
<li><code>1</code> - stands for "query" as non-idempotent command (e.g., <code>SELECT</code>). It's like using db.query(statement, params)</li>
<li><code>2</code> - stands for "script" (for server-side scripting using languages like <a href="internals/../js/Javascript-Command.html">JavaScript</a>).  It's like using db.execute(language, statement, params)</li>
</ul>
</li>
<li><strong>recordsPerPage</strong> - The number N of results to be returned for each query page. At the first execution N results are returned, to return the next N REQUEST_QUERY_NEXT_PAGE has to be used.</li>
<li><strong>unused</strong> - reserved string, for future extensions. It is safe to pass a NULL string</li>
<li><strong>params</strong> - the query parameters, serialized as an ODocument, containing a "params" attribute (a Map) see <a href="internals/Record-Schemaless-Binary-Serialization.html">Binary</a>.</li>
<li><strong>namedParams</strong> - true if the query is using named parameters, false if it's using positional parameters.</li>
</ul>
<h4 id="response-13"><a class="header" href="#response-13">Response</a></h4>
<ul>
<li><strong>queryId</strong> - the query ID assigned by the server (needed to close the query cursor and to request next query pages)</li>
<li><strong>txChanges</strong> - true if the statement execution changed the transaction status server-side</li>
<li><strong>executionPlanPresent</strong> - true if there is an execution plan description attached to the query result</li>
<li><strong>executionPlan</strong> - and OResult describing the execution plan (present only if <code>executionPlanPresent</code> is true, see below for the serialization)</li>
<li><strong>zero</strong>  - not used</li>
<li><strong>resultSize</strong> - the number of result items that follow</li>
<li><strong>resultItem</strong> - a query result, that can be an OResult or an OIdentifiable. The resultItem structure is as follows: <code>(type:byte)(payload:varies based on type)</code>. The type can be 0 (BLOB), 1 (VERTEX), 2 (EDGE), 3 (ELEMENT, ie. Document), 4 (PROJECTION, ie. OResult, projection). 0, 1 and 2 are serialized as for the existing implementation (see <a href="internals/Record-Schemaless-Binary-Serialization.html">Binary</a> ); for 4 see below</li>
<li><strong>hasNextPage</strong> - true if the query has more results in a new page, ie. if invoking REQUEST_QUERY_NEXT_PAGE will return more items</li>
<li><strong>queryStatsCount</strong> - the number of query stats included in the result</li>
<li><strong>queryStatKey</strong> - a query stats key name (a normal string)</li>
<li><strong>queryStatValue</strong> - a query stats value</li>
<li><strong>reloadMetadata</strong> - true if the database metadata (eg. the schema) where modified during the statement execution.</li>
</ul>
<h4 id="projection-oresult-serialization"><a class="header" href="#projection-oresult-serialization">PROJECTION (OResult) serialization</a></h4>
<pre><code>(numberOfFields:varint)[(fieldName:string)(type:byte)[(value:serialized value)]]*
(numberOfMetadata:varint)[(metadataKey:string)(metadataType:byte)[(metadataValue:serialized value)]]*
</code></pre>
<ul>
<li><strong>numberOfFields</strong> - the number of fields following</li>
<li><strong>fieldName</strong> - a string representing a field name (a projection name) in the OResult</li>
<li><strong>type</strong> - the value type <a href="internals/../general/Types.html">see Types</a>.</li>
<li><strong>value</strong> - the actual field value serialization <a href="internals/../general/Types.html">see Types</a>.</li>
<li><strong>numberOfMetadata</strong> - the number of metadata items following</li>
<li><strong>metadataKey</strong> - a string representing a field name (a projection name) in the OResult</li>
<li><strong>metadataType</strong> - the value type <a href="internals/../general/Types.html">see Types</a>.</li>
<li><strong>metadataValue</strong> - the actual field value serialization <a href="internals/../general/Types.html">see Types</a>.</li>
</ul>
<h2 id="request_close_query"><a class="header" href="#request_close_query">REQUEST_CLOSE_QUERY</a></h2>
<p>Closes open query cursors. Queries always have to be closed to free the cursor memory</p>
<pre><code>request: (queryId:string)
response: empty
</code></pre>
<ul>
<li><strong>queryId</strong> - the ID of the query to close, as returned by REQUEST_QUERY</li>
</ul>
<h2 id="request_query_next_page"><a class="header" href="#request_query_next_page">REQUEST_QUERY_NEXT_PAGE</a></h2>
<p>Requests next page from the results of a running query</p>
<pre><code>request: (queryId:string)(recordsPerPage:int)
response: same as REQUEST_QUERY
</code></pre>
<ul>
<li><strong>queryId</strong> - the ID of the query to close, as returned by REQUEST_QUERY</li>
<li><strong>recordsPerPage</strong> - the maximum number of results that will be returned with next query page (less results can be returned if the query has no more results)</li>
</ul>
<h2 id="request_tx_commit"><a class="header" href="#request_tx_commit">REQUEST_TX_COMMIT</a></h2>
<p>Commits a transaction. This operation flushes all the pending changes to the server side.</p>
<pre><code>Request: (transaction-id:int)(using-tx-log:boolean)(tx-entry)*(0-byte indicating end-of-records)
Response: (created-record-count:int)[(client-specified-cluster-id:short)(client-specified-cluster-position:long)(created-cluster-id:short)(created-cluster-position:long)]*(updated-record-count:int)[(updated-cluster-id:short)(updated-cluster-position:long)(new-record-version:int)]*(count-of-collection-changes:int)[(uuid-most-sig-bits:long)(uuid-least-sig-bits:long)(updated-file-id:long)(updated-page-index:long)(updated-page-offset:int)]*
</code></pre>
<h4 id="request-13"><a class="header" href="#request-13">Request</a></h4>
<ul>
<li><strong>transaction-id</strong> - the id of the transaction. Read the "Transaction ID" section below for more information.</li>
<li><strong>using-tx-log</strong> - tells the server whether to use the transaction log to recover the transaction or not. Use <code>true</code> by default to ensure consistency. <em>Note</em>: disabling the log could speed up the execution of the transaction, but it makes impossible to rollback the transaction in case of errors. This could lead to inconsistencies in indexes as well, since in case of duplicated keys the rollback is not called to restore the index status.</li>
<li><strong>tx-entry</strong> - a list of elements (terminated by a 0 byte) with the form described below.</li>
</ul>
<h5 id="transaction-entry"><a class="header" href="#transaction-entry">Transaction entry</a></h5>
<p>Each transaction entry can specify one out of three actions to perform: create, update or delete.</p>
<p>The general form of a transaction entry (<strong>tx-entry</strong> above) is:</p>
<pre><code>(1:byte)(operation-type:byte)(cluster-id:short)(cluster-position:long)(record-type:byte)(entry-content)
</code></pre>
<p>The first byte means that there's another entry next. The values of the rest of these attributes depend directly on the operation type.</p>
<h5 id="update-3"><a class="header" href="#update-3">Update</a></h5>
<ul>
<li><strong>operation-type</strong> - has the value 1.</li>
<li><strong>cluster-id</strong>, <strong>cluster-position</strong> - the Record ID of the record to update.</li>
<li><strong>record-type</strong> - the type of the record to update (<code>d</code> for document, <code>b</code> for raw bytes and <code>f</code> for flat data).</li>
<li><strong>entry-content</strong> - has the form <code>(version:int)(update-content:boolean)(record-content:bytes)</code> where:
<ul>
<li><strong>update-content</strong> - can be:
<ul>
<li>true - the content of the record has been changed and should be updated in the storage.</li>
<li>false - the record was modified but its own content has not changed: related collections (e.g. RidBags) have to be updated, but the record version and its contents should not be updated.</li>
</ul>
</li>
<li><strong>version</strong> - the version of the record to update.</li>
<li><strong>record-content</strong> - the new contents of the record serialized using the appropriate <a href="internals/Network-Binary-Protocol.html#record-format">serialization format</a> chosen at connection time.</li>
</ul>
</li>
</ul>
<h6 id="delete-2"><a class="header" href="#delete-2">Delete</a></h6>
<ul>
<li><strong>operation-type</strong> - has the value 2.</li>
<li><strong>cluster-id</strong>, <strong>cluster-position</strong> - the Record ID of the record to update.</li>
<li><strong>record-type</strong> - the type of the record to update (<code>d</code> for document, <code>b</code> for raw bytes and <code>f</code> for flat data).</li>
<li><strong>entry-content</strong> - has the form <code>(version:int)</code> where:
<ul>
<li><strong>version</strong> - the version of the record to delete.</li>
</ul>
</li>
</ul>
<h6 id="create-1"><a class="header" href="#create-1">Create</a></h6>
<ul>
<li><strong>operation-type</strong> - has the value 3.</li>
<li><strong>cluster-id</strong>, <strong>cluster-position</strong> - when creating a new record, set the cluster id to <code>-1</code>. The cluster position must be an integer <code>&lt; -1</code>, unique in the scope of the transaction (meaning that if two new records are being created in the same transaction, they should have two different ids both <code>&lt; -1</code>).</li>
<li><strong>record-type</strong> - the type of the record to update (<code>d</code> for document, <code>b</code> for raw bytes and <code>f</code> for flat data).</li>
<li><strong>entry-content</strong> - has the form <code>(record-content:bytes)</code> where:
<ul>
<li><strong>record-content</strong> - the new contents of the record serialized using the appropriate <a href="internals/Network-Binary-Protocol.html#record-format">serialization format</a> chosen at connection time.</li>
</ul>
</li>
</ul>
<h5 id="transaction-id"><a class="header" href="#transaction-id">Transaction ID</a></h5>
<p>Each transaction must have an ID; the client is responsible for assigning an ID to each transaction. The ID must be unique in the scope of each session.</p>
<h4 id="response-14"><a class="header" href="#response-14">Response</a></h4>
<p>The response contains two parts:</p>
<ul>
<li>a map of "temporary" client-generated record ids to "real" server-provided record ids for each <strong>created</strong> record (not guaranteed to have the same order as the records in the request).</li>
<li>a map of <strong>updated</strong> record ids to update record versions.</li>
</ul>
<p>If the version of a created record is not <code>0</code>, then the Record ID of the created record will also appear in the list of "updated" records, along with its new version. This is a <a href="https://github.com/orientechnologies/orientdb/issues/4660">known bug</a>.</p>
<p>Look at <a href="internals/Transactions.html#optimistic-transaction">Optimistic Transaction</a> to know how temporary <a href="internals/../datamodeling/Concepts.html#record-id">Record ID</a>s are managed.</p>
<p>The last part of response (from <code>count-of-collection-changes</code> on) refers to <a href="internals/RidBag.html">RidBag</a> management. Take a look at <a href="internals/RidBag.html">the main page</a> for more details.</p>
<h2 id="request_index_get"><a class="header" href="#request_index_get">REQUEST_INDEX_GET</a></h2>
<p>Lookups in an index by key.</p>
<pre><code>Request: (index-name:string)(key:document)(fetch-plan:string)
Response: (result-type:byte)
</code></pre>
<h4 id="request-14"><a class="header" href="#request-14">Request</a></h4>
<ul>
<li><strong>index-name</strong> - the name of the index.</li>
<li><strong>key</strong> - a document whose <code>"key"</code> field contains the key.</li>
<li><strong>fetch-plan</strong> - the <a href="internals/../java/Fetching-Strategies.html">fetch plan</a> to use or an empty string.</li>
</ul>
<h4 id="response-15"><a class="header" href="#response-15">Response</a></h4>
<ul>
<li><strong>key</strong> - is stored in the field named "key" inside the document</li>
<li><strong>result-type</strong> can be:</li>
<li>'n', means null result</li>
<li>'r', means single record returned</li>
<li>'l', list of records. The format is:</li>
<li>an integer to indicate the collection size</li>
<li>all the records one by one</li>
<li>'s', set of records. The format is:</li>
<li>an integer to indicate the collection size</li>
<li>all the records one by one</li>
<li>'a', serialized result, a byte[] is sent</li>
<li><strong>synch-result-content</strong>, can only be a record</li>
<li><strong>pre-fetched-record-size</strong>, as the number of pre-fetched records not directly part of the result set but joined to it by fetching</li>
<li><strong>pre-fetched-record</strong> as the pre-fetched record content</li>
</ul>
<h2 id="request_index_put"><a class="header" href="#request_index_put">REQUEST_INDEX_PUT</a></h2>
<p>Create or update an entry in index by key.</p>
<pre><code>Request: (index-name:string)(key:document)(value:rid)
Response: no response
</code></pre>
<p>Where:</p>
<ul>
<li><strong>key</strong> is stored in the field named "key" inside the document</li>
</ul>
<h2 id="request_index_remove"><a class="header" href="#request_index_remove">REQUEST_INDEX_REMOVE</a></h2>
<p>Remove an entry by key from an index. It returns true if the entry was present, otherwise false.</p>
<pre><code>Request: (index-name:string)(key:document)
Response: (found:boolean)
</code></pre>
<p>Where:</p>
<ul>
<li><strong>key</strong> is stored in the field named "key" inside the document</li>
</ul>
<h3 id="request_create_sbtree_bonsai"><a class="header" href="#request_create_sbtree_bonsai">REQUEST_CREATE_SBTREE_BONSAI</a></h3>
<pre><code>Request: (clusterId:int)
Response: (collectionPointer)
</code></pre>
<p>See: <a href="internals/RidBag.html#serialization-of-collection-pointer">serialization of collection pointer</a></p>
<p>Creates an sb-tree bonsai on the remote server.</p>
<h3 id="request_sbtree_bonsai_get"><a class="header" href="#request_sbtree_bonsai_get">REQUEST_SBTREE_BONSAI_GET</a></h3>
<pre><code>Request: (collectionPointer)(key:binary)
Response: (valueSerializerId:byte)(value:binary)
</code></pre>
<p>See: <a href="internals/RidBag.html#serialization-of-collection-pointer">serialization of collection pointer</a></p>
<p>Get value by key from sb-tree bonsai.</p>
<p>Key and value are serialized according to format of tree serializer.
If the operation is used by RidBag key is always a RID and value can be null or integer.</p>
<h3 id="request_sbtree_bonsai_first_key"><a class="header" href="#request_sbtree_bonsai_first_key">REQUEST_SBTREE_BONSAI_FIRST_KEY</a></h3>
<pre><code>Request: (collectionPointer)
Response: (keySerializerId:byte)(key:binary)
</code></pre>
<p>See: <a href="internals/RidBag.html#serialization-of-collection-pointer">serialization of collection pointer</a></p>
<p>Get first key from sb-tree bonsai. Null if tree is empty.</p>
<p>Key are serialized according to format of tree serializer.
If the operation is used by RidBag key is null or RID.</p>
<h3 id="request_sbtree_bonsai_get_entries_major"><a class="header" href="#request_sbtree_bonsai_get_entries_major">REQUEST_SBTREE_BONSAI_GET_ENTRIES_MAJOR</a></h3>
<pre><code>Request: (collectionPointer)(key:binary)(inclusive:boolean)(pageSize:int)
Response: (count:int)[(key:binary)(value:binary)]*
</code></pre>
<p>See: <a href="internals/RidBag.html#serialization-of-collection-pointer">serialization of collection pointer</a></p>
<p>Gets the portion of entries major than specified one. If returns 0 entries than the specified entry is the largest.</p>
<p>Keys and values are serialized according to format of tree serializer.
If the operation is used by RidBag key is always a RID and value is integer.</p>
<p>Default pageSize is 128.</p>
<h3 id="request_ridbag_get_size"><a class="header" href="#request_ridbag_get_size">REQUEST_RIDBAG_GET_SIZE</a></h3>
<pre><code>Request: (collectionPointer)(collectionChanges)
Response: (size:int)
</code></pre>
<p>See: <a href="internals/RidBag.html#serialization-of-collection-pointer">serialization of collection pointer</a>, <a href="internals/RidBag.html#serialization-of-rid-bag-changes">serialization of collection changes</a></p>
<p>Rid-bag specific operation. Send but does not save changes of rid bag. Retrieves computed size of rid bag.</p>
<h1 id="special-use-of-linkset-types"><a class="header" href="#special-use-of-linkset-types">Special use of LINKSET types</a></h1>
<blockquote>
<p>NOTE. Since 1.7rc1 this feature is deprecated. Usage of RidBag is preferable.</p>
</blockquote>
<p>Starting from 1.0rc8-SNAPSHOT OrientDB can transform collections of links from the classic mode:</p>
<pre><code>[#10:3,#10:4,#10:5]
</code></pre>
<p>to:</p>
<pre><code>(ORIDs@pageSize:16,root:#2:6)
</code></pre>
<p>For more information look at the announcement of this new feature: https://groups.google.com/d/topic/orient-database/QF52JEwCuTM/discussion</p>
<p>In practice to optimize cases with many relationships/edges the collection is transformed in a mvrb-tree. This is because the embedded object. In that case the important thing is the link to the root node of the balanced tree.</p>
<p>You can disable this behaviour by setting</p>
<p><em>mvrbtree.ridBinaryThreshold</em> = -1</p>
<p>Where <em>mvrbtree.ridBinaryThreshold</em> is the threshold where OrientDB will use the tree instead of plain collection (as before). -1 means "hey, never use the new mode but leave all as before".</p>
<h2 id="tree-node-binary-structure"><a class="header" href="#tree-node-binary-structure">Tree node binary structure</a></h2>
<p>To improve performance this structure is managed in binary form. Below how is made:</p>
<pre><code>+-----------+-----------+--------+------------+----------+-----------+---------------------+
| TREE SIZE | NODE SIZE | COLOR .| PARENT RID | LEFT RID | RIGHT RID | RID LIST .......... |
+-----------+-----------+--------+------------+----------+-----------+---------------------+
| 4 bytes . | 4 bytes . | 1 byte | 10 bytes ..| 10 bytes | 10 bytes .| 10 * MAX_SIZE bytes |
+-----------+-----------+--------+------------+----------+-----------+---------------------+
= 39 bytes + 10 * PAGE-SIZE bytes
</code></pre>
<p>Where:</p>
<ul>
<li><em>TREE SIZE</em> as signed integer (4 bytes) containing the size of the tree. Only the root node has this value updated, so to know the size of the collection you need to load the root node and get this field. other nodes can contain not updated values because upon rotation of pieces of the tree (made during tree rebalancing) the root can change and the old root will have the "old" size as dirty.</li>
<li><em>NODE SIZE</em> as signed integer (4 bytes) containing number of entries in this node. It's always &lt;= to the page-size defined at the tree level and equals for all the nodes. By default page-size is 16 items</li>
<li><em>COLOR</em> as 1 byte containing 1=Black, 0=Red. To know more about the meaning of this look at <a href="http://en.wikipedia.org/wiki/Red%E2%80%93black_tree">Red-Black Trees</a></li>
<li><strong>PARENT RID</strong> as <a href="internals/../datamodeling/Concepts.html#record-id">RID</a> (10 bytes) of the parent node record</li>
<li><strong>LEFT RID</strong> as <a href="internals/../datamodeling/Concepts.html#record-id">RID</a> (10 bytes) of the left node record</li>
<li><strong>RIGHT RID</strong> as <a href="internals/../datamodeling/Concepts.html#record-id">RID</a> (10 bytes) of the right node record</li>
<li><strong>RID LIST</strong> as the list of <a href="internals/../datamodeling/Concepts.html#record-id">RIDs</a> containing the references to the records. This is pre-allocated to the configured page-size. Since each <a href="internals/../datamodeling/Concepts.html#record-id">RID</a> takes 10 bytes, a page-size of 16 means 16 x 10bytes = 160bytes</li>
</ul>
<p>The size of the tree-node on disk (and memory) is fixed to avoid fragmentation. To compute it: 39 bytes + 10 * PAGE-SIZE bytes. For a page-size = 16 you'll have 39 + 160 = 199 bytes.</p>
<h3 id="request_push_distrib_config"><a class="header" href="#request_push_distrib_config">REQUEST_PUSH_DISTRIB_CONFIG</a></h3>
<pre><code>(configuration:document)
</code></pre>
<p>where:
<strong>configuration</strong> is and orientdb document serialized with the network <a href="internals/Network-Binary-Protocol.html#record-format">Record Format</a>, that contain the distributed configuration.</p>
<h3 id="request_push_live_query"><a class="header" href="#request_push_live_query">REQUEST_PUSH_LIVE_QUERY</a></h3>
<pre><code>(message-type:byte)(message-body)
</code></pre>
<p>where:<br />
<strong>message-type</strong> is the type of message and can have as a value</p>
<ul>
<li><em>RECORD</em> = 'r'</li>
<li><em>UNSUBSCRIBE</em> = 'u'</li>
</ul>
<p><strong>message-body</strong> is one for each type of message</p>
<h5 id="record-message-body"><a class="header" href="#record-message-body">Record Message Body:</a></h5>
<pre><code>(operation:byte)(query_token:int)(record-type:byte)(record-version:int)(cluster-id:short)(cluster-position:long)(record-content:bytes)
</code></pre>
<p>where:<br />
<strong>operation</strong> the type of operation happened, possible values</p>
<ul>
<li><em>LOADED</em> = 0</li>
<li><em>UPDATED</em> = 1</li>
<li><em>DELETED</em> = 2</li>
<li><em>CREATED</em> = 3</li>
</ul>
<p><strong>query_token</strong> the token that identify the relative query of the push message, it match the result token of the live query command request.<br />
<strong>record-type</strong> type of the record ('d' or 'b')<br />
<strong>record-version</strong>  record version<br />
<strong>cluster-id</strong> record cluster id<br />
<strong>cluster-position</strong> record cluster position<br />
<strong>record-content</strong> record content</p>
<h5 id="unsubscribe-message-body"><a class="header" href="#unsubscribe-message-body">Unsubscribe Message Body:</a></h5>
<pre><code>(query_token:int)
</code></pre>
<p><strong>query_token</strong> the token for identify the query that has been unsubscribed.</p>
<h1 id="history-10"><a class="header" href="#history-10">History</a></h1>
<h2 id="version-36"><a class="header" href="#version-36">version 36</a></h2>
<p>add support for REQUEST_INCREMENTAL_RESTORE</p>
<h2 id="version-35"><a class="header" href="#version-35">version 35</a></h2>
<p>command result review:
add support for "wrapped types" on command result set, removed support for "simple types".</p>
<p>is now possible a new option <code>w</code> over the one already existent <code>r</code>,<code>s</code>,<code>l</code>,<code>i</code>
it consist in a document serialized in the same way of <code>r</code> that wrap the result in a field called <code>result</code>.</p>
<p>the old options <code>a</code> for simple results is now removed.</p>
<h2 id="version-34"><a class="header" href="#version-34">version 34</a></h2>
<p>Add flags <code>support-push</code> and <code>collect-stats</code> on  REQUEST_DB_OPEN.</p>
<h2 id="version-33"><a class="header" href="#version-33">version 33</a></h2>
<p>Removed the token data from error handling header in case of non token session.
Removed the db-type from REQUEST_DB_OPEN
added REQUEST_DB_REOPEN</p>
<h2 id="version-32"><a class="header" href="#version-32">Version 32</a></h2>
<p>Added support of streamable resultset in case of sync command, added a new result of type 'i' that stream the result in the same way of async result.</p>
<h2 id="version-31"><a class="header" href="#version-31">Version 31</a></h2>
<p>Added new commands to manipulate indexes: REQUEST_INDEX_GET, REQUEST_INDEX_PUT and REQUEST_INDEX_REMOVE.</p>
<h2 id="version-30"><a class="header" href="#version-30">Version 30</a></h2>
<p>Added new command REQUEST_RECORD_LOAD_IF_VERSION_NOT_LATEST</p>
<h2 id="version-29"><a class="header" href="#version-29">Version 29</a></h2>
<p>Added support support of live query in REQUEST_COMMAND, added new push command REQUEST_PUSH_LIVE_QUERY</p>
<h2 id="version-28"><a class="header" href="#version-28">Version 28</a></h2>
<p>Since version 28 the <a href="internals/Network-Binary-Protocol.html#request_record_load">REQUEST_RECORD_LOAD</a> response order is changed from:
<code>[(payload-status:byte)[(record-content:bytes)(record-version:int)(record-type:byte)]*]+</code>
to:
<code>[(payload-status:byte)[(record-type:byte)(record-version:int)(record-content:bytes)]*]+</code></p>
<h2 id="version-27"><a class="header" href="#version-27">Version 27</a></h2>
<p>Since version 27 is introduced an extension to allow use a token based session, if this modality is enabled a few things change in the modality the protocol works.</p>
<ul>
<li>in the first negotiation the client should ask for a token based authentication using the token-auth flag</li>
<li>the server will reply with a token or an empty byte array that means that it not support token based session and is using a old style session.</li>
<li>if the server don't send back the token the client can fail or drop back the the old modality.</li>
<li>for each request the client should send the token and the sessionId</li>
<li>the sessionId is needed only for match a response to a request</li>
<li>if used the token the connections can be shared between users and db of the same server, not needed to have connection associated to db and user.</li>
</ul>
<p>protocol methods changed:</p>
<p>REQUEST_DB_OPEN</p>
<ul>
<li>request add token session flag</li>
<li>response add of the token</li>
</ul>
<p>REQUEST_CONNECT</p>
<ul>
<li>request add token session flag</li>
<li>response add of the token</li>
</ul>
<h2 id="version-26"><a class="header" href="#version-26">Version 26</a></h2>
<p>Added cluster-id in the REQUEST_CREATE_RECORD response.</p>
<h2 id="version-25"><a class="header" href="#version-25">Version 25</a></h2>
<p>Reviewed serialization of index changes in the REQUEST_TX_COMMIT for details <a href="https://github.com/orientechnologies/orientdb/issues/2676">#2676</a>
Removed double serialization of commands parameters, now the parameters are directly serialized in a document see <a href="internals/Network-Binary-Protocol-Commands.html">Network Binary Protocol Commands</a> and <a href="https://github.com/orientechnologies/orientdb/issues/2301">#2301</a></p>
<h2 id="version-24"><a class="header" href="#version-24">Version 24</a></h2>
<ul>
<li>cluster-type and cluster-dataSegmentId parameters were removed from response for REQUEST_DB_OPEN, REQUEST_DB_RELOAD requests.</li>
<li>datasegment-id parameter was removed from REQUEST_RECORD_CREATE request.</li>
<li>type, location and datasegment-name parameters were removed from REQUEST_DATACLUSTER_ADD request.</li>
<li>REQUEST_DATASEGMENT_ADD  request was removed.</li>
<li>REQUEST_DATASEGMENT_DROP request was removed.</li>
</ul>
<h2 id="version-23"><a class="header" href="#version-23">Version 23</a></h2>
<ul>
<li>Add support of <code>updateContent</code> flag to UPDATE_RECORD and COMMIT</li>
</ul>
<h2 id="version-22"><a class="header" href="#version-22">Version 22</a></h2>
<ul>
<li>REQUEST_CONNECT and REQUEST_OPEN now send the document serialization format that the client require</li>
</ul>
<h2 id="version-21-1"><a class="header" href="#version-21-1">Version 21</a></h2>
<ul>
<li>REQUEST_SBTREE_BONSAI_GET_ENTRIES_MAJOR (which is used to iterate through SBTree) now gets "pageSize" as int as last argument. Version 20 had a fixed pageSize=5. The new version provides configurable pageSize by client. Default pageSize value for protocol=20 has been changed to 128.</li>
</ul>
<h2 id="version-20"><a class="header" href="#version-20">Version 20</a></h2>
<ul>
<li>Rid bag commands were introduced.</li>
<li>Save/commit was adapted to support client notifications about changes of collection pointers.</li>
</ul>
<h2 id="version-19"><a class="header" href="#version-19">Version 19</a></h2>
<ul>
<li>Serialized version of server exception is sent to the client.</li>
</ul>
<h2 id="version-18"><a class="header" href="#version-18">Version 18</a></h2>
<ul>
<li>Ability to set cluster id during cluster creation was added.</li>
</ul>
<h2 id="version-17"><a class="header" href="#version-17">Version 17</a></h2>
<ul>
<li>Synchronous commands can send fetched records like asynchronous one.</li>
</ul>
<h2 id="version-16"><a class="header" href="#version-16">Version 16</a></h2>
<ul>
<li>Storage type is required for REQUEST_DB_FREEZE, REQUEST_DB_RELEASE, REQUEST_DB_DROP, REQUEST_DB_EXIST commands.</li>
<li>This is required to support plocal storage.</li>
</ul>
<h2 id="version-15"><a class="header" href="#version-15">Version 15</a></h2>
<ul>
<li>SET types are stored in different way then LIST. Before rel. 15 both were stored between squared braces [] while now SET are stored between &lt;&gt;</li>
</ul>
<h2 id="version-14-1"><a class="header" href="#version-14-1">Version 14</a></h2>
<ul>
<li>DB_OPEN returns information about version of OrientDB deployed on server.</li>
</ul>
<h2 id="version-13"><a class="header" href="#version-13">Version 13</a></h2>
<ul>
<li>To support upcoming auto-sharding support feature following changes were done
<ul>
<li>RECORD_LOAD flag to support ability to load tombstones was added.</li>
<li>DATACLUSTER_COUNT flag to support ability to count tombstones in cluster was added.</li>
</ul>
</li>
</ul>
<h2 id="version-12"><a class="header" href="#version-12">Version 12</a></h2>
<ul>
<li>DB_OPEN returns the dataSegmentId foreach cluster</li>
</ul>
<h2 id="version-11-1"><a class="header" href="#version-11-1">Version 11</a></h2>
<ul>
<li>RECORD_CREATE always returns the record version. This was necessary because new records could have version &gt; 0 to avoid MVCC problems on RID recycle</li>
</ul>
<h1 id="compatibility-1"><a class="header" href="#compatibility-1">Compatibility</a></h1>
<p>Current release of OrientDB server supports older client versions.</p>
<ul>
<li>version 35: 100% compatible 2.2-SNAPSHOT</li>
<li>version 34: 100% compatible 2.2-SNAPSHOT</li>
<li>version 34: 100% compatible 2.2-SNAPSHOT</li>
<li>version 33: 100% compatible 2.2-SNAPSHOT</li>
<li>version 32: 100% compatible 2.1-SNAPSHOT</li>
<li>version 31: 100% compatible 2.1-SNAPSHOT</li>
<li>version 30: 100% compatible 2.1-SNAPSHOT</li>
<li>version 29: 100% compatible 2.1-SNAPSHOT</li>
<li>version 28: 100% compatible 2.1-SNAPSHOT</li>
<li>version 27: 100% compatible 2.0-SNAPSHOT</li>
<li>version 26: 100% compatible 2.0-SNAPSHOT</li>
<li>version 25: 100% compatible 2.0-SNAPSHOT</li>
<li>version 24: 100% compatible 2.0-SNAPSHOT</li>
<li>version 23: 100% compatible 2.0-SNAPSHOT</li>
<li>version 22: 100% compatible 2.0-SNAPSHOT</li>
<li>version 22: 100% compatible 2.0-SNAPSHOT</li>
<li>version 21: 100% compatible 1.7-SNAPSHOT</li>
<li>version 20: 100% compatible 1.7rc1-SNAPSHOT</li>
<li>version 19: 100% compatible 1.6.1-SNAPSHOT</li>
<li>version 18: 100% compatible 1.6-SNAPSHOT</li>
<li>version 17: 100% compatible. 1.5</li>
<li>version 16: 100% compatible. 1.5-SNAPSHOT</li>
<li>version 15: 100% compatible. 1.4-SNAPSHOT</li>
<li>version 14: 100% compatible. 1.4-SNAPSHOT</li>
<li>version 13: 100% compatible. 1.3-SNAPSHOT</li>
<li>version 12: 100% compatible. 1.3-SNAPSHOT</li>
<li>version 11: 100% compatible. 1.0-SNAPSHOT</li>
<li>version 10: 100% compatible. 1.0rc9-SNAPSHOT</li>
<li>version 9: 100% compatible. 1.0rc9-SNAPSHOT</li>
<li>version 8: 100% compatible. 1.0rc9-SNAPSHOT</li>
<li>version 7: 100% compatible. 1.0rc7-SNAPSHOT - 1.0rc8</li>
<li>version 6: 100% compatible. Before 1.0rc7-SNAPSHOT</li>
<li>&lt; version 6: not compatible</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="csv-serialization"><a class="header" href="#csv-serialization">CSV Serialization</a></h1>
<p>The CSV serialzation is the format how record are serialized in the orientdb 0.*  and 1.* version.</p>
<p>Documents are serialized in a proprietary format (as a string) derived from JSON, but more compact. The string retrieved from the storage could be filled with spaces. This is due to the oversize feature if it is set. Just ignore the tailing spaces.</p>
<p>To know more about types look at <a href="internals/../general/Types.html">Supported types</a>.</p>
<p>These are the rules:</p>
<ul>
<li>Any string content must escape some characters:</li>
<li><code>" -&gt; "</code></li>
<li><code>\ -&gt; \</code></li>
<li>The <strong>class</strong>, if present, is at the begin and must end with <code>@</code>. E.g. <code>Customer@</code></li>
<li>Each <strong>Field</strong> must be present with its name and value separated by <code>:</code>. E.g.<code>name:"Barack"</code></li>
<li><strong>Fields</strong> must be separated by <code>,</code>. E.g. <code>name:"Barack",surname:"Obama"</code></li>
<li>All <strong>Strings</strong> must be enclosed by <code>"</code> character. E.g. <code>city:"Rome"</code></li>
<li>All <strong>Binary</strong> content (like byte[must be encoded in Base64 and enclosed by underscore <code>_</code> character. E.g. <code>buffer:<em>AAECAwQFBgcICQoLDA0ODxAREhMUFRYXGBkaGx</em></code>. Since v1.0rc7</li>
<li><em>Numbers</em> (integer, long, short, byte, floats, double) are formatted as strings as ouput by the Java toString() method. No thousands separator must be used. The decimal separator is always <code>.</code> Starting from version 0.9.25, if the type is not integer, a suffix is used to distinguish the right type when unmarshalled: b=byte, s=short, l=long, f=float, d=double, c=BigDecimal (since 1.0rc8). E.g. <code>salary:120.3f</code> or <code>code:124b</code>.</li>
<li>Output of <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Float.html#toString%28float%29">Floats</a></li>
<li>Output of <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Double.html#toString%28double%29">Doubles</a></li>
<li>Output of <a href="http://docs.oracle.com/javase/6/docs/api/java/math/BigDecimal.html#toPlainString%28%29">BigDecimal</a></li>
<li><strong>Booleans</strong> are expressed as <code>true</code> and <code>false</code> always in lower-case. They are recognized as boolean since the text has no double quote as is the case with strings</li>
<li><strong>Dates</strong> must be in the POSIX format (also called UNIX format: http://en.wikipedia.org/wiki/Unix_time). Are always stored as longs but end with:</li>
<li>the 't' character when it's DATETIME type (default in schema-less mode when a Date object is used). Datetime handles the maximum precision up to milliseconds. E.g. <code>lastUpdate:1296279468000t</code> is read as 2011-01-29 05:37:48</li>
<li>the 'a' character when it's DATE type. Date handles up to day as precision. E.g. <code>lastUpdate:1306281600000a</code> is read as 2011-05-25 00:00:00 (Available since 1.0rc2)</li>
<li><strong><a href="internals/../datamodeling/Concepts.html#record-id">RecordID</a></strong> (link) must be prefixed by <code>#</code>. A Record Id always has the format <code>&lt;cluster-id&gt;:&lt;cluster-position&gt;</code>. E.g. <code>location:#3:2</code></li>
<li><strong>Embedded</strong> documents are enclosed by parenthesis <code>(</code> and <code>)</code> characters. E.g. <code>(name:"rules")</code>. <em>Note: before SVN revision 2007 (0.9.24-snapshot) only <code></em></code> characters were used to begin and end the embedded document.*</li>
<li><strong>Lists</strong> (array and list) must be enclosed by <code>[</code> and <code>]</code> characters. E.g. <code>[1,2,3]</code>, <code>[#10:3,#10:4]</code> and <code>[(name:"Luca")]</code>. Before rel.15 SET type was stored as a list, but now it uses own format (see below)</li>
<li><strong>Sets</strong> (collections without duplicates) must be enclosed by <code>&lt;</code> and <code>&gt;</code> characters. E.g. <code>&lt;1,2,3&gt;</code>, <code>&lt;#10:3,#10:4&gt;</code> and <code>&lt;(name:"Luca")&gt;</code>. There is a special case when use LINKSET type reported in detail in <a href="internals/Network-Binary-Protocol.html#special-use-of-linkset-types">Special use of LINKSET types</a> section. Before rel.15 SET type was stored as a list (see upon).</li>
<li><strong>Maps</strong> (as a collection of entries with key/value) must be enclosed in <code>{</code> and <code>}</code> characters. E.g. <code>rules:{"database":2,"database.cluster.internal":2&lt;/code&gt;}</code> (NB. to set a value part of a key/value pair, set it to the text "null", without quotation marks. Eg. <code>rules:{"database_name":"fred","database_alias":null}</code>)</li>
<li><strong>RidBags</strong> a special collection for link management. Represented as <code>%(content:binary);</code> where the content is binary data encoded in base64. Take a look at <a href="internals/RidBag.html">the main page</a> for more details.</li>
<li><strong>Null</strong> fields have an empty value part of the field. E.g. <code>salary_cloned:,salary:</code></li>
</ul>
<pre><code>[&lt;class&gt;@][,][&lt;field-name&gt;:&lt;field-value&gt;]*
</code></pre>
<p>Simple example (line breaks introduced so it's visible on this page):</p>
<pre><code>Profile@nick:"ThePresident",follows:[],followers:[#10:5,#10:6],name:"Barack",surname:"Obama",
location:#3:2,invitedBy:,salary_cloned:,salary:120.3f
</code></pre>
<p>Complex example used in schema (line breaks introduced so it's visible on this page):</p>
<pre><code>name:"ORole",id:0,defaultClusterId:3,clusterIds:[3],properties:[(name:"mode",type:17,offset:0,
mandatory:false,notNull:false,min:,max:,linkedClass:,
linkedType:,index:),(name:"rules",type:12,offset:1,mandatory:false,notNull:false,min:,
max:,linkedClass:,linkedType:17,index:)]
</code></pre>
<p>Other example of ORole that uses a map (line breaks introduced so it's visible on this page):</p>
<pre><code>ORole@name:"reader",inheritedRole:,mode:0,rules:{"database":2,"database.cluster.internal":2,"database.cluster.orole":2,"database.cluster.ouser":2,
"database.class.*":2,"database.cluster.*":2,"database.query":2,"database.command":2,
"database.hook.record":2}
</code></pre>
<h1 id="serialization-1"><a class="header" href="#serialization-1">Serialization</a></h1>
<p>Below the serialization of types in JSON and Binary format (always refers to latest version of the protocol).</p>
<div class="table-wrapper"><table><thead><tr><th>Type</th><th>JSON format</th><th>Binary descriptor</th></tr></thead><tbody>
<tr><td>String</td><td>0</td><td>Value ends with 'b'. Example: 23b</td></tr>
<tr><td>Short</td><td>10000</td><td>Value ends with 's'. Example: 23s</td></tr>
<tr><td>Integer</td><td>1000000</td><td>Just the value. Example: 234392</td></tr>
<tr><td>Long</td><td>1000000000</td><td>Value ends with 'l'. Example: 23439223l</td></tr>
<tr><td>Float</td><td>100000.33333</td><td>Value ends with 'f'. Example: 234392.23f</td></tr>
<tr><td>Double</td><td>100.33</td><td>Value ends with 'd'. Example: 10020.2302d</td></tr>
<tr><td>Decimal</td><td>1000.3333</td><td>Value ends with 'c'. Example: 234.923c</td></tr>
<tr><td>Boolean</td><td>true</td><td>'true' or 'false'. Example: true</td></tr>
<tr><td>Date</td><td>1436983328000</td><td>Value in milliseconds ends with 'a'. Example: 1436983328000a</td></tr>
<tr><td>Datetime</td><td>1436983328000</td><td>Value in milliseconds ends with 't'. Example: 1436983328000t</td></tr>
<tr><td>Binary</td><td>base64 encoded binary, like: "A3ERjRFdc0023Kc"</td><td>Bytes surrounded with <code>_</code> characters. Example: <code>_</code>2332322<code>_</code></td></tr>
<tr><td>Link</td><td>#10:3</td><td>Just the RID. Example: #10:232</td></tr>
<tr><td>Link list</td><td><code>[#10:3, #10:4]</code></td><td>Collections values separated by commas and surrounded by brackets "[ ]". Example: [#10:3, #10:6]</td></tr>
<tr><td>Link set</td><td>Example: <code>[#10:3, #10:6]</code></td><td>Example: <code>&lt;#10:3, #10:4&gt;</code></td></tr>
<tr><td>Link map</td><td>Example: <code>{ "name" : "#10:3" }</code></td><td>Map entries separated by commas and surrounded by curly braces "{ }". Example: <code>{"Jay":#10:3,"Mike":#10:6}</code></td></tr>
<tr><td>Embedded</td><td><code>{"Jay":"#10:3","Mike":"#10:6"}</code></td><td>Embedded document serialized surrounded by parenthesis "( )". Example: <code>({"Jay":#10:3,"Mike":#10:6})</code></td></tr>
<tr><td>Embedded list</td><td>Example: <code>[20, 30]</code></td><td>Collections of values separated by commas and surrounded by brackets "[ ]". Example: <code>[20, 30]</code></td></tr>
<tr><td>Embedded set</td><td><code>['is', 'a', 'test']</code></td><td>Collections of values separated by commas and surrounded by minor and major "&lt;&gt;". Example: <code>&lt;20, 30&gt;</code></td></tr>
<tr><td>Embedded map</td><td><code>{ "name" : "Luca" }</code></td><td>Map of values separated by commas and surrounded by curly braces "{ }". Example: <code>{"key1":23,"key2":2332}</code></td></tr>
<tr><td>Custom</td><td>base64 encoded binary, like: "A3ERjRFdc0023Kc"</td><td>-</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="schemaless-serialization"><a class="header" href="#schemaless-serialization">Schemaless Serialization</a></h1>
<p>The binary schemaless serialization is an attempt to define a serialization format that can serialize a document containing all the information about the structure and the data with support for partial serialization/deserialization.</p>
<p>The types described here are different from the types used in the binary protocol.</p>
<p>A serialized record has the following shape:</p>
<pre><code>(serialization-version:byte)(class-name:string)(header:byte[])(data:byte[])
</code></pre>
<h2 id="version-1"><a class="header" href="#version-1">Version</a></h2>
<p>1 byte that contains the version of the current serialization (in order to allow progressive serialization upgrades).</p>
<h2 id="class-name"><a class="header" href="#class-name">Class Name</a></h2>
<p>A string containing the name of the class of the record. If the record has no class, <code>class-name</code> will be just an empty string.</p>
<h2 id="header"><a class="header" href="#header">Header</a></h2>
<p>The header contains a list of fields of the serialized records, along with their position in the <code>data</code> field. The header has the following shape:</p>
<pre><code>(field:field-definition)+
</code></pre>
<p>Where <code>field-definition</code> has this shape:</p>
<pre><code>(field-type:varint)(field-contents:byte[])
</code></pre>
<p>The field contents depend on the value of the <code>field-type</code> varint. Once decoded to an integer, its value can be:</p>
<ul>
<li><code>0</code> - signals the end of the header</li>
<li>a positive number <code>i</code> - signals that what follows is a named field (and it's the length of the field name, see below)</li>
<li>a negative number <code>i</code> - signals that what follows is a property (and it encodes the property id, see below)</li>
</ul>
<h4 id="named-fields"><a class="header" href="#named-fields">Named fields</a></h4>
<p>Named fields are encoded as:</p>
<pre><code>(field-name:string)(pointer-to-data-structure:int32)(data-type:byte)
</code></pre>
<ul>
<li><code>field-name</code> - the name of the field. The <code>field-type</code> varint is included in <code>field-name</code> (as per the string encoding) as mentioned above.</li>
<li><code>pointer-to-data-structure</code> - a pointer to the data structure for the current field in the <code>data</code> segment. It's <code>0</code> if the field is null.</li>
<li><code>data-type</code> - the type id of the type of the value for the current field. The supported types (with their ids) are defined in <a href="internals/../general/Types.html">this section</a>.</li>
</ul>
<h4 id="properties-3"><a class="header" href="#properties-3">Properties</a></h4>
<p>Properties are encoded as:</p>
<pre><code>(property-id:varint)(pointer-to-data-structure:int32)
</code></pre>
<ul>
<li><code>property-id</code> - is the <code>field-type</code> described above. It's a negative value that encodes a property id. Decoding of this value into the corresponding property id can be done using this formula: <code>(property-id * -1) - 1</code>. The property identified by this id will be found in the schema (with its name and its type), stored in the <code>globalProperties</code> field at the root of the document that represents the schema definition.</li>
<li><code>pointer-to-data-structure</code> - a pointer to the data structure for the current field in the <code>data</code> segment. It's <code>0</code> if the field is null.</li>
</ul>
<h2 id="data"><a class="header" href="#data">Data</a></h2>
<p>The data segment is where the values of the fields are stored. It's an array of data structures (each with a type described by the corresponding field).</p>
<pre><code>(data:data-structure[])
</code></pre>
<p>Each type is serialized differently, as described below.</p>
<h2 id="type-serialization"><a class="header" href="#type-serialization">Type serialization</a></h2>
<h3 id="short-integer-long"><a class="header" href="#short-integer-long">SHORT, INTEGER, LONG</a></h3>
<p>Integers are encoded using the varint (with ZigZag) algorithm used by Google's ProtoBuf (and specified <a href="https://developers.google.com/protocol-buffers/docs/encoding?csw=1">here</a>).</p>
<h3 id="byte"><a class="header" href="#byte">BYTE</a></h3>
<p>Bytes is stored raw, as single bytes.</p>
<h3 id="boolean"><a class="header" href="#boolean">BOOLEAN</a></h3>
<p>Booleans are serialized using a single byte, <code>0</code> meaning false and <code>1</code> meaning true.</p>
<h3 id="float"><a class="header" href="#float">FLOAT</a></h3>
<p>This is stored as flat byte array copying the memory from the float memory.</p>
<pre><code>(float:byte[4])
</code></pre>
<h3 id="double"><a class="header" href="#double">DOUBLE</a></h3>
<p>This is stored as flat byte array copying the memory from the double memory.</p>
<pre><code>(double:byte[8])
</code></pre>
<h3 id="datetime"><a class="header" href="#datetime">DATETIME</a></h3>
<p>The date is converted to milliseconds (from the Unix epoch) and stored as the type LONG.</p>
<h3 id="date-1"><a class="header" href="#date-1">DATE</a></h3>
<p>The date is converted to seconds (from the Unix epoch), moved to midnight UTC+0, divided by 86400 (the number of seconds in a day) and stored as the type LONG.</p>
<h3 id="string"><a class="header" href="#string">STRING</a></h3>
<p>Strings are stored as binary structures (encoded as UTF-8). Strings are preceded by their size (in bytes).</p>
<pre><code>(size:varint)(string:byte[])
</code></pre>
<ul>
<li><strong>size</strong> - the number of the bytes in the string stored as a varint</li>
<li><strong>string</strong> - the bytes of the string encoded as UTF-8</li>
</ul>
<h3 id="binary"><a class="header" href="#binary">BINARY</a></h3>
<p>Byte arrays are stored like STRINGs.</p>
<pre><code>(size:varint)(bytes:byte[])
</code></pre>
<ul>
<li><strong>size</strong> - the number of the bytes to store</li>
<li><strong>bytes</strong> - the raw bytes</li>
</ul>
<h3 id="embedded"><a class="header" href="#embedded">EMBEDDED</a></h3>
<p>Embedded documents are serialized using the protocol described in this document (recursively). The serialized document is just a byte array.</p>
<pre><code>(serialized-document:bytes[])
</code></pre>
<h3 id="embeddedlist-embeddedset"><a class="header" href="#embeddedlist-embeddedset">EMBEDDEDLIST, EMBEDDEDSET</a></h3>
<p>The embedded collections are stored as an array of bytes that contain the serialized document in the embedded mode.</p>
<pre><code>(size:varint)(collection-type:byte)(items:item[])
</code></pre>
<ul>
<li><strong>size</strong> - the number of items in the list/set</li>
<li><strong>collection-type</strong> - the type of the elements in the list or ANY if the type is unknown.</li>
<li><strong>items</strong> an array of values serialized by type or if the type of the collection is ANY the item will have it's own structure.</li>
</ul>
<p>The <code>item</code> data structure has the following shape:</p>
<pre><code>(data-type:byte)(data:byte)
</code></pre>
<ul>
<li><strong>data-type</strong> - the type id of the data in the item</li>
<li><strong>data</strong> - the data in the item serialized according to the <strong>data-type</strong></li>
</ul>
<h3 id="embeddedmap"><a class="header" href="#embeddedmap">EMBEDDEDMAP</a></h3>
<p>Maps can have keys with the following types:</p>
<ul>
<li>STRING</li>
</ul>
<p>As of now though, <strong>all keys are converted to STRINGs</strong>.</p>
<p>An EMBEDDEDMAP is serialized as an header and a list of values.</p>
<pre><code>(size:varint)(header:header-structure)(values:byte[][])
</code></pre>
<ul>
<li><strong>size</strong> - the number of key-value pairs in the map</li>
<li><strong>header</strong> - serialized as <code>(key-type:byte)(key-value:byte[])(pointer-to-data:int32)(value-type:byte)</code> (where <code>pointer-to-data</code> is the same as the one in the header, offsetting from the start of the top-level document).</li>
<li><strong>values</strong> - the values serialized according to their type.</li>
</ul>
<h3 id="link"><a class="header" href="#link">LINK</a></h3>
<p>The link is stored as two 64 bit integers: the cluster id and the record's position in the cluster.</p>
<pre><code>(cluster-id:varint)(record-position:varint)
</code></pre>
<h3 id="linklist-linkset"><a class="header" href="#linklist-linkset">LINKLIST, LINKSET</a></h3>
<p>Link collections (lists and sets) are serialized as the size of the collection and then a list of LINKs.</p>
<pre><code>(size:varint)(links:LINK[])
</code></pre>
<h3 id="linkmap"><a class="header" href="#linkmap">LINKMAP</a></h3>
<p>Maps of links can have keys with the following types:</p>
<ul>
<li>STRING</li>
</ul>
<p>As of now though, <strong>all keys are converted to STRINGs</strong>.</p>
<p>A LINKMAP is serialized as the number of key-value pairs and then the list of key-value pairs.</p>
<pre><code>(size:varint)(key-value-pairs:key-value[])
</code></pre>
<p>A <code>key-value</code> pair is serialized as:</p>
<pre><code>(key-type:byte)(key-value:byte[])(link:LINK)
</code></pre>
<ul>
<li><strong>key-type</strong> - the type id of the type of the key</li>
<li><strong>key-value</strong> - the value of the key, serialized according to <strong>key-type</strong></li>
<li><strong>link</strong> - the link value</li>
</ul>
<h3 id="decimal-1"><a class="header" href="#decimal-1">DECIMAL</a></h3>
<p>Decimals are converted to integers and stored as the scale and the value. For example, <code>10234.546</code> is stored as scale <code>3</code> and value <code>10234546</code>.</p>
<pre><code>(scale:int32)(value-size:int32)(value:byte[])
</code></pre>
<ul>
<li><strong>scale</strong> - the scale of the decimal.</li>
<li><strong>value-size</strong> - the number of bytes that form the <code>value</code>.</li>
<li><strong>value</strong> - the bytes representing the value of the decimal (in big-endian order).</li>
</ul>
<h3 id="linkbag"><a class="header" href="#linkbag">LINKBAG</a></h3>
<p>LinkBag is a dynamic collection of links that change the way to store link from inside a document to an outside structure following the number of entries in the collection.</p>
<p>The collection is made by two parts an header and a content:</p>
<pre><code>  (config:byte)(uuid-low:int64)?(uuid-high:int64)?(content:rid-bag-content)
</code></pre>
<p>The header formate by:</p>
<ul>
<li><strong>config</strong> is a byte where the first bit if 1 means embedded content if 0 means link to external collection and the second bit if is 1 are present uuid-low and uuid-high parts if 0 are missing</li>
<li><strong>uuid-low</strong> to ignore</li>
<li><strong>uuid-hig</strong> to ignore</li>
</ul>
<p>in case RidBag Embedded the content is:</p>
<pre><code>  (n-entries:int32)[(cluster-id:int16)(cluster-position:int64)]*
</code></pre>
<p>where:</p>
<ul>
<li><strong>n-entries</strong> is the number of link present</li>
<li><strong>cluster-id</strong> is the clusterId  for the link</li>
<li><strong>cluster-position</strong> is the clusterPosition for the link</li>
</ul>
<p>RidBag Tree</p>
<pre><code>  (filed-id:int64)(page-index:int64)(page-offset:int32)(n-changes)[(cluster-id:int16)(cluster-position:int64)(change-type:byte)(change:int32)]*
</code></pre>
<p>where:</p>
<ul>
<li><strong>filed-id</strong>  part of extern collection identifier</li>
<li><strong>page-index</strong> part of extern collection identifier</li>
<li><strong>page-offset</strong> part of extern collection identifier</li>
<li><strong>n-changes</strong> number of changes happened for the collection in update</li>
<li><strong>cluster-id</strong> the cluster id of the change</li>
<li><strong>cluster-position</strong> the cluster position of the change</li>
<li><strong>change-type</strong> the type of the change 1 absolute change, 0 diff change</li>
<li><strong>change</strong> an int that define the change type</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="network-binary-protocol-commands"><a class="header" href="#network-binary-protocol-commands">Network Binary Protocol Commands</a></h1>
<p>This is the guide to the commands you can send through the binary protocol.</p>
<h2 id="see-also-5"><a class="header" href="#see-also-5">See also</a></h2>
<ul>
<li><a href="internals/../sql/SQL-Commands.html">List of SQL Commands</a></li>
<li><a href="internals/Network-Binary-Protocol.html#request_command">Network Binary Protocol Specification</a></li>
</ul>
<p>the commands are divided in three main groups:</p>
<ul>
<li>SQL (select) Query</li>
<li>SQL Commands</li>
<li>Script commands</li>
</ul>
<h3 id="sql-select-query"><a class="header" href="#sql-select-query">SQL (Select) Query</a></h3>
<pre><code>(text:string)(non-text-limit:int)[(fetch-plan:string)](serialized-params:bytes[])
</code></pre>
<p><strong>text</strong> text of the select query<br />
<strong>non-text-limit</strong>  Limit can be set in query's text, or here. This field had priority. Send -1 to use limit from query's text<br />
<strong>fetch-plan</strong> used only for select queries, otherwise empty<br />
<strong>serialized-params</strong> the byte[] result of the serialization of a <a href="internals/Network-Binary-Protocol-Commands.html#serialized-parameters-odocument-content">ODocument</a>.</p>
<h5 id="serialized-parameters-odocument-content"><a class="header" href="#serialized-parameters-odocument-content">Serialized Parameters ODocument content</a></h5>
<p>The ODocument have to contain a field called "params" of type Map.<br />
the Map should have as key, in case of positional parameters the numeric position of the parameter, in case of named parameters the name of the parameter and as value the value of the parameter.</p>
<h3 id="sql-commands-4"><a class="header" href="#sql-commands-4">SQL Commands</a></h3>
<pre><code>(text:string)(has-simple-parameters:boolean)(simple-parameters:bytes[])(has-complex-parameters:boolean)(complex-parameters:bytes[])
</code></pre>
<p><strong>text</strong> text of the sql command<br />
<strong>has-simple-parameters</strong> boolean flag for determine if the <strong>simple-parameters</strong> byte array is present or not<br />
<strong>simple-parameters</strong> the byte[] result of the serialization of a <a href="internals/Network-Binary-Protocol-Commands.html#serialized-simple-parameters-odocument-content">ODocument</a>.<br />
<strong>has-complex-parameters</strong> boolean flag for determine if the <strong>complex-parameters</strong> byte array is present or not<br />
<strong>complex-parameters</strong> the byte[] result of the serialization of a <a href="internals/Network-Binary-Protocol-Commands.html#serialized-complex-parameters-odocument-content">ODocument</a>.</p>
<h5 id="serialized-simple-parameters-odocument-content"><a class="header" href="#serialized-simple-parameters-odocument-content">Serialized Simple Parameters ODocument content</a></h5>
<p>The ODocument have to contain a field called "parameters" of type Map.<br />
the Map should have as key, in case of positional parameters the numeric position of the parameter, in case of named parameters the name of the parameter and as value the value of the parameter.</p>
<h5 id="serialized-complex-parameters-odocument-content"><a class="header" href="#serialized-complex-parameters-odocument-content">Serialized Complex Parameters ODocument content</a></h5>
<p>The ODocument have to contain a field called "compositeKeyParams" of type Map.<br />
the Map should have as key, in case of positional parameters the numeric position of the parameter, in case of named parameters the name of the parameter and as value a List that is the list of composite parameters.</p>
<h3 id="script-1"><a class="header" href="#script-1">Script</a></h3>
<pre><code>(language:string)(text:string)(has-simple-parameters:boolean)(simple-parameters:bytes[])(has-complex-parameters:boolean)(complex-parameters:bytes[])
</code></pre>
<p><strong>language</strong> the language of the script present in the text field.
All the others parameters are serialized as the <a href="internals/../sql/SQL-Commands.html">SQL Commands</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="orientdb-release-notes"><a class="header" href="#orientdb-release-notes">OrientDB Release Notes</a></h1>
<ul>
<li><a href="https://github.com/orientechnologies/orientdb/wiki/OrientDB-3.2-Release-Notes">OrientDB 3.2 Release Notes</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>


        
        <img referrerpolicy="unsafe-url" src="https://tglman.org/OrientDB/matomo.php?idsite=7&amp;rec=1" style="border:0" alt="" />


        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
