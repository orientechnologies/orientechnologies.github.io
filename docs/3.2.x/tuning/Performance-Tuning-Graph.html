<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Tuning the Graph API - OrientDB</title>


        <!-- Custom HTML head -->

        <meta name="description" content="OrientDB documentation">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">OrientDB</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="tuning-the-graph-api"><a class="header" href="#tuning-the-graph-api">Tuning the Graph API</a></h1>
<p>This guide is specific for the <a href="../java/Graph-Database-Tinkerpop.html">TinkerPop Blueprints Graph Database</a>. Please be sure to read the generic guide to the <a href="Performance-Tuning.html">Performance-Tuning</a>.</p>
<h2 id="connect-to-the-database-locally"><a class="header" href="#connect-to-the-database-locally">Connect to the database locally</a></h2>
<p>Local connection is much faster than remote. So use "plocal" based on the storage engine used on database creation. If you need to connect to the database from the network you can use the <a href="../internals/Embedded-Server.html">"Embed the server technique"</a>.</p>
<h2 id="avoid-putting-properties-on-edges"><a class="header" href="#avoid-putting-properties-on-edges">Avoid putting properties on edges</a></h2>
<p>Even though supports properties on edges, this is much expensive because it creates a new record per edge. So if you need them you've to know that the database will be bigger and insertion time will be much longer.</p>
<h2 id="set-properties-all-together"><a class="header" href="#set-properties-all-together">Set properties all together</a></h2>
<p>It's much lighter to set properties in block than one by one. Look at this paragraph: <a href="../java/Graph-VE.html#setting-multiple-properties">Setting Multiple Properties</a>.</p>
<h2 id="set-properties-on-vertex-and-edge-creation"><a class="header" href="#set-properties-on-vertex-and-edge-creation">Set properties on vertex and edge creation</a></h2>
<p>It's even faster if you set properties directly on creation of vertices and edges. Look at this paragraph: <a href="../java/Graph-VE.html#creating-element-and-properties-together">Creating Elements and Properties Together</a>.</p>
<h2 id="massive-insertion"><a class="header" href="#massive-insertion">Massive Insertion</a></h2>
<p>See <a href="Performance-Tuning.html#massive-insertion">Generic improvement on massive insertion</a>. To access to the underlying database use:</p>
<pre><code>database.getRawGraph().declareIntent( new OIntentMassiveInsert() );

// YOUR MASSIVE INSERTION

database.getRawGraph().declareIntent( null );
</code></pre>
<h2 id="avoid-transactions-if-you-can"><a class="header" href="#avoid-transactions-if-you-can">Avoid transactions if you can</a></h2>
<p>Use the OrientGraphNoTx implementation that doesn't use transaction for basic operations like creation and deletion of vertices and edges. If you plan to don't use transactions change the <a href="../java/Graph-Consistency.html">consistency level</a>. OrientGraphNoTx is not compatible with OrientBatchGraph so use it plain:</p>
<pre><code>OrientGraphNoTx graph = new OrientGraphNoTx("local:/tmp/mydb");
</code></pre>
<h2 id="use-the-schema"><a class="header" href="#use-the-schema">Use the schema</a></h2>
<p>Even if you can model your graph with only the entities (V)ertex and (E)dge it's much better to use schema for your types extending Vertex and Edge classes. In this way traversing will be faster and vertices and edges will be split on different files. For more information look at: <a href="../java/Graph-Schema.html">Graph Schema</a>.</p>
<p>Example:</p>
<pre><code>OClass account = graph.createVertexType("Account");
Vertex v = graph.addVertex("class:Account");
</code></pre>
<h2 id="use-indexes-to-lookup-vertices-by-an-id"><a class="header" href="#use-indexes-to-lookup-vertices-by-an-id">Use indexes to lookup vertices by an ID</a></h2>
<p>If you've your own ID on vertices and you need to lookup them to create edges then create an index against it:</p>
<pre><code>graph.createKeyIndex("id", Vertex.class, new Parameter("class", "Account"));
</code></pre>
<p>If the ID is unique then create an UNIQUE index that is much faster and lighter:</p>
<pre><code>graph.createKeyIndex("id", Vertex.class, new Parameter("type", "UNIQUE"), new Parameter("class", "Account"));
</code></pre>
<p>To lookup vertices by ID:</p>
<pre><code>for( Vertex v : graph.getVertices("Account.id", "23876JS2") ) {
  System.out.println("Found vertex: " + v );
}
</code></pre>
<h2 id="disable-validation"><a class="header" href="#disable-validation">Disable validation</a></h2>
<p>Every time a graph element is modified, OrientDB executes a validation to assure the graph rules are all respected, that means:</p>
<ul>
<li>put edge in out/in collections</li>
<li>put vertex in edges in/out</li>
</ul>
<p>Now if you use the Graph API without bypassing graph element manipulation this could be turned off with a huge gain in performance:</p>
<pre><code>graph.setValidationEnabled(false);
</code></pre>
<h2 id="reduce-vertex-objects"><a class="header" href="#reduce-vertex-objects">Reduce vertex objects</a></h2>
<p>You can avoid the creation of a new ODocument for each new vertex by reusing it with ODocument.reset() method that clears the instance making it ready for a new insert operation. Bear in mind that you will need to assign the document with the proper class after resetting as it is done in the code below.</p>
<blockquote>
<p><strong>NOTE</strong>: This trick works <em>ONLY IN NON-TRANSACTIONAL</em> contexts, because during transactions the documents could be kept in memory until commit.</p>
</blockquote>
<p>Example:</p>
<pre><code class="language-java">db.declareIntent( new OIntentMassiveInsert() );

ODocument doc = db.createVertex("myVertex");
for( int i = 0; i &lt; 1000000; ++i ){
  doc.reset();
  doc.setClassName("myVertex");
  doc.field("id", i);
  doc.field("name", "Jason");
  doc.save();
}

db.declareIntent( null );
</code></pre>
<h2 id="cache-management"><a class="header" href="#cache-management">Cache management</a></h2>
<p>Graph Database, by default, caches the most used elements. For massive insertion is strongly suggested to disable cache to avoid to keep all the element in memory. <a href="Performance-Tuning.html#use-the-massive-insert-intent">Massive Insert Intent</a> automatically sets it to false.</p>
<pre><code class="language-java">graph.setRetainObjects(false);
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../tuning/Performance-Tuning.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../tuning/Performance-Tuning-Document.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../tuning/Performance-Tuning.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../tuning/Performance-Tuning-Document.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>


        
        <img referrerpolicy="unsafe-url" src="https://tglman.org/OrientDB/matomo.php?idsite=7&amp;rec=1" style="border:0" alt="" />


        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
