<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Blueprints Extension - OrientDB</title>


        <!-- Custom HTML head -->

        <meta name="description" content="OrientDB documentation">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">OrientDB</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="using-the-blueprints-extensions"><a class="header" href="#using-the-blueprints-extensions">Using the Blueprints Extensions</a></h1>
<p>OrientDB is a graph database that merges graph, document and object-oriented worlds together.  Below are some of the features exclusive to OrientDB through the Blueprints Extensions.</p>
<blockquote>
<p>For information on tuning your graph database, see <a href="../tuning/Performance-Tuning-Graph.html">Performance Tuning Blueprints</a>.</p>
</blockquote>
<h2 id="custom-types"><a class="header" href="#custom-types">Custom Types</a></h2>
<p>OrientDB supports custom types for vertices and edges in an Object Oriented manner.  This feature is not supported directly through Blueprints, but there is a way to implement them.  If you want to create a schema to work with custom types, see <a href="Graph-Schema.html">Graph Schema</a>.</p>
<p>Additionally, OrientDB introduces a few variants to Blueprint methods for working with types.</p>
<h3 id="creating-vertices-and-edges-in-specific-clusters"><a class="header" href="#creating-vertices-and-edges-in-specific-clusters">Creating Vertices and Edges in Specific Clusters</a></h3>
<p>By default, each class has one cluster with the same name.  You can add multiple clusters to the class, allowing OrientDB to write vertices and edges on multiple files.</p>
<p>For instance,</p>
<pre><code class="language-java">// SAVE THE VERTEX INTO THE CLUSTER 'PERSON_USA' 
// ASSIGNED TO THE NODE 'USA'
graph.addVertex("class:Person,cluster:Person_usa");
</code></pre>
<h3 id="retrieving-vertices-and-edges-by-type"><a class="header" href="#retrieving-vertices-and-edges-by-type">Retrieving Vertices and Edges by Type</a></h3>
<p>To retrieve all vertices of the <code>Person</code> class, use the special <code>getVerticesOfClass(String className)</code> method.</p>
<p>For instance,</p>
<pre><code class="language-java">for (Vertex v : graph.getVerticesOfClass("Person")) {
    System.out.println(v.getProperty("name"));
}
</code></pre>
<p>Here, it retrieves all vertices of the class <code>Person</code> as well as all sub-classes.  It does this because OrientDB uses polymorphism by default.  If you would like to retrieve only those vertices of the <code>Person</code> class, excluding sub-types, use the <code>getVerticesOfClass(String className, boolean polymorphic)</code> method, specifying <code>false</code> in the <code>polymorphic</code> argument.  For instance,</p>
<pre><code class="language-java">for (Vertex v : graph.getVerticesOfClass("Person", false)) {
    System.out.println(v.getProperty("name"));
}
</code></pre>
<p>You can also use variations on these with the <code>.getEdges()</code> method:</p>
<ul>
<li><code>getEdgesOfClass(String className)</code></li>
<li><code>getEdgesOfClass(String, className, boolean polymorphic)</code></li>
</ul>
<h2 id="ordered-edges"><a class="header" href="#ordered-edges">Ordered Edges</a></h2>
<p>By default, OrientDB uses a set to handle edge collection.  But, sometimes it's better to have an ordered list to access the edge by an offset.</p>
<ul>
<li>
<p>For instance,</p>
<pre><code class="language-java">person.createEdgeProperty(Direction.OUT, "Photos").setOrdered(true);
</code></pre>
</li>
<li>
<p>Whenever you access the edge collection, it orders the edges.  Consider the example below, which prints all photos in the database in an ordered way:</p>
<pre><code class="language-java">for (Edge e : loadedPerson.getEdges(Direction.OUT, "Photos")) {
  System.out.println( "Photo name: " + e.getVertex(Direction.IN).getProperty("name") );
}
</code></pre>
</li>
<li>
<p>To access the underlying edge list, you need to use the Document Database API.  Consider this example, which swaps the tenth photo with the last:</p>
<pre><code class="language-java">// REPLACE EDGE Photos
List&lt;ODocument&gt; photos = loadedPerson.getRecord().field("out_Photos");
photos.add(photos.remove(9));
</code></pre>
</li>
<li>
<p>You can get the same result through SQL by executing the following commands in the terminal:</p>
<pre>
orientdb> <code class="lang-sql userinput">CREATE PROPERTY out_Photos LINKLIST</code>
orientdb> <code class="lang-sql userinput">ALTER PROPERTY User.out_Photos CUSTOM ORDERED=TRUE</code>
</pre>
</li>
</ul>
<h2 id="detached-elements"><a class="header" href="#detached-elements">Detached Elements</a></h2>
<p>When working with web applications, it is very common to query elements and render them to the user, allowing them to apply changes.</p>
<p>Consider what happens when the user changes some fields and saves.  Previously, the developer had to track the changes in a separate structure, load the vertex or edge from the database, and then apply the changes to the element.  Beginning in version 1.7 OrientDB, there are two new methods in the Graph API on the <code>OrientElement</code> and <code>OrientBaseGraph</code> classes:</p>
<ul>
<li><code>OrientElement.detach()</code> and <code>OrientBaseGraph.detach(OrientElement)</code> methods fetch all record content in memory and resets the connection to the Graph instance.</li>
<li><code>OrientElement.attach()</code> and <code>OrientBaseGraph.attach(OrientElement)</code> methods save the detached element back into the database and restores the connection between the Graph Element and the Graph instance.</li>
</ul>
<p>For instance, to use these begin by loading a vertex and detaching it:</p>
<pre><code class="language-java">OrientGraph g = OrientGraph("plocal:/temp/db");
try {
    Iterable&lt;OrientVertex&gt; results = g.query().has("name", EQUALS, "fast");
    for (OrientVertex v : results)
        v.detach();
} finally {
    g.shutdown();
}
</code></pre>
<p>Update the element, either from the GUI or by application:</p>
<pre><code class="language-java">v.setProperty("name", "super fast!");
</code></pre>
<p>When the user saves, re-attach the element and save it to the database:</p>
<pre><code class="language-java">OrientGraph g = OrientGraph("plocal:/temp/db");
try {
    v.attach(g);
    v.save();
} finally {
    g.shutdown();
}
</code></pre>
<h3 id="faq"><a class="header" href="#faq">FAQ</a></h3>
<p><strong>Do <code>detach()</code> methods work recursively to detach all connected elements?</strong>
No, it only works on the current element.</p>
<p><strong>Can you add an edge against detached elements?</strong>
No, you can only get, set or remove a property while it's detached.  Any other operation that requires the database it throws an <code>IllegalStateException</code> exception.</p>
<h2 id="executing-commands"><a class="header" href="#executing-commands">Executing Commands</a></h2>
<p>The OrientDB Blueprints implementation allows you to execute commands using SQL, JavaScript and all other supported languages.</p>
<h3 id="sql-queries"><a class="header" href="#sql-queries">SQL Queries</a></h3>
<p>It is possible to have parameters in a query using <a href="Document-API-Documents.html#prepared-queries">prepared queries</a>.</p>
<pre><code class="language-java">for (Vertex v : (Iterable&lt;Vertex&gt;) graph.command(new OCommandSQL(
			"SELECT EXPAND( out('bought') ) FROM Customer WHERE name = 'Jay'")).execute()) {
    System.out.println("- Bought: " + v);
}
</code></pre>
<p>To execute an asynchronous query:</p>
<pre><code class="language-java">graph.command(
          new OSQLAsynchQuery&lt;Vertex&gt;("SELECT FROM Member",
            new OCommandResultListener() {
              int resultCount =0;
              @Override
              public boolean result(Object iRecord) {
                resultCount++;
                Vertex doc = graph.getVertex( iRecord );
               return resultCount &lt; 100;
              }
            } ).execute();
</code></pre>
<h3 id="sql-commands"><a class="header" href="#sql-commands">SQL Commands</a></h3>
<p>In addition to queries, you can also execute any SQL command, such as <a href="../sql/SQL-Create-Vertex.html"><code>CREATE VERTEX</code></a>, <a href="../sql/SQL-Update.html"><code>UPDATE</code></a>, or <a href="../sql/SQL-Delete-Vertex.html"><code>DELETE VERTEX</code></a>.  For instance, consider a case where you want to set a new property called <code>local</code> to <code>true</code> on all the customers that live in Rome.</p>
<pre><code class="language-java">int modified = graph.command(
          new OCommandSQL("UPDATE Customer SET local = true WHERE 'Rome' IN out('lives').name")).execute());
</code></pre>
<p>If the command modifies the schema, (such as in cases like <a href="../sql/SQL-Create-Class.html"><code>CREATE CLASS</code></a>, <a href="../sql/SQL-Alter-Class.html"><code>ALTER CLASS</code></a>, <a href="../sql/SQL-Drop-Class.html"><code>DROP CLASS</code></a>, <a href="../sql/SQL-Create-Property.html"><code>CREATE PROPERTY</code></a>, <a href="../sql/SQL-Alter-Property.html"><code>ALTER PROPERTY</code></a>, and <a href="../sql/SQL-Drop-Property.html"><code>DROP PROPERTY</code></a>, remember you need to force the schema update of the database instance you're using by calling the <code>.reload()</code> method.</p>
<pre><code class="language-java">graph.getRawGraph().getMetadata().getSchema().reload();
</code></pre>
<blockquote>
<p>For more information, see <a href="../sql/SQL-Commands.html">SQL Commands</a></p>
</blockquote>
<h3 id="sql-batch"><a class="header" href="#sql-batch">SQL Batch</a></h3>
<p>To execute multiple SQL commands in a batch, use the <code>OCommandScript</code> and SQL as the language.  This is recommended when creating edges on the server-side, to minimize the network roundtrip.</p>
<pre><code class="language-java">String cmd = "BEGIN;";
cmd += "LET a = CREATE VERTEX SET script = true;";
cmd += "LET b = SELECT FROM V LIMIT 1;";
cmd += "LET e = CREATE EDGE FROM $a TO $b RETRY 100;";
cmd += "COMMIT;";
cmd += "return $e;";

OIdentifiable edge = graph.command(new OCommandScript("sql", cmd)).execute();
</code></pre>
<blockquote>
<p>For more information, see <a href="../sql/SQL-batch.html">SQL Batch</a></p>
</blockquote>
<h3 id="database-functions"><a class="header" href="#database-functions">Database Functions</a></h3>
<p>To execute database functions, you must write it in JavaScript or any other supported languages.  For the examples, consider a function called <code>updateAllTheCustomersInCity(cityName)</code> that executes the same update as above.  Note the <code>'Rome'</code> attribute passed in the attribute apssed int he <code>execute()</code> method:</p>
<pre><code class="language-java">graph.command(new OCommandFunction(
	"updateAllTheCustomersInCity")).execute("Rome"));
</code></pre>
<h3 id="executing-code"><a class="header" href="#executing-code">Executing Code</a></h3>
<p>To execute code on the server side, you can select between the supported language, (which by default is JavaScript):</p>
<pre><code class="language-java">graph.command(
          new OCommandScript("javascript", "for(var i=0;i&lt;10;++i){ print('\nHello World!'); }")).execute());
</code></pre>
<p>This prints the line "Hello World!" ten times in the server conssole, or in the local console, if the database has been opened in PLocal mode.</p>
<h2 id="accessing-the-graph"><a class="header" href="#accessing-the-graph">Accessing the Graph</a></h2>
<p>The TinkerPop Blueprints API is quite raw and doesn't provide ad hoc methods for very common use cases.  To get around this, you may need to access the <code>ODatabaseGraphTx</code> object to extend what you can do through the underlying graph engine.  Common operations are:</p>
<ul>
<li>Counting incoming and outgoing edges without browsing them.</li>
<li>Getting incoming and outgoing vertices without browsing the edges.</li>
<li>Executing a query using an SQL-like language integrated in the engine.</li>
</ul>
<p>The <a href="/com/tinkerpop/blueprints/impls/orient/OrientGraph.html"><code>OrientGraph</code></a> class provides the method <code>.getRawGraph()</code> to return the underlying Document database. For instance,</p>
<pre><code class="language-java">final OrientGraph graph = new OrientGraph("plocal:C:/temp/graph/db");
try {
  OResultSet result = graph.getRawGraph().query("SELECT FROM V WHERE color = 'red'");
} finally {
  graph.shutdown();
}
</code></pre>
<h3 id="security"><a class="header" href="#security">Security</a></h3>
<p>If you want to use OrientDB security, use the construction that retrieves the Database URL, user and password.  For more information on OrientDB security, see <a href="../security/Security.html">Security</a>.  By default, it uses the <code>admin</code> user.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../java/Graph-VE.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../java/Graph-Factory.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../java/Graph-VE.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../java/Graph-Factory.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>


        
        <img referrerpolicy="unsafe-url" src="https://tglman.org/OrientDB/matomo.php?idsite=7&amp;rec=1" style="border:0" alt="" />


        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
