<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Lifecycle - OrientDB</title>


        <!-- Custom HTML head -->

        <meta name="description" content="OrientDB documentation">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">OrientDB</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="distributed-architecture-lifecycle"><a class="header" href="#distributed-architecture-lifecycle">Distributed Architecture Lifecycle</a></h1>
<p>In OrientDB Distributed Architecture all the nodes are masters (Multi-Master), while in most DBMS the replication works in Master-Slave mode where there is only one Master node and N Slaves that are use only for reads or when the Master is down. Starting from OrientDB v2.1, you can also assign the role of <a href="Distributed-Architecture.html#server-roles">REPLICA</a> to some nodes.</p>
<p>When start a OrientDB server in distributed mode (<code>bin/dserver.sh</code>) it looks for an existent cluster. If exists the starting node joins the cluster, otherwise creates a new one. You can have <a href="Distributed-Architecture-Lifecycle.html#multiple-clusters">multiple clusters</a> in your network, each cluster with a different "group name".</p>
<h2 id="joining-a-cluster"><a class="header" href="#joining-a-cluster">Joining a cluster</a></h2>
<h3 id="auto-discovering"><a class="header" href="#auto-discovering">Auto discovering</a></h3>
<p>At startup each Server Node sends an IP Multicast message in broadcast to discover if an existent cluster is available to join it. If available the Server Node will connect to it, otherwise creates a new cluster.</p>
<p><img src="http://www.orientdb.org/images/cluster-autodiscovering.png" alt="image" /></p>
<p>This is the default configuration contained in <code>config/hazelcast.xml</code> file. Below the multicast configuration fragment:</p>
<pre><code class="language-xml">&lt;hazelcast&gt;
  &lt;network&gt;
    &lt;port auto-increment="true"&gt;2434&lt;/port&gt;
      &lt;join&gt;
        &lt;multicast enabled="true"&gt;
          &lt;multicast-group&gt;235.1.1.1&lt;/multicast-group&gt;
          &lt;multicast-port&gt;2434&lt;/multicast-port&gt;
       &lt;/multicast&gt;
     &lt;/join&gt;
  &lt;/network&gt;
&lt;/hazelcast&gt;
</code></pre>
<p>If multicast is not available (typical on Cloud environments), you can use:</p>
<ul>
<li><a href="http://docs.hazelcast.org/docs/3.6/manual/html-single/index.html#discovering-members-by-tcp">Direct IPs</a></li>
<li><a href="http://docs.hazelcast.org/docs/3.6/manual/html-single/index.html#discovering-members-within-ec2-cloud">Amazon EC2 Discovering</a></li>
</ul>
<p>For more information look at <a href="http://docs.hazelcast.org/docs/3.6/manual/html-single/index.html#network-configuration">Hazelcast documentation about configuring network</a>.</p>
<h3 id="security"><a class="header" href="#security">Security</a></h3>
<p>To join a cluster the Server Node has to configure the cluster group name and password in hazelcast.xml file. By default these information aren't encrypted. If you wan to encrypt all the distributed messages, configure it in hazelcast.xml file:</p>
<pre><code class="language-xml">&lt;hazelcast&gt;
    ...
    &lt;network&gt;
        ...
        &lt;!--
            Make sure to set enabled=true
            Make sure this configuration is exactly the same on
            all members
        --&gt;
        &lt;symmetric-encryption enabled="true"&gt;
            &lt;!--
               encryption algorithm such as
               DES/ECB/PKCS5Padding,
               PBEWithMD5AndDES,
               Blowfish,
               DESede
            --&gt;
            &lt;algorithm&gt;PBEWithMD5AndDES&lt;/algorithm&gt;

            &lt;!-- salt value to use when generating the secret key --&gt;
            &lt;salt&gt;thesalt&lt;/salt&gt;

            &lt;!-- pass phrase to use when generating the secret key --&gt;
            &lt;password&gt;thepass&lt;/password&gt;

            &lt;!-- iteration count to use when generating the secret key --&gt;
            &lt;iteration-count&gt;19&lt;/iteration-count&gt;
        &lt;/symmetric-encryption&gt;
    &lt;/network&gt;
    ...
&lt;/hazelcast&gt;
</code></pre>
<p>All the nodes in the distributed cluster must have the same settings.</p>
<p><img src="http://www.orientdb.org/images/cluster-security.png" alt="image" /></p>
<p>For more information look at: <a href="https://docs.hazelcast.org/docs/3.10/manual/html-single/#encryption">Hazelcast Encryption</a>.</p>
<h3 id="join-to-an-existent-cluster"><a class="header" href="#join-to-an-existent-cluster">Join to an existent cluster</a></h3>
<p>You can have multiple OrientDB clusters in the same network, what identifies a cluster is it’s name that must be unique in the network. By default OrientDB uses "orientdb", but for security reasons change it to a different name and password. All the nodes in the distributed cluster must have the same settings.</p>
<pre><code class="language-xml">&lt;hazelcast&gt;
  &lt;group&gt;
    &lt;name&gt;orientdb&lt;/name&gt;
    &lt;password&gt;orientdb&lt;/password&gt;
  &lt;/group&gt;
&lt;/hazelcast&gt;
</code></pre>
<p>In this case Server #2 joins the existent cluster.</p>
<p><img src="http://www.orientdb.org/images/cluster-join.png" alt="image" /></p>
<p>When a node joins an existent cluster, the most updated copy of the database is downloaded to the joining node if the distributed configuration has <code>autoDeploy:true</code>. If the node is rejoining the cluster after a disconnection, a delta backup is requested first. If not available a full backup is sent to the joining server. If it has been configured a sharded configuration, the joining node will ask for separate parts of the database to multiple available servers to reconstruct the own database copy. If any copy of database was already present, that is moved under <code>backup/databases</code> folder.</p>
<h3 id="multiple-clusters"><a class="header" href="#multiple-clusters">Multiple clusters</a></h3>
<p>Multiple clusters can coexist in the same network. Clusters can't see each others because are isolated black boxes.</p>
<p><img src="http://www.orientdb.org/images/cluster-multiple.png" alt="image" /></p>
<h3 id="distribute-the-configuration-to-the-clients"><a class="header" href="#distribute-the-configuration-to-the-clients">Distribute the configuration to the clients</a></h3>
<p>Every time a new Server Node joins or leaves the Cluster, the new Cluster configuration is broadcasted to all the connected clients. Everybody knows the cluster layout and who has a database!</p>
<p><img src="http://www.orientdb.org/images/cluster-cfg.png" alt="image" /></p>
<h2 id="fail-over-management"><a class="header" href="#fail-over-management">Fail over management</a></h2>
<h3 id="when-a-node-is-unreachable"><a class="header" href="#when-a-node-is-unreachable">When a node is unreachable</a></h3>
<p>When a Server Node becomes unreachable (because it’s crashed, network problems, high load, etc.) the Cluster treats this event as if the Server Node left the cluster.</p>
<p><img src="http://www.orientdb.org/images/cluster-crash.png" alt="image" /></p>
<p>Starting from v2.2.13, the unreachable server is removed from the <a href="Distributed-Configuration.html">distributed configuration</a> only if it's dynamic, that means it hasn't registered under the <a href="Distributed-Configuration.html#default-distributed-db-configjson"><code>servers</code></a> configuration. Once removed it doesn't concur to the quorum anymore. Instead, if the server has been registered under <a href="Distributed-Configuration.html#default-distributed-db-configjson"><code>servers</code></a>, it's kept in configuration waiting for a rejoining.</p>
<p>The <a href="Distributed-Configuration.html#default-distributed-db-configjson"><code>newNodeStrategy</code></a> setting specifies if a new joining node is automatically registered as static or is managed as dynamic.</p>
<h3 id="automatic-switch-of-servers"><a class="header" href="#automatic-switch-of-servers">Automatic switch of servers</a></h3>
<p>All the clients connected to the unreachable node will switch to another server transparently without raising errors to the Application User Application doesn’t know what is happening!</p>
<p><img src="http://www.orientdb.org/images/cluster-clientswitch.png" alt="image" /></p>
<h3 id="re-distribute-the-updated-configuration-again"><a class="header" href="#re-distribute-the-updated-configuration-again">Re-distribute the updated configuration again</a></h3>
<p>After the Server #2 left the Cluster the updated configuration is sent again to all the connected clients.</p>
<p><img src="http://www.orientdb.org/images/cluster-recfg.png" alt="image" /></p>
<p>Continue with:</p>
<ul>
<li><a href="Distributed-Architecture.html">Distributed Architecture</a></li>
<li><a href="Replication.html">Replication</a></li>
<li><a href="../gettingstarted/tutorials/Tutorial-Setup-a-distributed-database.html">Tutorial to setup a distributed database</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../distributed/Distributed-Architecture.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../distributed/Distributed-Configuration.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../distributed/Distributed-Architecture.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../distributed/Distributed-Configuration.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
